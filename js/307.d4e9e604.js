(self["webpackChunkalien_mood"]=self["webpackChunkalien_mood"]||[]).push([[307],{655:function(t,e,s){"use strict";var i=s(6955),n=String;t.exports=function(t){if("Symbol"===i(t))throw new TypeError("Cannot convert a Symbol value to a string");return n(t)}},795:function(t,e,s){"use strict";t.exports=s.p+"img/open_in_full.5449af34.svg"},1129:function(t,e,s){"use strict";t.exports=s.p+"img/shirt.06e570ae.svg"},1307:function(t,e,s){"use strict";s.r(e),s.d(e,{default:function(){return Iy}});var i=s(6768);const n={ref:"contentArea",class:"mobile-wrapper h-[full]"};function r(t,e,s,r,o,a){const h=(0,i.g2)("CanvasUI");return(0,i.uX)(),(0,i.CE)("div",n,[(0,i.bF)(h,{ref:"child"},null,512)],512)}var o=s(4232);s(4114),s(8111),s(2489),s(7588),s(1701);var a=s(144);s(1148),s(116),s(8237),s(3579),s(7642),s(8004),s(3853),s(5876),s(2475),s(5024),s(1698),s(9577);function h(t,e,s){return(e=function(t){var e=function(t,e){if("object"!=typeof t||!t)return t;var s=t[Symbol.toPrimitive];if(void 0!==s){var i=s.call(t,e||"default");if("object"!=typeof i)return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}(t,"string");return"symbol"==typeof e?e:e+""}(e))in t?Object.defineProperty(t,e,{value:s,enumerable:!0,configurable:!0,writable:!0}):t[e]=s,t}function c(t,e){var s=Object.keys(t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(t);e&&(i=i.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),s.push.apply(s,i)}return s}function l(t){for(var e=1;e<arguments.length;e++){var s=null!=arguments[e]?arguments[e]:{};e%2?c(Object(s),!0).forEach((function(e){h(t,e,s[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(s)):c(Object(s)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(s,e))}))}return t}function u(t,e){if(null==t)return{};var s,i,n=function(t,e){if(null==t)return{};var s={};for(var i in t)if({}.hasOwnProperty.call(t,i)){if(e.indexOf(i)>=0)continue;s[i]=t[i]}return s}(t,e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);for(i=0;i<r.length;i++)s=r[i],e.indexOf(s)>=0||{}.propertyIsEnumerable.call(t,s)&&(n[s]=t[s])}return n}function d(t,e){return e||(e=t.slice(0)),Object.freeze(Object.defineProperties(t,{raw:{value:Object.freeze(e)}}))}class g{constructor(){h(this,"browserShadowBlurConstant",1),h(this,"DPI",96),h(this,"devicePixelRatio","undefined"!=typeof window?window.devicePixelRatio:1),h(this,"perfLimitSizeTotal",2097152),h(this,"maxCacheSideLimit",4096),h(this,"minCacheSideLimit",256),h(this,"disableStyleCopyPaste",!1),h(this,"enableGLFiltering",!0),h(this,"textureSize",4096),h(this,"forceGLPutImageData",!1),h(this,"cachesBoundsOfCurve",!1),h(this,"fontPaths",{}),h(this,"NUM_FRACTION_DIGITS",4)}}const p=new class extends g{constructor(t){super(),this.configure(t)}configure(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};Object.assign(this,t)}addFonts(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};this.fontPaths=l(l({},this.fontPaths),t)}removeFonts(){(arguments.length>0&&void 0!==arguments[0]?arguments[0]:[]).forEach((t=>{delete this.fontPaths[t]}))}clearFonts(){this.fontPaths={}}restoreDefaults(t){const e=new g,s=(null==t?void 0:t.reduce(((t,s)=>(t[s]=e[s],t)),{}))||e;this.configure(s)}},f=function(t){for(var e=arguments.length,s=new Array(e>1?e-1:0),i=1;i<e;i++)s[i-1]=arguments[i];return console[t]("fabric",...s)};class m extends Error{constructor(t,e){super("fabric: ".concat(t),e)}}class _ extends m{constructor(t){super("".concat(t," 'options.signal' is in 'aborted' state"))}}class v{}class y extends v{testPrecision(t,e){const s="precision ".concat(e," float;\nvoid main(){}"),i=t.createShader(t.FRAGMENT_SHADER);return!!i&&(t.shaderSource(i,s),t.compileShader(i),!!t.getShaderParameter(i,t.COMPILE_STATUS))}queryWebGL(t){const e=t.getContext("webgl");e&&(this.maxTextureSize=e.getParameter(e.MAX_TEXTURE_SIZE),this.GLPrecision=["highp","mediump","lowp"].find((t=>this.testPrecision(e,t))),e.getExtension("WEBGL_lose_context").loseContext(),f("log","WebGL: max texture size ".concat(this.maxTextureSize)))}isSupported(t){return!!this.maxTextureSize&&this.maxTextureSize>=t}}const C={};let b;const w=()=>b||(b={document:document,window:window,isTouchSupported:"ontouchstart"in window||"ontouchstart"in document||window&&window.navigator&&window.navigator.maxTouchPoints>0,WebGLProbe:new y,dispose(){},copyPasteData:C}),x=()=>w().document,S=()=>w().window,T=()=>{var t;return Math.max(null!==(t=p.devicePixelRatio)&&void 0!==t?t:S().devicePixelRatio,1)},k=new class{constructor(){h(this,"charWidthsCache",{}),h(this,"boundsOfCurveCache",{})}getFontCache(t){let{fontFamily:e,fontStyle:s,fontWeight:i}=t;e=e.toLowerCase(),this.charWidthsCache[e]||(this.charWidthsCache[e]={});const n=this.charWidthsCache[e],r="".concat(s.toLowerCase(),"_").concat((i+"").toLowerCase());return n[r]||(n[r]={}),n[r]}clearFontCache(t){(t=(t||"").toLowerCase())?this.charWidthsCache[t]&&delete this.charWidthsCache[t]:this.charWidthsCache={}}limitDimsByArea(t){const{perfLimitSizeTotal:e}=p,s=Math.sqrt(e*t);return[Math.floor(s),Math.floor(e/s)]}},A="6.7.0";function E(){}const O=Math.PI/2,D=2*Math.PI,P=Math.PI/180,I=Object.freeze([1,0,0,1,0,0]),M=16,R=.4477152502,F="center",L="left",j="top",N="bottom",B="right",W="none",U=/\r?\n/,Y="moving",X="scaling",V="rotating",G="rotate",H="skewing",z="resizing",q="modifyPoly",K="modifyPath",Q="changed",J="scale",Z="scaleX",$="scaleY",tt="skewX",et="skewY",st="fill",it="stroke",nt="modified",rt="json",ot="svg",at=new class{constructor(){this[rt]=new Map,this[ot]=new Map}has(t){return this[rt].has(t)}getClass(t){const e=this[rt].get(t);if(!e)throw new m("No class registered for ".concat(t));return e}setClass(t,e){e?this[rt].set(e,t):(this[rt].set(t.type,t),this[rt].set(t.type.toLowerCase(),t))}getSVGClass(t){return this[ot].get(t)}setSVGClass(t,e){this[ot].set(null!=e?e:t.type.toLowerCase(),t)}},ht=new class extends Array{remove(t){const e=this.indexOf(t);e>-1&&this.splice(e,1)}cancelAll(){const t=this.splice(0);return t.forEach((t=>t.abort())),t}cancelByCanvas(t){if(!t)return[];const e=this.filter((e=>{var s;return e.target===t||"object"==typeof e.target&&(null===(s=e.target)||void 0===s?void 0:s.canvas)===t}));return e.forEach((t=>t.abort())),e}cancelByTarget(t){if(!t)return[];const e=this.filter((e=>e.target===t));return e.forEach((t=>t.abort())),e}};class ct{constructor(){h(this,"__eventListeners",{})}on(t,e){if(this.__eventListeners||(this.__eventListeners={}),"object"==typeof t)return Object.entries(t).forEach((t=>{let[e,s]=t;this.on(e,s)})),()=>this.off(t);if(e){const s=t;return this.__eventListeners[s]||(this.__eventListeners[s]=[]),this.__eventListeners[s].push(e),()=>this.off(s,e)}return()=>!1}once(t,e){if("object"==typeof t){const e=[];return Object.entries(t).forEach((t=>{let[s,i]=t;e.push(this.once(s,i))})),()=>e.forEach((t=>t()))}if(e){const s=this.on(t,(function(){for(var t=arguments.length,i=new Array(t),n=0;n<t;n++)i[n]=arguments[n];e.call(this,...i),s()}));return s}return()=>!1}_removeEventListener(t,e){if(this.__eventListeners[t])if(e){const s=this.__eventListeners[t],i=s.indexOf(e);i>-1&&s.splice(i,1)}else this.__eventListeners[t]=[]}off(t,e){if(this.__eventListeners)if(void 0===t)for(const s in this.__eventListeners)this._removeEventListener(s);else"object"==typeof t?Object.entries(t).forEach((t=>{let[e,s]=t;this._removeEventListener(e,s)})):this._removeEventListener(t,e)}fire(t,e){var s;if(!this.__eventListeners)return;const i=null===(s=this.__eventListeners[t])||void 0===s?void 0:s.concat();if(i)for(let n=0;n<i.length;n++)i[n].call(this,e||{})}}const lt=(t,e)=>{const s=t.indexOf(e);return-1!==s&&t.splice(s,1),t},ut=t=>{if(0===t)return 1;switch(Math.abs(t)/O){case 1:case 3:return 0;case 2:return-1}return Math.cos(t)},dt=t=>{if(0===t)return 0;const e=t/O,s=Math.sign(t);switch(e){case 1:return s;case 2:return 0;case 3:return-s}return Math.sin(t)};class gt{constructor(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;"object"==typeof t?(this.x=t.x,this.y=t.y):(this.x=t,this.y=e)}add(t){return new gt(this.x+t.x,this.y+t.y)}addEquals(t){return this.x+=t.x,this.y+=t.y,this}scalarAdd(t){return new gt(this.x+t,this.y+t)}scalarAddEquals(t){return this.x+=t,this.y+=t,this}subtract(t){return new gt(this.x-t.x,this.y-t.y)}subtractEquals(t){return this.x-=t.x,this.y-=t.y,this}scalarSubtract(t){return new gt(this.x-t,this.y-t)}scalarSubtractEquals(t){return this.x-=t,this.y-=t,this}multiply(t){return new gt(this.x*t.x,this.y*t.y)}scalarMultiply(t){return new gt(this.x*t,this.y*t)}scalarMultiplyEquals(t){return this.x*=t,this.y*=t,this}divide(t){return new gt(this.x/t.x,this.y/t.y)}scalarDivide(t){return new gt(this.x/t,this.y/t)}scalarDivideEquals(t){return this.x/=t,this.y/=t,this}eq(t){return this.x===t.x&&this.y===t.y}lt(t){return this.x<t.x&&this.y<t.y}lte(t){return this.x<=t.x&&this.y<=t.y}gt(t){return this.x>t.x&&this.y>t.y}gte(t){return this.x>=t.x&&this.y>=t.y}lerp(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:.5;return e=Math.max(Math.min(1,e),0),new gt(this.x+(t.x-this.x)*e,this.y+(t.y-this.y)*e)}distanceFrom(t){const e=this.x-t.x,s=this.y-t.y;return Math.sqrt(e*e+s*s)}midPointFrom(t){return this.lerp(t)}min(t){return new gt(Math.min(this.x,t.x),Math.min(this.y,t.y))}max(t){return new gt(Math.max(this.x,t.x),Math.max(this.y,t.y))}toString(){return"".concat(this.x,",").concat(this.y)}setXY(t,e){return this.x=t,this.y=e,this}setX(t){return this.x=t,this}setY(t){return this.y=t,this}setFromPoint(t){return this.x=t.x,this.y=t.y,this}swap(t){const e=this.x,s=this.y;this.x=t.x,this.y=t.y,t.x=e,t.y=s}clone(){return new gt(this.x,this.y)}rotate(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:pt;const s=dt(t),i=ut(t),n=this.subtract(e);return new gt(n.x*i-n.y*s,n.x*s+n.y*i).add(e)}transform(t){let e=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return new gt(t[0]*this.x+t[2]*this.y+(e?0:t[4]),t[1]*this.x+t[3]*this.y+(e?0:t[5]))}}const pt=new gt(0,0),ft=t=>!!t&&Array.isArray(t._objects);function mt(t){class e extends t{constructor(){super(...arguments),h(this,"_objects",[])}_onObjectAdded(t){}_onObjectRemoved(t){}_onStackOrderChanged(t){}add(){for(var t=arguments.length,e=new Array(t),s=0;s<t;s++)e[s]=arguments[s];const i=this._objects.push(...e);return e.forEach((t=>this._onObjectAdded(t))),i}insertAt(t){for(var e=arguments.length,s=new Array(e>1?e-1:0),i=1;i<e;i++)s[i-1]=arguments[i];return this._objects.splice(t,0,...s),s.forEach((t=>this._onObjectAdded(t))),this._objects.length}remove(){const t=this._objects,e=[];for(var s=arguments.length,i=new Array(s),n=0;n<s;n++)i[n]=arguments[n];return i.forEach((s=>{const i=t.indexOf(s);-1!==i&&(t.splice(i,1),e.push(s),this._onObjectRemoved(s))})),e}forEachObject(t){this.getObjects().forEach(((e,s,i)=>t(e,s,i)))}getObjects(){for(var t=arguments.length,e=new Array(t),s=0;s<t;s++)e[s]=arguments[s];return 0===e.length?[...this._objects]:this._objects.filter((t=>t.isType(...e)))}item(t){return this._objects[t]}isEmpty(){return 0===this._objects.length}size(){return this._objects.length}contains(t,s){return!!this._objects.includes(t)||!!s&&this._objects.some((s=>s instanceof e&&s.contains(t,!0)))}complexity(){return this._objects.reduce(((t,e)=>t+(e.complexity?e.complexity():0)),0)}sendObjectToBack(t){return!(!t||t===this._objects[0])&&(lt(this._objects,t),this._objects.unshift(t),this._onStackOrderChanged(t),!0)}bringObjectToFront(t){return!(!t||t===this._objects[this._objects.length-1])&&(lt(this._objects,t),this._objects.push(t),this._onStackOrderChanged(t),!0)}sendObjectBackwards(t,e){if(!t)return!1;const s=this._objects.indexOf(t);if(0!==s){const i=this.findNewLowerIndex(t,s,e);return lt(this._objects,t),this._objects.splice(i,0,t),this._onStackOrderChanged(t),!0}return!1}bringObjectForward(t,e){if(!t)return!1;const s=this._objects.indexOf(t);if(s!==this._objects.length-1){const i=this.findNewUpperIndex(t,s,e);return lt(this._objects,t),this._objects.splice(i,0,t),this._onStackOrderChanged(t),!0}return!1}moveObjectTo(t,e){return t!==this._objects[e]&&(lt(this._objects,t),this._objects.splice(e,0,t),this._onStackOrderChanged(t),!0)}findNewLowerIndex(t,e,s){let i;if(s){i=e;for(let s=e-1;s>=0;--s)if(t.isOverlapping(this._objects[s])){i=s;break}}else i=e-1;return i}findNewUpperIndex(t,e,s){let i;if(s){i=e;for(let s=e+1;s<this._objects.length;++s)if(t.isOverlapping(this._objects[s])){i=s;break}}else i=e+1;return i}collectObjects(t){let{left:e,top:s,width:i,height:n}=t,{includeIntersecting:r=!0}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const o=[],a=new gt(e,s),h=a.add(new gt(i,n));for(let c=this._objects.length-1;c>=0;c--){const t=this._objects[c];t.selectable&&t.visible&&(r&&t.intersectsWithRect(a,h)||t.isContainedWithinRect(a,h)||r&&t.containsPoint(a)||r&&t.containsPoint(h))&&o.push(t)}return o}}return e}class _t extends ct{_setOptions(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};for(const e in t)this.set(e,t[e])}_setObject(t){for(const e in t)this._set(e,t[e])}set(t,e){return"object"==typeof t?this._setObject(t):this._set(t,e),this}_set(t,e){this[t]=e}toggle(t){const e=this.get(t);return"boolean"==typeof e&&this.set(t,!e),this}get(t){return this[t]}}function vt(t){return S().requestAnimationFrame(t)}function yt(t){return S().cancelAnimationFrame(t)}let Ct=0;const bt=()=>Ct++,wt=()=>{const t=x().createElement("canvas");if(!t||void 0===t.getContext)throw new m("Failed to create `canvas` element");return t},xt=()=>x().createElement("img"),St=t=>{const e=wt();return e.width=t.width,e.height=t.height,e},Tt=(t,e,s)=>t.toDataURL("image/".concat(e),s),kt=(t,e,s)=>new Promise(((i,n)=>{t.toBlob(i,"image/".concat(e),s)})),At=t=>t*P,Et=t=>t/P,Ot=t=>t.every(((t,e)=>t===I[e])),Dt=(t,e,s)=>new gt(t).transform(e,s),Pt=t=>{const e=1/(t[0]*t[3]-t[1]*t[2]),s=[e*t[3],-e*t[1],-e*t[2],e*t[0],0,0],{x:i,y:n}=new gt(t[4],t[5]).transform(s,!0);return s[4]=-i,s[5]=-n,s},It=(t,e,s)=>[t[0]*e[0]+t[2]*e[1],t[1]*e[0]+t[3]*e[1],t[0]*e[2]+t[2]*e[3],t[1]*e[2]+t[3]*e[3],s?0:t[0]*e[4]+t[2]*e[5]+t[4],s?0:t[1]*e[4]+t[3]*e[5]+t[5]],Mt=(t,e)=>t.reduceRight(((t,s)=>s&&t?It(s,t,e):s||t),void 0)||I.concat(),Rt=t=>{let[e,s]=t;return Math.atan2(s,e)},Ft=t=>{const e=Rt(t),s=Math.pow(t[0],2)+Math.pow(t[1],2),i=Math.sqrt(s),n=(t[0]*t[3]-t[2]*t[1])/i,r=Math.atan2(t[0]*t[2]+t[1]*t[3],s);return{angle:Et(e),scaleX:i,scaleY:n,skewX:Et(r),skewY:0,translateX:t[4]||0,translateY:t[5]||0}},Lt=function(t){return[1,0,0,1,t,arguments.length>1&&void 0!==arguments[1]?arguments[1]:0]};function jt(){let{angle:t=0}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},{x:e=0,y:s=0}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const i=At(t),n=ut(i),r=dt(i);return[n,r,-r,n,e?e-(n*e-r*s):0,s?s-(r*e+n*s):0]}const Nt=function(t){return[t,0,0,arguments.length>1&&void 0!==arguments[1]?arguments[1]:t,0,0]},Bt=t=>Math.tan(At(t)),Wt=t=>[1,0,Bt(t),1,0,0],Ut=t=>[1,Bt(t),0,1,0,0],Yt=t=>{let{scaleX:e=1,scaleY:s=1,flipX:i=!1,flipY:n=!1,skewX:r=0,skewY:o=0}=t,a=Nt(i?-e:e,n?-s:s);return r&&(a=It(a,Wt(r),!0)),o&&(a=It(a,Ut(o),!0)),a},Xt=t=>{const{translateX:e=0,translateY:s=0,angle:i=0}=t;let n=Lt(e,s);i&&(n=It(n,jt({angle:i})));const r=Yt(t);return Ot(r)||(n=It(n,r)),n},Vt=function(t){let{signal:e,crossOrigin:s=null}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return new Promise((function(i,n){if(e&&e.aborted)return n(new _("loadImage"));const r=xt();let o;e&&(o=function(t){r.src="",n(t)},e.addEventListener("abort",o,{once:!0}));const a=function(){r.onload=r.onerror=null,o&&(null==e||e.removeEventListener("abort",o)),i(r)};t?(r.onload=a,r.onerror=function(){o&&(null==e||e.removeEventListener("abort",o)),n(new m("Error loading ".concat(r.src)))},s&&(r.crossOrigin=s),r.src=t):a()}))},Gt=function(t){let{signal:e,reviver:s=E}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return new Promise(((i,n)=>{const r=[];e&&e.addEventListener("abort",n,{once:!0}),Promise.all(t.map((t=>at.getClass(t.type).fromObject(t,{signal:e}).then((e=>(s(t,e),r.push(e),e)))))).then(i).catch((t=>{r.forEach((t=>{t.dispose&&t.dispose()})),n(t)})).finally((()=>{e&&e.removeEventListener("abort",n)}))}))},Ht=function(t){let{signal:e}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return new Promise(((s,i)=>{const n=[];e&&e.addEventListener("abort",i,{once:!0});const r=Object.values(t).map((t=>t&&t.type&&at.has(t.type)?Gt([t],{signal:e}).then((t=>{let[e]=t;return n.push(e),e})):t)),o=Object.keys(t);Promise.all(r).then((t=>t.reduce(((t,e,s)=>(t[o[s]]=e,t)),{}))).then(s).catch((t=>{n.forEach((t=>{t.dispose&&t.dispose()})),i(t)})).finally((()=>{e&&e.removeEventListener("abort",i)}))}))},zt=function(t){return(arguments.length>1&&void 0!==arguments[1]?arguments[1]:[]).reduce(((e,s)=>(s in t&&(e[s]=t[s]),e)),{})},qt=(t,e)=>Object.keys(t).reduce(((s,i)=>(e(t[i],i,t)&&(s[i]=t[i]),s)),{}),Kt=(t,e)=>parseFloat(Number(t).toFixed(e)),Qt=t=>"matrix("+t.map((t=>Kt(t,p.NUM_FRACTION_DIGITS))).join(" ")+")",Jt=t=>!!t&&void 0!==t.toLive,Zt=t=>!!t&&"function"==typeof t.toObject,$t=t=>!!t&&void 0!==t.offsetX&&"source"in t,te=t=>!!t&&"multiSelectionStacking"in t;function ee(t){const e=t&&se(t);let s=0,i=0;if(!t||!e)return{left:s,top:i};let n=t;const r=e.documentElement,o=e.body||{scrollLeft:0,scrollTop:0};for(;n&&(n.parentNode||n.host)&&(n=n.parentNode||n.host,n===e?(s=o.scrollLeft||r.scrollLeft||0,i=o.scrollTop||r.scrollTop||0):(s+=n.scrollLeft||0,i+=n.scrollTop||0),1!==n.nodeType||"fixed"!==n.style.position););return{left:s,top:i}}const se=t=>t.ownerDocument||null,ie=t=>{var e;return(null===(e=t.ownerDocument)||void 0===e?void 0:e.defaultView)||null},ne=function(t,e,s){let{width:i,height:n}=s,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1;t.width=i,t.height=n,r>1&&(t.setAttribute("width",(i*r).toString()),t.setAttribute("height",(n*r).toString()),e.scale(r,r))},re=(t,e)=>{let{width:s,height:i}=e;s&&(t.style.width="number"==typeof s?"".concat(s,"px"):s),i&&(t.style.height="number"==typeof i?"".concat(i,"px"):i)};function oe(t){return void 0!==t.onselectstart&&(t.onselectstart=()=>!1),t.style.userSelect=W,t}class ae{constructor(t){h(this,"_originalCanvasStyle",void 0),h(this,"lower",void 0);const e=this.createLowerCanvas(t);this.lower={el:e,ctx:e.getContext("2d")}}createLowerCanvas(t){const e=(s=t)&&void 0!==s.getContext?t:t&&x().getElementById(t)||wt();var s;if(e.hasAttribute("data-fabric"))throw new m("Trying to initialize a canvas that has already been initialized. Did you forget to dispose the canvas?");return this._originalCanvasStyle=e.style.cssText,e.setAttribute("data-fabric","main"),e.classList.add("lower-canvas"),e}cleanupDOM(t){let{width:e,height:s}=t;const{el:i}=this.lower;i.classList.remove("lower-canvas"),i.removeAttribute("data-fabric"),i.setAttribute("width","".concat(e)),i.setAttribute("height","".concat(s)),i.style.cssText=this._originalCanvasStyle||"",this._originalCanvasStyle=void 0}setDimensions(t,e){const{el:s,ctx:i}=this.lower;ne(s,i,t,e)}setCSSDimensions(t){re(this.lower.el,t)}calcOffset(){return function(t){var e;const s=t&&se(t),i={left:0,top:0};if(!s)return i;const n=(null===(e=ie(t))||void 0===e?void 0:e.getComputedStyle(t,null))||{};i.left+=parseInt(n.borderLeftWidth,10)||0,i.top+=parseInt(n.borderTopWidth,10)||0,i.left+=parseInt(n.paddingLeft,10)||0,i.top+=parseInt(n.paddingTop,10)||0;let r={left:0,top:0};const o=s.documentElement;void 0!==t.getBoundingClientRect&&(r=t.getBoundingClientRect());const a=ee(t);return{left:r.left+a.left-(o.clientLeft||0)+i.left,top:r.top+a.top-(o.clientTop||0)+i.top}}(this.lower.el)}dispose(){w().dispose(this.lower.el),delete this.lower}}const he={backgroundVpt:!0,backgroundColor:"",overlayVpt:!0,overlayColor:"",includeDefaultValues:!0,svgViewportTransformation:!0,renderOnAddRemove:!0,skipOffscreen:!0,enableRetinaScaling:!0,imageSmoothingEnabled:!0,controlsAboveOverlay:!1,allowTouchScrolling:!1,viewportTransform:[...I]};class ce extends(mt(_t)){get lowerCanvasEl(){var t;return null===(t=this.elements.lower)||void 0===t?void 0:t.el}get contextContainer(){var t;return null===(t=this.elements.lower)||void 0===t?void 0:t.ctx}static getDefaults(){return ce.ownDefaults}constructor(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};super(),Object.assign(this,this.constructor.getDefaults()),this.set(e),this.initElements(t),this._setDimensionsImpl({width:this.width||this.elements.lower.el.width||0,height:this.height||this.elements.lower.el.height||0}),this.skipControlsDrawing=!1,this.viewportTransform=[...this.viewportTransform],this.calcViewportBoundaries()}initElements(t){this.elements=new ae(t)}add(){const t=super.add(...arguments);return arguments.length>0&&this.renderOnAddRemove&&this.requestRenderAll(),t}insertAt(t){for(var e=arguments.length,s=new Array(e>1?e-1:0),i=1;i<e;i++)s[i-1]=arguments[i];const n=super.insertAt(t,...s);return s.length>0&&this.renderOnAddRemove&&this.requestRenderAll(),n}remove(){const t=super.remove(...arguments);return t.length>0&&this.renderOnAddRemove&&this.requestRenderAll(),t}_onObjectAdded(t){t.canvas&&t.canvas!==this&&(f("warn","Canvas is trying to add an object that belongs to a different canvas.\nResulting to default behavior: removing object from previous canvas and adding to new canvas"),t.canvas.remove(t)),t._set("canvas",this),t.setCoords(),this.fire("object:added",{target:t}),t.fire("added",{target:this})}_onObjectRemoved(t){t._set("canvas",void 0),this.fire("object:removed",{target:t}),t.fire("removed",{target:this})}_onStackOrderChanged(){this.renderOnAddRemove&&this.requestRenderAll()}getRetinaScaling(){return this.enableRetinaScaling?T():1}calcOffset(){return this._offset=this.elements.calcOffset()}getWidth(){return this.width}getHeight(){return this.height}setWidth(t,e){return this.setDimensions({width:t},e)}setHeight(t,e){return this.setDimensions({height:t},e)}_setDimensionsImpl(t){let{cssOnly:e=!1,backstoreOnly:s=!1}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(!e){const e=l({width:this.width,height:this.height},t);this.elements.setDimensions(e,this.getRetinaScaling()),this.hasLostContext=!0,this.width=e.width,this.height=e.height}s||this.elements.setCSSDimensions(t),this.calcOffset()}setDimensions(t,e){this._setDimensionsImpl(t,e),e&&e.cssOnly||this.requestRenderAll()}getZoom(){return this.viewportTransform[0]}setViewportTransform(t){this.viewportTransform=t,this.calcViewportBoundaries(),this.renderOnAddRemove&&this.requestRenderAll()}zoomToPoint(t,e){const s=t,i=[...this.viewportTransform],n=Dt(t,Pt(i));i[0]=e,i[3]=e;const r=Dt(n,i);i[4]+=s.x-r.x,i[5]+=s.y-r.y,this.setViewportTransform(i)}setZoom(t){this.zoomToPoint(new gt(0,0),t)}absolutePan(t){const e=[...this.viewportTransform];return e[4]=-t.x,e[5]=-t.y,this.setViewportTransform(e)}relativePan(t){return this.absolutePan(new gt(-t.x-this.viewportTransform[4],-t.y-this.viewportTransform[5]))}getElement(){return this.elements.lower.el}clearContext(t){t.clearRect(0,0,this.width,this.height)}getContext(){return this.elements.lower.ctx}clear(){this.remove(...this.getObjects()),this.backgroundImage=void 0,this.overlayImage=void 0,this.backgroundColor="",this.overlayColor="",this.clearContext(this.getContext()),this.fire("canvas:cleared"),this.renderOnAddRemove&&this.requestRenderAll()}renderAll(){this.cancelRequestedRender(),this.destroyed||this.renderCanvas(this.getContext(),this._objects)}renderAndReset(){this.nextRenderHandle=0,this.renderAll()}requestRenderAll(){this.nextRenderHandle||this.disposed||this.destroyed||(this.nextRenderHandle=vt((()=>this.renderAndReset())))}calcViewportBoundaries(){const t=this.width,e=this.height,s=Pt(this.viewportTransform),i=Dt({x:0,y:0},s),n=Dt({x:t,y:e},s),r=i.min(n),o=i.max(n);return this.vptCoords={tl:r,tr:new gt(o.x,r.y),bl:new gt(r.x,o.y),br:o}}cancelRequestedRender(){this.nextRenderHandle&&(yt(this.nextRenderHandle),this.nextRenderHandle=0)}drawControls(t){}renderCanvas(t,e){if(this.destroyed)return;const s=this.viewportTransform,i=this.clipPath;this.calcViewportBoundaries(),this.clearContext(t),t.imageSmoothingEnabled=this.imageSmoothingEnabled,t.patternQuality="best",this.fire("before:render",{ctx:t}),this._renderBackground(t),t.save(),t.transform(s[0],s[1],s[2],s[3],s[4],s[5]),this._renderObjects(t,e),t.restore(),this.controlsAboveOverlay||this.skipControlsDrawing||this.drawControls(t),i&&(i._set("canvas",this),i.shouldCache(),i._transformDone=!0,i.renderCache({forClipping:!0}),this.drawClipPathOnCanvas(t,i)),this._renderOverlay(t),this.controlsAboveOverlay&&!this.skipControlsDrawing&&this.drawControls(t),this.fire("after:render",{ctx:t}),this.__cleanupTask&&(this.__cleanupTask(),this.__cleanupTask=void 0)}drawClipPathOnCanvas(t,e){const s=this.viewportTransform;t.save(),t.transform(...s),t.globalCompositeOperation="destination-in",e.transform(t),t.scale(1/e.zoomX,1/e.zoomY),t.drawImage(e._cacheCanvas,-e.cacheTranslationX,-e.cacheTranslationY),t.restore()}_renderObjects(t,e){for(let s=0,i=e.length;s<i;++s)e[s]&&e[s].render(t)}_renderBackgroundOrOverlay(t,e){const s=this["".concat(e,"Color")],i=this["".concat(e,"Image")],n=this.viewportTransform,r=this["".concat(e,"Vpt")];if(!s&&!i)return;const o=Jt(s);if(s){if(t.save(),t.beginPath(),t.moveTo(0,0),t.lineTo(this.width,0),t.lineTo(this.width,this.height),t.lineTo(0,this.height),t.closePath(),t.fillStyle=o?s.toLive(t):s,r&&t.transform(...n),o){t.transform(1,0,0,1,s.offsetX||0,s.offsetY||0);const e=s.gradientTransform||s.patternTransform;e&&t.transform(...e)}t.fill(),t.restore()}if(i){t.save();const{skipOffscreen:e}=this;this.skipOffscreen=r,r&&t.transform(...n),i.render(t),this.skipOffscreen=e,t.restore()}}_renderBackground(t){this._renderBackgroundOrOverlay(t,"background")}_renderOverlay(t){this._renderBackgroundOrOverlay(t,"overlay")}getCenter(){return{top:this.height/2,left:this.width/2}}getCenterPoint(){return new gt(this.width/2,this.height/2)}centerObjectH(t){return this._centerObject(t,new gt(this.getCenterPoint().x,t.getCenterPoint().y))}centerObjectV(t){return this._centerObject(t,new gt(t.getCenterPoint().x,this.getCenterPoint().y))}centerObject(t){return this._centerObject(t,this.getCenterPoint())}viewportCenterObject(t){return this._centerObject(t,this.getVpCenter())}viewportCenterObjectH(t){return this._centerObject(t,new gt(this.getVpCenter().x,t.getCenterPoint().y))}viewportCenterObjectV(t){return this._centerObject(t,new gt(t.getCenterPoint().x,this.getVpCenter().y))}getVpCenter(){return Dt(this.getCenterPoint(),Pt(this.viewportTransform))}_centerObject(t,e){t.setXY(e,F,F),t.setCoords(),this.renderOnAddRemove&&this.requestRenderAll()}toDatalessJSON(t){return this.toDatalessObject(t)}toObject(t){return this._toObjectMethod("toObject",t)}toJSON(){return this.toObject()}toDatalessObject(t){return this._toObjectMethod("toDatalessObject",t)}_toObjectMethod(t,e){const s=this.clipPath,i=s&&!s.excludeFromExport?this._toObject(s,t,e):null;return l(l(l({version:A},zt(this,e)),{},{objects:this._objects.filter((t=>!t.excludeFromExport)).map((s=>this._toObject(s,t,e)))},this.__serializeBgOverlay(t,e)),i?{clipPath:i}:null)}_toObject(t,e,s){let i;this.includeDefaultValues||(i=t.includeDefaultValues,t.includeDefaultValues=!1);const n=t[e](s);return this.includeDefaultValues||(t.includeDefaultValues=!!i),n}__serializeBgOverlay(t,e){const s={},i=this.backgroundImage,n=this.overlayImage,r=this.backgroundColor,o=this.overlayColor;return Jt(r)?r.excludeFromExport||(s.background=r.toObject(e)):r&&(s.background=r),Jt(o)?o.excludeFromExport||(s.overlay=o.toObject(e)):o&&(s.overlay=o),i&&!i.excludeFromExport&&(s.backgroundImage=this._toObject(i,t,e)),n&&!n.excludeFromExport&&(s.overlayImage=this._toObject(n,t,e)),s}toSVG(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},e=arguments.length>1?arguments[1]:void 0;t.reviver=e;const s=[];return this._setSVGPreamble(s,t),this._setSVGHeader(s,t),this.clipPath&&s.push('<g clip-path="url(#'.concat(this.clipPath.clipPathId,')" >\n')),this._setSVGBgOverlayColor(s,"background"),this._setSVGBgOverlayImage(s,"backgroundImage",e),this._setSVGObjects(s,e),this.clipPath&&s.push("</g>\n"),this._setSVGBgOverlayColor(s,"overlay"),this._setSVGBgOverlayImage(s,"overlayImage",e),s.push("</svg>"),s.join("")}_setSVGPreamble(t,e){e.suppressPreamble||t.push('<?xml version="1.0" encoding="',e.encoding||"UTF-8",'" standalone="no" ?>\n','<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN" ','"http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">\n')}_setSVGHeader(t,e){const s=e.width||"".concat(this.width),i=e.height||"".concat(this.height),n=p.NUM_FRACTION_DIGITS,r=e.viewBox;let o;if(r)o='viewBox="'.concat(r.x," ").concat(r.y," ").concat(r.width," ").concat(r.height,'" ');else if(this.svgViewportTransformation){const t=this.viewportTransform;o='viewBox="'.concat(Kt(-t[4]/t[0],n)," ").concat(Kt(-t[5]/t[3],n)," ").concat(Kt(this.width/t[0],n)," ").concat(Kt(this.height/t[3],n),'" ')}else o='viewBox="0 0 '.concat(this.width," ").concat(this.height,'" ');t.push("<svg ",'xmlns="http://www.w3.org/2000/svg" ','xmlns:xlink="http://www.w3.org/1999/xlink" ','version="1.1" ','width="',s,'" ','height="',i,'" ',o,'xml:space="preserve">\n',"<desc>Created with Fabric.js ",A,"</desc>\n","<defs>\n",this.createSVGFontFacesMarkup(),this.createSVGRefElementsMarkup(),this.createSVGClipPathMarkup(e),"</defs>\n")}createSVGClipPathMarkup(t){const e=this.clipPath;return e?(e.clipPathId="CLIPPATH_".concat(bt()),'<clipPath id="'.concat(e.clipPathId,'" >\n').concat(e.toClipPathSVG(t.reviver),"</clipPath>\n")):""}createSVGRefElementsMarkup(){return["background","overlay"].map((t=>{const e=this["".concat(t,"Color")];if(Jt(e)){const s=this["".concat(t,"Vpt")],i=this.viewportTransform,n={isType:()=>!1,width:this.width/(s?i[0]:1),height:this.height/(s?i[3]:1)};return e.toSVG(n,{additionalTransform:s?Qt(i):""})}})).join("")}createSVGFontFacesMarkup(){const t=[],e={},s=p.fontPaths;this._objects.forEach((function e(s){t.push(s),ft(s)&&s._objects.forEach(e)})),t.forEach((t=>{if(!(i=t)||"function"!=typeof i._renderText)return;var i;const{styles:n,fontFamily:r}=t;!e[r]&&s[r]&&(e[r]=!0,n&&Object.values(n).forEach((t=>{Object.values(t).forEach((t=>{let{fontFamily:i=""}=t;!e[i]&&s[i]&&(e[i]=!0)}))})))}));const i=Object.keys(e).map((t=>"\t\t@font-face {\n\t\t\tfont-family: '".concat(t,"';\n\t\t\tsrc: url('").concat(s[t],"');\n\t\t}\n"))).join("");return i?'\t<style type="text/css"><![CDATA[\n'.concat(i,"]]></style>\n"):""}_setSVGObjects(t,e){this.forEachObject((s=>{s.excludeFromExport||this._setSVGObject(t,s,e)}))}_setSVGObject(t,e,s){t.push(e.toSVG(s))}_setSVGBgOverlayImage(t,e,s){const i=this[e];i&&!i.excludeFromExport&&i.toSVG&&t.push(i.toSVG(s))}_setSVGBgOverlayColor(t,e){const s=this["".concat(e,"Color")];if(s)if(Jt(s)){const i=s.repeat||"",n=this.width,r=this.height,o=this["".concat(e,"Vpt")]?Qt(Pt(this.viewportTransform)):"";t.push('<rect transform="'.concat(o," translate(").concat(n/2,",").concat(r/2,')" x="').concat(s.offsetX-n/2,'" y="').concat(s.offsetY-r/2,'" width="').concat("repeat-y"!==i&&"no-repeat"!==i||!$t(s)?n:s.source.width,'" height="').concat("repeat-x"!==i&&"no-repeat"!==i||!$t(s)?r:s.source.height,'" fill="url(#SVGID_').concat(s.id,')"></rect>\n'))}else t.push('<rect x="0" y="0" width="100%" height="100%" ','fill="',s,'"',"></rect>\n")}loadFromJSON(t,e){let{signal:s}=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};if(!t)return Promise.reject(new m("`json` is undefined"));const i="string"==typeof t?JSON.parse(t):t,{objects:n=[],backgroundImage:r,background:o,overlayImage:a,overlay:h,clipPath:c}=i,l=this.renderOnAddRemove;return this.renderOnAddRemove=!1,Promise.all([Gt(n,{reviver:e,signal:s}),Ht({backgroundImage:r,backgroundColor:o,overlayImage:a,overlayColor:h,clipPath:c},{signal:s})]).then((t=>{let[e,s]=t;return this.clear(),this.add(...e),this.set(i),this.set(s),this.renderOnAddRemove=l,this}))}clone(t){const e=this.toObject(t);return this.cloneWithoutData().loadFromJSON(e)}cloneWithoutData(){const t=St(this);return new this.constructor(t)}toDataURL(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};const{format:e="png",quality:s=1,multiplier:i=1,enableRetinaScaling:n=!1}=t,r=i*(n?this.getRetinaScaling():1);return Tt(this.toCanvasElement(r,t),e,s)}toBlob(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};const{format:e="png",quality:s=1,multiplier:i=1,enableRetinaScaling:n=!1}=t,r=i*(n?this.getRetinaScaling():1);return kt(this.toCanvasElement(r,t),e,s)}toCanvasElement(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,{width:e,height:s,left:i,top:n,filter:r}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const o=(e||this.width)*t,a=(s||this.height)*t,h=this.getZoom(),c=this.width,l=this.height,u=this.skipControlsDrawing,d=h*t,g=this.viewportTransform,p=[d,0,0,d,(g[4]-(i||0))*t,(g[5]-(n||0))*t],f=this.enableRetinaScaling,m=St({width:o,height:a}),_=r?this._objects.filter((t=>r(t))):this._objects;return this.enableRetinaScaling=!1,this.viewportTransform=p,this.width=o,this.height=a,this.skipControlsDrawing=!0,this.calcViewportBoundaries(),this.renderCanvas(m.getContext("2d"),_),this.viewportTransform=g,this.width=c,this.height=l,this.calcViewportBoundaries(),this.enableRetinaScaling=f,this.skipControlsDrawing=u,m}dispose(){return!this.disposed&&this.elements.cleanupDOM({width:this.width,height:this.height}),ht.cancelByCanvas(this),this.disposed=!0,new Promise(((t,e)=>{const s=()=>{this.destroy(),t(!0)};s.kill=e,this.__cleanupTask&&this.__cleanupTask.kill("aborted"),this.destroyed?t(!1):this.nextRenderHandle?this.__cleanupTask=s:s()}))}destroy(){this.destroyed=!0,this.cancelRequestedRender(),this.forEachObject((t=>t.dispose())),this._objects=[],this.backgroundImage&&this.backgroundImage.dispose(),this.backgroundImage=void 0,this.overlayImage&&this.overlayImage.dispose(),this.overlayImage=void 0,this.elements.dispose()}toString(){return"#<Canvas (".concat(this.complexity(),"): { objects: ").concat(this._objects.length," }>")}}h(ce,"ownDefaults",he);const le=["touchstart","touchmove","touchend"],ue=t=>{const e=ee(t.target),s=function(t){const e=t.changedTouches;return e&&e[0]?e[0]:t}(t);return new gt(s.clientX+e.left,s.clientY+e.top)},de=t=>le.includes(t.type)||"touch"===t.pointerType,ge=t=>{t.preventDefault(),t.stopPropagation()},pe=t=>{let e=0,s=0,i=0,n=0;for(let r=0,o=t.length;r<o;r++){const{x:o,y:a}=t[r];(o>i||!r)&&(i=o),(o<e||!r)&&(e=o),(a>n||!r)&&(n=a),(a<s||!r)&&(s=a)}return{left:e,top:s,width:i-e,height:n-s}},fe=["translateX","translateY","scaleX","scaleY"],me=(t,e)=>_e(t,It(e,t.calcOwnMatrix())),_e=(t,e)=>{const s=Ft(e),{translateX:i,translateY:n,scaleX:r,scaleY:o}=s,a=u(s,fe),h=new gt(i,n);t.flipX=!1,t.flipY=!1,Object.assign(t,a),t.set({scaleX:r,scaleY:o}),t.setPositionByOrigin(h,F,F)},ve=t=>{t.scaleX=1,t.scaleY=1,t.skewX=0,t.skewY=0,t.flipX=!1,t.flipY=!1,t.rotate(0)},ye=t=>({scaleX:t.scaleX,scaleY:t.scaleY,skewX:t.skewX,skewY:t.skewY,angle:t.angle,left:t.left,flipX:t.flipX,flipY:t.flipY,top:t.top}),Ce=(t,e,s)=>{const i=t/2,n=e/2,r=[new gt(-i,-n),new gt(i,-n),new gt(-i,n),new gt(i,n)].map((t=>t.transform(s))),o=pe(r);return new gt(o.width,o.height)},be=function(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:I;return It(Pt(arguments.length>1&&void 0!==arguments[1]?arguments[1]:I),t)},we=function(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:I,s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:I;return t.transform(be(e,s))},xe=function(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:I,s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:I;return t.transform(be(e,s),!0)},Se=(t,e,s)=>{const i=be(e,s);return _e(t,It(i,t.calcOwnMatrix())),i},Te=(t,e)=>{var s;const{transform:{target:i}}=e;null===(s=i.canvas)||void 0===s||s.fire("object:".concat(t),l(l({},e),{},{target:i})),i.fire(t,e)},ke={left:-.5,top:-.5,center:0,bottom:.5,right:.5},Ae=t=>"string"==typeof t?ke[t]:t-.5,Ee="not-allowed";function Oe(t){return Ae(t.originX)===Ae(F)&&Ae(t.originY)===Ae(F)}function De(t){return.5-Ae(t)}const Pe=(t,e)=>t[e],Ie=(t,e,s,i)=>({e:t,transform:e,pointer:new gt(s,i)});function Me(t,e){const s=t.getTotalAngle()+Et(Math.atan2(e.y,e.x))+360;return Math.round(s%360/45)}function Re(t,e,s,i,n){var r;let{target:o,corner:a}=t;const h=o.controls[a],c=(null===(r=o.canvas)||void 0===r?void 0:r.getZoom())||1,l=o.padding/c,u=function(t,e,s,i){const n=t.getRelativeCenterPoint(),r=void 0!==s&&void 0!==i?t.translateToGivenOrigin(n,F,F,s,i):new gt(t.left,t.top);return(t.angle?e.rotate(-At(t.angle),n):e).subtract(r)}(o,new gt(i,n),e,s);return u.x>=l&&(u.x-=l),u.x<=-l&&(u.x+=l),u.y>=l&&(u.y-=l),u.y<=l&&(u.y+=l),u.x-=h.offsetX,u.y-=h.offsetY,u}const Fe=(t,e,s,i)=>{const{target:n,offsetX:r,offsetY:o}=e,a=s-r,h=i-o,c=!Pe(n,"lockMovementX")&&n.left!==a,l=!Pe(n,"lockMovementY")&&n.top!==h;return c&&n.set(L,a),l&&n.set(j,h),(c||l)&&Te(Y,Ie(t,e,s,i)),c||l},Le={aliceblue:"#F0F8FF",antiquewhite:"#FAEBD7",aqua:"#0FF",aquamarine:"#7FFFD4",azure:"#F0FFFF",beige:"#F5F5DC",bisque:"#FFE4C4",black:"#000",blanchedalmond:"#FFEBCD",blue:"#00F",blueviolet:"#8A2BE2",brown:"#A52A2A",burlywood:"#DEB887",cadetblue:"#5F9EA0",chartreuse:"#7FFF00",chocolate:"#D2691E",coral:"#FF7F50",cornflowerblue:"#6495ED",cornsilk:"#FFF8DC",crimson:"#DC143C",cyan:"#0FF",darkblue:"#00008B",darkcyan:"#008B8B",darkgoldenrod:"#B8860B",darkgray:"#A9A9A9",darkgrey:"#A9A9A9",darkgreen:"#006400",darkkhaki:"#BDB76B",darkmagenta:"#8B008B",darkolivegreen:"#556B2F",darkorange:"#FF8C00",darkorchid:"#9932CC",darkred:"#8B0000",darksalmon:"#E9967A",darkseagreen:"#8FBC8F",darkslateblue:"#483D8B",darkslategray:"#2F4F4F",darkslategrey:"#2F4F4F",darkturquoise:"#00CED1",darkviolet:"#9400D3",deeppink:"#FF1493",deepskyblue:"#00BFFF",dimgray:"#696969",dimgrey:"#696969",dodgerblue:"#1E90FF",firebrick:"#B22222",floralwhite:"#FFFAF0",forestgreen:"#228B22",fuchsia:"#F0F",gainsboro:"#DCDCDC",ghostwhite:"#F8F8FF",gold:"#FFD700",goldenrod:"#DAA520",gray:"#808080",grey:"#808080",green:"#008000",greenyellow:"#ADFF2F",honeydew:"#F0FFF0",hotpink:"#FF69B4",indianred:"#CD5C5C",indigo:"#4B0082",ivory:"#FFFFF0",khaki:"#F0E68C",lavender:"#E6E6FA",lavenderblush:"#FFF0F5",lawngreen:"#7CFC00",lemonchiffon:"#FFFACD",lightblue:"#ADD8E6",lightcoral:"#F08080",lightcyan:"#E0FFFF",lightgoldenrodyellow:"#FAFAD2",lightgray:"#D3D3D3",lightgrey:"#D3D3D3",lightgreen:"#90EE90",lightpink:"#FFB6C1",lightsalmon:"#FFA07A",lightseagreen:"#20B2AA",lightskyblue:"#87CEFA",lightslategray:"#789",lightslategrey:"#789",lightsteelblue:"#B0C4DE",lightyellow:"#FFFFE0",lime:"#0F0",limegreen:"#32CD32",linen:"#FAF0E6",magenta:"#F0F",maroon:"#800000",mediumaquamarine:"#66CDAA",mediumblue:"#0000CD",mediumorchid:"#BA55D3",mediumpurple:"#9370DB",mediumseagreen:"#3CB371",mediumslateblue:"#7B68EE",mediumspringgreen:"#00FA9A",mediumturquoise:"#48D1CC",mediumvioletred:"#C71585",midnightblue:"#191970",mintcream:"#F5FFFA",mistyrose:"#FFE4E1",moccasin:"#FFE4B5",navajowhite:"#FFDEAD",navy:"#000080",oldlace:"#FDF5E6",olive:"#808000",olivedrab:"#6B8E23",orange:"#FFA500",orangered:"#FF4500",orchid:"#DA70D6",palegoldenrod:"#EEE8AA",palegreen:"#98FB98",paleturquoise:"#AFEEEE",palevioletred:"#DB7093",papayawhip:"#FFEFD5",peachpuff:"#FFDAB9",peru:"#CD853F",pink:"#FFC0CB",plum:"#DDA0DD",powderblue:"#B0E0E6",purple:"#800080",rebeccapurple:"#639",red:"#F00",rosybrown:"#BC8F8F",royalblue:"#4169E1",saddlebrown:"#8B4513",salmon:"#FA8072",sandybrown:"#F4A460",seagreen:"#2E8B57",seashell:"#FFF5EE",sienna:"#A0522D",silver:"#C0C0C0",skyblue:"#87CEEB",slateblue:"#6A5ACD",slategray:"#708090",slategrey:"#708090",snow:"#FFFAFA",springgreen:"#00FF7F",steelblue:"#4682B4",tan:"#D2B48C",teal:"#008080",thistle:"#D8BFD8",tomato:"#FF6347",turquoise:"#40E0D0",violet:"#EE82EE",wheat:"#F5DEB3",white:"#FFF",whitesmoke:"#F5F5F5",yellow:"#FF0",yellowgreen:"#9ACD32"},je=(t,e,s)=>(s<0&&(s+=1),s>1&&(s-=1),s<1/6?t+6*(e-t)*s:s<.5?e:s<2/3?t+(e-t)*(2/3-s)*6:t),Ne=(t,e,s,i)=>{t/=255,e/=255,s/=255;const n=Math.max(t,e,s),r=Math.min(t,e,s);let o,a;const h=(n+r)/2;if(n===r)o=a=0;else{const i=n-r;switch(a=h>.5?i/(2-n-r):i/(n+r),n){case t:o=(e-s)/i+(e<s?6:0);break;case e:o=(s-t)/i+2;break;case s:o=(t-e)/i+4}o/=6}return[Math.round(360*o),Math.round(100*a),Math.round(100*h),i]},Be=function(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"1";return parseFloat(t)/(t.endsWith("%")?100:1)},We=t=>Math.min(Math.round(t),255).toString(16).toUpperCase().padStart(2,"0"),Ue=t=>{let[e,s,i,n=1]=t;const r=Math.round(.3*e+.59*s+.11*i);return[r,r,r,n]};class Ye{constructor(t){if(h(this,"isUnrecognised",!1),t)if(t instanceof Ye)this.setSource([...t._source]);else if(Array.isArray(t)){const[e,s,i,n=1]=t;this.setSource([e,s,i,n])}else this.setSource(this._tryParsingColor(t));else this.setSource([0,0,0,1])}_tryParsingColor(t){return(t=t.toLowerCase())in Le&&(t=Le[t]),"transparent"===t?[255,255,255,0]:Ye.sourceFromHex(t)||Ye.sourceFromRgb(t)||Ye.sourceFromHsl(t)||(this.isUnrecognised=!0)&&[0,0,0,1]}getSource(){return this._source}setSource(t){this._source=t}toRgb(){const[t,e,s]=this.getSource();return"rgb(".concat(t,",").concat(e,",").concat(s,")")}toRgba(){return"rgba(".concat(this.getSource().join(","),")")}toHsl(){const[t,e,s]=Ne(...this.getSource());return"hsl(".concat(t,",").concat(e,"%,").concat(s,"%)")}toHsla(){const[t,e,s,i]=Ne(...this.getSource());return"hsla(".concat(t,",").concat(e,"%,").concat(s,"%,").concat(i,")")}toHex(){return this.toHexa().slice(0,6)}toHexa(){const[t,e,s,i]=this.getSource();return"".concat(We(t)).concat(We(e)).concat(We(s)).concat(We(Math.round(255*i)))}getAlpha(){return this.getSource()[3]}setAlpha(t){return this._source[3]=t,this}toGrayscale(){return this.setSource(Ue(this.getSource())),this}toBlackWhite(t){const[e,,,s]=Ue(this.getSource()),i=e<(t||127)?0:255;return this.setSource([i,i,i,s]),this}overlayWith(t){t instanceof Ye||(t=new Ye(t));const e=this.getSource(),s=t.getSource(),[i,n,r]=e.map(((t,e)=>Math.round(.5*t+.5*s[e])));return this.setSource([i,n,r,e[3]]),this}static fromRgb(t){return Ye.fromRgba(t)}static fromRgba(t){return new Ye(Ye.sourceFromRgb(t))}static sourceFromRgb(t){const e=t.match(/^rgba?\(\s*(\d{0,3}(?:\.\d+)?%?)\s*[\s|,]\s*(\d{0,3}(?:\.\d+)?%?)\s*[\s|,]\s*(\d{0,3}(?:\.\d+)?%?)\s*(?:\s*[,/]\s*(\d{0,3}(?:\.\d+)?%?)\s*)?\)$/i);if(e){const[t,s,i]=e.slice(1,4).map((t=>{const e=parseFloat(t);return t.endsWith("%")?Math.round(2.55*e):e}));return[t,s,i,Be(e[4])]}}static fromHsl(t){return Ye.fromHsla(t)}static fromHsla(t){return new Ye(Ye.sourceFromHsl(t))}static sourceFromHsl(t){const e=t.match(/^hsla?\(\s*([+-]?\d{0,3}(?:\.\d+)?(?:deg|turn|rad)?)\s*[\s|,]\s*(\d{0,3}(?:\.\d+)?%?)\s*[\s|,]\s*(\d{0,3}(?:\.\d+)?%?)\s*(?:\s*[,/]\s*(\d*(?:\.\d+)?%?)\s*)?\)$/i);if(!e)return;const s=(Ye.parseAngletoDegrees(e[1])%360+360)%360/360,i=parseFloat(e[2])/100,n=parseFloat(e[3])/100;let r,o,a;if(0===i)r=o=a=n;else{const t=n<=.5?n*(i+1):n+i-n*i,e=2*n-t;r=je(e,t,s+1/3),o=je(e,t,s),a=je(e,t,s-1/3)}return[Math.round(255*r),Math.round(255*o),Math.round(255*a),Be(e[4])]}static fromHex(t){return new Ye(Ye.sourceFromHex(t))}static sourceFromHex(t){if(t.match(/^#?(([0-9a-f]){3,4}|([0-9a-f]{2}){3,4})$/i)){const e=t.slice(t.indexOf("#")+1);let s;s=e.length<=4?e.split("").map((t=>t+t)):e.match(/.{2}/g);const[i,n,r,o=255]=s.map((t=>parseInt(t,16)));return[i,n,r,o/255]}}static parseAngletoDegrees(t){const e=t.toLowerCase(),s=parseFloat(e);return e.includes("rad")?Et(s):e.includes("turn")?360*s:s}}const Xe=function(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:M;const s=/\D{0,2}$/.exec(t),i=parseFloat(t),n=p.DPI;switch(null==s?void 0:s[0]){case"mm":return i*n/25.4;case"cm":return i*n/2.54;case"in":return i*n;case"pt":return i*n/72;case"pc":return i*n/72*12;case"em":return i*e;default:return i}},Ve=t=>{const[e,s]=t.trim().split(" "),[i,n]=(r=e)&&r!==W?[r.slice(1,4),r.slice(5,8)]:r===W?[r,r]:["Mid","Mid"];var r;return{meetOrSlice:s||"meet",alignX:i,alignY:n}},Ge=function(t,e){let s,i,n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];if(e)if(e.toLive)s="url(#SVGID_".concat(e.id,")");else{const t=new Ye(e),n=t.getAlpha();s=t.toRgb(),1!==n&&(i=n.toString())}else s="none";return n?"".concat(t,": ").concat(s,"; ").concat(i?"".concat(t,"-opacity: ").concat(i,"; "):""):"".concat(t,'="').concat(s,'" ').concat(i?"".concat(t,'-opacity="').concat(i,'" '):"")};class He{getSvgStyles(t){const e=this.fillRule?this.fillRule:"nonzero",s=this.strokeWidth?this.strokeWidth:"0",i=this.strokeDashArray?this.strokeDashArray.join(" "):W,n=this.strokeDashOffset?this.strokeDashOffset:"0",r=this.strokeLineCap?this.strokeLineCap:"butt",o=this.strokeLineJoin?this.strokeLineJoin:"miter",a=this.strokeMiterLimit?this.strokeMiterLimit:"4",h=void 0!==this.opacity?this.opacity:"1",c=this.visible?"":" visibility: hidden;",l=t?"":this.getSvgFilter(),u=Ge(st,this.fill);return[Ge(it,this.stroke),"stroke-width: ",s,"; ","stroke-dasharray: ",i,"; ","stroke-linecap: ",r,"; ","stroke-dashoffset: ",n,"; ","stroke-linejoin: ",o,"; ","stroke-miterlimit: ",a,"; ",u,"fill-rule: ",e,"; ","opacity: ",h,";",l,c].join("")}getSvgFilter(){return this.shadow?"filter: url(#SVGID_".concat(this.shadow.id,");"):""}getSvgCommons(){return[this.id?'id="'.concat(this.id,'" '):"",this.clipPath?'clip-path="url(#'.concat(this.clipPath.clipPathId,')" '):""].join("")}getSvgTransform(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";const s=t?this.calcTransformMatrix():this.calcOwnMatrix(),i='transform="'.concat(Qt(s));return"".concat(i).concat(e,'" ')}_toSVG(t){return[""]}toSVG(t){return this._createBaseSVGMarkup(this._toSVG(t),{reviver:t})}toClipPathSVG(t){return"\t"+this._createBaseClipPathSVGMarkup(this._toSVG(t),{reviver:t})}_createBaseClipPathSVGMarkup(t){let{reviver:e,additionalTransform:s=""}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const i=[this.getSvgTransform(!0,s),this.getSvgCommons()].join(""),n=t.indexOf("COMMON_PARTS");return t[n]=i,e?e(t.join("")):t.join("")}_createBaseSVGMarkup(t){let{noStyle:e,reviver:s,withShadow:i,additionalTransform:n}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const r=e?"":'style="'.concat(this.getSvgStyles(),'" '),o=i?'style="'.concat(this.getSvgFilter(),'" '):"",a=this.clipPath,h=this.strokeUniform?'vector-effect="non-scaling-stroke" ':"",c=a&&a.absolutePositioned,l=this.stroke,u=this.fill,d=this.shadow,g=[],p=t.indexOf("COMMON_PARTS");let f;a&&(a.clipPathId="CLIPPATH_".concat(bt()),f='<clipPath id="'.concat(a.clipPathId,'" >\n').concat(a.toClipPathSVG(s),"</clipPath>\n")),c&&g.push("<g ",o,this.getSvgCommons()," >\n"),g.push("<g ",this.getSvgTransform(!1),c?"":o+this.getSvgCommons()," >\n");const m=[r,h,e?"":this.addPaintOrder()," ",n?'transform="'.concat(n,'" '):""].join("");return t[p]=m,Jt(u)&&g.push(u.toSVG(this)),Jt(l)&&g.push(l.toSVG(this)),d&&g.push(d.toSVG(this)),a&&g.push(f),g.push(t.join("")),g.push("</g>\n"),c&&g.push("</g>\n"),s?s(g.join("")):g.join("")}addPaintOrder(){return this.paintFirst!==st?' paint-order="'.concat(this.paintFirst,'" '):""}}function ze(t){return new RegExp("^("+t.join("|")+")\\b","i")}const qe="textDecorationThickness",Ke=["fontSize","fontWeight","fontFamily","fontStyle"],Qe=["underline","overline","linethrough"],Je=[...Ke,"lineHeight","text","charSpacing","textAlign","styles","path","pathStartOffset","pathSide","pathAlign"],Ze=[...Je,...Qe,"textBackgroundColor","direction",qe],$e=[...Ke,...Qe,it,"strokeWidth",st,"deltaY","textBackgroundColor",qe],ts={_reNewline:U,_reSpacesAndTabs:/[ \t\r]/g,_reSpaceAndTab:/[ \t\r]/,_reWords:/\S+/g,fontSize:40,fontWeight:"normal",fontFamily:"Times New Roman",underline:!1,overline:!1,linethrough:!1,textAlign:L,fontStyle:"normal",lineHeight:1.16,textBackgroundColor:"",stroke:null,shadow:null,path:void 0,pathStartOffset:0,pathSide:L,pathAlign:"baseline",charSpacing:0,deltaY:0,direction:"ltr",CACHE_FONT_SIZE:400,MIN_TEXT_WIDTH:2,superscript:{size:.6,baseline:-.35},subscript:{size:.6,baseline:.11},_fontSizeFraction:.222,offsets:{underline:.1,linethrough:-.28167,overline:-.81333},_fontSizeMult:1.13,[qe]:66.667},es="justify",ss="justify-left",is="justify-right",ns="justify-center";var rs,os,as;const hs=String.raw(rs||(rs=d(["[-+]?(?:d*.d+|d+.?)(?:[eE][-+]?d+)?"],["[-+]?(?:\\d*\\.\\d+|\\d+\\.?)(?:[eE][-+]?\\d+)?"]))),cs=String.raw(os||(os=d(["(?:s*,?s+|s*,s*)"],["(?:\\s*,?\\s+|\\s*,\\s*)"]))),ls="http://www.w3.org/2000/svg",us=new RegExp("(normal|italic)?\\s*(normal|small-caps)?\\s*(normal|bold|bolder|lighter|100|200|300|400|500|600|700|800|900)?\\s*("+hs+"(?:px|cm|mm|em|pt|pc|in)*)(?:\\/(normal|"+hs+"))?\\s+(.*)"),ds={cx:L,x:L,r:"radius",cy:j,y:j,display:"visible",visibility:"visible",transform:"transformMatrix","fill-opacity":"fillOpacity","fill-rule":"fillRule","font-family":"fontFamily","font-size":"fontSize","font-style":"fontStyle","font-weight":"fontWeight","letter-spacing":"charSpacing","paint-order":"paintFirst","stroke-dasharray":"strokeDashArray","stroke-dashoffset":"strokeDashOffset","stroke-linecap":"strokeLineCap","stroke-linejoin":"strokeLineJoin","stroke-miterlimit":"strokeMiterLimit","stroke-opacity":"strokeOpacity","stroke-width":"strokeWidth","text-decoration":"textDecoration","text-anchor":"textAnchor",opacity:"opacity","clip-path":"clipPath","clip-rule":"clipRule","vector-effect":"strokeUniform","image-rendering":"imageSmoothing","text-decoration-thickness":qe},gs="font-size",ps="clip-path",fs=ze(["path","circle","polygon","polyline","ellipse","rect","line","image","text"]),ms=ze(["symbol","image","marker","pattern","view","svg"]),_s=ze(["symbol","g","a","svg","clipPath","defs"]),vs=new RegExp(String.raw(as||(as=d(["^s*(",")","(",")","(",")","(",")s*$"],["^\\s*(",")","(",")","(",")","(",")\\s*$"])),hs,cs,hs,cs,hs,cs,hs)),ys=new gt(1,0),Cs=new gt,bs=(t,e)=>t.rotate(e),ws=(t,e)=>new gt(e).subtract(t),xs=t=>t.distanceFrom(Cs),Ss=(t,e)=>Math.atan2(Es(t,e),Os(t,e)),Ts=t=>Ss(ys,t),ks=t=>t.eq(Cs)?t:t.scalarDivide(xs(t)),As=function(t){let e=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];return ks(new gt(-t.y,t.x).scalarMultiply(e?1:-1))},Es=(t,e)=>t.x*e.y-t.y*e.x,Os=(t,e)=>t.x*e.x+t.y*e.y,Ds=(t,e,s)=>{if(t.eq(e)||t.eq(s))return!0;const i=Es(e,s),n=Es(e,t),r=Es(s,t);return i>=0?n>=0&&r<=0:!(n<=0&&r>=0)},Ps="(-?\\d+(?:\\.\\d*)?(?:px)?(?:\\s?|$))?",Is=new RegExp("(?:\\s|^)"+Ps+Ps+"("+hs+"?(?:px)?)?(?:\\s?|$)(?:$|\\s)");class Ms{constructor(t){const e="string"==typeof t?Ms.parseShadow(t):t;Object.assign(this,Ms.ownDefaults,e),this.id=bt()}static parseShadow(t){const e=t.trim(),[,s=0,i=0,n=0]=(Is.exec(e)||[]).map((t=>parseFloat(t)||0));return{color:(e.replace(Is,"")||"rgb(0,0,0)").trim(),offsetX:s,offsetY:i,blur:n}}toString(){return[this.offsetX,this.offsetY,this.blur,this.color].join("px ")}toSVG(t){const e=bs(new gt(this.offsetX,this.offsetY),At(-t.angle)),s=new Ye(this.color);let i=40,n=40;return t.width&&t.height&&(i=100*Kt((Math.abs(e.x)+this.blur)/t.width,p.NUM_FRACTION_DIGITS)+20,n=100*Kt((Math.abs(e.y)+this.blur)/t.height,p.NUM_FRACTION_DIGITS)+20),t.flipX&&(e.x*=-1),t.flipY&&(e.y*=-1),'<filter id="SVGID_'.concat(this.id,'" y="-').concat(n,'%" height="').concat(100+2*n,'%" x="-').concat(i,'%" width="').concat(100+2*i,'%" >\n\t<feGaussianBlur in="SourceAlpha" stdDeviation="').concat(Kt(this.blur?this.blur/2:0,p.NUM_FRACTION_DIGITS),'"></feGaussianBlur>\n\t<feOffset dx="').concat(Kt(e.x,p.NUM_FRACTION_DIGITS),'" dy="').concat(Kt(e.y,p.NUM_FRACTION_DIGITS),'" result="oBlur" ></feOffset>\n\t<feFlood flood-color="').concat(s.toRgb(),'" flood-opacity="').concat(s.getAlpha(),'"/>\n\t<feComposite in2="oBlur" operator="in" />\n\t<feMerge>\n\t\t<feMergeNode></feMergeNode>\n\t\t<feMergeNode in="SourceGraphic"></feMergeNode>\n\t</feMerge>\n</filter>\n')}toObject(){const t={color:this.color,blur:this.blur,offsetX:this.offsetX,offsetY:this.offsetY,affectStroke:this.affectStroke,nonScaling:this.nonScaling,type:this.constructor.type},e=Ms.ownDefaults;return this.includeDefaultValues?t:qt(t,((t,s)=>t!==e[s]))}static async fromObject(t){return new this(t)}}h(Ms,"ownDefaults",{color:"rgb(0,0,0)",blur:0,offsetX:0,offsetY:0,affectStroke:!1,includeDefaultValues:!0,nonScaling:!1}),h(Ms,"type","shadow"),at.setClass(Ms,"shadow");const Rs=(t,e,s)=>Math.max(t,Math.min(e,s)),Fs=[j,L,Z,$,"flipX","flipY","originX","originY","angle","opacity","globalCompositeOperation","shadow","visible",tt,et],Ls=[st,it,"strokeWidth","strokeDashArray","width","height","paintFirst","strokeUniform","strokeLineCap","strokeDashOffset","strokeLineJoin","strokeMiterLimit","backgroundColor","clipPath"],js={top:0,left:0,width:0,height:0,angle:0,flipX:!1,flipY:!1,scaleX:1,scaleY:1,minScaleLimit:0,skewX:0,skewY:0,originX:L,originY:j,strokeWidth:1,strokeUniform:!1,padding:0,opacity:1,paintFirst:st,fill:"rgb(0,0,0)",fillRule:"nonzero",stroke:null,strokeDashArray:null,strokeDashOffset:0,strokeLineCap:"butt",strokeLineJoin:"miter",strokeMiterLimit:4,globalCompositeOperation:"source-over",backgroundColor:"",shadow:null,visible:!0,includeDefaultValues:!0,excludeFromExport:!1,objectCaching:!0,clipPath:void 0,inverted:!1,absolutePositioned:!1,centeredRotation:!0,centeredScaling:!1,dirty:!0},Ns=(t,e,s,i)=>(t<Math.abs(e)?(t=e,i=s/4):i=0===e&&0===t?s/D*Math.asin(1):s/D*Math.asin(e/t),{a:t,c:e,p:s,s:i}),Bs=(t,e,s,i,n)=>t*Math.pow(2,10*(i-=1))*Math.sin((i*n-e)*D/s),Ws=(t,e,s,i)=>-s*Math.cos(t/i*O)+s+e,Us=(t,e,s,i)=>(t/=i)<1/2.75?s*(7.5625*t*t)+e:t<2/2.75?s*(7.5625*(t-=1.5/2.75)*t+.75)+e:t<2.5/2.75?s*(7.5625*(t-=2.25/2.75)*t+.9375)+e:s*(7.5625*(t-=2.625/2.75)*t+.984375)+e,Ys=(t,e,s,i)=>s-Us(i-t,0,s,i)+e;var Xs=Object.freeze({__proto__:null,defaultEasing:Ws,easeInBack:function(t,e,s,i){let n=arguments.length>4&&void 0!==arguments[4]?arguments[4]:1.70158;return s*(t/=i)*t*((n+1)*t-n)+e},easeInBounce:Ys,easeInCirc:(t,e,s,i)=>-s*(Math.sqrt(1-(t/=i)*t)-1)+e,easeInCubic:(t,e,s,i)=>s*(t/i)**3+e,easeInElastic:(t,e,s,i)=>{const n=s;let r=0;if(0===t)return e;if(1===(t/=i))return e+s;r||(r=.3*i);const{a:o,s:a,p:h}=Ns(n,s,r,1.70158);return-Bs(o,a,h,t,i)+e},easeInExpo:(t,e,s,i)=>0===t?e:s*2**(10*(t/i-1))+e,easeInOutBack:function(t,e,s,i){let n=arguments.length>4&&void 0!==arguments[4]?arguments[4]:1.70158;return(t/=i/2)<1?s/2*(t*t*((1+(n*=1.525))*t-n))+e:s/2*((t-=2)*t*((1+(n*=1.525))*t+n)+2)+e},easeInOutBounce:(t,e,s,i)=>t<i/2?.5*Ys(2*t,0,s,i)+e:.5*Us(2*t-i,0,s,i)+.5*s+e,easeInOutCirc:(t,e,s,i)=>(t/=i/2)<1?-s/2*(Math.sqrt(1-t**2)-1)+e:s/2*(Math.sqrt(1-(t-=2)*t)+1)+e,easeInOutCubic:(t,e,s,i)=>(t/=i/2)<1?s/2*t**3+e:s/2*((t-2)**3+2)+e,easeInOutElastic:(t,e,s,i)=>{const n=s;let r=0;if(0===t)return e;if(2===(t/=i/2))return e+s;r||(r=i*(.3*1.5));const{a:o,s:a,p:h,c:c}=Ns(n,s,r,1.70158);return t<1?-.5*Bs(o,a,h,t,i)+e:o*Math.pow(2,-10*(t-=1))*Math.sin((t*i-a)*D/h)*.5+c+e},easeInOutExpo:(t,e,s,i)=>0===t?e:t===i?e+s:(t/=i/2)<1?s/2*2**(10*(t-1))+e:s/2*-(2**(-10*--t)+2)+e,easeInOutQuad:(t,e,s,i)=>(t/=i/2)<1?s/2*t**2+e:-s/2*(--t*(t-2)-1)+e,easeInOutQuart:(t,e,s,i)=>(t/=i/2)<1?s/2*t**4+e:-s/2*((t-=2)*t**3-2)+e,easeInOutQuint:(t,e,s,i)=>(t/=i/2)<1?s/2*t**5+e:s/2*((t-2)**5+2)+e,easeInOutSine:(t,e,s,i)=>-s/2*(Math.cos(Math.PI*t/i)-1)+e,easeInQuad:(t,e,s,i)=>s*(t/=i)*t+e,easeInQuart:(t,e,s,i)=>s*(t/=i)*t**3+e,easeInQuint:(t,e,s,i)=>s*(t/i)**5+e,easeInSine:(t,e,s,i)=>-s*Math.cos(t/i*O)+s+e,easeOutBack:function(t,e,s,i){let n=arguments.length>4&&void 0!==arguments[4]?arguments[4]:1.70158;return s*((t=t/i-1)*t*((n+1)*t+n)+1)+e},easeOutBounce:Us,easeOutCirc:(t,e,s,i)=>s*Math.sqrt(1-(t=t/i-1)*t)+e,easeOutCubic:(t,e,s,i)=>s*((t/i-1)**3+1)+e,easeOutElastic:(t,e,s,i)=>{const n=s;let r=0;if(0===t)return e;if(1===(t/=i))return e+s;r||(r=.3*i);const{a:o,s:a,p:h,c:c}=Ns(n,s,r,1.70158);return o*2**(-10*t)*Math.sin((t*i-a)*D/h)+c+e},easeOutExpo:(t,e,s,i)=>t===i?e+s:s*-(2**(-10*t/i)+1)+e,easeOutQuad:(t,e,s,i)=>-s*(t/=i)*(t-2)+e,easeOutQuart:(t,e,s,i)=>-s*((t=t/i-1)*t**3-1)+e,easeOutQuint:(t,e,s,i)=>s*((t/i-1)**5+1)+e,easeOutSine:(t,e,s,i)=>s*Math.sin(t/i*O)+e});const Vs=()=>!1;class Gs{constructor(t){let{startValue:e,byValue:s,duration:i=500,delay:n=0,easing:r=Ws,onStart:o=E,onChange:a=E,onComplete:c=E,abort:l=Vs,target:u}=t;h(this,"_state","pending"),h(this,"durationProgress",0),h(this,"valueProgress",0),this.tick=this.tick.bind(this),this.duration=i,this.delay=n,this.easing=r,this._onStart=o,this._onChange=a,this._onComplete=c,this._abort=l,this.target=u,this.startValue=e,this.byValue=s,this.value=this.startValue,this.endValue=Object.freeze(this.calculate(this.duration).value)}get state(){return this._state}isDone(){return"aborted"===this._state||"completed"===this._state}start(){const t=t=>{"pending"===this._state&&(this.startTime=t||+new Date,this._state="running",this._onStart(),this.tick(this.startTime))};this.register(),this.delay>0?setTimeout((()=>vt(t)),this.delay):vt(t)}tick(t){const e=(t||+new Date)-this.startTime,s=Math.min(e,this.duration);this.durationProgress=s/this.duration;const{value:i,valueProgress:n}=this.calculate(s);this.value=Object.freeze(i),this.valueProgress=n,"aborted"!==this._state&&(this._abort(this.value,this.valueProgress,this.durationProgress)?(this._state="aborted",this.unregister()):e>=this.duration?(this.durationProgress=this.valueProgress=1,this._onChange(this.endValue,this.valueProgress,this.durationProgress),this._state="completed",this._onComplete(this.endValue,this.valueProgress,this.durationProgress),this.unregister()):(this._onChange(this.value,this.valueProgress,this.durationProgress),vt(this.tick)))}register(){ht.push(this)}unregister(){ht.remove(this)}abort(){this._state="aborted",this.unregister()}}const Hs=["startValue","endValue"];class zs extends Gs{constructor(t){let{startValue:e=0,endValue:s=100}=t;super(l(l({},u(t,Hs)),{},{startValue:e,byValue:s-e}))}calculate(t){const e=this.easing(t,this.startValue,this.byValue,this.duration);return{value:e,valueProgress:Math.abs((e-this.startValue)/this.byValue)}}}const qs=["startValue","endValue"];class Ks extends Gs{constructor(t){let{startValue:e=[0],endValue:s=[100]}=t;super(l(l({},u(t,qs)),{},{startValue:e,byValue:s.map(((t,s)=>t-e[s]))}))}calculate(t){const e=this.startValue.map(((e,s)=>this.easing(t,e,this.byValue[s],this.duration,s)));return{value:e,valueProgress:Math.abs((e[0]-this.startValue[0])/this.byValue[0])}}}const Qs=["startValue","endValue","easing","onChange","onComplete","abort"],Js=(t,e,s,i)=>e+s*(1-Math.cos(t/i*O)),Zs=t=>t&&((e,s,i)=>t(new Ye(e).toRgba(),s,i));class $s extends Gs{constructor(t){let{startValue:e,endValue:s,easing:i=Js,onChange:n,onComplete:r,abort:o}=t,a=u(t,Qs);const h=new Ye(e).getSource(),c=new Ye(s).getSource();super(l(l({},a),{},{startValue:h,byValue:c.map(((t,e)=>t-h[e])),easing:i,onChange:Zs(n),onComplete:Zs(r),abort:Zs(o)}))}calculate(t){const[e,s,i,n]=this.startValue.map(((e,s)=>this.easing(t,e,this.byValue[s],this.duration,s))),r=[...[e,s,i].map(Math.round),Rs(0,n,1)];return{value:r,valueProgress:r.map(((t,e)=>0!==this.byValue[e]?Math.abs((t-this.startValue[e])/this.byValue[e]):0)).find((t=>0!==t))||0}}}function ti(t){const e=(t=>Array.isArray(t.startValue)||Array.isArray(t.endValue))(t)?new Ks(t):new zs(t);return e.start(),e}function ei(t){const e=new $s(t);return e.start(),e}class si{constructor(t){this.status=t,this.points=[]}includes(t){return this.points.some((e=>e.eq(t)))}append(){for(var t=arguments.length,e=new Array(t),s=0;s<t;s++)e[s]=arguments[s];return this.points=this.points.concat(e.filter((t=>!this.includes(t)))),this}static isPointContained(t,e,s){let i=arguments.length>3&&void 0!==arguments[3]&&arguments[3];if(e.eq(s))return t.eq(e);if(e.x===s.x)return t.x===e.x&&(i||t.y>=Math.min(e.y,s.y)&&t.y<=Math.max(e.y,s.y));if(e.y===s.y)return t.y===e.y&&(i||t.x>=Math.min(e.x,s.x)&&t.x<=Math.max(e.x,s.x));{const n=ws(e,s),r=ws(e,t).divide(n);return i?Math.abs(r.x)===Math.abs(r.y):r.x===r.y&&r.x>=0&&r.x<=1}}static isPointInPolygon(t,e){const s=new gt(t).setX(Math.min(t.x-1,...e.map((t=>t.x))));let i=0;for(let n=0;n<e.length;n++){const r=this.intersectSegmentSegment(e[n],e[(n+1)%e.length],t,s);if(r.includes(t))return!0;i+=Number("Intersection"===r.status)}return i%2==1}static intersectLineLine(t,e,s,i){let n=!(arguments.length>4&&void 0!==arguments[4])||arguments[4],r=!(arguments.length>5&&void 0!==arguments[5])||arguments[5];const o=e.x-t.x,a=e.y-t.y,h=i.x-s.x,c=i.y-s.y,l=t.x-s.x,u=t.y-s.y,d=h*u-c*l,g=o*u-a*l,p=c*o-h*a;if(0!==p){const e=d/p,s=g/p;return(n||0<=e&&e<=1)&&(r||0<=s&&s<=1)?new si("Intersection").append(new gt(t.x+e*o,t.y+e*a)):new si}if(0===d||0===g){const o=n||r||si.isPointContained(t,s,i)||si.isPointContained(e,s,i)||si.isPointContained(s,t,e)||si.isPointContained(i,t,e);return new si(o?"Coincident":void 0)}return new si("Parallel")}static intersectSegmentLine(t,e,s,i){return si.intersectLineLine(t,e,s,i,!1,!0)}static intersectSegmentSegment(t,e,s,i){return si.intersectLineLine(t,e,s,i,!1,!1)}static intersectLinePolygon(t,e,s){let i=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];const n=new si,r=s.length;for(let o,a,h,c=0;c<r;c++){if(o=s[c],a=s[(c+1)%r],h=si.intersectLineLine(t,e,o,a,i,!1),"Coincident"===h.status)return h;n.append(...h.points)}return n.points.length>0&&(n.status="Intersection"),n}static intersectSegmentPolygon(t,e,s){return si.intersectLinePolygon(t,e,s,!1)}static intersectPolygonPolygon(t,e){const s=new si,i=t.length,n=[];for(let r=0;r<i;r++){const o=t[r],a=t[(r+1)%i],h=si.intersectSegmentPolygon(o,a,e);"Coincident"===h.status?(n.push(h),s.append(o,a)):s.append(...h.points)}return n.length>0&&n.length===t.length?new si("Coincident"):(s.points.length>0&&(s.status="Intersection"),s)}static intersectPolygonRectangle(t,e,s){const i=e.min(s),n=e.max(s),r=new gt(n.x,i.y),o=new gt(i.x,n.y);return si.intersectPolygonPolygon(t,[i,r,n,o])}}class ii extends _t{getX(){return this.getXY().x}setX(t){this.setXY(this.getXY().setX(t))}getY(){return this.getXY().y}setY(t){this.setXY(this.getXY().setY(t))}getRelativeX(){return this.left}setRelativeX(t){this.left=t}getRelativeY(){return this.top}setRelativeY(t){this.top=t}getXY(){const t=this.getRelativeXY();return this.group?Dt(t,this.group.calcTransformMatrix()):t}setXY(t,e,s){this.group&&(t=Dt(t,Pt(this.group.calcTransformMatrix()))),this.setRelativeXY(t,e,s)}getRelativeXY(){return new gt(this.left,this.top)}setRelativeXY(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.originX,s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:this.originY;this.setPositionByOrigin(t,e,s)}isStrokeAccountedForInDimensions(){return!1}getCoords(){const{tl:t,tr:e,br:s,bl:i}=this.aCoords||(this.aCoords=this.calcACoords()),n=[t,e,s,i];if(this.group){const t=this.group.calcTransformMatrix();return n.map((e=>Dt(e,t)))}return n}intersectsWithRect(t,e){return"Intersection"===si.intersectPolygonRectangle(this.getCoords(),t,e).status}intersectsWithObject(t){const e=si.intersectPolygonPolygon(this.getCoords(),t.getCoords());return"Intersection"===e.status||"Coincident"===e.status||t.isContainedWithinObject(this)||this.isContainedWithinObject(t)}isContainedWithinObject(t){return this.getCoords().every((e=>t.containsPoint(e)))}isContainedWithinRect(t,e){const{left:s,top:i,width:n,height:r}=this.getBoundingRect();return s>=t.x&&s+n<=e.x&&i>=t.y&&i+r<=e.y}isOverlapping(t){return this.intersectsWithObject(t)||this.isContainedWithinObject(t)||t.isContainedWithinObject(this)}containsPoint(t){return si.isPointInPolygon(t,this.getCoords())}isOnScreen(){if(!this.canvas)return!1;const{tl:t,br:e}=this.canvas.vptCoords;return!!this.getCoords().some((s=>s.x<=e.x&&s.x>=t.x&&s.y<=e.y&&s.y>=t.y))||!!this.intersectsWithRect(t,e)||this.containsPoint(t.midPointFrom(e))}isPartiallyOnScreen(){if(!this.canvas)return!1;const{tl:t,br:e}=this.canvas.vptCoords;return!!this.intersectsWithRect(t,e)||this.getCoords().every((s=>(s.x>=e.x||s.x<=t.x)&&(s.y>=e.y||s.y<=t.y)))&&this.containsPoint(t.midPointFrom(e))}getBoundingRect(){return pe(this.getCoords())}getScaledWidth(){return this._getTransformedDimensions().x}getScaledHeight(){return this._getTransformedDimensions().y}scale(t){this._set(Z,t),this._set($,t),this.setCoords()}scaleToWidth(t){const e=this.getBoundingRect().width/this.getScaledWidth();return this.scale(t/this.width/e)}scaleToHeight(t){const e=this.getBoundingRect().height/this.getScaledHeight();return this.scale(t/this.height/e)}getCanvasRetinaScaling(){var t;return(null===(t=this.canvas)||void 0===t?void 0:t.getRetinaScaling())||1}getTotalAngle(){return this.group?Et(Rt(this.calcTransformMatrix())):this.angle}getViewportTransform(){var t;return(null===(t=this.canvas)||void 0===t?void 0:t.viewportTransform)||I.concat()}calcACoords(){const t=jt({angle:this.angle}),{x:e,y:s}=this.getRelativeCenterPoint(),i=Lt(e,s),n=It(i,t),r=this._getTransformedDimensions(),o=r.x/2,a=r.y/2;return{tl:Dt({x:-o,y:-a},n),tr:Dt({x:o,y:-a},n),bl:Dt({x:-o,y:a},n),br:Dt({x:o,y:a},n)}}setCoords(){this.aCoords=this.calcACoords()}transformMatrixKey(){let t=arguments.length>0&&void 0!==arguments[0]&&arguments[0],e=[];return!t&&this.group&&(e=this.group.transformMatrixKey(t)),e.push(this.top,this.left,this.width,this.height,this.scaleX,this.scaleY,this.angle,this.strokeWidth,this.skewX,this.skewY,+this.flipX,+this.flipY,Ae(this.originX),Ae(this.originY)),e}calcTransformMatrix(){let t=arguments.length>0&&void 0!==arguments[0]&&arguments[0],e=this.calcOwnMatrix();if(t||!this.group)return e;const s=this.transformMatrixKey(t),i=this.matrixCache;return i&&i.key.every(((t,e)=>t===s[e]))?i.value:(this.group&&(e=It(this.group.calcTransformMatrix(!1),e)),this.matrixCache={key:s,value:e},e)}calcOwnMatrix(){const t=this.transformMatrixKey(!0),e=this.ownMatrixCache;if(e&&e.key===t)return e.value;const s=this.getRelativeCenterPoint(),i={angle:this.angle,translateX:s.x,translateY:s.y,scaleX:this.scaleX,scaleY:this.scaleY,skewX:this.skewX,skewY:this.skewY,flipX:this.flipX,flipY:this.flipY},n=Xt(i);return this.ownMatrixCache={key:t,value:n},n}_getNonTransformedDimensions(){return new gt(this.width,this.height).scalarAdd(this.strokeWidth)}_calculateCurrentDimensions(t){return this._getTransformedDimensions(t).transform(this.getViewportTransform(),!0).scalarAdd(2*this.padding)}_getTransformedDimensions(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};const e=l({scaleX:this.scaleX,scaleY:this.scaleY,skewX:this.skewX,skewY:this.skewY,width:this.width,height:this.height,strokeWidth:this.strokeWidth},t),s=e.strokeWidth;let i=s,n=0;this.strokeUniform&&(i=0,n=s);const r=e.width+i,o=e.height+i;let a;return a=0===e.skewX&&0===e.skewY?new gt(r*e.scaleX,o*e.scaleY):Ce(r,o,Yt(e)),a.scalarAdd(n)}translateToGivenOrigin(t,e,s,i,n){let r=t.x,o=t.y;const a=Ae(i)-Ae(e),h=Ae(n)-Ae(s);if(a||h){const t=this._getTransformedDimensions();r+=a*t.x,o+=h*t.y}return new gt(r,o)}translateToCenterPoint(t,e,s){if(e===F&&s===F)return t;const i=this.translateToGivenOrigin(t,e,s,F,F);return this.angle?i.rotate(At(this.angle),t):i}translateToOriginPoint(t,e,s){const i=this.translateToGivenOrigin(t,F,F,e,s);return this.angle?i.rotate(At(this.angle),t):i}getCenterPoint(){const t=this.getRelativeCenterPoint();return this.group?Dt(t,this.group.calcTransformMatrix()):t}getRelativeCenterPoint(){return this.translateToCenterPoint(new gt(this.left,this.top),this.originX,this.originY)}getPointByOrigin(t,e){return this.translateToOriginPoint(this.getRelativeCenterPoint(),t,e)}setPositionByOrigin(t,e,s){const i=this.translateToCenterPoint(t,e,s),n=this.translateToOriginPoint(i,this.originX,this.originY);this.set({left:n.x,top:n.y})}_getLeftTopCoords(){return this.translateToOriginPoint(this.getRelativeCenterPoint(),L,j)}}const ni=["type"],ri=["extraParam"];let oi=class t extends ii{static getDefaults(){return t.ownDefaults}get type(){const t=this.constructor.type;return"FabricObject"===t?"object":t.toLowerCase()}set type(t){f("warn","Setting type has no effect",t)}constructor(e){super(),h(this,"_cacheContext",null),Object.assign(this,t.ownDefaults),this.setOptions(e)}_createCacheCanvas(){this._cacheCanvas=wt(),this._cacheContext=this._cacheCanvas.getContext("2d"),this._updateCacheCanvas(),this.dirty=!0}_limitCacheSize(t){const e=t.width,s=t.height,i=p.maxCacheSideLimit,n=p.minCacheSideLimit;if(e<=i&&s<=i&&e*s<=p.perfLimitSizeTotal)return e<n&&(t.width=n),s<n&&(t.height=n),t;const r=e/s,[o,a]=k.limitDimsByArea(r),h=Rs(n,o,i),c=Rs(n,a,i);return e>h&&(t.zoomX/=e/h,t.width=h,t.capped=!0),s>c&&(t.zoomY/=s/c,t.height=c,t.capped=!0),t}_getCacheCanvasDimensions(){const t=this.getTotalObjectScaling(),e=this._getTransformedDimensions({skewX:0,skewY:0}),s=e.x*t.x/this.scaleX,i=e.y*t.y/this.scaleY;return{width:Math.ceil(s+2),height:Math.ceil(i+2),zoomX:t.x,zoomY:t.y,x:s,y:i}}_updateCacheCanvas(){const t=this._cacheCanvas,e=this._cacheContext,{width:s,height:i,zoomX:n,zoomY:r,x:o,y:a}=this._limitCacheSize(this._getCacheCanvasDimensions()),h=s!==t.width||i!==t.height,c=this.zoomX!==n||this.zoomY!==r;if(!t||!e)return!1;if(h||c){s!==t.width||i!==t.height?(t.width=s,t.height=i):(e.setTransform(1,0,0,1,0,0),e.clearRect(0,0,t.width,t.height));const h=o/2,c=a/2;return this.cacheTranslationX=Math.round(t.width/2-h)+h,this.cacheTranslationY=Math.round(t.height/2-c)+c,e.translate(this.cacheTranslationX,this.cacheTranslationY),e.scale(n,r),this.zoomX=n,this.zoomY=r,!0}return!1}setOptions(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};this._setOptions(t)}transform(t){const e=this.group&&!this.group._transformDone||this.group&&this.canvas&&t===this.canvas.contextTop,s=this.calcTransformMatrix(!e);t.transform(s[0],s[1],s[2],s[3],s[4],s[5])}getObjectScaling(){if(!this.group)return new gt(Math.abs(this.scaleX),Math.abs(this.scaleY));const t=Ft(this.calcTransformMatrix());return new gt(Math.abs(t.scaleX),Math.abs(t.scaleY))}getTotalObjectScaling(){const t=this.getObjectScaling();if(this.canvas){const e=this.canvas.getZoom(),s=this.getCanvasRetinaScaling();return t.scalarMultiply(e*s)}return t}getObjectOpacity(){let t=this.opacity;return this.group&&(t*=this.group.getObjectOpacity()),t}_constrainScale(t){return Math.abs(t)<this.minScaleLimit?t<0?-this.minScaleLimit:this.minScaleLimit:0===t?1e-4:t}_set(t,e){t!==Z&&t!==$||(e=this._constrainScale(e)),t===Z&&e<0?(this.flipX=!this.flipX,e*=-1):"scaleY"===t&&e<0?(this.flipY=!this.flipY,e*=-1):"shadow"!==t||!e||e instanceof Ms||(e=new Ms(e));const s=this[t]!==e;return this[t]=e,s&&this.constructor.cacheProperties.includes(t)&&(this.dirty=!0),this.parent&&(this.dirty||s&&this.constructor.stateProperties.includes(t))&&this.parent._set("dirty",!0),this}isNotVisible(){return 0===this.opacity||!this.width&&!this.height&&0===this.strokeWidth||!this.visible}render(t){this.isNotVisible()||this.canvas&&this.canvas.skipOffscreen&&!this.group&&!this.isOnScreen()||(t.save(),this._setupCompositeOperation(t),this.drawSelectionBackground(t),this.transform(t),this._setOpacity(t),this._setShadow(t),this.shouldCache()?(this.renderCache(),this.drawCacheOnCanvas(t)):(this._removeCacheCanvas(),this.drawObject(t,!1,{}),this.dirty=!1),t.restore())}drawSelectionBackground(t){}renderCache(t){if(t=t||{},this._cacheCanvas&&this._cacheContext||this._createCacheCanvas(),this.isCacheDirty()&&this._cacheContext){const{zoomX:e,zoomY:s,cacheTranslationX:i,cacheTranslationY:n}=this,{width:r,height:o}=this._cacheCanvas;this.drawObject(this._cacheContext,t.forClipping,{zoomX:e,zoomY:s,cacheTranslationX:i,cacheTranslationY:n,width:r,height:o,parentClipPaths:[]}),this.dirty=!1}}_removeCacheCanvas(){this._cacheCanvas=void 0,this._cacheContext=null}hasStroke(){return this.stroke&&"transparent"!==this.stroke&&0!==this.strokeWidth}hasFill(){return this.fill&&"transparent"!==this.fill}needsItsOwnCache(){return!!(this.paintFirst===it&&this.hasFill()&&this.hasStroke()&&this.shadow)||!!this.clipPath}shouldCache(){return this.ownCaching=this.objectCaching&&(!this.parent||!this.parent.isOnACache())||this.needsItsOwnCache(),this.ownCaching}willDrawShadow(){return!!this.shadow&&(0!==this.shadow.offsetX||0!==this.shadow.offsetY)}drawClipPathOnCache(t,e,s){t.save(),e.inverted?t.globalCompositeOperation="destination-out":t.globalCompositeOperation="destination-in",t.setTransform(1,0,0,1,0,0),t.drawImage(s,0,0),t.restore()}drawObject(t,e,s){const i=this.fill,n=this.stroke;e?(this.fill="black",this.stroke="",this._setClippingProperties(t)):this._renderBackground(t),this._render(t),this._drawClipPath(t,this.clipPath,s),this.fill=i,this.stroke=n}createClipPathLayer(t,e){const s=St(e),i=s.getContext("2d");if(i.translate(e.cacheTranslationX,e.cacheTranslationY),i.scale(e.zoomX,e.zoomY),t._cacheCanvas=s,e.parentClipPaths.forEach((t=>{t.transform(i)})),e.parentClipPaths.push(t),t.absolutePositioned){const t=Pt(this.calcTransformMatrix());i.transform(t[0],t[1],t[2],t[3],t[4],t[5])}return t.transform(i),t.drawObject(i,!0,e),s}_drawClipPath(t,e,s){if(!e)return;e._transformDone=!0;const i=this.createClipPathLayer(e,s);this.drawClipPathOnCache(t,e,i)}drawCacheOnCanvas(t){t.scale(1/this.zoomX,1/this.zoomY),t.drawImage(this._cacheCanvas,-this.cacheTranslationX,-this.cacheTranslationY)}isCacheDirty(){let t=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(this.isNotVisible())return!1;const e=this._cacheCanvas,s=this._cacheContext;return!(!e||!s||t||!this._updateCacheCanvas())||!!(this.dirty||this.clipPath&&this.clipPath.absolutePositioned)&&(e&&s&&!t&&(s.save(),s.setTransform(1,0,0,1,0,0),s.clearRect(0,0,e.width,e.height),s.restore()),!0)}_renderBackground(t){if(!this.backgroundColor)return;const e=this._getNonTransformedDimensions();t.fillStyle=this.backgroundColor,t.fillRect(-e.x/2,-e.y/2,e.x,e.y),this._removeShadow(t)}_setOpacity(t){this.group&&!this.group._transformDone?t.globalAlpha=this.getObjectOpacity():t.globalAlpha*=this.opacity}_setStrokeStyles(t,e){const s=e.stroke;s&&(t.lineWidth=e.strokeWidth,t.lineCap=e.strokeLineCap,t.lineDashOffset=e.strokeDashOffset,t.lineJoin=e.strokeLineJoin,t.miterLimit=e.strokeMiterLimit,Jt(s)?"percentage"===s.gradientUnits||s.gradientTransform||s.patternTransform?this._applyPatternForTransformedGradient(t,s):(t.strokeStyle=s.toLive(t),this._applyPatternGradientTransform(t,s)):t.strokeStyle=e.stroke)}_setFillStyles(t,e){let{fill:s}=e;s&&(Jt(s)?(t.fillStyle=s.toLive(t),this._applyPatternGradientTransform(t,s)):t.fillStyle=s)}_setClippingProperties(t){t.globalAlpha=1,t.strokeStyle="transparent",t.fillStyle="#000000"}_setLineDash(t,e){e&&0!==e.length&&t.setLineDash(e)}_setShadow(t){if(!this.shadow)return;const e=this.shadow,s=this.canvas,i=this.getCanvasRetinaScaling(),[n,,,r]=(null==s?void 0:s.viewportTransform)||I,o=n*i,a=r*i,h=e.nonScaling?new gt(1,1):this.getObjectScaling();t.shadowColor=e.color,t.shadowBlur=e.blur*p.browserShadowBlurConstant*(o+a)*(h.x+h.y)/4,t.shadowOffsetX=e.offsetX*o*h.x,t.shadowOffsetY=e.offsetY*a*h.y}_removeShadow(t){this.shadow&&(t.shadowColor="",t.shadowBlur=t.shadowOffsetX=t.shadowOffsetY=0)}_applyPatternGradientTransform(t,e){if(!Jt(e))return{offsetX:0,offsetY:0};const s=e.gradientTransform||e.patternTransform,i=-this.width/2+e.offsetX||0,n=-this.height/2+e.offsetY||0;return"percentage"===e.gradientUnits?t.transform(this.width,0,0,this.height,i,n):t.transform(1,0,0,1,i,n),s&&t.transform(s[0],s[1],s[2],s[3],s[4],s[5]),{offsetX:i,offsetY:n}}_renderPaintInOrder(t){this.paintFirst===it?(this._renderStroke(t),this._renderFill(t)):(this._renderFill(t),this._renderStroke(t))}_render(t){}_renderFill(t){this.fill&&(t.save(),this._setFillStyles(t,this),"evenodd"===this.fillRule?t.fill("evenodd"):t.fill(),t.restore())}_renderStroke(t){if(this.stroke&&0!==this.strokeWidth){if(this.shadow&&!this.shadow.affectStroke&&this._removeShadow(t),t.save(),this.strokeUniform){const e=this.getObjectScaling();t.scale(1/e.x,1/e.y)}this._setLineDash(t,this.strokeDashArray),this._setStrokeStyles(t,this),t.stroke(),t.restore()}}_applyPatternForTransformedGradient(t,e){var s;const i=this._limitCacheSize(this._getCacheCanvasDimensions()),n=this.getCanvasRetinaScaling(),r=i.x/this.scaleX/n,o=i.y/this.scaleY/n,a=St({width:Math.ceil(r),height:Math.ceil(o)}),h=a.getContext("2d");h&&(h.beginPath(),h.moveTo(0,0),h.lineTo(r,0),h.lineTo(r,o),h.lineTo(0,o),h.closePath(),h.translate(r/2,o/2),h.scale(i.zoomX/this.scaleX/n,i.zoomY/this.scaleY/n),this._applyPatternGradientTransform(h,e),h.fillStyle=e.toLive(t),h.fill(),t.translate(-this.width/2-this.strokeWidth/2,-this.height/2-this.strokeWidth/2),t.scale(n*this.scaleX/i.zoomX,n*this.scaleY/i.zoomY),t.strokeStyle=null!==(s=h.createPattern(a,"no-repeat"))&&void 0!==s?s:"")}_findCenterFromElement(){return new gt(this.left+this.width/2,this.top+this.height/2)}clone(t){const e=this.toObject(t);return this.constructor.fromObject(e)}cloneAsImage(t){const e=this.toCanvasElement(t);return new(at.getClass("image"))(e)}toCanvasElement(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};const e=ye(this),s=this.group,i=this.shadow,n=Math.abs,r=t.enableRetinaScaling?T():1,o=(t.multiplier||1)*r,a=t.canvasProvider||(t=>new ce(t,{enableRetinaScaling:!1,renderOnAddRemove:!1,skipOffscreen:!1}));delete this.group,t.withoutTransform&&ve(this),t.withoutShadow&&(this.shadow=null),t.viewportTransform&&Se(this,this.getViewportTransform()),this.setCoords();const h=wt(),c=this.getBoundingRect(),l=this.shadow,u=new gt;if(l){const t=l.blur,e=l.nonScaling?new gt(1,1):this.getObjectScaling();u.x=2*Math.round(n(l.offsetX)+t)*n(e.x),u.y=2*Math.round(n(l.offsetY)+t)*n(e.y)}const d=c.width+u.x,g=c.height+u.y;h.width=Math.ceil(d),h.height=Math.ceil(g);const p=a(h);"jpeg"===t.format&&(p.backgroundColor="#fff"),this.setPositionByOrigin(new gt(p.width/2,p.height/2),F,F);const f=this.canvas;p._objects=[this],this.set("canvas",p),this.setCoords();const m=p.toCanvasElement(o||1,t);return this.set("canvas",f),this.shadow=i,s&&(this.group=s),this.set(e),this.setCoords(),p._objects=[],p.destroy(),m}toDataURL(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return Tt(this.toCanvasElement(t),t.format||"png",t.quality||1)}toBlob(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return kt(this.toCanvasElement(t),t.format||"png",t.quality||1)}isType(){for(var t=arguments.length,e=new Array(t),s=0;s<t;s++)e[s]=arguments[s];return e.includes(this.constructor.type)||e.includes(this.type)}complexity(){return 1}toJSON(){return this.toObject()}rotate(t){const{centeredRotation:e,originX:s,originY:i}=this;if(e){const{x:t,y:e}=this.getRelativeCenterPoint();this.originX=F,this.originY=F,this.left=t,this.top=e}if(this.set("angle",t),e){const{x:t,y:e}=this.translateToOriginPoint(this.getRelativeCenterPoint(),s,i);this.left=t,this.top=e,this.originX=s,this.originY=i}}setOnGroup(){}_setupCompositeOperation(t){this.globalCompositeOperation&&(t.globalCompositeOperation=this.globalCompositeOperation)}dispose(){ht.cancelByTarget(this),this.off(),this._set("canvas",void 0),this._cacheCanvas&&w().dispose(this._cacheCanvas),this._cacheCanvas=void 0,this._cacheContext=null}animate(t,e){return Object.entries(t).reduce(((t,s)=>{let[i,n]=s;return t[i]=this._animate(i,n,e),t}),{})}_animate(t,e){let s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};const i=t.split("."),n=this.constructor.colorProperties.includes(i[i.length-1]),{abort:r,startValue:o,onChange:a,onComplete:h}=s,c=l(l({},s),{},{target:this,startValue:null!=o?o:i.reduce(((t,e)=>t[e]),this),endValue:e,abort:null==r?void 0:r.bind(this),onChange:(t,e,s)=>{i.reduce(((e,s,n)=>(n===i.length-1&&(e[s]=t),e[s])),this),a&&a(t,e,s)},onComplete:(t,e,s)=>{this.setCoords(),h&&h(t,e,s)}});return n?ei(c):ti(c)}isDescendantOf(t){const{parent:e,group:s}=this;return e===t||s===t||!!e&&e.isDescendantOf(t)||!!s&&s!==e&&s.isDescendantOf(t)}getAncestors(){const t=[];let e=this;do{e=e.parent,e&&t.push(e)}while(e);return t}findCommonAncestors(t){if(this===t)return{fork:[],otherFork:[],common:[this,...this.getAncestors()]};const e=this.getAncestors(),s=t.getAncestors();if(0===e.length&&s.length>0&&this===s[s.length-1])return{fork:[],otherFork:[t,...s.slice(0,s.length-1)],common:[this]};for(let i,n=0;n<e.length;n++){if(i=e[n],i===t)return{fork:[this,...e.slice(0,n)],otherFork:[],common:e.slice(n)};for(let r=0;r<s.length;r++){if(this===s[r])return{fork:[],otherFork:[t,...s.slice(0,r)],common:[this,...e]};if(i===s[r])return{fork:[this,...e.slice(0,n)],otherFork:[t,...s.slice(0,r)],common:e.slice(n)}}}return{fork:[this,...e],otherFork:[t,...s],common:[]}}hasCommonAncestors(t){const e=this.findCommonAncestors(t);return e&&!!e.common.length}isInFrontOf(t){if(this===t)return;const e=this.findCommonAncestors(t);if(e.fork.includes(t))return!0;if(e.otherFork.includes(this))return!1;const s=e.common[0]||this.canvas;if(!s)return;const i=e.fork.pop(),n=e.otherFork.pop(),r=s._objects.indexOf(i),o=s._objects.indexOf(n);return r>-1&&r>o}toObject(){const e=(arguments.length>0&&void 0!==arguments[0]?arguments[0]:[]).concat(t.customProperties,this.constructor.customProperties||[]);let s;const i=p.NUM_FRACTION_DIGITS,{clipPath:n,fill:r,stroke:o,shadow:a,strokeDashArray:h,left:c,top:u,originX:d,originY:g,width:f,height:m,strokeWidth:_,strokeLineCap:v,strokeDashOffset:y,strokeLineJoin:C,strokeUniform:b,strokeMiterLimit:w,scaleX:x,scaleY:S,angle:T,flipX:k,flipY:E,opacity:O,visible:D,backgroundColor:P,fillRule:I,paintFirst:M,globalCompositeOperation:R,skewX:F,skewY:L}=this;n&&!n.excludeFromExport&&(s=n.toObject(e.concat("inverted","absolutePositioned")));const j=t=>Kt(t,i),N=l(l({},zt(this,e)),{},{type:this.constructor.type,version:A,originX:d,originY:g,left:j(c),top:j(u),width:j(f),height:j(m),fill:Zt(r)?r.toObject():r,stroke:Zt(o)?o.toObject():o,strokeWidth:j(_),strokeDashArray:h?h.concat():h,strokeLineCap:v,strokeDashOffset:y,strokeLineJoin:C,strokeUniform:b,strokeMiterLimit:j(w),scaleX:j(x),scaleY:j(S),angle:j(T),flipX:k,flipY:E,opacity:j(O),shadow:a?a.toObject():a,visible:D,backgroundColor:P,fillRule:I,paintFirst:M,globalCompositeOperation:R,skewX:j(F),skewY:j(L)},s?{clipPath:s}:null);return this.includeDefaultValues?N:this._removeDefaultValues(N)}toDatalessObject(t){return this.toObject(t)}_removeDefaultValues(t){const e=this.constructor.getDefaults(),s=Object.keys(e).length>0?e:Object.getPrototypeOf(this);return qt(t,((t,e)=>{if(e===L||e===j||"type"===e)return!0;const i=s[e];return t!==i&&!(Array.isArray(t)&&Array.isArray(i)&&0===t.length&&0===i.length)}))}toString(){return"#<".concat(this.constructor.type,">")}static _fromObject(t){let e=u(t,ni),s=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},{extraParam:i}=s,n=u(s,ri);return Ht(e,n).then((t=>i?(delete t[i],new this(e[i],t)):new this(t)))}static fromObject(t,e){return this._fromObject(t,e)}};h(oi,"stateProperties",Fs),h(oi,"cacheProperties",Ls),h(oi,"ownDefaults",js),h(oi,"type","FabricObject"),h(oi,"colorProperties",[st,it,"backgroundColor"]),h(oi,"customProperties",[]),at.setClass(oi),at.setClass(oi,"object");const ai=(t,e,s)=>(i,n,r,o)=>{const a=e(i,n,r,o);return a&&Te(t,l(l({},Ie(i,n,r,o)),s)),a};function hi(t){return(e,s,i,n)=>{const{target:r,originX:o,originY:a}=s,h=r.getRelativeCenterPoint(),c=r.translateToOriginPoint(h,o,a),l=t(e,s,i,n);return r.setPositionByOrigin(c,s.originX,s.originY),l}}const ci=ai(z,hi(((t,e,s,i)=>{const n=Re(e,e.originX,e.originY,s,i);if(Ae(e.originX)===Ae(F)||Ae(e.originX)===Ae(B)&&n.x<0||Ae(e.originX)===Ae(L)&&n.x>0){const{target:t}=e,s=t.strokeWidth/(t.strokeUniform?t.scaleX:1),i=Oe(e)?2:1,r=t.width,o=Math.abs(n.x*i/t.scaleX)-s;return t.set("width",Math.max(o,1)),r!==t.width}return!1})));function li(t,e,s,i,n){i=i||{};const r=this.sizeX||i.cornerSize||n.cornerSize,o=this.sizeY||i.cornerSize||n.cornerSize,a=void 0!==i.transparentCorners?i.transparentCorners:n.transparentCorners,h=a?it:st,c=!a&&(i.cornerStrokeColor||n.cornerStrokeColor);let l,u=e,d=s;t.save(),t.fillStyle=i.cornerColor||n.cornerColor||"",t.strokeStyle=i.cornerStrokeColor||n.cornerStrokeColor||"",r>o?(l=r,t.scale(1,o/r),d=s*r/o):o>r?(l=o,t.scale(r/o,1),u=e*o/r):l=r,t.beginPath(),t.arc(u,d,l/2,0,D,!1),t[h](),c&&t.stroke(),t.restore()}function ui(t,e,s,i,n){i=i||{};const r=this.sizeX||i.cornerSize||n.cornerSize,o=this.sizeY||i.cornerSize||n.cornerSize,a=void 0!==i.transparentCorners?i.transparentCorners:n.transparentCorners,h=a?it:st,c=!a&&(i.cornerStrokeColor||n.cornerStrokeColor),l=r/2,u=o/2;t.save(),t.fillStyle=i.cornerColor||n.cornerColor||"",t.strokeStyle=i.cornerStrokeColor||n.cornerStrokeColor||"",t.translate(e,s);const d=n.getTotalAngle();t.rotate(At(d)),t["".concat(h,"Rect")](-l,-u,r,o),c&&t.strokeRect(-l,-u,r,o),t.restore()}class di{constructor(t){h(this,"visible",!0),h(this,"actionName",J),h(this,"angle",0),h(this,"x",0),h(this,"y",0),h(this,"offsetX",0),h(this,"offsetY",0),h(this,"sizeX",0),h(this,"sizeY",0),h(this,"touchSizeX",0),h(this,"touchSizeY",0),h(this,"cursorStyle","crosshair"),h(this,"withConnection",!1),Object.assign(this,t)}shouldActivate(t,e,s,i){var n;let{tl:r,tr:o,br:a,bl:h}=i;return(null===(n=e.canvas)||void 0===n?void 0:n.getActiveObject())===e&&e.isControlVisible(t)&&si.isPointInPolygon(s,[r,o,a,h])}getActionHandler(t,e,s){return this.actionHandler}getMouseDownHandler(t,e,s){return this.mouseDownHandler}getMouseUpHandler(t,e,s){return this.mouseUpHandler}cursorStyleHandler(t,e,s){return e.cursorStyle}getActionName(t,e,s){return e.actionName}getVisibility(t,e){var s,i;return null!==(s=null===(i=t._controlsVisibility)||void 0===i?void 0:i[e])&&void 0!==s?s:this.visible}setVisibility(t,e,s){this.visible=t}positionHandler(t,e,s,i){return new gt(this.x*t.x+this.offsetX,this.y*t.y+this.offsetY).transform(e)}calcCornerCoords(t,e,s,i,n,r){const o=Mt([Lt(s,i),jt({angle:t}),Nt((n?this.touchSizeX:this.sizeX)||e,(n?this.touchSizeY:this.sizeY)||e)]);return{tl:new gt(-.5,-.5).transform(o),tr:new gt(.5,-.5).transform(o),br:new gt(.5,.5).transform(o),bl:new gt(-.5,.5).transform(o)}}render(t,e,s,i,n){"circle"===((i=i||{}).cornerStyle||n.cornerStyle)?li.call(this,t,e,s,i,n):ui.call(this,t,e,s,i,n)}}const gi=(t,e,s)=>s.lockRotation?Ee:e.cursorStyle,pi=ai(V,hi(((t,e,s,i)=>{let{target:n,ex:r,ey:o,theta:a,originX:h,originY:c}=e;const l=n.translateToOriginPoint(n.getRelativeCenterPoint(),h,c);if(Pe(n,"lockRotation"))return!1;const u=Math.atan2(o-l.y,r-l.x),d=Math.atan2(i-l.y,s-l.x);let g=Et(d-u+a);if(n.snapAngle&&n.snapAngle>0){const t=n.snapAngle,e=n.snapThreshold||t,s=Math.ceil(g/t)*t,i=Math.floor(g/t)*t;Math.abs(g-i)<e?g=i:Math.abs(g-s)<e&&(g=s)}g<0&&(g=360+g),g%=360;const p=n.angle!==g;return n.angle=g,p})));function fi(t,e){const s=e.canvas,i=t[s.uniScaleKey];return s.uniformScaling&&!i||!s.uniformScaling&&i}function mi(t,e,s){const i=Pe(t,"lockScalingX"),n=Pe(t,"lockScalingY");if(i&&n)return!0;if(!e&&(i||n)&&s)return!0;if(i&&"x"===e)return!0;if(n&&"y"===e)return!0;const{width:r,height:o,strokeWidth:a}=t;return 0===r&&0===a&&"y"!==e||0===o&&0===a&&"x"!==e}const _i=["e","se","s","sw","w","nw","n","ne","e"],vi=(t,e,s)=>{const i=fi(t,s);if(mi(s,0!==e.x&&0===e.y?"x":0===e.x&&0!==e.y?"y":"",i))return Ee;const n=Me(s,e);return"".concat(_i[n],"-resize")};function yi(t,e,s,i){let n=arguments.length>4&&void 0!==arguments[4]?arguments[4]:{};const r=e.target,o=n.by,a=fi(t,r);let h,c,l,u,d,g;if(mi(r,o,a))return!1;if(e.gestureScale)c=e.scaleX*e.gestureScale,l=e.scaleY*e.gestureScale;else{if(h=Re(e,e.originX,e.originY,s,i),d="y"!==o?Math.sign(h.x||e.signX||1):1,g="x"!==o?Math.sign(h.y||e.signY||1):1,e.signX||(e.signX=d),e.signY||(e.signY=g),Pe(r,"lockScalingFlip")&&(e.signX!==d||e.signY!==g))return!1;if(u=r._getTransformedDimensions(),a&&!o){const t=Math.abs(h.x)+Math.abs(h.y),{original:s}=e,i=t/(Math.abs(u.x*s.scaleX/r.scaleX)+Math.abs(u.y*s.scaleY/r.scaleY));c=s.scaleX*i,l=s.scaleY*i}else c=Math.abs(h.x*r.scaleX/u.x),l=Math.abs(h.y*r.scaleY/u.y);Oe(e)&&(c*=2,l*=2),e.signX!==d&&"y"!==o&&(e.originX=De(e.originX),c*=-1,e.signX=d),e.signY!==g&&"x"!==o&&(e.originY=De(e.originY),l*=-1,e.signY=g)}const p=r.scaleX,f=r.scaleY;return o?("x"===o&&r.set(Z,c),"y"===o&&r.set($,l)):(!Pe(r,"lockScalingX")&&r.set(Z,c),!Pe(r,"lockScalingY")&&r.set($,l)),p!==r.scaleX||f!==r.scaleY}const Ci=ai(X,hi(((t,e,s,i)=>yi(t,e,s,i)))),bi=ai(X,hi(((t,e,s,i)=>yi(t,e,s,i,{by:"x"})))),wi=ai(X,hi(((t,e,s,i)=>yi(t,e,s,i,{by:"y"})))),xi=["target","ex","ey","skewingSide"],Si={x:{counterAxis:"y",scale:Z,skew:tt,lockSkewing:"lockSkewingX",origin:"originX",flip:"flipX"},y:{counterAxis:"x",scale:$,skew:et,lockSkewing:"lockSkewingY",origin:"originY",flip:"flipY"}},Ti=["ns","nesw","ew","nwse"],ki=(t,e,s)=>{if(0!==e.x&&Pe(s,"lockSkewingY"))return Ee;if(0!==e.y&&Pe(s,"lockSkewingX"))return Ee;const i=Me(s,e)%4;return"".concat(Ti[i],"-resize")};function Ai(t,e,s,i,n){const{target:r}=s,{counterAxis:o,origin:a,lockSkewing:h,skew:c,flip:d}=Si[t];if(Pe(r,h))return!1;const{origin:g,flip:p}=Si[o],f=Ae(s[g])*(r[p]?-1:1),m=-Math.sign(f)*(r[d]?-1:1),_=-(0===r[c]&&Re(s,F,F,i,n)[t]>0||r[c]>0?1:-1)*m*.5+.5,v=ai(H,hi(((e,s,i,n)=>function(t,e,s){let{target:i,ex:n,ey:r,skewingSide:o}=e,a=u(e,xi);const{skew:h}=Si[t],c=s.subtract(new gt(n,r)).divide(new gt(i.scaleX,i.scaleY))[t],l=i[h],d=a[h],g=Math.tan(At(d)),p="y"===t?i._getTransformedDimensions({scaleX:1,scaleY:1,skewX:0}).x:i._getTransformedDimensions({scaleX:1,scaleY:1}).y,f=2*c*o/Math.max(p,1)+g,m=Et(Math.atan(f));i.set(h,m);const _=l!==i[h];if(_&&"y"===t){const{skewX:t,scaleX:e}=i,s=i._getTransformedDimensions({skewY:l}),n=i._getTransformedDimensions(),r=0!==t?s.x/n.x:1;1!==r&&i.set(Z,r*e)}return _}(t,s,new gt(i,n)))));return v(e,l(l({},s),{},{[a]:_,skewingSide:m}),i,n)}const Ei=(t,e,s,i)=>Ai("x",t,e,s,i),Oi=(t,e,s,i)=>Ai("y",t,e,s,i);function Di(t,e){return t[e.canvas.altActionKey]}const Pi=(t,e,s)=>{const i=Di(t,s);return 0===e.x?i?tt:$:0===e.y?i?et:Z:""},Ii=(t,e,s)=>Di(t,s)?ki(0,e,s):vi(t,e,s),Mi=(t,e,s,i)=>Di(t,e.target)?Oi(t,e,s,i):bi(t,e,s,i),Ri=(t,e,s,i)=>Di(t,e.target)?Ei(t,e,s,i):wi(t,e,s,i),Fi=()=>({ml:new di({x:-.5,y:0,cursorStyleHandler:Ii,actionHandler:Mi,getActionName:Pi}),mr:new di({x:.5,y:0,cursorStyleHandler:Ii,actionHandler:Mi,getActionName:Pi}),mb:new di({x:0,y:.5,cursorStyleHandler:Ii,actionHandler:Ri,getActionName:Pi}),mt:new di({x:0,y:-.5,cursorStyleHandler:Ii,actionHandler:Ri,getActionName:Pi}),tl:new di({x:-.5,y:-.5,cursorStyleHandler:vi,actionHandler:Ci}),tr:new di({x:.5,y:-.5,cursorStyleHandler:vi,actionHandler:Ci}),bl:new di({x:-.5,y:.5,cursorStyleHandler:vi,actionHandler:Ci}),br:new di({x:.5,y:.5,cursorStyleHandler:vi,actionHandler:Ci}),mtr:new di({x:0,y:-.5,actionHandler:pi,cursorStyleHandler:gi,offsetY:-40,withConnection:!0,actionName:G})}),Li=()=>({mr:new di({x:.5,y:0,actionHandler:ci,cursorStyleHandler:Ii,actionName:z}),ml:new di({x:-.5,y:0,actionHandler:ci,cursorStyleHandler:Ii,actionName:z})}),ji=()=>l(l({},Fi()),Li());class Ni extends oi{static getDefaults(){return l(l({},super.getDefaults()),Ni.ownDefaults)}constructor(t){super(),Object.assign(this,this.constructor.createControls(),Ni.ownDefaults),this.setOptions(t)}static createControls(){return{controls:Fi()}}_updateCacheCanvas(){const t=this.canvas;if(this.noScaleCache&&t&&t._currentTransform){const e=t._currentTransform,s=e.target,i=e.action;if(this===s&&i&&i.startsWith(J))return!1}return super._updateCacheCanvas()}getActiveControl(){const t=this.__corner;return t?{key:t,control:this.controls[t],coord:this.oCoords[t]}:void 0}findControl(t){let e=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(!this.hasControls||!this.canvas)return;this.__corner=void 0;const s=Object.entries(this.oCoords);for(let i=s.length-1;i>=0;i--){const[n,r]=s[i],o=this.controls[n];if(o.shouldActivate(n,this,t,e?r.touchCorner:r.corner))return this.__corner=n,{key:n,control:o,coord:this.oCoords[n]}}}calcOCoords(){const t=this.getViewportTransform(),e=this.getCenterPoint(),s=Lt(e.x,e.y),i=jt({angle:this.getTotalAngle()-(this.group&&this.flipX?180:0)}),n=It(s,i),r=It(t,n),o=It(r,[1/t[0],0,0,1/t[3],0,0]),a=this.group?Ft(this.calcTransformMatrix()):void 0;a&&(a.scaleX=Math.abs(a.scaleX),a.scaleY=Math.abs(a.scaleY));const h=this._calculateCurrentDimensions(a),c={};return this.forEachControl(((t,e)=>{const s=t.positionHandler(h,o,this,t);c[e]=Object.assign(s,this._calcCornerCoords(t,s))})),c}_calcCornerCoords(t,e){const s=this.getTotalAngle();return{corner:t.calcCornerCoords(s,this.cornerSize,e.x,e.y,!1,this),touchCorner:t.calcCornerCoords(s,this.touchCornerSize,e.x,e.y,!0,this)}}setCoords(){super.setCoords(),this.canvas&&(this.oCoords=this.calcOCoords())}forEachControl(t){for(const e in this.controls)t(this.controls[e],e,this)}drawSelectionBackground(t){if(!this.selectionBackgroundColor||this.canvas&&this.canvas._activeObject!==this)return;t.save();const e=this.getRelativeCenterPoint(),s=this._calculateCurrentDimensions(),i=this.getViewportTransform();t.translate(e.x,e.y),t.scale(1/i[0],1/i[3]),t.rotate(At(this.angle)),t.fillStyle=this.selectionBackgroundColor,t.fillRect(-s.x/2,-s.y/2,s.x,s.y),t.restore()}strokeBorders(t,e){t.strokeRect(-e.x/2,-e.y/2,e.x,e.y)}_drawBorders(t,e){let s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};const i=l({hasControls:this.hasControls,borderColor:this.borderColor,borderDashArray:this.borderDashArray},s);t.save(),t.strokeStyle=i.borderColor,this._setLineDash(t,i.borderDashArray),this.strokeBorders(t,e),i.hasControls&&this.drawControlsConnectingLines(t,e),t.restore()}_renderControls(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const{hasBorders:s,hasControls:i}=this,n=l({hasBorders:s,hasControls:i},e),r=this.getViewportTransform(),o=n.hasBorders,a=n.hasControls,h=It(r,this.calcTransformMatrix()),c=Ft(h);t.save(),t.translate(c.translateX,c.translateY),t.lineWidth=this.borderScaleFactor,this.group===this.parent&&(t.globalAlpha=this.isMoving?this.borderOpacityWhenMoving:1),this.flipX&&(c.angle-=180),t.rotate(At(this.group?c.angle:this.angle)),o&&this.drawBorders(t,c,e),a&&this.drawControls(t,e),t.restore()}drawBorders(t,e,s){let i;if(s&&s.forActiveSelection||this.group){const t=Ce(this.width,this.height,Yt(e)),s=this.isStrokeAccountedForInDimensions()?pt:(this.strokeUniform?(new gt).scalarAdd(this.canvas?this.canvas.getZoom():1):new gt(e.scaleX,e.scaleY)).scalarMultiply(this.strokeWidth);i=t.add(s).scalarAdd(this.borderScaleFactor).scalarAdd(2*this.padding)}else i=this._calculateCurrentDimensions().scalarAdd(this.borderScaleFactor);this._drawBorders(t,i,s)}drawControlsConnectingLines(t,e){let s=!1;t.beginPath(),this.forEachControl(((i,n)=>{i.withConnection&&i.getVisibility(this,n)&&(s=!0,t.moveTo(i.x*e.x,i.y*e.y),t.lineTo(i.x*e.x+i.offsetX,i.y*e.y+i.offsetY))})),s&&t.stroke()}drawControls(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};t.save();const s=this.getCanvasRetinaScaling(),{cornerStrokeColor:i,cornerDashArray:n,cornerColor:r}=this,o=l({cornerStrokeColor:i,cornerDashArray:n,cornerColor:r},e);t.setTransform(s,0,0,s,0,0),t.strokeStyle=t.fillStyle=o.cornerColor,this.transparentCorners||(t.strokeStyle=o.cornerStrokeColor),this._setLineDash(t,o.cornerDashArray),this.forEachControl(((e,s)=>{if(e.getVisibility(this,s)){const i=this.oCoords[s];e.render(t,i.x,i.y,o,this)}})),t.restore()}isControlVisible(t){return this.controls[t]&&this.controls[t].getVisibility(this,t)}setControlVisible(t,e){this._controlsVisibility||(this._controlsVisibility={}),this._controlsVisibility[t]=e}setControlsVisibility(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};Object.entries(t).forEach((t=>{let[e,s]=t;return this.setControlVisible(e,s)}))}clearContextTop(t){if(!this.canvas)return;const e=this.canvas.contextTop;if(!e)return;const s=this.canvas.viewportTransform;e.save(),e.transform(s[0],s[1],s[2],s[3],s[4],s[5]),this.transform(e);const i=this.width+4,n=this.height+4;return e.clearRect(-i/2,-n/2,i,n),t||e.restore(),e}onDeselect(t){return!1}onSelect(t){return!1}shouldStartDragging(t){return!1}onDragStart(t){return!1}canDrop(t){return!1}renderDragSourceEffect(t){}renderDropTargetEffect(t){}}function Bi(t,e){return e.forEach((e=>{Object.getOwnPropertyNames(e.prototype).forEach((s=>{"constructor"!==s&&Object.defineProperty(t.prototype,s,Object.getOwnPropertyDescriptor(e.prototype,s)||Object.create(null))}))})),t}h(Ni,"ownDefaults",{noScaleCache:!0,lockMovementX:!1,lockMovementY:!1,lockRotation:!1,lockScalingX:!1,lockScalingY:!1,lockSkewingX:!1,lockSkewingY:!1,lockScalingFlip:!1,cornerSize:13,touchCornerSize:24,transparentCorners:!0,cornerColor:"rgb(178,204,255)",cornerStrokeColor:"",cornerStyle:"rect",cornerDashArray:null,hasControls:!0,borderColor:"rgb(178,204,255)",borderDashArray:null,borderOpacityWhenMoving:.4,borderScaleFactor:1,hasBorders:!0,selectionBackgroundColor:"",selectable:!0,evented:!0,perPixelTargetFind:!1,activeOn:"down",hoverCursor:null,moveCursor:null});class Wi extends Ni{}Bi(Wi,[He]),at.setClass(Wi),at.setClass(Wi,"object");const Ui=(t,e,s,i)=>{const n=2*(i=Math.round(i))+1,{data:r}=t.getImageData(e-i,s-i,n,n);for(let o=3;o<r.length;o+=4)if(r[o]>0)return!1;return!0};class Yi{constructor(t){this.options=t,this.strokeProjectionMagnitude=this.options.strokeWidth/2,this.scale=new gt(this.options.scaleX,this.options.scaleY),this.strokeUniformScalar=this.options.strokeUniform?new gt(1/this.options.scaleX,1/this.options.scaleY):new gt(1,1)}createSideVector(t,e){const s=ws(t,e);return this.options.strokeUniform?s.multiply(this.scale):s}projectOrthogonally(t,e,s){return this.applySkew(t.add(this.calcOrthogonalProjection(t,e,s)))}isSkewed(){return 0!==this.options.skewX||0!==this.options.skewY}applySkew(t){const e=new gt(t);return e.y+=e.x*Math.tan(At(this.options.skewY)),e.x+=e.y*Math.tan(At(this.options.skewX)),e}scaleUnitVector(t,e){return t.multiply(this.strokeUniformScalar).scalarMultiply(e)}}const Xi=new gt;class Vi extends Yi{static getOrthogonalRotationFactor(t,e){const s=e?Ss(t,e):Ts(t);return Math.abs(s)<O?-1:1}constructor(t,e,s,i){super(i),h(this,"AB",void 0),h(this,"AC",void 0),h(this,"alpha",void 0),h(this,"bisector",void 0),this.A=new gt(t),this.B=new gt(e),this.C=new gt(s),this.AB=this.createSideVector(this.A,this.B),this.AC=this.createSideVector(this.A,this.C),this.alpha=Ss(this.AB,this.AC),this.bisector=ks(bs(this.AB.eq(Xi)?this.AC:this.AB,this.alpha/2))}calcOrthogonalProjection(t,e){let s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:this.strokeProjectionMagnitude;const i=this.createSideVector(t,e),n=As(i),r=Vi.getOrthogonalRotationFactor(n,this.bisector);return this.scaleUnitVector(n,s*r)}projectBevel(){const t=[];return(this.alpha%D==0?[this.B]:[this.B,this.C]).forEach((e=>{t.push(this.projectOrthogonally(this.A,e)),t.push(this.projectOrthogonally(this.A,e,-this.strokeProjectionMagnitude))})),t}projectMiter(){const t=[],e=Math.abs(this.alpha),s=1/Math.sin(e/2),i=this.scaleUnitVector(this.bisector,-this.strokeProjectionMagnitude*s),n=this.options.strokeUniform?xs(this.scaleUnitVector(this.bisector,this.options.strokeMiterLimit)):this.options.strokeMiterLimit;return xs(i)/this.strokeProjectionMagnitude<=n&&t.push(this.applySkew(this.A.add(i))),t.push(...this.projectBevel()),t}projectRoundNoSkew(t,e){const s=[],i=new gt(Vi.getOrthogonalRotationFactor(this.bisector),Vi.getOrthogonalRotationFactor(new gt(this.bisector.y,this.bisector.x)));return[new gt(1,0).scalarMultiply(this.strokeProjectionMagnitude).multiply(this.strokeUniformScalar).multiply(i),new gt(0,1).scalarMultiply(this.strokeProjectionMagnitude).multiply(this.strokeUniformScalar).multiply(i)].forEach((i=>{Ds(i,t,e)&&s.push(this.A.add(i))})),s}projectRoundWithSkew(t,e){const s=[],{skewX:i,skewY:n,scaleX:r,scaleY:o,strokeUniform:a}=this.options,h=new gt(Math.tan(At(i)),Math.tan(At(n))),c=this.strokeProjectionMagnitude,l=a?c/o/Math.sqrt(1/o**2+1/r**2*h.y**2):c/Math.sqrt(1+h.y**2),u=new gt(Math.sqrt(Math.max(c**2-l**2,0)),l),d=a?c/Math.sqrt(1+h.x**2*(1/o)**2/(1/r+1/r*h.x*h.y)**2):c/Math.sqrt(1+h.x**2/(1+h.x*h.y)**2),g=new gt(d,Math.sqrt(Math.max(c**2-d**2,0)));return[g,g.scalarMultiply(-1),u,u.scalarMultiply(-1)].map((t=>this.applySkew(a?t.multiply(this.strokeUniformScalar):t))).forEach((i=>{Ds(i,t,e)&&s.push(this.applySkew(this.A).add(i))})),s}projectRound(){const t=[];t.push(...this.projectBevel());const e=this.alpha%D==0,s=this.applySkew(this.A),i=t[e?0:2].subtract(s),n=t[e?1:0].subtract(s),r=e?this.applySkew(this.AB.scalarMultiply(-1)):this.applySkew(this.bisector.multiply(this.strokeUniformScalar).scalarMultiply(-1)),o=Es(i,r)>0,a=o?i:n,h=o?n:i;return this.isSkewed()?t.push(...this.projectRoundWithSkew(a,h)):t.push(...this.projectRoundNoSkew(a,h)),t}projectPoints(){switch(this.options.strokeLineJoin){case"miter":return this.projectMiter();case"round":return this.projectRound();default:return this.projectBevel()}}project(){return this.projectPoints().map((t=>({originPoint:this.A,projectedPoint:t,angle:this.alpha,bisector:this.bisector})))}}class Gi extends Yi{constructor(t,e,s){super(s),this.A=new gt(t),this.T=new gt(e)}calcOrthogonalProjection(t,e){let s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:this.strokeProjectionMagnitude;const i=this.createSideVector(t,e);return this.scaleUnitVector(As(i),s)}projectButt(){return[this.projectOrthogonally(this.A,this.T,this.strokeProjectionMagnitude),this.projectOrthogonally(this.A,this.T,-this.strokeProjectionMagnitude)]}projectRound(){const t=[];if(!this.isSkewed()&&this.A.eq(this.T)){const e=new gt(1,1).scalarMultiply(this.strokeProjectionMagnitude).multiply(this.strokeUniformScalar);t.push(this.applySkew(this.A.add(e)),this.applySkew(this.A.subtract(e)))}else t.push(...new Vi(this.A,this.T,this.T,this.options).projectRound());return t}projectSquare(){const t=[];if(this.A.eq(this.T)){const e=new gt(1,1).scalarMultiply(this.strokeProjectionMagnitude).multiply(this.strokeUniformScalar);t.push(this.A.add(e),this.A.subtract(e))}else{const e=this.calcOrthogonalProjection(this.A,this.T,this.strokeProjectionMagnitude),s=this.scaleUnitVector(ks(this.createSideVector(this.A,this.T)),-this.strokeProjectionMagnitude),i=this.A.add(s);t.push(i.add(e),i.subtract(e))}return t.map((t=>this.applySkew(t)))}projectPoints(){switch(this.options.strokeLineCap){case"round":return this.projectRound();case"square":return this.projectSquare();default:return this.projectButt()}}project(){return this.projectPoints().map((t=>({originPoint:this.A,projectedPoint:t})))}}const Hi=function(t,e){let s=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const i=[];if(0===t.length)return i;const n=t.reduce(((t,e)=>(t[t.length-1].eq(e)||t.push(new gt(e)),t)),[new gt(t[0])]);if(1===n.length)s=!0;else if(!s){const t=n[0],e=((t,e)=>{for(let s=t.length-1;s>=0;s--)if(e(t[s],s,t))return s;return-1})(n,(e=>!e.eq(t)));n.splice(e+1)}return n.forEach(((t,n,r)=>{let o,a;0===n?(a=r[1],o=s?t:r[r.length-1]):n===r.length-1?(o=r[n-1],a=s?t:r[0]):(o=r[n-1],a=r[n+1]),s&&1===r.length?i.push(...new Gi(t,t,e).project()):!s||0!==n&&n!==r.length-1?i.push(...new Vi(t,o,a,e).project()):i.push(...new Gi(t,0===n?a:o,e).project())})),i},zi=t=>{const e={};return Object.keys(t).forEach((s=>{e[s]={},Object.keys(t[s]).forEach((i=>{e[s][i]=l({},t[s][i])}))})),e},qi=t=>t.replace(/&/g,"&amp;").replace(/"/g,"&quot;").replace(/'/g,"&apos;").replace(/</g,"&lt;").replace(/>/g,"&gt;");let Ki;const Qi=t=>{if(Ki||Ki||(Ki="Intl"in S()&&"Segmenter"in Intl&&new Intl.Segmenter(void 0,{granularity:"grapheme"})),Ki){const e=Ki.segment(t);return Array.from(e).map((t=>{let{segment:e}=t;return e}))}return Ji(t)},Ji=t=>{const e=[];for(let s,i=0;i<t.length;i++)!1!==(s=Zi(t,i))&&e.push(s);return e},Zi=(t,e)=>{const s=t.charCodeAt(e);if(isNaN(s))return"";if(s<55296||s>57343)return t.charAt(e);if(55296<=s&&s<=56319){if(t.length<=e+1)throw"High surrogate without following low surrogate";const s=t.charCodeAt(e+1);if(56320>s||s>57343)throw"High surrogate without following low surrogate";return t.charAt(e)+t.charAt(e+1)}if(0===e)throw"Low surrogate without preceding high surrogate";const i=t.charCodeAt(e-1);if(55296>i||i>56319)throw"Low surrogate without preceding high surrogate";return!1};var $i=Object.freeze({__proto__:null,capitalize:function(t){let e=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return"".concat(t.charAt(0).toUpperCase()).concat(e?t.slice(1):t.slice(1).toLowerCase())},escapeXml:qi,graphemeSplit:Qi});const tn=function(t,e){let s=arguments.length>2&&void 0!==arguments[2]&&arguments[2];return t.fill!==e.fill||t.stroke!==e.stroke||t.strokeWidth!==e.strokeWidth||t.fontSize!==e.fontSize||t.fontFamily!==e.fontFamily||t.fontWeight!==e.fontWeight||t.fontStyle!==e.fontStyle||t.textDecorationThickness!==e.textDecorationThickness||t.textBackgroundColor!==e.textBackgroundColor||t.deltaY!==e.deltaY||s&&(t.overline!==e.overline||t.underline!==e.underline||t.linethrough!==e.linethrough)},en=(t,e)=>{const s=e.split("\n"),i=[];let n=-1,r={};t=zi(t);for(let o=0;o<s.length;o++){const e=Qi(s[o]);if(t[o])for(let s=0;s<e.length;s++){n++;const e=t[o][s];e&&Object.keys(e).length>0&&(tn(r,e,!0)?i.push({start:n,end:n+1,style:e}):i[i.length-1].end++),r=e||{}}else n+=e.length,r={}}return i},sn=(t,e)=>{if(!Array.isArray(t))return zi(t);const s=e.split(U),i={};let n=-1,r=0;for(let o=0;o<s.length;o++){const e=Qi(s[o]);for(let s=0;s<e.length;s++)n++,t[r]&&t[r].start<=n&&n<t[r].end&&(i[o]=i[o]||{},i[o][s]=l({},t[r].style),n===t[r].end-1&&r++)}return i},nn=["display","transform",st,"fill-opacity","fill-rule","opacity",it,"stroke-dasharray","stroke-linecap","stroke-dashoffset","stroke-linejoin","stroke-miterlimit","stroke-opacity","stroke-width","id","paint-order","vector-effect","instantiated_by_use","clip-path"];function rn(t,e){const s=t.nodeName,i=t.getAttribute("class"),n=t.getAttribute("id"),r="(?![a-zA-Z\\-]+)";let o;if(o=new RegExp("^"+s,"i"),e=e.replace(o,""),n&&e.length&&(o=new RegExp("#"+n+r,"i"),e=e.replace(o,"")),i&&e.length){const t=i.split(" ");for(let s=t.length;s--;)o=new RegExp("\\."+t[s]+r,"i"),e=e.replace(o,"")}return 0===e.length}function on(t,e){let s=!0;const i=rn(t,e.pop());return i&&e.length&&(s=function(t,e){let s,i=!0;for(;t.parentElement&&1===t.parentElement.nodeType&&e.length;)i&&(s=e.pop()),i=rn(t=t.parentElement,s);return 0===e.length}(t,e)),i&&s&&0===e.length}const an=t=>{var e;return null!==(e=ds[t])&&void 0!==e?e:t},hn=new RegExp("(".concat(hs,")"),"gi"),cn=t=>t.replace(hn," $1 ").replace(/,/gi," ").replace(/\s+/gi," ");var ln,un,dn,gn,pn,fn,mn;const _n="(".concat(hs,")"),vn=String.raw(ln||(ln=d(["(skewX)(",")"],["(skewX)\\(","\\)"])),_n),yn=String.raw(un||(un=d(["(skewY)(",")"],["(skewY)\\(","\\)"])),_n),Cn=String.raw(dn||(dn=d(["(rotate)(","(?: "," ",")?)"],["(rotate)\\(","(?: "," ",")?\\)"])),_n,_n,_n),bn=String.raw(gn||(gn=d(["(scale)(","(?: ",")?)"],["(scale)\\(","(?: ",")?\\)"])),_n,_n),wn=String.raw(pn||(pn=d(["(translate)(","(?: ",")?)"],["(translate)\\(","(?: ",")?\\)"])),_n,_n),xn=String.raw(fn||(fn=d(["(matrix)("," "," "," "," "," ",")"],["(matrix)\\("," "," "," "," "," ","\\)"])),_n,_n,_n,_n,_n,_n),Sn="(?:".concat(xn,"|").concat(wn,"|").concat(Cn,"|").concat(bn,"|").concat(vn,"|").concat(yn,")"),Tn="(?:".concat(Sn,"*)"),kn=String.raw(mn||(mn=d(["^s*(?:","?)s*$"],["^\\s*(?:","?)\\s*$"])),Tn),An=new RegExp(kn),En=new RegExp(Sn),On=new RegExp(Sn,"g");function Dn(t){const e=[];if(!(t=cn(t).replace(/\s*([()])\s*/gi,"$1"))||t&&!An.test(t))return[...I];for(const s of t.matchAll(On)){const t=En.exec(s[0]);if(!t)continue;let i=I;const n=t.filter((t=>!!t)),[,r,...o]=n,[a,h,c,l,u,d]=o.map((t=>parseFloat(t)));switch(r){case"translate":i=Lt(a,h);break;case G:i=jt({angle:a},{x:h,y:c});break;case J:i=Nt(a,h);break;case tt:i=Wt(a);break;case et:i=Ut(a);break;case"matrix":i=[a,h,c,l,u,d]}e.push(i)}return Mt(e)}function Pn(t,e,s,i){const n=Array.isArray(e);let r,o=e;if(t!==st&&t!==it||e!==W){if("strokeUniform"===t)return"non-scaling-stroke"===e;if("strokeDashArray"===t)o=e===W?null:e.replace(/,/g," ").split(/\s+/).map(parseFloat);else if("transformMatrix"===t)o=s&&s.transformMatrix?It(s.transformMatrix,Dn(e)):Dn(e);else if("visible"===t)o=e!==W&&"hidden"!==e,s&&!1===s.visible&&(o=!1);else if("opacity"===t)o=parseFloat(e),s&&void 0!==s.opacity&&(o*=s.opacity);else if("textAnchor"===t)o="start"===e?L:"end"===e?B:F;else if("charSpacing"===t||t===qe)r=Xe(e,i)/i*1e3;else if("paintFirst"===t){const t=e.indexOf(st),s=e.indexOf(it);o=st,(t>-1&&s>-1&&s<t||-1===t&&s>-1)&&(o=it)}else{if("href"===t||"xlink:href"===t||"font"===t||"id"===t)return e;if("imageSmoothing"===t)return"optimizeQuality"===e;r=n?e.map(Xe):Xe(e,i)}}else o="";return!n&&isNaN(r)?o:r}function In(t,e){const s=t.match(us);if(!s)return;const i=s[1],n=s[3],r=s[4],o=s[5],a=s[6];i&&(e.fontStyle=i),n&&(e.fontWeight=isNaN(parseFloat(n))?n:parseFloat(n)),r&&(e.fontSize=Xe(r)),a&&(e.fontFamily=a),o&&(e.lineHeight="normal"===o?1:o)}function Mn(t,e){t.replace(/;\s*$/,"").split(";").forEach((t=>{if(!t)return;const[s,i]=t.split(":");e[s.trim().toLowerCase()]=i.trim()}))}function Rn(t){const e={},s=t.getAttribute("style");return s?("string"==typeof s?Mn(s,e):function(t,e){Object.entries(t).forEach((t=>{let[s,i]=t;void 0!==i&&(e[s.toLowerCase()]=i)}))}(s,e),e):e}const Fn={stroke:"strokeOpacity",fill:"fillOpacity"};function Ln(t,e,s){if(!t)return{};let i,n={},r=M;t.parentNode&&_s.test(t.parentNode.nodeName)&&(n=Ln(t.parentElement,e,s),n.fontSize&&(i=r=Xe(n.fontSize)));const o=l(l(l({},e.reduce(((e,s)=>{const i=t.getAttribute(s);return i&&(e[s]=i),e}),{})),function(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},s={};for(const i in e)on(t,i.split(" "))&&(s=l(l({},s),e[i]));return s}(t,s)),Rn(t));o[ps]&&t.setAttribute(ps,o[ps]),o[gs]&&(i=Xe(o[gs],r),o[gs]="".concat(i));const a={};for(const c in o){const t=an(c),e=Pn(t,o[c],n,i);a[t]=e}a&&a.font&&In(a.font,a);const h=l(l({},n),a);return _s.test(t.nodeName)?h:function(t){const e=Wi.getDefaults();return Object.entries(Fn).forEach((s=>{let[i,n]=s;if(void 0===t[n]||""===t[i])return;if(void 0===t[i]){if(!e[i])return;t[i]=e[i]}if(0===t[i].indexOf("url("))return;const r=new Ye(t[i]);t[i]=r.setAlpha(Kt(r.getAlpha()*t[n],2)).toRgba()})),t}(h)}const jn=["left","top","width","height","visible"],Nn=["rx","ry"];class Bn extends Wi{static getDefaults(){return l(l({},super.getDefaults()),Bn.ownDefaults)}constructor(t){super(),Object.assign(this,Bn.ownDefaults),this.setOptions(t),this._initRxRy()}_initRxRy(){const{rx:t,ry:e}=this;t&&!e?this.ry=t:e&&!t&&(this.rx=e)}_render(t){const{width:e,height:s}=this,i=-e/2,n=-s/2,r=this.rx?Math.min(this.rx,e/2):0,o=this.ry?Math.min(this.ry,s/2):0,a=0!==r||0!==o;t.beginPath(),t.moveTo(i+r,n),t.lineTo(i+e-r,n),a&&t.bezierCurveTo(i+e-R*r,n,i+e,n+R*o,i+e,n+o),t.lineTo(i+e,n+s-o),a&&t.bezierCurveTo(i+e,n+s-R*o,i+e-R*r,n+s,i+e-r,n+s),t.lineTo(i+r,n+s),a&&t.bezierCurveTo(i+R*r,n+s,i,n+s-R*o,i,n+s-o),t.lineTo(i,n+o),a&&t.bezierCurveTo(i,n+R*o,i+R*r,n,i+r,n),t.closePath(),this._renderPaintInOrder(t)}toObject(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];return super.toObject([...Nn,...t])}_toSVG(){const{width:t,height:e,rx:s,ry:i}=this;return["<rect ","COMMON_PARTS",'x="'.concat(-t/2,'" y="').concat(-e/2,'" rx="').concat(s,'" ry="').concat(i,'" width="').concat(t,'" height="').concat(e,'" />\n')]}static async fromElement(t,e,s){const i=Ln(t,this.ATTRIBUTE_NAMES,s),{left:n=0,top:r=0,width:o=0,height:a=0,visible:h=!0}=i,c=u(i,jn);return new this(l(l(l({},e),c),{},{left:n,top:r,width:o,height:a,visible:Boolean(h&&o&&a)}))}}h(Bn,"type","Rect"),h(Bn,"cacheProperties",[...Ls,...Nn]),h(Bn,"ownDefaults",{rx:0,ry:0}),h(Bn,"ATTRIBUTE_NAMES",[...nn,"x","y","rx","ry","width","height"]),at.setClass(Bn),at.setSVGClass(Bn);const Wn="initialization",Un="added",Yn="removed",Xn="imperative",Vn=(t,e)=>{const{strokeUniform:s,strokeWidth:i,width:n,height:r,group:o}=e,a=o&&o!==t?be(o.calcTransformMatrix(),t.calcTransformMatrix()):null,h=a?e.getRelativeCenterPoint().transform(a):e.getRelativeCenterPoint(),c=!e.isStrokeAccountedForInDimensions(),l=s&&c?xe(new gt(i,i),void 0,t.calcTransformMatrix()):pt,u=!s&&c?i:0,d=Ce(n+u,r+u,Mt([a,e.calcOwnMatrix()],!0)).add(l).scalarDivide(2);return[h.subtract(d),h.add(d)]};class Gn{calcLayoutResult(t,e){if(this.shouldPerformLayout(t))return this.calcBoundingBox(e,t)}shouldPerformLayout(t){let{type:e,prevStrategy:s,strategy:i}=t;return e===Wn||e===Xn||!!s&&i!==s}shouldLayoutClipPath(t){let{type:e,target:{clipPath:s}}=t;return e!==Wn&&s&&!s.absolutePositioned}getInitialSize(t,e){return e.size}calcBoundingBox(t,e){const{type:s,target:i}=e;if(s===Xn&&e.overrides)return e.overrides;if(0===t.length)return;const{left:n,top:r,width:o,height:a}=pe(t.map((t=>Vn(i,t))).reduce(((t,e)=>t.concat(e)),[])),h=new gt(o,a),c=new gt(n,r).add(h.scalarDivide(2));if(s===Wn){const t=this.getInitialSize(e,{size:h,center:c});return{center:c,relativeCorrection:new gt(0,0),size:t}}return{center:c.transform(i.calcOwnMatrix()),size:h}}}h(Gn,"type","strategy");class Hn extends Gn{shouldPerformLayout(t){return!0}}h(Hn,"type","fit-content"),at.setClass(Hn);const zn=["strategy"],qn=["target","strategy","bubbles","prevStrategy"],Kn="layoutManager";class Qn{constructor(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new Hn;h(this,"strategy",void 0),this.strategy=t,this._subscriptions=new Map}performLayout(t){const e=l(l({bubbles:!0,strategy:this.strategy},t),{},{prevStrategy:this._prevLayoutStrategy,stopPropagation(){this.bubbles=!1}});this.onBeforeLayout(e);const s=this.getLayoutResult(e);s&&this.commitLayout(e,s),this.onAfterLayout(e,s),this._prevLayoutStrategy=e.strategy}attachHandlers(t,e){const{target:s}=e;return[nt,Y,z,V,X,H,Q,q,K].map((e=>t.on(e,(t=>this.performLayout(e===nt?{type:"object_modified",trigger:e,e:t,target:s}:{type:"object_modifying",trigger:e,e:t,target:s})))))}subscribe(t,e){this.unsubscribe(t,e);const s=this.attachHandlers(t,e);this._subscriptions.set(t,s)}unsubscribe(t,e){(this._subscriptions.get(t)||[]).forEach((t=>t())),this._subscriptions.delete(t)}unsubscribeTargets(t){t.targets.forEach((e=>this.unsubscribe(e,t)))}subscribeTargets(t){t.targets.forEach((e=>this.subscribe(e,t)))}onBeforeLayout(t){const{target:e,type:s}=t,{canvas:i}=e;if(s===Wn||s===Un?this.subscribeTargets(t):s===Yn&&this.unsubscribeTargets(t),e.fire("layout:before",{context:t}),i&&i.fire("object:layout:before",{target:e,context:t}),s===Xn&&t.deep){const s=u(t,zn);e.forEachObject((t=>t.layoutManager&&t.layoutManager.performLayout(l(l({},s),{},{bubbles:!1,target:t}))))}}getLayoutResult(t){const{target:e,strategy:s,type:i}=t,n=s.calcLayoutResult(t,e.getObjects());if(!n)return;const r=i===Wn?new gt:e.getRelativeCenterPoint(),{center:o,correction:a=new gt,relativeCorrection:h=new gt}=n,c=r.subtract(o).add(a).transform(i===Wn?I:Pt(e.calcOwnMatrix()),!0).add(h);return{result:n,prevCenter:r,nextCenter:o,offset:c}}commitLayout(t,e){const{target:s}=t,{result:{size:i},nextCenter:n}=e;var r,o;s.set({width:i.x,height:i.y}),this.layoutObjects(t,e),t.type===Wn?s.set({left:null!==(r=t.x)&&void 0!==r?r:n.x+i.x*Ae(s.originX),top:null!==(o=t.y)&&void 0!==o?o:n.y+i.y*Ae(s.originY)}):(s.setPositionByOrigin(n,F,F),s.setCoords(),s.set("dirty",!0))}layoutObjects(t,e){const{target:s}=t;s.forEachObject((i=>{i.group===s&&this.layoutObject(t,e,i)})),t.strategy.shouldLayoutClipPath(t)&&this.layoutObject(t,e,s.clipPath)}layoutObject(t,e,s){let{offset:i}=e;s.set({left:s.left+i.x,top:s.top+i.y})}onAfterLayout(t,e){const{target:s,strategy:i,bubbles:n,prevStrategy:r}=t,o=u(t,qn),{canvas:a}=s;s.fire("layout:after",{context:t,result:e}),a&&a.fire("object:layout:after",{context:t,result:e,target:s});const h=s.parent;n&&null!=h&&h.layoutManager&&((o.path||(o.path=[])).push(s),h.layoutManager.performLayout(l(l({},o),{},{target:h}))),s.set("dirty",!0)}dispose(){const{_subscriptions:t}=this;t.forEach((t=>t.forEach((t=>t())))),t.clear()}toObject(){return{type:Kn,strategy:this.strategy.constructor.type}}toJSON(){return this.toObject()}}at.setClass(Qn,Kn);const Jn=["type","objects","layoutManager"];class Zn extends Qn{performLayout(){}}class $n extends(mt(Wi)){static getDefaults(){return l(l({},super.getDefaults()),$n.ownDefaults)}constructor(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};super(),h(this,"_activeObjects",[]),h(this,"__objectSelectionTracker",void 0),h(this,"__objectSelectionDisposer",void 0),Object.assign(this,$n.ownDefaults),this.setOptions(e),this.groupInit(t,e)}groupInit(t,e){var s;this._objects=[...t],this.__objectSelectionTracker=this.__objectSelectionMonitor.bind(this,!0),this.__objectSelectionDisposer=this.__objectSelectionMonitor.bind(this,!1),this.forEachObject((t=>{this.enterGroup(t,!1)})),this.layoutManager=null!==(s=e.layoutManager)&&void 0!==s?s:new Qn,this.layoutManager.performLayout({type:Wn,target:this,targets:[...t],x:e.left,y:e.top})}canEnterGroup(t){return t===this||this.isDescendantOf(t)?(f("error","Group: circular object trees are not supported, this call has no effect"),!1):-1===this._objects.indexOf(t)||(f("error","Group: duplicate objects are not supported inside group, this call has no effect"),!1)}_filterObjectsBeforeEnteringGroup(t){return t.filter(((t,e,s)=>this.canEnterGroup(t)&&s.indexOf(t)===e))}add(){for(var t=arguments.length,e=new Array(t),s=0;s<t;s++)e[s]=arguments[s];const i=this._filterObjectsBeforeEnteringGroup(e),n=super.add(...i);return this._onAfterObjectsChange(Un,i),n}insertAt(t){for(var e=arguments.length,s=new Array(e>1?e-1:0),i=1;i<e;i++)s[i-1]=arguments[i];const n=this._filterObjectsBeforeEnteringGroup(s),r=super.insertAt(t,...n);return this._onAfterObjectsChange(Un,n),r}remove(){const t=super.remove(...arguments);return this._onAfterObjectsChange(Yn,t),t}_onObjectAdded(t){this.enterGroup(t,!0),this.fire("object:added",{target:t}),t.fire("added",{target:this})}_onObjectRemoved(t,e){this.exitGroup(t,e),this.fire("object:removed",{target:t}),t.fire("removed",{target:this})}_onAfterObjectsChange(t,e){this.layoutManager.performLayout({type:t,targets:e,target:this})}_onStackOrderChanged(){this._set("dirty",!0)}_set(t,e){const s=this[t];return super._set(t,e),"canvas"===t&&s!==e&&(this._objects||[]).forEach((s=>{s._set(t,e)})),this}_shouldSetNestedCoords(){return this.subTargetCheck}removeAll(){return this._activeObjects=[],this.remove(...this._objects)}__objectSelectionMonitor(t,e){let{target:s}=e;const i=this._activeObjects;if(t)i.push(s),this._set("dirty",!0);else if(i.length>0){const t=i.indexOf(s);t>-1&&(i.splice(t,1),this._set("dirty",!0))}}_watchObject(t,e){t&&this._watchObject(!1,e),t?(e.on("selected",this.__objectSelectionTracker),e.on("deselected",this.__objectSelectionDisposer)):(e.off("selected",this.__objectSelectionTracker),e.off("deselected",this.__objectSelectionDisposer))}enterGroup(t,e){t.group&&t.group.remove(t),t._set("parent",this),this._enterGroup(t,e)}_enterGroup(t,e){e&&_e(t,It(Pt(this.calcTransformMatrix()),t.calcTransformMatrix())),this._shouldSetNestedCoords()&&t.setCoords(),t._set("group",this),t._set("canvas",this.canvas),this._watchObject(!0,t);const s=this.canvas&&this.canvas.getActiveObject&&this.canvas.getActiveObject();s&&(s===t||t.isDescendantOf(s))&&this._activeObjects.push(t)}exitGroup(t,e){this._exitGroup(t,e),t._set("parent",void 0),t._set("canvas",void 0)}_exitGroup(t,e){t._set("group",void 0),e||(_e(t,It(this.calcTransformMatrix(),t.calcTransformMatrix())),t.setCoords()),this._watchObject(!1,t);const s=this._activeObjects.length>0?this._activeObjects.indexOf(t):-1;s>-1&&this._activeObjects.splice(s,1)}shouldCache(){const t=Wi.prototype.shouldCache.call(this);if(t)for(let e=0;e<this._objects.length;e++)if(this._objects[e].willDrawShadow())return this.ownCaching=!1,!1;return t}willDrawShadow(){if(super.willDrawShadow())return!0;for(let t=0;t<this._objects.length;t++)if(this._objects[t].willDrawShadow())return!0;return!1}isOnACache(){return this.ownCaching||!!this.parent&&this.parent.isOnACache()}drawObject(t,e,s){this._renderBackground(t);for(let n=0;n<this._objects.length;n++){var i;const e=this._objects[n];null!==(i=this.canvas)&&void 0!==i&&i.preserveObjectStacking&&e.group!==this?(t.save(),t.transform(...Pt(this.calcTransformMatrix())),e.render(t),t.restore()):e.group===this&&e.render(t)}this._drawClipPath(t,this.clipPath,s)}setCoords(){super.setCoords(),this._shouldSetNestedCoords()&&this.forEachObject((t=>t.setCoords()))}triggerLayout(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};this.layoutManager.performLayout(l({target:this,type:Xn},t))}render(t){this._transformDone=!0,super.render(t),this._transformDone=!1}__serializeObjects(t,e){const s=this.includeDefaultValues;return this._objects.filter((function(t){return!t.excludeFromExport})).map((function(i){const n=i.includeDefaultValues;i.includeDefaultValues=s;const r=i[t||"toObject"](e);return i.includeDefaultValues=n,r}))}toObject(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];const e=this.layoutManager.toObject();return l(l(l({},super.toObject(["subTargetCheck","interactive",...t])),"fit-content"!==e.strategy||this.includeDefaultValues?{layoutManager:e}:{}),{},{objects:this.__serializeObjects("toObject",t)})}toString(){return"#<Group: (".concat(this.complexity(),")>")}dispose(){this.layoutManager.unsubscribeTargets({targets:this.getObjects(),target:this}),this._activeObjects=[],this.forEachObject((t=>{this._watchObject(!1,t),t.dispose()})),super.dispose()}_createSVGBgRect(t){if(!this.backgroundColor)return"";const e=Bn.prototype._toSVG.call(this),s=e.indexOf("COMMON_PARTS");e[s]='for="group" ';const i=e.join("");return t?t(i):i}_toSVG(t){const e=["<g ","COMMON_PARTS"," >\n"],s=this._createSVGBgRect(t);s&&e.push("\t\t",s);for(let i=0;i<this._objects.length;i++)e.push("\t\t",this._objects[i].toSVG(t));return e.push("</g>\n"),e}getSvgStyles(){const t=void 0!==this.opacity&&1!==this.opacity?"opacity: ".concat(this.opacity,";"):"",e=this.visible?"":" visibility: hidden;";return[t,this.getSvgFilter(),e].join("")}toClipPathSVG(t){const e=[],s=this._createSVGBgRect(t);s&&e.push("\t",s);for(let i=0;i<this._objects.length;i++)e.push("\t",this._objects[i].toClipPathSVG(t));return this._createBaseClipPathSVGMarkup(e,{reviver:t})}static fromObject(t,e){let{type:s,objects:i=[],layoutManager:n}=t,r=u(t,Jn);return Promise.all([Gt(i,e),Ht(r,e)]).then((t=>{let[e,s]=t;const i=new this(e,l(l(l({},r),s),{},{layoutManager:new Zn}));if(n){const t=at.getClass(n.type),e=at.getClass(n.strategy);i.layoutManager=new t(new e)}else i.layoutManager=new Qn;return i.layoutManager.subscribeTargets({type:Wn,target:i,targets:i.getObjects()}),i.setCoords(),i}))}}h($n,"type","Group"),h($n,"ownDefaults",{strokeWidth:0,subTargetCheck:!1,interactive:!1}),at.setClass($n);const tr=(t,e)=>Math.min(e.width/t.width,e.height/t.height),er=(t,e)=>Math.max(e.width/t.width,e.height/t.height),sr="\\s*,?\\s*",ir="".concat(sr,"(").concat(hs,")"),nr="".concat(ir).concat(ir).concat(ir).concat(sr,"([01])").concat(sr,"([01])").concat(ir).concat(ir),rr={m:"l",M:"L"},or=(t,e,s,i,n,r,o,a,h,c,l)=>{const u=ut(t),d=dt(t),g=ut(e),p=dt(e),f=s*n*g-i*r*p+o,m=i*n*g+s*r*p+a;return["C",c+h*(-s*n*d-i*r*u),l+h*(-i*n*d+s*r*u),f+h*(s*n*p+i*r*g),m+h*(i*n*p-s*r*g),f,m]},ar=(t,e,s,i)=>{const n=Math.atan2(e,t),r=Math.atan2(i,s);return r>=n?r-n:2*Math.PI-(n-r)};function hr(t,e,s,i,n,r,o,a){let h;if(p.cachesBoundsOfCurve&&(h=[...arguments].join(),k.boundsOfCurveCache[h]))return k.boundsOfCurveCache[h];const c=Math.sqrt,l=Math.abs,u=[],d=[[0,0],[0,0]];let g=6*t-12*s+6*n,f=-3*t+9*s-9*n+3*o,m=3*s-3*t;for(let p=0;p<2;++p){if(p>0&&(g=6*e-12*i+6*r,f=-3*e+9*i-9*r+3*a,m=3*i-3*e),l(f)<1e-12){if(l(g)<1e-12)continue;const t=-m/g;0<t&&t<1&&u.push(t);continue}const t=g*g-4*m*f;if(t<0)continue;const s=c(t),n=(-g+s)/(2*f);0<n&&n<1&&u.push(n);const o=(-g-s)/(2*f);0<o&&o<1&&u.push(o)}let _=u.length;const v=_,y=dr(t,e,s,i,n,r,o,a);for(;_--;){const{x:t,y:e}=y(u[_]);d[0][_]=t,d[1][_]=e}d[0][v]=t,d[1][v]=e,d[0][v+1]=o,d[1][v+1]=a;const C=[new gt(Math.min(...d[0]),Math.min(...d[1])),new gt(Math.max(...d[0]),Math.max(...d[1]))];return p.cachesBoundsOfCurve&&(k.boundsOfCurveCache[h]=C),C}const cr=(t,e,s)=>{let[i,n,r,o,a,h,c,l]=s;const u=((t,e,s,i,n,r,o)=>{if(0===s||0===i)return[];let a=0,h=0,c=0;const l=Math.PI,u=o*P,d=dt(u),g=ut(u),p=.5*(-g*t-d*e),f=.5*(-g*e+d*t),m=s**2,_=i**2,v=f**2,y=p**2,C=m*_-m*v-_*y;let b=Math.abs(s),w=Math.abs(i);if(C<0){const t=Math.sqrt(1-C/(m*_));b*=t,w*=t}else c=(n===r?-1:1)*Math.sqrt(C/(m*v+_*y));const x=c*b*f/w,S=-c*w*p/b,T=g*x-d*S+.5*t,k=d*x+g*S+.5*e;let A=ar(1,0,(p-x)/b,(f-S)/w),E=ar((p-x)/b,(f-S)/w,(-p-x)/b,(-f-S)/w);0===r&&E>0?E-=2*l:1===r&&E<0&&(E+=2*l);const O=Math.ceil(Math.abs(E/l*2)),D=[],I=E/O,M=8/3*Math.sin(I/4)*Math.sin(I/4)/Math.sin(I/2);let R=A+I;for(let P=0;P<O;P++)D[P]=or(A,R,g,d,b,w,T,k,M,a,h),a=D[P][5],h=D[P][6],A=R,R+=I;return D})(c-t,l-e,n,r,a,h,o);for(let d=0,g=u.length;d<g;d++)u[d][1]+=t,u[d][2]+=e,u[d][3]+=t,u[d][4]+=e,u[d][5]+=t,u[d][6]+=e;return u},lr=t=>{let e=0,s=0,i=0,n=0;const r=[];let o,a=0,h=0;for(const c of t){const t=[...c];let l;switch(t[0]){case"l":t[1]+=e,t[2]+=s;case"L":e=t[1],s=t[2],l=["L",e,s];break;case"h":t[1]+=e;case"H":e=t[1],l=["L",e,s];break;case"v":t[1]+=s;case"V":s=t[1],l=["L",e,s];break;case"m":t[1]+=e,t[2]+=s;case"M":e=t[1],s=t[2],i=t[1],n=t[2],l=["M",e,s];break;case"c":t[1]+=e,t[2]+=s,t[3]+=e,t[4]+=s,t[5]+=e,t[6]+=s;case"C":a=t[3],h=t[4],e=t[5],s=t[6],l=["C",t[1],t[2],a,h,e,s];break;case"s":t[1]+=e,t[2]+=s,t[3]+=e,t[4]+=s;case"S":"C"===o?(a=2*e-a,h=2*s-h):(a=e,h=s),e=t[3],s=t[4],l=["C",a,h,t[1],t[2],e,s],a=l[3],h=l[4];break;case"q":t[1]+=e,t[2]+=s,t[3]+=e,t[4]+=s;case"Q":a=t[1],h=t[2],e=t[3],s=t[4],l=["Q",a,h,e,s];break;case"t":t[1]+=e,t[2]+=s;case"T":"Q"===o?(a=2*e-a,h=2*s-h):(a=e,h=s),e=t[1],s=t[2],l=["Q",a,h,e,s];break;case"a":t[6]+=e,t[7]+=s;case"A":cr(e,s,t).forEach((t=>r.push(t))),e=t[6],s=t[7];break;case"z":case"Z":e=i,s=n,l=["Z"]}l?(r.push(l),o=l[0]):o=""}return r},ur=(t,e,s,i)=>Math.sqrt((s-t)**2+(i-e)**2),dr=(t,e,s,i,n,r,o,a)=>h=>{const c=h**3,l=(t=>3*t**2*(1-t))(h),u=(t=>3*t*(1-t)**2)(h),d=(t=>(1-t)**3)(h);return new gt(o*c+n*l+s*u+t*d,a*c+r*l+i*u+e*d)},gr=t=>t**2,pr=t=>2*t*(1-t),fr=t=>(1-t)**2,mr=(t,e,s,i,n,r,o,a)=>h=>{const c=gr(h),l=pr(h),u=fr(h),d=3*(u*(s-t)+l*(n-s)+c*(o-n)),g=3*(u*(i-e)+l*(r-i)+c*(a-r));return Math.atan2(g,d)},_r=(t,e,s,i,n,r)=>o=>{const a=gr(o),h=pr(o),c=fr(o);return new gt(n*a+s*h+t*c,r*a+i*h+e*c)},vr=(t,e,s,i,n,r)=>o=>{const a=1-o,h=2*(a*(s-t)+o*(n-s)),c=2*(a*(i-e)+o*(r-i));return Math.atan2(c,h)},yr=(t,e,s)=>{let i=new gt(e,s),n=0;for(let r=1;r<=100;r+=1){const e=t(r/100);n+=ur(i.x,i.y,e.x,e.y),i=e}return n},Cr=(t,e)=>{let s,i=0,n=0,r={x:t.x,y:t.y},o=l({},r),a=.01,h=0;const c=t.iterator,u=t.angleFinder;for(;n<e&&a>1e-4;)o=c(i),h=i,s=ur(r.x,r.y,o.x,o.y),s+n>e?(i-=a,a/=2):(r=o,i+=a,n+=s);return l(l({},o),{},{angle:u(h)})},br=t=>{let e,s,i=0,n=0,r=0,o=0,a=0;const h=[];for(const c of t){const t={x:n,y:r,command:c[0],length:0};switch(c[0]){case"M":s=t,s.x=o=n=c[1],s.y=a=r=c[2];break;case"L":s=t,s.length=ur(n,r,c[1],c[2]),n=c[1],r=c[2];break;case"C":e=dr(n,r,c[1],c[2],c[3],c[4],c[5],c[6]),s=t,s.iterator=e,s.angleFinder=mr(n,r,c[1],c[2],c[3],c[4],c[5],c[6]),s.length=yr(e,n,r),n=c[5],r=c[6];break;case"Q":e=_r(n,r,c[1],c[2],c[3],c[4]),s=t,s.iterator=e,s.angleFinder=vr(n,r,c[1],c[2],c[3],c[4]),s.length=yr(e,n,r),n=c[3],r=c[4];break;case"Z":s=t,s.destX=o,s.destY=a,s.length=ur(n,r,o,a),n=o,r=a}i+=s.length,h.push(s)}return h.push({length:i,x:n,y:r}),h},wr=function(t,e){let s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:br(t),i=0;for(;e-s[i].length>0&&i<s.length-2;)e-=s[i].length,i++;const n=s[i],r=e/n.length,o=t[i];switch(n.command){case"M":return{x:n.x,y:n.y,angle:0};case"Z":return l(l({},new gt(n.x,n.y).lerp(new gt(n.destX,n.destY),r)),{},{angle:Math.atan2(n.destY-n.y,n.destX-n.x)});case"L":return l(l({},new gt(n.x,n.y).lerp(new gt(o[1],o[2]),r)),{},{angle:Math.atan2(o[2]-n.y,o[1]-n.x)});case"C":case"Q":return Cr(n,e)}},xr=new RegExp("[mzlhvcsqta][^mzlhvcsqta]*","gi"),Sr=new RegExp(nr,"g"),Tr=new RegExp(hs,"gi"),kr={m:2,l:2,h:1,v:1,c:6,s:4,q:4,t:2,a:7},Ar=t=>{var e;const s=[],i=null!==(e=t.match(xr))&&void 0!==e?e:[];for(const n of i){const t=n[0];if("z"===t||"Z"===t){s.push([t]);continue}const e=kr[t.toLowerCase()];let i=[];if("a"===t||"A"===t){Sr.lastIndex=0;for(let t=null;t=Sr.exec(n);)i.push(...t.slice(1))}else i=n.match(Tr)||[];for(let n=0;n<i.length;n+=e){const r=new Array(e),o=rr[t];r[0]=n>0&&o?o:t;for(let t=0;t<e;t++)r[t+1]=parseFloat(i[n+t]);s.push(r)}}return s},Er=function(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,s=new gt(t[0]),i=new gt(t[1]),n=1,r=0;const o=[],a=t.length,h=a>2;let c;for(h&&(n=t[2].x<i.x?-1:t[2].x===i.x?0:1,r=t[2].y<i.y?-1:t[2].y===i.y?0:1),o.push(["M",s.x-n*e,s.y-r*e]),c=1;c<a;c++){if(!s.eq(i)){const t=s.midPointFrom(i);o.push(["Q",s.x,s.y,t.x,t.y])}s=t[c],c+1<t.length&&(i=t[c+1])}return h&&(n=s.x>t[c-2].x?1:s.x===t[c-2].x?0:-1,r=s.y>t[c-2].y?1:s.y===t[c-2].y?0:-1),o.push(["L",s.x+n*e,s.y+r*e]),o},Or=(t,e)=>t.map((t=>t.map(((t,s)=>0===s||void 0===e?t:Kt(t,e))).join(" "))).join(" ");function Dr(t,e){const s=t.style;s&&e&&("string"==typeof e?s.cssText+=";"+e:Object.entries(e).forEach((t=>{let[e,i]=t;return s.setProperty(e,i)})))}const Pr=(t,e)=>Math.floor(Math.random()*(e-t+1))+t;function Ir(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const s=e.onComplete||E,i=new(S().XMLHttpRequest),n=e.signal,r=function(){i.abort()},o=function(){n&&n.removeEventListener("abort",r),i.onerror=i.ontimeout=E};if(n&&n.aborted)throw new _("request");return n&&n.addEventListener("abort",r,{once:!0}),i.onreadystatechange=function(){4===i.readyState&&(o(),s(i),i.onreadystatechange=E)},i.onerror=i.ontimeout=o,i.open("get",t,!0),i.send(),i}const Mr=(t,e)=>{let s=t._findCenterFromElement();t.transformMatrix&&((t=>{if(t.transformMatrix){const{scaleX:e,scaleY:s,angle:i,skewX:n}=Ft(t.transformMatrix);t.flipX=!1,t.flipY=!1,t.set(Z,e),t.set($,s),t.angle=i,t.skewX=n,t.skewY=0}})(t),s=s.transform(t.transformMatrix)),delete t.transformMatrix,e&&(t.scaleX*=e.scaleX,t.scaleY*=e.scaleY,t.cropX=e.cropX,t.cropY=e.cropY,s.x+=e.offsetLeft,s.y+=e.offsetTop,t.width=e.width,t.height=e.height),t.setPositionByOrigin(s,F,F)};var Rr=Object.freeze({__proto__:null,addTransformToObject:me,animate:ti,animateColor:ei,applyTransformToObject:_e,calcAngleBetweenVectors:Ss,calcDimensionsMatrix:Yt,calcPlaneChangeMatrix:be,calcVectorRotation:Ts,cancelAnimFrame:yt,capValue:Rs,composeMatrix:Xt,copyCanvasElement:t=>{var e;const s=St(t);return null===(e=s.getContext("2d"))||void 0===e||e.drawImage(t,0,0),s},cos:ut,createCanvasElement:wt,createImage:xt,createRotateMatrix:jt,createScaleMatrix:Nt,createSkewXMatrix:Wt,createSkewYMatrix:Ut,createTranslateMatrix:Lt,createVector:ws,crossProduct:Es,degreesToRadians:At,dotProduct:Os,ease:Xs,enlivenObjectEnlivables:Ht,enlivenObjects:Gt,findScaleToCover:er,findScaleToFit:tr,getBoundsOfCurve:hr,getOrthonormalVector:As,getPathSegmentsInfo:br,getPointOnPath:wr,getPointer:ue,getRandomInt:Pr,getRegularPolygonPath:(t,e)=>{const s=2*Math.PI/t;let i=-O;t%2==0&&(i+=s/2);const n=new Array(t+1);for(let r=0;r<t;r++){const t=r*s+i,{x:o,y:a}=new gt(ut(t),dt(t)).scalarMultiply(e);n[r]=[0===r?"M":"L",o,a]}return n[t]=["Z"],n},getSmoothPathFromPoints:Er,getSvgAttributes:t=>{const e=["instantiated_by_use","style","id","class"];switch(t){case"linearGradient":return e.concat(["x1","y1","x2","y2","gradientUnits","gradientTransform"]);case"radialGradient":return e.concat(["gradientUnits","gradientTransform","cx","cy","r","fx","fy","fr"]);case"stop":return e.concat(["offset","stop-color","stop-opacity"])}return e},getUnitVector:ks,groupSVGElements:(t,e)=>t&&1===t.length?t[0]:new $n(t,e),hasStyleChanged:tn,invertTransform:Pt,isBetweenVectors:Ds,isIdentityMatrix:Ot,isTouchEvent:de,isTransparent:Ui,joinPath:Or,loadImage:Vt,magnitude:xs,makeBoundingBoxFromPoints:pe,makePathSimpler:lr,matrixToSVG:Qt,mergeClipPaths:(t,e)=>{var s;let i=t,n=e;i.inverted&&!n.inverted&&(i=e,n=t),Se(n,null===(s=n.group)||void 0===s?void 0:s.calcTransformMatrix(),i.calcTransformMatrix());const r=i.inverted&&n.inverted;return r&&(i.inverted=n.inverted=!1),new $n([i],{clipPath:n,inverted:r})},multiplyTransformMatrices:It,multiplyTransformMatrixArray:Mt,parsePath:Ar,parsePreserveAspectRatioAttribute:Ve,parseUnit:Xe,pick:zt,projectStrokeOnPoints:Hi,qrDecompose:Ft,radiansToDegrees:Et,removeFromArray:lt,removeTransformFromObject:(t,e)=>{const s=Pt(e),i=It(s,t.calcOwnMatrix());_e(t,i)},removeTransformMatrixForSvgParsing:Mr,request:Ir,requestAnimFrame:vt,resetObjectTransform:ve,rotatePoint:(t,e,s)=>t.rotate(s,e),rotateVector:bs,saveObjectTransform:ye,sendObjectToPlane:Se,sendPointToPlane:we,sendVectorToPlane:xe,setStyle:Dr,sin:dt,sizeAfterTransform:Ce,string:$i,stylesFromArray:sn,stylesToArray:en,toBlob:kt,toDataURL:Tt,toFixed:Kt,transformPath:(t,e,s)=>(s&&(e=It(e,[1,0,0,1,-s.x,-s.y])),t.map((t=>{const s=[...t];for(let i=1;i<t.length-1;i+=2){const{x:n,y:r}=Dt({x:t[i],y:t[i+1]},e);s[i]=n,s[i+1]=r}return s}))),transformPoint:Dt});class Fr extends ae{constructor(t){let{allowTouchScrolling:e=!1,containerClass:s=""}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};super(t),h(this,"upper",void 0),h(this,"container",void 0);const{el:i}=this.lower,n=this.createUpperCanvas();this.upper={el:n,ctx:n.getContext("2d")},this.applyCanvasStyle(i,{allowTouchScrolling:e}),this.applyCanvasStyle(n,{allowTouchScrolling:e,styles:{position:"absolute",left:"0",top:"0"}});const r=this.createContainerElement();r.classList.add(s),i.parentNode&&i.parentNode.replaceChild(r,i),r.append(i,n),this.container=r}createUpperCanvas(){const{el:t}=this.lower,e=wt();return e.className=t.className,e.classList.remove("lower-canvas"),e.classList.add("upper-canvas"),e.setAttribute("data-fabric","top"),e.style.cssText=t.style.cssText,e.setAttribute("draggable","true"),e}createContainerElement(){const t=x().createElement("div");return t.setAttribute("data-fabric","wrapper"),Dr(t,{position:"relative"}),oe(t),t}applyCanvasStyle(t,e){const{styles:s,allowTouchScrolling:i}=e;Dr(t,l(l({},s),{},{"touch-action":i?"manipulation":W})),oe(t)}setDimensions(t,e){super.setDimensions(t,e);const{el:s,ctx:i}=this.upper;ne(s,i,t,e)}setCSSDimensions(t){super.setCSSDimensions(t),re(this.upper.el,t),re(this.container,t)}cleanupDOM(t){const e=this.container,{el:s}=this.lower,{el:i}=this.upper;super.cleanupDOM(t),e.removeChild(i),e.removeChild(s),e.parentNode&&e.parentNode.replaceChild(s,e)}dispose(){super.dispose(),w().dispose(this.upper.el),delete this.upper,delete this.container}}class Lr extends ce{constructor(){super(...arguments),h(this,"targets",[]),h(this,"_hoveredTargets",[]),h(this,"_objectsToRender",void 0),h(this,"_currentTransform",null),h(this,"_groupSelector",null),h(this,"contextTopDirty",!1)}static getDefaults(){return l(l({},super.getDefaults()),Lr.ownDefaults)}get upperCanvasEl(){var t;return null===(t=this.elements.upper)||void 0===t?void 0:t.el}get contextTop(){var t;return null===(t=this.elements.upper)||void 0===t?void 0:t.ctx}get wrapperEl(){return this.elements.container}initElements(t){this.elements=new Fr(t,{allowTouchScrolling:this.allowTouchScrolling,containerClass:this.containerClass}),this._createCacheCanvas()}_onObjectAdded(t){this._objectsToRender=void 0,super._onObjectAdded(t)}_onObjectRemoved(t){this._objectsToRender=void 0,t===this._activeObject&&(this.fire("before:selection:cleared",{deselected:[t]}),this._discardActiveObject(),this.fire("selection:cleared",{deselected:[t]}),t.fire("deselected",{target:t})),t===this._hoveredTarget&&(this._hoveredTarget=void 0,this._hoveredTargets=[]),super._onObjectRemoved(t)}_onStackOrderChanged(){this._objectsToRender=void 0,super._onStackOrderChanged()}_chooseObjectsToRender(){const t=this._activeObject;return!this.preserveObjectStacking&&t?this._objects.filter((e=>!e.group&&e!==t)).concat(t):this._objects}renderAll(){this.cancelRequestedRender(),this.destroyed||(!this.contextTopDirty||this._groupSelector||this.isDrawingMode||(this.clearContext(this.contextTop),this.contextTopDirty=!1),this.hasLostContext&&(this.renderTopLayer(this.contextTop),this.hasLostContext=!1),!this._objectsToRender&&(this._objectsToRender=this._chooseObjectsToRender()),this.renderCanvas(this.getContext(),this._objectsToRender))}renderTopLayer(t){t.save(),this.isDrawingMode&&this._isCurrentlyDrawing&&(this.freeDrawingBrush&&this.freeDrawingBrush._render(),this.contextTopDirty=!0),this.selection&&this._groupSelector&&(this._drawSelection(t),this.contextTopDirty=!0),t.restore()}renderTop(){const t=this.contextTop;this.clearContext(t),this.renderTopLayer(t),this.fire("after:render",{ctx:t})}setTargetFindTolerance(t){t=Math.round(t),this.targetFindTolerance=t;const e=this.getRetinaScaling(),s=Math.ceil((2*t+1)*e);this.pixelFindCanvasEl.width=this.pixelFindCanvasEl.height=s,this.pixelFindContext.scale(e,e)}isTargetTransparent(t,e,s){const i=this.targetFindTolerance,n=this.pixelFindContext;this.clearContext(n),n.save(),n.translate(-e+i,-s+i),n.transform(...this.viewportTransform);const r=t.selectionBackgroundColor;t.selectionBackgroundColor="",t.render(n),t.selectionBackgroundColor=r,n.restore();const o=Math.round(i*this.getRetinaScaling());return Ui(n,o,o,o)}_isSelectionKeyPressed(t){const e=this.selectionKey;return!!e&&(Array.isArray(e)?!!e.find((e=>!!e&&!0===t[e])):t[e])}_shouldClearSelection(t,e){const s=this.getActiveObjects(),i=this._activeObject;return!!(!e||e&&i&&s.length>1&&-1===s.indexOf(e)&&i!==e&&!this._isSelectionKeyPressed(t)||e&&!e.evented||e&&!e.selectable&&i&&i!==e)}_shouldCenterTransform(t,e,s){if(!t)return;let i;return e===J||e===Z||e===$||e===z?i=this.centeredScaling||t.centeredScaling:e===G&&(i=this.centeredRotation||t.centeredRotation),i?!s:s}_getOriginFromCorner(t,e){const s={x:t.originX,y:t.originY};return e?(["ml","tl","bl"].includes(e)?s.x=B:["mr","tr","br"].includes(e)&&(s.x=L),["tl","mt","tr"].includes(e)?s.y=N:["bl","mb","br"].includes(e)&&(s.y=j),s):s}_setupCurrentTransform(t,e,s){var i;const n=e.group?we(this.getScenePoint(t),void 0,e.group.calcTransformMatrix()):this.getScenePoint(t),{key:r="",control:o}=e.getActiveControl()||{},a=s&&o?null===(i=o.getActionHandler(t,e,o))||void 0===i?void 0:i.bind(o):Fe,h=((t,e,s,i)=>{if(!e||!t)return"drag";const n=i.controls[e];return n.getActionName(s,n,i)})(s,r,t,e),c=t[this.centeredKey],u=this._shouldCenterTransform(e,h,c)?{x:F,y:F}:this._getOriginFromCorner(e,r),d={target:e,action:h,actionHandler:a,actionPerformed:!1,corner:r,scaleX:e.scaleX,scaleY:e.scaleY,skewX:e.skewX,skewY:e.skewY,offsetX:n.x-e.left,offsetY:n.y-e.top,originX:u.x,originY:u.y,ex:n.x,ey:n.y,lastX:n.x,lastY:n.y,theta:At(e.angle),width:e.width,height:e.height,shiftKey:t.shiftKey,altKey:c,original:l(l({},ye(e)),{},{originX:u.x,originY:u.y})};this._currentTransform=d,this.fire("before:transform",{e:t,transform:d})}setCursor(t){this.upperCanvasEl.style.cursor=t}_drawSelection(t){const{x:e,y:s,deltaX:i,deltaY:n}=this._groupSelector,r=new gt(e,s).transform(this.viewportTransform),o=new gt(e+i,s+n).transform(this.viewportTransform),a=this.selectionLineWidth/2;let h=Math.min(r.x,o.x),c=Math.min(r.y,o.y),l=Math.max(r.x,o.x),u=Math.max(r.y,o.y);this.selectionColor&&(t.fillStyle=this.selectionColor,t.fillRect(h,c,l-h,u-c)),this.selectionLineWidth&&this.selectionBorderColor&&(t.lineWidth=this.selectionLineWidth,t.strokeStyle=this.selectionBorderColor,h+=a,c+=a,l-=a,u-=a,Wi.prototype._setLineDash.call(this,t,this.selectionDashArray),t.strokeRect(h,c,l-h,u-c))}findTarget(t){if(this.skipTargetFind)return;const e=this.getViewportPoint(t),s=this._activeObject,i=this.getActiveObjects();if(this.targets=[],s&&i.length>=1){if(s.findControl(e,de(t)))return s;if(i.length>1&&this.searchPossibleTargets([s],e))return s;if(s===this.searchPossibleTargets([s],e)){if(this.preserveObjectStacking){const i=this.targets;this.targets=[];const n=this.searchPossibleTargets(this._objects,e);return t[this.altSelectionKey]&&n&&n!==s?(this.targets=i,s):n}return s}}return this.searchPossibleTargets(this._objects,e)}_pointIsInObjectSelectionArea(t,e){let s=t.getCoords();const i=this.getZoom(),n=t.padding/i;if(n){const[t,e,i,r]=s,o=Math.atan2(e.y-t.y,e.x-t.x),a=ut(o)*n,h=dt(o)*n,c=a+h,l=a-h;s=[new gt(t.x-l,t.y-c),new gt(e.x+c,e.y-l),new gt(i.x+l,i.y+c),new gt(r.x-c,r.y+l)]}return si.isPointInPolygon(e,s)}_checkTarget(t,e){if(t&&t.visible&&t.evented&&this._pointIsInObjectSelectionArea(t,we(e,void 0,this.viewportTransform))){if(!this.perPixelTargetFind&&!t.perPixelTargetFind||t.isEditing)return!0;if(!this.isTargetTransparent(t,e.x,e.y))return!0}return!1}_searchPossibleTargets(t,e){let s=t.length;for(;s--;){const i=t[s];if(this._checkTarget(i,e)){if(ft(i)&&i.subTargetCheck){const t=this._searchPossibleTargets(i._objects,e);t&&this.targets.push(t)}return i}}}searchPossibleTargets(t,e){const s=this._searchPossibleTargets(t,e);if(s&&ft(s)&&s.interactive&&this.targets[0]){const t=this.targets;for(let e=t.length-1;e>0;e--){const s=t[e];if(!ft(s)||!s.interactive)return s}return t[0]}return s}getViewportPoint(t){return this._pointer?this._pointer:this.getPointer(t,!0)}getScenePoint(t){return this._absolutePointer?this._absolutePointer:this.getPointer(t)}getPointer(t){let e=arguments.length>1&&void 0!==arguments[1]&&arguments[1];const s=this.upperCanvasEl,i=s.getBoundingClientRect();let n=ue(t),r=i.width||0,o=i.height||0;r&&o||(j in i&&N in i&&(o=Math.abs(i.top-i.bottom)),B in i&&L in i&&(r=Math.abs(i.right-i.left))),this.calcOffset(),n.x=n.x-this._offset.left,n.y=n.y-this._offset.top,e||(n=we(n,void 0,this.viewportTransform));const a=this.getRetinaScaling();1!==a&&(n.x/=a,n.y/=a);const h=0===r||0===o?new gt(1,1):new gt(s.width/r,s.height/o);return n.multiply(h)}_setDimensionsImpl(t,e){this._resetTransformEventData(),super._setDimensionsImpl(t,e),this._isCurrentlyDrawing&&this.freeDrawingBrush&&this.freeDrawingBrush._setBrushStyles(this.contextTop)}_createCacheCanvas(){this.pixelFindCanvasEl=wt(),this.pixelFindContext=this.pixelFindCanvasEl.getContext("2d",{willReadFrequently:!0}),this.setTargetFindTolerance(this.targetFindTolerance)}getTopContext(){return this.elements.upper.ctx}getSelectionContext(){return this.elements.upper.ctx}getSelectionElement(){return this.elements.upper.el}getActiveObject(){return this._activeObject}getActiveObjects(){const t=this._activeObject;return te(t)?t.getObjects():t?[t]:[]}_fireSelectionEvents(t,e){let s=!1,i=!1;const n=this.getActiveObjects(),r=[],o=[];t.forEach((t=>{n.includes(t)||(s=!0,t.fire("deselected",{e:e,target:t}),o.push(t))})),n.forEach((i=>{t.includes(i)||(s=!0,i.fire("selected",{e:e,target:i}),r.push(i))})),t.length>0&&n.length>0?(i=!0,s&&this.fire("selection:updated",{e:e,selected:r,deselected:o})):n.length>0?(i=!0,this.fire("selection:created",{e:e,selected:r})):t.length>0&&(i=!0,this.fire("selection:cleared",{e:e,deselected:o})),i&&(this._objectsToRender=void 0)}setActiveObject(t,e){const s=this.getActiveObjects(),i=this._setActiveObject(t,e);return this._fireSelectionEvents(s,e),i}_setActiveObject(t,e){const s=this._activeObject;return s!==t&&!(!this._discardActiveObject(e,t)&&this._activeObject)&&!t.onSelect({e:e})&&(this._activeObject=t,te(t)&&s!==t&&t.set("canvas",this),t.setCoords(),!0)}_discardActiveObject(t,e){const s=this._activeObject;return!!s&&!s.onDeselect({e:t,object:e})&&(this._currentTransform&&this._currentTransform.target===s&&this.endCurrentTransform(t),te(s)&&s===this._hoveredTarget&&(this._hoveredTarget=void 0),this._activeObject=void 0,!0)}discardActiveObject(t){const e=this.getActiveObjects(),s=this.getActiveObject();e.length&&this.fire("before:selection:cleared",{e:t,deselected:[s]});const i=this._discardActiveObject(t);return this._fireSelectionEvents(e,t),i}endCurrentTransform(t){const e=this._currentTransform;this._finalizeCurrentTransform(t),e&&e.target&&(e.target.isMoving=!1),this._currentTransform=null}_finalizeCurrentTransform(t){const e=this._currentTransform,s=e.target,i={e:t,target:s,transform:e,action:e.action};s._scaling&&(s._scaling=!1),s.setCoords(),e.actionPerformed&&(this.fire("object:modified",i),s.fire(nt,i))}setViewportTransform(t){super.setViewportTransform(t);const e=this._activeObject;e&&e.setCoords()}destroy(){const t=this._activeObject;te(t)&&(t.removeAll(),t.dispose()),delete this._activeObject,super.destroy(),this.pixelFindContext=null,this.pixelFindCanvasEl=void 0}clear(){this.discardActiveObject(),this._activeObject=void 0,this.clearContext(this.contextTop),super.clear()}drawControls(t){const e=this._activeObject;e&&e._renderControls(t)}_toObject(t,e,s){const i=this._realizeGroupTransformOnObject(t),n=super._toObject(t,e,s);return t.set(i),n}_realizeGroupTransformOnObject(t){const{group:e}=t;if(e&&te(e)&&this._activeObject===e){const s=zt(t,["angle","flipX","flipY",L,Z,$,tt,et,j]);return me(t,e.calcOwnMatrix()),s}return{}}_setSVGObject(t,e,s){const i=this._realizeGroupTransformOnObject(e);super._setSVGObject(t,e,s),e.set(i)}}h(Lr,"ownDefaults",{uniformScaling:!0,uniScaleKey:"shiftKey",centeredScaling:!1,centeredRotation:!1,centeredKey:"altKey",altActionKey:"shiftKey",selection:!0,selectionKey:"shiftKey",selectionColor:"rgba(100, 100, 255, 0.3)",selectionDashArray:[],selectionBorderColor:"rgba(255, 255, 255, 0.3)",selectionLineWidth:1,selectionFullyContained:!1,hoverCursor:"move",moveCursor:"move",defaultCursor:"default",freeDrawingCursor:"crosshair",notAllowedCursor:"not-allowed",perPixelTargetFind:!1,targetFindTolerance:0,skipTargetFind:!1,stopContextMenu:!1,fireRightClick:!1,fireMiddleClick:!1,enablePointerEvents:!1,containerClass:"canvas-container",preserveObjectStacking:!1});class jr{constructor(t){h(this,"targets",[]),h(this,"__disposer",void 0);const e=()=>{const{hiddenTextarea:e}=t.getActiveObject()||{};e&&e.focus()},s=t.upperCanvasEl;s.addEventListener("click",e),this.__disposer=()=>s.removeEventListener("click",e)}exitTextEditing(){this.target=void 0,this.targets.forEach((t=>{t.isEditing&&t.exitEditing()}))}add(t){this.targets.push(t)}remove(t){this.unregister(t),lt(this.targets,t)}register(t){this.target=t}unregister(t){t===this.target&&(this.target=void 0)}onMouseMove(t){var e;(null===(e=this.target)||void 0===e?void 0:e.isEditing)&&this.target.updateSelectionOnMouseMove(t)}clear(){this.targets=[],this.target=void 0}dispose(){this.clear(),this.__disposer(),delete this.__disposer}}const Nr=["target","oldTarget","fireCanvas","e"],Br={passive:!1},Wr=(t,e)=>{const s=t.getViewportPoint(e),i=t.getScenePoint(e);return{viewportPoint:s,scenePoint:i,pointer:s,absolutePointer:i}},Ur=function(t){for(var e=arguments.length,s=new Array(e>1?e-1:0),i=1;i<e;i++)s[i-1]=arguments[i];return t.addEventListener(...s)},Yr=function(t){for(var e=arguments.length,s=new Array(e>1?e-1:0),i=1;i<e;i++)s[i-1]=arguments[i];return t.removeEventListener(...s)},Xr={mouse:{in:"over",out:"out",targetIn:"mouseover",targetOut:"mouseout",canvasIn:"mouse:over",canvasOut:"mouse:out"},drag:{in:"enter",out:"leave",targetIn:"dragenter",targetOut:"dragleave",canvasIn:"drag:enter",canvasOut:"drag:leave"}};class Vr extends Lr{constructor(t){super(t,arguments.length>1&&void 0!==arguments[1]?arguments[1]:{}),h(this,"_isClick",void 0),h(this,"textEditingManager",new jr(this)),["_onMouseDown","_onTouchStart","_onMouseMove","_onMouseUp","_onTouchEnd","_onResize","_onMouseWheel","_onMouseOut","_onMouseEnter","_onContextMenu","_onClick","_onDragStart","_onDragEnd","_onDragProgress","_onDragOver","_onDragEnter","_onDragLeave","_onDrop"].forEach((t=>{this[t]=this[t].bind(this)})),this.addOrRemove(Ur,"add")}_getEventPrefix(){return this.enablePointerEvents?"pointer":"mouse"}addOrRemove(t,e){const s=this.upperCanvasEl,i=this._getEventPrefix();t(ie(s),"resize",this._onResize),t(s,i+"down",this._onMouseDown),t(s,"".concat(i,"move"),this._onMouseMove,Br),t(s,"".concat(i,"out"),this._onMouseOut),t(s,"".concat(i,"enter"),this._onMouseEnter),t(s,"wheel",this._onMouseWheel),t(s,"contextmenu",this._onContextMenu),t(s,"click",this._onClick),t(s,"dblclick",this._onClick),t(s,"dragstart",this._onDragStart),t(s,"dragend",this._onDragEnd),t(s,"dragover",this._onDragOver),t(s,"dragenter",this._onDragEnter),t(s,"dragleave",this._onDragLeave),t(s,"drop",this._onDrop),this.enablePointerEvents||t(s,"touchstart",this._onTouchStart,Br)}removeListeners(){this.addOrRemove(Yr,"remove");const t=this._getEventPrefix(),e=se(this.upperCanvasEl);Yr(e,"".concat(t,"up"),this._onMouseUp),Yr(e,"touchend",this._onTouchEnd,Br),Yr(e,"".concat(t,"move"),this._onMouseMove,Br),Yr(e,"touchmove",this._onMouseMove,Br),clearTimeout(this._willAddMouseDown)}_onMouseWheel(t){this.__onMouseWheel(t)}_onMouseOut(t){const e=this._hoveredTarget,s=l({e:t},Wr(this,t));this.fire("mouse:out",l(l({},s),{},{target:e})),this._hoveredTarget=void 0,e&&e.fire("mouseout",l({},s)),this._hoveredTargets.forEach((t=>{this.fire("mouse:out",l(l({},s),{},{target:t})),t&&t.fire("mouseout",l({},s))})),this._hoveredTargets=[]}_onMouseEnter(t){this._currentTransform||this.findTarget(t)||(this.fire("mouse:over",l({e:t},Wr(this,t))),this._hoveredTarget=void 0,this._hoveredTargets=[])}_onDragStart(t){this._isClick=!1;const e=this.getActiveObject();if(e&&e.onDragStart(t)){this._dragSource=e;const s={e:t,target:e};return this.fire("dragstart",s),e.fire("dragstart",s),void Ur(this.upperCanvasEl,"drag",this._onDragProgress)}ge(t)}_renderDragEffects(t,e,s){let i=!1;const n=this._dropTarget;n&&n!==e&&n!==s&&(n.clearContextTop(),i=!0),null==e||e.clearContextTop(),s!==e&&(null==s||s.clearContextTop());const r=this.contextTop;r.save(),r.transform(...this.viewportTransform),e&&(r.save(),e.transform(r),e.renderDragSourceEffect(t),r.restore(),i=!0),s&&(r.save(),s.transform(r),s.renderDropTargetEffect(t),r.restore(),i=!0),r.restore(),i&&(this.contextTopDirty=!0)}_onDragEnd(t){const e=!!t.dataTransfer&&t.dataTransfer.dropEffect!==W,s=e?this._activeObject:void 0,i={e:t,target:this._dragSource,subTargets:this.targets,dragSource:this._dragSource,didDrop:e,dropTarget:s};Yr(this.upperCanvasEl,"drag",this._onDragProgress),this.fire("dragend",i),this._dragSource&&this._dragSource.fire("dragend",i),delete this._dragSource,this._onMouseUp(t)}_onDragProgress(t){const e={e:t,target:this._dragSource,dragSource:this._dragSource,dropTarget:this._draggedoverTarget};this.fire("drag",e),this._dragSource&&this._dragSource.fire("drag",e)}findDragTargets(t){return this.targets=[],{target:this._searchPossibleTargets(this._objects,this.getViewportPoint(t)),targets:[...this.targets]}}_onDragOver(t){const e="dragover",{target:s,targets:i}=this.findDragTargets(t),n=this._dragSource,r={e:t,target:s,subTargets:i,dragSource:n,canDrop:!1,dropTarget:void 0};let o;this.fire(e,r),this._fireEnterLeaveEvents(s,r),s&&(s.canDrop(t)&&(o=s),s.fire(e,r));for(let a=0;a<i.length;a++){const s=i[a];s.canDrop(t)&&(o=s),s.fire(e,r)}this._renderDragEffects(t,n,o),this._dropTarget=o}_onDragEnter(t){const{target:e,targets:s}=this.findDragTargets(t),i={e:t,target:e,subTargets:s,dragSource:this._dragSource};this.fire("dragenter",i),this._fireEnterLeaveEvents(e,i)}_onDragLeave(t){const e={e:t,target:this._draggedoverTarget,subTargets:this.targets,dragSource:this._dragSource};this.fire("dragleave",e),this._fireEnterLeaveEvents(void 0,e),this._renderDragEffects(t,this._dragSource),this._dropTarget=void 0,this.targets=[],this._hoveredTargets=[]}_onDrop(t){const{target:e,targets:s}=this.findDragTargets(t),i=this._basicEventHandler("drop:before",l({e:t,target:e,subTargets:s,dragSource:this._dragSource},Wr(this,t)));i.didDrop=!1,i.dropTarget=void 0,this._basicEventHandler("drop",i),this.fire("drop:after",i)}_onContextMenu(t){const e=this.findTarget(t),s=this.targets||[],i=this._basicEventHandler("contextmenu:before",{e:t,target:e,subTargets:s});return this.stopContextMenu&&ge(t),this._basicEventHandler("contextmenu",i),!1}_onClick(t){const e=t.detail;e>3||e<2||(this._cacheTransformEventData(t),2==e&&"dblclick"===t.type&&this._handleEvent(t,"dblclick"),3==e&&this._handleEvent(t,"tripleclick"),this._resetTransformEventData())}getPointerId(t){const e=t.changedTouches;return e?e[0]&&e[0].identifier:this.enablePointerEvents?t.pointerId:-1}_isMainEvent(t){return!0===t.isPrimary||!1!==t.isPrimary&&("touchend"===t.type&&0===t.touches.length||!t.changedTouches||t.changedTouches[0].identifier===this.mainTouchId)}_onTouchStart(t){let e=!this.allowTouchScrolling;const s=this._activeObject;void 0===this.mainTouchId&&(this.mainTouchId=this.getPointerId(t)),this.__onMouseDown(t),(this.isDrawingMode||s&&this._target===s)&&(e=!0),e&&t.preventDefault(),this._resetTransformEventData();const i=this.upperCanvasEl,n=this._getEventPrefix(),r=se(i);Ur(r,"touchend",this._onTouchEnd,Br),e&&Ur(r,"touchmove",this._onMouseMove,Br),Yr(i,"".concat(n,"down"),this._onMouseDown)}_onMouseDown(t){this.__onMouseDown(t),this._resetTransformEventData();const e=this.upperCanvasEl,s=this._getEventPrefix();Yr(e,"".concat(s,"move"),this._onMouseMove,Br);const i=se(e);Ur(i,"".concat(s,"up"),this._onMouseUp),Ur(i,"".concat(s,"move"),this._onMouseMove,Br)}_onTouchEnd(t){if(t.touches.length>0)return;this.__onMouseUp(t),this._resetTransformEventData(),delete this.mainTouchId;const e=this._getEventPrefix(),s=se(this.upperCanvasEl);Yr(s,"touchend",this._onTouchEnd,Br),Yr(s,"touchmove",this._onMouseMove,Br),this._willAddMouseDown&&clearTimeout(this._willAddMouseDown),this._willAddMouseDown=setTimeout((()=>{Ur(this.upperCanvasEl,"".concat(e,"down"),this._onMouseDown),this._willAddMouseDown=0}),400)}_onMouseUp(t){this.__onMouseUp(t),this._resetTransformEventData();const e=this.upperCanvasEl,s=this._getEventPrefix();if(this._isMainEvent(t)){const t=se(this.upperCanvasEl);Yr(t,"".concat(s,"up"),this._onMouseUp),Yr(t,"".concat(s,"move"),this._onMouseMove,Br),Ur(e,"".concat(s,"move"),this._onMouseMove,Br)}}_onMouseMove(t){const e=this.getActiveObject();!this.allowTouchScrolling&&(!e||!e.shouldStartDragging(t))&&t.preventDefault&&t.preventDefault(),this.__onMouseMove(t)}_onResize(){this.calcOffset(),this._resetTransformEventData()}_shouldRender(t){const e=this.getActiveObject();return!!e!=!!t||e&&t&&e!==t}__onMouseUp(t){var e;this._cacheTransformEventData(t),this._handleEvent(t,"up:before");const s=this._currentTransform,i=this._isClick,n=this._target,{button:r}=t;if(r)return(this.fireMiddleClick&&1===r||this.fireRightClick&&2===r)&&this._handleEvent(t,"up"),void this._resetTransformEventData();if(this.isDrawingMode&&this._isCurrentlyDrawing)return void this._onMouseUpInDrawingMode(t);if(!this._isMainEvent(t))return;let o,a,h=!1;if(s&&(this._finalizeCurrentTransform(t),h=s.actionPerformed),!i){const e=n===this._activeObject;this.handleSelection(t),h||(h=this._shouldRender(n)||!e&&n===this._activeObject)}if(n){const e=n.findControl(this.getViewportPoint(t),de(t)),{key:i,control:r}=e||{};if(a=i,n.selectable&&n!==this._activeObject&&"up"===n.activeOn)this.setActiveObject(n,t),h=!0;else if(r){const e=r.getMouseUpHandler(t,n,r);e&&(o=this.getScenePoint(t),e.call(r,t,s,o.x,o.y))}n.isMoving=!1}if(s&&(s.target!==n||s.corner!==a)){const e=s.target&&s.target.controls[s.corner],i=e&&e.getMouseUpHandler(t,s.target,e);o=o||this.getScenePoint(t),i&&i.call(e,t,s,o.x,o.y)}this._setCursorFromEvent(t,n),this._handleEvent(t,"up"),this._groupSelector=null,this._currentTransform=null,n&&(n.__corner=void 0),h?this.requestRenderAll():i||null!==(e=this._activeObject)&&void 0!==e&&e.isEditing||this.renderTop()}_basicEventHandler(t,e){const{target:s,subTargets:i=[]}=e;this.fire(t,e),s&&s.fire(t,e);for(let n=0;n<i.length;n++)i[n]!==s&&i[n].fire(t,e);return e}_handleEvent(t,e,s){const i=this._target,n=this.targets||[],r=l(l(l({e:t,target:i,subTargets:n},Wr(this,t)),{},{transform:this._currentTransform},"up:before"===e||"up"===e?{isClick:this._isClick,currentTarget:this.findTarget(t),currentSubTargets:this.targets}:{}),"down:before"===e||"down"===e?s:{});this.fire("mouse:".concat(e),r),i&&i.fire("mouse".concat(e),r);for(let o=0;o<n.length;o++)n[o]!==i&&n[o].fire("mouse".concat(e),r)}_onMouseDownInDrawingMode(t){this._isCurrentlyDrawing=!0,this.getActiveObject()&&(this.discardActiveObject(t),this.requestRenderAll());const e=this.getScenePoint(t);this.freeDrawingBrush&&this.freeDrawingBrush.onMouseDown(e,{e:t,pointer:e}),this._handleEvent(t,"down",{alreadySelected:!1})}_onMouseMoveInDrawingMode(t){if(this._isCurrentlyDrawing){const e=this.getScenePoint(t);this.freeDrawingBrush&&this.freeDrawingBrush.onMouseMove(e,{e:t,pointer:e})}this.setCursor(this.freeDrawingCursor),this._handleEvent(t,"move")}_onMouseUpInDrawingMode(t){const e=this.getScenePoint(t);this.freeDrawingBrush?this._isCurrentlyDrawing=!!this.freeDrawingBrush.onMouseUp({e:t,pointer:e}):this._isCurrentlyDrawing=!1,this._handleEvent(t,"up")}__onMouseDown(t){this._isClick=!0,this._cacheTransformEventData(t),this._handleEvent(t,"down:before");let e=this._target,s=!!e&&e===this._activeObject;const{button:i}=t;if(i)return(this.fireMiddleClick&&1===i||this.fireRightClick&&2===i)&&this._handleEvent(t,"down",{alreadySelected:s}),void this._resetTransformEventData();if(this.isDrawingMode)return void this._onMouseDownInDrawingMode(t);if(!this._isMainEvent(t))return;if(this._currentTransform)return;let n=this._shouldRender(e),r=!1;if(this.handleMultiSelection(t,e)?(e=this._activeObject,r=!0,n=!0):this._shouldClearSelection(t,e)&&this.discardActiveObject(t),this.selection&&(!e||!e.selectable&&!e.isEditing&&e!==this._activeObject)){const e=this.getScenePoint(t);this._groupSelector={x:e.x,y:e.y,deltaY:0,deltaX:0}}if(s=!!e&&e===this._activeObject,e){e.selectable&&"down"===e.activeOn&&this.setActiveObject(e,t);const i=e.findControl(this.getViewportPoint(t),de(t));if(e===this._activeObject&&(i||!r)){this._setupCurrentTransform(t,e,s);const n=i?i.control:void 0,r=this.getScenePoint(t),o=n&&n.getMouseDownHandler(t,e,n);o&&o.call(n,t,this._currentTransform,r.x,r.y)}}n&&(this._objectsToRender=void 0),this._handleEvent(t,"down",{alreadySelected:s}),n&&this.requestRenderAll()}_resetTransformEventData(){this._target=this._pointer=this._absolutePointer=void 0}_cacheTransformEventData(t){this._resetTransformEventData(),this._pointer=this.getViewportPoint(t),this._absolutePointer=we(this._pointer,void 0,this.viewportTransform),this._target=this._currentTransform?this._currentTransform.target:this.findTarget(t)}__onMouseMove(t){if(this._isClick=!1,this._cacheTransformEventData(t),this._handleEvent(t,"move:before"),this.isDrawingMode)return void this._onMouseMoveInDrawingMode(t);if(!this._isMainEvent(t))return;const e=this._groupSelector;if(e){const s=this.getScenePoint(t);e.deltaX=s.x-e.x,e.deltaY=s.y-e.y,this.renderTop()}else if(this._currentTransform)this._transformObject(t);else{const e=this.findTarget(t);this._setCursorFromEvent(t,e),this._fireOverOutEvents(t,e)}this.textEditingManager.onMouseMove(t),this._handleEvent(t,"move"),this._resetTransformEventData()}_fireOverOutEvents(t,e){const s=this._hoveredTarget,i=this._hoveredTargets,n=this.targets,r=Math.max(i.length,n.length);this.fireSyntheticInOutEvents("mouse",{e:t,target:e,oldTarget:s,fireCanvas:!0});for(let o=0;o<r;o++)this.fireSyntheticInOutEvents("mouse",{e:t,target:n[o],oldTarget:i[o]});this._hoveredTarget=e,this._hoveredTargets=this.targets.concat()}_fireEnterLeaveEvents(t,e){const s=this._draggedoverTarget,i=this._hoveredTargets,n=this.targets,r=Math.max(i.length,n.length);this.fireSyntheticInOutEvents("drag",l(l({},e),{},{target:t,oldTarget:s,fireCanvas:!0}));for(let o=0;o<r;o++)this.fireSyntheticInOutEvents("drag",l(l({},e),{},{target:n[o],oldTarget:i[o]}));this._draggedoverTarget=t}fireSyntheticInOutEvents(t,e){let{target:s,oldTarget:i,fireCanvas:n,e:r}=e,o=u(e,Nr);const{targetIn:a,targetOut:h,canvasIn:c,canvasOut:d}=Xr[t],g=i!==s;if(i&&g){const t=l(l({},o),{},{e:r,target:i,nextTarget:s},Wr(this,r));n&&this.fire(d,t),i.fire(h,t)}if(s&&g){const t=l(l({},o),{},{e:r,target:s,previousTarget:i},Wr(this,r));n&&this.fire(c,t),s.fire(a,t)}}__onMouseWheel(t){this._cacheTransformEventData(t),this._handleEvent(t,"wheel"),this._resetTransformEventData()}_transformObject(t){const e=this.getScenePoint(t),s=this._currentTransform,i=s.target,n=i.group?we(e,void 0,i.group.calcTransformMatrix()):e;s.shiftKey=t.shiftKey,s.altKey=!!this.centeredKey&&t[this.centeredKey],this._performTransformAction(t,s,n),s.actionPerformed&&this.requestRenderAll()}_performTransformAction(t,e,s){const{action:i,actionHandler:n,target:r}=e,o=!!n&&n(t,e,s.x,s.y);o&&r.setCoords(),"drag"===i&&o&&(e.target.isMoving=!0,this.setCursor(e.target.moveCursor||this.moveCursor)),e.actionPerformed=e.actionPerformed||o}_setCursorFromEvent(t,e){if(!e)return void this.setCursor(this.defaultCursor);let s=e.hoverCursor||this.hoverCursor;const i=te(this._activeObject)?this._activeObject:null,n=(!i||e.group!==i)&&e.findControl(this.getViewportPoint(t));if(n){const s=n.control;this.setCursor(s.cursorStyleHandler(t,s,e))}else e.subTargetCheck&&this.targets.concat().reverse().map((t=>{s=t.hoverCursor||s})),this.setCursor(s)}handleMultiSelection(t,e){const s=this._activeObject,i=te(s);if(s&&this._isSelectionKeyPressed(t)&&this.selection&&e&&e.selectable&&(s!==e||i)&&(i||!e.isDescendantOf(s)&&!s.isDescendantOf(e))&&!e.onSelect({e:t})&&!s.getActiveControl()){if(i){const i=s.getObjects();if(e===s){const s=this.getViewportPoint(t);if(!(e=this.searchPossibleTargets(i,s)||this.searchPossibleTargets(this._objects,s))||!e.selectable)return!1}e.group===s?(s.remove(e),this._hoveredTarget=e,this._hoveredTargets=[...this.targets],1===s.size()&&this._setActiveObject(s.item(0),t)):(s.multiSelectAdd(e),this._hoveredTarget=s,this._hoveredTargets=[...this.targets]),this._fireSelectionEvents(i,t)}else{s.isEditing&&s.exitEditing();const i=new(at.getClass("ActiveSelection"))([],{canvas:this});i.multiSelectAdd(s,e),this._hoveredTarget=i,this._setActiveObject(i,t),this._fireSelectionEvents([s],t)}return!0}return!1}handleSelection(t){if(!this.selection||!this._groupSelector)return!1;const{x:e,y:s,deltaX:i,deltaY:n}=this._groupSelector,r=new gt(e,s),o=r.add(new gt(i,n)),a=r.min(o),h=r.max(o).subtract(a),c=this.collectObjects({left:a.x,top:a.y,width:h.x,height:h.y},{includeIntersecting:!this.selectionFullyContained}),l=r.eq(o)?c[0]?[c[0]]:[]:c.length>1?c.filter((e=>!e.onSelect({e:t}))).reverse():c;if(1===l.length)this.setActiveObject(l[0],t);else if(l.length>1){const e=at.getClass("ActiveSelection");this.setActiveObject(new e(l,{canvas:this}),t)}return this._groupSelector=null,!0}clear(){this.textEditingManager.clear(),super.clear()}destroy(){this.removeListeners(),this.textEditingManager.dispose(),super.destroy()}}const Gr={x1:0,y1:0,x2:0,y2:0},Hr=l(l({},Gr),{},{r1:0,r2:0}),zr=(t,e)=>isNaN(t)&&"number"==typeof e?e:t,qr=/^(\d+\.\d+)%|(\d+)%$/;function Kr(t){return t&&qr.test(t)}function Qr(t,e){const s="number"==typeof t?t:"string"==typeof t?parseFloat(t)/(Kr(t)?100:1):NaN;return Rs(0,zr(s,e),1)}const Jr=/\s*;\s*/,Zr=/\s*:\s*/;function $r(t,e){let s,i;const n=t.getAttribute("style");if(n){const t=n.split(Jr);""===t[t.length-1]&&t.pop();for(let e=t.length;e--;){const[n,r]=t[e].split(Zr).map((t=>t.trim()));"stop-color"===n?s=r:"stop-opacity"===n&&(i=r)}}const r=new Ye(s||t.getAttribute("stop-color")||"rgb(0,0,0)");return{offset:Qr(t.getAttribute("offset"),0),color:r.toRgb(),opacity:zr(parseFloat(i||t.getAttribute("stop-opacity")||""),1)*r.getAlpha()*e}}function to(t,e){const s=[],i=t.getElementsByTagName("stop"),n=Qr(e,1);for(let r=i.length;r--;)s.push($r(i[r],n));return s}function eo(t){return"linearGradient"===t.nodeName||"LINEARGRADIENT"===t.nodeName?"linear":"radial"}function so(t){return"userSpaceOnUse"===t.getAttribute("gradientUnits")?"pixels":"percentage"}function io(t,e){return t.getAttribute(e)}function no(t,e){return function(t,e){let s,{width:i,height:n,gradientUnits:r}=e;return Object.keys(t).reduce(((e,o)=>{const a=t[o];return"Infinity"===a?s=1:"-Infinity"===a?s=0:(s="string"==typeof a?parseFloat(a):a,"string"==typeof a&&Kr(a)&&(s*=.01,"pixels"===r&&("x1"!==o&&"x2"!==o&&"r2"!==o||(s*=i),"y1"!==o&&"y2"!==o||(s*=n)))),e[o]=s,e}),{})}("linear"===eo(t)?function(t){return{x1:io(t,"x1")||0,y1:io(t,"y1")||0,x2:io(t,"x2")||"100%",y2:io(t,"y2")||0}}(t):function(t){return{x1:io(t,"fx")||io(t,"cx")||"50%",y1:io(t,"fy")||io(t,"cy")||"50%",r1:0,x2:io(t,"cx")||"50%",y2:io(t,"cy")||"50%",r2:io(t,"r")||"50%"}}(t),l(l({},e),{},{gradientUnits:so(t)}))}class ro{constructor(t){const{type:e="linear",gradientUnits:s="pixels",coords:i={},colorStops:n=[],offsetX:r=0,offsetY:o=0,gradientTransform:a,id:h}=t||{};Object.assign(this,{type:e,gradientUnits:s,coords:l(l({},"radial"===e?Hr:Gr),i),colorStops:n,offsetX:r,offsetY:o,gradientTransform:a,id:h?"".concat(h,"_").concat(bt()):bt()})}addColorStop(t){for(const e in t){const s=new Ye(t[e]);this.colorStops.push({offset:parseFloat(e),color:s.toRgb(),opacity:s.getAlpha()})}return this}toObject(t){return l(l({},zt(this,t)),{},{type:this.type,coords:l({},this.coords),colorStops:this.colorStops.map((t=>l({},t))),offsetX:this.offsetX,offsetY:this.offsetY,gradientUnits:this.gradientUnits,gradientTransform:this.gradientTransform?[...this.gradientTransform]:void 0})}toSVG(t){let{additionalTransform:e}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const s=[],i=this.gradientTransform?this.gradientTransform.concat():I.concat(),n="pixels"===this.gradientUnits?"userSpaceOnUse":"objectBoundingBox",r=this.colorStops.map((t=>l({},t))).sort(((t,e)=>t.offset-e.offset));let o=-this.offsetX,a=-this.offsetY;var h;"objectBoundingBox"===n?(o/=t.width,a/=t.height):(o+=t.width/2,a+=t.height/2),(h=t)&&"function"==typeof h._renderPathCommands&&"percentage"!==this.gradientUnits&&(o-=t.pathOffset.x,a-=t.pathOffset.y),i[4]-=o,i[5]-=a;const c=['id="SVGID_'.concat(this.id,'"'),'gradientUnits="'.concat(n,'"'),'gradientTransform="'.concat(e?e+" ":"").concat(Qt(i),'"'),""].join(" ");if("linear"===this.type){const{x1:t,y1:e,x2:i,y2:n}=this.coords;s.push("<linearGradient ",c,' x1="',t,'" y1="',e,'" x2="',i,'" y2="',n,'">\n')}else if("radial"===this.type){const{x1:t,y1:e,x2:i,y2:n,r1:o,r2:a}=this.coords,h=o>a;s.push("<radialGradient ",c,' cx="',h?t:i,'" cy="',h?e:n,'" r="',h?o:a,'" fx="',h?i:t,'" fy="',h?n:e,'">\n'),h&&(r.reverse(),r.forEach((t=>{t.offset=1-t.offset})));const l=Math.min(o,a);if(l>0){const t=l/Math.max(o,a);r.forEach((e=>{e.offset+=t*(1-e.offset)}))}}return r.forEach((t=>{let{color:e,offset:i,opacity:n}=t;s.push("<stop ",'offset="',100*i+"%",'" style="stop-color:',e,void 0!==n?";stop-opacity: "+n:";",'"/>\n')})),s.push("linear"===this.type?"</linearGradient>":"</radialGradient>","\n"),s.join("")}toLive(t){const{x1:e,y1:s,x2:i,y2:n,r1:r,r2:o}=this.coords,a="linear"===this.type?t.createLinearGradient(e,s,i,n):t.createRadialGradient(e,s,r,i,n,o);return this.colorStops.forEach((t=>{let{color:e,opacity:s,offset:i}=t;a.addColorStop(i,void 0!==s?new Ye(e).setAlpha(s).toRgba():e)})),a}static async fromObject(t){const{colorStops:e,gradientTransform:s}=t;return new this(l(l({},t),{},{colorStops:e?e.map((t=>l({},t))):void 0,gradientTransform:s?[...s]:void 0}))}static fromElement(t,e,s){const i=so(t),n=e._findCenterFromElement();return new this(l({id:t.getAttribute("id")||void 0,type:eo(t),coords:no(t,{width:s.viewBoxWidth||s.width,height:s.viewBoxHeight||s.height}),colorStops:to(t,s.opacity),gradientUnits:i,gradientTransform:Dn(t.getAttribute("gradientTransform")||"")},"pixels"===i?{offsetX:e.width/2-n.x,offsetY:e.height/2-n.y}:{offsetX:0,offsetY:0}))}}h(ro,"type","Gradient"),at.setClass(ro,"gradient"),at.setClass(ro,"linear"),at.setClass(ro,"radial");const oo=["type","source","patternTransform"];class ao{get type(){return"pattern"}set type(t){f("warn","Setting type has no effect",t)}constructor(t){h(this,"repeat","repeat"),h(this,"offsetX",0),h(this,"offsetY",0),h(this,"crossOrigin",""),this.id=bt(),Object.assign(this,t)}isImageSource(){return!!this.source&&"string"==typeof this.source.src}isCanvasSource(){return!!this.source&&!!this.source.toDataURL}sourceToString(){return this.isImageSource()?this.source.src:this.isCanvasSource()?this.source.toDataURL():""}toLive(t){return this.source&&(!this.isImageSource()||this.source.complete&&0!==this.source.naturalWidth&&0!==this.source.naturalHeight)?t.createPattern(this.source,this.repeat):null}toObject(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];const{repeat:e,crossOrigin:s}=this;return l(l({},zt(this,t)),{},{type:"pattern",source:this.sourceToString(),repeat:e,crossOrigin:s,offsetX:Kt(this.offsetX,p.NUM_FRACTION_DIGITS),offsetY:Kt(this.offsetY,p.NUM_FRACTION_DIGITS),patternTransform:this.patternTransform?[...this.patternTransform]:null})}toSVG(t){let{width:e,height:s}=t;const{source:i,repeat:n,id:r}=this,o=zr(this.offsetX/e,0),a=zr(this.offsetY/s,0),h="repeat-y"===n||"no-repeat"===n?1+Math.abs(o||0):zr(i.width/e,0),c="repeat-x"===n||"no-repeat"===n?1+Math.abs(a||0):zr(i.height/s,0);return['<pattern id="SVGID_'.concat(r,'" x="').concat(o,'" y="').concat(a,'" width="').concat(h,'" height="').concat(c,'">'),'<image x="0" y="0" width="'.concat(i.width,'" height="').concat(i.height,'" xlink:href="').concat(this.sourceToString(),'"></image>'),"</pattern>",""].join("\n")}static async fromObject(t,e){let{type:s,source:i,patternTransform:n}=t,r=u(t,oo);const o=await Vt(i,l(l({},e),{},{crossOrigin:r.crossOrigin}));return new this(l(l({},r),{},{patternTransform:n&&n.slice(0),source:o}))}}h(ao,"type","Pattern"),at.setClass(ao),at.setClass(ao,"pattern");const ho=["path","left","top"],co=["d"];class lo extends Wi{constructor(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},{path:s,left:i,top:n}=e,r=u(e,ho);super(),Object.assign(this,lo.ownDefaults),this.setOptions(r),this._setPath(t||[],!0),"number"==typeof i&&this.set(L,i),"number"==typeof n&&this.set(j,n)}_setPath(t,e){this.path=lr(Array.isArray(t)?t:Ar(t)),this.setBoundingBox(e)}_findCenterFromElement(){const t=this._calcBoundsFromPath();return new gt(t.left+t.width/2,t.top+t.height/2)}_renderPathCommands(t){const e=-this.pathOffset.x,s=-this.pathOffset.y;t.beginPath();for(const i of this.path)switch(i[0]){case"L":t.lineTo(i[1]+e,i[2]+s);break;case"M":t.moveTo(i[1]+e,i[2]+s);break;case"C":t.bezierCurveTo(i[1]+e,i[2]+s,i[3]+e,i[4]+s,i[5]+e,i[6]+s);break;case"Q":t.quadraticCurveTo(i[1]+e,i[2]+s,i[3]+e,i[4]+s);break;case"Z":t.closePath()}}_render(t){this._renderPathCommands(t),this._renderPaintInOrder(t)}toString(){return"#<Path (".concat(this.complexity(),'): { "top": ').concat(this.top,', "left": ').concat(this.left," }>")}toObject(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];return l(l({},super.toObject(t)),{},{path:this.path.map((t=>t.slice()))})}toDatalessObject(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];const e=this.toObject(t);return this.sourcePath&&(delete e.path,e.sourcePath=this.sourcePath),e}_toSVG(){const t=Or(this.path,p.NUM_FRACTION_DIGITS);return["<path ","COMMON_PARTS",'d="'.concat(t,'" stroke-linecap="round" />\n')]}_getOffsetTransform(){const t=p.NUM_FRACTION_DIGITS;return" translate(".concat(Kt(-this.pathOffset.x,t),", ").concat(Kt(-this.pathOffset.y,t),")")}toClipPathSVG(t){const e=this._getOffsetTransform();return"\t"+this._createBaseClipPathSVGMarkup(this._toSVG(),{reviver:t,additionalTransform:e})}toSVG(t){const e=this._getOffsetTransform();return this._createBaseSVGMarkup(this._toSVG(),{reviver:t,additionalTransform:e})}complexity(){return this.path.length}setDimensions(){this.setBoundingBox()}setBoundingBox(t){const{width:e,height:s,pathOffset:i}=this._calcDimensions();this.set({width:e,height:s,pathOffset:i}),t&&this.setPositionByOrigin(i,F,F)}_calcBoundsFromPath(){const t=[];let e=0,s=0,i=0,n=0;for(const r of this.path)switch(r[0]){case"L":i=r[1],n=r[2],t.push({x:e,y:s},{x:i,y:n});break;case"M":i=r[1],n=r[2],e=i,s=n;break;case"C":t.push(...hr(i,n,r[1],r[2],r[3],r[4],r[5],r[6])),i=r[5],n=r[6];break;case"Q":t.push(...hr(i,n,r[1],r[2],r[1],r[2],r[3],r[4])),i=r[3],n=r[4];break;case"Z":i=e,n=s}return pe(t)}_calcDimensions(){const t=this._calcBoundsFromPath();return l(l({},t),{},{pathOffset:new gt(t.left+t.width/2,t.top+t.height/2)})}static fromObject(t){return this._fromObject(t,{extraParam:"path"})}static async fromElement(t,e,s){const i=Ln(t,this.ATTRIBUTE_NAMES,s),{d:n}=i;return new this(n,l(l(l({},u(i,co)),e),{},{left:void 0,top:void 0}))}}h(lo,"type","Path"),h(lo,"cacheProperties",[...Ls,"path","fillRule"]),h(lo,"ATTRIBUTE_NAMES",[...nn,"d"]),at.setClass(lo),at.setSVGClass(lo);const uo=["left","top","radius"],go=["radius","startAngle","endAngle","counterClockwise"];class po extends Wi{static getDefaults(){return l(l({},super.getDefaults()),po.ownDefaults)}constructor(t){super(),Object.assign(this,po.ownDefaults),this.setOptions(t)}_set(t,e){return super._set(t,e),"radius"===t&&this.setRadius(e),this}_render(t){t.beginPath(),t.arc(0,0,this.radius,At(this.startAngle),At(this.endAngle),this.counterClockwise),this._renderPaintInOrder(t)}getRadiusX(){return this.get("radius")*this.get(Z)}getRadiusY(){return this.get("radius")*this.get($)}setRadius(t){this.radius=t,this.set({width:2*t,height:2*t})}toObject(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];return super.toObject([...go,...t])}_toSVG(){const t=(this.endAngle-this.startAngle)%360;if(0===t)return["<circle ","COMMON_PARTS",'cx="0" cy="0" ','r="',"".concat(this.radius),'" />\n'];{const{radius:e}=this,s=At(this.startAngle),i=At(this.endAngle),n=ut(s)*e,r=dt(s)*e,o=ut(i)*e,a=dt(i)*e,h=t>180?1:0,c=this.counterClockwise?0:1;return['<path d="M '.concat(n," ").concat(r," A ").concat(e," ").concat(e," 0 ").concat(h," ").concat(c," ").concat(o," ").concat(a,'" '),"COMMON_PARTS"," />\n"]}}static async fromElement(t,e,s){const i=Ln(t,this.ATTRIBUTE_NAMES,s),{left:n=0,top:r=0,radius:o=0}=i;return new this(l(l({},u(i,uo)),{},{radius:o,left:n-o,top:r-o}))}static fromObject(t){return super._fromObject(t)}}h(po,"type","Circle"),h(po,"cacheProperties",[...Ls,...go]),h(po,"ownDefaults",{radius:0,startAngle:0,endAngle:360,counterClockwise:!1}),h(po,"ATTRIBUTE_NAMES",["cx","cy","r",...nn]),at.setClass(po),at.setSVGClass(po);const fo=["x1","y1","x2","y2"],mo=["x1","y1","x2","y2"],_o=["x1","x2","y1","y2"];class vo extends Wi{constructor(){let[t,e,s,i]=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[0,0,0,0],n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};super(),Object.assign(this,vo.ownDefaults),this.setOptions(n),this.x1=t,this.x2=s,this.y1=e,this.y2=i,this._setWidthHeight();const{left:r,top:o}=n;"number"==typeof r&&this.set(L,r),"number"==typeof o&&this.set(j,o)}_setWidthHeight(){const{x1:t,y1:e,x2:s,y2:i}=this;this.width=Math.abs(s-t),this.height=Math.abs(i-e);const{left:n,top:r,width:o,height:a}=pe([{x:t,y:e},{x:s,y:i}]),h=new gt(n+o/2,r+a/2);this.setPositionByOrigin(h,F,F)}_set(t,e){return super._set(t,e),_o.includes(t)&&this._setWidthHeight(),this}_render(t){t.beginPath();const e=this.calcLinePoints();t.moveTo(e.x1,e.y1),t.lineTo(e.x2,e.y2),t.lineWidth=this.strokeWidth;const s=t.strokeStyle;var i;Jt(this.stroke)?t.strokeStyle=this.stroke.toLive(t):t.strokeStyle=null!==(i=this.stroke)&&void 0!==i?i:t.fillStyle,this.stroke&&this._renderStroke(t),t.strokeStyle=s}_findCenterFromElement(){return new gt((this.x1+this.x2)/2,(this.y1+this.y2)/2)}toObject(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];return l(l({},super.toObject(t)),this.calcLinePoints())}_getNonTransformedDimensions(){const t=super._getNonTransformedDimensions();return"butt"===this.strokeLineCap&&(0===this.width&&(t.y-=this.strokeWidth),0===this.height&&(t.x-=this.strokeWidth)),t}calcLinePoints(){const{x1:t,x2:e,y1:s,y2:i,width:n,height:r}=this,o=t<=e?-1:1,a=s<=i?-1:1;return{x1:o*n/2,x2:o*-n/2,y1:a*r/2,y2:a*-r/2}}_toSVG(){const{x1:t,x2:e,y1:s,y2:i}=this.calcLinePoints();return["<line ","COMMON_PARTS",'x1="'.concat(t,'" y1="').concat(s,'" x2="').concat(e,'" y2="').concat(i,'" />\n')]}static async fromElement(t,e,s){const i=Ln(t,this.ATTRIBUTE_NAMES,s),{x1:n=0,y1:r=0,x2:o=0,y2:a=0}=i;return new this([n,r,o,a],u(i,fo))}static fromObject(t){let{x1:e,y1:s,x2:i,y2:n}=t,r=u(t,mo);return this._fromObject(l(l({},r),{},{points:[e,s,i,n]}),{extraParam:"points"})}}h(vo,"type","Line"),h(vo,"cacheProperties",[...Ls,..._o]),h(vo,"ATTRIBUTE_NAMES",nn.concat(_o)),at.setClass(vo),at.setSVGClass(vo);class yo extends Wi{static getDefaults(){return l(l({},super.getDefaults()),yo.ownDefaults)}constructor(t){super(),Object.assign(this,yo.ownDefaults),this.setOptions(t)}_render(t){const e=this.width/2,s=this.height/2;t.beginPath(),t.moveTo(-e,s),t.lineTo(0,-s),t.lineTo(e,s),t.closePath(),this._renderPaintInOrder(t)}_toSVG(){const t=this.width/2,e=this.height/2;return["<polygon ","COMMON_PARTS",'points="',"".concat(-t," ").concat(e,",0 ").concat(-e,",").concat(t," ").concat(e),'" />']}}h(yo,"type","Triangle"),h(yo,"ownDefaults",{width:100,height:100}),at.setClass(yo),at.setSVGClass(yo);const Co=["rx","ry"];class bo extends Wi{static getDefaults(){return l(l({},super.getDefaults()),bo.ownDefaults)}constructor(t){super(),Object.assign(this,bo.ownDefaults),this.setOptions(t)}_set(t,e){switch(super._set(t,e),t){case"rx":this.rx=e,this.set("width",2*e);break;case"ry":this.ry=e,this.set("height",2*e)}return this}getRx(){return this.get("rx")*this.get(Z)}getRy(){return this.get("ry")*this.get($)}toObject(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];return super.toObject([...Co,...t])}_toSVG(){return["<ellipse ","COMMON_PARTS",'cx="0" cy="0" rx="'.concat(this.rx,'" ry="').concat(this.ry,'" />\n')]}_render(t){t.beginPath(),t.save(),t.transform(1,0,0,this.ry/this.rx,0,0),t.arc(0,0,this.rx,0,D,!1),t.restore(),this._renderPaintInOrder(t)}static async fromElement(t,e,s){const i=Ln(t,this.ATTRIBUTE_NAMES,s);return i.left=(i.left||0)-i.rx,i.top=(i.top||0)-i.ry,new this(i)}}function wo(t){if(!t)return[];const e=t.replace(/,/g," ").trim().split(/\s+/),s=[];for(let i=0;i<e.length;i+=2)s.push({x:parseFloat(e[i]),y:parseFloat(e[i+1])});return s}h(bo,"type","Ellipse"),h(bo,"cacheProperties",[...Ls,...Co]),h(bo,"ownDefaults",{rx:0,ry:0}),h(bo,"ATTRIBUTE_NAMES",[...nn,"cx","cy","rx","ry"]),at.setClass(bo),at.setSVGClass(bo);const xo=["left","top"],So={exactBoundingBox:!1};class To extends Wi{static getDefaults(){return l(l({},super.getDefaults()),To.ownDefaults)}constructor(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};super(),h(this,"strokeDiff",void 0),Object.assign(this,To.ownDefaults),this.setOptions(e),this.points=t;const{left:s,top:i}=e;this.initialized=!0,this.setBoundingBox(!0),"number"==typeof s&&this.set(L,s),"number"==typeof i&&this.set(j,i)}isOpen(){return!0}_projectStrokeOnPoints(t){return Hi(this.points,t,this.isOpen())}_calcDimensions(t){t=l({scaleX:this.scaleX,scaleY:this.scaleY,skewX:this.skewX,skewY:this.skewY,strokeLineCap:this.strokeLineCap,strokeLineJoin:this.strokeLineJoin,strokeMiterLimit:this.strokeMiterLimit,strokeUniform:this.strokeUniform,strokeWidth:this.strokeWidth},t||{});const e=this.exactBoundingBox?this._projectStrokeOnPoints(t).map((t=>t.projectedPoint)):this.points;if(0===e.length)return{left:0,top:0,width:0,height:0,pathOffset:new gt,strokeOffset:new gt,strokeDiff:new gt};const s=pe(e),i=Yt(l(l({},t),{},{scaleX:1,scaleY:1})),n=pe(this.points.map((t=>Dt(t,i,!0)))),r=new gt(this.scaleX,this.scaleY);let o=s.left+s.width/2,a=s.top+s.height/2;return this.exactBoundingBox&&(o-=a*Math.tan(At(this.skewX)),a-=o*Math.tan(At(this.skewY))),l(l({},s),{},{pathOffset:new gt(o,a),strokeOffset:new gt(n.left,n.top).subtract(new gt(s.left,s.top)).multiply(r),strokeDiff:new gt(s.width,s.height).subtract(new gt(n.width,n.height)).multiply(r)})}_findCenterFromElement(){const t=pe(this.points);return new gt(t.left+t.width/2,t.top+t.height/2)}setDimensions(){this.setBoundingBox()}setBoundingBox(t){const{left:e,top:s,width:i,height:n,pathOffset:r,strokeOffset:o,strokeDiff:a}=this._calcDimensions();this.set({width:i,height:n,pathOffset:r,strokeOffset:o,strokeDiff:a}),t&&this.setPositionByOrigin(new gt(e+i/2,s+n/2),F,F)}isStrokeAccountedForInDimensions(){return this.exactBoundingBox}_getNonTransformedDimensions(){return this.exactBoundingBox?new gt(this.width,this.height):super._getNonTransformedDimensions()}_getTransformedDimensions(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};if(this.exactBoundingBox){let r;if(Object.keys(t).some((t=>this.strokeUniform||this.constructor.layoutProperties.includes(t)))){var e,s;const{width:i,height:n}=this._calcDimensions(t);r=new gt(null!==(e=t.width)&&void 0!==e?e:i,null!==(s=t.height)&&void 0!==s?s:n)}else{var i,n;r=new gt(null!==(i=t.width)&&void 0!==i?i:this.width,null!==(n=t.height)&&void 0!==n?n:this.height)}return r.multiply(new gt(t.scaleX||this.scaleX,t.scaleY||this.scaleY))}return super._getTransformedDimensions(t)}_set(t,e){const s=this.initialized&&this[t]!==e,i=super._set(t,e);return this.exactBoundingBox&&s&&((t===Z||t===$)&&this.strokeUniform&&this.constructor.layoutProperties.includes("strokeUniform")||this.constructor.layoutProperties.includes(t))&&this.setDimensions(),i}toObject(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];return l(l({},super.toObject(t)),{},{points:this.points.map((t=>{let{x:e,y:s}=t;return{x:e,y:s}}))})}_toSVG(){const t=[],e=this.pathOffset.x,s=this.pathOffset.y,i=p.NUM_FRACTION_DIGITS;for(let n=0,r=this.points.length;n<r;n++)t.push(Kt(this.points[n].x-e,i),",",Kt(this.points[n].y-s,i)," ");return["<".concat(this.constructor.type.toLowerCase()," "),"COMMON_PARTS",'points="'.concat(t.join(""),'" />\n')]}_render(t){const e=this.points.length,s=this.pathOffset.x,i=this.pathOffset.y;if(e&&!isNaN(this.points[e-1].y)){t.beginPath(),t.moveTo(this.points[0].x-s,this.points[0].y-i);for(let n=0;n<e;n++){const e=this.points[n];t.lineTo(e.x-s,e.y-i)}!this.isOpen()&&t.closePath(),this._renderPaintInOrder(t)}}complexity(){return this.points.length}static async fromElement(t,e,s){return new this(wo(t.getAttribute("points")),l(l({},u(Ln(t,this.ATTRIBUTE_NAMES,s),xo)),e))}static fromObject(t){return this._fromObject(t,{extraParam:"points"})}}h(To,"ownDefaults",So),h(To,"type","Polyline"),h(To,"layoutProperties",[tt,et,"strokeLineCap","strokeLineJoin","strokeMiterLimit","strokeWidth","strokeUniform","points"]),h(To,"cacheProperties",[...Ls,"points"]),h(To,"ATTRIBUTE_NAMES",[...nn]),at.setClass(To),at.setSVGClass(To);class ko extends To{isOpen(){return!1}}h(ko,"ownDefaults",So),h(ko,"type","Polygon"),at.setClass(ko),at.setSVGClass(ko);class Ao extends Wi{isEmptyStyles(t){if(!this.styles)return!0;if(void 0!==t&&!this.styles[t])return!0;const e=void 0===t?this.styles:{line:this.styles[t]};for(const s in e)for(const t in e[s])for(const i in e[s][t])return!1;return!0}styleHas(t,e){if(!this.styles)return!1;if(void 0!==e&&!this.styles[e])return!1;const s=void 0===e?this.styles:{0:this.styles[e]};for(const i in s)for(const e in s[i])if(void 0!==s[i][e][t])return!0;return!1}cleanStyle(t){if(!this.styles)return!1;const e=this.styles;let s,i,n=0,r=!0,o=0;for(const a in e){s=0;for(const o in e[a]){const h=e[a][o]||{};n++,void 0!==h[t]?(i?h[t]!==i&&(r=!1):i=h[t],h[t]===this[t]&&delete h[t]):r=!1,0!==Object.keys(h).length?s++:delete e[a][o]}0===s&&delete e[a]}for(let a=0;a<this._textLines.length;a++)o+=this._textLines[a].length;r&&n===o&&(this[t]=i,this.removeStyle(t))}removeStyle(t){if(!this.styles)return;const e=this.styles;let s,i,n;for(i in e){for(n in s=e[i],s)delete s[n][t],0===Object.keys(s[n]).length&&delete s[n];0===Object.keys(s).length&&delete e[i]}}_extendStyles(t,e){const{lineIndex:s,charIndex:i}=this.get2DCursorLocation(t);this._getLineStyle(s)||this._setLineStyle(s);const n=qt(l(l({},this._getStyleDeclaration(s,i)),e),(t=>void 0!==t));this._setStyleDeclaration(s,i,n)}getSelectionStyles(t,e,s){const i=[];for(let n=t;n<(e||t);n++)i.push(this.getStyleAtPosition(n,s));return i}getStyleAtPosition(t,e){const{lineIndex:s,charIndex:i}=this.get2DCursorLocation(t);return e?this.getCompleteStyleDeclaration(s,i):this._getStyleDeclaration(s,i)}setSelectionStyles(t,e,s){for(let i=e;i<(s||e);i++)this._extendStyles(i,t);this._forceClearCache=!0}_getStyleDeclaration(t,e){var s;const i=this.styles&&this.styles[t];return i&&null!==(s=i[e])&&void 0!==s?s:{}}getCompleteStyleDeclaration(t,e){return l(l({},zt(this,this.constructor._styleProperties)),this._getStyleDeclaration(t,e))}_setStyleDeclaration(t,e,s){this.styles[t][e]=s}_deleteStyleDeclaration(t,e){delete this.styles[t][e]}_getLineStyle(t){return!!this.styles[t]}_setLineStyle(t){this.styles[t]={}}_deleteLineStyle(t){delete this.styles[t]}}h(Ao,"_styleProperties",$e);const Eo=/  +/g,Oo=/"/g;function Do(t,e,s,i,n){return"\t\t".concat(function(t,e){let{left:s,top:i,width:n,height:r}=e,o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:p.NUM_FRACTION_DIGITS;const a=Ge(st,t,!1),[h,c,l,u]=[s,i,n,r].map((t=>Kt(t,o)));return"<rect ".concat(a,' x="').concat(h,'" y="').concat(c,'" width="').concat(l,'" height="').concat(u,'"></rect>')}(t,{left:e,top:s,width:i,height:n}),"\n")}const Po=["textAnchor","textDecoration","dx","dy","top","left","fontSize","strokeWidth"];let Io;class Mo extends Ao{static getDefaults(){return l(l({},super.getDefaults()),Mo.ownDefaults)}constructor(t,e){super(),h(this,"__charBounds",[]),Object.assign(this,Mo.ownDefaults),this.setOptions(e),this.styles||(this.styles={}),this.text=t,this.initialized=!0,this.path&&this.setPathInfo(),this.initDimensions(),this.setCoords()}setPathInfo(){const t=this.path;t&&(t.segmentsInfo=br(t.path))}_splitText(){const t=this._splitTextIntoLines(this.text);return this.textLines=t.lines,this._textLines=t.graphemeLines,this._unwrappedTextLines=t._unwrappedLines,this._text=t.graphemeText,t}initDimensions(){this._splitText(),this._clearCache(),this.dirty=!0,this.path?(this.width=this.path.width,this.height=this.path.height):(this.width=this.calcTextWidth()||this.cursorWidth||this.MIN_TEXT_WIDTH,this.height=this.calcTextHeight()),this.textAlign.includes(es)&&this.enlargeSpaces()}enlargeSpaces(){let t,e,s,i,n,r,o;for(let a=0,h=this._textLines.length;a<h;a++)if((this.textAlign===es||a!==h-1&&!this.isEndOfWrapping(a))&&(i=0,n=this._textLines[a],e=this.getLineWidth(a),e<this.width&&(o=this.textLines[a].match(this._reSpacesAndTabs)))){s=o.length,t=(this.width-e)/s;for(let e=0;e<=n.length;e++)r=this.__charBounds[a][e],this._reSpaceAndTab.test(n[e])?(r.width+=t,r.kernedWidth+=t,r.left+=i,i+=t):r.left+=i}}isEndOfWrapping(t){return t===this._textLines.length-1}missingNewlineOffset(t){return 1}get2DCursorLocation(t,e){const s=e?this._unwrappedTextLines:this._textLines;let i;for(i=0;i<s.length;i++){if(t<=s[i].length)return{lineIndex:i,charIndex:t};t-=s[i].length+this.missingNewlineOffset(i,e)}return{lineIndex:i-1,charIndex:s[i-1].length<t?s[i-1].length:t}}toString(){return"#<Text (".concat(this.complexity(),'): { "text": "').concat(this.text,'", "fontFamily": "').concat(this.fontFamily,'" }>')}_getCacheCanvasDimensions(){const t=super._getCacheCanvasDimensions(),e=this.fontSize;return t.width+=e*t.zoomX,t.height+=e*t.zoomY,t}_render(t){const e=this.path;e&&!e.isNotVisible()&&e._render(t),this._setTextStyles(t),this._renderTextLinesBackground(t),this._renderTextDecoration(t,"underline"),this._renderText(t),this._renderTextDecoration(t,"overline"),this._renderTextDecoration(t,"linethrough")}_renderText(t){this.paintFirst===it?(this._renderTextStroke(t),this._renderTextFill(t)):(this._renderTextFill(t),this._renderTextStroke(t))}_setTextStyles(t,e,s){if(t.textBaseline="alphabetic",this.path)switch(this.pathAlign){case F:t.textBaseline="middle";break;case"ascender":t.textBaseline=j;break;case"descender":t.textBaseline=N}t.font=this._getFontDeclaration(e,s)}calcTextWidth(){let t=this.getLineWidth(0);for(let e=1,s=this._textLines.length;e<s;e++){const s=this.getLineWidth(e);s>t&&(t=s)}return t}_renderTextLine(t,e,s,i,n,r){this._renderChars(t,e,s,i,n,r)}_renderTextLinesBackground(t){if(!this.textBackgroundColor&&!this.styleHas("textBackgroundColor"))return;const e=t.fillStyle,s=this._getLeftOffset();let i=this._getTopOffset();for(let n=0,r=this._textLines.length;n<r;n++){const e=this.getHeightOfLine(n);if(!this.textBackgroundColor&&!this.styleHas("textBackgroundColor",n)){i+=e;continue}const r=this._textLines[n].length,o=this._getLineLeftOffset(n);let a,h,c=0,l=0,u=this.getValueOfPropertyAt(n,0,"textBackgroundColor");for(let d=0;d<r;d++){const r=this.__charBounds[n][d];h=this.getValueOfPropertyAt(n,d,"textBackgroundColor"),this.path?(t.save(),t.translate(r.renderLeft,r.renderTop),t.rotate(r.angle),t.fillStyle=h,h&&t.fillRect(-r.width/2,-e/this.lineHeight*(1-this._fontSizeFraction),r.width,e/this.lineHeight),t.restore()):h!==u?(a=s+o+l,"rtl"===this.direction&&(a=this.width-a-c),t.fillStyle=u,u&&t.fillRect(a,i,c,e/this.lineHeight),l=r.left,c=r.width,u=h):c+=r.kernedWidth}h&&!this.path&&(a=s+o+l,"rtl"===this.direction&&(a=this.width-a-c),t.fillStyle=h,t.fillRect(a,i,c,e/this.lineHeight)),i+=e}t.fillStyle=e,this._removeShadow(t)}_measureChar(t,e,s,i){const n=k.getFontCache(e),r=this._getFontDeclaration(e),o=s+t,a=s&&r===this._getFontDeclaration(i),h=e.fontSize/this.CACHE_FONT_SIZE;let c,l,u,d;if(s&&void 0!==n[s]&&(u=n[s]),void 0!==n[t]&&(d=c=n[t]),a&&void 0!==n[o]&&(l=n[o],d=l-u),void 0===c||void 0===u||void 0===l){const i=function(){if(!Io){const t=St({width:0,height:0});Io=t.getContext("2d")}return Io}();this._setTextStyles(i,e,!0),void 0===c&&(d=c=i.measureText(t).width,n[t]=c),void 0===u&&a&&s&&(u=i.measureText(s).width,n[s]=u),a&&void 0===l&&(l=i.measureText(o).width,n[o]=l,d=l-u)}return{width:c*h,kernedWidth:d*h}}getHeightOfChar(t,e){return this.getValueOfPropertyAt(t,e,"fontSize")}measureLine(t){const e=this._measureLine(t);return 0!==this.charSpacing&&(e.width-=this._getWidthOfCharSpacing()),e.width<0&&(e.width=0),e}_measureLine(t){let e,s,i=0;const n=this.pathSide===B,r=this.path,o=this._textLines[t],a=o.length,h=new Array(a);this.__charBounds[t]=h;for(let c=0;c<a;c++){const n=o[c];s=this._getGraphemeBox(n,t,c,e),h[c]=s,i+=s.kernedWidth,e=n}if(h[a]={left:s?s.left+s.width:0,width:0,kernedWidth:0,height:this.fontSize,deltaY:0},r&&r.segmentsInfo){let t=0;const e=r.segmentsInfo[r.segmentsInfo.length-1].length;switch(this.textAlign){case L:t=n?e-i:0;break;case F:t=(e-i)/2;break;case B:t=n?0:e-i}t+=this.pathStartOffset*(n?-1:1);for(let i=n?a-1:0;n?i>=0:i<a;n?i--:i++)s=h[i],t>e?t%=e:t<0&&(t+=e),this._setGraphemeOnPath(t,s),t+=s.kernedWidth}return{width:i,numOfSpaces:0}}_setGraphemeOnPath(t,e){const s=t+e.kernedWidth/2,i=this.path,n=wr(i.path,s,i.segmentsInfo);e.renderLeft=n.x-i.pathOffset.x,e.renderTop=n.y-i.pathOffset.y,e.angle=n.angle+(this.pathSide===B?Math.PI:0)}_getGraphemeBox(t,e,s,i,n){const r=this.getCompleteStyleDeclaration(e,s),o=i?this.getCompleteStyleDeclaration(e,s-1):{},a=this._measureChar(t,r,i,o);let h,c=a.kernedWidth,l=a.width;0!==this.charSpacing&&(h=this._getWidthOfCharSpacing(),l+=h,c+=h);const u={width:l,left:0,height:r.fontSize,kernedWidth:c,deltaY:r.deltaY};if(s>0&&!n){const t=this.__charBounds[e][s-1];u.left=t.left+t.width+a.kernedWidth-a.width}return u}getHeightOfLine(t){if(this.__lineHeights[t])return this.__lineHeights[t];let e=this.getHeightOfChar(t,0);for(let s=1,i=this._textLines[t].length;s<i;s++)e=Math.max(this.getHeightOfChar(t,s),e);return this.__lineHeights[t]=e*this.lineHeight*this._fontSizeMult}calcTextHeight(){let t,e=0;for(let s=0,i=this._textLines.length;s<i;s++)t=this.getHeightOfLine(s),e+=s===i-1?t/this.lineHeight:t;return e}_getLeftOffset(){return"ltr"===this.direction?-this.width/2:this.width/2}_getTopOffset(){return-this.height/2}_renderTextCommon(t,e){t.save();let s=0;const i=this._getLeftOffset(),n=this._getTopOffset();for(let r=0,o=this._textLines.length;r<o;r++){const o=this.getHeightOfLine(r),a=o/this.lineHeight,h=this._getLineLeftOffset(r);this._renderTextLine(e,t,this._textLines[r],i+h,n+s+a,r),s+=o}t.restore()}_renderTextFill(t){(this.fill||this.styleHas(st))&&this._renderTextCommon(t,"fillText")}_renderTextStroke(t){(this.stroke&&0!==this.strokeWidth||!this.isEmptyStyles())&&(this.shadow&&!this.shadow.affectStroke&&this._removeShadow(t),t.save(),this._setLineDash(t,this.strokeDashArray),t.beginPath(),this._renderTextCommon(t,"strokeText"),t.closePath(),t.restore())}_renderChars(t,e,s,i,n,r){const o=this.getHeightOfLine(r),a=this.textAlign.includes(es),h=this.path,c=!a&&0===this.charSpacing&&this.isEmptyStyles(r)&&!h,l="ltr"===this.direction,u="ltr"===this.direction?1:-1,d=e.direction;let g,p,f,m,_,v="",y=0;if(e.save(),d!==this.direction&&(e.canvas.setAttribute("dir",l?"ltr":"rtl"),e.direction=l?"ltr":"rtl",e.textAlign=l?L:B),n-=o*this._fontSizeFraction/this.lineHeight,c)return this._renderChar(t,e,r,0,s.join(""),i,n),void e.restore();for(let C=0,b=s.length-1;C<=b;C++)m=C===b||this.charSpacing||h,v+=s[C],f=this.__charBounds[r][C],0===y?(i+=u*(f.kernedWidth-f.width),y+=f.width):y+=f.kernedWidth,a&&!m&&this._reSpaceAndTab.test(s[C])&&(m=!0),m||(g=g||this.getCompleteStyleDeclaration(r,C),p=this.getCompleteStyleDeclaration(r,C+1),m=tn(g,p,!1)),m&&(h?(e.save(),e.translate(f.renderLeft,f.renderTop),e.rotate(f.angle),this._renderChar(t,e,r,C,v,-y/2,0),e.restore()):(_=i,this._renderChar(t,e,r,C,v,_,n)),v="",g=p,i+=u*y,y=0);e.restore()}_applyPatternGradientTransformText(t){const e=this.width+this.strokeWidth,s=this.height+this.strokeWidth,i=St({width:e,height:s}),n=i.getContext("2d");return i.width=e,i.height=s,n.beginPath(),n.moveTo(0,0),n.lineTo(e,0),n.lineTo(e,s),n.lineTo(0,s),n.closePath(),n.translate(e/2,s/2),n.fillStyle=t.toLive(n),this._applyPatternGradientTransform(n,t),n.fill(),n.createPattern(i,"no-repeat")}handleFiller(t,e,s){let i,n;return Jt(s)?"percentage"===s.gradientUnits||s.gradientTransform||s.patternTransform?(i=-this.width/2,n=-this.height/2,t.translate(i,n),t[e]=this._applyPatternGradientTransformText(s),{offsetX:i,offsetY:n}):(t[e]=s.toLive(t),this._applyPatternGradientTransform(t,s)):(t[e]=s,{offsetX:0,offsetY:0})}_setStrokeStyles(t,e){let{stroke:s,strokeWidth:i}=e;return t.lineWidth=i,t.lineCap=this.strokeLineCap,t.lineDashOffset=this.strokeDashOffset,t.lineJoin=this.strokeLineJoin,t.miterLimit=this.strokeMiterLimit,this.handleFiller(t,"strokeStyle",s)}_setFillStyles(t,e){let{fill:s}=e;return this.handleFiller(t,"fillStyle",s)}_renderChar(t,e,s,i,n,r,o){const a=this._getStyleDeclaration(s,i),h=this.getCompleteStyleDeclaration(s,i),c="fillText"===t&&h.fill,l="strokeText"===t&&h.stroke&&h.strokeWidth;if(l||c){if(e.save(),e.font=this._getFontDeclaration(h),a.textBackgroundColor&&this._removeShadow(e),a.deltaY&&(o+=a.deltaY),c){const t=this._setFillStyles(e,h);e.fillText(n,r-t.offsetX,o-t.offsetY)}if(l){const t=this._setStrokeStyles(e,h);e.strokeText(n,r-t.offsetX,o-t.offsetY)}e.restore()}}setSuperscript(t,e){this._setScript(t,e,this.superscript)}setSubscript(t,e){this._setScript(t,e,this.subscript)}_setScript(t,e,s){const i=this.get2DCursorLocation(t,!0),n=this.getValueOfPropertyAt(i.lineIndex,i.charIndex,"fontSize"),r=this.getValueOfPropertyAt(i.lineIndex,i.charIndex,"deltaY"),o={fontSize:n*s.size,deltaY:r+n*s.baseline};this.setSelectionStyles(o,t,e)}_getLineLeftOffset(t){const e=this.getLineWidth(t),s=this.width-e,i=this.textAlign,n=this.direction,r=this.isEndOfWrapping(t);let o=0;return i===es||i===ns&&!r||i===is&&!r||i===ss&&!r?0:(i===F&&(o=s/2),i===B&&(o=s),i===ns&&(o=s/2),i===is&&(o=s),"rtl"===n&&(i===B||i===es||i===is?o=0:i===L||i===ss?o=-s:i!==F&&i!==ns||(o=-s/2)),o)}_clearCache(){this._forceClearCache=!1,this.__lineWidths=[],this.__lineHeights=[],this.__charBounds=[]}getLineWidth(t){if(void 0!==this.__lineWidths[t])return this.__lineWidths[t];const{width:e}=this.measureLine(t);return this.__lineWidths[t]=e,e}_getWidthOfCharSpacing(){return 0!==this.charSpacing?this.fontSize*this.charSpacing/1e3:0}getValueOfPropertyAt(t,e,s){var i;return null!==(i=this._getStyleDeclaration(t,e)[s])&&void 0!==i?i:this[s]}_renderTextDecoration(t,e){if(!this[e]&&!this.styleHas(e))return;let s=this._getTopOffset();const i=this._getLeftOffset(),n=this.path,r=this._getWidthOfCharSpacing(),o="linethrough"===e?.5:"overline"===e?1:0,a=this.offsets[e];for(let h=0,c=this._textLines.length;h<c;h++){const c=this.getHeightOfLine(h);if(!this[e]&&!this.styleHas(e,h)){s+=c;continue}const l=this._textLines[h],u=c/this.lineHeight,d=this._getLineLeftOffset(h);let g=0,p=0,f=this.getValueOfPropertyAt(h,0,e),m=this.getValueOfPropertyAt(h,0,st),_=this.getValueOfPropertyAt(h,0,qe),v=f,y=m,C=_;const b=s+u*(1-this._fontSizeFraction);let w=this.getHeightOfChar(h,0),x=this.getValueOfPropertyAt(h,0,"deltaY");for(let s=0,r=l.length;s<r;s++){const r=this.__charBounds[h][s];v=this.getValueOfPropertyAt(h,s,e),y=this.getValueOfPropertyAt(h,s,st),C=this.getValueOfPropertyAt(h,s,qe);const c=this.getHeightOfChar(h,s),l=this.getValueOfPropertyAt(h,s,"deltaY");if(n&&v&&y){const e=this.fontSize*C/1e3;t.save(),t.fillStyle=m,t.translate(r.renderLeft,r.renderTop),t.rotate(r.angle),t.fillRect(-r.kernedWidth/2,a*c+l-o*e,r.kernedWidth,e),t.restore()}else if((v!==f||y!==m||c!==w||C!==_||l!==x)&&p>0){const e=this.fontSize*_/1e3;let s=i+d+g;"rtl"===this.direction&&(s=this.width-s-p),f&&m&&_&&(t.fillStyle=m,t.fillRect(s,b+a*w+x-o*e,p,e)),g=r.left,p=r.width,f=v,_=C,m=y,w=c,x=l}else p+=r.kernedWidth}let S=i+d+g;"rtl"===this.direction&&(S=this.width-S-p),t.fillStyle=y;const T=this.fontSize*C/1e3;v&&y&&C&&t.fillRect(S,b+a*w+x-o*T,p-r,T),s+=c}this._removeShadow(t)}_getFontDeclaration(){let{fontFamily:t=this.fontFamily,fontStyle:e=this.fontStyle,fontWeight:s=this.fontWeight,fontSize:i=this.fontSize}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=arguments.length>1?arguments[1]:void 0;const r=t.includes("'")||t.includes('"')||t.includes(",")||Mo.genericFonts.includes(t.toLowerCase())?t:'"'.concat(t,'"');return[e,s,"".concat(n?this.CACHE_FONT_SIZE:i,"px"),r].join(" ")}render(t){this.visible&&(this.canvas&&this.canvas.skipOffscreen&&!this.group&&!this.isOnScreen()||(this._forceClearCache&&this.initDimensions(),super.render(t)))}graphemeSplit(t){return Qi(t)}_splitTextIntoLines(t){const e=t.split(this._reNewline),s=new Array(e.length),i=["\n"];let n=[];for(let r=0;r<e.length;r++)s[r]=this.graphemeSplit(e[r]),n=n.concat(s[r],i);return n.pop(),{_unwrappedLines:s,lines:e,graphemeText:n,graphemeLines:s}}toObject(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];return l(l({},super.toObject([...Ze,...t])),{},{styles:en(this.styles,this.text)},this.path?{path:this.path.toObject()}:{})}set(t,e){const{textLayoutProperties:s}=this.constructor;super.set(t,e);let i=!1,n=!1;if("object"==typeof t)for(const r in t)"path"===r&&this.setPathInfo(),i=i||s.includes(r),n=n||"path"===r;else i=s.includes(t),n="path"===t;return n&&this.setPathInfo(),i&&this.initialized&&(this.initDimensions(),this.setCoords()),this}complexity(){return 1}static async fromElement(t,e,s){const i=Ln(t,Mo.ATTRIBUTE_NAMES,s),n=l(l({},e),i),{textAnchor:r=L,textDecoration:o="",dx:a=0,dy:h=0,top:c=0,left:d=0,fontSize:g=M,strokeWidth:p=1}=n,f=u(n,Po),m=new this((t.textContent||"").replace(/^\s+|\s+$|\n+/g,"").replace(/\s+/g," "),l({left:d+a,top:c+h,underline:o.includes("underline"),overline:o.includes("overline"),linethrough:o.includes("line-through"),strokeWidth:0,fontSize:g},f)),_=m.getScaledHeight()/m.height,v=((m.height+m.strokeWidth)*m.lineHeight-m.height)*_,y=m.getScaledHeight()+v;let C=0;return r===F&&(C=m.getScaledWidth()/2),r===B&&(C=m.getScaledWidth()),m.set({left:m.left-C,top:m.top-(y-m.fontSize*(.07+m._fontSizeFraction))/m.lineHeight,strokeWidth:p}),m}static fromObject(t){return this._fromObject(l(l({},t),{},{styles:sn(t.styles||{},t.text)}),{extraParam:"text"})}}h(Mo,"textLayoutProperties",Je),h(Mo,"cacheProperties",[...Ls,...Ze]),h(Mo,"ownDefaults",ts),h(Mo,"type","Text"),h(Mo,"genericFonts",["serif","sans-serif","monospace","cursive","fantasy","system-ui","ui-serif","ui-sans-serif","ui-monospace","ui-rounded","math","emoji","fangsong"]),h(Mo,"ATTRIBUTE_NAMES",nn.concat("x","y","dx","dy","font-family","font-style","font-weight","font-size","letter-spacing","text-decoration","text-anchor")),Bi(Mo,[class extends He{_toSVG(){const t=this._getSVGLeftTopOffsets(),e=this._getSVGTextAndBg(t.textTop,t.textLeft);return this._wrapSVGTextAndBg(e)}toSVG(t){const e=this._createBaseSVGMarkup(this._toSVG(),{reviver:t,noStyle:!0,withShadow:!0}),s=this.path;return s?e+s._createBaseSVGMarkup(s._toSVG(),{reviver:t,withShadow:!0,additionalTransform:Qt(this.calcOwnMatrix())}):e}_getSVGLeftTopOffsets(){return{textLeft:-this.width/2,textTop:-this.height/2,lineTop:this.getHeightOfLine(0)}}_wrapSVGTextAndBg(t){let{textBgRects:e,textSpans:s}=t;const i=this.getSvgTextDecoration(this);return[e.join(""),'\t\t<text xml:space="preserve" ','font-family="'.concat(this.fontFamily.replace(Oo,"'"),'" '),'font-size="'.concat(this.fontSize,'" '),this.fontStyle?'font-style="'.concat(this.fontStyle,'" '):"",this.fontWeight?'font-weight="'.concat(this.fontWeight,'" '):"",i?'text-decoration="'.concat(i,'" '):"","rtl"===this.direction?'direction="'.concat(this.direction,'" '):"",'style="',this.getSvgStyles(!0),'"',this.addPaintOrder()," >",s.join(""),"</text>\n"]}_getSVGTextAndBg(t,e){const s=[],i=[];let n,r=t;this.backgroundColor&&i.push(...Do(this.backgroundColor,-this.width/2,-this.height/2,this.width,this.height));for(let o=0,a=this._textLines.length;o<a;o++)n=this._getLineLeftOffset(o),"rtl"===this.direction&&(n+=this.width),(this.textBackgroundColor||this.styleHas("textBackgroundColor",o))&&this._setSVGTextLineBg(i,o,e+n,r),this._setSVGTextLineText(s,o,e+n,r),r+=this.getHeightOfLine(o);return{textSpans:s,textBgRects:i}}_createTextCharSpan(t,e,s,i,n){const r=p.NUM_FRACTION_DIGITS,o=this.getSvgSpanStyles(e,t!==t.trim()||!!t.match(Eo)),a=o?'style="'.concat(o,'"'):"",h=e.deltaY,c=h?' dy="'.concat(Kt(h,r),'" '):"",{angle:l,renderLeft:u,renderTop:d,width:g}=n;let f="";if(void 0!==u){const t=g/2;l&&(f=' rotate="'.concat(Kt(Et(l),r),'"'));const e=jt({angle:Et(l)});e[4]=u,e[5]=d;const n=new gt(-t,0).transform(e);s=n.x,i=n.y}return'<tspan x="'.concat(Kt(s,r),'" y="').concat(Kt(i,r),'" ').concat(c).concat(f).concat(a,">").concat(qi(t),"</tspan>")}_setSVGTextLineText(t,e,s,i){const n=this.getHeightOfLine(e),r=this.textAlign.includes(es),o=this._textLines[e];let a,h,c,l,u,d="",g=0;i+=n*(1-this._fontSizeFraction)/this.lineHeight;for(let p=0,f=o.length-1;p<=f;p++)u=p===f||this.charSpacing||this.path,d+=o[p],c=this.__charBounds[e][p],0===g?(s+=c.kernedWidth-c.width,g+=c.width):g+=c.kernedWidth,r&&!u&&this._reSpaceAndTab.test(o[p])&&(u=!0),u||(a=a||this.getCompleteStyleDeclaration(e,p),h=this.getCompleteStyleDeclaration(e,p+1),u=tn(a,h,!0)),u&&(l=this._getStyleDeclaration(e,p),t.push(this._createTextCharSpan(d,l,s,i,c)),d="",a=h,"rtl"===this.direction?s-=g:s+=g,g=0)}_setSVGTextLineBg(t,e,s,i){const n=this._textLines[e],r=this.getHeightOfLine(e)/this.lineHeight;let o,a=0,h=0,c=this.getValueOfPropertyAt(e,0,"textBackgroundColor");for(let l=0;l<n.length;l++){const{left:n,width:u,kernedWidth:d}=this.__charBounds[e][l];o=this.getValueOfPropertyAt(e,l,"textBackgroundColor"),o!==c?(c&&t.push(...Do(c,s+h,i,a,r)),h=n,a=u,c=o):a+=d}o&&t.push(...Do(c,s+h,i,a,r))}_getSVGLineTopOffset(t){let e,s=0;for(e=0;e<t;e++)s+=this.getHeightOfLine(e);const i=this.getHeightOfLine(e);return{lineTop:s,offset:(this._fontSizeMult-this._fontSizeFraction)*i/(this.lineHeight*this._fontSizeMult)}}getSvgStyles(t){return"".concat(super.getSvgStyles(t)," text-decoration-thickness: ").concat(Kt(this.textDecorationThickness*this.getObjectScaling().y/10,p.NUM_FRACTION_DIGITS),"%; white-space: pre;")}getSvgSpanStyles(t,e){const{fontFamily:s,strokeWidth:i,stroke:n,fill:r,fontSize:o,fontStyle:a,fontWeight:h,deltaY:c,textDecorationThickness:l,linethrough:u,overline:d,underline:g}=t,f=this.getSvgTextDecoration({underline:null!=g?g:this.underline,overline:null!=d?d:this.overline,linethrough:null!=u?u:this.linethrough}),m=l||this.textDecorationThickness;return[n?Ge(it,n):"",i?"stroke-width: ".concat(i,"; "):"",s?"font-family: ".concat(s.includes("'")||s.includes('"')?s:"'".concat(s,"'"),"; "):"",o?"font-size: ".concat(o,"px; "):"",a?"font-style: ".concat(a,"; "):"",h?"font-weight: ".concat(h,"; "):"",f?"text-decoration: ".concat(f,"; text-decoration-thickness: ").concat(Kt(m*this.getObjectScaling().y/10,p.NUM_FRACTION_DIGITS),"%; "):"",r?Ge(st,r):"",c?"baseline-shift: ".concat(-c,"; "):"",e?"white-space: pre; ":""].join("")}getSvgTextDecoration(t){return["overline","underline","line-through"].filter((e=>t[e.replace("-","")])).join(" ")}}]),at.setClass(Mo),at.setSVGClass(Mo);class Ro{constructor(t){h(this,"target",void 0),h(this,"__mouseDownInPlace",!1),h(this,"__dragStartFired",!1),h(this,"__isDraggingOver",!1),h(this,"__dragStartSelection",void 0),h(this,"__dragImageDisposer",void 0),h(this,"_dispose",void 0),this.target=t;const e=[this.target.on("dragenter",this.dragEnterHandler.bind(this)),this.target.on("dragover",this.dragOverHandler.bind(this)),this.target.on("dragleave",this.dragLeaveHandler.bind(this)),this.target.on("dragend",this.dragEndHandler.bind(this)),this.target.on("drop",this.dropHandler.bind(this))];this._dispose=()=>{e.forEach((t=>t())),this._dispose=void 0}}isPointerOverSelection(t){const e=this.target,s=e.getSelectionStartFromPointer(t);return e.isEditing&&s>=e.selectionStart&&s<=e.selectionEnd&&e.selectionStart<e.selectionEnd}start(t){return this.__mouseDownInPlace=this.isPointerOverSelection(t)}isActive(){return this.__mouseDownInPlace}end(t){const e=this.isActive();return e&&!this.__dragStartFired&&(this.target.setCursorByClick(t),this.target.initDelayedCursor(!0)),this.__mouseDownInPlace=!1,this.__dragStartFired=!1,this.__isDraggingOver=!1,e}getDragStartSelection(){return this.__dragStartSelection}setDragImage(t,e){var s;let{selectionStart:i,selectionEnd:n}=e;const r=this.target,o=r.canvas,a=new gt(r.flipX?-1:1,r.flipY?-1:1),h=r._getCursorBoundaries(i),c=new gt(h.left+h.leftOffset,h.top+h.topOffset).multiply(a).transform(r.calcTransformMatrix()),l=o.getScenePoint(t).subtract(c),u=r.getCanvasRetinaScaling(),d=r.getBoundingRect(),g=c.subtract(new gt(d.left,d.top)),p=o.viewportTransform,f=g.add(l).transform(p,!0),m=r.backgroundColor,_=zi(r.styles);r.backgroundColor="";const v={stroke:"transparent",fill:"transparent",textBackgroundColor:"transparent"};r.setSelectionStyles(v,0,i),r.setSelectionStyles(v,n,r.text.length),r.dirty=!0;const y=r.toCanvasElement({enableRetinaScaling:o.enableRetinaScaling,viewportTransform:!0});r.backgroundColor=m,r.styles=_,r.dirty=!0,Dr(y,{position:"fixed",left:"".concat(-y.width,"px"),border:W,width:"".concat(y.width/u,"px"),height:"".concat(y.height/u,"px")}),this.__dragImageDisposer&&this.__dragImageDisposer(),this.__dragImageDisposer=()=>{y.remove()},se(t.target||this.target.hiddenTextarea).body.appendChild(y),null===(s=t.dataTransfer)||void 0===s||s.setDragImage(y,f.x,f.y)}onDragStart(t){this.__dragStartFired=!0;const e=this.target,s=this.isActive();if(s&&t.dataTransfer){const s=this.__dragStartSelection={selectionStart:e.selectionStart,selectionEnd:e.selectionEnd},i=e._text.slice(s.selectionStart,s.selectionEnd).join(""),n=l({text:e.text,value:i},s);t.dataTransfer.setData("text/plain",i),t.dataTransfer.setData("application/fabric",JSON.stringify({value:i,styles:e.getSelectionStyles(s.selectionStart,s.selectionEnd,!0)})),t.dataTransfer.effectAllowed="copyMove",this.setDragImage(t,n)}return e.abortCursorAnimation(),s}canDrop(t){if(this.target.editable&&!this.target.getActiveControl()&&!t.defaultPrevented){if(this.isActive()&&this.__dragStartSelection){const e=this.target.getSelectionStartFromPointer(t),s=this.__dragStartSelection;return e<s.selectionStart||e>s.selectionEnd}return!0}return!1}targetCanDrop(t){return this.target.canDrop(t)}dragEnterHandler(t){let{e:e}=t;const s=this.targetCanDrop(e);!this.__isDraggingOver&&s&&(this.__isDraggingOver=!0)}dragOverHandler(t){const{e:e}=t,s=this.targetCanDrop(e);!this.__isDraggingOver&&s?this.__isDraggingOver=!0:this.__isDraggingOver&&!s&&(this.__isDraggingOver=!1),this.__isDraggingOver&&(e.preventDefault(),t.canDrop=!0,t.dropTarget=this.target)}dragLeaveHandler(){(this.__isDraggingOver||this.isActive())&&(this.__isDraggingOver=!1)}dropHandler(t){var e;const{e:s}=t,i=s.defaultPrevented;this.__isDraggingOver=!1,s.preventDefault();let n=null===(e=s.dataTransfer)||void 0===e?void 0:e.getData("text/plain");if(n&&!i){const e=this.target,i=e.canvas;let r=e.getSelectionStartFromPointer(s);const{styles:o}=s.dataTransfer.types.includes("application/fabric")?JSON.parse(s.dataTransfer.getData("application/fabric")):{},a=n[Math.max(0,n.length-1)],h=0;if(this.__dragStartSelection){const t=this.__dragStartSelection.selectionStart,s=this.__dragStartSelection.selectionEnd;r>t&&r<=s?r=t:r>s&&(r-=s-t),e.removeChars(t,s),delete this.__dragStartSelection}e._reNewline.test(a)&&(e._reNewline.test(e._text[r])||r===e._text.length)&&(n=n.trimEnd()),t.didDrop=!0,t.dropTarget=e,e.insertChars(n,o,r),i.setActiveObject(e),e.enterEditing(s),e.selectionStart=Math.min(r+h,e._text.length),e.selectionEnd=Math.min(e.selectionStart+n.length,e._text.length),e.hiddenTextarea.value=e.text,e._updateTextarea(),e.hiddenTextarea.focus(),e.fire(Q,{index:r+h,action:"drop"}),i.fire("text:changed",{target:e}),i.contextTopDirty=!0,i.requestRenderAll()}}dragEndHandler(t){let{e:e}=t;if(this.isActive()&&this.__dragStartFired&&this.__dragStartSelection){var s;const t=this.target,i=this.target.canvas,{selectionStart:n,selectionEnd:r}=this.__dragStartSelection,o=(null===(s=e.dataTransfer)||void 0===s?void 0:s.dropEffect)||W;o===W?(t.selectionStart=n,t.selectionEnd=r,t._updateTextarea(),t.hiddenTextarea.focus()):(t.clearContextTop(),"move"===o&&(t.removeChars(n,r),t.selectionStart=t.selectionEnd=n,t.hiddenTextarea&&(t.hiddenTextarea.value=t.text),t._updateTextarea(),t.fire(Q,{index:n,action:"dragend"}),i.fire("text:changed",{target:t}),i.requestRenderAll()),t.exitEditing())}this.__dragImageDisposer&&this.__dragImageDisposer(),delete this.__dragImageDisposer,delete this.__dragStartSelection,this.__isDraggingOver=!1}dispose(){this._dispose&&this._dispose()}}const Fo=/[ \n\.,;!\?\-]/;class Lo extends Mo{constructor(){super(...arguments),h(this,"_currentCursorOpacity",1)}initBehavior(){this._tick=this._tick.bind(this),this._onTickComplete=this._onTickComplete.bind(this),this.updateSelectionOnMouseMove=this.updateSelectionOnMouseMove.bind(this)}onDeselect(t){return this.isEditing&&this.exitEditing(),this.selected=!1,super.onDeselect(t)}_animateCursor(t){let{toValue:e,duration:s,delay:i,onComplete:n}=t;return ti({startValue:this._currentCursorOpacity,endValue:e,duration:s,delay:i,onComplete:n,abort:()=>!this.canvas||this.selectionStart!==this.selectionEnd,onChange:t=>{this._currentCursorOpacity=t,this.renderCursorOrSelection()}})}_tick(t){this._currentTickState=this._animateCursor({toValue:0,duration:this.cursorDuration/2,delay:Math.max(t||0,100),onComplete:this._onTickComplete})}_onTickComplete(){var t;null===(t=this._currentTickCompleteState)||void 0===t||t.abort(),this._currentTickCompleteState=this._animateCursor({toValue:1,duration:this.cursorDuration,onComplete:this._tick})}initDelayedCursor(t){this.abortCursorAnimation(),this._tick(t?0:this.cursorDelay)}abortCursorAnimation(){let t=!1;[this._currentTickState,this._currentTickCompleteState].forEach((e=>{e&&!e.isDone()&&(t=!0,e.abort())})),this._currentCursorOpacity=1,t&&this.clearContextTop()}restartCursorIfNeeded(){[this._currentTickState,this._currentTickCompleteState].some((t=>!t||t.isDone()))&&this.initDelayedCursor()}selectAll(){return this.selectionStart=0,this.selectionEnd=this._text.length,this._fireSelectionChanged(),this._updateTextarea(),this}cmdAll(){this.selectAll(),this.renderCursorOrSelection()}getSelectedText(){return this._text.slice(this.selectionStart,this.selectionEnd).join("")}findWordBoundaryLeft(t){let e=0,s=t-1;if(this._reSpace.test(this._text[s]))for(;this._reSpace.test(this._text[s]);)e++,s--;for(;/\S/.test(this._text[s])&&s>-1;)e++,s--;return t-e}findWordBoundaryRight(t){let e=0,s=t;if(this._reSpace.test(this._text[s]))for(;this._reSpace.test(this._text[s]);)e++,s++;for(;/\S/.test(this._text[s])&&s<this._text.length;)e++,s++;return t+e}findLineBoundaryLeft(t){let e=0,s=t-1;for(;!/\n/.test(this._text[s])&&s>-1;)e++,s--;return t-e}findLineBoundaryRight(t){let e=0,s=t;for(;!/\n/.test(this._text[s])&&s<this._text.length;)e++,s++;return t+e}searchWordBoundary(t,e){const s=this._text;let i=t>0&&this._reSpace.test(s[t])&&(-1===e||!U.test(s[t-1]))?t-1:t,n=s[i];for(;i>0&&i<s.length&&!Fo.test(n);)i+=e,n=s[i];return-1===e&&Fo.test(n)&&i++,i}selectWord(t){var e;t=null!==(e=t)&&void 0!==e?e:this.selectionStart;const s=this.searchWordBoundary(t,-1),i=Math.max(s,this.searchWordBoundary(t,1));this.selectionStart=s,this.selectionEnd=i,this._fireSelectionChanged(),this._updateTextarea(),this.renderCursorOrSelection()}selectLine(t){var e;t=null!==(e=t)&&void 0!==e?e:this.selectionStart;const s=this.findLineBoundaryLeft(t),i=this.findLineBoundaryRight(t);this.selectionStart=s,this.selectionEnd=i,this._fireSelectionChanged(),this._updateTextarea()}enterEditing(t){!this.isEditing&&this.editable&&(this.enterEditingImpl(),this.fire("editing:entered",t?{e:t}:void 0),this._fireSelectionChanged(),this.canvas&&(this.canvas.fire("text:editing:entered",{target:this,e:t}),this.canvas.requestRenderAll()))}enterEditingImpl(){this.canvas&&(this.canvas.calcOffset(),this.canvas.textEditingManager.exitTextEditing()),this.isEditing=!0,this.initHiddenTextarea(),this.hiddenTextarea.focus(),this.hiddenTextarea.value=this.text,this._updateTextarea(),this._saveEditingProps(),this._setEditingProps(),this._textBeforeEdit=this.text,this._tick()}updateSelectionOnMouseMove(t){if(this.getActiveControl())return;const e=this.hiddenTextarea;se(e).activeElement!==e&&e.focus();const s=this.getSelectionStartFromPointer(t),i=this.selectionStart,n=this.selectionEnd;(s===this.__selectionStartOnMouseDown&&i!==n||i!==s&&n!==s)&&(s>this.__selectionStartOnMouseDown?(this.selectionStart=this.__selectionStartOnMouseDown,this.selectionEnd=s):(this.selectionStart=s,this.selectionEnd=this.__selectionStartOnMouseDown),this.selectionStart===i&&this.selectionEnd===n||(this._fireSelectionChanged(),this._updateTextarea(),this.renderCursorOrSelection()))}_setEditingProps(){this.hoverCursor="text",this.canvas&&(this.canvas.defaultCursor=this.canvas.moveCursor="text"),this.borderColor=this.editingBorderColor,this.hasControls=this.selectable=!1,this.lockMovementX=this.lockMovementY=!0}fromStringToGraphemeSelection(t,e,s){const i=s.slice(0,t),n=this.graphemeSplit(i).length;if(t===e)return{selectionStart:n,selectionEnd:n};const r=s.slice(t,e);return{selectionStart:n,selectionEnd:n+this.graphemeSplit(r).length}}fromGraphemeToStringSelection(t,e,s){const i=s.slice(0,t).join("").length;return t===e?{selectionStart:i,selectionEnd:i}:{selectionStart:i,selectionEnd:i+s.slice(t,e).join("").length}}_updateTextarea(){if(this.cursorOffsetCache={},this.hiddenTextarea){if(!this.inCompositionMode){const t=this.fromGraphemeToStringSelection(this.selectionStart,this.selectionEnd,this._text);this.hiddenTextarea.selectionStart=t.selectionStart,this.hiddenTextarea.selectionEnd=t.selectionEnd}this.updateTextareaPosition()}}updateFromTextArea(){if(!this.hiddenTextarea)return;this.cursorOffsetCache={};const t=this.hiddenTextarea;this.text=t.value,this.set("dirty",!0),this.initDimensions(),this.setCoords();const e=this.fromStringToGraphemeSelection(t.selectionStart,t.selectionEnd,t.value);this.selectionEnd=this.selectionStart=e.selectionEnd,this.inCompositionMode||(this.selectionStart=e.selectionStart),this.updateTextareaPosition()}updateTextareaPosition(){if(this.selectionStart===this.selectionEnd){const t=this._calcTextareaPosition();this.hiddenTextarea.style.left=t.left,this.hiddenTextarea.style.top=t.top}}_calcTextareaPosition(){if(!this.canvas)return{left:"1px",top:"1px"};const t=this.inCompositionMode?this.compositionStart:this.selectionStart,e=this._getCursorBoundaries(t),s=this.get2DCursorLocation(t),i=s.lineIndex,n=s.charIndex,r=this.getValueOfPropertyAt(i,n,"fontSize")*this.lineHeight,o=e.leftOffset,a=this.getCanvasRetinaScaling(),h=this.canvas.upperCanvasEl,c=h.width/a,l=h.height/a,u=c-r,d=l-r,g=new gt(e.left+o,e.top+e.topOffset+r).transform(this.calcTransformMatrix()).transform(this.canvas.viewportTransform).multiply(new gt(h.clientWidth/c,h.clientHeight/l));return g.x<0&&(g.x=0),g.x>u&&(g.x=u),g.y<0&&(g.y=0),g.y>d&&(g.y=d),g.x+=this.canvas._offset.left,g.y+=this.canvas._offset.top,{left:"".concat(g.x,"px"),top:"".concat(g.y,"px"),fontSize:"".concat(r,"px"),charHeight:r}}_saveEditingProps(){this._savedProps={hasControls:this.hasControls,borderColor:this.borderColor,lockMovementX:this.lockMovementX,lockMovementY:this.lockMovementY,hoverCursor:this.hoverCursor,selectable:this.selectable,defaultCursor:this.canvas&&this.canvas.defaultCursor,moveCursor:this.canvas&&this.canvas.moveCursor}}_restoreEditingProps(){this._savedProps&&(this.hoverCursor=this._savedProps.hoverCursor,this.hasControls=this._savedProps.hasControls,this.borderColor=this._savedProps.borderColor,this.selectable=this._savedProps.selectable,this.lockMovementX=this._savedProps.lockMovementX,this.lockMovementY=this._savedProps.lockMovementY,this.canvas&&(this.canvas.defaultCursor=this._savedProps.defaultCursor||this.canvas.defaultCursor,this.canvas.moveCursor=this._savedProps.moveCursor||this.canvas.moveCursor),delete this._savedProps)}_exitEditing(){const t=this.hiddenTextarea;this.selected=!1,this.isEditing=!1,t&&(t.blur&&t.blur(),t.parentNode&&t.parentNode.removeChild(t)),this.hiddenTextarea=null,this.abortCursorAnimation(),this.selectionStart!==this.selectionEnd&&this.clearContextTop()}exitEditingImpl(){this._exitEditing(),this.selectionEnd=this.selectionStart,this._restoreEditingProps(),this._forceClearCache&&(this.initDimensions(),this.setCoords())}exitEditing(){const t=this._textBeforeEdit!==this.text;return this.exitEditingImpl(),this.fire("editing:exited"),t&&this.fire(nt),this.canvas&&(this.canvas.fire("text:editing:exited",{target:this}),t&&this.canvas.fire("object:modified",{target:this})),this}_removeExtraneousStyles(){for(const t in this.styles)this._textLines[t]||delete this.styles[t]}removeStyleFromTo(t,e){const{lineIndex:s,charIndex:i}=this.get2DCursorLocation(t,!0),{lineIndex:n,charIndex:r}=this.get2DCursorLocation(e,!0);if(s!==n){if(this.styles[s])for(let t=i;t<this._unwrappedTextLines[s].length;t++)delete this.styles[s][t];if(this.styles[n])for(let t=r;t<this._unwrappedTextLines[n].length;t++){const e=this.styles[n][t];e&&(this.styles[s]||(this.styles[s]={}),this.styles[s][i+t-r]=e)}for(let t=s+1;t<=n;t++)delete this.styles[t];this.shiftLineStyles(n,s-n)}else if(this.styles[s]){const t=this.styles[s],e=r-i;for(let s=i;s<r;s++)delete t[s];for(const i in this.styles[s]){const s=parseInt(i,10);s>=r&&(t[s-e]=t[i],delete t[i])}}}shiftLineStyles(t,e){const s=Object.assign({},this.styles);for(const i in this.styles){const n=parseInt(i,10);n>t&&(this.styles[n+e]=s[n],s[n-e]||delete this.styles[n])}}insertNewlineStyleObject(t,e,s,i){const n={},r=this._unwrappedTextLines[t].length,o=r===e;let a=!1;s||(s=1),this.shiftLineStyles(t,s);const h=this.styles[t]?this.styles[t][0===e?e:e-1]:void 0;for(const l in this.styles[t]){const s=parseInt(l,10);s>=e&&(a=!0,n[s-e]=this.styles[t][l],o&&0===e||delete this.styles[t][l])}let c=!1;for(a&&!o&&(this.styles[t+s]=n,c=!0),(c||r>e)&&s--;s>0;)i&&i[s-1]?this.styles[t+s]={0:l({},i[s-1])}:h?this.styles[t+s]={0:l({},h)}:delete this.styles[t+s],s--;this._forceClearCache=!0}insertCharStyleObject(t,e,s,i){this.styles||(this.styles={});const n=this.styles[t],r=n?l({},n):{};s||(s=1);for(const a in r){const t=parseInt(a,10);t>=e&&(n[t+s]=r[t],r[t-s]||delete n[t])}if(this._forceClearCache=!0,i){for(;s--;)Object.keys(i[s]).length&&(this.styles[t]||(this.styles[t]={}),this.styles[t][e+s]=l({},i[s]));return}if(!n)return;const o=n[e?e-1:1];for(;o&&s--;)this.styles[t][e+s]=l({},o)}insertNewStyleBlock(t,e,s){const i=this.get2DCursorLocation(e,!0),n=[0];let r,o=0;for(let a=0;a<t.length;a++)"\n"===t[a]?(o++,n[o]=0):n[o]++;for(n[0]>0&&(this.insertCharStyleObject(i.lineIndex,i.charIndex,n[0],s),s=s&&s.slice(n[0]+1)),o&&this.insertNewlineStyleObject(i.lineIndex,i.charIndex+n[0],o),r=1;r<o;r++)n[r]>0?this.insertCharStyleObject(i.lineIndex+r,0,n[r],s):s&&this.styles[i.lineIndex+r]&&s[0]&&(this.styles[i.lineIndex+r][0]=s[0]),s=s&&s.slice(n[r]+1);n[r]>0&&this.insertCharStyleObject(i.lineIndex+r,0,n[r],s)}removeChars(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:t+1;this.removeStyleFromTo(t,e),this._text.splice(t,e-t),this.text=this._text.join(""),this.set("dirty",!0),this.initDimensions(),this.setCoords(),this._removeExtraneousStyles()}insertChars(t,e,s){let i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:s;i>s&&this.removeStyleFromTo(s,i);const n=this.graphemeSplit(t);this.insertNewStyleBlock(n,s,e),this._text=[...this._text.slice(0,s),...n,...this._text.slice(i)],this.text=this._text.join(""),this.set("dirty",!0),this.initDimensions(),this.setCoords(),this._removeExtraneousStyles()}setSelectionStartEndWithShift(t,e,s){s<=t?(e===t?this._selectionDirection=L:this._selectionDirection===B&&(this._selectionDirection=L,this.selectionEnd=t),this.selectionStart=s):s>t&&s<e?this._selectionDirection===B?this.selectionEnd=s:this.selectionStart=s:(e===t?this._selectionDirection=B:this._selectionDirection===L&&(this._selectionDirection=B,this.selectionStart=e),this.selectionEnd=s)}}class jo extends Lo{initHiddenTextarea(){const t=this.canvas&&se(this.canvas.getElement())||x(),e=t.createElement("textarea");Object.entries({autocapitalize:"off",autocorrect:"off",autocomplete:"off",spellcheck:"false","data-fabric":"textarea",wrap:"off"}).map((t=>{let[s,i]=t;return e.setAttribute(s,i)}));const{top:s,left:i,fontSize:n}=this._calcTextareaPosition();e.style.cssText="position: absolute; top: ".concat(s,"; left: ").concat(i,"; z-index: -999; opacity: 0; width: 1px; height: 1px; font-size: 1px; padding-top: ").concat(n,";"),(this.hiddenTextareaContainer||t.body).appendChild(e),Object.entries({blur:"blur",keydown:"onKeyDown",keyup:"onKeyUp",input:"onInput",copy:"copy",cut:"copy",paste:"paste",compositionstart:"onCompositionStart",compositionupdate:"onCompositionUpdate",compositionend:"onCompositionEnd"}).map((t=>{let[s,i]=t;return e.addEventListener(s,this[i].bind(this))})),this.hiddenTextarea=e}blur(){this.abortCursorAnimation()}onKeyDown(t){if(!this.isEditing)return;const e="rtl"===this.direction?this.keysMapRtl:this.keysMap;if(t.keyCode in e)this[e[t.keyCode]](t);else{if(!(t.keyCode in this.ctrlKeysMapDown)||!t.ctrlKey&&!t.metaKey)return;this[this.ctrlKeysMapDown[t.keyCode]](t)}t.stopImmediatePropagation(),t.preventDefault(),t.keyCode>=33&&t.keyCode<=40?(this.inCompositionMode=!1,this.clearContextTop(),this.renderCursorOrSelection()):this.canvas&&this.canvas.requestRenderAll()}onKeyUp(t){!this.isEditing||this._copyDone||this.inCompositionMode?this._copyDone=!1:t.keyCode in this.ctrlKeysMapUp&&(t.ctrlKey||t.metaKey)&&(this[this.ctrlKeysMapUp[t.keyCode]](t),t.stopImmediatePropagation(),t.preventDefault(),this.canvas&&this.canvas.requestRenderAll())}onInput(t){const e=this.fromPaste,{value:s,selectionStart:i,selectionEnd:n}=this.hiddenTextarea;if(this.fromPaste=!1,t&&t.stopPropagation(),!this.isEditing)return;const r=()=>{this.updateFromTextArea(),this.fire(Q),this.canvas&&(this.canvas.fire("text:changed",{target:this}),this.canvas.requestRenderAll())};if(""===this.hiddenTextarea.value)return this.styles={},void r();const o=this._splitTextIntoLines(s).graphemeText,a=this._text.length,h=o.length,c=this.selectionStart,l=this.selectionEnd,u=c!==l;let d,g,f,m,_=h-a;const v=this.fromStringToGraphemeSelection(i,n,s),y=c>v.selectionStart;u?(g=this._text.slice(c,l),_+=l-c):h<a&&(g=y?this._text.slice(l+_,l):this._text.slice(c,c-_));const C=o.slice(v.selectionEnd-_,v.selectionEnd);if(g&&g.length&&(C.length&&(d=this.getSelectionStyles(c,c+1,!1),d=C.map((()=>d[0]))),u?(f=c,m=l):y?(f=l-g.length,m=l):(f=l,m=l+g.length),this.removeStyleFromTo(f,m)),C.length){const{copyPasteData:t}=w();e&&C.join("")===t.copiedText&&!p.disableStyleCopyPaste&&(d=t.copiedTextStyle),this.insertNewStyleBlock(C,c,d)}r()}onCompositionStart(){this.inCompositionMode=!0}onCompositionEnd(){this.inCompositionMode=!1}onCompositionUpdate(t){let{target:e}=t;const{selectionStart:s,selectionEnd:i}=e;this.compositionStart=s,this.compositionEnd=i,this.updateTextareaPosition()}copy(){if(this.selectionStart===this.selectionEnd)return;const{copyPasteData:t}=w();t.copiedText=this.getSelectedText(),p.disableStyleCopyPaste?t.copiedTextStyle=void 0:t.copiedTextStyle=this.getSelectionStyles(this.selectionStart,this.selectionEnd,!0),this._copyDone=!0}paste(){this.fromPaste=!0}_getWidthBeforeCursor(t,e){let s,i=this._getLineLeftOffset(t);return e>0&&(s=this.__charBounds[t][e-1],i+=s.left+s.width),i}getDownCursorOffset(t,e){const s=this._getSelectionForOffset(t,e),i=this.get2DCursorLocation(s),n=i.lineIndex;if(n===this._textLines.length-1||t.metaKey||34===t.keyCode)return this._text.length-s;const r=i.charIndex,o=this._getWidthBeforeCursor(n,r),a=this._getIndexOnLine(n+1,o);return this._textLines[n].slice(r).length+a+1+this.missingNewlineOffset(n)}_getSelectionForOffset(t,e){return t.shiftKey&&this.selectionStart!==this.selectionEnd&&e?this.selectionEnd:this.selectionStart}getUpCursorOffset(t,e){const s=this._getSelectionForOffset(t,e),i=this.get2DCursorLocation(s),n=i.lineIndex;if(0===n||t.metaKey||33===t.keyCode)return-s;const r=i.charIndex,o=this._getWidthBeforeCursor(n,r),a=this._getIndexOnLine(n-1,o),h=this._textLines[n].slice(0,r),c=this.missingNewlineOffset(n-1);return-this._textLines[n-1].length+a-h.length+(1-c)}_getIndexOnLine(t,e){const s=this._textLines[t];let i,n,r=this._getLineLeftOffset(t),o=0;for(let a=0,h=s.length;a<h;a++)if(i=this.__charBounds[t][a].width,r+=i,r>e){n=!0;const t=r-i,s=r,h=Math.abs(t-e);o=Math.abs(s-e)<h?a:a-1;break}return n||(o=s.length-1),o}moveCursorDown(t){this.selectionStart>=this._text.length&&this.selectionEnd>=this._text.length||this._moveCursorUpOrDown("Down",t)}moveCursorUp(t){0===this.selectionStart&&0===this.selectionEnd||this._moveCursorUpOrDown("Up",t)}_moveCursorUpOrDown(t,e){const s=this["get".concat(t,"CursorOffset")](e,this._selectionDirection===B);if(e.shiftKey?this.moveCursorWithShift(s):this.moveCursorWithoutShift(s),0!==s){const t=this.text.length;this.selectionStart=Rs(0,this.selectionStart,t),this.selectionEnd=Rs(0,this.selectionEnd,t),this.abortCursorAnimation(),this.initDelayedCursor(),this._fireSelectionChanged(),this._updateTextarea()}}moveCursorWithShift(t){const e=this._selectionDirection===L?this.selectionStart+t:this.selectionEnd+t;return this.setSelectionStartEndWithShift(this.selectionStart,this.selectionEnd,e),0!==t}moveCursorWithoutShift(t){return t<0?(this.selectionStart+=t,this.selectionEnd=this.selectionStart):(this.selectionEnd+=t,this.selectionStart=this.selectionEnd),0!==t}moveCursorLeft(t){0===this.selectionStart&&0===this.selectionEnd||this._moveCursorLeftOrRight("Left",t)}_move(t,e,s){let i;if(t.altKey)i=this["findWordBoundary".concat(s)](this[e]);else{if(!t.metaKey&&35!==t.keyCode&&36!==t.keyCode)return this[e]+="Left"===s?-1:1,!0;i=this["findLineBoundary".concat(s)](this[e])}return void 0!==i&&this[e]!==i&&(this[e]=i,!0)}_moveLeft(t,e){return this._move(t,e,"Left")}_moveRight(t,e){return this._move(t,e,"Right")}moveCursorLeftWithoutShift(t){let e=!0;return this._selectionDirection=L,this.selectionEnd===this.selectionStart&&0!==this.selectionStart&&(e=this._moveLeft(t,"selectionStart")),this.selectionEnd=this.selectionStart,e}moveCursorLeftWithShift(t){return this._selectionDirection===B&&this.selectionStart!==this.selectionEnd?this._moveLeft(t,"selectionEnd"):0!==this.selectionStart?(this._selectionDirection=L,this._moveLeft(t,"selectionStart")):void 0}moveCursorRight(t){this.selectionStart>=this._text.length&&this.selectionEnd>=this._text.length||this._moveCursorLeftOrRight("Right",t)}_moveCursorLeftOrRight(t,e){const s="moveCursor".concat(t).concat(e.shiftKey?"WithShift":"WithoutShift");this._currentCursorOpacity=1,this[s](e)&&(this.abortCursorAnimation(),this.initDelayedCursor(),this._fireSelectionChanged(),this._updateTextarea())}moveCursorRightWithShift(t){return this._selectionDirection===L&&this.selectionStart!==this.selectionEnd?this._moveRight(t,"selectionStart"):this.selectionEnd!==this._text.length?(this._selectionDirection=B,this._moveRight(t,"selectionEnd")):void 0}moveCursorRightWithoutShift(t){let e=!0;return this._selectionDirection=B,this.selectionStart===this.selectionEnd?(e=this._moveRight(t,"selectionStart"),this.selectionEnd=this.selectionStart):this.selectionStart=this.selectionEnd,e}}const No=t=>!!t.button;class Bo extends jo{constructor(){super(...arguments),h(this,"draggableTextDelegate",void 0)}initBehavior(){this.on("mousedown",this._mouseDownHandler),this.on("mouseup",this.mouseUpHandler),this.on("mousedblclick",this.doubleClickHandler),this.on("mousetripleclick",this.tripleClickHandler),this.draggableTextDelegate=new Ro(this),super.initBehavior()}shouldStartDragging(){return this.draggableTextDelegate.isActive()}onDragStart(t){return this.draggableTextDelegate.onDragStart(t)}canDrop(t){return this.draggableTextDelegate.canDrop(t)}doubleClickHandler(t){this.isEditing&&(this.selectWord(this.getSelectionStartFromPointer(t.e)),this.renderCursorOrSelection())}tripleClickHandler(t){this.isEditing&&(this.selectLine(this.getSelectionStartFromPointer(t.e)),this.renderCursorOrSelection())}_mouseDownHandler(t){let{e:e,alreadySelected:s}=t;this.canvas&&this.editable&&!No(e)&&!this.getActiveControl()&&(this.draggableTextDelegate.start(e)||(this.canvas.textEditingManager.register(this),s&&(this.inCompositionMode=!1,this.setCursorByClick(e)),this.isEditing&&(this.__selectionStartOnMouseDown=this.selectionStart,this.selectionStart===this.selectionEnd&&this.abortCursorAnimation(),this.renderCursorOrSelection()),this.selected||(this.selected=s||this.isEditing)))}mouseUpHandler(t){let{e:e,transform:s}=t;const i=this.draggableTextDelegate.end(e);if(this.canvas){this.canvas.textEditingManager.unregister(this);const t=this.canvas._activeObject;if(t&&t!==this)return}!this.editable||this.group&&!this.group.interactive||s&&s.actionPerformed||No(e)||i||this.selected&&!this.getActiveControl()&&(this.enterEditing(e),this.selectionStart===this.selectionEnd?this.initDelayedCursor(!0):this.renderCursorOrSelection())}setCursorByClick(t){const e=this.getSelectionStartFromPointer(t),s=this.selectionStart,i=this.selectionEnd;t.shiftKey?this.setSelectionStartEndWithShift(s,i,e):(this.selectionStart=e,this.selectionEnd=e),this.isEditing&&(this._fireSelectionChanged(),this._updateTextarea())}getSelectionStartFromPointer(t){const e=this.canvas.getScenePoint(t).transform(Pt(this.calcTransformMatrix())).add(new gt(-this._getLeftOffset(),-this._getTopOffset()));let s=0,i=0,n=0;for(let h=0;h<this._textLines.length&&s<=e.y;h++)s+=this.getHeightOfLine(h),n=h,h>0&&(i+=this._textLines[h-1].length+this.missingNewlineOffset(h-1));let r=Math.abs(this._getLineLeftOffset(n));const o=this._textLines[n].length,a=this.__charBounds[n];for(let h=0;h<o;h++){const t=r+a[h].kernedWidth;if(e.x<=t){Math.abs(e.x-t)<=Math.abs(e.x-r)&&i++;break}r=t,i++}return Math.min(this.flipX?o-i:i,this._text.length)}}const Wo="moveCursorUp",Uo="moveCursorDown",Yo="moveCursorLeft",Xo="moveCursorRight",Vo="exitEditing",Go=(t,e)=>{const s=e.getRetinaScaling();t.setTransform(s,0,0,s,0,0);const i=e.viewportTransform;t.transform(i[0],i[1],i[2],i[3],i[4],i[5])},Ho=l({selectionStart:0,selectionEnd:0,selectionColor:"rgba(17,119,255,0.3)",isEditing:!1,editable:!0,editingBorderColor:"rgba(102,153,255,0.25)",cursorWidth:2,cursorColor:"",cursorDelay:1e3,cursorDuration:600,caching:!0,hiddenTextareaContainer:null,keysMap:{9:Vo,27:Vo,33:Wo,34:Uo,35:Xo,36:Yo,37:Yo,38:Wo,39:Xo,40:Uo},keysMapRtl:{9:Vo,27:Vo,33:Wo,34:Uo,35:Yo,36:Xo,37:Xo,38:Wo,39:Yo,40:Uo},ctrlKeysMapDown:{65:"cmdAll"},ctrlKeysMapUp:{67:"copy",88:"cut"}},{_selectionDirection:null,_reSpace:/\s|\r?\n/,inCompositionMode:!1});class zo extends Bo{static getDefaults(){return l(l({},super.getDefaults()),zo.ownDefaults)}get type(){const t=super.type;return"itext"===t?"i-text":t}constructor(t,e){super(t,l(l({},zo.ownDefaults),e)),this.initBehavior()}_set(t,e){return this.isEditing&&this._savedProps&&t in this._savedProps?(this._savedProps[t]=e,this):("canvas"===t&&(this.canvas instanceof Vr&&this.canvas.textEditingManager.remove(this),e instanceof Vr&&e.textEditingManager.add(this)),super._set(t,e))}setSelectionStart(t){t=Math.max(t,0),this._updateAndFire("selectionStart",t)}setSelectionEnd(t){t=Math.min(t,this.text.length),this._updateAndFire("selectionEnd",t)}_updateAndFire(t,e){this[t]!==e&&(this._fireSelectionChanged(),this[t]=e),this._updateTextarea()}_fireSelectionChanged(){this.fire("selection:changed"),this.canvas&&this.canvas.fire("text:selection:changed",{target:this})}initDimensions(){this.isEditing&&this.initDelayedCursor(),super.initDimensions()}getSelectionStyles(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.selectionStart||0,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.selectionEnd,s=arguments.length>2?arguments[2]:void 0;return super.getSelectionStyles(t,e,s)}setSelectionStyles(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.selectionStart||0,s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:this.selectionEnd;return super.setSelectionStyles(t,e,s)}get2DCursorLocation(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.selectionStart,e=arguments.length>1?arguments[1]:void 0;return super.get2DCursorLocation(t,e)}render(t){super.render(t),this.cursorOffsetCache={},this.renderCursorOrSelection()}toCanvasElement(t){const e=this.isEditing;this.isEditing=!1;const s=super.toCanvasElement(t);return this.isEditing=e,s}renderCursorOrSelection(){if(!this.isEditing||!this.canvas)return;const t=this.clearContextTop(!0);if(!t)return;const e=this._getCursorBoundaries(),s=this.findAncestorsWithClipPath(),i=s.length>0;let n,r=t;if(i){n=St(t.canvas),r=n.getContext("2d"),Go(r,this.canvas);const e=this.calcTransformMatrix();r.transform(e[0],e[1],e[2],e[3],e[4],e[5])}if(this.selectionStart!==this.selectionEnd||this.inCompositionMode?this.renderSelection(r,e):this.renderCursor(r,e),i)for(const o of s){const e=o.clipPath,s=St(t.canvas),i=s.getContext("2d");if(Go(i,this.canvas),!e.absolutePositioned){const t=o.calcTransformMatrix();i.transform(t[0],t[1],t[2],t[3],t[4],t[5])}e.transform(i),e.drawObject(i,!0,{}),this.drawClipPathOnCache(r,e,s)}i&&(t.setTransform(1,0,0,1,0,0),t.drawImage(n,0,0)),this.canvas.contextTopDirty=!0,t.restore()}findAncestorsWithClipPath(){const t=[];let e=this;for(;e;)e.clipPath&&t.push(e),e=e.parent;return t}_getCursorBoundaries(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.selectionStart,e=arguments.length>1?arguments[1]:void 0;const s=this._getLeftOffset(),i=this._getTopOffset(),n=this._getCursorBoundariesOffsets(t,e);return{left:s,top:i,leftOffset:n.left,topOffset:n.top}}_getCursorBoundariesOffsets(t,e){return e?this.__getCursorBoundariesOffsets(t):this.cursorOffsetCache&&"top"in this.cursorOffsetCache?this.cursorOffsetCache:this.cursorOffsetCache=this.__getCursorBoundariesOffsets(t)}__getCursorBoundariesOffsets(t){let e=0,s=0;const{charIndex:i,lineIndex:n}=this.get2DCursorLocation(t);for(let h=0;h<n;h++)e+=this.getHeightOfLine(h);const r=this._getLineLeftOffset(n),o=this.__charBounds[n][i];o&&(s=o.left),0!==this.charSpacing&&i===this._textLines[n].length&&(s-=this._getWidthOfCharSpacing());const a={top:e,left:r+(s>0?s:0)};return"rtl"===this.direction&&(this.textAlign===B||this.textAlign===es||this.textAlign===is?a.left*=-1:this.textAlign===L||this.textAlign===ss?a.left=r-(s>0?s:0):this.textAlign!==F&&this.textAlign!==ns||(a.left=r-(s>0?s:0))),a}renderCursorAt(t){this._renderCursor(this.canvas.contextTop,this._getCursorBoundaries(t,!0),t)}renderCursor(t,e){this._renderCursor(t,e,this.selectionStart)}getCursorRenderingData(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.selectionStart,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this._getCursorBoundaries(t);const s=this.get2DCursorLocation(t),i=s.lineIndex,n=s.charIndex>0?s.charIndex-1:0,r=this.getValueOfPropertyAt(i,n,"fontSize"),o=this.getObjectScaling().x*this.canvas.getZoom(),a=this.cursorWidth/o,h=this.getValueOfPropertyAt(i,n,"deltaY"),c=e.topOffset+(1-this._fontSizeFraction)*this.getHeightOfLine(i)/this.lineHeight-r*(1-this._fontSizeFraction);return{color:this.cursorColor||this.getValueOfPropertyAt(i,n,"fill"),opacity:this._currentCursorOpacity,left:e.left+e.leftOffset-a/2,top:c+e.top+h,width:a,height:r}}_renderCursor(t,e,s){const{color:i,opacity:n,left:r,top:o,width:a,height:h}=this.getCursorRenderingData(s,e);t.fillStyle=i,t.globalAlpha=n,t.fillRect(r,o,a,h)}renderSelection(t,e){const s={selectionStart:this.inCompositionMode?this.hiddenTextarea.selectionStart:this.selectionStart,selectionEnd:this.inCompositionMode?this.hiddenTextarea.selectionEnd:this.selectionEnd};this._renderSelection(t,s,e)}renderDragSourceEffect(){const t=this.draggableTextDelegate.getDragStartSelection();this._renderSelection(this.canvas.contextTop,t,this._getCursorBoundaries(t.selectionStart,!0))}renderDropTargetEffect(t){const e=this.getSelectionStartFromPointer(t);this.renderCursorAt(e)}_renderSelection(t,e,s){const i=e.selectionStart,n=e.selectionEnd,r=this.textAlign.includes(es),o=this.get2DCursorLocation(i),a=this.get2DCursorLocation(n),h=o.lineIndex,c=a.lineIndex,l=o.charIndex<0?0:o.charIndex,u=a.charIndex<0?0:a.charIndex;for(let d=h;d<=c;d++){const e=this._getLineLeftOffset(d)||0;let i=this.getHeightOfLine(d),n=0,o=0,a=0;if(d===h&&(o=this.__charBounds[h][l].left),d>=h&&d<c)a=r&&!this.isEndOfWrapping(d)?this.width:this.getLineWidth(d)||5;else if(d===c)if(0===u)a=this.__charBounds[c][u].left;else{const t=this._getWidthOfCharSpacing();a=this.__charBounds[c][u-1].left+this.__charBounds[c][u-1].width-t}n=i,(this.lineHeight<1||d===c&&this.lineHeight>1)&&(i/=this.lineHeight);let g=s.left+e+o,p=i,f=0;const m=a-o;this.inCompositionMode?(t.fillStyle=this.compositionColor||"black",p=1,f=i):t.fillStyle=this.selectionColor,"rtl"===this.direction&&(this.textAlign===B||this.textAlign===es||this.textAlign===is?g=this.width-g-m:this.textAlign===L||this.textAlign===ss?g=s.left+e-a:this.textAlign!==F&&this.textAlign!==ns||(g=s.left+e-a)),t.fillRect(g,s.top+s.topOffset+f,m,p),s.topOffset+=n}}getCurrentCharFontSize(){const t=this._getCurrentCharIndex();return this.getValueOfPropertyAt(t.l,t.c,"fontSize")}getCurrentCharColor(){const t=this._getCurrentCharIndex();return this.getValueOfPropertyAt(t.l,t.c,st)}_getCurrentCharIndex(){const t=this.get2DCursorLocation(this.selectionStart,!0),e=t.charIndex>0?t.charIndex-1:0;return{l:t.lineIndex,c:e}}dispose(){this.exitEditingImpl(),this.draggableTextDelegate.dispose(),super.dispose()}}h(zo,"ownDefaults",Ho),h(zo,"type","IText"),at.setClass(zo),at.setClass(zo,"i-text");class qo extends zo{static getDefaults(){return l(l({},super.getDefaults()),qo.ownDefaults)}constructor(t,e){super(t,l(l({},qo.ownDefaults),e))}static createControls(){return{controls:ji()}}initDimensions(){this.initialized&&(this.isEditing&&this.initDelayedCursor(),this._clearCache(),this.dynamicMinWidth=0,this._styleMap=this._generateStyleMap(this._splitText()),this.dynamicMinWidth>this.width&&this._set("width",this.dynamicMinWidth),this.textAlign.includes(es)&&this.enlargeSpaces(),this.height=this.calcTextHeight())}_generateStyleMap(t){let e=0,s=0,i=0;const n={};for(let r=0;r<t.graphemeLines.length;r++)"\n"===t.graphemeText[i]&&r>0?(s=0,i++,e++):!this.splitByGrapheme&&this._reSpaceAndTab.test(t.graphemeText[i])&&r>0&&(s++,i++),n[r]={line:e,offset:s},i+=t.graphemeLines[r].length,s+=t.graphemeLines[r].length;return n}styleHas(t,e){if(this._styleMap&&!this.isWrapping){const t=this._styleMap[e];t&&(e=t.line)}return super.styleHas(t,e)}isEmptyStyles(t){if(!this.styles)return!0;let e,s=0,i=t+1,n=!1;const r=this._styleMap[t],o=this._styleMap[t+1];r&&(t=r.line,s=r.offset),o&&(i=o.line,n=i===t,e=o.offset);const a=void 0===t?this.styles:{line:this.styles[t]};for(const h in a)for(const t in a[h]){const i=parseInt(t,10);if(i>=s&&(!n||i<e))for(const e in a[h][t])return!1}return!0}_getStyleDeclaration(t,e){if(this._styleMap&&!this.isWrapping){const s=this._styleMap[t];if(!s)return{};t=s.line,e=s.offset+e}return super._getStyleDeclaration(t,e)}_setStyleDeclaration(t,e,s){const i=this._styleMap[t];super._setStyleDeclaration(i.line,i.offset+e,s)}_deleteStyleDeclaration(t,e){const s=this._styleMap[t];super._deleteStyleDeclaration(s.line,s.offset+e)}_getLineStyle(t){const e=this._styleMap[t];return!!this.styles[e.line]}_setLineStyle(t){const e=this._styleMap[t];super._setLineStyle(e.line)}_wrapText(t,e){this.isWrapping=!0;const s=this.getGraphemeDataForRender(t),i=[];for(let n=0;n<s.wordsData.length;n++)i.push(...this._wrapLine(n,e,s));return this.isWrapping=!1,i}getGraphemeDataForRender(t){const e=this.splitByGrapheme,s=e?"":" ";let i=0;return{wordsData:t.map(((t,n)=>{let r=0;const o=e?this.graphemeSplit(t):this.wordSplit(t);return 0===o.length?[{word:[],width:0}]:o.map((t=>{const o=e?[t]:this.graphemeSplit(t),a=this._measureWord(o,n,r);return i=Math.max(a,i),r+=o.length+s.length,{word:o,width:a}}))})),largestWordWidth:i}}_measureWord(t,e){let s,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,n=0;for(let r=0,o=t.length;r<o;r++)n+=this._getGraphemeBox(t[r],e,r+i,s,!0).kernedWidth,s=t[r];return n}wordSplit(t){return t.split(this._wordJoiners)}_wrapLine(t,e,s){let{largestWordWidth:i,wordsData:n}=s,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;const o=this._getWidthOfCharSpacing(),a=this.splitByGrapheme,h=[],c=a?"":" ";let l=0,u=[],d=0,g=0,p=!0;e-=r;const f=Math.max(e,i,this.dynamicMinWidth),m=n[t];let _;for(d=0,_=0;_<m.length;_++){const{word:e,width:s}=m[_];d+=e.length,l+=g+s-o,l>f&&!p?(h.push(u),u=[],l=s,p=!0):l+=o,p||a||u.push(c),u=u.concat(e),g=a?0:this._measureWord([c],t,d),d++,p=!1}return _&&h.push(u),i+r>this.dynamicMinWidth&&(this.dynamicMinWidth=i-o+r),h}isEndOfWrapping(t){return!this._styleMap[t+1]||this._styleMap[t+1].line!==this._styleMap[t].line}missingNewlineOffset(t,e){return this.splitByGrapheme&&!e?this.isEndOfWrapping(t)?1:0:1}_splitTextIntoLines(t){const e=super._splitTextIntoLines(t),s=this._wrapText(e.lines,this.width),i=new Array(s.length);for(let n=0;n<s.length;n++)i[n]=s[n].join("");return e.lines=i,e.graphemeLines=s,e}getMinWidth(){return Math.max(this.minWidth,this.dynamicMinWidth)}_removeExtraneousStyles(){const t=new Map;for(const e in this._styleMap){const s=parseInt(e,10);if(this._textLines[s]){const s=this._styleMap[e].line;t.set("".concat(s),!0)}}for(const e in this.styles)t.has(e)||delete this.styles[e]}toObject(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];return super.toObject(["minWidth","splitByGrapheme",...t])}}h(qo,"type","Textbox"),h(qo,"textLayoutProperties",[...zo.textLayoutProperties,"width"]),h(qo,"ownDefaults",{minWidth:20,dynamicMinWidth:2,lockScalingFlip:!0,noScaleCache:!1,_wordJoiners:/[ \t\r]/,splitByGrapheme:!1}),at.setClass(qo);class Ko extends Gn{shouldPerformLayout(t){return!!t.target.clipPath&&super.shouldPerformLayout(t)}shouldLayoutClipPath(){return!1}calcLayoutResult(t,e){const{target:s}=t,{clipPath:i,group:n}=s;if(!i||!this.shouldPerformLayout(t))return;const{width:r,height:o}=pe(Vn(s,i)),a=new gt(r,o);if(i.absolutePositioned)return{center:we(i.getRelativeCenterPoint(),void 0,n?n.calcTransformMatrix():void 0),size:a};{const n=i.getRelativeCenterPoint().transform(s.calcOwnMatrix(),!0);if(this.shouldPerformLayout(t)){const{center:s=new gt,correction:i=new gt}=this.calcBoundingBox(e,t)||{};return{center:s.add(n),correction:i.subtract(n),size:a}}return{center:s.getRelativeCenterPoint().add(n),size:a}}}}h(Ko,"type","clip-path"),at.setClass(Ko);class Qo extends Gn{getInitialSize(t,e){let{target:s}=t,{size:i}=e;return new gt(s.width||i.x,s.height||i.y)}}h(Qo,"type","fixed"),at.setClass(Qo);class Jo extends Qn{subscribeTargets(t){const e=t.target;t.targets.reduce(((t,e)=>(e.parent&&t.add(e.parent),t)),new Set).forEach((t=>{t.layoutManager.subscribeTargets({target:t,targets:[e]})}))}unsubscribeTargets(t){const e=t.target,s=e.getObjects();t.targets.reduce(((t,e)=>(e.parent&&t.add(e.parent),t)),new Set).forEach((t=>{!s.some((e=>e.parent===t))&&t.layoutManager.unsubscribeTargets({target:t,targets:[e]})}))}}class Zo extends $n{static getDefaults(){return l(l({},super.getDefaults()),Zo.ownDefaults)}constructor(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};super(),Object.assign(this,Zo.ownDefaults),this.setOptions(e);const{left:s,top:i,layoutManager:n}=e;this.groupInit(t,{left:s,top:i,layoutManager:null!=n?n:new Jo})}_shouldSetNestedCoords(){return!0}__objectSelectionMonitor(){}multiSelectAdd(){for(var t=arguments.length,e=new Array(t),s=0;s<t;s++)e[s]=arguments[s];"selection-order"===this.multiSelectionStacking?this.add(...e):e.forEach((t=>{const e=this._objects.findIndex((e=>e.isInFrontOf(t))),s=-1===e?this.size():e;this.insertAt(s,t)}))}canEnterGroup(t){return this.getObjects().some((e=>e.isDescendantOf(t)||t.isDescendantOf(e)))?(f("error","ActiveSelection: circular object trees are not supported, this call has no effect"),!1):super.canEnterGroup(t)}enterGroup(t,e){t.parent&&t.parent===t.group?t.parent._exitGroup(t):t.group&&t.parent!==t.group&&t.group.remove(t),this._enterGroup(t,e)}exitGroup(t,e){this._exitGroup(t,e),t.parent&&t.parent._enterGroup(t,!0)}_onAfterObjectsChange(t,e){super._onAfterObjectsChange(t,e);const s=new Set;e.forEach((t=>{const{parent:e}=t;e&&s.add(e)})),t===Yn?s.forEach((t=>{t._onAfterObjectsChange(Un,e)})):s.forEach((t=>{t._set("dirty",!0)}))}onDeselect(){return this.removeAll(),!1}toString(){return"#<ActiveSelection: (".concat(this.complexity(),")>")}shouldCache(){return!1}isOnACache(){return!1}_renderControls(t,e,s){t.save(),t.globalAlpha=this.isMoving?this.borderOpacityWhenMoving:1;const i=l(l({hasControls:!1},s),{},{forActiveSelection:!0});for(let n=0;n<this._objects.length;n++)this._objects[n]._renderControls(t,i);super._renderControls(t,e),t.restore()}}h(Zo,"type","ActiveSelection"),h(Zo,"ownDefaults",{multiSelectionStacking:"canvas-stacking"}),at.setClass(Zo),at.setClass(Zo,"activeSelection");class $o{constructor(){h(this,"resources",{})}applyFilters(t,e,s,i,n){const r=n.getContext("2d");if(!r)return;r.drawImage(e,0,0,s,i);const o={sourceWidth:s,sourceHeight:i,imageData:r.getImageData(0,0,s,i),originalEl:e,originalImageData:r.getImageData(0,0,s,i),canvasEl:n,ctx:r,filterBackend:this};t.forEach((t=>{t.applyTo(o)}));const{imageData:a}=o;return a.width===s&&a.height===i||(n.width=a.width,n.height=a.height),r.putImageData(a,0,0),o}}class ta{constructor(){let{tileSize:t=p.textureSize}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};h(this,"aPosition",new Float32Array([0,0,0,1,1,0,1,1])),h(this,"resources",{}),this.tileSize=t,this.setupGLContext(t,t),this.captureGPUInfo()}setupGLContext(t,e){this.dispose(),this.createWebGLCanvas(t,e)}createWebGLCanvas(t,e){const s=St({width:t,height:e}),i=s.getContext("webgl",{alpha:!0,premultipliedAlpha:!1,depth:!1,stencil:!1,antialias:!1});i&&(i.clearColor(0,0,0,0),this.canvas=s,this.gl=i)}applyFilters(t,e,s,i,n,r){const o=this.gl,a=n.getContext("2d");if(!o||!a)return;let h;r&&(h=this.getCachedTexture(r,e));const c={originalWidth:e.width||e.naturalWidth||0,originalHeight:e.height||e.naturalHeight||0,sourceWidth:s,sourceHeight:i,destinationWidth:s,destinationHeight:i,context:o,sourceTexture:this.createTexture(o,s,i,h?void 0:e),targetTexture:this.createTexture(o,s,i),originalTexture:h||this.createTexture(o,s,i,h?void 0:e),passes:t.length,webgl:!0,aPosition:this.aPosition,programCache:this.programCache,pass:0,filterBackend:this,targetCanvas:n},l=o.createFramebuffer();return o.bindFramebuffer(o.FRAMEBUFFER,l),t.forEach((t=>{t&&t.applyTo(c)})),function(t){const e=t.targetCanvas,s=e.width,i=e.height,n=t.destinationWidth,r=t.destinationHeight;s===n&&i===r||(e.width=n,e.height=r)}(c),this.copyGLTo2D(o,c),o.bindTexture(o.TEXTURE_2D,null),o.deleteTexture(c.sourceTexture),o.deleteTexture(c.targetTexture),o.deleteFramebuffer(l),a.setTransform(1,0,0,1,0,0),c}dispose(){this.canvas&&(this.canvas=null,this.gl=null),this.clearWebGLCaches()}clearWebGLCaches(){this.programCache={},this.textureCache={}}createTexture(t,e,s,i,n){const{NEAREST:r,TEXTURE_2D:o,RGBA:a,UNSIGNED_BYTE:h,CLAMP_TO_EDGE:c,TEXTURE_MAG_FILTER:l,TEXTURE_MIN_FILTER:u,TEXTURE_WRAP_S:d,TEXTURE_WRAP_T:g}=t,p=t.createTexture();return t.bindTexture(o,p),t.texParameteri(o,l,n||r),t.texParameteri(o,u,n||r),t.texParameteri(o,d,c),t.texParameteri(o,g,c),i?t.texImage2D(o,0,a,a,h,i):t.texImage2D(o,0,a,e,s,0,a,h,null),p}getCachedTexture(t,e,s){const{textureCache:i}=this;if(i[t])return i[t];{const n=this.createTexture(this.gl,e.width,e.height,e,s);return n&&(i[t]=n),n}}evictCachesForKey(t){this.textureCache[t]&&(this.gl.deleteTexture(this.textureCache[t]),delete this.textureCache[t])}copyGLTo2D(t,e){const s=t.canvas,i=e.targetCanvas,n=i.getContext("2d");if(!n)return;n.translate(0,i.height),n.scale(1,-1);const r=s.height-i.height;n.drawImage(s,0,r,i.width,i.height,0,0,i.width,i.height)}copyGLTo2DPutImageData(t,e){const s=e.targetCanvas.getContext("2d"),i=e.destinationWidth,n=e.destinationHeight,r=i*n*4;if(!s)return;const o=new Uint8Array(this.imageBuffer,0,r),a=new Uint8ClampedArray(this.imageBuffer,0,r);t.readPixels(0,0,i,n,t.RGBA,t.UNSIGNED_BYTE,o);const h=new ImageData(a,i,n);s.putImageData(h,0,0)}captureGPUInfo(){if(this.gpuInfo)return this.gpuInfo;const t=this.gl,e={renderer:"",vendor:""};if(!t)return e;const s=t.getExtension("WEBGL_debug_renderer_info");if(s){const i=t.getParameter(s.UNMASKED_RENDERER_WEBGL),n=t.getParameter(s.UNMASKED_VENDOR_WEBGL);i&&(e.renderer=i.toLowerCase()),n&&(e.vendor=n.toLowerCase())}return this.gpuInfo=e,e}}let ea;function sa(){const{WebGLProbe:t}=w();return t.queryWebGL(wt()),p.enableGLFiltering&&t.isSupported(p.textureSize)?new ta({tileSize:p.textureSize}):new $o}function ia(){return!ea&&(!(arguments.length>0&&void 0!==arguments[0])||arguments[0])&&(ea=sa()),ea}const na=["filters","resizeFilter","src","crossOrigin","type"],ra=["cropX","cropY"];class oa extends Wi{static getDefaults(){return l(l({},super.getDefaults()),oa.ownDefaults)}constructor(t,e){super(),h(this,"_lastScaleX",1),h(this,"_lastScaleY",1),h(this,"_filterScalingX",1),h(this,"_filterScalingY",1),this.filters=[],Object.assign(this,oa.ownDefaults),this.setOptions(e),this.cacheKey="texture".concat(bt()),this.setElement("string"==typeof t?(this.canvas&&se(this.canvas.getElement())||x()).getElementById(t):t,e)}getElement(){return this._element}setElement(t){var e;let s=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};this.removeTexture(this.cacheKey),this.removeTexture("".concat(this.cacheKey,"_filtered")),this._element=t,this._originalElement=t,this._setWidthHeight(s),null===(e=t.classList)||void 0===e||e.add(oa.CSS_CANVAS),0!==this.filters.length&&this.applyFilters(),this.resizeFilter&&this.applyResizeFilters()}removeTexture(t){const e=ia(!1);e instanceof ta&&e.evictCachesForKey(t)}dispose(){super.dispose(),this.removeTexture(this.cacheKey),this.removeTexture("".concat(this.cacheKey,"_filtered")),this._cacheContext=null,["_originalElement","_element","_filteredEl","_cacheCanvas"].forEach((t=>{const e=this[t];e&&w().dispose(e),this[t]=void 0}))}getCrossOrigin(){return this._originalElement&&(this._originalElement.crossOrigin||null)}getOriginalSize(){const t=this.getElement();return t?{width:t.naturalWidth||t.width,height:t.naturalHeight||t.height}:{width:0,height:0}}_stroke(t){if(!this.stroke||0===this.strokeWidth)return;const e=this.width/2,s=this.height/2;t.beginPath(),t.moveTo(-e,-s),t.lineTo(e,-s),t.lineTo(e,s),t.lineTo(-e,s),t.lineTo(-e,-s),t.closePath()}toObject(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];const e=[];return this.filters.forEach((t=>{t&&e.push(t.toObject())})),l(l({},super.toObject([...ra,...t])),{},{src:this.getSrc(),crossOrigin:this.getCrossOrigin(),filters:e},this.resizeFilter?{resizeFilter:this.resizeFilter.toObject()}:{})}hasCrop(){return!!this.cropX||!!this.cropY||this.width<this._element.width||this.height<this._element.height}_toSVG(){const t=[],e=this._element,s=-this.width/2,i=-this.height/2;let n=[],r=[],o="",a="";if(!e)return[];if(this.hasCrop()){const t=bt();n.push('<clipPath id="imageCrop_'+t+'">\n','\t<rect x="'+s+'" y="'+i+'" width="'+this.width+'" height="'+this.height+'" />\n',"</clipPath>\n"),o=' clip-path="url(#imageCrop_'+t+')" '}if(this.imageSmoothing||(a=' image-rendering="optimizeSpeed"'),t.push("\t<image ","COMMON_PARTS",'xlink:href="'.concat(this.getSvgSrc(!0),'" x="').concat(s-this.cropX,'" y="').concat(i-this.cropY,'" width="').concat(e.width||e.naturalWidth,'" height="').concat(e.height||e.naturalHeight,'"').concat(a).concat(o,"></image>\n")),this.stroke||this.strokeDashArray){const t=this.fill;this.fill=null,r=['\t<rect x="'.concat(s,'" y="').concat(i,'" width="').concat(this.width,'" height="').concat(this.height,'" style="').concat(this.getSvgStyles(),'" />\n')],this.fill=t}return n=this.paintFirst!==st?n.concat(r,t):n.concat(t,r),n}getSrc(t){const e=t?this._element:this._originalElement;return e?e.toDataURL?e.toDataURL():this.srcFromAttribute?e.getAttribute("src")||"":e.src:this.src||""}getSvgSrc(t){return this.getSrc(t)}setSrc(t){let{crossOrigin:e,signal:s}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return Vt(t,{crossOrigin:e,signal:s}).then((t=>{void 0!==e&&this.set({crossOrigin:e}),this.setElement(t)}))}toString(){return'#<Image: { src: "'.concat(this.getSrc(),'" }>')}applyResizeFilters(){const t=this.resizeFilter,e=this.minimumScaleTrigger,s=this.getTotalObjectScaling(),i=s.x,n=s.y,r=this._filteredEl||this._originalElement;if(this.group&&this.set("dirty",!0),!t||i>e&&n>e)return this._element=r,this._filterScalingX=1,this._filterScalingY=1,this._lastScaleX=i,void(this._lastScaleY=n);const o=St(r),{width:a,height:h}=r;this._element=o,this._lastScaleX=t.scaleX=i,this._lastScaleY=t.scaleY=n,ia().applyFilters([t],r,a,h,this._element),this._filterScalingX=o.width/this._originalElement.width,this._filterScalingY=o.height/this._originalElement.height}applyFilters(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.filters||[];if(t=t.filter((t=>t&&!t.isNeutralState())),this.set("dirty",!0),this.removeTexture("".concat(this.cacheKey,"_filtered")),0===t.length)return this._element=this._originalElement,this._filteredEl=void 0,this._filterScalingX=1,void(this._filterScalingY=1);const e=this._originalElement,s=e.naturalWidth||e.width,i=e.naturalHeight||e.height;if(this._element===this._originalElement){const t=St({width:s,height:i});this._element=t,this._filteredEl=t}else this._filteredEl&&(this._element=this._filteredEl,this._filteredEl.getContext("2d").clearRect(0,0,s,i),this._lastScaleX=1,this._lastScaleY=1);ia().applyFilters(t,this._originalElement,s,i,this._element,this.cacheKey),this._originalElement.width===this._element.width&&this._originalElement.height===this._element.height||(this._filterScalingX=this._element.width/this._originalElement.width,this._filterScalingY=this._element.height/this._originalElement.height)}_render(t){t.imageSmoothingEnabled=this.imageSmoothing,!0!==this.isMoving&&this.resizeFilter&&this._needsResize()&&this.applyResizeFilters(),this._stroke(t),this._renderPaintInOrder(t)}drawCacheOnCanvas(t){t.imageSmoothingEnabled=this.imageSmoothing,super.drawCacheOnCanvas(t)}shouldCache(){return this.needsItsOwnCache()}_renderFill(t){const e=this._element;if(!e)return;const s=this._filterScalingX,i=this._filterScalingY,n=this.width,r=this.height,o=Math.max(this.cropX,0),a=Math.max(this.cropY,0),h=e.naturalWidth||e.width,c=e.naturalHeight||e.height,l=o*s,u=a*i,d=Math.min(n*s,h-l),g=Math.min(r*i,c-u),p=-n/2,f=-r/2,m=Math.min(n,h/s-o),_=Math.min(r,c/i-a);e&&t.drawImage(e,l,u,d,g,p,f,m,_)}_needsResize(){const t=this.getTotalObjectScaling();return t.x!==this._lastScaleX||t.y!==this._lastScaleY}_resetWidthHeight(){this.set(this.getOriginalSize())}_setWidthHeight(){let{width:t,height:e}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};const s=this.getOriginalSize();this.width=t||s.width,this.height=e||s.height}parsePreserveAspectRatioAttribute(){const t=Ve(this.preserveAspectRatio||""),e=this.width,s=this.height,i={width:e,height:s};let n,r=this._element.width,o=this._element.height,a=1,h=1,c=0,l=0,u=0,d=0;return!t||t.alignX===W&&t.alignY===W?(a=e/r,h=s/o):("meet"===t.meetOrSlice&&(a=h=tr(this._element,i),n=(e-r*a)/2,"Min"===t.alignX&&(c=-n),"Max"===t.alignX&&(c=n),n=(s-o*h)/2,"Min"===t.alignY&&(l=-n),"Max"===t.alignY&&(l=n)),"slice"===t.meetOrSlice&&(a=h=er(this._element,i),n=r-e/a,"Mid"===t.alignX&&(u=n/2),"Max"===t.alignX&&(u=n),n=o-s/h,"Mid"===t.alignY&&(d=n/2),"Max"===t.alignY&&(d=n),r=e/a,o=s/h)),{width:r,height:o,scaleX:a,scaleY:h,offsetLeft:c,offsetTop:l,cropX:u,cropY:d}}static fromObject(t,e){let{filters:s,resizeFilter:i,src:n,crossOrigin:r,type:o}=t,a=u(t,na);return Promise.all([Vt(n,l(l({},e),{},{crossOrigin:r})),s&&Gt(s,e),i&&Gt([i],e),Ht(a,e)]).then((t=>{let[e,s=[],[i]=[],r={}]=t;return new this(e,l(l({},a),{},{src:n,filters:s,resizeFilter:i},r))}))}static fromURL(t){let{crossOrigin:e=null,signal:s}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},i=arguments.length>2?arguments[2]:void 0;return Vt(t,{crossOrigin:e,signal:s}).then((t=>new this(t,i)))}static async fromElement(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},s=arguments.length>2?arguments[2]:void 0;const i=Ln(t,this.ATTRIBUTE_NAMES,s);return this.fromURL(i["xlink:href"]||i.href,e,i).catch((t=>(f("log","Unable to parse Image",t),null)))}}function aa(t){if(!ms.test(t.nodeName))return{};const e=t.getAttribute("viewBox");let s,i,n=1,r=1,o=0,a=0;const h=t.getAttribute("width"),c=t.getAttribute("height"),l=t.getAttribute("x")||0,u=t.getAttribute("y")||0,d=!(e&&vs.test(e)),g=!h||!c||"100%"===h||"100%"===c;let p="",f=0,m=0;if(d&&(l||u)&&t.parentNode&&"#document"!==t.parentNode.nodeName&&(p=" translate("+Xe(l||"0")+" "+Xe(u||"0")+") ",s=(t.getAttribute("transform")||"")+p,t.setAttribute("transform",s),t.removeAttribute("x"),t.removeAttribute("y")),d&&g)return{width:0,height:0};const _={width:0,height:0};if(d)return _.width=Xe(h),_.height=Xe(c),_;const v=e.match(vs);o=-parseFloat(v[1]),a=-parseFloat(v[2]);const y=parseFloat(v[3]),C=parseFloat(v[4]);_.minX=o,_.minY=a,_.viewBoxWidth=y,_.viewBoxHeight=C,g?(_.width=y,_.height=C):(_.width=Xe(h),_.height=Xe(c),n=_.width/y,r=_.height/C);const b=Ve(t.getAttribute("preserveAspectRatio")||"");if(b.alignX!==W&&("meet"===b.meetOrSlice&&(r=n=n>r?r:n),"slice"===b.meetOrSlice&&(r=n=n>r?n:r),f=_.width-y*n,m=_.height-C*n,"Mid"===b.alignX&&(f/=2),"Mid"===b.alignY&&(m/=2),"Min"===b.alignX&&(f=0),"Min"===b.alignY&&(m=0)),1===n&&1===r&&0===o&&0===a&&0===l&&0===u)return _;if((l||u)&&"#document"!==t.parentNode.nodeName&&(p=" translate("+Xe(l||"0")+" "+Xe(u||"0")+") "),s=p+" matrix("+n+" 0 0 "+r+" "+(o*n+f)+" "+(a*r+m)+") ","svg"===t.nodeName){for(i=t.ownerDocument.createElementNS(ls,"g");t.firstChild;)i.appendChild(t.firstChild);t.appendChild(i)}else i=t,i.removeAttribute("x"),i.removeAttribute("y"),s=i.getAttribute("transform")+s;return i.setAttribute("transform",s),_}h(oa,"type","Image"),h(oa,"cacheProperties",[...Ls,...ra]),h(oa,"ownDefaults",{strokeWidth:0,srcFromAttribute:!1,minimumScaleTrigger:.5,cropX:0,cropY:0,imageSmoothing:!0}),h(oa,"CSS_CANVAS","canvas-img"),h(oa,"ATTRIBUTE_NAMES",[...nn,"x","y","width","height","preserveAspectRatio","xlink:href","href","crossOrigin","image-rendering"]),at.setClass(oa),at.setSVGClass(oa);const ha=t=>t.tagName.replace("svg:",""),ca=ze(["pattern","defs","symbol","metadata","clipPath","mask","desc"]);function la(t,e){let s,i,n,r,o=[];for(n=0,r=e.length;n<r;n++)s=e[n],i=t.getElementsByTagNameNS("http://www.w3.org/2000/svg",s),o=o.concat(Array.from(i));return o}const ua=["gradientTransform","x1","x2","y1","y2","gradientUnits","cx","cy","r","fx","fy"],da="xlink:href";function ga(t,e){var s;const i=(null===(s=e.getAttribute(da))||void 0===s?void 0:s.slice(1))||"",n=t.getElementById(i);if(n&&n.getAttribute(da)&&ga(t,n),n&&(ua.forEach((t=>{const s=n.getAttribute(t);!e.hasAttribute(t)&&s&&e.setAttribute(t,s)})),!e.children.length)){const t=n.cloneNode(!0);for(;t.firstChild;)e.appendChild(t.firstChild)}e.removeAttribute(da)}const pa=["linearGradient","radialGradient","svg:linearGradient","svg:radialGradient"];function fa(t){const e=t.getElementsByTagName("style");let s,i;const n={};for(s=0,i=e.length;s<i;s++){const t=(e[s].textContent||"").replace(/\/\*[\s\S]*?\*\//g,"");""!==t.trim()&&t.split("}").filter(((t,e,s)=>s.length>1&&t.trim())).forEach((t=>{if((t.match(/{/g)||[]).length>1&&t.trim().startsWith("@"))return;const e=t.split("{"),r={},o=e[1].trim().split(";").filter((function(t){return t.trim()}));for(s=0,i=o.length;s<i;s++){const t=o[s].split(":"),e=t[0].trim(),i=t[1].trim();r[e]=i}(t=e[0].trim()).split(",").forEach((t=>{""!==(t=t.replace(/^svg/i,"").trim())&&(n[t]=l(l({},n[t]||{}),r))}))}))}return n}const ma=t=>at.getSVGClass(ha(t).toLowerCase());class _a{constructor(t,e,s,i,n){this.elements=t,this.options=e,this.reviver=s,this.regexUrl=/^url\(['"]?#([^'"]+)['"]?\)/g,this.doc=i,this.clipPaths=n,this.gradientDefs=function(t){const e=la(t,pa),s={};let i=e.length;for(;i--;){const n=e[i];n.getAttribute("xlink:href")&&ga(t,n);const r=n.getAttribute("id");r&&(s[r]=n)}return s}(i),this.cssRules=fa(i)}parse(){return Promise.all(this.elements.map((t=>this.createObject(t))))}async createObject(t){const e=ma(t);if(e){const s=await e.fromElement(t,this.options,this.cssRules);return this.resolveGradient(s,t,st),this.resolveGradient(s,t,it),s instanceof oa&&s._originalElement?Mr(s,s.parsePreserveAspectRatioAttribute()):Mr(s),await this.resolveClipPath(s,t),this.reviver&&this.reviver(t,s),s}return null}extractPropertyDefinition(t,e,s){const i=t[e],n=this.regexUrl;if(!n.test(i))return;n.lastIndex=0;const r=n.exec(i)[1];return n.lastIndex=0,s[r]}resolveGradient(t,e,s){const i=this.extractPropertyDefinition(t,s,this.gradientDefs);if(i){const n=e.getAttribute(s+"-opacity"),r=ro.fromElement(i,t,l(l({},this.options),{},{opacity:n}));t.set(s,r)}}async resolveClipPath(t,e,s){const i=this.extractPropertyDefinition(t,"clipPath",this.clipPaths);if(i){const n=Pt(t.calcTransformMatrix()),r=i[0].parentElement;let o=e;for(;!s&&o.parentElement&&o.getAttribute("clip-path")!==t.clipPath;)o=o.parentElement;o.parentElement.appendChild(r);const a=Dn("".concat(o.getAttribute("transform")||""," ").concat(r.getAttribute("originalTransform")||""));r.setAttribute("transform","matrix(".concat(a.join(","),")"));const h=await Promise.all(i.map((t=>ma(t).fromElement(t,this.options,this.cssRules).then((t=>(Mr(t),t.fillRule=t.clipRule,delete t.clipRule,t)))))),c=1===h.length?h[0]:new $n(h),l=It(n,c.calcTransformMatrix());c.clipPath&&await this.resolveClipPath(c,o,r.getAttribute("clip-path")?o:void 0);const{scaleX:u,scaleY:d,angle:g,skewX:p,translateX:f,translateY:m}=Ft(l);c.set({flipX:!1,flipY:!1}),c.set({scaleX:u,scaleY:d,angle:g,skewX:p,skewY:0}),c.setPositionByOrigin(new gt(f,m),F,F),t.clipPath=c}else delete t.clipPath}}const va=t=>fs.test(ha(t)),ya=()=>({objects:[],elements:[],options:{},allElements:[]});async function Ca(t,e){let{crossOrigin:s,signal:i}=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};if(i&&i.aborted)return f("log",new _("parseSVGDocument")),ya();const n=t.documentElement;!function(t){const e=la(t,["use","svg:use"]),s=["x","y","xlink:href","href","transform"];for(const i of e){const e=i.attributes,n={};for(const t of e)t.value&&(n[t.name]=t.value);const r=(n["xlink:href"]||n.href||"").slice(1);if(""===r)return;const o=t.getElementById(r);if(null===o)return;let a=o.cloneNode(!0);const h=a.attributes,c={};for(const t of h)t.value&&(c[t.name]=t.value);const{x:l=0,y:u=0,transform:d=""}=n,g="".concat(d," ").concat(c.transform||""," translate(").concat(l,", ").concat(u,")");if(aa(a),/^svg$/i.test(a.nodeName)){const t=a.ownerDocument.createElementNS(ls,"g");Object.entries(c).forEach((e=>{let[s,i]=e;return t.setAttributeNS(ls,s,i)})),t.append(...a.childNodes),a=t}for(const t of e){if(!t)continue;const{name:e,value:i}=t;if(!s.includes(e))if("style"===e){const t={};Mn(i,t),Object.entries(c).forEach((e=>{let[s,i]=e;t[s]=i})),Mn(c.style||"",t);const s=Object.entries(t).map((t=>t.join(":"))).join(";");a.setAttribute(e,s)}else!c[e]&&a.setAttribute(e,i)}a.setAttribute("transform",g),a.setAttribute("instantiated_by_use","1"),a.removeAttribute("id"),i.parentNode.replaceChild(a,i)}}(t);const r=Array.from(n.getElementsByTagName("*")),o=l(l({},aa(n)),{},{crossOrigin:s,signal:i}),a=r.filter((t=>(aa(t),va(t)&&!function(t){let e=t;for(;e&&(e=e.parentElement);)if(e&&e.nodeName&&ca.test(ha(e))&&!e.getAttribute("instantiated_by_use"))return!0;return!1}(t))));if(!a||a&&!a.length)return l(l({},ya()),{},{options:o,allElements:r});const h={};r.filter((t=>"clipPath"===ha(t))).forEach((t=>{t.setAttribute("originalTransform",t.getAttribute("transform")||"");const e=t.getAttribute("id");h[e]=Array.from(t.getElementsByTagName("*")).filter((t=>va(t)))}));const c=new _a(a,o,e,t,h);return{objects:await c.parse(),elements:a,options:o,allElements:r}}function ba(t,e){let s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return new Promise(((e,i)=>{Ir(t.replace(/^\n\s*/,"").trim(),{onComplete:t=>{const s=t.responseXML;s&&e(s),i()},signal:s.signal})})).then((t=>Ca(t,e,s))).catch((()=>ya()))}const wa=q,xa=t=>function(e,s,i){const{points:n,pathOffset:r}=i;return new gt(n[t]).subtract(r).transform(It(i.getViewportTransform(),i.calcTransformMatrix()))},Sa=(t,e,s,i)=>{const{target:n,pointIndex:r}=e,o=n,a=we(new gt(s,i),void 0,o.calcOwnMatrix());return o.points[r]=a.add(o.pathOffset),o.setDimensions(),o.set("dirty",!0),!0},Ta=(t,e)=>function(s,i,n,r){const o=i.target,a=new gt(o.points[(t>0?t:o.points.length)-1]),h=a.subtract(o.pathOffset).transform(o.calcOwnMatrix()),c=e(s,l(l({},i),{},{pointIndex:t}),n,r),u=a.subtract(o.pathOffset).transform(o.calcOwnMatrix()).subtract(h);return o.left-=u.x,o.top-=u.y,c},ka=t=>ai(wa,Ta(t,Sa)),Aa=(t,e,s)=>{const{path:i,pathOffset:n}=t,r=i[e];return new gt(r[s]-n.x,r[s+1]-n.y).transform(It(t.getViewportTransform(),t.calcTransformMatrix()))};function Ea(t,e,s){const{commandIndex:i,pointIndex:n}=this;return Aa(s,i,n)}function Oa(t,e,s,i){const{target:n}=e,{commandIndex:r,pointIndex:o}=this,a=((t,e,s,i,n)=>{const{path:r,pathOffset:o}=t,a=r[(i>0?i:r.length)-1],h=new gt(a[n],a[n+1]),c=h.subtract(o).transform(t.calcOwnMatrix()),l=we(new gt(e,s),void 0,t.calcOwnMatrix());r[i][n]=l.x+o.x,r[i][n+1]=l.y+o.y,t.setDimensions();const u=h.subtract(t.pathOffset).transform(t.calcOwnMatrix()).subtract(c);return t.left-=u.x,t.top-=u.y,t.set("dirty",!0),!0})(n,s,i,r,o);return Te(this.actionName,l(l({},Ie(t,e,s,i)),{},{commandIndex:r,pointIndex:o})),a}class Da extends di{constructor(t){super(t)}render(t,e,s,i,n){const r=l(l({},i),{},{cornerColor:this.controlFill,cornerStrokeColor:this.controlStroke,transparentCorners:!this.controlFill});super.render(t,e,s,r,n)}}class Pa extends Da{constructor(t){super(t)}render(t,e,s,i,n){const{path:r}=n,{commandIndex:o,pointIndex:a,connectToCommandIndex:h,connectToPointIndex:c}=this;t.save(),t.strokeStyle=this.controlStroke,this.connectionDashArray&&t.setLineDash(this.connectionDashArray);const[l]=r[o],u=Aa(n,h,c);if("Q"===l){const i=Aa(n,o,a+2);t.moveTo(i.x,i.y),t.lineTo(e,s)}else t.moveTo(e,s);t.lineTo(u.x,u.y),t.stroke(),t.restore(),super.render(t,e,s,i,n)}}const Ia=(t,e,s,i,n,r)=>new(s?Pa:Da)(l(l({commandIndex:t,pointIndex:e,actionName:"modifyPath",positionHandler:Ea,actionHandler:Oa,connectToCommandIndex:n,connectToPointIndex:r},i),s?i.controlPointStyle:i.pointStyle));var Ma=Object.freeze({__proto__:null,changeWidth:ci,createObjectDefaultControls:Fi,createPathControls:function(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const s={};let i="M";return t.path.forEach(((t,n)=>{const r=t[0];switch("Z"!==r&&(s["c_".concat(n,"_").concat(r)]=Ia(n,t.length-2,!1,e)),r){case"C":s["c_".concat(n,"_C_CP_1")]=Ia(n,1,!0,e,n-1,(t=>"C"===t?5:"Q"===t?3:1)(i)),s["c_".concat(n,"_C_CP_2")]=Ia(n,3,!0,e,n,5);break;case"Q":s["c_".concat(n,"_Q_CP_1")]=Ia(n,1,!0,e,n,3)}i=r})),s},createPolyActionHandler:ka,createPolyControls:function(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const s={};for(let i=0;i<("number"==typeof t?t:t.points.length);i++)s["p".concat(i)]=new di(l({actionName:wa,positionHandler:xa(i),actionHandler:ka(i)},e));return s},createPolyPositionHandler:xa,createResizeControls:Li,createTextboxDefaultControls:ji,dragHandler:Fe,factoryPolyActionHandler:Ta,getLocalPoint:Re,polyActionHandler:Sa,renderCircleControl:li,renderSquareControl:ui,rotationStyleHandler:gi,rotationWithSnapping:pi,scaleCursorStyleHandler:vi,scaleOrSkewActionName:Pi,scaleSkewCursorStyleHandler:Ii,scalingEqually:Ci,scalingX:bi,scalingXOrSkewingY:Mi,scalingY:wi,scalingYOrSkewingX:Ri,skewCursorStyleHandler:ki,skewHandlerX:Ei,skewHandlerY:Oi,wrapWithFireEvent:ai,wrapWithFixedAnchor:hi});const Ra=t=>void 0!==t.webgl,Fa="precision highp float",La="\n    ".concat(Fa,";\n    varying vec2 vTexCoord;\n    uniform sampler2D uTexture;\n    void main() {\n      gl_FragColor = texture2D(uTexture, vTexCoord);\n    }"),ja=["type"],Na=["type"],Ba=new RegExp(Fa,"g");class Wa{get type(){return this.constructor.type}constructor(){let t=u(arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},ja);Object.assign(this,this.constructor.defaults,t)}getFragmentSource(){return La}getVertexSource(){return"\n    attribute vec2 aPosition;\n    varying vec2 vTexCoord;\n    void main() {\n      vTexCoord = aPosition;\n      gl_Position = vec4(aPosition * 2.0 - 1.0, 0.0, 1.0);\n    }"}createProgram(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.getFragmentSource(),s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:this.getVertexSource();const{WebGLProbe:{GLPrecision:i="highp"}}=w();"highp"!==i&&(e=e.replace(Ba,Fa.replace("highp",i)));const n=t.createShader(t.VERTEX_SHADER),r=t.createShader(t.FRAGMENT_SHADER),o=t.createProgram();if(!n||!r||!o)throw new m("Vertex, fragment shader or program creation error");if(t.shaderSource(n,s),t.compileShader(n),!t.getShaderParameter(n,t.COMPILE_STATUS))throw new m("Vertex shader compile error for ".concat(this.type,": ").concat(t.getShaderInfoLog(n)));if(t.shaderSource(r,e),t.compileShader(r),!t.getShaderParameter(r,t.COMPILE_STATUS))throw new m("Fragment shader compile error for ".concat(this.type,": ").concat(t.getShaderInfoLog(r)));if(t.attachShader(o,n),t.attachShader(o,r),t.linkProgram(o),!t.getProgramParameter(o,t.LINK_STATUS))throw new m('Shader link error for "'.concat(this.type,'" ').concat(t.getProgramInfoLog(o)));const a=this.getUniformLocations(t,o)||{};return a.uStepW=t.getUniformLocation(o,"uStepW"),a.uStepH=t.getUniformLocation(o,"uStepH"),{program:o,attributeLocations:this.getAttributeLocations(t,o),uniformLocations:a}}getAttributeLocations(t,e){return{aPosition:t.getAttribLocation(e,"aPosition")}}getUniformLocations(t,e){const s=this.constructor.uniformLocations,i={};for(let n=0;n<s.length;n++)i[s[n]]=t.getUniformLocation(e,s[n]);return i}sendAttributeData(t,e,s){const i=e.aPosition,n=t.createBuffer();t.bindBuffer(t.ARRAY_BUFFER,n),t.enableVertexAttribArray(i),t.vertexAttribPointer(i,2,t.FLOAT,!1,0,0),t.bufferData(t.ARRAY_BUFFER,s,t.STATIC_DRAW)}_setupFrameBuffer(t){const e=t.context;if(t.passes>1){const s=t.destinationWidth,i=t.destinationHeight;t.sourceWidth===s&&t.sourceHeight===i||(e.deleteTexture(t.targetTexture),t.targetTexture=t.filterBackend.createTexture(e,s,i)),e.framebufferTexture2D(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0,e.TEXTURE_2D,t.targetTexture,0)}else e.bindFramebuffer(e.FRAMEBUFFER,null),e.finish()}_swapTextures(t){t.passes--,t.pass++;const e=t.targetTexture;t.targetTexture=t.sourceTexture,t.sourceTexture=e}isNeutralState(t){return!1}applyTo(t){Ra(t)?(this._setupFrameBuffer(t),this.applyToWebGL(t),this._swapTextures(t)):this.applyTo2d(t)}applyTo2d(t){}getCacheKey(){return this.type}retrieveShader(t){const e=this.getCacheKey();return t.programCache[e]||(t.programCache[e]=this.createProgram(t.context)),t.programCache[e]}applyToWebGL(t){const e=t.context,s=this.retrieveShader(t);0===t.pass&&t.originalTexture?e.bindTexture(e.TEXTURE_2D,t.originalTexture):e.bindTexture(e.TEXTURE_2D,t.sourceTexture),e.useProgram(s.program),this.sendAttributeData(e,s.attributeLocations,t.aPosition),e.uniform1f(s.uniformLocations.uStepW,1/t.sourceWidth),e.uniform1f(s.uniformLocations.uStepH,1/t.sourceHeight),this.sendUniformData(e,s.uniformLocations),e.viewport(0,0,t.destinationWidth,t.destinationHeight),e.drawArrays(e.TRIANGLE_STRIP,0,4)}bindAdditionalTexture(t,e,s){t.activeTexture(s),t.bindTexture(t.TEXTURE_2D,e),t.activeTexture(t.TEXTURE0)}unbindAdditionalTexture(t,e){t.activeTexture(e),t.bindTexture(t.TEXTURE_2D,null),t.activeTexture(t.TEXTURE0)}sendUniformData(t,e){}createHelpLayer(t){if(!t.helpLayer){const{sourceWidth:e,sourceHeight:s}=t,i=St({width:e,height:s});t.helpLayer=i}}toObject(){const t=Object.keys(this.constructor.defaults||{});return l({type:this.type},t.reduce(((t,e)=>(t[e]=this[e],t)),{}))}toJSON(){return this.toObject()}static async fromObject(t,e){return new this(u(t,Na))}}h(Wa,"type","BaseFilter"),h(Wa,"uniformLocations",[]);const Ua={multiply:"gl_FragColor.rgb *= uColor.rgb;\n",screen:"gl_FragColor.rgb = 1.0 - (1.0 - gl_FragColor.rgb) * (1.0 - uColor.rgb);\n",add:"gl_FragColor.rgb += uColor.rgb;\n",difference:"gl_FragColor.rgb = abs(gl_FragColor.rgb - uColor.rgb);\n",subtract:"gl_FragColor.rgb -= uColor.rgb;\n",lighten:"gl_FragColor.rgb = max(gl_FragColor.rgb, uColor.rgb);\n",darken:"gl_FragColor.rgb = min(gl_FragColor.rgb, uColor.rgb);\n",exclusion:"gl_FragColor.rgb += uColor.rgb - 2.0 * (uColor.rgb * gl_FragColor.rgb);\n",overlay:"\n    if (uColor.r < 0.5) {\n      gl_FragColor.r *= 2.0 * uColor.r;\n    } else {\n      gl_FragColor.r = 1.0 - 2.0 * (1.0 - gl_FragColor.r) * (1.0 - uColor.r);\n    }\n    if (uColor.g < 0.5) {\n      gl_FragColor.g *= 2.0 * uColor.g;\n    } else {\n      gl_FragColor.g = 1.0 - 2.0 * (1.0 - gl_FragColor.g) * (1.0 - uColor.g);\n    }\n    if (uColor.b < 0.5) {\n      gl_FragColor.b *= 2.0 * uColor.b;\n    } else {\n      gl_FragColor.b = 1.0 - 2.0 * (1.0 - gl_FragColor.b) * (1.0 - uColor.b);\n    }\n    ",tint:"\n    gl_FragColor.rgb *= (1.0 - uColor.a);\n    gl_FragColor.rgb += uColor.rgb;\n    "};class Ya extends Wa{getCacheKey(){return"".concat(this.type,"_").concat(this.mode)}getFragmentSource(){return"\n      precision highp float;\n      uniform sampler2D uTexture;\n      uniform vec4 uColor;\n      varying vec2 vTexCoord;\n      void main() {\n        vec4 color = texture2D(uTexture, vTexCoord);\n        gl_FragColor = color;\n        if (color.a > 0.0) {\n          ".concat(Ua[this.mode],"\n        }\n      }\n      ")}applyTo2d(t){let{imageData:{data:e}}=t;const s=new Ye(this.color).getSource(),i=this.alpha,n=s[0]*i,r=s[1]*i,o=s[2]*i,a=1-i;for(let h=0;h<e.length;h+=4){const t=e[h],s=e[h+1],i=e[h+2];let c,l,u;switch(this.mode){case"multiply":c=t*n/255,l=s*r/255,u=i*o/255;break;case"screen":c=255-(255-t)*(255-n)/255,l=255-(255-s)*(255-r)/255,u=255-(255-i)*(255-o)/255;break;case"add":c=t+n,l=s+r,u=i+o;break;case"difference":c=Math.abs(t-n),l=Math.abs(s-r),u=Math.abs(i-o);break;case"subtract":c=t-n,l=s-r,u=i-o;break;case"darken":c=Math.min(t,n),l=Math.min(s,r),u=Math.min(i,o);break;case"lighten":c=Math.max(t,n),l=Math.max(s,r),u=Math.max(i,o);break;case"overlay":c=n<128?2*t*n/255:255-2*(255-t)*(255-n)/255,l=r<128?2*s*r/255:255-2*(255-s)*(255-r)/255,u=o<128?2*i*o/255:255-2*(255-i)*(255-o)/255;break;case"exclusion":c=n+t-2*n*t/255,l=r+s-2*r*s/255,u=o+i-2*o*i/255;break;case"tint":c=n+t*a,l=r+s*a,u=o+i*a}e[h]=c,e[h+1]=l,e[h+2]=u}}sendUniformData(t,e){const s=new Ye(this.color).getSource();s[0]=this.alpha*s[0]/255,s[1]=this.alpha*s[1]/255,s[2]=this.alpha*s[2]/255,s[3]=this.alpha,t.uniform4fv(e.uColor,s)}}h(Ya,"defaults",{color:"#F95C63",mode:"multiply",alpha:1}),h(Ya,"type","BlendColor"),h(Ya,"uniformLocations",["uColor"]),at.setClass(Ya);const Xa={multiply:"\n    precision highp float;\n    uniform sampler2D uTexture;\n    uniform sampler2D uImage;\n    uniform vec4 uColor;\n    varying vec2 vTexCoord;\n    varying vec2 vTexCoord2;\n    void main() {\n      vec4 color = texture2D(uTexture, vTexCoord);\n      vec4 color2 = texture2D(uImage, vTexCoord2);\n      color.rgba *= color2.rgba;\n      gl_FragColor = color;\n    }\n    ",mask:"\n    precision highp float;\n    uniform sampler2D uTexture;\n    uniform sampler2D uImage;\n    uniform vec4 uColor;\n    varying vec2 vTexCoord;\n    varying vec2 vTexCoord2;\n    void main() {\n      vec4 color = texture2D(uTexture, vTexCoord);\n      vec4 color2 = texture2D(uImage, vTexCoord2);\n      color.a = color2.a;\n      gl_FragColor = color;\n    }\n    "},Va=["type","image"];class Ga extends Wa{getCacheKey(){return"".concat(this.type,"_").concat(this.mode)}getFragmentSource(){return Xa[this.mode]}getVertexSource(){return"\n    attribute vec2 aPosition;\n    varying vec2 vTexCoord;\n    varying vec2 vTexCoord2;\n    uniform mat3 uTransformMatrix;\n    void main() {\n      vTexCoord = aPosition;\n      vTexCoord2 = (uTransformMatrix * vec3(aPosition, 1.0)).xy;\n      gl_Position = vec4(aPosition * 2.0 - 1.0, 0.0, 1.0);\n    }\n    "}applyToWebGL(t){const e=t.context,s=this.createTexture(t.filterBackend,this.image);this.bindAdditionalTexture(e,s,e.TEXTURE1),super.applyToWebGL(t),this.unbindAdditionalTexture(e,e.TEXTURE1)}createTexture(t,e){return t.getCachedTexture(e.cacheKey,e.getElement())}calculateMatrix(){const t=this.image,{width:e,height:s}=t.getElement();return[1/t.scaleX,0,0,0,1/t.scaleY,0,-t.left/e,-t.top/s,1]}applyTo2d(t){let{imageData:{data:e,width:s,height:i},filterBackend:{resources:n}}=t;const r=this.image;n.blendImage||(n.blendImage=wt());const o=n.blendImage,a=o.getContext("2d");o.width!==s||o.height!==i?(o.width=s,o.height=i):a.clearRect(0,0,s,i),a.setTransform(r.scaleX,0,0,r.scaleY,r.left,r.top),a.drawImage(r.getElement(),0,0,s,i);const h=a.getImageData(0,0,s,i).data;for(let c=0;c<e.length;c+=4){const t=e[c],s=e[c+1],i=e[c+2],n=e[c+3],r=h[c],o=h[c+1],a=h[c+2],l=h[c+3];switch(this.mode){case"multiply":e[c]=t*r/255,e[c+1]=s*o/255,e[c+2]=i*a/255,e[c+3]=n*l/255;break;case"mask":e[c+3]=l}}}sendUniformData(t,e){const s=this.calculateMatrix();t.uniform1i(e.uImage,1),t.uniformMatrix3fv(e.uTransformMatrix,!1,s)}toObject(){return l(l({},super.toObject()),{},{image:this.image&&this.image.toObject()})}static async fromObject(t,e){let{type:s,image:i}=t,n=u(t,Va);return oa.fromObject(i,e).then((t=>new this(l(l({},n),{},{image:t}))))}}h(Ga,"type","BlendImage"),h(Ga,"defaults",{mode:"multiply",alpha:1}),h(Ga,"uniformLocations",["uTransformMatrix","uImage"]),at.setClass(Ga);class Ha extends Wa{getFragmentSource(){return"\n    precision highp float;\n    uniform sampler2D uTexture;\n    uniform vec2 uDelta;\n    varying vec2 vTexCoord;\n    const float nSamples = 15.0;\n    vec3 v3offset = vec3(12.9898, 78.233, 151.7182);\n    float random(vec3 scale) {\n      /* use the fragment position for a different seed per-pixel */\n      return fract(sin(dot(gl_FragCoord.xyz, scale)) * 43758.5453);\n    }\n    void main() {\n      vec4 color = vec4(0.0);\n      float totalC = 0.0;\n      float totalA = 0.0;\n      float offset = random(v3offset);\n      for (float t = -nSamples; t <= nSamples; t++) {\n        float percent = (t + offset - 0.5) / nSamples;\n        vec4 sample = texture2D(uTexture, vTexCoord + uDelta * percent);\n        float weight = 1.0 - abs(percent);\n        float alpha = weight * sample.a;\n        color.rgb += sample.rgb * alpha;\n        color.a += alpha;\n        totalA += weight;\n        totalC += alpha;\n      }\n      gl_FragColor.rgb = color.rgb / totalC;\n      gl_FragColor.a = color.a / totalA;\n    }\n  "}applyTo(t){Ra(t)?(this.aspectRatio=t.sourceWidth/t.sourceHeight,t.passes++,this._setupFrameBuffer(t),this.horizontal=!0,this.applyToWebGL(t),this._swapTextures(t),this._setupFrameBuffer(t),this.horizontal=!1,this.applyToWebGL(t),this._swapTextures(t)):this.applyTo2d(t)}applyTo2d(t){let{imageData:{data:e,width:s,height:i}}=t;this.aspectRatio=s/i,this.horizontal=!0;let n=this.getBlurValue()*s;const r=new Uint8ClampedArray(e),o=15,a=4*s;for(let h=0;h<e.length;h+=4){let t=0,s=0,i=0,c=0,l=0;const u=h-h%a,d=u+a;for(let r=-14;r<o;r++){const a=r/o,g=4*Math.floor(n*a),p=1-Math.abs(a);let f=h+g;f<u?f=u:f>d&&(f=d);const m=e[f+3]*p;t+=e[f]*m,s+=e[f+1]*m,i+=e[f+2]*m,c+=m,l+=p}r[h]=t/c,r[h+1]=s/c,r[h+2]=i/c,r[h+3]=c/l}this.horizontal=!1,n=this.getBlurValue()*i;for(let h=0;h<r.length;h+=4){let t=0,s=0,i=0,c=0,l=0;const u=h%a,d=r.length-a+u;for(let e=-14;e<o;e++){const g=e/o,p=Math.floor(n*g)*a,f=1-Math.abs(g);let m=h+p;m<u?m=u:m>d&&(m=d);const _=r[m+3]*f;t+=r[m]*_,s+=r[m+1]*_,i+=r[m+2]*_,c+=_,l+=f}e[h]=t/c,e[h+1]=s/c,e[h+2]=i/c,e[h+3]=c/l}}sendUniformData(t,e){const s=this.chooseRightDelta();t.uniform2fv(e.uDelta,s)}isNeutralState(){return 0===this.blur}getBlurValue(){let t=1;const{horizontal:e,aspectRatio:s}=this;return e?s>1&&(t=1/s):s<1&&(t=s),t*this.blur*.12}chooseRightDelta(){const t=this.getBlurValue();return this.horizontal?[t,0]:[0,t]}}h(Ha,"type","Blur"),h(Ha,"defaults",{blur:0}),h(Ha,"uniformLocations",["uDelta"]),at.setClass(Ha);class za extends Wa{getFragmentSource(){return"\n  precision highp float;\n  uniform sampler2D uTexture;\n  uniform float uBrightness;\n  varying vec2 vTexCoord;\n  void main() {\n    vec4 color = texture2D(uTexture, vTexCoord);\n    color.rgb += uBrightness;\n    gl_FragColor = color;\n  }\n"}applyTo2d(t){let{imageData:{data:e}}=t;const s=Math.round(255*this.brightness);for(let i=0;i<e.length;i+=4)e[i]+=s,e[i+1]+=s,e[i+2]+=s}isNeutralState(){return 0===this.brightness}sendUniformData(t,e){t.uniform1f(e.uBrightness,this.brightness)}}h(za,"type","Brightness"),h(za,"defaults",{brightness:0}),h(za,"uniformLocations",["uBrightness"]),at.setClass(za);const qa={matrix:[1,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,1,0],colorsOnly:!0};class Ka extends Wa{getFragmentSource(){return"\n  precision highp float;\n  uniform sampler2D uTexture;\n  varying vec2 vTexCoord;\n  uniform mat4 uColorMatrix;\n  uniform vec4 uConstants;\n  void main() {\n    vec4 color = texture2D(uTexture, vTexCoord);\n    color *= uColorMatrix;\n    color += uConstants;\n    gl_FragColor = color;\n  }"}applyTo2d(t){const e=t.imageData.data,s=this.matrix,i=this.colorsOnly;for(let n=0;n<e.length;n+=4){const t=e[n],r=e[n+1],o=e[n+2];if(e[n]=t*s[0]+r*s[1]+o*s[2]+255*s[4],e[n+1]=t*s[5]+r*s[6]+o*s[7]+255*s[9],e[n+2]=t*s[10]+r*s[11]+o*s[12]+255*s[14],!i){const i=e[n+3];e[n]+=i*s[3],e[n+1]+=i*s[8],e[n+2]+=i*s[13],e[n+3]=t*s[15]+r*s[16]+o*s[17]+i*s[18]+255*s[19]}}}sendUniformData(t,e){const s=this.matrix,i=[s[0],s[1],s[2],s[3],s[5],s[6],s[7],s[8],s[10],s[11],s[12],s[13],s[15],s[16],s[17],s[18]],n=[s[4],s[9],s[14],s[19]];t.uniformMatrix4fv(e.uColorMatrix,!1,i),t.uniform4fv(e.uConstants,n)}toObject(){return l(l({},super.toObject()),{},{matrix:[...this.matrix]})}}function Qa(t,e){var s;const i=(h(s=class extends Ka{toObject(){return{type:this.type,colorsOnly:this.colorsOnly}}},"type",t),h(s,"defaults",{colorsOnly:!1,matrix:e}),s);return at.setClass(i,t),i}h(Ka,"type","ColorMatrix"),h(Ka,"defaults",qa),h(Ka,"uniformLocations",["uColorMatrix","uConstants"]),at.setClass(Ka);const Ja=Qa("Brownie",[.5997,.34553,-.27082,0,.186,-.0377,.86095,.15059,0,-.1449,.24113,-.07441,.44972,0,-.02965,0,0,0,1,0]),Za=Qa("Vintage",[.62793,.32021,-.03965,0,.03784,.02578,.64411,.03259,0,.02926,.0466,-.08512,.52416,0,.02023,0,0,0,1,0]),$a=Qa("Kodachrome",[1.12855,-.39673,-.03992,0,.24991,-.16404,1.08352,-.05498,0,.09698,-.16786,-.56034,1.60148,0,.13972,0,0,0,1,0]),th=Qa("Technicolor",[1.91252,-.85453,-.09155,0,.04624,-.30878,1.76589,-.10601,0,-.27589,-.2311,-.75018,1.84759,0,.12137,0,0,0,1,0]),eh=Qa("Polaroid",[1.438,-.062,-.062,0,0,-.122,1.378,-.122,0,0,-.016,-.016,1.483,0,0,0,0,0,1,0]),sh=Qa("Sepia",[.393,.769,.189,0,0,.349,.686,.168,0,0,.272,.534,.131,0,0,0,0,0,1,0]),ih=Qa("BlackWhite",[1.5,1.5,1.5,0,-1,1.5,1.5,1.5,0,-1,1.5,1.5,1.5,0,-1,0,0,0,1,0]);class nh extends Wa{constructor(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};super(t),this.subFilters=t.subFilters||[]}applyTo(t){Ra(t)&&(t.passes+=this.subFilters.length-1),this.subFilters.forEach((e=>{e.applyTo(t)}))}toObject(){return{type:this.type,subFilters:this.subFilters.map((t=>t.toObject()))}}isNeutralState(){return!this.subFilters.some((t=>!t.isNeutralState()))}static fromObject(t,e){return Promise.all((t.subFilters||[]).map((t=>at.getClass(t.type).fromObject(t,e)))).then((t=>new this({subFilters:t})))}}h(nh,"type","Composed"),at.setClass(nh);class rh extends Wa{getFragmentSource(){return"\n  precision highp float;\n  uniform sampler2D uTexture;\n  uniform float uContrast;\n  varying vec2 vTexCoord;\n  void main() {\n    vec4 color = texture2D(uTexture, vTexCoord);\n    float contrastF = 1.015 * (uContrast + 1.0) / (1.0 * (1.015 - uContrast));\n    color.rgb = contrastF * (color.rgb - 0.5) + 0.5;\n    gl_FragColor = color;\n  }"}isNeutralState(){return 0===this.contrast}applyTo2d(t){let{imageData:{data:e}}=t;const s=Math.floor(255*this.contrast),i=259*(s+255)/(255*(259-s));for(let n=0;n<e.length;n+=4)e[n]=i*(e[n]-128)+128,e[n+1]=i*(e[n+1]-128)+128,e[n+2]=i*(e[n+2]-128)+128}sendUniformData(t,e){t.uniform1f(e.uContrast,this.contrast)}}h(rh,"type","Contrast"),h(rh,"defaults",{contrast:0}),h(rh,"uniformLocations",["uContrast"]),at.setClass(rh);const oh={Convolute_3_1:"\n    precision highp float;\n    uniform sampler2D uTexture;\n    uniform float uMatrix[9];\n    uniform float uStepW;\n    uniform float uStepH;\n    varying vec2 vTexCoord;\n    void main() {\n      vec4 color = vec4(0, 0, 0, 0);\n      for (float h = 0.0; h < 3.0; h+=1.0) {\n        for (float w = 0.0; w < 3.0; w+=1.0) {\n          vec2 matrixPos = vec2(uStepW * (w - 1), uStepH * (h - 1));\n          color += texture2D(uTexture, vTexCoord + matrixPos) * uMatrix[int(h * 3.0 + w)];\n        }\n      }\n      gl_FragColor = color;\n    }\n    ",Convolute_3_0:"\n    precision highp float;\n    uniform sampler2D uTexture;\n    uniform float uMatrix[9];\n    uniform float uStepW;\n    uniform float uStepH;\n    varying vec2 vTexCoord;\n    void main() {\n      vec4 color = vec4(0, 0, 0, 1);\n      for (float h = 0.0; h < 3.0; h+=1.0) {\n        for (float w = 0.0; w < 3.0; w+=1.0) {\n          vec2 matrixPos = vec2(uStepW * (w - 1.0), uStepH * (h - 1.0));\n          color.rgb += texture2D(uTexture, vTexCoord + matrixPos).rgb * uMatrix[int(h * 3.0 + w)];\n        }\n      }\n      float alpha = texture2D(uTexture, vTexCoord).a;\n      gl_FragColor = color;\n      gl_FragColor.a = alpha;\n    }\n    ",Convolute_5_1:"\n    precision highp float;\n    uniform sampler2D uTexture;\n    uniform float uMatrix[25];\n    uniform float uStepW;\n    uniform float uStepH;\n    varying vec2 vTexCoord;\n    void main() {\n      vec4 color = vec4(0, 0, 0, 0);\n      for (float h = 0.0; h < 5.0; h+=1.0) {\n        for (float w = 0.0; w < 5.0; w+=1.0) {\n          vec2 matrixPos = vec2(uStepW * (w - 2.0), uStepH * (h - 2.0));\n          color += texture2D(uTexture, vTexCoord + matrixPos) * uMatrix[int(h * 5.0 + w)];\n        }\n      }\n      gl_FragColor = color;\n    }\n    ",Convolute_5_0:"\n    precision highp float;\n    uniform sampler2D uTexture;\n    uniform float uMatrix[25];\n    uniform float uStepW;\n    uniform float uStepH;\n    varying vec2 vTexCoord;\n    void main() {\n      vec4 color = vec4(0, 0, 0, 1);\n      for (float h = 0.0; h < 5.0; h+=1.0) {\n        for (float w = 0.0; w < 5.0; w+=1.0) {\n          vec2 matrixPos = vec2(uStepW * (w - 2.0), uStepH * (h - 2.0));\n          color.rgb += texture2D(uTexture, vTexCoord + matrixPos).rgb * uMatrix[int(h * 5.0 + w)];\n        }\n      }\n      float alpha = texture2D(uTexture, vTexCoord).a;\n      gl_FragColor = color;\n      gl_FragColor.a = alpha;\n    }\n    ",Convolute_7_1:"\n    precision highp float;\n    uniform sampler2D uTexture;\n    uniform float uMatrix[49];\n    uniform float uStepW;\n    uniform float uStepH;\n    varying vec2 vTexCoord;\n    void main() {\n      vec4 color = vec4(0, 0, 0, 0);\n      for (float h = 0.0; h < 7.0; h+=1.0) {\n        for (float w = 0.0; w < 7.0; w+=1.0) {\n          vec2 matrixPos = vec2(uStepW * (w - 3.0), uStepH * (h - 3.0));\n          color += texture2D(uTexture, vTexCoord + matrixPos) * uMatrix[int(h * 7.0 + w)];\n        }\n      }\n      gl_FragColor = color;\n    }\n    ",Convolute_7_0:"\n    precision highp float;\n    uniform sampler2D uTexture;\n    uniform float uMatrix[49];\n    uniform float uStepW;\n    uniform float uStepH;\n    varying vec2 vTexCoord;\n    void main() {\n      vec4 color = vec4(0, 0, 0, 1);\n      for (float h = 0.0; h < 7.0; h+=1.0) {\n        for (float w = 0.0; w < 7.0; w+=1.0) {\n          vec2 matrixPos = vec2(uStepW * (w - 3.0), uStepH * (h - 3.0));\n          color.rgb += texture2D(uTexture, vTexCoord + matrixPos).rgb * uMatrix[int(h * 7.0 + w)];\n        }\n      }\n      float alpha = texture2D(uTexture, vTexCoord).a;\n      gl_FragColor = color;\n      gl_FragColor.a = alpha;\n    }\n    ",Convolute_9_1:"\n    precision highp float;\n    uniform sampler2D uTexture;\n    uniform float uMatrix[81];\n    uniform float uStepW;\n    uniform float uStepH;\n    varying vec2 vTexCoord;\n    void main() {\n      vec4 color = vec4(0, 0, 0, 0);\n      for (float h = 0.0; h < 9.0; h+=1.0) {\n        for (float w = 0.0; w < 9.0; w+=1.0) {\n          vec2 matrixPos = vec2(uStepW * (w - 4.0), uStepH * (h - 4.0));\n          color += texture2D(uTexture, vTexCoord + matrixPos) * uMatrix[int(h * 9.0 + w)];\n        }\n      }\n      gl_FragColor = color;\n    }\n    ",Convolute_9_0:"\n    precision highp float;\n    uniform sampler2D uTexture;\n    uniform float uMatrix[81];\n    uniform float uStepW;\n    uniform float uStepH;\n    varying vec2 vTexCoord;\n    void main() {\n      vec4 color = vec4(0, 0, 0, 1);\n      for (float h = 0.0; h < 9.0; h+=1.0) {\n        for (float w = 0.0; w < 9.0; w+=1.0) {\n          vec2 matrixPos = vec2(uStepW * (w - 4.0), uStepH * (h - 4.0));\n          color.rgb += texture2D(uTexture, vTexCoord + matrixPos).rgb * uMatrix[int(h * 9.0 + w)];\n        }\n      }\n      float alpha = texture2D(uTexture, vTexCoord).a;\n      gl_FragColor = color;\n      gl_FragColor.a = alpha;\n    }\n    "};class ah extends Wa{getCacheKey(){return"".concat(this.type,"_").concat(Math.sqrt(this.matrix.length),"_").concat(this.opaque?1:0)}getFragmentSource(){return oh[this.getCacheKey()]}applyTo2d(t){const e=t.imageData,s=e.data,i=this.matrix,n=Math.round(Math.sqrt(i.length)),r=Math.floor(n/2),o=e.width,a=e.height,h=t.ctx.createImageData(o,a),c=h.data,l=this.opaque?1:0;let u,d,g,p,f,m,_,v,y,C,b,w,x;for(b=0;b<a;b++)for(C=0;C<o;C++){for(f=4*(b*o+C),u=0,d=0,g=0,p=0,x=0;x<n;x++)for(w=0;w<n;w++)_=b+x-r,m=C+w-r,_<0||_>=a||m<0||m>=o||(v=4*(_*o+m),y=i[x*n+w],u+=s[v]*y,d+=s[v+1]*y,g+=s[v+2]*y,l||(p+=s[v+3]*y));c[f]=u,c[f+1]=d,c[f+2]=g,c[f+3]=l?s[f+3]:p}t.imageData=h}sendUniformData(t,e){t.uniform1fv(e.uMatrix,this.matrix)}toObject(){return l(l({},super.toObject()),{},{opaque:this.opaque,matrix:[...this.matrix]})}}h(ah,"type","Convolute"),h(ah,"defaults",{opaque:!1,matrix:[0,0,0,0,1,0,0,0,0]}),h(ah,"uniformLocations",["uMatrix","uOpaque","uHalfSize","uSize"]),at.setClass(ah);const hh="Gamma";class ch extends Wa{getFragmentSource(){return"\n  precision highp float;\n  uniform sampler2D uTexture;\n  uniform vec3 uGamma;\n  varying vec2 vTexCoord;\n  void main() {\n    vec4 color = texture2D(uTexture, vTexCoord);\n    vec3 correction = (1.0 / uGamma);\n    color.r = pow(color.r, correction.r);\n    color.g = pow(color.g, correction.g);\n    color.b = pow(color.b, correction.b);\n    gl_FragColor = color;\n    gl_FragColor.rgb *= color.a;\n  }\n"}constructor(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};super(t),this.gamma=t.gamma||this.constructor.defaults.gamma.concat()}applyTo2d(t){let{imageData:{data:e}}=t;const s=this.gamma,i=1/s[0],n=1/s[1],r=1/s[2];this.rgbValues||(this.rgbValues={r:new Uint8Array(256),g:new Uint8Array(256),b:new Uint8Array(256)});const o=this.rgbValues;for(let a=0;a<256;a++)o.r[a]=255*Math.pow(a/255,i),o.g[a]=255*Math.pow(a/255,n),o.b[a]=255*Math.pow(a/255,r);for(let a=0;a<e.length;a+=4)e[a]=o.r[e[a]],e[a+1]=o.g[e[a+1]],e[a+2]=o.b[e[a+2]]}sendUniformData(t,e){t.uniform3fv(e.uGamma,this.gamma)}isNeutralState(){const{gamma:t}=this;return 1===t[0]&&1===t[1]&&1===t[2]}toObject(){return{type:hh,gamma:this.gamma.concat()}}}h(ch,"type",hh),h(ch,"defaults",{gamma:[1,1,1]}),h(ch,"uniformLocations",["uGamma"]),at.setClass(ch);const lh={average:"\n    precision highp float;\n    uniform sampler2D uTexture;\n    varying vec2 vTexCoord;\n    void main() {\n      vec4 color = texture2D(uTexture, vTexCoord);\n      float average = (color.r + color.b + color.g) / 3.0;\n      gl_FragColor = vec4(average, average, average, color.a);\n    }\n    ",lightness:"\n    precision highp float;\n    uniform sampler2D uTexture;\n    uniform int uMode;\n    varying vec2 vTexCoord;\n    void main() {\n      vec4 col = texture2D(uTexture, vTexCoord);\n      float average = (max(max(col.r, col.g),col.b) + min(min(col.r, col.g),col.b)) / 2.0;\n      gl_FragColor = vec4(average, average, average, col.a);\n    }\n    ",luminosity:"\n    precision highp float;\n    uniform sampler2D uTexture;\n    uniform int uMode;\n    varying vec2 vTexCoord;\n    void main() {\n      vec4 col = texture2D(uTexture, vTexCoord);\n      float average = 0.21 * col.r + 0.72 * col.g + 0.07 * col.b;\n      gl_FragColor = vec4(average, average, average, col.a);\n    }\n    "};class uh extends Wa{applyTo2d(t){let{imageData:{data:e}}=t;for(let s,i=0;i<e.length;i+=4){const t=e[i],n=e[i+1],r=e[i+2];switch(this.mode){case"average":s=(t+n+r)/3;break;case"lightness":s=(Math.min(t,n,r)+Math.max(t,n,r))/2;break;case"luminosity":s=.21*t+.72*n+.07*r}e[i+2]=e[i+1]=e[i]=s}}getCacheKey(){return"".concat(this.type,"_").concat(this.mode)}getFragmentSource(){return lh[this.mode]}sendUniformData(t,e){t.uniform1i(e.uMode,1)}isNeutralState(){return!1}}h(uh,"type","Grayscale"),h(uh,"defaults",{mode:"average"}),h(uh,"uniformLocations",["uMode"]),at.setClass(uh);const dh=l(l({},qa),{},{rotation:0});class gh extends Ka{calculateMatrix(){const t=this.rotation*Math.PI,e=ut(t),s=dt(t),i=1/3,n=Math.sqrt(i)*s,r=1-e;this.matrix=[e+r/3,i*r-n,i*r+n,0,0,i*r+n,e+i*r,i*r-n,0,0,i*r-n,i*r+n,e+i*r,0,0,0,0,0,1,0]}isNeutralState(){return 0===this.rotation}applyTo(t){this.calculateMatrix(),super.applyTo(t)}toObject(){return{type:this.type,rotation:this.rotation}}}h(gh,"type","HueRotation"),h(gh,"defaults",dh),at.setClass(gh);class ph extends Wa{applyTo2d(t){let{imageData:{data:e}}=t;for(let s=0;s<e.length;s+=4)e[s]=255-e[s],e[s+1]=255-e[s+1],e[s+2]=255-e[s+2],this.alpha&&(e[s+3]=255-e[s+3])}getFragmentSource(){return"\n  precision highp float;\n  uniform sampler2D uTexture;\n  uniform int uInvert;\n  uniform int uAlpha;\n  varying vec2 vTexCoord;\n  void main() {\n    vec4 color = texture2D(uTexture, vTexCoord);\n    if (uInvert == 1) {\n      if (uAlpha == 1) {\n        gl_FragColor = vec4(1.0 - color.r,1.0 -color.g,1.0 -color.b,1.0 -color.a);\n      } else {\n        gl_FragColor = vec4(1.0 - color.r,1.0 -color.g,1.0 -color.b,color.a);\n      }\n    } else {\n      gl_FragColor = color;\n    }\n  }\n"}isNeutralState(){return!this.invert}sendUniformData(t,e){t.uniform1i(e.uInvert,Number(this.invert)),t.uniform1i(e.uAlpha,Number(this.alpha))}}h(ph,"type","Invert"),h(ph,"defaults",{alpha:!1,invert:!0}),h(ph,"uniformLocations",["uInvert","uAlpha"]),at.setClass(ph);class fh extends Wa{getFragmentSource(){return"\n  precision highp float;\n  uniform sampler2D uTexture;\n  uniform float uStepH;\n  uniform float uNoise;\n  uniform float uSeed;\n  varying vec2 vTexCoord;\n  float rand(vec2 co, float seed, float vScale) {\n    return fract(sin(dot(co.xy * vScale ,vec2(12.9898 , 78.233))) * 43758.5453 * (seed + 0.01) / 2.0);\n  }\n  void main() {\n    vec4 color = texture2D(uTexture, vTexCoord);\n    color.rgb += (0.5 - rand(vTexCoord, uSeed, 0.1 / uStepH)) * uNoise;\n    gl_FragColor = color;\n  }\n"}applyTo2d(t){let{imageData:{data:e}}=t;const s=this.noise;for(let i=0;i<e.length;i+=4){const t=(.5-Math.random())*s;e[i]+=t,e[i+1]+=t,e[i+2]+=t}}sendUniformData(t,e){t.uniform1f(e.uNoise,this.noise/255),t.uniform1f(e.uSeed,Math.random())}isNeutralState(){return 0===this.noise}}h(fh,"type","Noise"),h(fh,"defaults",{noise:0}),h(fh,"uniformLocations",["uNoise","uSeed"]),at.setClass(fh);class mh extends Wa{applyTo2d(t){let{imageData:{data:e,width:s,height:i}}=t;for(let n=0;n<i;n+=this.blocksize)for(let t=0;t<s;t+=this.blocksize){const r=4*n*s+4*t,o=e[r],a=e[r+1],h=e[r+2],c=e[r+3];for(let l=n;l<Math.min(n+this.blocksize,i);l++)for(let i=t;i<Math.min(t+this.blocksize,s);i++){const t=4*l*s+4*i;e[t]=o,e[t+1]=a,e[t+2]=h,e[t+3]=c}}}isNeutralState(){return 1===this.blocksize}getFragmentSource(){return"\n  precision highp float;\n  uniform sampler2D uTexture;\n  uniform float uBlocksize;\n  uniform float uStepW;\n  uniform float uStepH;\n  varying vec2 vTexCoord;\n  void main() {\n    float blockW = uBlocksize * uStepW;\n    float blockH = uBlocksize * uStepH;\n    int posX = int(vTexCoord.x / blockW);\n    int posY = int(vTexCoord.y / blockH);\n    float fposX = float(posX);\n    float fposY = float(posY);\n    vec2 squareCoords = vec2(fposX * blockW, fposY * blockH);\n    vec4 color = texture2D(uTexture, squareCoords);\n    gl_FragColor = color;\n  }\n"}sendUniformData(t,e){t.uniform1f(e.uBlocksize,this.blocksize)}}h(mh,"type","Pixelate"),h(mh,"defaults",{blocksize:4}),h(mh,"uniformLocations",["uBlocksize"]),at.setClass(mh);class _h extends Wa{getFragmentSource(){return"\nprecision highp float;\nuniform sampler2D uTexture;\nuniform vec4 uLow;\nuniform vec4 uHigh;\nvarying vec2 vTexCoord;\nvoid main() {\n  gl_FragColor = texture2D(uTexture, vTexCoord);\n  if(all(greaterThan(gl_FragColor.rgb,uLow.rgb)) && all(greaterThan(uHigh.rgb,gl_FragColor.rgb))) {\n    gl_FragColor.a = 0.0;\n  }\n}\n"}applyTo2d(t){let{imageData:{data:e}}=t;const s=255*this.distance,i=new Ye(this.color).getSource(),n=[i[0]-s,i[1]-s,i[2]-s],r=[i[0]+s,i[1]+s,i[2]+s];for(let o=0;o<e.length;o+=4){const t=e[o],s=e[o+1],i=e[o+2];t>n[0]&&s>n[1]&&i>n[2]&&t<r[0]&&s<r[1]&&i<r[2]&&(e[o+3]=0)}}sendUniformData(t,e){const s=new Ye(this.color).getSource(),i=this.distance,n=[0+s[0]/255-i,0+s[1]/255-i,0+s[2]/255-i,1],r=[s[0]/255+i,s[1]/255+i,s[2]/255+i,1];t.uniform4fv(e.uLow,n),t.uniform4fv(e.uHigh,r)}}h(_h,"type","RemoveColor"),h(_h,"defaults",{color:"#FFFFFF",distance:.02,useAlpha:!1}),h(_h,"uniformLocations",["uLow","uHigh"]),at.setClass(_h);class vh extends Wa{sendUniformData(t,e){t.uniform2fv(e.uDelta,this.horizontal?[1/this.width,0]:[0,1/this.height]),t.uniform1fv(e.uTaps,this.taps)}getFilterWindow(){const t=this.tempScale;return Math.ceil(this.lanczosLobes/t)}getCacheKey(){const t=this.getFilterWindow();return"".concat(this.type,"_").concat(t)}getFragmentSource(){const t=this.getFilterWindow();return this.generateShader(t)}getTaps(){const t=this.lanczosCreate(this.lanczosLobes),e=this.tempScale,s=this.getFilterWindow(),i=new Array(s);for(let n=1;n<=s;n++)i[n-1]=t(n*e);return i}generateShader(t){const e=new Array(t);for(let s=1;s<=t;s++)e[s-1]="".concat(s,".0 * uDelta");return"\n      precision highp float;\n      uniform sampler2D uTexture;\n      uniform vec2 uDelta;\n      varying vec2 vTexCoord;\n      uniform float uTaps[".concat(t,"];\n      void main() {\n        vec4 color = texture2D(uTexture, vTexCoord);\n        float sum = 1.0;\n        ").concat(e.map(((t,e)=>"\n              color += texture2D(uTexture, vTexCoord + ".concat(t,") * uTaps[").concat(e,"] + texture2D(uTexture, vTexCoord - ").concat(t,") * uTaps[").concat(e,"];\n              sum += 2.0 * uTaps[").concat(e,"];\n            "))).join("\n"),"\n        gl_FragColor = color / sum;\n      }\n    ")}applyToForWebgl(t){t.passes++,this.width=t.sourceWidth,this.horizontal=!0,this.dW=Math.round(this.width*this.scaleX),this.dH=t.sourceHeight,this.tempScale=this.dW/this.width,this.taps=this.getTaps(),t.destinationWidth=this.dW,super.applyTo(t),t.sourceWidth=t.destinationWidth,this.height=t.sourceHeight,this.horizontal=!1,this.dH=Math.round(this.height*this.scaleY),this.tempScale=this.dH/this.height,this.taps=this.getTaps(),t.destinationHeight=this.dH,super.applyTo(t),t.sourceHeight=t.destinationHeight}applyTo(t){Ra(t)?this.applyToForWebgl(t):this.applyTo2d(t)}isNeutralState(){return 1===this.scaleX&&1===this.scaleY}lanczosCreate(t){return e=>{if(e>=t||e<=-t)return 0;if(e<1.1920929e-7&&e>-1.1920929e-7)return 1;const s=(e*=Math.PI)/t;return Math.sin(e)/e*Math.sin(s)/s}}applyTo2d(t){const e=t.imageData,s=this.scaleX,i=this.scaleY;this.rcpScaleX=1/s,this.rcpScaleY=1/i;const n=e.width,r=e.height,o=Math.round(n*s),a=Math.round(r*i);let h;h="sliceHack"===this.resizeType?this.sliceByTwo(t,n,r,o,a):"hermite"===this.resizeType?this.hermiteFastResize(t,n,r,o,a):"bilinear"===this.resizeType?this.bilinearFiltering(t,n,r,o,a):"lanczos"===this.resizeType?this.lanczosResize(t,n,r,o,a):new ImageData(o,a),t.imageData=h}sliceByTwo(t,e,s,i,n){const r=t.imageData,o=.5;let a=!1,h=!1,c=e*o,l=s*o;const u=t.filterBackend.resources;let d=0,g=0;const p=e;let f=0;u.sliceByTwo||(u.sliceByTwo=wt());const m=u.sliceByTwo;(m.width<1.5*e||m.height<s)&&(m.width=1.5*e,m.height=s);const _=m.getContext("2d");for(_.clearRect(0,0,1.5*e,s),_.putImageData(r,0,0),i=Math.floor(i),n=Math.floor(n);!a||!h;)e=c,s=l,i<Math.floor(c*o)?c=Math.floor(c*o):(c=i,a=!0),n<Math.floor(l*o)?l=Math.floor(l*o):(l=n,h=!0),_.drawImage(m,d,g,e,s,p,f,c,l),d=p,g=f,f+=l;return _.getImageData(d,g,i,n)}lanczosResize(t,e,s,i,n){const r=t.imageData.data,o=t.ctx.createImageData(i,n),a=o.data,h=this.lanczosCreate(this.lanczosLobes),c=this.rcpScaleX,l=this.rcpScaleY,u=2/this.rcpScaleX,d=2/this.rcpScaleY,g=Math.ceil(c*this.lanczosLobes/2),p=Math.ceil(l*this.lanczosLobes/2),f={},m={x:0,y:0},_={x:0,y:0};return function t(v){let y,C,b,w,x,S,T,k,A,E,O;for(m.x=(v+.5)*c,_.x=Math.floor(m.x),y=0;y<n;y++){for(m.y=(y+.5)*l,_.y=Math.floor(m.y),x=0,S=0,T=0,k=0,A=0,C=_.x-g;C<=_.x+g;C++)if(!(C<0||C>=e)){E=Math.floor(1e3*Math.abs(C-m.x)),f[E]||(f[E]={});for(let t=_.y-p;t<=_.y+p;t++)t<0||t>=s||(O=Math.floor(1e3*Math.abs(t-m.y)),f[E][O]||(f[E][O]=h(Math.sqrt(Math.pow(E*u,2)+Math.pow(O*d,2))/1e3)),b=f[E][O],b>0&&(w=4*(t*e+C),x+=b,S+=b*r[w],T+=b*r[w+1],k+=b*r[w+2],A+=b*r[w+3]))}w=4*(y*i+v),a[w]=S/x,a[w+1]=T/x,a[w+2]=k/x,a[w+3]=A/x}return++v<i?t(v):o}(0)}bilinearFiltering(t,e,s,i,n){let r,o,a,h,c,l,u,d,g,p,f,m,_,v=0;const y=this.rcpScaleX,C=this.rcpScaleY,b=4*(e-1),w=t.imageData.data,x=t.ctx.createImageData(i,n),S=x.data;for(u=0;u<n;u++)for(d=0;d<i;d++)for(c=Math.floor(y*d),l=Math.floor(C*u),g=y*d-c,p=C*u-l,_=4*(l*e+c),f=0;f<4;f++)r=w[_+f],o=w[_+4+f],a=w[_+b+f],h=w[_+b+4+f],m=r*(1-g)*(1-p)+o*g*(1-p)+a*p*(1-g)+h*g*p,S[v++]=m;return x}hermiteFastResize(t,e,s,i,n){const r=this.rcpScaleX,o=this.rcpScaleY,a=Math.ceil(r/2),h=Math.ceil(o/2),c=t.imageData.data,l=t.ctx.createImageData(i,n),u=l.data;for(let d=0;d<n;d++)for(let t=0;t<i;t++){const s=4*(t+d*i);let n=0,l=0,g=0,p=0,f=0,m=0,_=0;const v=(d+.5)*o;for(let i=Math.floor(d*o);i<(d+1)*o;i++){const s=Math.abs(v-(i+.5))/h,o=(t+.5)*r,u=s*s;for(let h=Math.floor(t*r);h<(t+1)*r;h++){let t=Math.abs(o-(h+.5))/a;const s=Math.sqrt(u+t*t);s>1&&s<-1||(n=2*s*s*s-3*s*s+1,n>0&&(t=4*(h+i*e),_+=n*c[t+3],g+=n,c[t+3]<255&&(n=n*c[t+3]/250),p+=n*c[t],f+=n*c[t+1],m+=n*c[t+2],l+=n))}}u[s]=p/l,u[s+1]=f/l,u[s+2]=m/l,u[s+3]=_/g}return l}}h(vh,"type","Resize"),h(vh,"defaults",{resizeType:"hermite",scaleX:1,scaleY:1,lanczosLobes:3}),h(vh,"uniformLocations",["uDelta","uTaps"]),at.setClass(vh);class yh extends Wa{getFragmentSource(){return"\n  precision highp float;\n  uniform sampler2D uTexture;\n  uniform float uSaturation;\n  varying vec2 vTexCoord;\n  void main() {\n    vec4 color = texture2D(uTexture, vTexCoord);\n    float rgMax = max(color.r, color.g);\n    float rgbMax = max(rgMax, color.b);\n    color.r += rgbMax != color.r ? (rgbMax - color.r) * uSaturation : 0.00;\n    color.g += rgbMax != color.g ? (rgbMax - color.g) * uSaturation : 0.00;\n    color.b += rgbMax != color.b ? (rgbMax - color.b) * uSaturation : 0.00;\n    gl_FragColor = color;\n  }\n"}applyTo2d(t){let{imageData:{data:e}}=t;const s=-this.saturation;for(let i=0;i<e.length;i+=4){const t=e[i],n=e[i+1],r=e[i+2],o=Math.max(t,n,r);e[i]+=o!==t?(o-t)*s:0,e[i+1]+=o!==n?(o-n)*s:0,e[i+2]+=o!==r?(o-r)*s:0}}sendUniformData(t,e){t.uniform1f(e.uSaturation,-this.saturation)}isNeutralState(){return 0===this.saturation}}h(yh,"type","Saturation"),h(yh,"defaults",{saturation:0}),h(yh,"uniformLocations",["uSaturation"]),at.setClass(yh);class Ch extends Wa{getFragmentSource(){return"\n  precision highp float;\n  uniform sampler2D uTexture;\n  uniform float uVibrance;\n  varying vec2 vTexCoord;\n  void main() {\n    vec4 color = texture2D(uTexture, vTexCoord);\n    float max = max(color.r, max(color.g, color.b));\n    float avg = (color.r + color.g + color.b) / 3.0;\n    float amt = (abs(max - avg) * 2.0) * uVibrance;\n    color.r += max != color.r ? (max - color.r) * amt : 0.00;\n    color.g += max != color.g ? (max - color.g) * amt : 0.00;\n    color.b += max != color.b ? (max - color.b) * amt : 0.00;\n    gl_FragColor = color;\n  }\n"}applyTo2d(t){let{imageData:{data:e}}=t;const s=-this.vibrance;for(let i=0;i<e.length;i+=4){const t=e[i],n=e[i+1],r=e[i+2],o=Math.max(t,n,r),a=(t+n+r)/3,h=2*Math.abs(o-a)/255*s;e[i]+=o!==t?(o-t)*h:0,e[i+1]+=o!==n?(o-n)*h:0,e[i+2]+=o!==r?(o-r)*h:0}}sendUniformData(t,e){t.uniform1f(e.uVibrance,-this.vibrance)}isNeutralState(){return 0===this.vibrance}}h(Ch,"type","Vibrance"),h(Ch,"defaults",{vibrance:0}),h(Ch,"uniformLocations",["uVibrance"]),at.setClass(Ch);Object.freeze({__proto__:null,BaseFilter:Wa,BlackWhite:ih,BlendColor:Ya,BlendImage:Ga,Blur:Ha,Brightness:za,Brownie:Ja,ColorMatrix:Ka,Composed:nh,Contrast:rh,Convolute:ah,Gamma:ch,Grayscale:uh,HueRotation:gh,Invert:ph,Kodachrome:$a,Noise:fh,Pixelate:mh,Polaroid:eh,RemoveColor:_h,Resize:vh,Saturation:yh,Sepia:sh,Technicolor:th,Vibrance:Ch,Vintage:Za}),s(1560),s(3713),s(3055),s(7155);var bh=s(8015),wh=s(795),xh=s(9759),Sh=s(7608);s(4979);const Th=()=>{},kh={NODE_CLIENT:!1,NODE_ADMIN:!1,SDK_VERSION:"${JSCORE_VERSION}"},Ah=function(t,e){if(!t)throw Eh(e)},Eh=function(t){return new Error("Firebase Database ("+kh.SDK_VERSION+") INTERNAL ASSERT FAILED: "+t)},Oh=function(t){const e=[];let s=0;for(let i=0;i<t.length;i++){let n=t.charCodeAt(i);n<128?e[s++]=n:n<2048?(e[s++]=n>>6|192,e[s++]=63&n|128):55296===(64512&n)&&i+1<t.length&&56320===(64512&t.charCodeAt(i+1))?(n=65536+((1023&n)<<10)+(1023&t.charCodeAt(++i)),e[s++]=n>>18|240,e[s++]=n>>12&63|128,e[s++]=n>>6&63|128,e[s++]=63&n|128):(e[s++]=n>>12|224,e[s++]=n>>6&63|128,e[s++]=63&n|128)}return e},Dh=function(t){const e=[];let s=0,i=0;while(s<t.length){const n=t[s++];if(n<128)e[i++]=String.fromCharCode(n);else if(n>191&&n<224){const r=t[s++];e[i++]=String.fromCharCode((31&n)<<6|63&r)}else if(n>239&&n<365){const r=t[s++],o=t[s++],a=t[s++],h=((7&n)<<18|(63&r)<<12|(63&o)<<6|63&a)-65536;e[i++]=String.fromCharCode(55296+(h>>10)),e[i++]=String.fromCharCode(56320+(1023&h))}else{const r=t[s++],o=t[s++];e[i++]=String.fromCharCode((15&n)<<12|(63&r)<<6|63&o)}}return e.join("")},Ph={byteToCharMap_:null,charToByteMap_:null,byteToCharMapWebSafe_:null,charToByteMapWebSafe_:null,ENCODED_VALS_BASE:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",get ENCODED_VALS(){return this.ENCODED_VALS_BASE+"+/="},get ENCODED_VALS_WEBSAFE(){return this.ENCODED_VALS_BASE+"-_."},HAS_NATIVE_SUPPORT:"function"===typeof atob,encodeByteArray(t,e){if(!Array.isArray(t))throw Error("encodeByteArray takes an array as a parameter");this.init_();const s=e?this.byteToCharMapWebSafe_:this.byteToCharMap_,i=[];for(let n=0;n<t.length;n+=3){const e=t[n],r=n+1<t.length,o=r?t[n+1]:0,a=n+2<t.length,h=a?t[n+2]:0,c=e>>2,l=(3&e)<<4|o>>4;let u=(15&o)<<2|h>>6,d=63&h;a||(d=64,r||(u=64)),i.push(s[c],s[l],s[u],s[d])}return i.join("")},encodeString(t,e){return this.HAS_NATIVE_SUPPORT&&!e?btoa(t):this.encodeByteArray(Oh(t),e)},decodeString(t,e){return this.HAS_NATIVE_SUPPORT&&!e?atob(t):Dh(this.decodeStringToByteArray(t,e))},decodeStringToByteArray(t,e){this.init_();const s=e?this.charToByteMapWebSafe_:this.charToByteMap_,i=[];for(let n=0;n<t.length;){const e=s[t.charAt(n++)],r=n<t.length,o=r?s[t.charAt(n)]:0;++n;const a=n<t.length,h=a?s[t.charAt(n)]:64;++n;const c=n<t.length,l=c?s[t.charAt(n)]:64;if(++n,null==e||null==o||null==h||null==l)throw new Ih;const u=e<<2|o>>4;if(i.push(u),64!==h){const t=o<<4&240|h>>2;if(i.push(t),64!==l){const t=h<<6&192|l;i.push(t)}}}return i},init_(){if(!this.byteToCharMap_){this.byteToCharMap_={},this.charToByteMap_={},this.byteToCharMapWebSafe_={},this.charToByteMapWebSafe_={};for(let t=0;t<this.ENCODED_VALS.length;t++)this.byteToCharMap_[t]=this.ENCODED_VALS.charAt(t),this.charToByteMap_[this.byteToCharMap_[t]]=t,this.byteToCharMapWebSafe_[t]=this.ENCODED_VALS_WEBSAFE.charAt(t),this.charToByteMapWebSafe_[this.byteToCharMapWebSafe_[t]]=t,t>=this.ENCODED_VALS_BASE.length&&(this.charToByteMap_[this.ENCODED_VALS_WEBSAFE.charAt(t)]=t,this.charToByteMapWebSafe_[this.ENCODED_VALS.charAt(t)]=t)}}};class Ih extends Error{constructor(){super(...arguments),this.name="DecodeBase64StringError"}}const Mh=function(t){const e=Oh(t);return Ph.encodeByteArray(e,!0)},Rh=function(t){return Mh(t).replace(/\./g,"")},Fh=function(t){try{return Ph.decodeString(t,!0)}catch(c){console.error("base64Decode failed: ",c)}return null};
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
function Lh(t){return jh(void 0,t)}function jh(t,e){if(!(e instanceof Object))return e;switch(e.constructor){case Date:const s=e;return new Date(s.getTime());case Object:void 0===t&&(t={});break;case Array:t=[];break;default:return e}for(const s in e)e.hasOwnProperty(s)&&Nh(s)&&(t[s]=jh(t[s],e[s]));return t}function Nh(t){return"__proto__"!==t}
/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Bh(){if("undefined"!==typeof self)return self;if("undefined"!==typeof window)return window;if("undefined"!==typeof s.g)return s.g;throw new Error("Unable to locate global object.")}
/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Wh=()=>Bh().__FIREBASE_DEFAULTS__,Uh=()=>{if("undefined"===typeof process)return;const t={NODE_ENV:"production",BASE_URL:"/alien_mood/"}.__FIREBASE_DEFAULTS__;return t?JSON.parse(t):void 0},Yh=()=>{if("undefined"===typeof document)return;let t;try{t=document.cookie.match(/__FIREBASE_DEFAULTS__=([^;]+)/)}catch(c){return}const e=t&&Fh(t[1]);return e&&JSON.parse(e)},Xh=()=>{try{return Th()||Wh()||Uh()||Yh()}catch(c){return void console.info(`Unable to get __FIREBASE_DEFAULTS__ due to: ${c}`)}},Vh=t=>{var e,s;return null===(s=null===(e=Xh())||void 0===e?void 0:e.emulatorHosts)||void 0===s?void 0:s[t]},Gh=t=>{const e=Vh(t);if(!e)return;const s=e.lastIndexOf(":");if(s<=0||s+1===e.length)throw new Error(`Invalid host ${e} with no separate hostname and port!`);const i=parseInt(e.substring(s+1),10);return"["===e[0]?[e.substring(1,s-1),i]:[e.substring(0,s),i]},Hh=()=>{var t;return null===(t=Xh())||void 0===t?void 0:t.config};
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
class zh{constructor(){this.reject=()=>{},this.resolve=()=>{},this.promise=new Promise(((t,e)=>{this.resolve=t,this.reject=e}))}wrapCallback(t){return(e,s)=>{e?this.reject(e):this.resolve(s),"function"===typeof t&&(this.promise.catch((()=>{})),1===t.length?t(e):t(e,s))}}}
/**
 * @license
 * Copyright 2025 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function qh(t){return t.endsWith(".cloudworkstations.dev")}async function Kh(t){const e=await fetch(t,{credentials:"include"});return e.ok}
/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Qh(t,e){if(t.uid)throw new Error('The "uid" field is no longer supported by mockUserToken. Please use "sub" instead for Firebase Auth User ID.');const s={alg:"none",type:"JWT"},i=e||"demo-project",n=t.iat||0,r=t.sub||t.user_id;if(!r)throw new Error("mockUserToken must contain 'sub' or 'user_id' field!");const o=Object.assign({iss:`https://securetoken.google.com/${i}`,aud:i,iat:n,exp:n+3600,auth_time:n,sub:r,user_id:r,firebase:{sign_in_provider:"custom",identities:{}}},t),a="";return[Rh(JSON.stringify(s)),Rh(JSON.stringify(o)),a].join(".")}const Jh={};function Zh(){const t={prod:[],emulator:[]};for(const e of Object.keys(Jh))Jh[e]?t.emulator.push(e):t.prod.push(e);return t}function $h(t){let e=document.getElementById(t),s=!1;return e||(e=document.createElement("div"),e.setAttribute("id",t),s=!0),{created:s,element:e}}let tc=!1;function ec(t,e){if("undefined"===typeof window||"undefined"===typeof document||!qh(window.location.host)||Jh[t]===e||Jh[t]||tc)return;function s(t){return`__firebase__banner__${t}`}Jh[t]=e;const i="__firebase__banner",n=Zh(),r=n.prod.length>0;function o(){const t=document.getElementById(i);t&&t.remove()}function a(t){t.style.display="flex",t.style.background="#7faaf0",t.style.position="fixed",t.style.bottom="5px",t.style.left="5px",t.style.padding=".5em",t.style.borderRadius="5px",t.style.alignItems="center"}function h(t,e){t.setAttribute("width","24"),t.setAttribute("id",e),t.setAttribute("height","24"),t.setAttribute("viewBox","0 0 24 24"),t.setAttribute("fill","none"),t.style.marginLeft="-6px"}function c(){const t=document.createElement("span");return t.style.cursor="pointer",t.style.marginLeft="16px",t.style.fontSize="24px",t.innerHTML=" &times;",t.onclick=()=>{tc=!0,o()},t}function l(t,e){t.setAttribute("id",e),t.innerText="Learn more",t.href="https://firebase.google.com/docs/studio/preview-apps#preview-backend",t.setAttribute("target","__blank"),t.style.paddingLeft="5px",t.style.textDecoration="underline"}function u(){const t=$h(i),e=s("text"),n=document.getElementById(e)||document.createElement("span"),o=s("learnmore"),u=document.getElementById(o)||document.createElement("a"),d=s("preprendIcon"),g=document.getElementById(d)||document.createElementNS("http://www.w3.org/2000/svg","svg");if(t.created){const e=t.element;a(e),l(u,o);const s=c();h(g,d),e.append(g,n,u,s),document.body.appendChild(e)}r?(n.innerText="Preview backend disconnected.",g.innerHTML='<g clip-path="url(#clip0_6013_33858)">\n<path d="M4.8 17.6L12 5.6L19.2 17.6H4.8ZM6.91667 16.4H17.0833L12 7.93333L6.91667 16.4ZM12 15.6C12.1667 15.6 12.3056 15.5444 12.4167 15.4333C12.5389 15.3111 12.6 15.1667 12.6 15C12.6 14.8333 12.5389 14.6944 12.4167 14.5833C12.3056 14.4611 12.1667 14.4 12 14.4C11.8333 14.4 11.6889 14.4611 11.5667 14.5833C11.4556 14.6944 11.4 14.8333 11.4 15C11.4 15.1667 11.4556 15.3111 11.5667 15.4333C11.6889 15.5444 11.8333 15.6 12 15.6ZM11.4 13.6H12.6V10.4H11.4V13.6Z" fill="#212121"/>\n</g>\n<defs>\n<clipPath id="clip0_6013_33858">\n<rect width="24" height="24" fill="white"/>\n</clipPath>\n</defs>'):(g.innerHTML='<g clip-path="url(#clip0_6083_34804)">\n<path d="M11.4 15.2H12.6V11.2H11.4V15.2ZM12 10C12.1667 10 12.3056 9.94444 12.4167 9.83333C12.5389 9.71111 12.6 9.56667 12.6 9.4C12.6 9.23333 12.5389 9.09444 12.4167 8.98333C12.3056 8.86111 12.1667 8.8 12 8.8C11.8333 8.8 11.6889 8.86111 11.5667 8.98333C11.4556 9.09444 11.4 9.23333 11.4 9.4C11.4 9.56667 11.4556 9.71111 11.5667 9.83333C11.6889 9.94444 11.8333 10 12 10ZM12 18.4C11.1222 18.4 10.2944 18.2333 9.51667 17.9C8.73889 17.5667 8.05556 17.1111 7.46667 16.5333C6.88889 15.9444 6.43333 15.2611 6.1 14.4833C5.76667 13.7056 5.6 12.8778 5.6 12C5.6 11.1111 5.76667 10.2833 6.1 9.51667C6.43333 8.73889 6.88889 8.06111 7.46667 7.48333C8.05556 6.89444 8.73889 6.43333 9.51667 6.1C10.2944 5.76667 11.1222 5.6 12 5.6C12.8889 5.6 13.7167 5.76667 14.4833 6.1C15.2611 6.43333 15.9389 6.89444 16.5167 7.48333C17.1056 8.06111 17.5667 8.73889 17.9 9.51667C18.2333 10.2833 18.4 11.1111 18.4 12C18.4 12.8778 18.2333 13.7056 17.9 14.4833C17.5667 15.2611 17.1056 15.9444 16.5167 16.5333C15.9389 17.1111 15.2611 17.5667 14.4833 17.9C13.7167 18.2333 12.8889 18.4 12 18.4ZM12 17.2C13.4444 17.2 14.6722 16.6944 15.6833 15.6833C16.6944 14.6722 17.2 13.4444 17.2 12C17.2 10.5556 16.6944 9.32778 15.6833 8.31667C14.6722 7.30555 13.4444 6.8 12 6.8C10.5556 6.8 9.32778 7.30555 8.31667 8.31667C7.30556 9.32778 6.8 10.5556 6.8 12C6.8 13.4444 7.30556 14.6722 8.31667 15.6833C9.32778 16.6944 10.5556 17.2 12 17.2Z" fill="#212121"/>\n</g>\n<defs>\n<clipPath id="clip0_6083_34804">\n<rect width="24" height="24" fill="white"/>\n</clipPath>\n</defs>',n.innerText="Preview backend running in this workspace."),n.setAttribute("id",e)}"loading"===document.readyState?window.addEventListener("DOMContentLoaded",u):u()}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function sc(){return"undefined"!==typeof navigator&&"string"===typeof navigator["userAgent"]?navigator["userAgent"]:""}function ic(){return"undefined"!==typeof window&&!!(window["cordova"]||window["phonegap"]||window["PhoneGap"])&&/ios|iphone|ipod|ipad|android|blackberry|iemobile/i.test(sc())}function nc(){return"object"===typeof navigator&&"ReactNative"===navigator["product"]}function rc(){return!0===kh.NODE_CLIENT||!0===kh.NODE_ADMIN}function oc(){try{return"object"===typeof indexedDB}catch(c){return!1}}function ac(){return new Promise(((t,e)=>{try{let s=!0;const i="validate-browser-context-for-indexeddb-analytics-module",n=self.indexedDB.open(i);n.onsuccess=()=>{n.result.close(),s||self.indexedDB.deleteDatabase(i),t(!0)},n.onupgradeneeded=()=>{s=!1},n.onerror=()=>{var t;e((null===(t=n.error)||void 0===t?void 0:t.message)||"")}}catch(Xu){e(Xu)}}))}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
const hc="FirebaseError";class cc extends Error{constructor(t,e,s){super(e),this.code=t,this.customData=s,this.name=hc,Object.setPrototypeOf(this,cc.prototype),Error.captureStackTrace&&Error.captureStackTrace(this,lc.prototype.create)}}class lc{constructor(t,e,s){this.service=t,this.serviceName=e,this.errors=s}create(t,...e){const s=e[0]||{},i=`${this.service}/${t}`,n=this.errors[t],r=n?uc(n,s):"Error",o=`${this.serviceName}: ${r} (${i}).`,a=new cc(i,o,s);return a}}function uc(t,e){return t.replace(dc,((t,s)=>{const i=e[s];return null!=i?String(i):`<${s}?>`}))}const dc=/\{\$([^}]+)}/g;
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function gc(t){return JSON.parse(t)}function pc(t){return JSON.stringify(t)}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const fc=function(t){let e={},s={},i={},n="";try{const r=t.split(".");e=gc(Fh(r[0])||""),s=gc(Fh(r[1])||""),n=r[2],i=s["d"]||{},delete s["d"]}catch(c){}return{header:e,claims:s,data:i,signature:n}},mc=function(t){const e=fc(t),s=e.claims;return!!s&&"object"===typeof s&&s.hasOwnProperty("iat")},_c=function(t){const e=fc(t).claims;return"object"===typeof e&&!0===e["admin"]};
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
function vc(t,e){return Object.prototype.hasOwnProperty.call(t,e)}function yc(t,e){return Object.prototype.hasOwnProperty.call(t,e)?t[e]:void 0}function Cc(t){for(const e in t)if(Object.prototype.hasOwnProperty.call(t,e))return!1;return!0}function bc(t,e,s){const i={};for(const n in t)Object.prototype.hasOwnProperty.call(t,n)&&(i[n]=e.call(s,t[n],n,t));return i}function wc(t,e){if(t===e)return!0;const s=Object.keys(t),i=Object.keys(e);for(const n of s){if(!i.includes(n))return!1;const s=t[n],r=e[n];if(xc(s)&&xc(r)){if(!wc(s,r))return!1}else if(s!==r)return!1}for(const n of i)if(!s.includes(n))return!1;return!0}function xc(t){return null!==t&&"object"===typeof t}
/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
function Sc(t){const e=[];for(const[s,i]of Object.entries(t))Array.isArray(i)?i.forEach((t=>{e.push(encodeURIComponent(s)+"="+encodeURIComponent(t))})):e.push(encodeURIComponent(s)+"="+encodeURIComponent(i));return e.length?"&"+e.join("&"):""}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
class Tc{constructor(){this.chain_=[],this.buf_=[],this.W_=[],this.pad_=[],this.inbuf_=0,this.total_=0,this.blockSize=64,this.pad_[0]=128;for(let t=1;t<this.blockSize;++t)this.pad_[t]=0;this.reset()}reset(){this.chain_[0]=1732584193,this.chain_[1]=4023233417,this.chain_[2]=2562383102,this.chain_[3]=271733878,this.chain_[4]=3285377520,this.inbuf_=0,this.total_=0}compress_(t,e){e||(e=0);const s=this.W_;if("string"===typeof t)for(let l=0;l<16;l++)s[l]=t.charCodeAt(e)<<24|t.charCodeAt(e+1)<<16|t.charCodeAt(e+2)<<8|t.charCodeAt(e+3),e+=4;else for(let l=0;l<16;l++)s[l]=t[e]<<24|t[e+1]<<16|t[e+2]<<8|t[e+3],e+=4;for(let l=16;l<80;l++){const t=s[l-3]^s[l-8]^s[l-14]^s[l-16];s[l]=4294967295&(t<<1|t>>>31)}let i,n,r=this.chain_[0],o=this.chain_[1],a=this.chain_[2],h=this.chain_[3],c=this.chain_[4];for(let l=0;l<80;l++){l<40?l<20?(i=h^o&(a^h),n=1518500249):(i=o^a^h,n=1859775393):l<60?(i=o&a|h&(o|a),n=2400959708):(i=o^a^h,n=3395469782);const t=(r<<5|r>>>27)+i+c+n+s[l]&4294967295;c=h,h=a,a=4294967295&(o<<30|o>>>2),o=r,r=t}this.chain_[0]=this.chain_[0]+r&4294967295,this.chain_[1]=this.chain_[1]+o&4294967295,this.chain_[2]=this.chain_[2]+a&4294967295,this.chain_[3]=this.chain_[3]+h&4294967295,this.chain_[4]=this.chain_[4]+c&4294967295}update(t,e){if(null==t)return;void 0===e&&(e=t.length);const s=e-this.blockSize;let i=0;const n=this.buf_;let r=this.inbuf_;while(i<e){if(0===r)while(i<=s)this.compress_(t,i),i+=this.blockSize;if("string"===typeof t){while(i<e)if(n[r]=t.charCodeAt(i),++r,++i,r===this.blockSize){this.compress_(n),r=0;break}}else while(i<e)if(n[r]=t[i],++r,++i,r===this.blockSize){this.compress_(n),r=0;break}}this.inbuf_=r,this.total_+=e}digest(){const t=[];let e=8*this.total_;this.inbuf_<56?this.update(this.pad_,56-this.inbuf_):this.update(this.pad_,this.blockSize-(this.inbuf_-56));for(let i=this.blockSize-1;i>=56;i--)this.buf_[i]=255&e,e/=256;this.compress_(this.buf_);let s=0;for(let i=0;i<5;i++)for(let e=24;e>=0;e-=8)t[s]=this.chain_[i]>>e&255,++s;return t}}function kc(t,e){return`${t} failed: ${e} argument `}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
const Ac=function(t){const e=[];let s=0;for(let i=0;i<t.length;i++){let n=t.charCodeAt(i);if(n>=55296&&n<=56319){const e=n-55296;i++,Ah(i<t.length,"Surrogate pair missing trail surrogate.");const s=t.charCodeAt(i)-56320;n=65536+(e<<10)+s}n<128?e[s++]=n:n<2048?(e[s++]=n>>6|192,e[s++]=63&n|128):n<65536?(e[s++]=n>>12|224,e[s++]=n>>6&63|128,e[s++]=63&n|128):(e[s++]=n>>18|240,e[s++]=n>>12&63|128,e[s++]=n>>6&63|128,e[s++]=63&n|128)}return e},Ec=function(t){let e=0;for(let s=0;s<t.length;s++){const i=t.charCodeAt(s);i<128?e++:i<2048?e+=2:i>=55296&&i<=56319?(e+=4,s++):e+=3}return e};
/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
function Oc(t){return t&&t._delegate?t._delegate:t}class Dc{constructor(t,e,s){this.name=t,this.instanceFactory=e,this.type=s,this.multipleInstances=!1,this.serviceProps={},this.instantiationMode="LAZY",this.onInstanceCreated=null}setInstantiationMode(t){return this.instantiationMode=t,this}setMultipleInstances(t){return this.multipleInstances=t,this}setServiceProps(t){return this.serviceProps=t,this}setInstanceCreatedCallback(t){return this.onInstanceCreated=t,this}}
/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Pc="[DEFAULT]";
/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ic{constructor(t,e){this.name=t,this.container=e,this.component=null,this.instances=new Map,this.instancesDeferred=new Map,this.instancesOptions=new Map,this.onInitCallbacks=new Map}get(t){const e=this.normalizeInstanceIdentifier(t);if(!this.instancesDeferred.has(e)){const t=new zh;if(this.instancesDeferred.set(e,t),this.isInitialized(e)||this.shouldAutoInitialize())try{const s=this.getOrInitializeService({instanceIdentifier:e});s&&t.resolve(s)}catch(c){}}return this.instancesDeferred.get(e).promise}getImmediate(t){var e;const s=this.normalizeInstanceIdentifier(null===t||void 0===t?void 0:t.identifier),i=null!==(e=null===t||void 0===t?void 0:t.optional)&&void 0!==e&&e;if(!this.isInitialized(s)&&!this.shouldAutoInitialize()){if(i)return null;throw Error(`Service ${this.name} is not available`)}try{return this.getOrInitializeService({instanceIdentifier:s})}catch(c){if(i)return null;throw c}}getComponent(){return this.component}setComponent(t){if(t.name!==this.name)throw Error(`Mismatching Component ${t.name} for Provider ${this.name}.`);if(this.component)throw Error(`Component for ${this.name} has already been provided`);if(this.component=t,this.shouldAutoInitialize()){if(Rc(t))try{this.getOrInitializeService({instanceIdentifier:Pc})}catch(c){}for(const[t,e]of this.instancesDeferred.entries()){const s=this.normalizeInstanceIdentifier(t);try{const t=this.getOrInitializeService({instanceIdentifier:s});e.resolve(t)}catch(c){}}}}clearInstance(t=Pc){this.instancesDeferred.delete(t),this.instancesOptions.delete(t),this.instances.delete(t)}async delete(){const t=Array.from(this.instances.values());await Promise.all([...t.filter((t=>"INTERNAL"in t)).map((t=>t.INTERNAL.delete())),...t.filter((t=>"_delete"in t)).map((t=>t._delete()))])}isComponentSet(){return null!=this.component}isInitialized(t=Pc){return this.instances.has(t)}getOptions(t=Pc){return this.instancesOptions.get(t)||{}}initialize(t={}){const{options:e={}}=t,s=this.normalizeInstanceIdentifier(t.instanceIdentifier);if(this.isInitialized(s))throw Error(`${this.name}(${s}) has already been initialized`);if(!this.isComponentSet())throw Error(`Component ${this.name} has not been registered yet`);const i=this.getOrInitializeService({instanceIdentifier:s,options:e});for(const[n,r]of this.instancesDeferred.entries()){const t=this.normalizeInstanceIdentifier(n);s===t&&r.resolve(i)}return i}onInit(t,e){var s;const i=this.normalizeInstanceIdentifier(e),n=null!==(s=this.onInitCallbacks.get(i))&&void 0!==s?s:new Set;n.add(t),this.onInitCallbacks.set(i,n);const r=this.instances.get(i);return r&&t(r,i),()=>{n.delete(t)}}invokeOnInitCallbacks(t,e){const s=this.onInitCallbacks.get(e);if(s)for(const i of s)try{i(t,e)}catch(Ca){}}getOrInitializeService({instanceIdentifier:t,options:e={}}){let s=this.instances.get(t);if(!s&&this.component&&(s=this.component.instanceFactory(this.container,{instanceIdentifier:Mc(t),options:e}),this.instances.set(t,s),this.instancesOptions.set(t,e),this.invokeOnInitCallbacks(s,t),this.component.onInstanceCreated))try{this.component.onInstanceCreated(this.container,t,s)}catch(Ca){}return s||null}normalizeInstanceIdentifier(t=Pc){return this.component?this.component.multipleInstances?t:Pc:t}shouldAutoInitialize(){return!!this.component&&"EXPLICIT"!==this.component.instantiationMode}}function Mc(t){return t===Pc?void 0:t}function Rc(t){return"EAGER"===t.instantiationMode}
/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Fc{constructor(t){this.name=t,this.providers=new Map}addComponent(t){const e=this.getProvider(t.name);if(e.isComponentSet())throw new Error(`Component ${t.name} has already been registered with ${this.name}`);e.setComponent(t)}addOrOverwriteComponent(t){const e=this.getProvider(t.name);e.isComponentSet()&&this.providers.delete(t.name),this.addComponent(t)}getProvider(t){if(this.providers.has(t))return this.providers.get(t);const e=new Ic(t,this);return this.providers.set(t,e),e}getProviders(){return Array.from(this.providers.values())}}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
const Lc=[];var jc;(function(t){t[t["DEBUG"]=0]="DEBUG",t[t["VERBOSE"]=1]="VERBOSE",t[t["INFO"]=2]="INFO",t[t["WARN"]=3]="WARN",t[t["ERROR"]=4]="ERROR",t[t["SILENT"]=5]="SILENT"})(jc||(jc={}));const Nc={debug:jc.DEBUG,verbose:jc.VERBOSE,info:jc.INFO,warn:jc.WARN,error:jc.ERROR,silent:jc.SILENT},Bc=jc.INFO,Wc={[jc.DEBUG]:"log",[jc.VERBOSE]:"log",[jc.INFO]:"info",[jc.WARN]:"warn",[jc.ERROR]:"error"},Uc=(t,e,...s)=>{if(e<t.logLevel)return;const i=(new Date).toISOString(),n=Wc[e];if(!n)throw new Error(`Attempted to log a message with an invalid logType (value: ${e})`);console[n](`[${i}]  ${t.name}:`,...s)};class Yc{constructor(t){this.name=t,this._logLevel=Bc,this._logHandler=Uc,this._userLogHandler=null,Lc.push(this)}get logLevel(){return this._logLevel}set logLevel(t){if(!(t in jc))throw new TypeError(`Invalid value "${t}" assigned to \`logLevel\``);this._logLevel=t}setLogLevel(t){this._logLevel="string"===typeof t?Nc[t]:t}get logHandler(){return this._logHandler}set logHandler(t){if("function"!==typeof t)throw new TypeError("Value assigned to `logHandler` must be a function");this._logHandler=t}get userLogHandler(){return this._userLogHandler}set userLogHandler(t){this._userLogHandler=t}debug(...t){this._userLogHandler&&this._userLogHandler(this,jc.DEBUG,...t),this._logHandler(this,jc.DEBUG,...t)}log(...t){this._userLogHandler&&this._userLogHandler(this,jc.VERBOSE,...t),this._logHandler(this,jc.VERBOSE,...t)}info(...t){this._userLogHandler&&this._userLogHandler(this,jc.INFO,...t),this._logHandler(this,jc.INFO,...t)}warn(...t){this._userLogHandler&&this._userLogHandler(this,jc.WARN,...t),this._logHandler(this,jc.WARN,...t)}error(...t){this._userLogHandler&&this._userLogHandler(this,jc.ERROR,...t),this._logHandler(this,jc.ERROR,...t)}}const Xc=(t,e)=>e.some((e=>t instanceof e));let Vc,Gc;function Hc(){return Vc||(Vc=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction])}function zc(){return Gc||(Gc=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])}const qc=new WeakMap,Kc=new WeakMap,Qc=new WeakMap,Jc=new WeakMap,Zc=new WeakMap;function $c(t){const e=new Promise(((e,s)=>{const i=()=>{t.removeEventListener("success",n),t.removeEventListener("error",r)},n=()=>{e(rl(t.result)),i()},r=()=>{s(t.error),i()};t.addEventListener("success",n),t.addEventListener("error",r)}));return e.then((e=>{e instanceof IDBCursor&&qc.set(e,t)})).catch((()=>{})),Zc.set(e,t),e}function tl(t){if(Kc.has(t))return;const e=new Promise(((e,s)=>{const i=()=>{t.removeEventListener("complete",n),t.removeEventListener("error",r),t.removeEventListener("abort",r)},n=()=>{e(),i()},r=()=>{s(t.error||new DOMException("AbortError","AbortError")),i()};t.addEventListener("complete",n),t.addEventListener("error",r),t.addEventListener("abort",r)}));Kc.set(t,e)}let el={get(t,e,s){if(t instanceof IDBTransaction){if("done"===e)return Kc.get(t);if("objectStoreNames"===e)return t.objectStoreNames||Qc.get(t);if("store"===e)return s.objectStoreNames[1]?void 0:s.objectStore(s.objectStoreNames[0])}return rl(t[e])},set(t,e,s){return t[e]=s,!0},has(t,e){return t instanceof IDBTransaction&&("done"===e||"store"===e)||e in t}};function sl(t){el=t(el)}function il(t){return t!==IDBDatabase.prototype.transaction||"objectStoreNames"in IDBTransaction.prototype?zc().includes(t)?function(...e){return t.apply(ol(this),e),rl(qc.get(this))}:function(...e){return rl(t.apply(ol(this),e))}:function(e,...s){const i=t.call(ol(this),e,...s);return Qc.set(i,e.sort?e.sort():[e]),rl(i)}}function nl(t){return"function"===typeof t?il(t):(t instanceof IDBTransaction&&tl(t),Xc(t,Hc())?new Proxy(t,el):t)}function rl(t){if(t instanceof IDBRequest)return $c(t);if(Jc.has(t))return Jc.get(t);const e=nl(t);return e!==t&&(Jc.set(t,e),Zc.set(e,t)),e}const ol=t=>Zc.get(t);function al(t,e,{blocked:s,upgrade:i,blocking:n,terminated:r}={}){const o=indexedDB.open(t,e),a=rl(o);return i&&o.addEventListener("upgradeneeded",(t=>{i(rl(o.result),t.oldVersion,t.newVersion,rl(o.transaction),t)})),s&&o.addEventListener("blocked",(t=>s(t.oldVersion,t.newVersion,t))),a.then((t=>{r&&t.addEventListener("close",(()=>r())),n&&t.addEventListener("versionchange",(t=>n(t.oldVersion,t.newVersion,t)))})).catch((()=>{})),a}const hl=["get","getKey","getAll","getAllKeys","count"],cl=["put","add","delete","clear"],ll=new Map;function ul(t,e){if(!(t instanceof IDBDatabase)||e in t||"string"!==typeof e)return;if(ll.get(e))return ll.get(e);const s=e.replace(/FromIndex$/,""),i=e!==s,n=cl.includes(s);if(!(s in(i?IDBIndex:IDBObjectStore).prototype)||!n&&!hl.includes(s))return;const r=async function(t,...e){const r=this.transaction(t,n?"readwrite":"readonly");let o=r.store;return i&&(o=o.index(e.shift())),(await Promise.all([o[s](...e),n&&r.done]))[0]};return ll.set(e,r),r}sl((t=>({...t,get:(e,s,i)=>ul(e,s)||t.get(e,s,i),has:(e,s)=>!!ul(e,s)||t.has(e,s)})));
/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
class dl{constructor(t){this.container=t}getPlatformInfoString(){const t=this.container.getProviders();return t.map((t=>{if(gl(t)){const e=t.getImmediate();return`${e.library}/${e.version}`}return null})).filter((t=>t)).join(" ")}}function gl(t){const e=t.getComponent();return"VERSION"===(null===e||void 0===e?void 0:e.type)}const pl="@firebase/app",fl="0.13.1",ml=new Yc("@firebase/app"),_l="@firebase/app-compat",vl="@firebase/analytics-compat",yl="@firebase/analytics",Cl="@firebase/app-check-compat",bl="@firebase/app-check",wl="@firebase/auth",xl="@firebase/auth-compat",Sl="@firebase/database",Tl="@firebase/data-connect",kl="@firebase/database-compat",Al="@firebase/functions",El="@firebase/functions-compat",Ol="@firebase/installations",Dl="@firebase/installations-compat",Pl="@firebase/messaging",Il="@firebase/messaging-compat",Ml="@firebase/performance",Rl="@firebase/performance-compat",Fl="@firebase/remote-config",Ll="@firebase/remote-config-compat",jl="@firebase/storage",Nl="@firebase/storage-compat",Bl="@firebase/firestore",Wl="@firebase/ai",Ul="@firebase/firestore-compat",Yl="firebase",Xl="11.9.0",Vl="[DEFAULT]",Gl={[pl]:"fire-core",[_l]:"fire-core-compat",[yl]:"fire-analytics",[vl]:"fire-analytics-compat",[bl]:"fire-app-check",[Cl]:"fire-app-check-compat",[wl]:"fire-auth",[xl]:"fire-auth-compat",[Sl]:"fire-rtdb",[Tl]:"fire-data-connect",[kl]:"fire-rtdb-compat",[Al]:"fire-fn",[El]:"fire-fn-compat",[Ol]:"fire-iid",[Dl]:"fire-iid-compat",[Pl]:"fire-fcm",[Il]:"fire-fcm-compat",[Ml]:"fire-perf",[Rl]:"fire-perf-compat",[Fl]:"fire-rc",[Ll]:"fire-rc-compat",[jl]:"fire-gcs",[Nl]:"fire-gcs-compat",[Bl]:"fire-fst",[Ul]:"fire-fst-compat",[Wl]:"fire-vertex","fire-js":"fire-js",[Yl]:"fire-js-all"},Hl=new Map,zl=new Map,ql=new Map;function Kl(t,e){try{t.container.addComponent(e)}catch(c){ml.debug(`Component ${e.name} failed to register with FirebaseApp ${t.name}`,c)}}function Ql(t){const e=t.name;if(ql.has(e))return ml.debug(`There were multiple attempts to register component ${e}.`),!1;ql.set(e,t);for(const s of Hl.values())Kl(s,t);for(const s of zl.values())Kl(s,t);return!0}function Jl(t,e){const s=t.container.getProvider("heartbeat").getImmediate({optional:!0});return s&&s.triggerHeartbeat(),t.container.getProvider(e)}function Zl(t){return null!==t&&void 0!==t&&void 0!==t.settings}
/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
const $l={["no-app"]:"No Firebase App '{$appName}' has been created - call initializeApp() first",["bad-app-name"]:"Illegal App name: '{$appName}'",["duplicate-app"]:"Firebase App named '{$appName}' already exists with different options or config",["app-deleted"]:"Firebase App named '{$appName}' already deleted",["server-app-deleted"]:"Firebase Server App has been deleted",["no-options"]:"Need to provide options, when not being deployed to hosting via source.",["invalid-app-argument"]:"firebase.{$appName}() takes either no argument or a Firebase App instance.",["invalid-log-argument"]:"First argument to `onLog` must be null or a function.",["idb-open"]:"Error thrown when opening IndexedDB. Original error: {$originalErrorMessage}.",["idb-get"]:"Error thrown when reading from IndexedDB. Original error: {$originalErrorMessage}.",["idb-set"]:"Error thrown when writing to IndexedDB. Original error: {$originalErrorMessage}.",["idb-delete"]:"Error thrown when deleting from IndexedDB. Original error: {$originalErrorMessage}.",["finalization-registry-not-supported"]:"FirebaseServerApp deleteOnDeref field defined but the JS runtime does not support FinalizationRegistry.",["invalid-server-app-environment"]:"FirebaseServerApp is not for use in browser environments."},tu=new lc("app","Firebase",$l);
/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
class eu{constructor(t,e,s){this._isDeleted=!1,this._options=Object.assign({},t),this._config=Object.assign({},e),this._name=e.name,this._automaticDataCollectionEnabled=e.automaticDataCollectionEnabled,this._container=s,this.container.addComponent(new Dc("app",(()=>this),"PUBLIC"))}get automaticDataCollectionEnabled(){return this.checkDestroyed(),this._automaticDataCollectionEnabled}set automaticDataCollectionEnabled(t){this.checkDestroyed(),this._automaticDataCollectionEnabled=t}get name(){return this.checkDestroyed(),this._name}get options(){return this.checkDestroyed(),this._options}get config(){return this.checkDestroyed(),this._config}get container(){return this._container}get isDeleted(){return this._isDeleted}set isDeleted(t){this._isDeleted=t}checkDestroyed(){if(this.isDeleted)throw tu.create("app-deleted",{appName:this._name})}}
/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
const su=Xl;function iu(t,e={}){let s=t;if("object"!==typeof e){const t=e;e={name:t}}const i=Object.assign({name:Vl,automaticDataCollectionEnabled:!0},e),n=i.name;if("string"!==typeof n||!n)throw tu.create("bad-app-name",{appName:String(n)});if(s||(s=Hh()),!s)throw tu.create("no-options");const r=Hl.get(n);if(r){if(wc(s,r.options)&&wc(i,r.config))return r;throw tu.create("duplicate-app",{appName:n})}const o=new Fc(n);for(const h of ql.values())o.addComponent(h);const a=new eu(s,i,o);return Hl.set(n,a),a}function nu(t=Vl){const e=Hl.get(t);if(!e&&t===Vl&&Hh())return iu();if(!e)throw tu.create("no-app",{appName:t});return e}function ru(t,e,s){var i;let n=null!==(i=Gl[t])&&void 0!==i?i:t;s&&(n+=`-${s}`);const r=n.match(/\s|\//),o=e.match(/\s|\//);if(r||o){const t=[`Unable to register library "${n}" with version "${e}":`];return r&&t.push(`library name "${n}" contains illegal characters (whitespace or "/")`),r&&o&&t.push("and"),o&&t.push(`version name "${e}" contains illegal characters (whitespace or "/")`),void ml.warn(t.join(" "))}Ql(new Dc(`${n}-version`,(()=>({library:n,version:e})),"VERSION"))}
/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
const ou="firebase-heartbeat-database",au=1,hu="firebase-heartbeat-store";let cu=null;function lu(){return cu||(cu=al(ou,au,{upgrade:(t,e)=>{switch(e){case 0:try{t.createObjectStore(hu)}catch(c){console.warn(c)}}}}).catch((t=>{throw tu.create("idb-open",{originalErrorMessage:t.message})}))),cu}async function uu(t){try{const e=await lu(),s=e.transaction(hu),i=await s.objectStore(hu).get(gu(t));return await s.done,i}catch(c){if(c instanceof cc)ml.warn(c.message);else{const e=tu.create("idb-get",{originalErrorMessage:null===c||void 0===c?void 0:c.message});ml.warn(e.message)}}}async function du(t,e){try{const s=await lu(),i=s.transaction(hu,"readwrite"),n=i.objectStore(hu);await n.put(e,gu(t)),await i.done}catch(c){if(c instanceof cc)ml.warn(c.message);else{const e=tu.create("idb-set",{originalErrorMessage:null===c||void 0===c?void 0:c.message});ml.warn(e.message)}}}function gu(t){return`${t.name}!${t.options.appId}`}
/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const pu=1024,fu=30;class mu{constructor(t){this.container=t,this._heartbeatsCache=null;const e=this.container.getProvider("app").getImmediate();this._storage=new yu(e),this._heartbeatsCachePromise=this._storage.read().then((t=>(this._heartbeatsCache=t,t)))}async triggerHeartbeat(){var t,e;try{const s=this.container.getProvider("platform-logger").getImmediate(),i=s.getPlatformInfoString(),n=_u();if(null==(null===(t=this._heartbeatsCache)||void 0===t?void 0:t.heartbeats)&&(this._heartbeatsCache=await this._heartbeatsCachePromise,null==(null===(e=this._heartbeatsCache)||void 0===e?void 0:e.heartbeats)))return;if(this._heartbeatsCache.lastSentHeartbeatDate===n||this._heartbeatsCache.heartbeats.some((t=>t.date===n)))return;if(this._heartbeatsCache.heartbeats.push({date:n,agent:i}),this._heartbeatsCache.heartbeats.length>fu){const t=bu(this._heartbeatsCache.heartbeats);this._heartbeatsCache.heartbeats.splice(t,1)}return this._storage.overwrite(this._heartbeatsCache)}catch(c){ml.warn(c)}}async getHeartbeatsHeader(){var t;try{if(null===this._heartbeatsCache&&await this._heartbeatsCachePromise,null==(null===(t=this._heartbeatsCache)||void 0===t?void 0:t.heartbeats)||0===this._heartbeatsCache.heartbeats.length)return"";const e=_u(),{heartbeatsToSend:s,unsentEntries:i}=vu(this._heartbeatsCache.heartbeats),n=Rh(JSON.stringify({version:2,heartbeats:s}));return this._heartbeatsCache.lastSentHeartbeatDate=e,i.length>0?(this._heartbeatsCache.heartbeats=i,await this._storage.overwrite(this._heartbeatsCache)):(this._heartbeatsCache.heartbeats=[],this._storage.overwrite(this._heartbeatsCache)),n}catch(c){return ml.warn(c),""}}}function _u(){const t=new Date;return t.toISOString().substring(0,10)}function vu(t,e=pu){const s=[];let i=t.slice();for(const n of t){const t=s.find((t=>t.agent===n.agent));if(t){if(t.dates.push(n.date),Cu(s)>e){t.dates.pop();break}}else if(s.push({agent:n.agent,dates:[n.date]}),Cu(s)>e){s.pop();break}i=i.slice(1)}return{heartbeatsToSend:s,unsentEntries:i}}class yu{constructor(t){this.app=t,this._canUseIndexedDBPromise=this.runIndexedDBEnvironmentCheck()}async runIndexedDBEnvironmentCheck(){return!!oc()&&ac().then((()=>!0)).catch((()=>!1))}async read(){const t=await this._canUseIndexedDBPromise;if(t){const t=await uu(this.app);return(null===t||void 0===t?void 0:t.heartbeats)?t:{heartbeats:[]}}return{heartbeats:[]}}async overwrite(t){var e;const s=await this._canUseIndexedDBPromise;if(s){const s=await this.read();return du(this.app,{lastSentHeartbeatDate:null!==(e=t.lastSentHeartbeatDate)&&void 0!==e?e:s.lastSentHeartbeatDate,heartbeats:t.heartbeats})}}async add(t){var e;const s=await this._canUseIndexedDBPromise;if(s){const s=await this.read();return du(this.app,{lastSentHeartbeatDate:null!==(e=t.lastSentHeartbeatDate)&&void 0!==e?e:s.lastSentHeartbeatDate,heartbeats:[...s.heartbeats,...t.heartbeats]})}}}function Cu(t){return Rh(JSON.stringify({version:2,heartbeats:t})).length}function bu(t){if(0===t.length)return-1;let e=0,s=t[0].date;for(let i=1;i<t.length;i++)t[i].date<s&&(s=t[i].date,e=i);return e}
/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function wu(t){Ql(new Dc("platform-logger",(t=>new dl(t)),"PRIVATE")),Ql(new Dc("heartbeat",(t=>new mu(t)),"PRIVATE")),ru(pl,fl,t),ru(pl,fl,"esm2017"),ru("fire-js","")}wu("");var xu="firebase",Su="11.9.1";
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
ru(xu,Su,"app");const Tu="@firebase/database",ku="1.0.19";
/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let Au="";function Eu(t){Au=t}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ou{constructor(t){this.domStorage_=t,this.prefix_="firebase:"}set(t,e){null==e?this.domStorage_.removeItem(this.prefixedName_(t)):this.domStorage_.setItem(this.prefixedName_(t),pc(e))}get(t){const e=this.domStorage_.getItem(this.prefixedName_(t));return null==e?null:gc(e)}remove(t){this.domStorage_.removeItem(this.prefixedName_(t))}prefixedName_(t){return this.prefix_+t}toString(){return this.domStorage_.toString()}}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Du{constructor(){this.cache_={},this.isInMemoryStorage=!0}set(t,e){null==e?delete this.cache_[t]:this.cache_[t]=e}get(t){return vc(this.cache_,t)?this.cache_[t]:null}remove(t){delete this.cache_[t]}}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Pu=function(t){try{if("undefined"!==typeof window&&"undefined"!==typeof window[t]){const e=window[t];return e.setItem("firebase:sentinel","cache"),e.removeItem("firebase:sentinel"),new Ou(e)}}catch(c){}return new Du},Iu=Pu("localStorage"),Mu=Pu("sessionStorage"),Ru=new Yc("@firebase/database"),Fu=function(){let t=1;return function(){return t++}}(),Lu=function(t){const e=Ac(t),s=new Tc;s.update(e);const i=s.digest();return Ph.encodeByteArray(i)},ju=function(...t){let e="";for(let s=0;s<t.length;s++){const i=t[s];Array.isArray(i)||i&&"object"===typeof i&&"number"===typeof i.length?e+=ju.apply(null,i):e+="object"===typeof i?pc(i):i,e+=" "}return e};let Nu=null,Bu=!0;const Wu=function(t,e){Ah(!e||!0===t||!1===t,"Can't turn on custom loggers persistently."),!0===t?(Ru.logLevel=jc.VERBOSE,Nu=Ru.log.bind(Ru),e&&Mu.set("logging_enabled",!0)):"function"===typeof t?Nu=t:(Nu=null,Mu.remove("logging_enabled"))},Uu=function(...t){if(!0===Bu&&(Bu=!1,null===Nu&&!0===Mu.get("logging_enabled")&&Wu(!0)),Nu){const e=ju.apply(null,t);Nu(e)}},Yu=function(t){return function(...e){Uu(t,...e)}},Xu=function(...t){const e="FIREBASE INTERNAL ERROR: "+ju(...t);Ru.error(e)},Vu=function(...t){const e=`FIREBASE FATAL ERROR: ${ju(...t)}`;throw Ru.error(e),new Error(e)},Gu=function(...t){const e="FIREBASE WARNING: "+ju(...t);Ru.warn(e)},Hu=function(){"undefined"!==typeof window&&window.location&&window.location.protocol&&-1!==window.location.protocol.indexOf("https:")&&Gu("Insecure Firebase access from a secure page. Please use https in calls to new Firebase().")},zu=function(t){return"number"===typeof t&&(t!==t||t===Number.POSITIVE_INFINITY||t===Number.NEGATIVE_INFINITY)},qu=function(t){if(rc()||"complete"===document.readyState)t();else{let e=!1;const s=function(){document.body?e||(e=!0,t()):setTimeout(s,Math.floor(10))};document.addEventListener?(document.addEventListener("DOMContentLoaded",s,!1),window.addEventListener("load",s,!1)):document.attachEvent&&(document.attachEvent("onreadystatechange",(()=>{"complete"===document.readyState&&s()})),window.attachEvent("onload",s))}},Ku="[MIN_NAME]",Qu="[MAX_NAME]",Ju=function(t,e){if(t===e)return 0;if(t===Ku||e===Qu)return-1;if(e===Ku||t===Qu)return 1;{const s=cd(t),i=cd(e);return null!==s?null!==i?s-i===0?t.length-e.length:s-i:-1:null!==i?1:t<e?-1:1}},Zu=function(t,e){return t===e?0:t<e?-1:1},$u=function(t,e){if(e&&t in e)return e[t];throw new Error("Missing required key ("+t+") in object: "+pc(e))},td=function(t){if("object"!==typeof t||null===t)return pc(t);const e=[];for(const i in t)e.push(i);e.sort();let s="{";for(let i=0;i<e.length;i++)0!==i&&(s+=","),s+=pc(e[i]),s+=":",s+=td(t[e[i]]);return s+="}",s},ed=function(t,e){const s=t.length;if(s<=e)return[t];const i=[];for(let n=0;n<s;n+=e)n+e>s?i.push(t.substring(n,s)):i.push(t.substring(n,n+e));return i};function sd(t,e){for(const s in t)t.hasOwnProperty(s)&&e(s,t[s])}const id=function(t){Ah(!zu(t),"Invalid JSON number");const e=11,s=52,i=(1<<e-1)-1;let n,r,o,a,h;0===t?(r=0,o=0,n=1/t===-1/0?1:0):(n=t<0,t=Math.abs(t),t>=Math.pow(2,1-i)?(a=Math.min(Math.floor(Math.log(t)/Math.LN2),i),r=a+i,o=Math.round(t*Math.pow(2,s-a)-Math.pow(2,s))):(r=0,o=Math.round(t/Math.pow(2,1-i-s))));const c=[];for(h=s;h;h-=1)c.push(o%2?1:0),o=Math.floor(o/2);for(h=e;h;h-=1)c.push(r%2?1:0),r=Math.floor(r/2);c.push(n?1:0),c.reverse();const l=c.join("");let u="";for(h=0;h<64;h+=8){let t=parseInt(l.substr(h,8),2).toString(16);1===t.length&&(t="0"+t),u+=t}return u.toLowerCase()},nd=function(){return!("object"!==typeof window||!window["chrome"]||!window["chrome"]["extension"]||/^chrome/.test(window.location.href))},rd=function(){return"object"===typeof Windows&&"object"===typeof Windows.UI};const od=new RegExp("^-?(0*)\\d{1,10}$"),ad=-2147483648,hd=2147483647,cd=function(t){if(od.test(t)){const e=Number(t);if(e>=ad&&e<=hd)return e}return null},ld=function(t){try{t()}catch(c){setTimeout((()=>{const e=c.stack||"";throw Gu("Exception was thrown by user callback.",e),c}),Math.floor(0))}},ud=function(){const t="object"===typeof window&&window["navigator"]&&window["navigator"]["userAgent"]||"";return t.search(/googlebot|google webmaster tools|bingbot|yahoo! slurp|baiduspider|yandexbot|duckduckbot/i)>=0},dd=function(t,e){const s=setTimeout(t,e);return"number"===typeof s&&"undefined"!==typeof Deno&&Deno["unrefTimer"]?Deno.unrefTimer(s):"object"===typeof s&&s["unref"]&&s["unref"](),s};
/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
class gd{constructor(t,e){this.appCheckProvider=e,this.appName=t.name,Zl(t)&&t.settings.appCheckToken&&(this.serverAppAppCheckToken=t.settings.appCheckToken),this.appCheck=null===e||void 0===e?void 0:e.getImmediate({optional:!0}),this.appCheck||null===e||void 0===e||e.get().then((t=>this.appCheck=t))}getToken(t){if(this.serverAppAppCheckToken){if(t)throw new Error("Attempted reuse of `FirebaseServerApp.appCheckToken` after previous usage failed.");return Promise.resolve({token:this.serverAppAppCheckToken})}return this.appCheck?this.appCheck.getToken(t):new Promise(((e,s)=>{setTimeout((()=>{this.appCheck?this.getToken(t).then(e,s):e(null)}),0)}))}addTokenChangeListener(t){var e;null===(e=this.appCheckProvider)||void 0===e||e.get().then((e=>e.addTokenListener(t)))}notifyForInvalidToken(){Gu(`Provided AppCheck credentials for the app named "${this.appName}" are invalid. This usually indicates your app was not initialized correctly.`)}}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class pd{constructor(t,e,s){this.appName_=t,this.firebaseOptions_=e,this.authProvider_=s,this.auth_=null,this.auth_=s.getImmediate({optional:!0}),this.auth_||s.onInit((t=>this.auth_=t))}getToken(t){return this.auth_?this.auth_.getToken(t).catch((t=>t&&"auth/token-not-initialized"===t.code?(Uu("Got auth/token-not-initialized error.  Treating as null token."),null):Promise.reject(t))):new Promise(((e,s)=>{setTimeout((()=>{this.auth_?this.getToken(t).then(e,s):e(null)}),0)}))}addTokenChangeListener(t){this.auth_?this.auth_.addAuthTokenListener(t):this.authProvider_.get().then((e=>e.addAuthTokenListener(t)))}removeTokenChangeListener(t){this.authProvider_.get().then((e=>e.removeAuthTokenListener(t)))}notifyForInvalidToken(){let t='Provided authentication credentials for the app named "'+this.appName_+'" are invalid. This usually indicates your app was not initialized correctly. ';"credential"in this.firebaseOptions_?t+='Make sure the "credential" property provided to initializeApp() is authorized to access the specified "databaseURL" and is from the correct project.':"serviceAccount"in this.firebaseOptions_?t+='Make sure the "serviceAccount" property provided to initializeApp() is authorized to access the specified "databaseURL" and is from the correct project.':t+='Make sure the "apiKey" and "databaseURL" properties provided to initializeApp() match the values provided for your app at https://console.firebase.google.com/.',Gu(t)}}class fd{constructor(t){this.accessToken=t}getToken(t){return Promise.resolve({accessToken:this.accessToken})}addTokenChangeListener(t){t(this.accessToken)}removeTokenChangeListener(t){}notifyForInvalidToken(){}}fd.OWNER="owner";
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
const md="5",_d="v",vd="s",yd="r",Cd="f",bd=/(console\.firebase|firebase-console-\w+\.corp|firebase\.corp)\.google\.com/,wd="ls",xd="p",Sd="ac",Td="websocket",kd="long_polling";
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
class Ad{constructor(t,e,s,i,n=!1,r="",o=!1,a=!1,h=null){this.secure=e,this.namespace=s,this.webSocketOnly=i,this.nodeAdmin=n,this.persistenceKey=r,this.includeNamespaceInQueryParams=o,this.isUsingEmulator=a,this.emulatorOptions=h,this._host=t.toLowerCase(),this._domain=this._host.substr(this._host.indexOf(".")+1),this.internalHost=Iu.get("host:"+t)||this._host}isCacheableHost(){return"s-"===this.internalHost.substr(0,2)}isCustomHost(){return"firebaseio.com"!==this._domain&&"firebaseio-demo.com"!==this._domain}get host(){return this._host}set host(t){t!==this.internalHost&&(this.internalHost=t,this.isCacheableHost()&&Iu.set("host:"+this._host,this.internalHost))}toString(){let t=this.toURLString();return this.persistenceKey&&(t+="<"+this.persistenceKey+">"),t}toURLString(){const t=this.secure?"https://":"http://",e=this.includeNamespaceInQueryParams?`?ns=${this.namespace}`:"";return`${t}${this.host}/${e}`}}function Ed(t){return t.host!==t.internalHost||t.isCustomHost()||t.includeNamespaceInQueryParams}function Od(t,e,s){let i;if(Ah("string"===typeof e,"typeof type must == string"),Ah("object"===typeof s,"typeof params must == object"),e===Td)i=(t.secure?"wss://":"ws://")+t.internalHost+"/.ws?";else{if(e!==kd)throw new Error("Unknown connection type: "+e);i=(t.secure?"https://":"http://")+t.internalHost+"/.lp?"}Ed(t)&&(s["ns"]=t.namespace);const n=[];return sd(s,((t,e)=>{n.push(t+"="+e)})),i+n.join("&")}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Dd{constructor(){this.counters_={}}incrementCounter(t,e=1){vc(this.counters_,t)||(this.counters_[t]=0),this.counters_[t]+=e}get(){return Lh(this.counters_)}}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Pd={},Id={};function Md(t){const e=t.toString();return Pd[e]||(Pd[e]=new Dd),Pd[e]}function Rd(t,e){const s=t.toString();return Id[s]||(Id[s]=e()),Id[s]}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Fd{constructor(t){this.onMessage_=t,this.pendingResponses=[],this.currentResponseNum=0,this.closeAfterResponse=-1,this.onClose=null}closeAfter(t,e){this.closeAfterResponse=t,this.onClose=e,this.closeAfterResponse<this.currentResponseNum&&(this.onClose(),this.onClose=null)}handleResponse(t,e){this.pendingResponses[t]=e;while(this.pendingResponses[this.currentResponseNum]){const t=this.pendingResponses[this.currentResponseNum];delete this.pendingResponses[this.currentResponseNum];for(let e=0;e<t.length;++e)t[e]&&ld((()=>{this.onMessage_(t[e])}));if(this.currentResponseNum===this.closeAfterResponse){this.onClose&&(this.onClose(),this.onClose=null);break}this.currentResponseNum++}}}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Ld="start",jd="close",Nd="pLPCommand",Bd="pRTLPCB",Wd="id",Ud="pw",Yd="ser",Xd="cb",Vd="seg",Gd="ts",Hd="d",zd="dframe",qd=1870,Kd=30,Qd=qd-Kd,Jd=25e3,Zd=3e4;class $d{constructor(t,e,s,i,n,r,o){this.connId=t,this.repoInfo=e,this.applicationId=s,this.appCheckToken=i,this.authToken=n,this.transportSessionId=r,this.lastSessionId=o,this.bytesSent=0,this.bytesReceived=0,this.everConnected_=!1,this.log_=Yu(t),this.stats_=Md(e),this.urlFn=t=>(this.appCheckToken&&(t[Sd]=this.appCheckToken),Od(e,kd,t))}open(t,e){this.curSegmentNum=0,this.onDisconnect_=e,this.myPacketOrderer=new Fd(t),this.isClosed_=!1,this.connectTimeoutTimer_=setTimeout((()=>{this.log_("Timed out trying to connect."),this.onClosed_(),this.connectTimeoutTimer_=null}),Math.floor(Zd)),qu((()=>{if(this.isClosed_)return;this.scriptTagHolder=new tg(((...t)=>{const[e,s,i,n,r]=t;if(this.incrementIncomingBytes_(t),this.scriptTagHolder)if(this.connectTimeoutTimer_&&(clearTimeout(this.connectTimeoutTimer_),this.connectTimeoutTimer_=null),this.everConnected_=!0,e===Ld)this.id=s,this.password=i;else{if(e!==jd)throw new Error("Unrecognized command received: "+e);s?(this.scriptTagHolder.sendNewPolls=!1,this.myPacketOrderer.closeAfter(s,(()=>{this.onClosed_()}))):this.onClosed_()}}),((...t)=>{const[e,s]=t;this.incrementIncomingBytes_(t),this.myPacketOrderer.handleResponse(e,s)}),(()=>{this.onClosed_()}),this.urlFn);const t={};t[Ld]="t",t[Yd]=Math.floor(1e8*Math.random()),this.scriptTagHolder.uniqueCallbackIdentifier&&(t[Xd]=this.scriptTagHolder.uniqueCallbackIdentifier),t[_d]=md,this.transportSessionId&&(t[vd]=this.transportSessionId),this.lastSessionId&&(t[wd]=this.lastSessionId),this.applicationId&&(t[xd]=this.applicationId),this.appCheckToken&&(t[Sd]=this.appCheckToken),"undefined"!==typeof location&&location.hostname&&bd.test(location.hostname)&&(t[yd]=Cd);const e=this.urlFn(t);this.log_("Connecting via long-poll to "+e),this.scriptTagHolder.addTag(e,(()=>{}))}))}start(){this.scriptTagHolder.startLongPoll(this.id,this.password),this.addDisconnectPingFrame(this.id,this.password)}static forceAllow(){$d.forceAllow_=!0}static forceDisallow(){$d.forceDisallow_=!0}static isAvailable(){return!rc()&&(!!$d.forceAllow_||!$d.forceDisallow_&&"undefined"!==typeof document&&null!=document.createElement&&!nd()&&!rd())}markConnectionHealthy(){}shutdown_(){this.isClosed_=!0,this.scriptTagHolder&&(this.scriptTagHolder.close(),this.scriptTagHolder=null),this.myDisconnFrame&&(document.body.removeChild(this.myDisconnFrame),this.myDisconnFrame=null),this.connectTimeoutTimer_&&(clearTimeout(this.connectTimeoutTimer_),this.connectTimeoutTimer_=null)}onClosed_(){this.isClosed_||(this.log_("Longpoll is closing itself"),this.shutdown_(),this.onDisconnect_&&(this.onDisconnect_(this.everConnected_),this.onDisconnect_=null))}close(){this.isClosed_||(this.log_("Longpoll is being closed."),this.shutdown_())}send(t){const e=pc(t);this.bytesSent+=e.length,this.stats_.incrementCounter("bytes_sent",e.length);const s=Mh(e),i=ed(s,Qd);for(let n=0;n<i.length;n++)this.scriptTagHolder.enqueueSegment(this.curSegmentNum,i.length,i[n]),this.curSegmentNum++}addDisconnectPingFrame(t,e){if(rc())return;this.myDisconnFrame=document.createElement("iframe");const s={};s[zd]="t",s[Wd]=t,s[Ud]=e,this.myDisconnFrame.src=this.urlFn(s),this.myDisconnFrame.style.display="none",document.body.appendChild(this.myDisconnFrame)}incrementIncomingBytes_(t){const e=pc(t).length;this.bytesReceived+=e,this.stats_.incrementCounter("bytes_received",e)}}class tg{constructor(t,e,s,i){if(this.onDisconnect=s,this.urlFn=i,this.outstandingRequests=new Set,this.pendingSegs=[],this.currentSerial=Math.floor(1e8*Math.random()),this.sendNewPolls=!0,rc())this.commandCB=t,this.onMessageCB=e;else{this.uniqueCallbackIdentifier=Fu(),window[Nd+this.uniqueCallbackIdentifier]=t,window[Bd+this.uniqueCallbackIdentifier]=e,this.myIFrame=tg.createIFrame_();let s="";if(this.myIFrame.src&&"javascript:"===this.myIFrame.src.substr(0,11)){const t=document.domain;s='<script>document.domain="'+t+'";<\/script>'}const i="<html><body>"+s+"</body></html>";try{this.myIFrame.doc.open(),this.myIFrame.doc.write(i),this.myIFrame.doc.close()}catch(c){Uu("frame writing exception"),c.stack&&Uu(c.stack),Uu(c)}}}static createIFrame_(){const t=document.createElement("iframe");if(t.style.display="none",!document.body)throw"Document body has not initialized. Wait to initialize Firebase until after the document is ready.";document.body.appendChild(t);try{const e=t.contentWindow.document;e||Uu("No IE domain setting required")}catch(c){const s=document.domain;t.src="javascript:void((function(){document.open();document.domain='"+s+"';document.close();})())"}return t.contentDocument?t.doc=t.contentDocument:t.contentWindow?t.doc=t.contentWindow.document:t.document&&(t.doc=t.document),t}close(){this.alive=!1,this.myIFrame&&(this.myIFrame.doc.body.textContent="",setTimeout((()=>{null!==this.myIFrame&&(document.body.removeChild(this.myIFrame),this.myIFrame=null)}),Math.floor(0)));const t=this.onDisconnect;t&&(this.onDisconnect=null,t())}startLongPoll(t,e){this.myID=t,this.myPW=e,this.alive=!0;while(this.newRequest_());}newRequest_(){if(this.alive&&this.sendNewPolls&&this.outstandingRequests.size<(this.pendingSegs.length>0?2:1)){this.currentSerial++;const t={};t[Wd]=this.myID,t[Ud]=this.myPW,t[Yd]=this.currentSerial;let e=this.urlFn(t),s="",i=0;while(this.pendingSegs.length>0){const t=this.pendingSegs[0];if(!(t.d.length+Kd+s.length<=qd))break;{const t=this.pendingSegs.shift();s=s+"&"+Vd+i+"="+t.seg+"&"+Gd+i+"="+t.ts+"&"+Hd+i+"="+t.d,i++}}return e+=s,this.addLongPollTag_(e,this.currentSerial),!0}return!1}enqueueSegment(t,e,s){this.pendingSegs.push({seg:t,ts:e,d:s}),this.alive&&this.newRequest_()}addLongPollTag_(t,e){this.outstandingRequests.add(e);const s=()=>{this.outstandingRequests.delete(e),this.newRequest_()},i=setTimeout(s,Math.floor(Jd)),n=()=>{clearTimeout(i),s()};this.addTag(t,n)}addTag(t,e){rc()?this.doNodeLongPoll(t,e):setTimeout((()=>{try{if(!this.sendNewPolls)return;const s=this.myIFrame.doc.createElement("script");s.type="text/javascript",s.async=!0,s.src=t,s.onload=s.onreadystatechange=function(){const t=s.readyState;t&&"loaded"!==t&&"complete"!==t||(s.onload=s.onreadystatechange=null,s.parentNode&&s.parentNode.removeChild(s),e())},s.onerror=()=>{Uu("Long-poll script failed to load: "+t),this.sendNewPolls=!1,this.close()},this.myIFrame.doc.body.appendChild(s)}catch(c){}}),Math.floor(1))}}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const eg=16384,sg=45e3;let ig=null;"undefined"!==typeof MozWebSocket?ig=MozWebSocket:"undefined"!==typeof WebSocket&&(ig=WebSocket);class ng{constructor(t,e,s,i,n,r,o){this.connId=t,this.applicationId=s,this.appCheckToken=i,this.authToken=n,this.keepaliveTimer=null,this.frames=null,this.totalFrames=0,this.bytesSent=0,this.bytesReceived=0,this.log_=Yu(this.connId),this.stats_=Md(e),this.connURL=ng.connectionURL_(e,r,o,i,s),this.nodeAdmin=e.nodeAdmin}static connectionURL_(t,e,s,i,n){const r={};return r[_d]=md,!rc()&&"undefined"!==typeof location&&location.hostname&&bd.test(location.hostname)&&(r[yd]=Cd),e&&(r[vd]=e),s&&(r[wd]=s),i&&(r[Sd]=i),n&&(r[xd]=n),Od(t,Td,r)}open(t,e){this.onDisconnect=e,this.onMessage=t,this.log_("Websocket connecting to "+this.connURL),this.everConnected_=!1,Iu.set("previous_websocket_failure",!0);try{let t;if(rc()){const e=this.nodeAdmin?"AdminNode":"Node";t={headers:{"User-Agent":`Firebase/${md}/${Au}/${process.platform}/${e}`,"X-Firebase-GMPID":this.applicationId||""}},this.authToken&&(t.headers["Authorization"]=`Bearer ${this.authToken}`),this.appCheckToken&&(t.headers["X-Firebase-AppCheck"]=this.appCheckToken);const s={NODE_ENV:"production",BASE_URL:"/alien_mood/"},i=0===this.connURL.indexOf("wss://")?s["HTTPS_PROXY"]||s["https_proxy"]:s["HTTP_PROXY"]||s["http_proxy"];i&&(t["proxy"]={origin:i})}this.mySock=new ig(this.connURL,[],t)}catch(c){this.log_("Error instantiating WebSocket.");const e=c.message||c.data;return e&&this.log_(e),void this.onClosed_()}this.mySock.onopen=()=>{this.log_("Websocket connected."),this.everConnected_=!0},this.mySock.onclose=()=>{this.log_("Websocket connection was disconnected."),this.mySock=null,this.onClosed_()},this.mySock.onmessage=t=>{this.handleIncomingFrame(t)},this.mySock.onerror=t=>{this.log_("WebSocket error.  Closing connection.");const e=t.message||t.data;e&&this.log_(e),this.onClosed_()}}start(){}static forceDisallow(){ng.forceDisallow_=!0}static isAvailable(){let t=!1;if("undefined"!==typeof navigator&&navigator.userAgent){const e=/Android ([0-9]{0,}\.[0-9]{0,})/,s=navigator.userAgent.match(e);s&&s.length>1&&parseFloat(s[1])<4.4&&(t=!0)}return!t&&null!==ig&&!ng.forceDisallow_}static previouslyFailed(){return Iu.isInMemoryStorage||!0===Iu.get("previous_websocket_failure")}markConnectionHealthy(){Iu.remove("previous_websocket_failure")}appendFrame_(t){if(this.frames.push(t),this.frames.length===this.totalFrames){const t=this.frames.join("");this.frames=null;const e=gc(t);this.onMessage(e)}}handleNewFrameCount_(t){this.totalFrames=t,this.frames=[]}extractFrameCount_(t){if(Ah(null===this.frames,"We already have a frame buffer"),t.length<=6){const e=Number(t);if(!isNaN(e))return this.handleNewFrameCount_(e),null}return this.handleNewFrameCount_(1),t}handleIncomingFrame(t){if(null===this.mySock)return;const e=t["data"];if(this.bytesReceived+=e.length,this.stats_.incrementCounter("bytes_received",e.length),this.resetKeepAlive(),null!==this.frames)this.appendFrame_(e);else{const t=this.extractFrameCount_(e);null!==t&&this.appendFrame_(t)}}send(t){this.resetKeepAlive();const e=pc(t);this.bytesSent+=e.length,this.stats_.incrementCounter("bytes_sent",e.length);const s=ed(e,eg);s.length>1&&this.sendString_(String(s.length));for(let i=0;i<s.length;i++)this.sendString_(s[i])}shutdown_(){this.isClosed_=!0,this.keepaliveTimer&&(clearInterval(this.keepaliveTimer),this.keepaliveTimer=null),this.mySock&&(this.mySock.close(),this.mySock=null)}onClosed_(){this.isClosed_||(this.log_("WebSocket is closing itself"),this.shutdown_(),this.onDisconnect&&(this.onDisconnect(this.everConnected_),this.onDisconnect=null))}close(){this.isClosed_||(this.log_("WebSocket is being closed"),this.shutdown_())}resetKeepAlive(){clearInterval(this.keepaliveTimer),this.keepaliveTimer=setInterval((()=>{this.mySock&&this.sendString_("0"),this.resetKeepAlive()}),Math.floor(sg))}sendString_(t){try{this.mySock.send(t)}catch(c){this.log_("Exception thrown from WebSocket.send():",c.message||c.data,"Closing connection."),setTimeout(this.onClosed_.bind(this),0)}}}ng.responsesRequiredToBeHealthy=2,ng.healthyTimeout=3e4;
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
class rg{static get ALL_TRANSPORTS(){return[$d,ng]}static get IS_TRANSPORT_INITIALIZED(){return this.globalTransportInitialized_}constructor(t){this.initTransports_(t)}initTransports_(t){const e=ng&&ng["isAvailable"]();let s=e&&!ng.previouslyFailed();if(t.webSocketOnly&&(e||Gu("wss:// URL used, but browser isn't known to support websockets.  Trying anyway."),s=!0),s)this.transports_=[ng];else{const t=this.transports_=[];for(const e of rg.ALL_TRANSPORTS)e&&e["isAvailable"]()&&t.push(e);rg.globalTransportInitialized_=!0}}initialTransport(){if(this.transports_.length>0)return this.transports_[0];throw new Error("No transports available")}upgradeTransport(){return this.transports_.length>1?this.transports_[1]:null}}rg.globalTransportInitialized_=!1;
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
const og=6e4,ag=5e3,hg=10240,cg=102400,lg="t",ug="d",dg="s",gg="r",pg="e",fg="o",mg="a",_g="n",vg="p",yg="h";class Cg{constructor(t,e,s,i,n,r,o,a,h,c){this.id=t,this.repoInfo_=e,this.applicationId_=s,this.appCheckToken_=i,this.authToken_=n,this.onMessage_=r,this.onReady_=o,this.onDisconnect_=a,this.onKill_=h,this.lastSessionId=c,this.connectionCount=0,this.pendingDataMessages=[],this.state_=0,this.log_=Yu("c:"+this.id+":"),this.transportManager_=new rg(e),this.log_("Connection created"),this.start_()}start_(){const t=this.transportManager_.initialTransport();this.conn_=new t(this.nextTransportId_(),this.repoInfo_,this.applicationId_,this.appCheckToken_,this.authToken_,null,this.lastSessionId),this.primaryResponsesRequired_=t["responsesRequiredToBeHealthy"]||0;const e=this.connReceiver_(this.conn_),s=this.disconnReceiver_(this.conn_);this.tx_=this.conn_,this.rx_=this.conn_,this.secondaryConn_=null,this.isHealthy_=!1,setTimeout((()=>{this.conn_&&this.conn_.open(e,s)}),Math.floor(0));const i=t["healthyTimeout"]||0;i>0&&(this.healthyTimeout_=dd((()=>{this.healthyTimeout_=null,this.isHealthy_||(this.conn_&&this.conn_.bytesReceived>cg?(this.log_("Connection exceeded healthy timeout but has received "+this.conn_.bytesReceived+" bytes.  Marking connection healthy."),this.isHealthy_=!0,this.conn_.markConnectionHealthy()):this.conn_&&this.conn_.bytesSent>hg?this.log_("Connection exceeded healthy timeout but has sent "+this.conn_.bytesSent+" bytes.  Leaving connection alive."):(this.log_("Closing unhealthy connection after timeout."),this.close()))}),Math.floor(i)))}nextTransportId_(){return"c:"+this.id+":"+this.connectionCount++}disconnReceiver_(t){return e=>{t===this.conn_?this.onConnectionLost_(e):t===this.secondaryConn_?(this.log_("Secondary connection lost."),this.onSecondaryConnectionLost_()):this.log_("closing an old connection")}}connReceiver_(t){return e=>{2!==this.state_&&(t===this.rx_?this.onPrimaryMessageReceived_(e):t===this.secondaryConn_?this.onSecondaryMessageReceived_(e):this.log_("message on old connection"))}}sendRequest(t){const e={t:"d",d:t};this.sendData_(e)}tryCleanupConnection(){this.tx_===this.secondaryConn_&&this.rx_===this.secondaryConn_&&(this.log_("cleaning up and promoting a connection: "+this.secondaryConn_.connId),this.conn_=this.secondaryConn_,this.secondaryConn_=null)}onSecondaryControl_(t){if(lg in t){const e=t[lg];e===mg?this.upgradeIfSecondaryHealthy_():e===gg?(this.log_("Got a reset on secondary, closing it"),this.secondaryConn_.close(),this.tx_!==this.secondaryConn_&&this.rx_!==this.secondaryConn_||this.close()):e===fg&&(this.log_("got pong on secondary."),this.secondaryResponsesRequired_--,this.upgradeIfSecondaryHealthy_())}}onSecondaryMessageReceived_(t){const e=$u("t",t),s=$u("d",t);if("c"===e)this.onSecondaryControl_(s);else{if("d"!==e)throw new Error("Unknown protocol layer: "+e);this.pendingDataMessages.push(s)}}upgradeIfSecondaryHealthy_(){this.secondaryResponsesRequired_<=0?(this.log_("Secondary connection is healthy."),this.isHealthy_=!0,this.secondaryConn_.markConnectionHealthy(),this.proceedWithUpgrade_()):(this.log_("sending ping on secondary."),this.secondaryConn_.send({t:"c",d:{t:vg,d:{}}}))}proceedWithUpgrade_(){this.secondaryConn_.start(),this.log_("sending client ack on secondary"),this.secondaryConn_.send({t:"c",d:{t:mg,d:{}}}),this.log_("Ending transmission on primary"),this.conn_.send({t:"c",d:{t:_g,d:{}}}),this.tx_=this.secondaryConn_,this.tryCleanupConnection()}onPrimaryMessageReceived_(t){const e=$u("t",t),s=$u("d",t);"c"===e?this.onControl_(s):"d"===e&&this.onDataMessage_(s)}onDataMessage_(t){this.onPrimaryResponse_(),this.onMessage_(t)}onPrimaryResponse_(){this.isHealthy_||(this.primaryResponsesRequired_--,this.primaryResponsesRequired_<=0&&(this.log_("Primary connection is healthy."),this.isHealthy_=!0,this.conn_.markConnectionHealthy()))}onControl_(t){const e=$u(lg,t);if(ug in t){const s=t[ug];if(e===yg){const t=Object.assign({},s);this.repoInfo_.isUsingEmulator&&(t.h=this.repoInfo_.host),this.onHandshake_(t)}else if(e===_g){this.log_("recvd end transmission on primary"),this.rx_=this.secondaryConn_;for(let t=0;t<this.pendingDataMessages.length;++t)this.onDataMessage_(this.pendingDataMessages[t]);this.pendingDataMessages=[],this.tryCleanupConnection()}else e===dg?this.onConnectionShutdown_(s):e===gg?this.onReset_(s):e===pg?Xu("Server Error: "+s):e===fg?(this.log_("got pong on primary."),this.onPrimaryResponse_(),this.sendPingOnPrimaryIfNecessary_()):Xu("Unknown control packet command: "+e)}}onHandshake_(t){const e=t.ts,s=t.v,i=t.h;this.sessionId=t.s,this.repoInfo_.host=i,0===this.state_&&(this.conn_.start(),this.onConnectionEstablished_(this.conn_,e),md!==s&&Gu("Protocol version mismatch detected"),this.tryStartUpgrade_())}tryStartUpgrade_(){const t=this.transportManager_.upgradeTransport();t&&this.startUpgrade_(t)}startUpgrade_(t){this.secondaryConn_=new t(this.nextTransportId_(),this.repoInfo_,this.applicationId_,this.appCheckToken_,this.authToken_,this.sessionId),this.secondaryResponsesRequired_=t["responsesRequiredToBeHealthy"]||0;const e=this.connReceiver_(this.secondaryConn_),s=this.disconnReceiver_(this.secondaryConn_);this.secondaryConn_.open(e,s),dd((()=>{this.secondaryConn_&&(this.log_("Timed out trying to upgrade."),this.secondaryConn_.close())}),Math.floor(og))}onReset_(t){this.log_("Reset packet received.  New host: "+t),this.repoInfo_.host=t,1===this.state_?this.close():(this.closeConnections_(),this.start_())}onConnectionEstablished_(t,e){this.log_("Realtime connection established."),this.conn_=t,this.state_=1,this.onReady_&&(this.onReady_(e,this.sessionId),this.onReady_=null),0===this.primaryResponsesRequired_?(this.log_("Primary connection is healthy."),this.isHealthy_=!0):dd((()=>{this.sendPingOnPrimaryIfNecessary_()}),Math.floor(ag))}sendPingOnPrimaryIfNecessary_(){this.isHealthy_||1!==this.state_||(this.log_("sending ping on primary."),this.sendData_({t:"c",d:{t:vg,d:{}}}))}onSecondaryConnectionLost_(){const t=this.secondaryConn_;this.secondaryConn_=null,this.tx_!==t&&this.rx_!==t||this.close()}onConnectionLost_(t){this.conn_=null,t||0!==this.state_?1===this.state_&&this.log_("Realtime connection lost."):(this.log_("Realtime connection failed."),this.repoInfo_.isCacheableHost()&&(Iu.remove("host:"+this.repoInfo_.host),this.repoInfo_.internalHost=this.repoInfo_.host)),this.close()}onConnectionShutdown_(t){this.log_("Connection shutdown command received. Shutting down..."),this.onKill_&&(this.onKill_(t),this.onKill_=null),this.onDisconnect_=null,this.close()}sendData_(t){if(1!==this.state_)throw"Connection is not connected";this.tx_.send(t)}close(){2!==this.state_&&(this.log_("Closing realtime connection."),this.state_=2,this.closeConnections_(),this.onDisconnect_&&(this.onDisconnect_(),this.onDisconnect_=null))}closeConnections_(){this.log_("Shutting down all connections"),this.conn_&&(this.conn_.close(),this.conn_=null),this.secondaryConn_&&(this.secondaryConn_.close(),this.secondaryConn_=null),this.healthyTimeout_&&(clearTimeout(this.healthyTimeout_),this.healthyTimeout_=null)}}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class bg{put(t,e,s,i){}merge(t,e,s,i){}refreshAuthToken(t){}refreshAppCheckToken(t){}onDisconnectPut(t,e,s){}onDisconnectMerge(t,e,s){}onDisconnectCancel(t,e){}reportStats(t){}}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class wg{constructor(t){this.allowedEvents_=t,this.listeners_={},Ah(Array.isArray(t)&&t.length>0,"Requires a non-empty array")}trigger(t,...e){if(Array.isArray(this.listeners_[t])){const s=[...this.listeners_[t]];for(let t=0;t<s.length;t++)s[t].callback.apply(s[t].context,e)}}on(t,e,s){this.validateEventType_(t),this.listeners_[t]=this.listeners_[t]||[],this.listeners_[t].push({callback:e,context:s});const i=this.getInitialEvent(t);i&&e.apply(s,i)}off(t,e,s){this.validateEventType_(t);const i=this.listeners_[t]||[];for(let n=0;n<i.length;n++)if(i[n].callback===e&&(!s||s===i[n].context))return void i.splice(n,1)}validateEventType_(t){Ah(this.allowedEvents_.find((e=>e===t)),"Unknown event: "+t)}}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class xg extends wg{static getInstance(){return new xg}constructor(){super(["online"]),this.online_=!0,"undefined"===typeof window||"undefined"===typeof window.addEventListener||ic()||(window.addEventListener("online",(()=>{this.online_||(this.online_=!0,this.trigger("online",!0))}),!1),window.addEventListener("offline",(()=>{this.online_&&(this.online_=!1,this.trigger("online",!1))}),!1))}getInitialEvent(t){return Ah("online"===t,"Unknown event type: "+t),[this.online_]}currentlyOnline(){return this.online_}}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Sg=32,Tg=768;class kg{constructor(t,e){if(void 0===e){this.pieces_=t.split("/");let e=0;for(let t=0;t<this.pieces_.length;t++)this.pieces_[t].length>0&&(this.pieces_[e]=this.pieces_[t],e++);this.pieces_.length=e,this.pieceNum_=0}else this.pieces_=t,this.pieceNum_=e}toString(){let t="";for(let e=this.pieceNum_;e<this.pieces_.length;e++)""!==this.pieces_[e]&&(t+="/"+this.pieces_[e]);return t||"/"}}function Ag(){return new kg("")}function Eg(t){return t.pieceNum_>=t.pieces_.length?null:t.pieces_[t.pieceNum_]}function Og(t){return t.pieces_.length-t.pieceNum_}function Dg(t){let e=t.pieceNum_;return e<t.pieces_.length&&e++,new kg(t.pieces_,e)}function Pg(t){return t.pieceNum_<t.pieces_.length?t.pieces_[t.pieces_.length-1]:null}function Ig(t){let e="";for(let s=t.pieceNum_;s<t.pieces_.length;s++)""!==t.pieces_[s]&&(e+="/"+encodeURIComponent(String(t.pieces_[s])));return e||"/"}function Mg(t,e=0){return t.pieces_.slice(t.pieceNum_+e)}function Rg(t){if(t.pieceNum_>=t.pieces_.length)return null;const e=[];for(let s=t.pieceNum_;s<t.pieces_.length-1;s++)e.push(t.pieces_[s]);return new kg(e,0)}function Fg(t,e){const s=[];for(let i=t.pieceNum_;i<t.pieces_.length;i++)s.push(t.pieces_[i]);if(e instanceof kg)for(let i=e.pieceNum_;i<e.pieces_.length;i++)s.push(e.pieces_[i]);else{const t=e.split("/");for(let e=0;e<t.length;e++)t[e].length>0&&s.push(t[e])}return new kg(s,0)}function Lg(t){return t.pieceNum_>=t.pieces_.length}function jg(t,e){const s=Eg(t),i=Eg(e);if(null===s)return e;if(s===i)return jg(Dg(t),Dg(e));throw new Error("INTERNAL ERROR: innerPath ("+e+") is not within outerPath ("+t+")")}function Ng(t,e){if(Og(t)!==Og(e))return!1;for(let s=t.pieceNum_,i=e.pieceNum_;s<=t.pieces_.length;s++,i++)if(t.pieces_[s]!==e.pieces_[i])return!1;return!0}function Bg(t,e){let s=t.pieceNum_,i=e.pieceNum_;if(Og(t)>Og(e))return!1;while(s<t.pieces_.length){if(t.pieces_[s]!==e.pieces_[i])return!1;++s,++i}return!0}class Wg{constructor(t,e){this.errorPrefix_=e,this.parts_=Mg(t,0),this.byteLength_=Math.max(1,this.parts_.length);for(let s=0;s<this.parts_.length;s++)this.byteLength_+=Ec(this.parts_[s]);Xg(this)}}function Ug(t,e){t.parts_.length>0&&(t.byteLength_+=1),t.parts_.push(e),t.byteLength_+=Ec(e),Xg(t)}function Yg(t){const e=t.parts_.pop();t.byteLength_-=Ec(e),t.parts_.length>0&&(t.byteLength_-=1)}function Xg(t){if(t.byteLength_>Tg)throw new Error(t.errorPrefix_+"has a key path longer than "+Tg+" bytes ("+t.byteLength_+").");if(t.parts_.length>Sg)throw new Error(t.errorPrefix_+"path specified exceeds the maximum depth that can be written ("+Sg+") or object contains a cycle "+Vg(t))}function Vg(t){return 0===t.parts_.length?"":"in property '"+t.parts_.join(".")+"'"}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Gg extends wg{static getInstance(){return new Gg}constructor(){let t,e;super(["visible"]),"undefined"!==typeof document&&"undefined"!==typeof document.addEventListener&&("undefined"!==typeof document["hidden"]?(e="visibilitychange",t="hidden"):"undefined"!==typeof document["mozHidden"]?(e="mozvisibilitychange",t="mozHidden"):"undefined"!==typeof document["msHidden"]?(e="msvisibilitychange",t="msHidden"):"undefined"!==typeof document["webkitHidden"]&&(e="webkitvisibilitychange",t="webkitHidden")),this.visible_=!0,e&&document.addEventListener(e,(()=>{const e=!document[t];e!==this.visible_&&(this.visible_=e,this.trigger("visible",e))}),!1)}getInitialEvent(t){return Ah("visible"===t,"Unknown event type: "+t),[this.visible_]}}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Hg=1e3,zg=3e5,qg=3e4,Kg=1.3,Qg=3e4,Jg="server_kill",Zg=3;class $g extends bg{constructor(t,e,s,i,n,r,o,a){if(super(),this.repoInfo_=t,this.applicationId_=e,this.onDataUpdate_=s,this.onConnectStatus_=i,this.onServerInfoUpdate_=n,this.authTokenProvider_=r,this.appCheckTokenProvider_=o,this.authOverride_=a,this.id=$g.nextPersistentConnectionId_++,this.log_=Yu("p:"+this.id+":"),this.interruptReasons_={},this.listens=new Map,this.outstandingPuts_=[],this.outstandingGets_=[],this.outstandingPutCount_=0,this.outstandingGetCount_=0,this.onDisconnectRequestQueue_=[],this.connected_=!1,this.reconnectDelay_=Hg,this.maxReconnectDelay_=zg,this.securityDebugCallback_=null,this.lastSessionId=null,this.establishConnectionTimer_=null,this.visible_=!1,this.requestCBHash_={},this.requestNumber_=0,this.realtime_=null,this.authToken_=null,this.appCheckToken_=null,this.forceTokenRefresh_=!1,this.invalidAuthTokenCount_=0,this.invalidAppCheckTokenCount_=0,this.firstConnection_=!0,this.lastConnectionAttemptTime_=null,this.lastConnectionEstablishedTime_=null,a&&!rc())throw new Error("Auth override specified in options, but not supported on non Node.js platforms");Gg.getInstance().on("visible",this.onVisible_,this),-1===t.host.indexOf("fblocal")&&xg.getInstance().on("online",this.onOnline_,this)}sendRequest(t,e,s){const i=++this.requestNumber_,n={r:i,a:t,b:e};this.log_(pc(n)),Ah(this.connected_,"sendRequest call when we're not connected not allowed."),this.realtime_.sendRequest(n),s&&(this.requestCBHash_[i]=s)}get(t){this.initConnection_();const e=new zh,s={p:t._path.toString(),q:t._queryObject},i={action:"g",request:s,onComplete:t=>{const s=t["d"];"ok"===t["s"]?e.resolve(s):e.reject(s)}};this.outstandingGets_.push(i),this.outstandingGetCount_++;const n=this.outstandingGets_.length-1;return this.connected_&&this.sendGet_(n),e.promise}listen(t,e,s,i){this.initConnection_();const n=t._queryIdentifier,r=t._path.toString();this.log_("Listen called for "+r+" "+n),this.listens.has(r)||this.listens.set(r,new Map),Ah(t._queryParams.isDefault()||!t._queryParams.loadsAllData(),"listen() called for non-default but complete query"),Ah(!this.listens.get(r).has(n),"listen() called twice for same path/queryId.");const o={onComplete:i,hashFn:e,query:t,tag:s};this.listens.get(r).set(n,o),this.connected_&&this.sendListen_(o)}sendGet_(t){const e=this.outstandingGets_[t];this.sendRequest("g",e.request,(s=>{delete this.outstandingGets_[t],this.outstandingGetCount_--,0===this.outstandingGetCount_&&(this.outstandingGets_=[]),e.onComplete&&e.onComplete(s)}))}sendListen_(t){const e=t.query,s=e._path.toString(),i=e._queryIdentifier;this.log_("Listen on "+s+" for "+i);const n={p:s},r="q";t.tag&&(n["q"]=e._queryObject,n["t"]=t.tag),n["h"]=t.hashFn(),this.sendRequest(r,n,(n=>{const r=n["d"],o=n["s"];$g.warnOnListenWarnings_(r,e);const a=this.listens.get(s)&&this.listens.get(s).get(i);a===t&&(this.log_("listen response",n),"ok"!==o&&this.removeListen_(s,i),t.onComplete&&t.onComplete(o,r))}))}static warnOnListenWarnings_(t,e){if(t&&"object"===typeof t&&vc(t,"w")){const s=yc(t,"w");if(Array.isArray(s)&&~s.indexOf("no_index")){const t='".indexOn": "'+e._queryParams.getIndex().toString()+'"',s=e._path.toString();Gu(`Using an unspecified index. Your data will be downloaded and filtered on the client. Consider adding ${t} at ${s} to your security rules for better performance.`)}}}refreshAuthToken(t){this.authToken_=t,this.log_("Auth token refreshed"),this.authToken_?this.tryAuth():this.connected_&&this.sendRequest("unauth",{},(()=>{})),this.reduceReconnectDelayIfAdminCredential_(t)}reduceReconnectDelayIfAdminCredential_(t){const e=t&&40===t.length;(e||_c(t))&&(this.log_("Admin auth credential detected.  Reducing max reconnect time."),this.maxReconnectDelay_=qg)}refreshAppCheckToken(t){this.appCheckToken_=t,this.log_("App check token refreshed"),this.appCheckToken_?this.tryAppCheck():this.connected_&&this.sendRequest("unappeck",{},(()=>{}))}tryAuth(){if(this.connected_&&this.authToken_){const t=this.authToken_,e=mc(t)?"auth":"gauth",s={cred:t};null===this.authOverride_?s["noauth"]=!0:"object"===typeof this.authOverride_&&(s["authvar"]=this.authOverride_),this.sendRequest(e,s,(e=>{const s=e["s"],i=e["d"]||"error";this.authToken_===t&&("ok"===s?this.invalidAuthTokenCount_=0:this.onAuthRevoked_(s,i))}))}}tryAppCheck(){this.connected_&&this.appCheckToken_&&this.sendRequest("appcheck",{token:this.appCheckToken_},(t=>{const e=t["s"],s=t["d"]||"error";"ok"===e?this.invalidAppCheckTokenCount_=0:this.onAppCheckRevoked_(e,s)}))}unlisten(t,e){const s=t._path.toString(),i=t._queryIdentifier;this.log_("Unlisten called for "+s+" "+i),Ah(t._queryParams.isDefault()||!t._queryParams.loadsAllData(),"unlisten() called for non-default but complete query");const n=this.removeListen_(s,i);n&&this.connected_&&this.sendUnlisten_(s,i,t._queryObject,e)}sendUnlisten_(t,e,s,i){this.log_("Unlisten on "+t+" for "+e);const n={p:t},r="n";i&&(n["q"]=s,n["t"]=i),this.sendRequest(r,n)}onDisconnectPut(t,e,s){this.initConnection_(),this.connected_?this.sendOnDisconnect_("o",t,e,s):this.onDisconnectRequestQueue_.push({pathString:t,action:"o",data:e,onComplete:s})}onDisconnectMerge(t,e,s){this.initConnection_(),this.connected_?this.sendOnDisconnect_("om",t,e,s):this.onDisconnectRequestQueue_.push({pathString:t,action:"om",data:e,onComplete:s})}onDisconnectCancel(t,e){this.initConnection_(),this.connected_?this.sendOnDisconnect_("oc",t,null,e):this.onDisconnectRequestQueue_.push({pathString:t,action:"oc",data:null,onComplete:e})}sendOnDisconnect_(t,e,s,i){const n={p:e,d:s};this.log_("onDisconnect "+t,n),this.sendRequest(t,n,(t=>{i&&setTimeout((()=>{i(t["s"],t["d"])}),Math.floor(0))}))}put(t,e,s,i){this.putInternal("p",t,e,s,i)}merge(t,e,s,i){this.putInternal("m",t,e,s,i)}putInternal(t,e,s,i,n){this.initConnection_();const r={p:e,d:s};void 0!==n&&(r["h"]=n),this.outstandingPuts_.push({action:t,request:r,onComplete:i}),this.outstandingPutCount_++;const o=this.outstandingPuts_.length-1;this.connected_?this.sendPut_(o):this.log_("Buffering put: "+e)}sendPut_(t){const e=this.outstandingPuts_[t].action,s=this.outstandingPuts_[t].request,i=this.outstandingPuts_[t].onComplete;this.outstandingPuts_[t].queued=this.connected_,this.sendRequest(e,s,(s=>{this.log_(e+" response",s),delete this.outstandingPuts_[t],this.outstandingPutCount_--,0===this.outstandingPutCount_&&(this.outstandingPuts_=[]),i&&i(s["s"],s["d"])}))}reportStats(t){if(this.connected_){const e={c:t};this.log_("reportStats",e),this.sendRequest("s",e,(t=>{const e=t["s"];if("ok"!==e){const e=t["d"];this.log_("reportStats","Error sending stats: "+e)}}))}}onDataMessage_(t){if("r"in t){this.log_("from server: "+pc(t));const e=t["r"],s=this.requestCBHash_[e];s&&(delete this.requestCBHash_[e],s(t["b"]))}else{if("error"in t)throw"A server-side error has occurred: "+t["error"];"a"in t&&this.onDataPush_(t["a"],t["b"])}}onDataPush_(t,e){this.log_("handleServerMessage",t,e),"d"===t?this.onDataUpdate_(e["p"],e["d"],!1,e["t"]):"m"===t?this.onDataUpdate_(e["p"],e["d"],!0,e["t"]):"c"===t?this.onListenRevoked_(e["p"],e["q"]):"ac"===t?this.onAuthRevoked_(e["s"],e["d"]):"apc"===t?this.onAppCheckRevoked_(e["s"],e["d"]):"sd"===t?this.onSecurityDebugPacket_(e):Xu("Unrecognized action received from server: "+pc(t)+"\nAre you using the latest client?")}onReady_(t,e){this.log_("connection ready"),this.connected_=!0,this.lastConnectionEstablishedTime_=(new Date).getTime(),this.handleTimestamp_(t),this.lastSessionId=e,this.firstConnection_&&this.sendConnectStats_(),this.restoreState_(),this.firstConnection_=!1,this.onConnectStatus_(!0)}scheduleConnect_(t){Ah(!this.realtime_,"Scheduling a connect when we're already connected/ing?"),this.establishConnectionTimer_&&clearTimeout(this.establishConnectionTimer_),this.establishConnectionTimer_=setTimeout((()=>{this.establishConnectionTimer_=null,this.establishConnection_()}),Math.floor(t))}initConnection_(){!this.realtime_&&this.firstConnection_&&this.scheduleConnect_(0)}onVisible_(t){t&&!this.visible_&&this.reconnectDelay_===this.maxReconnectDelay_&&(this.log_("Window became visible.  Reducing delay."),this.reconnectDelay_=Hg,this.realtime_||this.scheduleConnect_(0)),this.visible_=t}onOnline_(t){t?(this.log_("Browser went online."),this.reconnectDelay_=Hg,this.realtime_||this.scheduleConnect_(0)):(this.log_("Browser went offline.  Killing connection."),this.realtime_&&this.realtime_.close())}onRealtimeDisconnect_(){if(this.log_("data client disconnected"),this.connected_=!1,this.realtime_=null,this.cancelSentTransactions_(),this.requestCBHash_={},this.shouldReconnect_()){if(this.visible_){if(this.lastConnectionEstablishedTime_){const t=(new Date).getTime()-this.lastConnectionEstablishedTime_;t>Qg&&(this.reconnectDelay_=Hg),this.lastConnectionEstablishedTime_=null}}else this.log_("Window isn't visible.  Delaying reconnect."),this.reconnectDelay_=this.maxReconnectDelay_,this.lastConnectionAttemptTime_=(new Date).getTime();const t=Math.max(0,(new Date).getTime()-this.lastConnectionAttemptTime_);let e=Math.max(0,this.reconnectDelay_-t);e=Math.random()*e,this.log_("Trying to reconnect in "+e+"ms"),this.scheduleConnect_(e),this.reconnectDelay_=Math.min(this.maxReconnectDelay_,this.reconnectDelay_*Kg)}this.onConnectStatus_(!1)}async establishConnection_(){if(this.shouldReconnect_()){this.log_("Making a connection attempt"),this.lastConnectionAttemptTime_=(new Date).getTime(),this.lastConnectionEstablishedTime_=null;const t=this.onDataMessage_.bind(this),e=this.onReady_.bind(this),s=this.onRealtimeDisconnect_.bind(this),i=this.id+":"+$g.nextConnectionId_++,n=this.lastSessionId;let r=!1,o=null;const a=function(){o?o.close():(r=!0,s())},h=function(t){Ah(o,"sendRequest call when we're not connected not allowed."),o.sendRequest(t)};this.realtime_={close:a,sendRequest:h};const c=this.forceTokenRefresh_;this.forceTokenRefresh_=!1;try{const[a,h]=await Promise.all([this.authTokenProvider_.getToken(c),this.appCheckTokenProvider_.getToken(c)]);r?Uu("getToken() completed but was canceled"):(Uu("getToken() completed. Creating connection."),this.authToken_=a&&a.accessToken,this.appCheckToken_=h&&h.token,o=new Cg(i,this.repoInfo_,this.applicationId_,this.appCheckToken_,this.authToken_,t,e,s,(t=>{Gu(t+" ("+this.repoInfo_.toString()+")"),this.interrupt(Jg)}),n))}catch(Xu){this.log_("Failed to get token: "+Xu),r||(this.repoInfo_.nodeAdmin&&Gu(Xu),a())}}}interrupt(t){Uu("Interrupting connection for reason: "+t),this.interruptReasons_[t]=!0,this.realtime_?this.realtime_.close():(this.establishConnectionTimer_&&(clearTimeout(this.establishConnectionTimer_),this.establishConnectionTimer_=null),this.connected_&&this.onRealtimeDisconnect_())}resume(t){Uu("Resuming connection for reason: "+t),delete this.interruptReasons_[t],Cc(this.interruptReasons_)&&(this.reconnectDelay_=Hg,this.realtime_||this.scheduleConnect_(0))}handleTimestamp_(t){const e=t-(new Date).getTime();this.onServerInfoUpdate_({serverTimeOffset:e})}cancelSentTransactions_(){for(let t=0;t<this.outstandingPuts_.length;t++){const e=this.outstandingPuts_[t];e&&"h"in e.request&&e.queued&&(e.onComplete&&e.onComplete("disconnect"),delete this.outstandingPuts_[t],this.outstandingPutCount_--)}0===this.outstandingPutCount_&&(this.outstandingPuts_=[])}onListenRevoked_(t,e){let s;s=e?e.map((t=>td(t))).join("$"):"default";const i=this.removeListen_(t,s);i&&i.onComplete&&i.onComplete("permission_denied")}removeListen_(t,e){const s=new kg(t).toString();let i;if(this.listens.has(s)){const t=this.listens.get(s);i=t.get(e),t.delete(e),0===t.size&&this.listens.delete(s)}else i=void 0;return i}onAuthRevoked_(t,e){Uu("Auth token revoked: "+t+"/"+e),this.authToken_=null,this.forceTokenRefresh_=!0,this.realtime_.close(),"invalid_token"!==t&&"permission_denied"!==t||(this.invalidAuthTokenCount_++,this.invalidAuthTokenCount_>=Zg&&(this.reconnectDelay_=qg,this.authTokenProvider_.notifyForInvalidToken()))}onAppCheckRevoked_(t,e){Uu("App check token revoked: "+t+"/"+e),this.appCheckToken_=null,this.forceTokenRefresh_=!0,"invalid_token"!==t&&"permission_denied"!==t||(this.invalidAppCheckTokenCount_++,this.invalidAppCheckTokenCount_>=Zg&&this.appCheckTokenProvider_.notifyForInvalidToken())}onSecurityDebugPacket_(t){this.securityDebugCallback_?this.securityDebugCallback_(t):"msg"in t&&console.log("FIREBASE: "+t["msg"].replace("\n","\nFIREBASE: "))}restoreState_(){this.tryAuth(),this.tryAppCheck();for(const t of this.listens.values())for(const e of t.values())this.sendListen_(e);for(let t=0;t<this.outstandingPuts_.length;t++)this.outstandingPuts_[t]&&this.sendPut_(t);while(this.onDisconnectRequestQueue_.length){const t=this.onDisconnectRequestQueue_.shift();this.sendOnDisconnect_(t.action,t.pathString,t.data,t.onComplete)}for(let t=0;t<this.outstandingGets_.length;t++)this.outstandingGets_[t]&&this.sendGet_(t)}sendConnectStats_(){const t={};let e="js";rc()&&(e=this.repoInfo_.nodeAdmin?"admin_node":"node"),t["sdk."+e+"."+Au.replace(/\./g,"-")]=1,ic()?t["framework.cordova"]=1:nc()&&(t["framework.reactnative"]=1),this.reportStats(t)}shouldReconnect_(){const t=xg.getInstance().currentlyOnline();return Cc(this.interruptReasons_)&&t}}$g.nextPersistentConnectionId_=0,$g.nextConnectionId_=0;
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
class tp{constructor(t,e){this.name=t,this.node=e}static Wrap(t,e){return new tp(t,e)}}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ep{getCompare(){return this.compare.bind(this)}indexedValueChanged(t,e){const s=new tp(Ku,t),i=new tp(Ku,e);return 0!==this.compare(s,i)}minPost(){return tp.MIN}}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let sp;class ip extends ep{static get __EMPTY_NODE(){return sp}static set __EMPTY_NODE(t){sp=t}compare(t,e){return Ju(t.name,e.name)}isDefinedOn(t){throw Eh("KeyIndex.isDefinedOn not expected to be called.")}indexedValueChanged(t,e){return!1}minPost(){return tp.MIN}maxPost(){return new tp(Qu,sp)}makePost(t,e){return Ah("string"===typeof t,"KeyIndex indexValue must always be a string."),new tp(t,sp)}toString(){return".key"}}const np=new ip;
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class rp{constructor(t,e,s,i,n=null){this.isReverse_=i,this.resultGenerator_=n,this.nodeStack_=[];let r=1;while(!t.isEmpty())if(r=e?s(t.key,e):1,i&&(r*=-1),r<0)t=this.isReverse_?t.left:t.right;else{if(0===r){this.nodeStack_.push(t);break}this.nodeStack_.push(t),t=this.isReverse_?t.right:t.left}}getNext(){if(0===this.nodeStack_.length)return null;let t,e=this.nodeStack_.pop();if(t=this.resultGenerator_?this.resultGenerator_(e.key,e.value):{key:e.key,value:e.value},this.isReverse_){e=e.left;while(!e.isEmpty())this.nodeStack_.push(e),e=e.right}else{e=e.right;while(!e.isEmpty())this.nodeStack_.push(e),e=e.left}return t}hasNext(){return this.nodeStack_.length>0}peek(){if(0===this.nodeStack_.length)return null;const t=this.nodeStack_[this.nodeStack_.length-1];return this.resultGenerator_?this.resultGenerator_(t.key,t.value):{key:t.key,value:t.value}}}class op{constructor(t,e,s,i,n){this.key=t,this.value=e,this.color=null!=s?s:op.RED,this.left=null!=i?i:hp.EMPTY_NODE,this.right=null!=n?n:hp.EMPTY_NODE}copy(t,e,s,i,n){return new op(null!=t?t:this.key,null!=e?e:this.value,null!=s?s:this.color,null!=i?i:this.left,null!=n?n:this.right)}count(){return this.left.count()+1+this.right.count()}isEmpty(){return!1}inorderTraversal(t){return this.left.inorderTraversal(t)||!!t(this.key,this.value)||this.right.inorderTraversal(t)}reverseTraversal(t){return this.right.reverseTraversal(t)||t(this.key,this.value)||this.left.reverseTraversal(t)}min_(){return this.left.isEmpty()?this:this.left.min_()}minKey(){return this.min_().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(t,e,s){let i=this;const n=s(t,i.key);return i=n<0?i.copy(null,null,null,i.left.insert(t,e,s),null):0===n?i.copy(null,e,null,null,null):i.copy(null,null,null,null,i.right.insert(t,e,s)),i.fixUp_()}removeMin_(){if(this.left.isEmpty())return hp.EMPTY_NODE;let t=this;return t.left.isRed_()||t.left.left.isRed_()||(t=t.moveRedLeft_()),t=t.copy(null,null,null,t.left.removeMin_(),null),t.fixUp_()}remove(t,e){let s,i;if(s=this,e(t,s.key)<0)s.left.isEmpty()||s.left.isRed_()||s.left.left.isRed_()||(s=s.moveRedLeft_()),s=s.copy(null,null,null,s.left.remove(t,e),null);else{if(s.left.isRed_()&&(s=s.rotateRight_()),s.right.isEmpty()||s.right.isRed_()||s.right.left.isRed_()||(s=s.moveRedRight_()),0===e(t,s.key)){if(s.right.isEmpty())return hp.EMPTY_NODE;i=s.right.min_(),s=s.copy(i.key,i.value,null,null,s.right.removeMin_())}s=s.copy(null,null,null,null,s.right.remove(t,e))}return s.fixUp_()}isRed_(){return this.color}fixUp_(){let t=this;return t.right.isRed_()&&!t.left.isRed_()&&(t=t.rotateLeft_()),t.left.isRed_()&&t.left.left.isRed_()&&(t=t.rotateRight_()),t.left.isRed_()&&t.right.isRed_()&&(t=t.colorFlip_()),t}moveRedLeft_(){let t=this.colorFlip_();return t.right.left.isRed_()&&(t=t.copy(null,null,null,null,t.right.rotateRight_()),t=t.rotateLeft_(),t=t.colorFlip_()),t}moveRedRight_(){let t=this.colorFlip_();return t.left.left.isRed_()&&(t=t.rotateRight_(),t=t.colorFlip_()),t}rotateLeft_(){const t=this.copy(null,null,op.RED,null,this.right.left);return this.right.copy(null,null,this.color,t,null)}rotateRight_(){const t=this.copy(null,null,op.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,t)}colorFlip_(){const t=this.left.copy(null,null,!this.left.color,null,null),e=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,t,e)}checkMaxDepth_(){const t=this.check_();return Math.pow(2,t)<=this.count()+1}check_(){if(this.isRed_()&&this.left.isRed_())throw new Error("Red node has red child("+this.key+","+this.value+")");if(this.right.isRed_())throw new Error("Right child of ("+this.key+","+this.value+") is red");const t=this.left.check_();if(t!==this.right.check_())throw new Error("Black depths differ");return t+(this.isRed_()?0:1)}}op.RED=!0,op.BLACK=!1;class ap{copy(t,e,s,i,n){return this}insert(t,e,s){return new op(t,e,null)}remove(t,e){return this}count(){return 0}isEmpty(){return!0}inorderTraversal(t){return!1}reverseTraversal(t){return!1}minKey(){return null}maxKey(){return null}check_(){return 0}isRed_(){return!1}}class hp{constructor(t,e=hp.EMPTY_NODE){this.comparator_=t,this.root_=e}insert(t,e){return new hp(this.comparator_,this.root_.insert(t,e,this.comparator_).copy(null,null,op.BLACK,null,null))}remove(t){return new hp(this.comparator_,this.root_.remove(t,this.comparator_).copy(null,null,op.BLACK,null,null))}get(t){let e,s=this.root_;while(!s.isEmpty()){if(e=this.comparator_(t,s.key),0===e)return s.value;e<0?s=s.left:e>0&&(s=s.right)}return null}getPredecessorKey(t){let e,s=this.root_,i=null;while(!s.isEmpty()){if(e=this.comparator_(t,s.key),0===e){if(s.left.isEmpty())return i?i.key:null;s=s.left;while(!s.right.isEmpty())s=s.right;return s.key}e<0?s=s.left:e>0&&(i=s,s=s.right)}throw new Error("Attempted to find predecessor key for a nonexistent key.  What gives?")}isEmpty(){return this.root_.isEmpty()}count(){return this.root_.count()}minKey(){return this.root_.minKey()}maxKey(){return this.root_.maxKey()}inorderTraversal(t){return this.root_.inorderTraversal(t)}reverseTraversal(t){return this.root_.reverseTraversal(t)}getIterator(t){return new rp(this.root_,null,this.comparator_,!1,t)}getIteratorFrom(t,e){return new rp(this.root_,t,this.comparator_,!1,e)}getReverseIteratorFrom(t,e){return new rp(this.root_,t,this.comparator_,!0,e)}getReverseIterator(t){return new rp(this.root_,null,this.comparator_,!0,t)}}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
function cp(t,e){return Ju(t.name,e.name)}function lp(t,e){return Ju(t,e)}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let up;function dp(t){up=t}hp.EMPTY_NODE=new ap;const gp=function(t){return"number"===typeof t?"number:"+id(t):"string:"+t},pp=function(t){if(t.isLeafNode()){const e=t.val();Ah("string"===typeof e||"number"===typeof e||"object"===typeof e&&vc(e,".sv"),"Priority must be a string or number.")}else Ah(t===up||t.isEmpty(),"priority of unexpected type.");Ah(t===up||t.getPriority().isEmpty(),"Priority nodes can't have a priority of their own.")};
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
let fp,mp,_p;class vp{static set __childrenNodeConstructor(t){fp=t}static get __childrenNodeConstructor(){return fp}constructor(t,e=vp.__childrenNodeConstructor.EMPTY_NODE){this.value_=t,this.priorityNode_=e,this.lazyHash_=null,Ah(void 0!==this.value_&&null!==this.value_,"LeafNode shouldn't be created with null/undefined value."),pp(this.priorityNode_)}isLeafNode(){return!0}getPriority(){return this.priorityNode_}updatePriority(t){return new vp(this.value_,t)}getImmediateChild(t){return".priority"===t?this.priorityNode_:vp.__childrenNodeConstructor.EMPTY_NODE}getChild(t){return Lg(t)?this:".priority"===Eg(t)?this.priorityNode_:vp.__childrenNodeConstructor.EMPTY_NODE}hasChild(){return!1}getPredecessorChildName(t,e){return null}updateImmediateChild(t,e){return".priority"===t?this.updatePriority(e):e.isEmpty()&&".priority"!==t?this:vp.__childrenNodeConstructor.EMPTY_NODE.updateImmediateChild(t,e).updatePriority(this.priorityNode_)}updateChild(t,e){const s=Eg(t);return null===s?e:e.isEmpty()&&".priority"!==s?this:(Ah(".priority"!==s||1===Og(t),".priority must be the last token in a path"),this.updateImmediateChild(s,vp.__childrenNodeConstructor.EMPTY_NODE.updateChild(Dg(t),e)))}isEmpty(){return!1}numChildren(){return 0}forEachChild(t,e){return!1}val(t){return t&&!this.getPriority().isEmpty()?{".value":this.getValue(),".priority":this.getPriority().val()}:this.getValue()}hash(){if(null===this.lazyHash_){let t="";this.priorityNode_.isEmpty()||(t+="priority:"+gp(this.priorityNode_.val())+":");const e=typeof this.value_;t+=e+":",t+="number"===e?id(this.value_):this.value_,this.lazyHash_=Lu(t)}return this.lazyHash_}getValue(){return this.value_}compareTo(t){return t===vp.__childrenNodeConstructor.EMPTY_NODE?1:t instanceof vp.__childrenNodeConstructor?-1:(Ah(t.isLeafNode(),"Unknown node type"),this.compareToLeafNode_(t))}compareToLeafNode_(t){const e=typeof t.value_,s=typeof this.value_,i=vp.VALUE_TYPE_ORDER.indexOf(e),n=vp.VALUE_TYPE_ORDER.indexOf(s);return Ah(i>=0,"Unknown leaf type: "+e),Ah(n>=0,"Unknown leaf type: "+s),i===n?"object"===s?0:this.value_<t.value_?-1:this.value_===t.value_?0:1:n-i}withIndex(){return this}isIndexed(){return!0}equals(t){if(t===this)return!0;if(t.isLeafNode()){const e=t;return this.value_===e.value_&&this.priorityNode_.equals(e.priorityNode_)}return!1}}function yp(t){mp=t}function Cp(t){_p=t}vp.VALUE_TYPE_ORDER=["object","boolean","number","string"];class bp extends ep{compare(t,e){const s=t.node.getPriority(),i=e.node.getPriority(),n=s.compareTo(i);return 0===n?Ju(t.name,e.name):n}isDefinedOn(t){return!t.getPriority().isEmpty()}indexedValueChanged(t,e){return!t.getPriority().equals(e.getPriority())}minPost(){return tp.MIN}maxPost(){return new tp(Qu,new vp("[PRIORITY-POST]",_p))}makePost(t,e){const s=mp(t);return new tp(e,new vp("[PRIORITY-POST]",s))}toString(){return".priority"}}const wp=new bp,xp=Math.log(2);
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Sp{constructor(t){const e=t=>parseInt(Math.log(t)/xp,10),s=t=>parseInt(Array(t+1).join("1"),2);this.count=e(t+1),this.current_=this.count-1;const i=s(this.count);this.bits_=t+1&i}nextBitIsOne(){const t=!(this.bits_&1<<this.current_);return this.current_--,t}}const Tp=function(t,e,s,i){t.sort(e);const n=function(e,i){const r=i-e;let o,a;if(0===r)return null;if(1===r)return o=t[e],a=s?s(o):o,new op(a,o.node,op.BLACK,null,null);{const h=parseInt(r/2,10)+e,c=n(e,h),l=n(h+1,i);return o=t[h],a=s?s(o):o,new op(a,o.node,op.BLACK,c,l)}},r=function(e){let i=null,r=null,o=t.length;const a=function(e,i){const r=o-e,a=o;o-=e;const c=n(r+1,a),l=t[r],u=s?s(l):l;h(new op(u,l.node,i,null,c))},h=function(t){i?(i.left=t,i=t):(r=t,i=t)};for(let t=0;t<e.count;++t){const s=e.nextBitIsOne(),i=Math.pow(2,e.count-(t+1));s?a(i,op.BLACK):(a(i,op.BLACK),a(i,op.RED))}return r},o=new Sp(t.length),a=r(o);return new hp(i||e,a)};
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let kp;const Ap={};class Ep{static get Default(){return Ah(Ap&&wp,"ChildrenNode.ts has not been loaded"),kp=kp||new Ep({".priority":Ap},{".priority":wp}),kp}constructor(t,e){this.indexes_=t,this.indexSet_=e}get(t){const e=yc(this.indexes_,t);if(!e)throw new Error("No index defined for "+t);return e instanceof hp?e:null}hasIndex(t){return vc(this.indexSet_,t.toString())}addIndex(t,e){Ah(t!==np,"KeyIndex always exists and isn't meant to be added to the IndexMap.");const s=[];let i=!1;const n=e.getIterator(tp.Wrap);let r,o=n.getNext();while(o)i=i||t.isDefinedOn(o.node),s.push(o),o=n.getNext();r=i?Tp(s,t.getCompare()):Ap;const a=t.toString(),h=Object.assign({},this.indexSet_);h[a]=t;const c=Object.assign({},this.indexes_);return c[a]=r,new Ep(c,h)}addToIndexes(t,e){const s=bc(this.indexes_,((s,i)=>{const n=yc(this.indexSet_,i);if(Ah(n,"Missing index implementation for "+i),s===Ap){if(n.isDefinedOn(t.node)){const s=[],i=e.getIterator(tp.Wrap);let r=i.getNext();while(r)r.name!==t.name&&s.push(r),r=i.getNext();return s.push(t),Tp(s,n.getCompare())}return Ap}{const i=e.get(t.name);let n=s;return i&&(n=n.remove(new tp(t.name,i))),n.insert(t,t.node)}}));return new Ep(s,this.indexSet_)}removeFromIndexes(t,e){const s=bc(this.indexes_,(s=>{if(s===Ap)return s;{const i=e.get(t.name);return i?s.remove(new tp(t.name,i)):s}}));return new Ep(s,this.indexSet_)}}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let Op;class Dp{static get EMPTY_NODE(){return Op||(Op=new Dp(new hp(lp),null,Ep.Default))}constructor(t,e,s){this.children_=t,this.priorityNode_=e,this.indexMap_=s,this.lazyHash_=null,this.priorityNode_&&pp(this.priorityNode_),this.children_.isEmpty()&&Ah(!this.priorityNode_||this.priorityNode_.isEmpty(),"An empty node cannot have a priority")}isLeafNode(){return!1}getPriority(){return this.priorityNode_||Op}updatePriority(t){return this.children_.isEmpty()?this:new Dp(this.children_,t,this.indexMap_)}getImmediateChild(t){if(".priority"===t)return this.getPriority();{const e=this.children_.get(t);return null===e?Op:e}}getChild(t){const e=Eg(t);return null===e?this:this.getImmediateChild(e).getChild(Dg(t))}hasChild(t){return null!==this.children_.get(t)}updateImmediateChild(t,e){if(Ah(e,"We should always be passing snapshot nodes"),".priority"===t)return this.updatePriority(e);{const s=new tp(t,e);let i,n;e.isEmpty()?(i=this.children_.remove(t),n=this.indexMap_.removeFromIndexes(s,this.children_)):(i=this.children_.insert(t,e),n=this.indexMap_.addToIndexes(s,this.children_));const r=i.isEmpty()?Op:this.priorityNode_;return new Dp(i,r,n)}}updateChild(t,e){const s=Eg(t);if(null===s)return e;{Ah(".priority"!==Eg(t)||1===Og(t),".priority must be the last token in a path");const i=this.getImmediateChild(s).updateChild(Dg(t),e);return this.updateImmediateChild(s,i)}}isEmpty(){return this.children_.isEmpty()}numChildren(){return this.children_.count()}val(t){if(this.isEmpty())return null;const e={};let s=0,i=0,n=!0;if(this.forEachChild(wp,((r,o)=>{e[r]=o.val(t),s++,n&&Dp.INTEGER_REGEXP_.test(r)?i=Math.max(i,Number(r)):n=!1})),!t&&n&&i<2*s){const t=[];for(const s in e)t[s]=e[s];return t}return t&&!this.getPriority().isEmpty()&&(e[".priority"]=this.getPriority().val()),e}hash(){if(null===this.lazyHash_){let t="";this.getPriority().isEmpty()||(t+="priority:"+gp(this.getPriority().val())+":"),this.forEachChild(wp,((e,s)=>{const i=s.hash();""!==i&&(t+=":"+e+":"+i)})),this.lazyHash_=""===t?"":Lu(t)}return this.lazyHash_}getPredecessorChildName(t,e,s){const i=this.resolveIndex_(s);if(i){const s=i.getPredecessorKey(new tp(t,e));return s?s.name:null}return this.children_.getPredecessorKey(t)}getFirstChildName(t){const e=this.resolveIndex_(t);if(e){const t=e.minKey();return t&&t.name}return this.children_.minKey()}getFirstChild(t){const e=this.getFirstChildName(t);return e?new tp(e,this.children_.get(e)):null}getLastChildName(t){const e=this.resolveIndex_(t);if(e){const t=e.maxKey();return t&&t.name}return this.children_.maxKey()}getLastChild(t){const e=this.getLastChildName(t);return e?new tp(e,this.children_.get(e)):null}forEachChild(t,e){const s=this.resolveIndex_(t);return s?s.inorderTraversal((t=>e(t.name,t.node))):this.children_.inorderTraversal(e)}getIterator(t){return this.getIteratorFrom(t.minPost(),t)}getIteratorFrom(t,e){const s=this.resolveIndex_(e);if(s)return s.getIteratorFrom(t,(t=>t));{const s=this.children_.getIteratorFrom(t.name,tp.Wrap);let i=s.peek();while(null!=i&&e.compare(i,t)<0)s.getNext(),i=s.peek();return s}}getReverseIterator(t){return this.getReverseIteratorFrom(t.maxPost(),t)}getReverseIteratorFrom(t,e){const s=this.resolveIndex_(e);if(s)return s.getReverseIteratorFrom(t,(t=>t));{const s=this.children_.getReverseIteratorFrom(t.name,tp.Wrap);let i=s.peek();while(null!=i&&e.compare(i,t)>0)s.getNext(),i=s.peek();return s}}compareTo(t){return this.isEmpty()?t.isEmpty()?0:-1:t.isLeafNode()||t.isEmpty()?1:t===Ip?-1:0}withIndex(t){if(t===np||this.indexMap_.hasIndex(t))return this;{const e=this.indexMap_.addIndex(t,this.children_);return new Dp(this.children_,this.priorityNode_,e)}}isIndexed(t){return t===np||this.indexMap_.hasIndex(t)}equals(t){if(t===this)return!0;if(t.isLeafNode())return!1;{const e=t;if(this.getPriority().equals(e.getPriority())){if(this.children_.count()===e.children_.count()){const t=this.getIterator(wp),s=e.getIterator(wp);let i=t.getNext(),n=s.getNext();while(i&&n){if(i.name!==n.name||!i.node.equals(n.node))return!1;i=t.getNext(),n=s.getNext()}return null===i&&null===n}return!1}return!1}}resolveIndex_(t){return t===np?null:this.indexMap_.get(t.toString())}}Dp.INTEGER_REGEXP_=/^(0|[1-9]\d*)$/;class Pp extends Dp{constructor(){super(new hp(lp),Dp.EMPTY_NODE,Ep.Default)}compareTo(t){return t===this?0:1}equals(t){return t===this}getPriority(){return this}getImmediateChild(t){return Dp.EMPTY_NODE}isEmpty(){return!1}}const Ip=new Pp;Object.defineProperties(tp,{MIN:{value:new tp(Ku,Dp.EMPTY_NODE)},MAX:{value:new tp(Qu,Ip)}}),ip.__EMPTY_NODE=Dp.EMPTY_NODE,vp.__childrenNodeConstructor=Dp,dp(Ip),Cp(Ip);
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
const Mp=!0;function Rp(t,e=null){if(null===t)return Dp.EMPTY_NODE;if("object"===typeof t&&".priority"in t&&(e=t[".priority"]),Ah(null===e||"string"===typeof e||"number"===typeof e||"object"===typeof e&&".sv"in e,"Invalid priority type found: "+typeof e),"object"===typeof t&&".value"in t&&null!==t[".value"]&&(t=t[".value"]),"object"!==typeof t||".sv"in t){const s=t;return new vp(s,Rp(e))}if(t instanceof Array||!Mp){let s=Dp.EMPTY_NODE;return sd(t,((e,i)=>{if(vc(t,e)&&"."!==e.substring(0,1)){const t=Rp(i);!t.isLeafNode()&&t.isEmpty()||(s=s.updateImmediateChild(e,t))}})),s.updatePriority(Rp(e))}{const s=[];let i=!1;const n=t;if(sd(n,((t,e)=>{if("."!==t.substring(0,1)){const n=Rp(e);n.isEmpty()||(i=i||!n.getPriority().isEmpty(),s.push(new tp(t,n)))}})),0===s.length)return Dp.EMPTY_NODE;const r=Tp(s,cp,(t=>t.name),lp);if(i){const t=Tp(s,wp.getCompare());return new Dp(r,Rp(e),new Ep({".priority":t},{".priority":wp}))}return new Dp(r,Rp(e),Ep.Default)}}yp(Rp);
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
class Fp extends ep{constructor(t){super(),this.indexPath_=t,Ah(!Lg(t)&&".priority"!==Eg(t),"Can't create PathIndex with empty path or .priority key")}extractChild(t){return t.getChild(this.indexPath_)}isDefinedOn(t){return!t.getChild(this.indexPath_).isEmpty()}compare(t,e){const s=this.extractChild(t.node),i=this.extractChild(e.node),n=s.compareTo(i);return 0===n?Ju(t.name,e.name):n}makePost(t,e){const s=Rp(t),i=Dp.EMPTY_NODE.updateChild(this.indexPath_,s);return new tp(e,i)}maxPost(){const t=Dp.EMPTY_NODE.updateChild(this.indexPath_,Ip);return new tp(Qu,t)}toString(){return Mg(this.indexPath_,0).join("/")}}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Lp extends ep{compare(t,e){const s=t.node.compareTo(e.node);return 0===s?Ju(t.name,e.name):s}isDefinedOn(t){return!0}indexedValueChanged(t,e){return!t.equals(e)}minPost(){return tp.MIN}maxPost(){return tp.MAX}makePost(t,e){const s=Rp(t);return new tp(e,s)}toString(){return".value"}}const jp=new Lp;
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Np(t){return{type:"value",snapshotNode:t}}function Bp(t,e){return{type:"child_added",snapshotNode:e,childName:t}}function Wp(t,e){return{type:"child_removed",snapshotNode:e,childName:t}}function Up(t,e,s){return{type:"child_changed",snapshotNode:e,childName:t,oldSnap:s}}function Yp(t,e){return{type:"child_moved",snapshotNode:e,childName:t}}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
class Xp{constructor(){this.limitSet_=!1,this.startSet_=!1,this.startNameSet_=!1,this.startAfterSet_=!1,this.endSet_=!1,this.endNameSet_=!1,this.endBeforeSet_=!1,this.limit_=0,this.viewFrom_="",this.indexStartValue_=null,this.indexStartName_="",this.indexEndValue_=null,this.indexEndName_="",this.index_=wp}hasStart(){return this.startSet_}isViewFromLeft(){return""===this.viewFrom_?this.startSet_:"l"===this.viewFrom_}getIndexStartValue(){return Ah(this.startSet_,"Only valid if start has been set"),this.indexStartValue_}getIndexStartName(){return Ah(this.startSet_,"Only valid if start has been set"),this.startNameSet_?this.indexStartName_:Ku}hasEnd(){return this.endSet_}getIndexEndValue(){return Ah(this.endSet_,"Only valid if end has been set"),this.indexEndValue_}getIndexEndName(){return Ah(this.endSet_,"Only valid if end has been set"),this.endNameSet_?this.indexEndName_:Qu}hasLimit(){return this.limitSet_}hasAnchoredLimit(){return this.limitSet_&&""!==this.viewFrom_}getLimit(){return Ah(this.limitSet_,"Only valid if limit has been set"),this.limit_}getIndex(){return this.index_}loadsAllData(){return!(this.startSet_||this.endSet_||this.limitSet_)}isDefault(){return this.loadsAllData()&&this.index_===wp}copy(){const t=new Xp;return t.limitSet_=this.limitSet_,t.limit_=this.limit_,t.startSet_=this.startSet_,t.startAfterSet_=this.startAfterSet_,t.indexStartValue_=this.indexStartValue_,t.startNameSet_=this.startNameSet_,t.indexStartName_=this.indexStartName_,t.endSet_=this.endSet_,t.endBeforeSet_=this.endBeforeSet_,t.indexEndValue_=this.indexEndValue_,t.endNameSet_=this.endNameSet_,t.indexEndName_=this.indexEndName_,t.index_=this.index_,t.viewFrom_=this.viewFrom_,t}}function Vp(t){const e={};if(t.isDefault())return e;let s;if(t.index_===wp?s="$priority":t.index_===jp?s="$value":t.index_===np?s="$key":(Ah(t.index_ instanceof Fp,"Unrecognized index type!"),s=t.index_.toString()),e["orderBy"]=pc(s),t.startSet_){const s=t.startAfterSet_?"startAfter":"startAt";e[s]=pc(t.indexStartValue_),t.startNameSet_&&(e[s]+=","+pc(t.indexStartName_))}if(t.endSet_){const s=t.endBeforeSet_?"endBefore":"endAt";e[s]=pc(t.indexEndValue_),t.endNameSet_&&(e[s]+=","+pc(t.indexEndName_))}return t.limitSet_&&(t.isViewFromLeft()?e["limitToFirst"]=t.limit_:e["limitToLast"]=t.limit_),e}function Gp(t){const e={};if(t.startSet_&&(e["sp"]=t.indexStartValue_,t.startNameSet_&&(e["sn"]=t.indexStartName_),e["sin"]=!t.startAfterSet_),t.endSet_&&(e["ep"]=t.indexEndValue_,t.endNameSet_&&(e["en"]=t.indexEndName_),e["ein"]=!t.endBeforeSet_),t.limitSet_){e["l"]=t.limit_;let s=t.viewFrom_;""===s&&(s=t.isViewFromLeft()?"l":"r"),e["vf"]=s}return t.index_!==wp&&(e["i"]=t.index_.toString()),e}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Hp extends bg{reportStats(t){throw new Error("Method not implemented.")}static getListenId_(t,e){return void 0!==e?"tag$"+e:(Ah(t._queryParams.isDefault(),"should have a tag if it's not a default query."),t._path.toString())}constructor(t,e,s,i){super(),this.repoInfo_=t,this.onDataUpdate_=e,this.authTokenProvider_=s,this.appCheckTokenProvider_=i,this.log_=Yu("p:rest:"),this.listens_={}}listen(t,e,s,i){const n=t._path.toString();this.log_("Listen called for "+n+" "+t._queryIdentifier);const r=Hp.getListenId_(t,s),o={};this.listens_[r]=o;const a=Vp(t._queryParams);this.restRequest_(n+".json",a,((t,e)=>{let a=e;if(404===t&&(a=null,t=null),null===t&&this.onDataUpdate_(n,a,!1,s),yc(this.listens_,r)===o){let e;e=t?401===t?"permission_denied":"rest_error:"+t:"ok",i(e,null)}}))}unlisten(t,e){const s=Hp.getListenId_(t,e);delete this.listens_[s]}get(t){const e=Vp(t._queryParams),s=t._path.toString(),i=new zh;return this.restRequest_(s+".json",e,((t,e)=>{let n=e;404===t&&(n=null,t=null),null===t?(this.onDataUpdate_(s,n,!1,null),i.resolve(n)):i.reject(new Error(n))})),i.promise}refreshAuthToken(t){}restRequest_(t,e={},s){return e["format"]="export",Promise.all([this.authTokenProvider_.getToken(!1),this.appCheckTokenProvider_.getToken(!1)]).then((([i,n])=>{i&&i.accessToken&&(e["auth"]=i.accessToken),n&&n.token&&(e["ac"]=n.token);const r=(this.repoInfo_.secure?"https://":"http://")+this.repoInfo_.host+t+"?ns="+this.repoInfo_.namespace+Sc(e);this.log_("Sending REST request for "+r);const o=new XMLHttpRequest;o.onreadystatechange=()=>{if(s&&4===o.readyState){this.log_("REST Response for "+r+" received. status:",o.status,"response:",o.responseText);let t=null;if(o.status>=200&&o.status<300){try{t=gc(o.responseText)}catch(c){Gu("Failed to parse JSON response for "+r+": "+o.responseText)}s(null,t)}else 401!==o.status&&404!==o.status&&Gu("Got unsuccessful REST response for "+r+" Status: "+o.status),s(o.status);s=null}},o.open("GET",r,!0),o.send()}))}}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class zp{constructor(){this.rootNode_=Dp.EMPTY_NODE}getNode(t){return this.rootNode_.getChild(t)}updateSnapshot(t,e){this.rootNode_=this.rootNode_.updateChild(t,e)}}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function qp(){return{value:null,children:new Map}}function Kp(t,e,s){if(Lg(e))t.value=s,t.children.clear();else if(null!==t.value)t.value=t.value.updateChild(e,s);else{const i=Eg(e);t.children.has(i)||t.children.set(i,qp());const n=t.children.get(i);e=Dg(e),Kp(n,e,s)}}function Qp(t,e,s){null!==t.value?s(e,t.value):Jp(t,((t,i)=>{const n=new kg(e.toString()+"/"+t);Qp(i,n,s)}))}function Jp(t,e){t.children.forEach(((t,s)=>{e(s,t)}))}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Zp{constructor(t){this.collection_=t,this.last_=null}get(){const t=this.collection_.get(),e=Object.assign({},t);return this.last_&&sd(this.last_,((t,s)=>{e[t]=e[t]-s})),this.last_=t,e}}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const $p=1e4,tf=3e4,ef=3e5;class sf{constructor(t,e){this.server_=e,this.statsToReport_={},this.statsListener_=new Zp(t);const s=$p+(tf-$p)*Math.random();dd(this.reportStats_.bind(this),Math.floor(s))}reportStats_(){const t=this.statsListener_.get(),e={};let s=!1;sd(t,((t,i)=>{i>0&&vc(this.statsToReport_,t)&&(e[t]=i,s=!0)})),s&&this.server_.reportStats(e),dd(this.reportStats_.bind(this),Math.floor(2*Math.random()*ef))}}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var nf;function rf(){return{fromUser:!0,fromServer:!1,queryId:null,tagged:!1}}function of(){return{fromUser:!1,fromServer:!0,queryId:null,tagged:!1}}function af(t){return{fromUser:!1,fromServer:!0,queryId:t,tagged:!0}}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */(function(t){t[t["OVERWRITE"]=0]="OVERWRITE",t[t["MERGE"]=1]="MERGE",t[t["ACK_USER_WRITE"]=2]="ACK_USER_WRITE",t[t["LISTEN_COMPLETE"]=3]="LISTEN_COMPLETE"})(nf||(nf={}));class hf{constructor(t,e,s){this.path=t,this.affectedTree=e,this.revert=s,this.type=nf.ACK_USER_WRITE,this.source=rf()}operationForChild(t){if(Lg(this.path)){if(null!=this.affectedTree.value)return Ah(this.affectedTree.children.isEmpty(),"affectedTree should not have overlapping affected paths."),this;{const e=this.affectedTree.subtree(new kg(t));return new hf(Ag(),e,this.revert)}}return Ah(Eg(this.path)===t,"operationForChild called for unrelated child."),new hf(Dg(this.path),this.affectedTree,this.revert)}}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
class cf{constructor(t,e,s){this.source=t,this.path=e,this.snap=s,this.type=nf.OVERWRITE}operationForChild(t){return Lg(this.path)?new cf(this.source,Ag(),this.snap.getImmediateChild(t)):new cf(this.source,Dg(this.path),this.snap)}}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class lf{constructor(t,e,s){this.source=t,this.path=e,this.children=s,this.type=nf.MERGE}operationForChild(t){if(Lg(this.path)){const e=this.children.subtree(new kg(t));return e.isEmpty()?null:e.value?new cf(this.source,Ag(),e.value):new lf(this.source,Ag(),e)}return Ah(Eg(this.path)===t,"Can't get a merge for a child not on the path of the operation"),new lf(this.source,Dg(this.path),this.children)}toString(){return"Operation("+this.path+": "+this.source.toString()+" merge: "+this.children.toString()+")"}}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class uf{constructor(t,e,s){this.node_=t,this.fullyInitialized_=e,this.filtered_=s}isFullyInitialized(){return this.fullyInitialized_}isFiltered(){return this.filtered_}isCompleteForPath(t){if(Lg(t))return this.isFullyInitialized()&&!this.filtered_;const e=Eg(t);return this.isCompleteForChild(e)}isCompleteForChild(t){return this.isFullyInitialized()&&!this.filtered_||this.node_.hasChild(t)}getNode(){return this.node_}}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function df(t,e,s,i){const n=[],r=[];return e.forEach((e=>{"child_changed"===e.type&&t.index_.indexedValueChanged(e.oldSnap,e.snapshotNode)&&r.push(Yp(e.childName,e.snapshotNode))})),gf(t,n,"child_removed",e,i,s),gf(t,n,"child_added",e,i,s),gf(t,n,"child_moved",r,i,s),gf(t,n,"child_changed",e,i,s),gf(t,n,"value",e,i,s),n}function gf(t,e,s,i,n,r){const o=i.filter((t=>t.type===s));o.sort(((e,s)=>ff(t,e,s))),o.forEach((s=>{const i=pf(t,s,r);n.forEach((n=>{n.respondsTo(s.type)&&e.push(n.createEvent(i,t.query_))}))}))}function pf(t,e,s){return"value"===e.type||"child_removed"===e.type||(e.prevName=s.getPredecessorChildName(e.childName,e.snapshotNode,t.index_)),e}function ff(t,e,s){if(null==e.childName||null==s.childName)throw Eh("Should only compare child_ events.");const i=new tp(e.childName,e.snapshotNode),n=new tp(s.childName,s.snapshotNode);return t.index_.compare(i,n)}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function mf(t,e){return{eventCache:t,serverCache:e}}function _f(t,e,s,i){return mf(new uf(e,s,i),t.serverCache)}function vf(t,e,s,i){return mf(t.eventCache,new uf(e,s,i))}function yf(t){return t.eventCache.isFullyInitialized()?t.eventCache.getNode():null}function Cf(t){return t.serverCache.isFullyInitialized()?t.serverCache.getNode():null}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let bf;const wf=()=>(bf||(bf=new hp(Zu)),bf);class xf{static fromObject(t){let e=new xf(null);return sd(t,((t,s)=>{e=e.set(new kg(t),s)})),e}constructor(t,e=wf()){this.value=t,this.children=e}isEmpty(){return null===this.value&&this.children.isEmpty()}findRootMostMatchingPathAndValue(t,e){if(null!=this.value&&e(this.value))return{path:Ag(),value:this.value};if(Lg(t))return null;{const s=Eg(t),i=this.children.get(s);if(null!==i){const n=i.findRootMostMatchingPathAndValue(Dg(t),e);if(null!=n){const t=Fg(new kg(s),n.path);return{path:t,value:n.value}}return null}return null}}findRootMostValueAndPath(t){return this.findRootMostMatchingPathAndValue(t,(()=>!0))}subtree(t){if(Lg(t))return this;{const e=Eg(t),s=this.children.get(e);return null!==s?s.subtree(Dg(t)):new xf(null)}}set(t,e){if(Lg(t))return new xf(e,this.children);{const s=Eg(t),i=this.children.get(s)||new xf(null),n=i.set(Dg(t),e),r=this.children.insert(s,n);return new xf(this.value,r)}}remove(t){if(Lg(t))return this.children.isEmpty()?new xf(null):new xf(null,this.children);{const e=Eg(t),s=this.children.get(e);if(s){const i=s.remove(Dg(t));let n;return n=i.isEmpty()?this.children.remove(e):this.children.insert(e,i),null===this.value&&n.isEmpty()?new xf(null):new xf(this.value,n)}return this}}get(t){if(Lg(t))return this.value;{const e=Eg(t),s=this.children.get(e);return s?s.get(Dg(t)):null}}setTree(t,e){if(Lg(t))return e;{const s=Eg(t),i=this.children.get(s)||new xf(null),n=i.setTree(Dg(t),e);let r;return r=n.isEmpty()?this.children.remove(s):this.children.insert(s,n),new xf(this.value,r)}}fold(t){return this.fold_(Ag(),t)}fold_(t,e){const s={};return this.children.inorderTraversal(((i,n)=>{s[i]=n.fold_(Fg(t,i),e)})),e(t,this.value,s)}findOnPath(t,e){return this.findOnPath_(t,Ag(),e)}findOnPath_(t,e,s){const i=!!this.value&&s(e,this.value);if(i)return i;if(Lg(t))return null;{const i=Eg(t),n=this.children.get(i);return n?n.findOnPath_(Dg(t),Fg(e,i),s):null}}foreachOnPath(t,e){return this.foreachOnPath_(t,Ag(),e)}foreachOnPath_(t,e,s){if(Lg(t))return this;{this.value&&s(e,this.value);const i=Eg(t),n=this.children.get(i);return n?n.foreachOnPath_(Dg(t),Fg(e,i),s):new xf(null)}}foreach(t){this.foreach_(Ag(),t)}foreach_(t,e){this.children.inorderTraversal(((s,i)=>{i.foreach_(Fg(t,s),e)})),this.value&&e(t,this.value)}foreachChild(t){this.children.inorderTraversal(((e,s)=>{s.value&&t(e,s.value)}))}}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Sf{constructor(t){this.writeTree_=t}static empty(){return new Sf(new xf(null))}}function Tf(t,e,s){if(Lg(e))return new Sf(new xf(s));{const i=t.writeTree_.findRootMostValueAndPath(e);if(null!=i){const n=i.path;let r=i.value;const o=jg(n,e);return r=r.updateChild(o,s),new Sf(t.writeTree_.set(n,r))}{const i=new xf(s),n=t.writeTree_.setTree(e,i);return new Sf(n)}}}function kf(t,e,s){let i=t;return sd(s,((t,s)=>{i=Tf(i,Fg(e,t),s)})),i}function Af(t,e){if(Lg(e))return Sf.empty();{const s=t.writeTree_.setTree(e,new xf(null));return new Sf(s)}}function Ef(t,e){return null!=Of(t,e)}function Of(t,e){const s=t.writeTree_.findRootMostValueAndPath(e);return null!=s?t.writeTree_.get(s.path).getChild(jg(s.path,e)):null}function Df(t){const e=[],s=t.writeTree_.value;return null!=s?s.isLeafNode()||s.forEachChild(wp,((t,s)=>{e.push(new tp(t,s))})):t.writeTree_.children.inorderTraversal(((t,s)=>{null!=s.value&&e.push(new tp(t,s.value))})),e}function Pf(t,e){if(Lg(e))return t;{const s=Of(t,e);return new Sf(null!=s?new xf(s):t.writeTree_.subtree(e))}}function If(t){return t.writeTree_.isEmpty()}function Mf(t,e){return Rf(Ag(),t.writeTree_,e)}function Rf(t,e,s){if(null!=e.value)return s.updateChild(t,e.value);{let i=null;return e.children.inorderTraversal(((e,n)=>{".priority"===e?(Ah(null!==n.value,"Priority writes must always be leaf nodes"),i=n.value):s=Rf(Fg(t,e),n,s)})),s.getChild(t).isEmpty()||null===i||(s=s.updateChild(Fg(t,".priority"),i)),s}}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Ff(t,e){return im(e,t)}function Lf(t,e,s,i,n){Ah(i>t.lastWriteId,"Stacking an older write on top of newer ones"),void 0===n&&(n=!0),t.allWrites.push({path:e,snap:s,writeId:i,visible:n}),n&&(t.visibleWrites=Tf(t.visibleWrites,e,s)),t.lastWriteId=i}function jf(t,e){for(let s=0;s<t.allWrites.length;s++){const i=t.allWrites[s];if(i.writeId===e)return i}return null}function Nf(t,e){const s=t.allWrites.findIndex((t=>t.writeId===e));Ah(s>=0,"removeWrite called with nonexistent writeId.");const i=t.allWrites[s];t.allWrites.splice(s,1);let n=i.visible,r=!1,o=t.allWrites.length-1;while(n&&o>=0){const e=t.allWrites[o];e.visible&&(o>=s&&Bf(e,i.path)?n=!1:Bg(i.path,e.path)&&(r=!0)),o--}if(n){if(r)return Wf(t),!0;if(i.snap)t.visibleWrites=Af(t.visibleWrites,i.path);else{const e=i.children;sd(e,(e=>{t.visibleWrites=Af(t.visibleWrites,Fg(i.path,e))}))}return!0}return!1}function Bf(t,e){if(t.snap)return Bg(t.path,e);for(const s in t.children)if(t.children.hasOwnProperty(s)&&Bg(Fg(t.path,s),e))return!0;return!1}function Wf(t){t.visibleWrites=Yf(t.allWrites,Uf,Ag()),t.allWrites.length>0?t.lastWriteId=t.allWrites[t.allWrites.length-1].writeId:t.lastWriteId=-1}function Uf(t){return t.visible}function Yf(t,e,s){let i=Sf.empty();for(let n=0;n<t.length;++n){const r=t[n];if(e(r)){const t=r.path;let e;if(r.snap)Bg(s,t)?(e=jg(s,t),i=Tf(i,e,r.snap)):Bg(t,s)&&(e=jg(t,s),i=Tf(i,Ag(),r.snap.getChild(e)));else{if(!r.children)throw Eh("WriteRecord should have .snap or .children");if(Bg(s,t))e=jg(s,t),i=kf(i,e,r.children);else if(Bg(t,s))if(e=jg(t,s),Lg(e))i=kf(i,Ag(),r.children);else{const t=yc(r.children,Eg(e));if(t){const s=t.getChild(Dg(e));i=Tf(i,Ag(),s)}}}}}return i}function Xf(t,e,s,i,n){if(i||n){const r=Pf(t.visibleWrites,e);if(!n&&If(r))return s;if(n||null!=s||Ef(r,Ag())){const r=function(t){return(t.visible||n)&&(!i||!~i.indexOf(t.writeId))&&(Bg(t.path,e)||Bg(e,t.path))},o=Yf(t.allWrites,r,e),a=s||Dp.EMPTY_NODE;return Mf(o,a)}return null}{const i=Of(t.visibleWrites,e);if(null!=i)return i;{const i=Pf(t.visibleWrites,e);if(If(i))return s;if(null!=s||Ef(i,Ag())){const t=s||Dp.EMPTY_NODE;return Mf(i,t)}return null}}}function Vf(t,e,s){let i=Dp.EMPTY_NODE;const n=Of(t.visibleWrites,e);if(n)return n.isLeafNode()||n.forEachChild(wp,((t,e)=>{i=i.updateImmediateChild(t,e)})),i;if(s){const n=Pf(t.visibleWrites,e);return s.forEachChild(wp,((t,e)=>{const s=Mf(Pf(n,new kg(t)),e);i=i.updateImmediateChild(t,s)})),Df(n).forEach((t=>{i=i.updateImmediateChild(t.name,t.node)})),i}{const s=Pf(t.visibleWrites,e);return Df(s).forEach((t=>{i=i.updateImmediateChild(t.name,t.node)})),i}}function Gf(t,e,s,i,n){Ah(i||n,"Either existingEventSnap or existingServerSnap must exist");const r=Fg(e,s);if(Ef(t.visibleWrites,r))return null;{const e=Pf(t.visibleWrites,r);return If(e)?n.getChild(s):Mf(e,n.getChild(s))}}function Hf(t,e,s,i){const n=Fg(e,s),r=Of(t.visibleWrites,n);if(null!=r)return r;if(i.isCompleteForChild(s)){const e=Pf(t.visibleWrites,n);return Mf(e,i.getNode().getImmediateChild(s))}return null}function zf(t,e){return Of(t.visibleWrites,e)}function qf(t,e,s,i,n,r,o){let a;const h=Pf(t.visibleWrites,e),c=Of(h,Ag());if(null!=c)a=c;else{if(null==s)return[];a=Mf(h,s)}if(a=a.withIndex(o),a.isEmpty()||a.isLeafNode())return[];{const t=[],e=o.getCompare(),s=r?a.getReverseIteratorFrom(i,o):a.getIteratorFrom(i,o);let h=s.getNext();while(h&&t.length<n)0!==e(h,i)&&t.push(h),h=s.getNext();return t}}function Kf(){return{visibleWrites:Sf.empty(),allWrites:[],lastWriteId:-1}}function Qf(t,e,s,i){return Xf(t.writeTree,t.treePath,e,s,i)}function Jf(t,e){return Vf(t.writeTree,t.treePath,e)}function Zf(t,e,s,i){return Gf(t.writeTree,t.treePath,e,s,i)}function $f(t,e){return zf(t.writeTree,Fg(t.treePath,e))}function tm(t,e,s,i,n,r){return qf(t.writeTree,t.treePath,e,s,i,n,r)}function em(t,e,s){return Hf(t.writeTree,t.treePath,e,s)}function sm(t,e){return im(Fg(t.treePath,e),t.writeTree)}function im(t,e){return{treePath:t,writeTree:e}}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class nm{constructor(){this.changeMap=new Map}trackChildChange(t){const e=t.type,s=t.childName;Ah("child_added"===e||"child_changed"===e||"child_removed"===e,"Only child changes supported for tracking"),Ah(".priority"!==s,"Only non-priority child changes can be tracked.");const i=this.changeMap.get(s);if(i){const n=i.type;if("child_added"===e&&"child_removed"===n)this.changeMap.set(s,Up(s,t.snapshotNode,i.snapshotNode));else if("child_removed"===e&&"child_added"===n)this.changeMap.delete(s);else if("child_removed"===e&&"child_changed"===n)this.changeMap.set(s,Wp(s,i.oldSnap));else if("child_changed"===e&&"child_added"===n)this.changeMap.set(s,Bp(s,t.snapshotNode));else{if("child_changed"!==e||"child_changed"!==n)throw Eh("Illegal combination of changes: "+t+" occurred after "+i);this.changeMap.set(s,Up(s,t.snapshotNode,i.oldSnap))}}else this.changeMap.set(s,t)}getChanges(){return Array.from(this.changeMap.values())}}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class rm{getCompleteChild(t){return null}getChildAfterChild(t,e,s){return null}}const om=new rm;class am{constructor(t,e,s=null){this.writes_=t,this.viewCache_=e,this.optCompleteServerCache_=s}getCompleteChild(t){const e=this.viewCache_.eventCache;if(e.isCompleteForChild(t))return e.getNode().getImmediateChild(t);{const e=null!=this.optCompleteServerCache_?new uf(this.optCompleteServerCache_,!0,!1):this.viewCache_.serverCache;return em(this.writes_,t,e)}}getChildAfterChild(t,e,s){const i=null!=this.optCompleteServerCache_?this.optCompleteServerCache_:Cf(this.viewCache_),n=tm(this.writes_,i,e,1,s,t);return 0===n.length?null:n[0]}}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function hm(t,e){Ah(e.eventCache.getNode().isIndexed(t.filter.getIndex()),"Event snap not indexed"),Ah(e.serverCache.getNode().isIndexed(t.filter.getIndex()),"Server snap not indexed")}function cm(t,e,s,i,n){const r=new nm;let o,a;if(s.type===nf.OVERWRITE){const h=s;h.source.fromUser?o=gm(t,e,h.path,h.snap,i,n,r):(Ah(h.source.fromServer,"Unknown source."),a=h.source.tagged||e.serverCache.isFiltered()&&!Lg(h.path),o=dm(t,e,h.path,h.snap,i,n,a,r))}else if(s.type===nf.MERGE){const h=s;h.source.fromUser?o=fm(t,e,h.path,h.children,i,n,r):(Ah(h.source.fromServer,"Unknown source."),a=h.source.tagged||e.serverCache.isFiltered(),o=_m(t,e,h.path,h.children,i,n,a,r))}else if(s.type===nf.ACK_USER_WRITE){const a=s;o=a.revert?Cm(t,e,a.path,i,n,r):vm(t,e,a.path,a.affectedTree,i,n,r)}else{if(s.type!==nf.LISTEN_COMPLETE)throw Eh("Unknown operation type: "+s.type);o=ym(t,e,s.path,i,r)}const h=r.getChanges();return lm(e,o,h),{viewCache:o,changes:h}}function lm(t,e,s){const i=e.eventCache;if(i.isFullyInitialized()){const n=i.getNode().isLeafNode()||i.getNode().isEmpty(),r=yf(t);(s.length>0||!t.eventCache.isFullyInitialized()||n&&!i.getNode().equals(r)||!i.getNode().getPriority().equals(r.getPriority()))&&s.push(Np(yf(e)))}}function um(t,e,s,i,n,r){const o=e.eventCache;if(null!=$f(i,s))return e;{let a,h;if(Lg(s))if(Ah(e.serverCache.isFullyInitialized(),"If change path is empty, we must have complete server data"),e.serverCache.isFiltered()){const s=Cf(e),n=s instanceof Dp?s:Dp.EMPTY_NODE,o=Jf(i,n);a=t.filter.updateFullNode(e.eventCache.getNode(),o,r)}else{const s=Qf(i,Cf(e));a=t.filter.updateFullNode(e.eventCache.getNode(),s,r)}else{const c=Eg(s);if(".priority"===c){Ah(1===Og(s),"Can't have a priority with additional path components");const n=o.getNode();h=e.serverCache.getNode();const r=Zf(i,s,n,h);a=null!=r?t.filter.updatePriority(n,r):o.getNode()}else{const l=Dg(s);let u;if(o.isCompleteForChild(c)){h=e.serverCache.getNode();const t=Zf(i,s,o.getNode(),h);u=null!=t?o.getNode().getImmediateChild(c).updateChild(l,t):o.getNode().getImmediateChild(c)}else u=em(i,c,e.serverCache);a=null!=u?t.filter.updateChild(o.getNode(),c,u,l,n,r):o.getNode()}}return _f(e,a,o.isFullyInitialized()||Lg(s),t.filter.filtersNodes())}}function dm(t,e,s,i,n,r,o,a){const h=e.serverCache;let c;const l=o?t.filter:t.filter.getIndexedFilter();if(Lg(s))c=l.updateFullNode(h.getNode(),i,null);else if(l.filtersNodes()&&!h.isFiltered()){const t=h.getNode().updateChild(s,i);c=l.updateFullNode(h.getNode(),t,null)}else{const t=Eg(s);if(!h.isCompleteForPath(s)&&Og(s)>1)return e;const n=Dg(s),r=h.getNode().getImmediateChild(t),o=r.updateChild(n,i);c=".priority"===t?l.updatePriority(h.getNode(),o):l.updateChild(h.getNode(),t,o,n,om,null)}const u=vf(e,c,h.isFullyInitialized()||Lg(s),l.filtersNodes()),d=new am(n,u,r);return um(t,u,s,n,d,a)}function gm(t,e,s,i,n,r,o){const a=e.eventCache;let h,c;const l=new am(n,e,r);if(Lg(s))c=t.filter.updateFullNode(e.eventCache.getNode(),i,o),h=_f(e,c,!0,t.filter.filtersNodes());else{const n=Eg(s);if(".priority"===n)c=t.filter.updatePriority(e.eventCache.getNode(),i),h=_f(e,c,a.isFullyInitialized(),a.isFiltered());else{const r=Dg(s),c=a.getNode().getImmediateChild(n);let u;if(Lg(r))u=i;else{const t=l.getCompleteChild(n);u=null!=t?".priority"===Pg(r)&&t.getChild(Rg(r)).isEmpty()?t:t.updateChild(r,i):Dp.EMPTY_NODE}if(c.equals(u))h=e;else{const s=t.filter.updateChild(a.getNode(),n,u,r,l,o);h=_f(e,s,a.isFullyInitialized(),t.filter.filtersNodes())}}}return h}function pm(t,e){return t.eventCache.isCompleteForChild(e)}function fm(t,e,s,i,n,r,o){let a=e;return i.foreach(((i,h)=>{const c=Fg(s,i);pm(e,Eg(c))&&(a=gm(t,a,c,h,n,r,o))})),i.foreach(((i,h)=>{const c=Fg(s,i);pm(e,Eg(c))||(a=gm(t,a,c,h,n,r,o))})),a}function mm(t,e,s){return s.foreach(((t,s)=>{e=e.updateChild(t,s)})),e}function _m(t,e,s,i,n,r,o,a){if(e.serverCache.getNode().isEmpty()&&!e.serverCache.isFullyInitialized())return e;let h,c=e;h=Lg(s)?i:new xf(null).setTree(s,i);const l=e.serverCache.getNode();return h.children.inorderTraversal(((s,i)=>{if(l.hasChild(s)){const h=e.serverCache.getNode().getImmediateChild(s),l=mm(t,h,i);c=dm(t,c,new kg(s),l,n,r,o,a)}})),h.children.inorderTraversal(((s,i)=>{const h=!e.serverCache.isCompleteForChild(s)&&null===i.value;if(!l.hasChild(s)&&!h){const h=e.serverCache.getNode().getImmediateChild(s),l=mm(t,h,i);c=dm(t,c,new kg(s),l,n,r,o,a)}})),c}function vm(t,e,s,i,n,r,o){if(null!=$f(n,s))return e;const a=e.serverCache.isFiltered(),h=e.serverCache;if(null!=i.value){if(Lg(s)&&h.isFullyInitialized()||h.isCompleteForPath(s))return dm(t,e,s,h.getNode().getChild(s),n,r,a,o);if(Lg(s)){let i=new xf(null);return h.getNode().forEachChild(np,((t,e)=>{i=i.set(new kg(t),e)})),_m(t,e,s,i,n,r,a,o)}return e}{let c=new xf(null);return i.foreach(((t,e)=>{const i=Fg(s,t);h.isCompleteForPath(i)&&(c=c.set(t,h.getNode().getChild(i)))})),_m(t,e,s,c,n,r,a,o)}}function ym(t,e,s,i,n){const r=e.serverCache,o=vf(e,r.getNode(),r.isFullyInitialized()||Lg(s),r.isFiltered());return um(t,o,s,i,om,n)}function Cm(t,e,s,i,n,r){let o;if(null!=$f(i,s))return e;{const a=new am(i,e,n),h=e.eventCache.getNode();let c;if(Lg(s)||".priority"===Eg(s)){let s;if(e.serverCache.isFullyInitialized())s=Qf(i,Cf(e));else{const t=e.serverCache.getNode();Ah(t instanceof Dp,"serverChildren would be complete if leaf node"),s=Jf(i,t)}c=t.filter.updateFullNode(h,s,r)}else{const n=Eg(s);let l=em(i,n,e.serverCache);null==l&&e.serverCache.isCompleteForChild(n)&&(l=h.getImmediateChild(n)),c=null!=l?t.filter.updateChild(h,n,l,Dg(s),a,r):e.eventCache.getNode().hasChild(n)?t.filter.updateChild(h,n,Dp.EMPTY_NODE,Dg(s),a,r):h,c.isEmpty()&&e.serverCache.isFullyInitialized()&&(o=Qf(i,Cf(e)),o.isLeafNode()&&(c=t.filter.updateFullNode(c,o,r)))}return o=e.serverCache.isFullyInitialized()||null!=$f(i,Ag()),_f(e,c,o,t.filter.filtersNodes())}}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function bm(t,e){const s=Cf(t.viewCache_);return s&&(t.query._queryParams.loadsAllData()||!Lg(e)&&!s.getImmediateChild(Eg(e)).isEmpty())?s.getChild(e):null}function wm(t,e,s,i){e.type===nf.MERGE&&null!==e.source.queryId&&(Ah(Cf(t.viewCache_),"We should always have a full cache before handling merges"),Ah(yf(t.viewCache_),"Missing event cache, even though we have a server cache"));const n=t.viewCache_,r=cm(t.processor_,n,e,s,i);return hm(t.processor_,r.viewCache),Ah(r.viewCache.serverCache.isFullyInitialized()||!n.serverCache.isFullyInitialized(),"Once a server snap is complete, it should never go back"),t.viewCache_=r.viewCache,xm(t,r.changes,r.viewCache.eventCache.getNode(),null)}function xm(t,e,s,i){const n=i?[i]:t.eventRegistrations_;return df(t.eventGenerator_,e,s,n)}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let Sm,Tm;function km(t){Ah(!Sm,"__referenceConstructor has already been defined"),Sm=t}function Am(t,e,s,i){const n=e.source.queryId;if(null!==n){const r=t.views.get(n);return Ah(null!=r,"SyncTree gave us an op for an invalid query."),wm(r,e,s,i)}{let n=[];for(const r of t.views.values())n=n.concat(wm(r,e,s,i));return n}}function Em(t,e){let s=null;for(const i of t.views.values())s=s||bm(i,e);return s}function Om(t){Ah(!Tm,"__referenceConstructor has already been defined"),Tm=t}class Dm{constructor(t){this.listenProvider_=t,this.syncPointTree_=new xf(null),this.pendingWriteTree_=Kf(),this.tagToQueryMap=new Map,this.queryToTagMap=new Map}}function Pm(t,e,s,i,n){return Lf(t.pendingWriteTree_,e,s,i,n),n?Nm(t,new cf(rf(),e,s)):[]}function Im(t,e,s=!1){const i=jf(t.pendingWriteTree_,e),n=Nf(t.pendingWriteTree_,e);if(n){let e=new xf(null);return null!=i.snap?e=e.set(Ag(),!0):sd(i.children,(t=>{e=e.set(new kg(t),!0)})),Nm(t,new hf(i.path,e,s))}return[]}function Mm(t,e,s){return Nm(t,new cf(of(),e,s))}function Rm(t,e,s){const i=xf.fromObject(s);return Nm(t,new lf(of(),e,i))}function Fm(t,e,s,i){const n=Um(t,i);if(null!=n){const i=Ym(n),r=i.path,o=i.queryId,a=jg(r,e),h=new cf(af(o),a,s);return Xm(t,r,h)}return[]}function Lm(t,e,s,i){const n=Um(t,i);if(n){const i=Ym(n),r=i.path,o=i.queryId,a=jg(r,e),h=xf.fromObject(s),c=new lf(af(o),a,h);return Xm(t,r,c)}return[]}function jm(t,e,s){const i=!0,n=t.pendingWriteTree_,r=t.syncPointTree_.findOnPath(e,((t,s)=>{const i=jg(t,e),n=Em(s,i);if(n)return n}));return Xf(n,e,r,s,i)}function Nm(t,e){return Bm(e,t.syncPointTree_,null,Ff(t.pendingWriteTree_,Ag()))}function Bm(t,e,s,i){if(Lg(t.path))return Wm(t,e,s,i);{const n=e.get(Ag());null==s&&null!=n&&(s=Em(n,Ag()));let r=[];const o=Eg(t.path),a=t.operationForChild(o),h=e.children.get(o);if(h&&a){const t=s?s.getImmediateChild(o):null,e=sm(i,o);r=r.concat(Bm(a,h,t,e))}return n&&(r=r.concat(Am(n,t,i,s))),r}}function Wm(t,e,s,i){const n=e.get(Ag());null==s&&null!=n&&(s=Em(n,Ag()));let r=[];return e.children.inorderTraversal(((e,n)=>{const o=s?s.getImmediateChild(e):null,a=sm(i,e),h=t.operationForChild(e);h&&(r=r.concat(Wm(h,n,o,a)))})),n&&(r=r.concat(Am(n,t,i,s))),r}function Um(t,e){return t.tagToQueryMap.get(e)}function Ym(t){const e=t.indexOf("$");return Ah(-1!==e&&e<t.length-1,"Bad queryKey."),{queryId:t.substr(e+1),path:new kg(t.substr(0,e))}}function Xm(t,e,s){const i=t.syncPointTree_.get(e);Ah(i,"Missing sync point for query tag that we're tracking");const n=Ff(t.pendingWriteTree_,e);return Am(i,s,n,null)}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
class Vm{constructor(t){this.node_=t}getImmediateChild(t){const e=this.node_.getImmediateChild(t);return new Vm(e)}node(){return this.node_}}class Gm{constructor(t,e){this.syncTree_=t,this.path_=e}getImmediateChild(t){const e=Fg(this.path_,t);return new Gm(this.syncTree_,e)}node(){return jm(this.syncTree_,this.path_)}}const Hm=function(t){return t=t||{},t["timestamp"]=t["timestamp"]||(new Date).getTime(),t},zm=function(t,e,s){return t&&"object"===typeof t?(Ah(".sv"in t,"Unexpected leaf node or priority contents"),"string"===typeof t[".sv"]?qm(t[".sv"],e,s):"object"===typeof t[".sv"]?Km(t[".sv"],e):void Ah(!1,"Unexpected server value: "+JSON.stringify(t,null,2))):t},qm=function(t,e,s){switch(t){case"timestamp":return s["timestamp"];default:Ah(!1,"Unexpected server value: "+t)}},Km=function(t,e,s){t.hasOwnProperty("increment")||Ah(!1,"Unexpected server value: "+JSON.stringify(t,null,2));const i=t["increment"];"number"!==typeof i&&Ah(!1,"Unexpected increment value: "+i);const n=e.node();if(Ah(null!==n&&"undefined"!==typeof n,"Expected ChildrenNode.EMPTY_NODE for nulls"),!n.isLeafNode())return i;const r=n,o=r.getValue();return"number"!==typeof o?i:o+i},Qm=function(t,e,s,i){return Zm(e,new Gm(s,t),i)},Jm=function(t,e,s){return Zm(t,new Vm(e),s)};function Zm(t,e,s){const i=t.getPriority().val(),n=zm(i,e.getImmediateChild(".priority"),s);let r;if(t.isLeafNode()){const i=t,r=zm(i.getValue(),e,s);return r!==i.getValue()||n!==i.getPriority().val()?new vp(r,Rp(n)):t}{const i=t;return r=i,n!==i.getPriority().val()&&(r=r.updatePriority(new vp(n))),i.forEachChild(wp,((t,i)=>{const n=Zm(i,e.getImmediateChild(t),s);n!==i&&(r=r.updateImmediateChild(t,n))})),r}}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class $m{constructor(t="",e=null,s={children:{},childCount:0}){this.name=t,this.parent=e,this.node=s}}function t_(t,e){let s=e instanceof kg?e:new kg(e),i=t,n=Eg(s);while(null!==n){const t=yc(i.node.children,n)||{children:{},childCount:0};i=new $m(n,i,t),s=Dg(s),n=Eg(s)}return i}function e_(t){return t.node.value}function s_(t,e){t.node.value=e,c_(t)}function i_(t){return t.node.childCount>0}function n_(t){return void 0===e_(t)&&!i_(t)}function r_(t,e){sd(t.node.children,((s,i)=>{e(new $m(s,t,i))}))}function o_(t,e,s,i){s&&!i&&e(t),r_(t,(t=>{o_(t,e,!0,i)})),s&&i&&e(t)}function a_(t,e,s){let i=s?t:t.parent;while(null!==i){if(e(i))return!0;i=i.parent}return!1}function h_(t){return new kg(null===t.parent?t.name:h_(t.parent)+"/"+t.name)}function c_(t){null!==t.parent&&l_(t.parent,t.name,t)}function l_(t,e,s){const i=n_(s),n=vc(t.node.children,e);i&&n?(delete t.node.children[e],t.node.childCount--,c_(t)):i||n||(t.node.children[e]=s.node,t.node.childCount++,c_(t))}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const u_=/[\[\].#$\/\u0000-\u001F\u007F]/,d_=/[\[\].#$\u0000-\u001F\u007F]/,g_=10485760,p_=function(t){return"string"===typeof t&&0!==t.length&&!u_.test(t)},f_=function(t){return"string"===typeof t&&0!==t.length&&!d_.test(t)},m_=function(t){return t&&(t=t.replace(/^\/*\.info(\/|$)/,"/")),f_(t)},__=function(t,e,s){const i=s instanceof kg?new Wg(s,t):s;if(void 0===e)throw new Error(t+"contains undefined "+Vg(i));if("function"===typeof e)throw new Error(t+"contains a function "+Vg(i)+" with contents = "+e.toString());if(zu(e))throw new Error(t+"contains "+e.toString()+" "+Vg(i));if("string"===typeof e&&e.length>g_/3&&Ec(e)>g_)throw new Error(t+"contains a string greater than "+g_+" utf8 bytes "+Vg(i)+" ('"+e.substring(0,50)+"...')");if(e&&"object"===typeof e){let s=!1,n=!1;if(sd(e,((e,r)=>{if(".value"===e)s=!0;else if(".priority"!==e&&".sv"!==e&&(n=!0,!p_(e)))throw new Error(t+" contains an invalid key ("+e+") "+Vg(i)+'.  Keys must be non-empty strings and can\'t contain ".", "#", "$", "/", "[", or "]"');Ug(i,e),__(t,r,i),Yg(i)})),s&&n)throw new Error(t+' contains ".value" child '+Vg(i)+" in addition to actual children.")}},v_=function(t,e){const s=e.path.toString();if("string"!==typeof e.repoInfo.host||0===e.repoInfo.host.length||!p_(e.repoInfo.namespace)&&"localhost"!==e.repoInfo.host.split(":")[0]||0!==s.length&&!m_(s))throw new Error(kc(t,"url")+'must be a valid firebase URL and the path can\'t contain ".", "#", "$", "[", or "]".')};
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
class y_{constructor(){this.eventLists_=[],this.recursionDepth_=0}}function C_(t,e){let s=null;for(let i=0;i<e.length;i++){const n=e[i],r=n.getPath();null===s||Ng(r,s.path)||(t.eventLists_.push(s),s=null),null===s&&(s={events:[],path:r}),s.events.push(n)}s&&t.eventLists_.push(s)}function b_(t,e,s){C_(t,s),w_(t,(t=>Bg(t,e)||Bg(e,t)))}function w_(t,e){t.recursionDepth_++;let s=!0;for(let i=0;i<t.eventLists_.length;i++){const n=t.eventLists_[i];if(n){const r=n.path;e(r)?(x_(t.eventLists_[i]),t.eventLists_[i]=null):s=!1}}s&&(t.eventLists_=[]),t.recursionDepth_--}function x_(t){for(let e=0;e<t.events.length;e++){const s=t.events[e];if(null!==s){t.events[e]=null;const i=s.getEventRunner();Nu&&Uu("event: "+s.toString()),ld(i)}}}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const S_="repo_interrupt",T_=25;class k_{constructor(t,e,s,i){this.repoInfo_=t,this.forceRestClient_=e,this.authTokenProvider_=s,this.appCheckProvider_=i,this.dataUpdateCount=0,this.statsListener_=null,this.eventQueue_=new y_,this.nextWriteId_=1,this.interceptServerDataCallback_=null,this.onDisconnect_=qp(),this.transactionQueueTree_=new $m,this.persistentConnection_=null,this.key=this.repoInfo_.toURLString()}toString(){return(this.repoInfo_.secure?"https://":"http://")+this.repoInfo_.host}}function A_(t,e,s){if(t.stats_=Md(t.repoInfo_),t.forceRestClient_||ud())t.server_=new Hp(t.repoInfo_,((e,s,i,n)=>{D_(t,e,s,i,n)}),t.authTokenProvider_,t.appCheckProvider_),setTimeout((()=>P_(t,!0)),0);else{if("undefined"!==typeof s&&null!==s){if("object"!==typeof s)throw new Error("Only objects are supported for option databaseAuthVariableOverride");try{pc(s)}catch(c){throw new Error("Invalid authOverride provided: "+c)}}t.persistentConnection_=new $g(t.repoInfo_,e,((e,s,i,n)=>{D_(t,e,s,i,n)}),(e=>{P_(t,e)}),(e=>{I_(t,e)}),t.authTokenProvider_,t.appCheckProvider_,s),t.server_=t.persistentConnection_}t.authTokenProvider_.addTokenChangeListener((e=>{t.server_.refreshAuthToken(e)})),t.appCheckProvider_.addTokenChangeListener((e=>{t.server_.refreshAppCheckToken(e.token)})),t.statsReporter_=Rd(t.repoInfo_,(()=>new sf(t.stats_,t.server_))),t.infoData_=new zp,t.infoSyncTree_=new Dm({startListening:(e,s,i,n)=>{let r=[];const o=t.infoData_.getNode(e._path);return o.isEmpty()||(r=Mm(t.infoSyncTree_,e._path,o),setTimeout((()=>{n("ok")}),0)),r},stopListening:()=>{}}),M_(t,"connected",!1),t.serverSyncTree_=new Dm({startListening:(e,s,i,n)=>(t.server_.listen(e,i,s,((s,i)=>{const r=n(s,i);b_(t.eventQueue_,e._path,r)})),[]),stopListening:(e,s)=>{t.server_.unlisten(e,s)}})}function E_(t){const e=t.infoData_.getNode(new kg(".info/serverTimeOffset")),s=e.val()||0;return(new Date).getTime()+s}function O_(t){return Hm({timestamp:E_(t)})}function D_(t,e,s,i,n){t.dataUpdateCount++;const r=new kg(e);s=t.interceptServerDataCallback_?t.interceptServerDataCallback_(e,s):s;let o=[];if(n)if(i){const e=bc(s,(t=>Rp(t)));o=Lm(t.serverSyncTree_,r,e,n)}else{const e=Rp(s);o=Fm(t.serverSyncTree_,r,e,n)}else if(i){const e=bc(s,(t=>Rp(t)));o=Rm(t.serverSyncTree_,r,e)}else{const e=Rp(s);o=Mm(t.serverSyncTree_,r,e)}let a=r;o.length>0&&(a=U_(t,r)),b_(t.eventQueue_,a,o)}function P_(t,e){M_(t,"connected",e),!1===e&&F_(t)}function I_(t,e){sd(e,((e,s)=>{M_(t,e,s)}))}function M_(t,e,s){const i=new kg("/.info/"+e),n=Rp(s);t.infoData_.updateSnapshot(i,n);const r=Mm(t.infoSyncTree_,i,n);b_(t.eventQueue_,i,r)}function R_(t){return t.nextWriteId_++}function F_(t){j_(t,"onDisconnectEvents");const e=O_(t),s=qp();Qp(t.onDisconnect_,Ag(),((i,n)=>{const r=Qm(i,n,t.serverSyncTree_,e);Kp(s,i,r)}));let i=[];Qp(s,Ag(),((e,s)=>{i=i.concat(Mm(t.serverSyncTree_,e,s));const n=z_(t,e);U_(t,n)})),t.onDisconnect_=qp(),b_(t.eventQueue_,Ag(),i)}function L_(t){t.persistentConnection_&&t.persistentConnection_.interrupt(S_)}function j_(t,...e){let s="";t.persistentConnection_&&(s=t.persistentConnection_.id+":"),Uu(s,...e)}function N_(t,e,s){return jm(t.serverSyncTree_,e,s)||Dp.EMPTY_NODE}function B_(t,e=t.transactionQueueTree_){if(e||H_(t,e),e_(e)){const s=V_(t,e);Ah(s.length>0,"Sending zero length transaction queue");const i=s.every((t=>0===t.status));i&&W_(t,h_(e),s)}else i_(e)&&r_(e,(e=>{B_(t,e)}))}function W_(t,e,s){const i=s.map((t=>t.currentWriteId)),n=N_(t,e,i);let r=n;const o=n.hash();for(let c=0;c<s.length;c++){const t=s[c];Ah(0===t.status,"tryToSendTransactionQueue_: items in queue should all be run."),t.status=1,t.retryCount++;const i=jg(e,t.path);r=r.updateChild(i,t.currentOutputSnapshotRaw)}const a=r.val(!0),h=e;t.server_.put(h.toString(),a,(i=>{j_(t,"transaction put response",{path:h.toString(),status:i});let n=[];if("ok"===i){const i=[];for(let e=0;e<s.length;e++)s[e].status=2,n=n.concat(Im(t.serverSyncTree_,s[e].currentWriteId)),s[e].onComplete&&i.push((()=>s[e].onComplete(null,!0,s[e].currentOutputSnapshotResolved))),s[e].unwatcher();H_(t,t_(t.transactionQueueTree_,e)),B_(t,t.transactionQueueTree_),b_(t.eventQueue_,e,n);for(let t=0;t<i.length;t++)ld(i[t])}else{if("datastale"===i)for(let t=0;t<s.length;t++)3===s[t].status?s[t].status=4:s[t].status=0;else{Gu("transaction at "+h.toString()+" failed: "+i);for(let t=0;t<s.length;t++)s[t].status=4,s[t].abortReason=i}U_(t,e)}}),o)}function U_(t,e){const s=X_(t,e),i=h_(s),n=V_(t,s);return Y_(t,n,i),i}function Y_(t,e,s){if(0===e.length)return;const i=[];let n=[];const r=e.filter((t=>0===t.status)),o=r.map((t=>t.currentWriteId));for(let a=0;a<e.length;a++){const r=e[a],h=jg(s,r.path);let c,l=!1;if(Ah(null!==h,"rerunTransactionsUnderNode_: relativePath should not be null."),4===r.status)l=!0,c=r.abortReason,n=n.concat(Im(t.serverSyncTree_,r.currentWriteId,!0));else if(0===r.status)if(r.retryCount>=T_)l=!0,c="maxretry",n=n.concat(Im(t.serverSyncTree_,r.currentWriteId,!0));else{const s=N_(t,r.path,o);r.currentInputSnapshot=s;const i=e[a].update(s.val());if(void 0!==i){__("transaction failed: Data returned ",i,r.path);let e=Rp(i);const a="object"===typeof i&&null!=i&&vc(i,".priority");a||(e=e.updatePriority(s.getPriority()));const h=r.currentWriteId,c=O_(t),l=Jm(e,s,c);r.currentOutputSnapshotRaw=e,r.currentOutputSnapshotResolved=l,r.currentWriteId=R_(t),o.splice(o.indexOf(h),1),n=n.concat(Pm(t.serverSyncTree_,r.path,l,r.currentWriteId,r.applyLocally)),n=n.concat(Im(t.serverSyncTree_,h,!0))}else l=!0,c="nodata",n=n.concat(Im(t.serverSyncTree_,r.currentWriteId,!0))}b_(t.eventQueue_,s,n),n=[],l&&(e[a].status=2,function(t){setTimeout(t,Math.floor(0))}(e[a].unwatcher),e[a].onComplete&&("nodata"===c?i.push((()=>e[a].onComplete(null,!1,e[a].currentInputSnapshot))):i.push((()=>e[a].onComplete(new Error(c),!1,null)))))}H_(t,t.transactionQueueTree_);for(let a=0;a<i.length;a++)ld(i[a]);B_(t,t.transactionQueueTree_)}function X_(t,e){let s,i=t.transactionQueueTree_;s=Eg(e);while(null!==s&&void 0===e_(i))i=t_(i,s),e=Dg(e),s=Eg(e);return i}function V_(t,e){const s=[];return G_(t,e,s),s.sort(((t,e)=>t.order-e.order)),s}function G_(t,e,s){const i=e_(e);if(i)for(let n=0;n<i.length;n++)s.push(i[n]);r_(e,(e=>{G_(t,e,s)}))}function H_(t,e){const s=e_(e);if(s){let t=0;for(let e=0;e<s.length;e++)2!==s[e].status&&(s[t]=s[e],t++);s.length=t,s_(e,s.length>0?s:void 0)}r_(e,(e=>{H_(t,e)}))}function z_(t,e){const s=h_(X_(t,e)),i=t_(t.transactionQueueTree_,e);return a_(i,(e=>{q_(t,e)})),q_(t,i),o_(i,(e=>{q_(t,e)})),s}function q_(t,e){const s=e_(e);if(s){const i=[];let n=[],r=-1;for(let e=0;e<s.length;e++)3===s[e].status||(1===s[e].status?(Ah(r===e-1,"All SENT items should be at beginning of queue."),r=e,s[e].status=3,s[e].abortReason="set"):(Ah(0===s[e].status,"Unexpected transaction status in abort"),s[e].unwatcher(),n=n.concat(Im(t.serverSyncTree_,s[e].currentWriteId,!0)),s[e].onComplete&&i.push(s[e].onComplete.bind(null,new Error("set"),!1,null))));-1===r?s_(e,void 0):s.length=r+1,b_(t.eventQueue_,h_(e),n);for(let t=0;t<i.length;t++)ld(i[t])}}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function K_(t){let e="";const s=t.split("/");for(let i=0;i<s.length;i++)if(s[i].length>0){let t=s[i];try{t=decodeURIComponent(t.replace(/\+/g," "))}catch(c){}e+="/"+t}return e}function Q_(t){const e={};"?"===t.charAt(0)&&(t=t.substring(1));for(const s of t.split("&")){if(0===s.length)continue;const i=s.split("=");2===i.length?e[decodeURIComponent(i[0])]=decodeURIComponent(i[1]):Gu(`Invalid query segment '${s}' in query '${t}'`)}return e}const J_=function(t,e){const s=Z_(t),i=s.namespace;"firebase.com"===s.domain&&Vu(s.host+" is no longer supported. Please use <YOUR FIREBASE>.firebaseio.com instead"),i&&"undefined"!==i||"localhost"===s.domain||Vu("Cannot parse Firebase url. Please use https://<YOUR FIREBASE>.firebaseio.com"),s.secure||Hu();const n="ws"===s.scheme||"wss"===s.scheme;return{repoInfo:new Ad(s.host,s.secure,i,n,e,"",i!==s.subdomain),path:new kg(s.pathString)}},Z_=function(t){let e="",s="",i="",n="",r="",o=!0,a="https",h=443;if("string"===typeof t){let c=t.indexOf("//");c>=0&&(a=t.substring(0,c-1),t=t.substring(c+2));let l=t.indexOf("/");-1===l&&(l=t.length);let u=t.indexOf("?");-1===u&&(u=t.length),e=t.substring(0,Math.min(l,u)),l<u&&(n=K_(t.substring(l,u)));const d=Q_(t.substring(Math.min(t.length,u)));c=e.indexOf(":"),c>=0?(o="https"===a||"wss"===a,h=parseInt(e.substring(c+1),10)):c=e.length;const g=e.slice(0,c);if("localhost"===g.toLowerCase())s="localhost";else if(g.split(".").length<=2)s=g;else{const t=e.indexOf(".");i=e.substring(0,t).toLowerCase(),s=e.substring(t+1),r=i}"ns"in d&&(r=d["ns"])}return{host:e,port:h,domain:s,subdomain:i,secure:o,scheme:a,pathString:n,namespace:r}},$_="-0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ_abcdefghijklmnopqrstuvwxyz";(function(){let t=0;const e=[]})();
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
class tv{constructor(t,e,s,i){this._repo=t,this._path=e,this._queryParams=s,this._orderByCalled=i}get key(){return Lg(this._path)?null:Pg(this._path)}get ref(){return new ev(this._repo,this._path)}get _queryIdentifier(){const t=Gp(this._queryParams),e=td(t);return"{}"===e?"default":e}get _queryObject(){return Gp(this._queryParams)}isEqual(t){if(t=Oc(t),!(t instanceof tv))return!1;const e=this._repo===t._repo,s=Ng(this._path,t._path),i=this._queryIdentifier===t._queryIdentifier;return e&&s&&i}toJSON(){return this.toString()}toString(){return this._repo.toString()+Ig(this._path)}}class ev extends tv{constructor(t,e){super(t,e,new Xp,!1)}get parent(){const t=Rg(this._path);return null===t?null:new ev(this._repo,t)}get root(){let t=this;while(null!==t.parent)t=t.parent;return t}}km(ev),Om(ev);
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
const sv="FIREBASE_DATABASE_EMULATOR_HOST",iv={};let nv=!1;function rv(t,e,s,i){const n=e.lastIndexOf(":"),r=e.substring(0,n),o=qh(r);t.repoInfo_=new Ad(e,o,t.repoInfo_.namespace,t.repoInfo_.webSocketOnly,t.repoInfo_.nodeAdmin,t.repoInfo_.persistenceKey,t.repoInfo_.includeNamespaceInQueryParams,!0,s),i&&(t.authTokenProvider_=i)}function ov(t,e,s,i,n){let r=i||t.options.databaseURL;void 0===r&&(t.options.projectId||Vu("Can't determine Firebase Database URL. Be sure to include  a Project ID when calling firebase.initializeApp()."),Uu("Using default host for project ",t.options.projectId),r=`${t.options.projectId}-default-rtdb.firebaseio.com`);let o,a,h=J_(r,n),c=h.repoInfo;"undefined"!==typeof process&&(a={NODE_ENV:"production",BASE_URL:"/alien_mood/"}[sv]),a?(o=!0,r=`http://${a}?ns=${c.namespace}`,h=J_(r,n),c=h.repoInfo):o=!h.repoInfo.secure;const l=n&&o?new fd(fd.OWNER):new pd(t.name,t.options,e);v_("Invalid Firebase Database URL",h),Lg(h.path)||Vu("Database URL must point to the root of a Firebase Database (not including a child path).");const u=hv(c,t,l,new gd(t,s));return new cv(u,t)}function av(t,e){const s=iv[e];s&&s[t.key]===t||Vu(`Database ${e}(${t.repoInfo_}) has already been deleted.`),L_(t),delete s[t.key]}function hv(t,e,s,i){let n=iv[e.name];n||(n={},iv[e.name]=n);let r=n[t.toURLString()];return r&&Vu("Database initialized multiple times. Please make sure the format of the database URL matches with each database() call."),r=new k_(t,nv,s,i),n[t.toURLString()]=r,r}class cv{constructor(t,e){this._repoInternal=t,this.app=e,this["type"]="database",this._instanceStarted=!1}get _repo(){return this._instanceStarted||(A_(this._repoInternal,this.app.options.appId,this.app.options["databaseAuthVariableOverride"]),this._instanceStarted=!0),this._repoInternal}get _root(){return this._rootInternal||(this._rootInternal=new ev(this._repo,Ag())),this._rootInternal}_delete(){return null!==this._rootInternal&&(av(this._repo,this.app.name),this._repoInternal=null,this._rootInternal=null),Promise.resolve()}_checkNotDeleted(t){null===this._rootInternal&&Vu("Cannot call "+t+" on a deleted database.")}}function lv(t=nu(),e){const s=Jl(t,"database").getImmediate({identifier:e});if(!s._instanceStarted){const t=Gh("database");t&&uv(s,...t)}return s}function uv(t,e,s,i={}){t=Oc(t),t._checkNotDeleted("useEmulator");const n=`${e}:${s}`,r=t._repoInternal;if(t._instanceStarted){if(n===t._repoInternal.repoInfo_.host&&wc(i,r.repoInfo_.emulatorOptions))return;Vu("connectDatabaseEmulator() cannot initialize or alter the emulator configuration after the database instance has started.")}let o;if(r.repoInfo_.nodeAdmin)i.mockUserToken&&Vu('mockUserToken is not supported by the Admin SDK. For client access with mock users, please use the "firebase" package instead of "firebase-admin".'),o=new fd(fd.OWNER);else if(i.mockUserToken){const e="string"===typeof i.mockUserToken?i.mockUserToken:Qh(i.mockUserToken,t.app.options.projectId);o=new fd(e)}qh(e)&&(Kh(e),ec("Database",!0)),rv(r,n,i,o)}
/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
function dv(t){Eu(su),Ql(new Dc("database",((t,{instanceIdentifier:e})=>{const s=t.getProvider("app").getImmediate(),i=t.getProvider("auth-internal"),n=t.getProvider("app-check-internal");return ov(s,i,n,e)}),"PUBLIC").setMultipleInstances(!0)),ru(Tu,ku,t),ru(Tu,ku,"esm2017")}
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */$g.prototype.simpleListen=function(t,e){this.sendRequest("q",{p:t},e)},$g.prototype.echo=function(t,e){this.sendRequest("echo",{d:t},e)};dv();const gv={apiKey:"AIzaSyDdvQbWbBmkDWSJeivHI01mJTVSnnYctTs",authDomain:"alien-mood.firebaseapp.com",databaseURL:"https://alien-mood-default-rtdb.firebaseio.com",projectId:"alien-mood",storageBucket:"alien-mood.firebasestorage.app",messagingSenderId:"450783398597",appId:"1:450783398597:web:70b656cd69807231633eac",measurementId:"G-F6ZE81HPV7"},pv=iu(gv);lv(pv);var fv=s(1241);var mv=JSON.parse('[{"src":"backround/다가오는솔라스 (1).jpg","label":"배경1"},{"src":"backround/다가오는솔라스 (2).jpg","label":"배경2"},{"src":"backround/다가오는솔라스 (3).jpg","label":"배경3"},{"src":"backround/다가오는솔라스 (4).jpg","label":"배경4"}]'),_v=JSON.parse('[{"src":"sticker/Ae.png","label":"에펙"},{"src":"sticker/Ai.png","label":"일러"},{"src":"sticker/html.png","label":"html"}]'),vv=JSON.parse('{"clothesList":[{"name":"드레스","icon":"clothes/dress.svg","svgUrl":{"인간":"clothes/dress.svg","인간팔":"clothes/dress팔.svg"},"position":{"인간":{"left":0,"top":0},"인간팔":{"left":0,"top":0}},"colorButtons":[{"label":"핑크/파랑","mainColor":"#ff69b4","targets":[{"type":"id","value":"dress_body1","color":"#ff69b4"},{"type":"id","value":"dress_body2","color":"#ff69b4"},{"type":"id","value":"belt","color":"#00bfff"}]},{"label":"핑크/노랑","mainColor":"#ffe066","targets":[{"type":"id","value":"dress_body1","color":"#ff69b4"},{"type":"id","value":"dress_body2","color":"#ff69b4"},{"type":"id","value":"belt","color":"#ffe066"}]},{"label":"노랑/파랑","mainColor":"#00cc44","targets":[{"type":"id","value":"dress_body1","color":"#00cc44"},{"type":"id","value":"dress_body2","color":"#00cc44"},{"type":"id","value":"belt","color":"#00bfff"}]}]},{"name":"셔츠","icon":"clothes/shirt.svg","svgUrl":{"인간":"clothes/shirt.svg","인간팔":"clothes/shirt팔.svg"},"position":{"인간":{"left":0,"top":0},"인간팔":{"left":0,"top":0}},"colorButtons":[{"label":"검정/흰색","mainColor":"#3E3E3EFF","targets":[{"type":"id","value":"main","color":"#3E3E3EFF"},{"type":"id","value":"collar","color":"#DDDDDDFF"}]},{"label":"주황/초록","mainColor":"#FF6969FF","targets":[{"type":"id","value":"main","color":"#FF6969FF"},{"type":"id","value":"collar","color":"#66FF87FF"}]},{"label":"보라/노랑","mainColor":"#C2CC00FF","targets":[{"type":"id","value":"main","color":"#C2CC00FF"},{"type":"id","value":"collar","color":"#5900FFFF"}]}]}]}');const yv=s(8660),Cv=(yv.keys().map(((t,e)=>({src:yv(t),label:`emoji${e+1}`}))),s(5350));function bv(t){try{return Cv("./"+t)}catch{return""}}(mv.default||mv).map((t=>({...t,src:bv(t.src)}))),(_v.default||_v).map((t=>({...t,src:bv(t.src)})));const wv=vv.default||vv,xv=wv.clothesList||[];xv.map((t=>({...t,icon:bv(t.icon),svgUrl:Object.fromEntries(Object.entries(t.svgUrl).map((([t,e])=>[t,bv(e)])))})));var Sv=s(7222);const Tv={class:"mobile-wrapper relative bg-white max-w-[430px] mx-auto min-h-screen select-none"},kv={ref:"canvas",style:{border:"1px solid #ccc",width:"100%",height:"100%"}},Av={key:0},Ev={key:0,class:"h-full px-[30px]"},Ov={class:"flex flex-wrap gap-[15px] h-full pb-[56px] custom-scrollbar-hide",style:{"box-sizing":"border-box"}},Dv=["onClick"],Pv=["src","alt"],Iv={key:1},Mv={class:"avatar-panel"},Rv={class:"flex gap-[34px] h-[32px] leading-[18px] text-[18px] border-b-[1px] border-black-b200"},Fv=["onClick"],Lv={class:"avatar-tab-content"},jv={key:0},Nv={style:{display:"flex",gap:"8px"}},Bv=["onClick"],Wv={key:1},Uv={key:2},Yv={key:3},Xv={key:4},Vv={key:5},Gv={style:{display:"flex",gap:"8px"}},Hv=["onClick"],zv=["src","alt"],qv={key:0,style:{margin:"12px 0"}},Kv=["onClick"],Qv={key:2},Jv={class:"imgBox w-full h-[32px] text-center border-b text-black-b70 border-black-b600"},Zv={class:"flex gap-[15px] mt-2"},$v=["src"],ty=["onClick"],ey={key:0,class:"w-[90px] h-[90px] bg-black-b600 rounded-[2px] cursor-pointer p-0 flex items-center justify-center"},sy={key:3},iy={key:4},ny={key:5},ry=["onClick"],oy=["src","alt"],ay={class:"panel-nav z-100 text-[20px] fixed left-1/2 bottom-0 flex justify-around items-center h-[48px] bg-black-b900/90 w-full max-w-[430px] -translate-x-1/2"},hy=["onClick"];function cy(t,e,s,n,r,a){return(0,i.uX)(),(0,i.CE)("div",Tv,[(0,i.Lk)("canvas",kv,null,512),s.hideUi?(0,i.Q3)("",!0):((0,i.uX)(),(0,i.CE)("div",Av,[(0,i.Lk)("div",{class:"edit-panel z-0 fixed pt-[28px] left-1/2 bottom-0 rounded-t-[28px] w-full max-w-[430px] -translate-x-1/2 bg-black-b700 flex flex-col transition-all duration-300",style:(0,o.Tr)({height:r.panelOpen?"282px":"1000px",transform:r.panelOpen?"translate(-50%, 0)":"translate(-50%, 100%)",overflow:r.panelOpen?"visible":"hidden"}),onTouchstart:e[3]||(e[3]=(...t)=>a.onTouchStart&&a.onTouchStart(...t)),onTouchmove:e[4]||(e[4]=(...t)=>a.onTouchMove&&a.onTouchMove(...t)),onTouchend:e[5]||(e[5]=(...t)=>a.onTouchEnd&&a.onTouchEnd(...t))},[(0,i.Lk)("div",{class:"panel-handle absolute left-1/2 top-[12px] w-[30px] h-[4px] rounded-full cursor-pointer bg-black-b200 -translate-x-1/2 select-none",onClick:e[0]||(e[0]=(...t)=>a.togglePanel&&a.togglePanel(...t))}),(0,i.Lk)("div",{class:"panel-content w-full h-full px-[30px] pb-[12px] flex-1 min-h-0 overflow-y-auto",style:(0,o.Tr)({overflowY:r.panelOpen?"auto":"hidden"})},[0===r.activePanelTab?((0,i.uX)(),(0,i.CE)("div",Ev,[(0,i.Lk)("div",Ov,[((0,i.uX)(!0),(0,i.CE)(i.FK,null,(0,i.pI)(r.backroundList,((t,e)=>((0,i.uX)(),(0,i.CE)("div",{key:"replace-img-"+e,class:"flex-shrink-0 bg-red-50",style:{width:"calc((100% - 30px) / 3)"}},[(0,i.Lk)("button",{onClick:e=>a.replaceDefaultImage(t.src),class:"w-full h-full aspect-square overflow-hidden",style:{padding:"0"}},[(0,i.Lk)("img",{src:t.src,alt:"배경 "+(e+1),class:"w-full h-full object-cover",draggable:"false"},null,8,Pv)],8,Dv)])))),128))])])):1===r.activePanelTab?((0,i.uX)(),(0,i.CE)("div",Iv,[(0,i.Lk)("div",Mv,[(0,i.Lk)("div",Rv,[((0,i.uX)(!0),(0,i.CE)(i.FK,null,(0,i.pI)(r.avatarTabs,((t,e)=>((0,i.uX)(),(0,i.CE)("button",{key:t,class:(0,o.C4)(["flex-1 py-2",r.activeAvatarTab===e?"text-blue-500 border-b-2 border-blue-500":"text-gray-500"]),onClick:t=>r.activeAvatarTab=e},(0,o.v_)(t),11,Fv)))),128))]),(0,i.Lk)("div",Lv,[0===r.activeAvatarTab?((0,i.uX)(),(0,i.CE)("div",jv,[e[6]||(e[6]=(0,i.Lk)("p",null,"자세(포즈) 선택 영역",-1)),(0,i.Lk)("div",Nv,[((0,i.uX)(),(0,i.CE)(i.FK,null,(0,i.pI)(["인간","인간팔"],(t=>(0,i.Lk)("button",{key:t,style:(0,o.Tr)({background:r.currentPose===t?"#00bfff":"#eee",color:r.currentPose===t?"#fff":"#333",border:"1px solid #ccc",borderRadius:"6px",padding:"6px 16px",cursor:"pointer"}),onClick:e=>a.changePose(t)},(0,o.v_)(t),13,Bv))),64))])])):1===r.activeAvatarTab?((0,i.uX)(),(0,i.CE)("div",Wv,e[7]||(e[7]=[(0,i.Lk)("p",null,"얼굴형 선택 영역",-1)]))):2===r.activeAvatarTab?((0,i.uX)(),(0,i.CE)("div",Uv,e[8]||(e[8]=[(0,i.Lk)("p",null,"머리 선택 영역",-1)]))):3===r.activeAvatarTab?((0,i.uX)(),(0,i.CE)("div",Yv,e[9]||(e[9]=[(0,i.Lk)("p",null,"눈 선택 영역",-1)]))):4===r.activeAvatarTab?((0,i.uX)(),(0,i.CE)("div",Xv,e[10]||(e[10]=[(0,i.Lk)("p",null,"입 선택 영역",-1)]))):5===r.activeAvatarTab?((0,i.uX)(),(0,i.CE)("div",Vv,[(0,i.Lk)("div",Gv,[((0,i.uX)(!0),(0,i.CE)(i.FK,null,(0,i.pI)(r.clothesList,(t=>((0,i.uX)(),(0,i.CE)("button",{key:t.name,onClick:e=>a.selectClothes(t),style:{background:"none",border:"none",cursor:"pointer"}},[(0,i.Lk)("img",{src:t.icon,alt:t.name,width:"48",height:"48"},null,8,zv),(0,i.Lk)("div",null,(0,o.v_)(t.name),1)],8,Hv)))),128))]),r.selectedClothes?((0,i.uX)(),(0,i.CE)("div",qv,[((0,i.uX)(!0),(0,i.CE)(i.FK,null,(0,i.pI)(r.selectedClothes.colorButtons,((t,e)=>((0,i.uX)(),(0,i.CE)("button",{key:t.label+e,onClick:s=>a.changeClothesColors(t.targets,r.selectedClothes.name,e),style:{display:"flex","align-items":"center",gap:"8px"}},[t.mainColor?((0,i.uX)(),(0,i.CE)("span",{key:0,style:(0,o.Tr)({display:"inline-block",width:"18px",height:"18px",borderRadius:"50%",background:t.mainColor,border:"1px solid #aaa"})},null,4)):(0,i.Q3)("",!0),(0,i.eW)(" "+(0,o.v_)(t.label),1)],8,Kv)))),128))])):(0,i.Q3)("",!0)])):(0,i.Q3)("",!0)])])])):2===r.activePanelTab?((0,i.uX)(),(0,i.CE)("div",Qv,[(0,i.Lk)("div",Jv,[(0,i.Lk)("span",null,(0,o.v_)(r.imageCount)+"/3",1)]),(0,i.Lk)("div",Zv,[((0,i.uX)(!0),(0,i.CE)(i.FK,null,(0,i.pI)(r.uploadedImages,((t,e)=>((0,i.uX)(),(0,i.CE)("div",{key:t.fabricObj.id||t.url,class:"w-[90px] h-[90px] bg-black-b600 rounded-[2px] flex items-center justify-center relative",style:{position:"relative"}},[(0,i.Lk)("img",{src:t.url,alt:"첨부 이미지",class:"object-cover w-full h-full rounded-[2px]"},null,8,$v),(0,i.Lk)("button",{onClick:t=>a.removePreviewImage(e),style:{position:"absolute",top:"4px",right:"4px",background:"rgba(0, 0, 0, 0.5)","border-radius":"50%",width:"24px",height:"24px",color:"#fff",border:"none","font-size":"18px",cursor:"pointer"},title:"삭제"}," × ",8,ty)])))),128)),r.uploadedImages.length<3?((0,i.uX)(),(0,i.CE)("label",ey,[e[11]||(e[11]=(0,i.Lk)("img",{src:Sv,alt:"이미지 추가",width:"40",height:"40"},null,-1)),(0,i.Lk)("input",{type:"file",accept:"image/*",onChange:e[1]||(e[1]=(...t)=>a.onFileChange&&a.onFileChange(...t)),style:{display:"none"}},null,32)])):(0,i.Q3)("",!0)])])):3===r.activePanelTab?((0,i.uX)(),(0,i.CE)("div",sy,[(0,i.Lk)("button",{onClick:e[2]||(e[2]=(...t)=>a.addTextbox&&a.addTextbox(...t)),class:"w-[300px] h-[42px] bg-black-b600 rounded-[2px] cursor-pointer p-0 flex items-center justify-center",style:{margin:"0 auto"}},e[12]||(e[12]=[(0,i.Lk)("span",{style:{display:"flex","flex-direction":"column","align-items":"center",color:"#fff","font-size":"18px","font-weight":"bold",gap:"8px"}},[(0,i.Lk)("img",{src:Sv,alt:"이미지 추가",width:"40",height:"40"})],-1)]))])):4===r.activePanelTab?((0,i.uX)(),(0,i.CE)("div",iy)):5===r.activePanelTab?((0,i.uX)(),(0,i.CE)("div",ny,[((0,i.uX)(!0),(0,i.CE)(i.FK,null,(0,i.pI)(r.StickerList,(t=>((0,i.uX)(),(0,i.CE)("button",{key:t.src,onClick:e=>a.addSticker(t.src),style:{background:"none",border:"none",cursor:"pointer"}},[(0,i.Lk)("img",{src:t.src,alt:t.label,width:"32",height:"32"},null,8,oy)],8,ry)))),128))])):(0,i.Q3)("",!0)],4)],36),(0,i.Lk)("div",ay,[((0,i.uX)(),(0,i.CE)(i.FK,null,(0,i.pI)(["배경","아바타","사진","텍스트","질문","스티커"],((t,e)=>(0,i.Lk)("button",{key:t,class:(0,o.C4)(["flex-1 h-full",r.activePanelTab===e?"text-green-300 ":"text-black-b100"]),onClick:t=>a.openPanel(e)},(0,o.v_)(t),11,hy))),64))])]))])}var ly=s(4684);const uy=s(8660),dy=(uy.keys().map(((t,e)=>({src:uy(t),label:`emoji${e+1}`}))),s(5350));function gy(t){try{return dy("./"+t)}catch{return""}}const py=(mv.default||mv).map((t=>({...t,src:gy(t.src)}))),fy=(_v.default||_v).map((t=>({...t,src:gy(t.src)}))),my=vv.default||vv,_y=my.clothesList||[],vy=_y.map((t=>({...t,icon:gy(t.icon),svgUrl:Object.fromEntries(Object.entries(t.svgUrl).map((([t,e])=>[t,gy(e)])))})));var yy={props:{hideUi:{type:Boolean,default:!1}},data(){return{canvas:null,isRestoring:!1,backroundList:py,defaultImageObject:null,currentPose:"인간",StickerList:fy,clothesList:vy,selectedClothes:null,selectedColorIndexes:{},avatarTabs:["자세","얼굴형","머리","눈","입","장식"],activeAvatarTab:0,imageCount:0,uploadedImages:[],panelOpen:!0,touchStartY:0,touchMoveY:0,activePanelTab:2}},components:{},methods:{openPanel(t){this.activePanelTab=t,this.panelOpen=!0},togglePanel(){this.panelOpen=!this.panelOpen},onTouchStart(t){this.touchStartY=t.touches[0].clientY},onTouchMove(t){this.touchMoveY=t.touches[0].clientY},onTouchEnd(){const t=this.touchStartY-this.touchMoveY;t>30?this.panelOpen=!0:t<-30&&(this.panelOpen=!1)},async addHumanControlLayer(){if(this.humanControlLayer&&(this.canvas.remove(this.humanControlLayer),this.humanControlLayer=null),!this.humanSvgGroup)return;const t=this.humanSvgGroup.getBoundingRect(),e=new Bn({left:this.humanSvgGroup.left,top:this.humanSvgGroup.top,width:t.width,height:t.height,originX:this.humanSvgGroup.originX,originY:this.humanSvgGroup.originY,fill:"rgba(0,0,0,0)",selectable:!0,evented:!0,hasControls:!1,hasBorders:!1,padding:12});this.addCharacterControls(e),this.canvas.add(e),this.humanControlLayer=e,e.on("moving",(()=>{if(this.humanSvgGroup.set({left:e.left,top:e.top}),this.clothesSvgGroup){const t=this.selectedClothes?.position?.[this.currentPose]||{left:0,top:0};this.clothesSvgGroup.set({left:e.left+t.left*e.scaleX,top:e.top+t.top*e.scaleY})}this.canvas.renderAll()})),e.on("scaling",(()=>{if(this.humanSvgGroup.set({scaleX:e.scaleX,scaleY:e.scaleY,left:e.left,top:e.top}),this.clothesSvgGroup){const t=this.selectedClothes?.position?.[this.currentPose]||{left:0,top:0};this.clothesSvgGroup.set({scaleX:e.scaleX,scaleY:e.scaleY,left:e.left+t.left*e.scaleX,top:e.top+t.top*e.scaleY})}this.canvas.renderAll()})),e.on("rotating",(()=>{this.humanSvgGroup.set({angle:e.angle}),this.clothesSvgGroup&&this.clothesSvgGroup.set({angle:e.angle}),this.canvas.renderAll()})),this.canvas.renderAll()},async addHumanSvg(){let t=100,e=this.canvas.height/2,s=1,i=1,n=0;this.humanSvgGroup&&(t=this.humanSvgGroup.left,e=this.humanSvgGroup.top,s=this.humanSvgGroup.scaleX,i=this.humanSvgGroup.scaleY,n=this.humanSvgGroup.angle,this.canvas.remove(this.humanSvgGroup),this.humanSvgGroup=null);const r="인간팔"===this.currentPose?Sh:xh,o=await ba(r);let a=Rr.groupSVGElements(o.objects);a.set({left:t,top:e,originX:"center",originY:"center",scaleX:s,scaleY:i,angle:n,selectable:!0,evented:!0,hasControls:!1,hasBorders:!1,lockMovementX:!1,lockMovementY:!1,lockScalingX:!1,lockScalingY:!1,lockRotation:!1}),this.addCharacterControls(a),this.canvas.add(a),this.humanSvgGroup=a,this.addHumanMoveListener(),await this.addHumanControlLayer(),this.canvas.renderAll()},async selectClothes(t){this.clothesSvgGroup&&this.canvas.remove(this.clothesSvgGroup);const e="object"===typeof t.svgUrl?t.svgUrl[this.currentPose]||t.svgUrl["인간"]:t.svgUrl,s=await ba(e);let i=Rr.groupSVGElements(s.objects);const n=this.humanSvgGroup,r=t.position?.[this.currentPose]||{left:0,top:0};i.set({left:n.left,top:n.top,originX:n.originX,originY:n.originY,scaleX:n.scaleX,scaleY:n.scaleY,angle:n.angle,selectable:!1,evented:!1,hasControls:!1,hasBorders:!1,lockMovementX:!0,lockMovementY:!0,lockScalingX:!0,lockScalingY:!0,lockRotation:!0}),i.forEachObject((t=>{t.left+=r.left,t.top+=r.top})),i.setCoords(),this.canvas.add(i),this.clothesSvgGroup=i,this.selectedClothes=t,this.canvas.renderAll();const o=this.selectedColorIndexes[t.name]??0,a=t.colorButtons[o];a&&this.changeClothesColors(a.targets,t.name,o),await this.addHumanControlLayer()},addHumanMoveListener(){this.humanSvgGroup&&(this.humanSvgGroup.set({selectable:!0,evented:!0}),this.humanSvgGroup.on("moving",(()=>{if(this.clothesSvgGroup&&this.selectedClothes){const t=this.selectedClothes.position?.[this.currentPose]||{left:0,top:0};this.clothesSvgGroup.set({left:this.humanSvgGroup.left+t.left*this.humanSvgGroup.scaleX,top:this.humanSvgGroup.top+t.top*this.humanSvgGroup.scaleY}),this.canvas.renderAll()}})),this.humanSvgGroup.on("scaling",(()=>{if(this.clothesSvgGroup&&this.selectedClothes){this.clothesSvgGroup.set({scaleX:this.humanSvgGroup.scaleX,scaleY:this.humanSvgGroup.scaleY});const t=this.selectedClothes.position?.[this.currentPose]||{left:0,top:0};this.clothesSvgGroup.set({left:this.humanSvgGroup.left+t.left*this.humanSvgGroup.scaleX,top:this.humanSvgGroup.top+t.top*this.humanSvgGroup.scaleY}),this.canvas.renderAll()}})))},async changePose(t){this.currentPose=t,this.humanSvgGroup&&this.canvas.remove(this.humanSvgGroup),this.clothesSvgGroup&&this.canvas.remove(this.clothesSvgGroup),await this.addHumanSvg(),this.addCharacterControls(this.humanSvgGroup),this.selectedClothes&&await this.selectClothes(this.selectedClothes),await this.addHumanControlLayer()},changeClothesColors(t,e,s){function i(e){e._objects?e._objects.forEach((t=>i(t))):t.forEach((({type:t,value:s,color:i})=>{("id"===t&&(e.id===s||e.get&&e.get("id")===s)||"class"===t&&(e.className===s||e.get&&e.get("class")===s))&&e.set("fill",i)}))}this.clothesSvgGroup&&(i(this.clothesSvgGroup),this.canvas.requestRenderAll(),this.selectedColorIndexes={...this.selectedColorIndexes,[e]:s})},saveCanvasAsImage(){let t=prompt("저장할 파일 이름을 입력하세요.","오늘기분외계인");if(null===t)return;t&&""!==t.trim()||(t="오늘기분외계인"),t.endsWith(".jpg")||t.endsWith(".png")||(t+=".jpg");const e=this.canvas.toDataURL({format:"jpg",quality:1}),s=document.createElement("a");s.href=e,s.download=t,document.body.appendChild(s),s.click(),document.body.removeChild(s)},changeSvgColorsByIds(t){this.svgGroup&&(this.svgGroup.forEachObject((e=>{t.forEach((({id:t,color:s})=>{e.id!==t&&e.get("id")!==t||e.set("fill",s)}))})),this.canvas.requestRenderAll())},renderDeleteIcon(t,e,s,i,n){const r=28,o=12,a=r+2*o,h=new Image;h.src=ly,t.save(),t.translate(e,s),t.rotate(Rr.degreesToRadians(n.angle)),t.globalAlpha=1,t.drawImage(h,-r/2,-r/2,r,r),t.globalAlpha=.01,t.beginPath(),t.arc(0,0,a/2,0,2*Math.PI),t.fillStyle="#000",t.fill(),t.globalAlpha=1,t.restore()},renderRotateIcon(t,e,s,i,n){const r=28,o=12,a=r+2*o,h=new Image;h.src=bh,t.save(),t.translate(e,s),t.rotate(Rr.degreesToRadians(n.angle)),t.globalAlpha=1,t.drawImage(h,-r/2,-r/2,r,r),t.globalAlpha=.01,t.beginPath(),t.arc(0,0,a/2,0,2*Math.PI),t.fillStyle="#000",t.fill(),t.globalAlpha=1,t.restore()},renderResizeIcon(t,e,s,i,n){const r=24,o=12,a=r+2*o,h=new Image;h.src=wh,t.save(),t.translate(e,s),t.rotate(Rr.degreesToRadians(n.angle)),t.globalAlpha=1,t.drawImage(h,-r/2,-r/2,r,r),t.globalAlpha=.01,t.beginPath(),t.arc(0,0,a/2,0,2*Math.PI),t.fillStyle="#000",t.fill(),t.globalAlpha=1,t.restore()},deleteObject(t,e){const s=e.target.canvas;if("i-text"===e.target.type&&e.target._bgRect&&s.contains(e.target._bgRect)&&s.remove(e.target._bgRect),e.target===this.humanControlLayer||e.target===this.humanSvgGroup)return this.humanSvgGroup&&s.contains(this.humanSvgGroup)&&(s.remove(this.humanSvgGroup),this.humanSvgGroup=null),this.clothesSvgGroup&&s.contains(this.clothesSvgGroup)&&(s.remove(this.clothesSvgGroup),this.clothesSvgGroup=null,this.selectedClothes=null),this.humanControlLayer&&s.contains(this.humanControlLayer)&&(s.remove(this.humanControlLayer),this.humanControlLayer=null),void s.requestRenderAll();s.remove(e.target),s.requestRenderAll()},addCharacterControls(t){t.setControlsVisibility({tl:!1,tr:!1,bl:!1,br:!1,mt:!1,mb:!1,ml:!1,mr:!1,mtr:!0,deleteControl:!0,rotateControl:!0,resizeControl:!0}),t.controls.deleteControl=new di({x:.5,y:-.5,cursorStyle:"pointer",mouseUpHandler:this.deleteObject,render:this.renderDeleteIcon,cornerSize:24,hitbox:{width:60,height:60}}),t.controls.rotateControl=new di({x:0,y:-.5,offsetY:-40,cursorStyle:"crosshair",render:this.renderRotateIcon,cornerSize:24,actionHandler:Ma.rotationWithSnapping,hitbox:{width:60,height:60}}),t.controls.resizeControl=new di({x:.5,y:.5,cursorStyle:"se-resize",render:this.renderResizeIcon,cornerSize:24,actionHandler:Ma.scalingEqually,hitbox:{width:60,height:60}}),t.set({cornerColor:"#00000000",cornerSize:24,cornerStyle:"circle",borderColor:"#ffffff",borderDashArray:[6,4],transparentCorners:!1,hasBorders:!1,hasControls:!1}),t.on("selected",(()=>{t.set({hasBorders:!0,hasControls:!0}),t.setControlsVisibility({tl:!1,tr:!1,bl:!1,br:!1,mt:!1,mb:!1,ml:!1,mr:!1,mtr:!0,deleteControl:!0,rotateControl:!0,resizeControl:!0}),t.canvas.requestRenderAll()})),t.on("deselected",(()=>{t.set({hasBorders:!1,hasControls:!1}),t.setControlsVisibility({tl:!1,tr:!1,bl:!1,br:!1,mt:!1,mb:!1,ml:!1,mr:!1,mtr:!0,deleteControl:!0,rotateControl:!0,resizeControl:!0}),t.canvas.requestRenderAll()}))},addCustomControls(t){t.setControlsVisibility({tl:!1,tr:!1,bl:!1,br:!1,mt:!1,mb:!1,ml:!1,mr:!1,mtr:!0,deleteControl:!0,rotateControl:!0,resizeControl:!0}),t.controls.deleteControl=new di({x:.5,y:-.5,cursorStyle:"pointer",mouseUpHandler:this.deleteObject,render:this.renderDeleteIcon,cornerSize:24,hitbox:{width:60,height:60}}),t.controls.rotateControl=new di({x:0,y:-.5,offsetY:-40,cursorStyle:"crosshair",render:this.renderRotateIcon,cornerSize:24,actionHandler:Ma.rotationWithSnapping,hitbox:{width:60,height:60}}),t.controls.resizeControl=new di({x:.5,y:.5,cursorStyle:"se-resize",render:this.renderResizeIcon,cornerSize:24,actionHandler:Ma.scalingEqually,hitbox:{width:60,height:60}}),t.set({cornerColor:"#00000000",cornerSize:24,cornerStyle:"circle",borderColor:"#ffffff",borderDashArray:[6,4],transparentCorners:!1,hasBorders:!1,hasControls:!1}),t.on("selected",(()=>{t.set({hasBorders:!0,hasControls:!0}),t.setControlsVisibility({tl:!1,tr:!1,bl:!1,br:!1,mt:!1,mb:!1,ml:!1,mr:!1,mtr:!0,deleteControl:!0,rotateControl:!0,resizeControl:!0}),t.canvas.requestRenderAll()})),t.on("deselected",(()=>{t.set({hasBorders:!1,hasControls:!1}),t.setControlsVisibility({tl:!1,tr:!1,bl:!1,br:!1,mt:!1,mb:!1,ml:!1,mr:!1,mtr:!0,deleteControl:!0,rotateControl:!0,resizeControl:!0}),t.canvas.requestRenderAll()}))},addRectangle(){const t=new Bn({left:this.canvas.width/2,top:this.canvas.height/2,fill:"#ffe066",width:200,height:200,objectCaching:!1,originX:"center",originY:"center",centeredRotation:!0,padding:12,selectable:!0,evented:!0,hasControls:!1,hasBorders:!1});this.addCustomControls(t),this.canvas.add(t),this.canvas.setActiveObject(t),this.canvas.renderAll()},addTextbox(){const t="1.방문자 카운팅 ",e=12,s=new zo(t,{left:this.canvas.width/2,top:this.canvas.height/2,originX:"center",originY:"center",fontSize:32,fill:"#222",fontFamily:"sans-serif",editable:!0,selectable:!0,evented:!0,hasControls:!1,hasBorders:!1,backgroundColor:"transparent",textAlign:"center"}),i=new Bn({left:s.left,top:s.top,originX:"center",originY:"center",width:s.width+2*e,height:s.height+2*e,rx:18,ry:18,fill:"#fffbe6",selectable:!1,evented:!1,hasBorders:!1,hasControls:!1});s._bgRect=i,this.canvas.add(i),this.canvas.add(s);const n=()=>{const t=this.canvas.getObjects(),e=t.indexOf(i),n=t.indexOf(s);e>-1&&n>-1&&e!==n-1&&(t.splice(e,1),t.splice(n,0,i),this.canvas._objects=t)},r=()=>{s.setCoords(),i.set({width:s.width*s.scaleX+2*e,height:s.height*s.scaleY+2*e,left:s.left,top:s.top,scaleX:1,scaleY:1,angle:s.angle}),n(),this.canvas.requestRenderAll()};s.on("changed",r),s.on("scaling",r),s.on("moving",r),s.on("rotating",r),n(),this.addCustomControls(s),this.canvas.setActiveObject(s),this.canvas.renderAll()},addImage(t){const e=new window.Image;e.src=t,e.onload=()=>{let s=e.width,i=e.height;const n=12,r=new oa(e,{left:0,top:0,originX:"center",originY:"center",width:s,height:i,selectable:!1,evented:!1,hasControls:!1,hasBorders:!1}),o=new Bn({left:0,top:0,originX:"center",originY:"center",width:s+2*n,height:i+2*n,fill:"rgba(0,0,0,0)",selectable:!1,evented:!1,hasControls:!1,hasBorders:!1}),h=new $n([o,r],{left:this.canvas.width/2,top:this.canvas.height/2,originX:"center",originY:"center",selectable:!0,evented:!0,hasControls:!1,hasBorders:!1});this.addCustomControls(h),this.canvas.add(h),this.canvas.setActiveObject(h),this.canvas.renderAll(),this.uploadedImages.push({url:t,fabricObj:(0,a.IG)(h)}),this.updateImageCount()}},onFileChange(t){const e=t.target.files;if(!e||0===e.length)return;let s=this.uploadedImages.length;if(s>=3)return void alert("이미지는 최대 3개까지만 추가할 수 있습니다.");const i=e[0];if(!i)return;const n=new FileReader;n.onload=t=>{const e=new window.Image;e.src=t.target.result,e.onload=()=>{let s=e.width,i=e.height,n=1;s>400&&(n=400/s);const r=12,o=new oa(e,{left:0,top:0,originX:"center",originY:"center",width:s,height:i,scaleX:n,scaleY:n,selectable:!1,evented:!1,hasControls:!1,hasBorders:!1}),h=new Bn({left:0,top:0,originX:"center",originY:"center",width:s*n+2*r,height:i*n+2*r,fill:"rgba(0,0,0,0)",selectable:!1,evented:!1,hasControls:!1,hasBorders:!1}),c=new $n([h,o],{left:this.canvas.width/2,top:this.canvas.height/2,originX:"center",originY:"center",selectable:!0,evented:!0,hasControls:!1,hasBorders:!1});this.addCustomControls(c),this.canvas.add(c),this.canvas.setActiveObject(c),this.canvas.renderAll(),this.uploadedImages.push({url:t.target.result,fabricObj:(0,a.IG)(c)}),this.updateImageCount()}},n.readAsDataURL(i),t.target.value=""},removePreviewImage(t){const e=this.uploadedImages[t];e&&e.fabricObj&&this.canvas.contains(e.fabricObj)&&this.canvas.remove(e.fabricObj)},removeImageObject(t){this.canvas.remove(t),this.canvas.renderAll(),this.updateImageCount()},updateImageCount(){this.imageCount=this.canvas.getObjects().filter((t=>"image"===t.type&&!1!==t.selectable)).length},replaceDefaultImage(t){if(!this.defaultImageObject)return;const e=new window.Image;e.src=t,e.onload=()=>{const t=this.canvas.width,s=this.canvas.height,i=e.width,n=e.height,r=Math.max(t/i,s/n);this.defaultImageObject.setElement(e),this.defaultImageObject.set({scaleX:r,scaleY:r,left:(t-i*r)/2,top:(s-n*r)/2,originX:"left",originY:"top",width:i,height:n}),this.canvas.renderAll()}},async initializeCanvas(){const t=this.$el,e=t.getBoundingClientRect(),s=e.width,i=e.height;this.canvas=(0,a.IG)(new Vr(this.$refs.canvas,{width:s,height:i,selection:!0,backgroundColor:"#ffffff"})),this.canvas.on("after:render",(()=>{const t=this.canvas.getContext(),e=this.canvas.getObjects();e.forEach(((e,s)=>{const i=e.getPointByOrigin?e.getPointByOrigin("left","top"):{x:e.left,y:e.top};t.save(),t.font="bold 18px sans-serif",t.fillStyle="red",t.strokeStyle="white",t.lineWidth=3,t.strokeText(s+"",i.x+8,i.y+24),t.fillText(s+"",i.x+8,i.y+24),t.restore()}))}));const n=new window.Image;n.src=this.backroundList[0].src,n.onload=async()=>{const t=this.canvas.width,e=this.canvas.height,s=n.width,i=n.height,r=Math.max(t/s,e/i),o=new oa(n,{left:(t-s*r)/2,top:(e-i*r)/2,originX:"left",originY:"top",scaleX:r,scaleY:r,width:s,height:i,selectable:!1,evented:!1,hasControls:!1,hasBorders:!1,lockMovementX:!0,lockMovementY:!0,lockScalingX:!0,lockScalingY:!0,lockRotation:!0});this.canvas.add(o),this.defaultImageObject=o,this.canvas.renderAll(),await this.addHumanSvg(),await this.addHumanControlLayer()},this.canvas.on("mouse:down",(t=>{const e=this.canvas.getActiveObject(),s=this.canvas.getObjects();if(this.defaultImageObject){const t=s.indexOf(this.defaultImageObject);t>-1&&(s.splice(t,1),s.unshift(this.defaultImageObject))}if(e===this.humanSvgGroup)return[this.humanSvgGroup,this.humanControlLayer,this.clothesSvgGroup].forEach((t=>{const e=s.indexOf(t);e>-1&&s.splice(e,1)})),this.humanSvgGroup&&s.push(this.humanSvgGroup),this.humanControlLayer&&s.push(this.humanControlLayer),this.clothesSvgGroup&&s.push(this.clothesSvgGroup),this.canvas._objects=s,void this.canvas.renderAll();if(e&&"i-text"===e.type&&e._bgRect)return[e._bgRect,e].forEach((t=>{const e=s.indexOf(t);e>-1&&s.splice(e,1)})),s.push(e._bgRect),s.push(e),this.canvas._objects=s,void this.canvas.renderAll();const i=[this.humanControlLayer,this.humanSvgGroup,this.clothesSvgGroup].includes(e);if(i)[this.humanSvgGroup,this.humanControlLayer,this.clothesSvgGroup].forEach((t=>{const e=s.indexOf(t);e>-1&&s.splice(e,1)})),this.humanSvgGroup&&s.push(this.humanSvgGroup),this.humanControlLayer&&s.push(this.humanControlLayer),this.clothesSvgGroup&&s.push(this.clothesSvgGroup);else if(e&&![this.humanControlLayer,this.humanSvgGroup,this.clothesSvgGroup,this.defaultImageObject].includes(e)){const t=s.indexOf(e);t>-1&&(s.splice(t,1),s.push(e))}this.canvas._objects=s,this.canvas.renderAll()}))},addSticker(t){const e=new window.Image;e.src=t,e.onload=()=>{let t=e.width,s=e.height;const i=12,n=new oa(e,{left:0,top:0,originX:"center",originY:"center",width:t,height:s,selectable:!1,evented:!1,hasControls:!1,hasBorders:!1}),r=new Bn({left:0,top:0,originX:"center",originY:"center",width:t+2*i,height:s+2*i,fill:"rgba(0,0,0,0)",selectable:!1,evented:!1,hasControls:!1,hasBorders:!1}),o=new $n([r,n],{left:this.canvas.width/2,top:this.canvas.height/2,originX:"center",originY:"center",selectable:!0,evented:!0,hasControls:!1,hasBorders:!1});this.addCustomControls(o),this.canvas.add(o),this.canvas.setActiveObject(o),this.canvas.renderAll()}}},mounted:async function(){await this.initializeCanvas(),this.canvas&&this.canvas.on("object:removed",(t=>{const e=this.uploadedImages.findIndex((e=>e.fabricObj===t.target));-1!==e&&(this.uploadedImages.splice(e,1),this.uploadedImages=this.uploadedImages.slice()),this.updateImageCount()}))}};const Cy=(0,fv.A)(yy,[["render",cy],["__scopeId","data-v-63474eeb"]]);var by=Cy,wy=s(8713);const xy={class:"relative"},Sy={class:"TopBar h-[34px] flex items-center bg-gray-900 relative select-none"},Ty={style:{"padding-top":"34px"}};function ky(t,e,s,n,r,o){const a=(0,i.g2)("MainCanvas");return(0,i.uX)(),(0,i.CE)("div",xy,[(0,i.Lk)("div",Sy,[e[4]||(e[4]=(0,i.Lk)("span",{class:"absolute inset-0 flex items-center justify-center pointer-events-none text-[16px] text-[#9A9A9E]"}," 2025. 06. 08 ",-1)),r.showPopup?((0,i.uX)(),(0,i.CE)(i.FK,{key:1},[(0,i.Lk)("button",{class:"text-red-400 flex absolute left-[20px] z-10",onClick:e[1]||(e[1]=(...t)=>o.closePopup&&o.closePopup(...t))}," 취소 "),(0,i.Lk)("button",{class:"text-blue-400 flex absolute right-[20px] z-10",onClick:e[2]||(e[2]=(...t)=>o.save&&o.save(...t))}," 저장 ")],64)):((0,i.uX)(),(0,i.CE)("button",{key:0,class:"text-green-300 flex absolute right-[20px] z-10",onClick:e[0]||(e[0]=(...t)=>o.openPopup&&o.openPopup(...t))},e[3]||(e[3]=[(0,i.Lk)("img",{src:wy,alt:""},null,-1),(0,i.eW)(),(0,i.Lk)("span",null,"완료",-1)])))]),(0,i.Lk)("div",Ty,[(0,i.bF)(a,{ref:"mainCanvas",hideUi:r.showPopup},null,8,["hideUi"])])])}var Ay={components:{MainCanvas:by},data(){return{showPopup:!1}},methods:{openPopup(){this.showPopup=!0},closePopup(){this.showPopup=!1},save(){this.$refs.mainCanvas&&this.$refs.mainCanvas.saveCanvasAsImage&&this.$refs.mainCanvas.saveCanvasAsImage(),this.showPopup=!1}}};const Ey=(0,fv.A)(Ay,[["render",ky]]);var Oy=Ey,Dy={components:{CanvasUI:Oy},data(){return{activeTab:0,tabs:[],vhRaf:null,lastVh:0}},mounted(){this.setRealViewportHeight(),window.addEventListener("resize",this.setRealViewportHeight),window.addEventListener("orientationchange",this.setRealViewportHeight),window.addEventListener("scroll",this.setRealViewportHeight,{passive:!0}),this.startVhPolling()},beforeUnmount(){window.removeEventListener("resize",this.setRealViewportHeight),window.removeEventListener("orientationchange",this.setRealViewportHeight),window.removeEventListener("scroll",this.setRealViewportHeight),cancelAnimationFrame(this.vhRaf)},methods:{setRealViewportHeight(){const t=.01*window.innerHeight;document.documentElement.style.setProperty("--vh",`${t}px`);const e=this.$refs.contentArea;e&&(e.style.height="calc(var(--vh, 1vh) * 100)"),this.lastVh=t},startVhPolling(){const t=()=>{const e=.01*window.innerHeight;e!==this.lastVh&&this.setRealViewportHeight(),this.vhRaf=requestAnimationFrame(t)};this.vhRaf=requestAnimationFrame(t)}}};const Py=(0,fv.A)(Dy,[["render",r]]);var Iy=Py},1560:function(t,e,s){"use strict";t.exports=s.p+"img/다가오는솔라스 (1).ab67dde6.jpg"},2592:function(t){"use strict";t.exports="data:image/png;base64,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"},2603:function(t,e,s){"use strict";var i=s(655);t.exports=function(t,e){return void 0===t?arguments.length<2?"":e:i(t)}},2649:function(t){"use strict";t.exports="data:image/png;base64,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"},2697:function(t,e,s){"use strict";t.exports=s.p+"img/green.7795255f.svg"},2904:function(t,e,s){"use strict";t.exports=s.p+"img/dress.3251499f.svg"},3055:function(t,e,s){"use strict";t.exports=s.p+"img/다가오는솔라스 (4).f3685030.jpg"},3153:function(t){"use strict";t.exports="data:image/png;base64,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"},3167:function(t,e,s){"use strict";var i=s(4901),n=s(34),r=s(2967);t.exports=function(t,e,s){var o,a;return r&&i(o=e.constructor)&&o!==s&&n(a=o.prototype)&&a!==s.prototype&&r(t,a),t}},3713:function(t,e,s){"use strict";t.exports=s.p+"img/다가오는솔라스 (2).8d50a0bc.jpg"},4684:function(t,e,s){"use strict";t.exports=s.p+"img/delete.126f853b.svg"},4979:function(t,e,s){"use strict";var i=s(6518),n=s(4576),r=s(7751),o=s(6980),a=s(4913).f,h=s(9297),c=s(679),l=s(3167),u=s(2603),d=s(5002),g=s(6193),p=s(3724),f=s(6395),m="DOMException",_=r("Error"),v=r(m),y=function(){c(this,C);var t=arguments.length,e=u(t<1?void 0:arguments[0]),s=u(t<2?void 0:arguments[1],"Error"),i=new v(e,s),n=new _(e);return n.name=m,a(i,"stack",o(1,g(n.stack,1))),l(i,this,y),i},C=y.prototype=v.prototype,b="stack"in new _(m),w="stack"in new v(1,2),x=v&&p&&Object.getOwnPropertyDescriptor(n,m),S=!!x&&!(x.writable&&x.configurable),T=b&&!S&&!w;i({global:!0,constructor:!0,forced:f||T},{DOMException:T?y:v});var k=r(m),A=k.prototype;if(A.constructor!==k)for(var E in f||a(A,"constructor",o(1,k)),d)if(h(d,E)){var O=d[E],D=O.s;h(k,D)||a(k,D,o(6,O.c))}},5002:function(t){"use strict";t.exports={IndexSizeError:{s:"INDEX_SIZE_ERR",c:1,m:1},DOMStringSizeError:{s:"DOMSTRING_SIZE_ERR",c:2,m:0},HierarchyRequestError:{s:"HIERARCHY_REQUEST_ERR",c:3,m:1},WrongDocumentError:{s:"WRONG_DOCUMENT_ERR",c:4,m:1},InvalidCharacterError:{s:"INVALID_CHARACTER_ERR",c:5,m:1},NoDataAllowedError:{s:"NO_DATA_ALLOWED_ERR",c:6,m:0},NoModificationAllowedError:{s:"NO_MODIFICATION_ALLOWED_ERR",c:7,m:1},NotFoundError:{s:"NOT_FOUND_ERR",c:8,m:1},NotSupportedError:{s:"NOT_SUPPORTED_ERR",c:9,m:1},InUseAttributeError:{s:"INUSE_ATTRIBUTE_ERR",c:10,m:1},InvalidStateError:{s:"INVALID_STATE_ERR",c:11,m:1},SyntaxError:{s:"SYNTAX_ERR",c:12,m:1},InvalidModificationError:{s:"INVALID_MODIFICATION_ERR",c:13,m:1},NamespaceError:{s:"NAMESPACE_ERR",c:14,m:1},InvalidAccessError:{s:"INVALID_ACCESS_ERR",c:15,m:1},ValidationError:{s:"VALIDATION_ERR",c:16,m:0},TypeMismatchError:{s:"TYPE_MISMATCH_ERR",c:17,m:1},SecurityError:{s:"SECURITY_ERR",c:18,m:1},NetworkError:{s:"NETWORK_ERR",c:19,m:1},AbortError:{s:"ABORT_ERR",c:20,m:1},URLMismatchError:{s:"URL_MISMATCH_ERR",c:21,m:1},QuotaExceededError:{s:"QUOTA_EXCEEDED_ERR",c:22,m:1},TimeoutError:{s:"TIMEOUT_ERR",c:23,m:1},InvalidNodeTypeError:{s:"INVALID_NODE_TYPE_ERR",c:24,m:1},DataCloneError:{s:"DATA_CLONE_ERR",c:25,m:1}}},5350:function(t,e,s){var i={"./backround/다가오는솔라스 (1).jpg":1560,"./backround/다가오는솔라스 (2).jpg":3713,"./backround/다가오는솔라스 (3).jpg":6502,"./backround/다가오는솔라스 (4).jpg":3055,"./clothes/dress.svg":2904,"./clothes/dress팔.svg":5892,"./clothes/shirt.svg":1129,"./clothes/shirt팔.svg":8199,"./green.svg":2697,"./sticker/Ae.png":2592,"./sticker/Ai.png":5359,"./sticker/Figma.png":9124,"./sticker/Ps.png":2649,"./sticker/css.png":3153,"./sticker/html.png":7089,"./sticker/vsCode.png":7792,"./ui/add.svg":7222,"./ui/cached.png":9783,"./ui/cached.svg":8015,"./ui/delete.svg":4684,"./ui/deleteIcon.png":7155,"./ui/download.svg":8713,"./ui/open_in_full.png":5507,"./ui/open_in_full.svg":795,"./인간.svg":9759,"./인간팔.svg":7608};function n(t){var e=r(t);return s(e)}function r(t){if(!s.o(i,t)){var e=new Error("Cannot find module '"+t+"'");throw e.code="MODULE_NOT_FOUND",e}return i[t]}n.keys=function(){return Object.keys(i)},n.resolve=r,t.exports=n,n.id=5350},5359:function(t){"use strict";t.exports="data:image/png;base64,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"},5507:function(t){"use strict";t.exports="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABwAAAAdCAYAAAC5UQwxAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAItSURBVHgBvZa9UsJAEMc3CQwDVfh4gPgERmgssaJUnkBtsHSslEqtaLGyoEFm6PEJzAyNpW9g7JwBBiz4aAD/myFMQIG7QPjPHJe73N2PvezerUKC0qFwOGxMJhPT7RuPxz1UPcgSXUfZNCCVSmWn0+k9CoP0lQspSgNVo9PpvJAfoAeUJTnZ2IXLVVZr/3UmEokyQM94NEheOqy9iEQiymg0sjYC4/F4FROuaEthjWw0GjWGw+HrSiBbtguYR+YyVPPAHlDd0u7F0B9A37nhOA083lBV9ZOCUw+OdARHslVuAXZPwUp3GcoerHPFVh6ENE3jeCNZZTIZisVi83az2dw0ha08D4F6Cs8kWaXT6QWoAJBlqoAZ5EP1ep1arRZJKstOY8rOYquKxaJTVyoVmal6SHQkzlZqt9sLsFKpRIPBwOkXBSoIeCGPqdVqVC6XKZ/Pz2ESoLl4S23RwYVCYSsYouFD5R/RCQzDEUW5XI58yg7BSy08nG0a6XX7fr9PfgTjGnzScEB2aQ/ik0blhGRmZdCqzg9vJEM3FLBg3SPXzn2IVOAbdxYnSMcUgAB7gHXOJbxwiCaTyTcfSdNacRR0u90jt616X2Jr8zJhIgJDOfH2LQDZgWYDqrSlOAR4LV7T2/8na8P3HHHSgzTvC00THqyTnPiivQPnhtdafrn2IuQYRXUG6DXK2lsF1lhc8Pi0bJUwcAluoDrEIeGC+c9wDNv49hYYXyLr/AJ1Zg88ITXPsQAAAABJRU5ErkJggg=="},5892:function(t,e,s){"use strict";t.exports=s.p+"img/dress팔.4f5f98d8.svg"},6193:function(t,e,s){"use strict";var i=s(9504),n=Error,r=i("".replace),o=function(t){return String(new n(t).stack)}("zxcasd"),a=/\n\s*at [^:]*:[^\n]*/,h=a.test(o);t.exports=function(t,e){if(h&&"string"==typeof t&&!n.prepareStackTrace)while(e--)t=r(t,a,"");return t}},6502:function(t,e,s){"use strict";t.exports=s.p+"img/다가오는솔라스 (3).84a0f5cc.jpg"},7089:function(t){"use strict";t.exports="data:image/png;base64,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"},7155:function(t,e,s){"use strict";t.exports=s.p+"img/deleteIcon.3e9c3b8f.png"},7222:function(t,e,s){"use strict";t.exports=s.p+"img/add.7dfab8a5.svg"},7608:function(t,e,s){"use strict";t.exports=s.p+"img/인간팔.fbad4d85.svg"},7792:function(t){"use strict";t.exports="data:image/png;base64,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"},8015:function(t,e,s){"use strict";t.exports=s.p+"img/cached.92f39af6.svg"},8199:function(t,e,s){"use strict";t.exports=s.p+"img/shirt팔.250fb48a.svg"},8660:function(t){function e(t){var e=new Error("Cannot find module '"+t+"'");throw e.code="MODULE_NOT_FOUND",e}e.keys=function(){return[]},e.resolve=e,e.id=8660,t.exports=e},8713:function(t,e,s){"use strict";t.exports=s.p+"img/download.f2d1c768.svg"},9124:function(t){"use strict";t.exports="data:image/png;base64,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"},9759:function(t,e,s){"use strict";t.exports=s.p+"img/인간.db6c9b9b.svg"},9783:function(t){"use strict";t.exports="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACEAAAAhCAYAAABX5MJvAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAPuSURBVHgBvVhNTBNREH7bXwyEUiKUCKggMVCCmnAAwwEIB43GePOuIcFwkuiBxAPWBA8k+HPRBGj0wMHWhAhJDZWk0R4oF1ETKvTW0CJ/CaEFW/r7nNnuNm1p6SuUfsl0u33v7Xwzb97MbDlyPHCCpIKmXPMKbnd3Vx2JRB5RSj+DOGkC4Pff4XB4xuv19i4vL1+G+TIQCckTuFAo1A16vtEc4Pf7J61WqxbWK0h6j7EBLYfnvaYngMfjeQeo7urqkuVMBiypi0ajTpoHwDatTk9PX8nJK/kkkEjEaDRea2hoUKYjIk28gfllMpnMxnHcRZJHSCQSVWNj4+2NjY2pnZ2df9vb25GMkyHK39BTxNbW1oRKpVKT2Ok5DNwGWgBYLJZ7oK6EpNkWDrzwgRYAe3t7C6BP09raKheVS0UvyOXy94QRkJTI4uJPYrMtELfbTSorK4hSqWRaq1AoalZWVibn5ua8cBuKD0D03me1ZGnJTrVNLbSm+kJcrrd30PFxPesjqN1uf1FSUlIhxgb/IZVK77JYgVY3N2tJb+8D4gFvaLVasgDeMJu/Et2z5/wcHMsGjUbTtr+/X4SqgRN/UjjIC7+ysTcaP/FW4zUVq6su3jsokCWzPYoeHByswfZdAt3FRAhQSbZFIgFRUomg4qEhXXyMhQjobVKr1Sr4ynECichR7rt54xZ/tdv/kNraGlJaWkpmzV+SxjFYXS532vF0gITYApc1EA9/TxlgMMS8gRanWmo0HO2pDJ5AEpi4JOJ2ZK0VqFjcd5fLdWhcJMJCAHKFA/Q2C9mTJ4E9wwxlAB5DVIREBgYe895Bz4yOvuLHMUBZsL6+/h1jAqRUDEzO5/M9oYxAIu1tHUnuR1KYP1gBqVsHehuE0xGD2WyupDkAt2Z21sx7Yn7exnQaEtHf338H1J4HSUqzMtgSKy0AnE6nCfRdBakkQrIUm9EI1PhhUgAMDw9PwMUH4ke9qeNyiNq39BQBhcuAXiguLq5CfelIcnq9/hy2YvQUAJX6b09PT3dRUVEd1A4MyIyvBDKTydSSbyJIoK+vD4skvpOUCd13ZmCzgU1pMBhkO/TsBBpBzkLlVRAGYPJQDg4O1mNPSE8Ah8PxsbOzs1vwQAUrgUQiuKB8ZGSkY3NzcyoX5dBR/xgbG3sI6/F9ow6fkyuBOIS9w6a0SqfTddpstqdwlC2Y+2mKyzEVw/hLwXIsTvUgGmG9LJvF2YBRLC8vL1cGAoEz0AApQPA7HjEp9IxYETmIoQg0KiEo0UFoWjAHoARILBdET0oikQzOR+VomZQkHzNUFBYkIgjTXwTHf2NO+I8Ct4T/gYvdkhzxH2ptvLAYzgqbAAAAAElFTkSuQmCC"}}]);
//# sourceMappingURL=307.d4e9e604.js.map