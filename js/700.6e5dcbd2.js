(self["webpackChunkalien_mood"]=self["webpackChunkalien_mood"]||[]).push([[700],{655:function(t,e,s){"use strict";var n=s(6955),i=String;t.exports=function(t){if("Symbol"===n(t))throw new TypeError("Cannot convert a Symbol value to a string");return i(t)}},795:function(t,e,s){"use strict";t.exports=s.p+"img/open_in_full.746e6c15.svg"},1129:function(t,e,s){"use strict";t.exports=s.p+"img/shirt.06e570ae.svg"},1560:function(t,e,s){"use strict";t.exports=s.p+"img/다가오는솔라스 (1).ab67dde6.jpg"},2592:function(t){"use strict";t.exports="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAEgAAABICAYAAABV7bNHAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAyQSURBVHgB7VwLbFRVGv7uTKd0+phpaSvaWloUqIpKwTfyaAkFLGrrZuNuAJWN0VU0YIxZd+MmLmbjbkwUjSExWdclBnGzaITFRclGKCA+4ipEFJBFLBakQKEvSst0Zu5+/7kzzJ33nXZ219L5ktveuffce875zv9/5z//nbkaLKOpEMhrBPRaQKvhVsX9QgwLaJ1sawt3dnNrBjzrgXVdlq5MXuTnVYBjOeBfwg/DhBAr0P4CeJ8B/tqSsFT8U8pinubOY7igoa0EzpCo9Z0xz8a+SKzGvpU7VRgZaDGkY+3hyBO26LILa0YYOYIq2kozsHhy5IkIC1rCggMjjRwzWqi3dcDqluABE0FKc3Zh5JITRAvQOyWoSSYXy/8dMuQIqgKTk0LAgpRrfYcMTPCNkxAgYEEDTyODCNiXy19a0BJqz0AHMogENcgxjhbkaUIGsSCG00iCtFnIIA70WtGgGmQQDzVCUBUyiAOtSgi6gFboaUehDRkkRBbSAE3ToOse7p3mZo9TysethGWzWFbHcEFaCBJyiovLMH/+L9HT0x11nvyhoMCNt956HefOCZEW8nQ/EqSFIKAfEydegYcemo1jx2KXKC4GyenHunXP89PFGC5IkwYN0EJcOH4c6OiIvR08qGPOHAm5vMolhwuGTJDR2W5MmzYdXV2JtEVDZWUuLr30Ju57MFwwZIJ03Y+8vLGYOrUCAwOJy546BepUE685juGCNLhYB266aT78fpx3HZmlRo2iwEUo3JkzOmprr4PNNmrYuNmQCDI62UOrmIf29pB7ZWVp+OabQ9Skk/xkdjsNo0dnU9BrSWIf0gupxx/Y0hdGDIkgca/CwomYNGkMfL7Q8bw84JNPduCLLz5Dbm64pZw4oWPBAkkgtGGwkIExBkfirlZaZAdycnTk549SW1ZWP4//oDZN8w3JWoc4zbdj+vQH0aeMIdQIl4uJ3Zb9OHmyDffd14CzZ0NX9LPt06ZV4+WXS5VmpRoz2u12DsYxurAT9fX345ZbpqGiooQEZZEoow1er5/W280B+hLvvfc3DsounhvHurSUg9RBE2REz32YO7cOp09LpSH9Ea1pbd3LkXSyscax4CjK/+xsjaI+j1a2iUdclusUAny+fzNcWIplyxZxX6Pw6xwgLTBI50vC6XTT9Wdi0aKZ2LbtIJ59dhmP57D+vJRIGrSL6boXF110LSZMGK1GJoicHI0jd5DEdNBajmDPniNKk8ww3GwB905ZrY7kUF38LVixYg0ef3wxjh7VeR8okmK3T0M3g/pvv/VTAsZjw4ZNdHfOHDiLVDAEDTrBGekO1QgzRo8Gmps/4F4RNzf3t6go2gxxrSlTKtjgy2FFHmxkx+8/hOeeW4urrroMhw/71TErkHI9PaC7+7FmzRpIzBZ0RUvXYxAw3EUi42no7AyZq5iuTPd79mxnmQJuhfj0061wOBBm1nL9uXPAzJkLePxU0rrEcu699w+orq5QLmUmx88Kc3OB8nIwCDX+5+cbx83wem2s047HHnue576zLNyDIkgWp+Xl11McC2AWZ4dDw1dfHaUoH1HiK2be23sQ+/e3U1zDGyS6JeEBoyMkXrx6cPHFkyn2s/DDD/6wjvn9PkbnNmrZ53j00d/innse4Xrw1/jgg50YO9ZG9/OF3amjw4/bbrsWRUVXw8guJMcgXewEZ5A71BrLjKIica9mhAtvLrZv38FwILystH3ixEKUlFwLWZ/FgjERHMEjj/wK338f7lbS+cpKO5588o9Yteohut0Bkt5BbTqE1157HE888Yw6b7YkuV6i+aamxbyvtTAjZYKMEcxCXd2N9O1w98rOBnbt+ohl3KYrRuPjj7eo2CjyPqINc+Y0QgiPBV33UdOuwvXXV9A9wq2suNiOtWu30p3Xs+NXsmy26o78t9mqsW/fJmYOtsPtDu+itPnmm6fCatdTJkjX+zFu3K0oLZUZIdRoEb7W1m6O0F6WMd/WToHcw7ioF5ERruhXff0MdTy2JnQwzpmn4qjI804n8M47r3CvglYigaHn/GZ8LsPGjW+SoMj2axgzJpcDdimsRNyDiIOOo6HhN8pUzZDgcP36T2CQFlmxHVu2bMPddzdEuKWGsjInXeEWushBfnZEXHcW1113A7ME4UfF01pbzzCkcNHCShGro14GYJdfXk0NjDqlZs6iokt47lt+ykYipESQMYr5mDGjRo2+eVRlRLdvf48zSjmP2yOuK8POnVs4EzVE3bO9HRTOJrzyyhMQawiHkzNTqQo2zRBZcTjy8Prrf4IvgdZKONHW5mUcFt5NITg7WzwgzRak670MumqZHLNFjeqRI16sXPmCipIjA1Xh0eORMj61VDCjt1fHrFk1ePXVPBX0hcIB0bQCirszajIw2qLxfkiKSHKMa0XkvbCCFF3sBEe7kZqCmA3p7Ex8dSQ5ArFCl8vBGKcOX3/9MWTWM6DznjlRUXg6IAR5PKJTySXYMkFiBQ5HKWeAapXaSGc+Rwi//fZGEvR3fqoM1qiyBfGh0/20hC4WhLiUlJMmy35JieSmZOZM3n3LBOl6D2pq5qpEWLqTXf39MvVO4L3HcGRDbub19vOcT2ma2W2lkx5PHxYvXsbZqASJ260rvXG7i3gfG5dGHSSnk9O9WFB20rZZJEgIaWfkeztHO7RyTxeEcOn0DTfMx4cfboCs4aSOgYEu6k+fEmRznSLSY8fmMjbqpVv3WEiZiCWKqUlBmSnFtZKTA1iOgyTvXMEpt1KJrRniBi6Xn8LtTbq5XF6OZDDrFw5xs4YGmeU6TBY6wKchh2lZ0QMisdGdd/5CRdqaNirQ8XibnBdtE6KFGOvSa7FkF6PZn6qRMruXmG95uY3rpMWc1Tqjpvdo6BRqP958c6NKeZjv5fXqmDy5jAvNCZzZgg8X3VxnfYjZsydxHRZ+p9On/Qwb5jJK38wY6l+811gLeR5Z9+UgFYKSWpDRiS61sDTcKwSZYfbtO8HGHqYIFrKTBUk2F92ik50+oLQssh5JekkKJbjC1zQXPv98kyIvcnUu6ypZn61a9TyXKw+yrKRfv4eRY+pWbTb2hdlWtrWLLlxPS5bci/WEWVIqxYXc7vG45ppLuBAMPyeL07ff3gYJHq2jFO+//w/GPtVRcYyxwp+Dd999MbBQ1enS3ayjGXfdVaeCSjNEdFtb/Vi6dBEeeGAhPvvsGw7Y19St0yTEznYXMhNQzqVRJaP1Ylx5pYP3X06B9sGqFVkodQq33nq/yt+YYTza0Zjv+ScbWmQ5tywpz717t9KNlqs1W3j6AlweuLhWmsKcskzDdlpKBd544/dobJwRSJyFG70cM+IyDVdffQVuvPGKQP4JKgKXdst25owsT6LzRMlgS9wZafxZzJs3O5B3NjdMo4Ce4vH9EYvTxDAa3omPPtoX9cRD6pMIvb4+tMI3OuTGww8vxWWXST3xOyhESNQtqVghTfZFzH3WUj8xYUvcGS+DqknM2xSzoeGdMXI/O2GIXqoYg82bN6qALRLy+FoylTI2oUR/Pt2rlQmx5SpB5nTqQ/gKTWohSpKhP8nk+kI1tefkhDYRWMkz79y5mY0vRspN1Jw4cKCZ9/WpLIB5KyjQMH58DjVvgVr7CcSKbLZSzmSH6Go/oascpTVpUTmm2HUFv37DBEgZAt9jsk5SEg2yc1q2YceOfepZ0/mjdklz9tCMJV2QOJKNBRl9ny+LSfg/86lINYkKD66czlxVh9mdDFcrZPDow1NP/Yzp3ukkayEfH1XTEnMUCbEWyRKlt7X1MBz4kvnodUzTiOsKs9YskLdYFLekLEC9XpkmBxDOulxi4/kKlXcZDOz2LJIk01KsRaOIhptWkx9TVA3X8wTSpjlc8VdwK6eV5LNNDjUAfX1nqUEn6bJt1Kbjqg5Nk9yRIyX3TEjQ8IF0QazQ/FxeSM/CUB8ep+kbZv9viEWNwn8DmW+5JkGGoCTIEJQEQlAnMoiHTiGoBRnEga5+cbgbGcTDbhKkb0MGcaA3yyO09cjoUBz0bSBBq4Wc1cggAvpq+e18YJr3vYQMIuBfIX8DBKlXxLyIDIJ4MfjaHFOg6FgReAnRCIdw0Lsi+MlEkGiRv25kk6T6Xmt+l1DEUkPMytY0MkmSPkvfw98hlOAFS7atxnvKRgS+I0F1Fl+wJBBLyp7Ci1biwoZ8F/cFas7UWOQILGSv1ZthnuaNlhh86un/9sL/DkKIfAmGGqOtZuL3JfPLlGIhhY4u4jMHHx9Y2WYbrwlULyQYLr+5F9FtITm7DenQuXp4o9vKhf8BoevhtPNndnQAAAAASUVORK5CYII="},2603:function(t,e,s){"use strict";var n=s(655);t.exports=function(t,e){return void 0===t?arguments.length<2?"":e:n(t)}},2649:function(t){"use strict";t.exports="data:image/png;base64,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"},2697:function(t,e,s){"use strict";t.exports=s.p+"img/green.7795255f.svg"},2700:function(t,e,s){"use strict";s.r(e),s.d(e,{default:function(){return Iy}});var n=s(6768);const i={ref:"contentArea",class:"mobile-wrapper h-[full]"};function r(t,e,s,r,o,a){const h=(0,n.g2)("CanvasUI");return(0,n.uX)(),(0,n.CE)("div",i,[(0,n.bF)(h,{ref:"child"},null,512)],512)}var o=s(4232);s(4114),s(8111),s(2489),s(7588),s(1701);var a=s(144);s(1148),s(116),s(8237),s(3579),s(7642),s(8004),s(3853),s(5876),s(2475),s(5024),s(1698),s(9577);function h(t,e,s){return(e=function(t){var e=function(t,e){if("object"!=typeof t||!t)return t;var s=t[Symbol.toPrimitive];if(void 0!==s){var n=s.call(t,e||"default");if("object"!=typeof n)return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}(t,"string");return"symbol"==typeof e?e:e+""}(e))in t?Object.defineProperty(t,e,{value:s,enumerable:!0,configurable:!0,writable:!0}):t[e]=s,t}function c(t,e){var s=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),s.push.apply(s,n)}return s}function l(t){for(var e=1;e<arguments.length;e++){var s=null!=arguments[e]?arguments[e]:{};e%2?c(Object(s),!0).forEach((function(e){h(t,e,s[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(s)):c(Object(s)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(s,e))}))}return t}function u(t,e){if(null==t)return{};var s,n,i=function(t,e){if(null==t)return{};var s={};for(var n in t)if({}.hasOwnProperty.call(t,n)){if(e.indexOf(n)>=0)continue;s[n]=t[n]}return s}(t,e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);for(n=0;n<r.length;n++)s=r[n],e.indexOf(s)>=0||{}.propertyIsEnumerable.call(t,s)&&(i[s]=t[s])}return i}function d(t,e){return e||(e=t.slice(0)),Object.freeze(Object.defineProperties(t,{raw:{value:Object.freeze(e)}}))}class g{constructor(){h(this,"browserShadowBlurConstant",1),h(this,"DPI",96),h(this,"devicePixelRatio","undefined"!=typeof window?window.devicePixelRatio:1),h(this,"perfLimitSizeTotal",2097152),h(this,"maxCacheSideLimit",4096),h(this,"minCacheSideLimit",256),h(this,"disableStyleCopyPaste",!1),h(this,"enableGLFiltering",!0),h(this,"textureSize",4096),h(this,"forceGLPutImageData",!1),h(this,"cachesBoundsOfCurve",!1),h(this,"fontPaths",{}),h(this,"NUM_FRACTION_DIGITS",4)}}const p=new class extends g{constructor(t){super(),this.configure(t)}configure(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};Object.assign(this,t)}addFonts(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};this.fontPaths=l(l({},this.fontPaths),t)}removeFonts(){(arguments.length>0&&void 0!==arguments[0]?arguments[0]:[]).forEach((t=>{delete this.fontPaths[t]}))}clearFonts(){this.fontPaths={}}restoreDefaults(t){const e=new g,s=(null==t?void 0:t.reduce(((t,s)=>(t[s]=e[s],t)),{}))||e;this.configure(s)}},f=function(t){for(var e=arguments.length,s=new Array(e>1?e-1:0),n=1;n<e;n++)s[n-1]=arguments[n];return console[t]("fabric",...s)};class m extends Error{constructor(t,e){super("fabric: ".concat(t),e)}}class _ extends m{constructor(t){super("".concat(t," 'options.signal' is in 'aborted' state"))}}class v{}class y extends v{testPrecision(t,e){const s="precision ".concat(e," float;\nvoid main(){}"),n=t.createShader(t.FRAGMENT_SHADER);return!!n&&(t.shaderSource(n,s),t.compileShader(n),!!t.getShaderParameter(n,t.COMPILE_STATUS))}queryWebGL(t){const e=t.getContext("webgl");e&&(this.maxTextureSize=e.getParameter(e.MAX_TEXTURE_SIZE),this.GLPrecision=["highp","mediump","lowp"].find((t=>this.testPrecision(e,t))),e.getExtension("WEBGL_lose_context").loseContext(),f("log","WebGL: max texture size ".concat(this.maxTextureSize)))}isSupported(t){return!!this.maxTextureSize&&this.maxTextureSize>=t}}const C={};let b;const w=()=>b||(b={document:document,window:window,isTouchSupported:"ontouchstart"in window||"ontouchstart"in document||window&&window.navigator&&window.navigator.maxTouchPoints>0,WebGLProbe:new y,dispose(){},copyPasteData:C}),x=()=>w().document,S=()=>w().window,T=()=>{var t;return Math.max(null!==(t=p.devicePixelRatio)&&void 0!==t?t:S().devicePixelRatio,1)},k=new class{constructor(){h(this,"charWidthsCache",{}),h(this,"boundsOfCurveCache",{})}getFontCache(t){let{fontFamily:e,fontStyle:s,fontWeight:n}=t;e=e.toLowerCase(),this.charWidthsCache[e]||(this.charWidthsCache[e]={});const i=this.charWidthsCache[e],r="".concat(s.toLowerCase(),"_").concat((n+"").toLowerCase());return i[r]||(i[r]={}),i[r]}clearFontCache(t){(t=(t||"").toLowerCase())?this.charWidthsCache[t]&&delete this.charWidthsCache[t]:this.charWidthsCache={}}limitDimsByArea(t){const{perfLimitSizeTotal:e}=p,s=Math.sqrt(e*t);return[Math.floor(s),Math.floor(e/s)]}},A="6.7.0";function E(){}const O=Math.PI/2,D=2*Math.PI,P=Math.PI/180,I=Object.freeze([1,0,0,1,0,0]),M=16,R=.4477152502,F="center",L="left",j="top",N="bottom",B="right",W="none",U=/\r?\n/,Y="moving",X="scaling",V="rotating",G="rotate",H="skewing",z="resizing",q="modifyPoly",K="modifyPath",Q="changed",J="scale",Z="scaleX",$="scaleY",tt="skewX",et="skewY",st="fill",nt="stroke",it="modified",rt="json",ot="svg",at=new class{constructor(){this[rt]=new Map,this[ot]=new Map}has(t){return this[rt].has(t)}getClass(t){const e=this[rt].get(t);if(!e)throw new m("No class registered for ".concat(t));return e}setClass(t,e){e?this[rt].set(e,t):(this[rt].set(t.type,t),this[rt].set(t.type.toLowerCase(),t))}getSVGClass(t){return this[ot].get(t)}setSVGClass(t,e){this[ot].set(null!=e?e:t.type.toLowerCase(),t)}},ht=new class extends Array{remove(t){const e=this.indexOf(t);e>-1&&this.splice(e,1)}cancelAll(){const t=this.splice(0);return t.forEach((t=>t.abort())),t}cancelByCanvas(t){if(!t)return[];const e=this.filter((e=>{var s;return e.target===t||"object"==typeof e.target&&(null===(s=e.target)||void 0===s?void 0:s.canvas)===t}));return e.forEach((t=>t.abort())),e}cancelByTarget(t){if(!t)return[];const e=this.filter((e=>e.target===t));return e.forEach((t=>t.abort())),e}};class ct{constructor(){h(this,"__eventListeners",{})}on(t,e){if(this.__eventListeners||(this.__eventListeners={}),"object"==typeof t)return Object.entries(t).forEach((t=>{let[e,s]=t;this.on(e,s)})),()=>this.off(t);if(e){const s=t;return this.__eventListeners[s]||(this.__eventListeners[s]=[]),this.__eventListeners[s].push(e),()=>this.off(s,e)}return()=>!1}once(t,e){if("object"==typeof t){const e=[];return Object.entries(t).forEach((t=>{let[s,n]=t;e.push(this.once(s,n))})),()=>e.forEach((t=>t()))}if(e){const s=this.on(t,(function(){for(var t=arguments.length,n=new Array(t),i=0;i<t;i++)n[i]=arguments[i];e.call(this,...n),s()}));return s}return()=>!1}_removeEventListener(t,e){if(this.__eventListeners[t])if(e){const s=this.__eventListeners[t],n=s.indexOf(e);n>-1&&s.splice(n,1)}else this.__eventListeners[t]=[]}off(t,e){if(this.__eventListeners)if(void 0===t)for(const s in this.__eventListeners)this._removeEventListener(s);else"object"==typeof t?Object.entries(t).forEach((t=>{let[e,s]=t;this._removeEventListener(e,s)})):this._removeEventListener(t,e)}fire(t,e){var s;if(!this.__eventListeners)return;const n=null===(s=this.__eventListeners[t])||void 0===s?void 0:s.concat();if(n)for(let i=0;i<n.length;i++)n[i].call(this,e||{})}}const lt=(t,e)=>{const s=t.indexOf(e);return-1!==s&&t.splice(s,1),t},ut=t=>{if(0===t)return 1;switch(Math.abs(t)/O){case 1:case 3:return 0;case 2:return-1}return Math.cos(t)},dt=t=>{if(0===t)return 0;const e=t/O,s=Math.sign(t);switch(e){case 1:return s;case 2:return 0;case 3:return-s}return Math.sin(t)};class gt{constructor(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;"object"==typeof t?(this.x=t.x,this.y=t.y):(this.x=t,this.y=e)}add(t){return new gt(this.x+t.x,this.y+t.y)}addEquals(t){return this.x+=t.x,this.y+=t.y,this}scalarAdd(t){return new gt(this.x+t,this.y+t)}scalarAddEquals(t){return this.x+=t,this.y+=t,this}subtract(t){return new gt(this.x-t.x,this.y-t.y)}subtractEquals(t){return this.x-=t.x,this.y-=t.y,this}scalarSubtract(t){return new gt(this.x-t,this.y-t)}scalarSubtractEquals(t){return this.x-=t,this.y-=t,this}multiply(t){return new gt(this.x*t.x,this.y*t.y)}scalarMultiply(t){return new gt(this.x*t,this.y*t)}scalarMultiplyEquals(t){return this.x*=t,this.y*=t,this}divide(t){return new gt(this.x/t.x,this.y/t.y)}scalarDivide(t){return new gt(this.x/t,this.y/t)}scalarDivideEquals(t){return this.x/=t,this.y/=t,this}eq(t){return this.x===t.x&&this.y===t.y}lt(t){return this.x<t.x&&this.y<t.y}lte(t){return this.x<=t.x&&this.y<=t.y}gt(t){return this.x>t.x&&this.y>t.y}gte(t){return this.x>=t.x&&this.y>=t.y}lerp(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:.5;return e=Math.max(Math.min(1,e),0),new gt(this.x+(t.x-this.x)*e,this.y+(t.y-this.y)*e)}distanceFrom(t){const e=this.x-t.x,s=this.y-t.y;return Math.sqrt(e*e+s*s)}midPointFrom(t){return this.lerp(t)}min(t){return new gt(Math.min(this.x,t.x),Math.min(this.y,t.y))}max(t){return new gt(Math.max(this.x,t.x),Math.max(this.y,t.y))}toString(){return"".concat(this.x,",").concat(this.y)}setXY(t,e){return this.x=t,this.y=e,this}setX(t){return this.x=t,this}setY(t){return this.y=t,this}setFromPoint(t){return this.x=t.x,this.y=t.y,this}swap(t){const e=this.x,s=this.y;this.x=t.x,this.y=t.y,t.x=e,t.y=s}clone(){return new gt(this.x,this.y)}rotate(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:pt;const s=dt(t),n=ut(t),i=this.subtract(e);return new gt(i.x*n-i.y*s,i.x*s+i.y*n).add(e)}transform(t){let e=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return new gt(t[0]*this.x+t[2]*this.y+(e?0:t[4]),t[1]*this.x+t[3]*this.y+(e?0:t[5]))}}const pt=new gt(0,0),ft=t=>!!t&&Array.isArray(t._objects);function mt(t){class e extends t{constructor(){super(...arguments),h(this,"_objects",[])}_onObjectAdded(t){}_onObjectRemoved(t){}_onStackOrderChanged(t){}add(){for(var t=arguments.length,e=new Array(t),s=0;s<t;s++)e[s]=arguments[s];const n=this._objects.push(...e);return e.forEach((t=>this._onObjectAdded(t))),n}insertAt(t){for(var e=arguments.length,s=new Array(e>1?e-1:0),n=1;n<e;n++)s[n-1]=arguments[n];return this._objects.splice(t,0,...s),s.forEach((t=>this._onObjectAdded(t))),this._objects.length}remove(){const t=this._objects,e=[];for(var s=arguments.length,n=new Array(s),i=0;i<s;i++)n[i]=arguments[i];return n.forEach((s=>{const n=t.indexOf(s);-1!==n&&(t.splice(n,1),e.push(s),this._onObjectRemoved(s))})),e}forEachObject(t){this.getObjects().forEach(((e,s,n)=>t(e,s,n)))}getObjects(){for(var t=arguments.length,e=new Array(t),s=0;s<t;s++)e[s]=arguments[s];return 0===e.length?[...this._objects]:this._objects.filter((t=>t.isType(...e)))}item(t){return this._objects[t]}isEmpty(){return 0===this._objects.length}size(){return this._objects.length}contains(t,s){return!!this._objects.includes(t)||!!s&&this._objects.some((s=>s instanceof e&&s.contains(t,!0)))}complexity(){return this._objects.reduce(((t,e)=>t+(e.complexity?e.complexity():0)),0)}sendObjectToBack(t){return!(!t||t===this._objects[0])&&(lt(this._objects,t),this._objects.unshift(t),this._onStackOrderChanged(t),!0)}bringObjectToFront(t){return!(!t||t===this._objects[this._objects.length-1])&&(lt(this._objects,t),this._objects.push(t),this._onStackOrderChanged(t),!0)}sendObjectBackwards(t,e){if(!t)return!1;const s=this._objects.indexOf(t);if(0!==s){const n=this.findNewLowerIndex(t,s,e);return lt(this._objects,t),this._objects.splice(n,0,t),this._onStackOrderChanged(t),!0}return!1}bringObjectForward(t,e){if(!t)return!1;const s=this._objects.indexOf(t);if(s!==this._objects.length-1){const n=this.findNewUpperIndex(t,s,e);return lt(this._objects,t),this._objects.splice(n,0,t),this._onStackOrderChanged(t),!0}return!1}moveObjectTo(t,e){return t!==this._objects[e]&&(lt(this._objects,t),this._objects.splice(e,0,t),this._onStackOrderChanged(t),!0)}findNewLowerIndex(t,e,s){let n;if(s){n=e;for(let s=e-1;s>=0;--s)if(t.isOverlapping(this._objects[s])){n=s;break}}else n=e-1;return n}findNewUpperIndex(t,e,s){let n;if(s){n=e;for(let s=e+1;s<this._objects.length;++s)if(t.isOverlapping(this._objects[s])){n=s;break}}else n=e+1;return n}collectObjects(t){let{left:e,top:s,width:n,height:i}=t,{includeIntersecting:r=!0}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const o=[],a=new gt(e,s),h=a.add(new gt(n,i));for(let c=this._objects.length-1;c>=0;c--){const t=this._objects[c];t.selectable&&t.visible&&(r&&t.intersectsWithRect(a,h)||t.isContainedWithinRect(a,h)||r&&t.containsPoint(a)||r&&t.containsPoint(h))&&o.push(t)}return o}}return e}class _t extends ct{_setOptions(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};for(const e in t)this.set(e,t[e])}_setObject(t){for(const e in t)this._set(e,t[e])}set(t,e){return"object"==typeof t?this._setObject(t):this._set(t,e),this}_set(t,e){this[t]=e}toggle(t){const e=this.get(t);return"boolean"==typeof e&&this.set(t,!e),this}get(t){return this[t]}}function vt(t){return S().requestAnimationFrame(t)}function yt(t){return S().cancelAnimationFrame(t)}let Ct=0;const bt=()=>Ct++,wt=()=>{const t=x().createElement("canvas");if(!t||void 0===t.getContext)throw new m("Failed to create `canvas` element");return t},xt=()=>x().createElement("img"),St=t=>{const e=wt();return e.width=t.width,e.height=t.height,e},Tt=(t,e,s)=>t.toDataURL("image/".concat(e),s),kt=(t,e,s)=>new Promise(((n,i)=>{t.toBlob(n,"image/".concat(e),s)})),At=t=>t*P,Et=t=>t/P,Ot=t=>t.every(((t,e)=>t===I[e])),Dt=(t,e,s)=>new gt(t).transform(e,s),Pt=t=>{const e=1/(t[0]*t[3]-t[1]*t[2]),s=[e*t[3],-e*t[1],-e*t[2],e*t[0],0,0],{x:n,y:i}=new gt(t[4],t[5]).transform(s,!0);return s[4]=-n,s[5]=-i,s},It=(t,e,s)=>[t[0]*e[0]+t[2]*e[1],t[1]*e[0]+t[3]*e[1],t[0]*e[2]+t[2]*e[3],t[1]*e[2]+t[3]*e[3],s?0:t[0]*e[4]+t[2]*e[5]+t[4],s?0:t[1]*e[4]+t[3]*e[5]+t[5]],Mt=(t,e)=>t.reduceRight(((t,s)=>s&&t?It(s,t,e):s||t),void 0)||I.concat(),Rt=t=>{let[e,s]=t;return Math.atan2(s,e)},Ft=t=>{const e=Rt(t),s=Math.pow(t[0],2)+Math.pow(t[1],2),n=Math.sqrt(s),i=(t[0]*t[3]-t[2]*t[1])/n,r=Math.atan2(t[0]*t[2]+t[1]*t[3],s);return{angle:Et(e),scaleX:n,scaleY:i,skewX:Et(r),skewY:0,translateX:t[4]||0,translateY:t[5]||0}},Lt=function(t){return[1,0,0,1,t,arguments.length>1&&void 0!==arguments[1]?arguments[1]:0]};function jt(){let{angle:t=0}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},{x:e=0,y:s=0}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const n=At(t),i=ut(n),r=dt(n);return[i,r,-r,i,e?e-(i*e-r*s):0,s?s-(r*e+i*s):0]}const Nt=function(t){return[t,0,0,arguments.length>1&&void 0!==arguments[1]?arguments[1]:t,0,0]},Bt=t=>Math.tan(At(t)),Wt=t=>[1,0,Bt(t),1,0,0],Ut=t=>[1,Bt(t),0,1,0,0],Yt=t=>{let{scaleX:e=1,scaleY:s=1,flipX:n=!1,flipY:i=!1,skewX:r=0,skewY:o=0}=t,a=Nt(n?-e:e,i?-s:s);return r&&(a=It(a,Wt(r),!0)),o&&(a=It(a,Ut(o),!0)),a},Xt=t=>{const{translateX:e=0,translateY:s=0,angle:n=0}=t;let i=Lt(e,s);n&&(i=It(i,jt({angle:n})));const r=Yt(t);return Ot(r)||(i=It(i,r)),i},Vt=function(t){let{signal:e,crossOrigin:s=null}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return new Promise((function(n,i){if(e&&e.aborted)return i(new _("loadImage"));const r=xt();let o;e&&(o=function(t){r.src="",i(t)},e.addEventListener("abort",o,{once:!0}));const a=function(){r.onload=r.onerror=null,o&&(null==e||e.removeEventListener("abort",o)),n(r)};t?(r.onload=a,r.onerror=function(){o&&(null==e||e.removeEventListener("abort",o)),i(new m("Error loading ".concat(r.src)))},s&&(r.crossOrigin=s),r.src=t):a()}))},Gt=function(t){let{signal:e,reviver:s=E}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return new Promise(((n,i)=>{const r=[];e&&e.addEventListener("abort",i,{once:!0}),Promise.all(t.map((t=>at.getClass(t.type).fromObject(t,{signal:e}).then((e=>(s(t,e),r.push(e),e)))))).then(n).catch((t=>{r.forEach((t=>{t.dispose&&t.dispose()})),i(t)})).finally((()=>{e&&e.removeEventListener("abort",i)}))}))},Ht=function(t){let{signal:e}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return new Promise(((s,n)=>{const i=[];e&&e.addEventListener("abort",n,{once:!0});const r=Object.values(t).map((t=>t&&t.type&&at.has(t.type)?Gt([t],{signal:e}).then((t=>{let[e]=t;return i.push(e),e})):t)),o=Object.keys(t);Promise.all(r).then((t=>t.reduce(((t,e,s)=>(t[o[s]]=e,t)),{}))).then(s).catch((t=>{i.forEach((t=>{t.dispose&&t.dispose()})),n(t)})).finally((()=>{e&&e.removeEventListener("abort",n)}))}))},zt=function(t){return(arguments.length>1&&void 0!==arguments[1]?arguments[1]:[]).reduce(((e,s)=>(s in t&&(e[s]=t[s]),e)),{})},qt=(t,e)=>Object.keys(t).reduce(((s,n)=>(e(t[n],n,t)&&(s[n]=t[n]),s)),{}),Kt=(t,e)=>parseFloat(Number(t).toFixed(e)),Qt=t=>"matrix("+t.map((t=>Kt(t,p.NUM_FRACTION_DIGITS))).join(" ")+")",Jt=t=>!!t&&void 0!==t.toLive,Zt=t=>!!t&&"function"==typeof t.toObject,$t=t=>!!t&&void 0!==t.offsetX&&"source"in t,te=t=>!!t&&"multiSelectionStacking"in t;function ee(t){const e=t&&se(t);let s=0,n=0;if(!t||!e)return{left:s,top:n};let i=t;const r=e.documentElement,o=e.body||{scrollLeft:0,scrollTop:0};for(;i&&(i.parentNode||i.host)&&(i=i.parentNode||i.host,i===e?(s=o.scrollLeft||r.scrollLeft||0,n=o.scrollTop||r.scrollTop||0):(s+=i.scrollLeft||0,n+=i.scrollTop||0),1!==i.nodeType||"fixed"!==i.style.position););return{left:s,top:n}}const se=t=>t.ownerDocument||null,ne=t=>{var e;return(null===(e=t.ownerDocument)||void 0===e?void 0:e.defaultView)||null},ie=function(t,e,s){let{width:n,height:i}=s,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1;t.width=n,t.height=i,r>1&&(t.setAttribute("width",(n*r).toString()),t.setAttribute("height",(i*r).toString()),e.scale(r,r))},re=(t,e)=>{let{width:s,height:n}=e;s&&(t.style.width="number"==typeof s?"".concat(s,"px"):s),n&&(t.style.height="number"==typeof n?"".concat(n,"px"):n)};function oe(t){return void 0!==t.onselectstart&&(t.onselectstart=()=>!1),t.style.userSelect=W,t}class ae{constructor(t){h(this,"_originalCanvasStyle",void 0),h(this,"lower",void 0);const e=this.createLowerCanvas(t);this.lower={el:e,ctx:e.getContext("2d")}}createLowerCanvas(t){const e=(s=t)&&void 0!==s.getContext?t:t&&x().getElementById(t)||wt();var s;if(e.hasAttribute("data-fabric"))throw new m("Trying to initialize a canvas that has already been initialized. Did you forget to dispose the canvas?");return this._originalCanvasStyle=e.style.cssText,e.setAttribute("data-fabric","main"),e.classList.add("lower-canvas"),e}cleanupDOM(t){let{width:e,height:s}=t;const{el:n}=this.lower;n.classList.remove("lower-canvas"),n.removeAttribute("data-fabric"),n.setAttribute("width","".concat(e)),n.setAttribute("height","".concat(s)),n.style.cssText=this._originalCanvasStyle||"",this._originalCanvasStyle=void 0}setDimensions(t,e){const{el:s,ctx:n}=this.lower;ie(s,n,t,e)}setCSSDimensions(t){re(this.lower.el,t)}calcOffset(){return function(t){var e;const s=t&&se(t),n={left:0,top:0};if(!s)return n;const i=(null===(e=ne(t))||void 0===e?void 0:e.getComputedStyle(t,null))||{};n.left+=parseInt(i.borderLeftWidth,10)||0,n.top+=parseInt(i.borderTopWidth,10)||0,n.left+=parseInt(i.paddingLeft,10)||0,n.top+=parseInt(i.paddingTop,10)||0;let r={left:0,top:0};const o=s.documentElement;void 0!==t.getBoundingClientRect&&(r=t.getBoundingClientRect());const a=ee(t);return{left:r.left+a.left-(o.clientLeft||0)+n.left,top:r.top+a.top-(o.clientTop||0)+n.top}}(this.lower.el)}dispose(){w().dispose(this.lower.el),delete this.lower}}const he={backgroundVpt:!0,backgroundColor:"",overlayVpt:!0,overlayColor:"",includeDefaultValues:!0,svgViewportTransformation:!0,renderOnAddRemove:!0,skipOffscreen:!0,enableRetinaScaling:!0,imageSmoothingEnabled:!0,controlsAboveOverlay:!1,allowTouchScrolling:!1,viewportTransform:[...I]};class ce extends(mt(_t)){get lowerCanvasEl(){var t;return null===(t=this.elements.lower)||void 0===t?void 0:t.el}get contextContainer(){var t;return null===(t=this.elements.lower)||void 0===t?void 0:t.ctx}static getDefaults(){return ce.ownDefaults}constructor(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};super(),Object.assign(this,this.constructor.getDefaults()),this.set(e),this.initElements(t),this._setDimensionsImpl({width:this.width||this.elements.lower.el.width||0,height:this.height||this.elements.lower.el.height||0}),this.skipControlsDrawing=!1,this.viewportTransform=[...this.viewportTransform],this.calcViewportBoundaries()}initElements(t){this.elements=new ae(t)}add(){const t=super.add(...arguments);return arguments.length>0&&this.renderOnAddRemove&&this.requestRenderAll(),t}insertAt(t){for(var e=arguments.length,s=new Array(e>1?e-1:0),n=1;n<e;n++)s[n-1]=arguments[n];const i=super.insertAt(t,...s);return s.length>0&&this.renderOnAddRemove&&this.requestRenderAll(),i}remove(){const t=super.remove(...arguments);return t.length>0&&this.renderOnAddRemove&&this.requestRenderAll(),t}_onObjectAdded(t){t.canvas&&t.canvas!==this&&(f("warn","Canvas is trying to add an object that belongs to a different canvas.\nResulting to default behavior: removing object from previous canvas and adding to new canvas"),t.canvas.remove(t)),t._set("canvas",this),t.setCoords(),this.fire("object:added",{target:t}),t.fire("added",{target:this})}_onObjectRemoved(t){t._set("canvas",void 0),this.fire("object:removed",{target:t}),t.fire("removed",{target:this})}_onStackOrderChanged(){this.renderOnAddRemove&&this.requestRenderAll()}getRetinaScaling(){return this.enableRetinaScaling?T():1}calcOffset(){return this._offset=this.elements.calcOffset()}getWidth(){return this.width}getHeight(){return this.height}setWidth(t,e){return this.setDimensions({width:t},e)}setHeight(t,e){return this.setDimensions({height:t},e)}_setDimensionsImpl(t){let{cssOnly:e=!1,backstoreOnly:s=!1}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(!e){const e=l({width:this.width,height:this.height},t);this.elements.setDimensions(e,this.getRetinaScaling()),this.hasLostContext=!0,this.width=e.width,this.height=e.height}s||this.elements.setCSSDimensions(t),this.calcOffset()}setDimensions(t,e){this._setDimensionsImpl(t,e),e&&e.cssOnly||this.requestRenderAll()}getZoom(){return this.viewportTransform[0]}setViewportTransform(t){this.viewportTransform=t,this.calcViewportBoundaries(),this.renderOnAddRemove&&this.requestRenderAll()}zoomToPoint(t,e){const s=t,n=[...this.viewportTransform],i=Dt(t,Pt(n));n[0]=e,n[3]=e;const r=Dt(i,n);n[4]+=s.x-r.x,n[5]+=s.y-r.y,this.setViewportTransform(n)}setZoom(t){this.zoomToPoint(new gt(0,0),t)}absolutePan(t){const e=[...this.viewportTransform];return e[4]=-t.x,e[5]=-t.y,this.setViewportTransform(e)}relativePan(t){return this.absolutePan(new gt(-t.x-this.viewportTransform[4],-t.y-this.viewportTransform[5]))}getElement(){return this.elements.lower.el}clearContext(t){t.clearRect(0,0,this.width,this.height)}getContext(){return this.elements.lower.ctx}clear(){this.remove(...this.getObjects()),this.backgroundImage=void 0,this.overlayImage=void 0,this.backgroundColor="",this.overlayColor="",this.clearContext(this.getContext()),this.fire("canvas:cleared"),this.renderOnAddRemove&&this.requestRenderAll()}renderAll(){this.cancelRequestedRender(),this.destroyed||this.renderCanvas(this.getContext(),this._objects)}renderAndReset(){this.nextRenderHandle=0,this.renderAll()}requestRenderAll(){this.nextRenderHandle||this.disposed||this.destroyed||(this.nextRenderHandle=vt((()=>this.renderAndReset())))}calcViewportBoundaries(){const t=this.width,e=this.height,s=Pt(this.viewportTransform),n=Dt({x:0,y:0},s),i=Dt({x:t,y:e},s),r=n.min(i),o=n.max(i);return this.vptCoords={tl:r,tr:new gt(o.x,r.y),bl:new gt(r.x,o.y),br:o}}cancelRequestedRender(){this.nextRenderHandle&&(yt(this.nextRenderHandle),this.nextRenderHandle=0)}drawControls(t){}renderCanvas(t,e){if(this.destroyed)return;const s=this.viewportTransform,n=this.clipPath;this.calcViewportBoundaries(),this.clearContext(t),t.imageSmoothingEnabled=this.imageSmoothingEnabled,t.patternQuality="best",this.fire("before:render",{ctx:t}),this._renderBackground(t),t.save(),t.transform(s[0],s[1],s[2],s[3],s[4],s[5]),this._renderObjects(t,e),t.restore(),this.controlsAboveOverlay||this.skipControlsDrawing||this.drawControls(t),n&&(n._set("canvas",this),n.shouldCache(),n._transformDone=!0,n.renderCache({forClipping:!0}),this.drawClipPathOnCanvas(t,n)),this._renderOverlay(t),this.controlsAboveOverlay&&!this.skipControlsDrawing&&this.drawControls(t),this.fire("after:render",{ctx:t}),this.__cleanupTask&&(this.__cleanupTask(),this.__cleanupTask=void 0)}drawClipPathOnCanvas(t,e){const s=this.viewportTransform;t.save(),t.transform(...s),t.globalCompositeOperation="destination-in",e.transform(t),t.scale(1/e.zoomX,1/e.zoomY),t.drawImage(e._cacheCanvas,-e.cacheTranslationX,-e.cacheTranslationY),t.restore()}_renderObjects(t,e){for(let s=0,n=e.length;s<n;++s)e[s]&&e[s].render(t)}_renderBackgroundOrOverlay(t,e){const s=this["".concat(e,"Color")],n=this["".concat(e,"Image")],i=this.viewportTransform,r=this["".concat(e,"Vpt")];if(!s&&!n)return;const o=Jt(s);if(s){if(t.save(),t.beginPath(),t.moveTo(0,0),t.lineTo(this.width,0),t.lineTo(this.width,this.height),t.lineTo(0,this.height),t.closePath(),t.fillStyle=o?s.toLive(t):s,r&&t.transform(...i),o){t.transform(1,0,0,1,s.offsetX||0,s.offsetY||0);const e=s.gradientTransform||s.patternTransform;e&&t.transform(...e)}t.fill(),t.restore()}if(n){t.save();const{skipOffscreen:e}=this;this.skipOffscreen=r,r&&t.transform(...i),n.render(t),this.skipOffscreen=e,t.restore()}}_renderBackground(t){this._renderBackgroundOrOverlay(t,"background")}_renderOverlay(t){this._renderBackgroundOrOverlay(t,"overlay")}getCenter(){return{top:this.height/2,left:this.width/2}}getCenterPoint(){return new gt(this.width/2,this.height/2)}centerObjectH(t){return this._centerObject(t,new gt(this.getCenterPoint().x,t.getCenterPoint().y))}centerObjectV(t){return this._centerObject(t,new gt(t.getCenterPoint().x,this.getCenterPoint().y))}centerObject(t){return this._centerObject(t,this.getCenterPoint())}viewportCenterObject(t){return this._centerObject(t,this.getVpCenter())}viewportCenterObjectH(t){return this._centerObject(t,new gt(this.getVpCenter().x,t.getCenterPoint().y))}viewportCenterObjectV(t){return this._centerObject(t,new gt(t.getCenterPoint().x,this.getVpCenter().y))}getVpCenter(){return Dt(this.getCenterPoint(),Pt(this.viewportTransform))}_centerObject(t,e){t.setXY(e,F,F),t.setCoords(),this.renderOnAddRemove&&this.requestRenderAll()}toDatalessJSON(t){return this.toDatalessObject(t)}toObject(t){return this._toObjectMethod("toObject",t)}toJSON(){return this.toObject()}toDatalessObject(t){return this._toObjectMethod("toDatalessObject",t)}_toObjectMethod(t,e){const s=this.clipPath,n=s&&!s.excludeFromExport?this._toObject(s,t,e):null;return l(l(l({version:A},zt(this,e)),{},{objects:this._objects.filter((t=>!t.excludeFromExport)).map((s=>this._toObject(s,t,e)))},this.__serializeBgOverlay(t,e)),n?{clipPath:n}:null)}_toObject(t,e,s){let n;this.includeDefaultValues||(n=t.includeDefaultValues,t.includeDefaultValues=!1);const i=t[e](s);return this.includeDefaultValues||(t.includeDefaultValues=!!n),i}__serializeBgOverlay(t,e){const s={},n=this.backgroundImage,i=this.overlayImage,r=this.backgroundColor,o=this.overlayColor;return Jt(r)?r.excludeFromExport||(s.background=r.toObject(e)):r&&(s.background=r),Jt(o)?o.excludeFromExport||(s.overlay=o.toObject(e)):o&&(s.overlay=o),n&&!n.excludeFromExport&&(s.backgroundImage=this._toObject(n,t,e)),i&&!i.excludeFromExport&&(s.overlayImage=this._toObject(i,t,e)),s}toSVG(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},e=arguments.length>1?arguments[1]:void 0;t.reviver=e;const s=[];return this._setSVGPreamble(s,t),this._setSVGHeader(s,t),this.clipPath&&s.push('<g clip-path="url(#'.concat(this.clipPath.clipPathId,')" >\n')),this._setSVGBgOverlayColor(s,"background"),this._setSVGBgOverlayImage(s,"backgroundImage",e),this._setSVGObjects(s,e),this.clipPath&&s.push("</g>\n"),this._setSVGBgOverlayColor(s,"overlay"),this._setSVGBgOverlayImage(s,"overlayImage",e),s.push("</svg>"),s.join("")}_setSVGPreamble(t,e){e.suppressPreamble||t.push('<?xml version="1.0" encoding="',e.encoding||"UTF-8",'" standalone="no" ?>\n','<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN" ','"http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">\n')}_setSVGHeader(t,e){const s=e.width||"".concat(this.width),n=e.height||"".concat(this.height),i=p.NUM_FRACTION_DIGITS,r=e.viewBox;let o;if(r)o='viewBox="'.concat(r.x," ").concat(r.y," ").concat(r.width," ").concat(r.height,'" ');else if(this.svgViewportTransformation){const t=this.viewportTransform;o='viewBox="'.concat(Kt(-t[4]/t[0],i)," ").concat(Kt(-t[5]/t[3],i)," ").concat(Kt(this.width/t[0],i)," ").concat(Kt(this.height/t[3],i),'" ')}else o='viewBox="0 0 '.concat(this.width," ").concat(this.height,'" ');t.push("<svg ",'xmlns="http://www.w3.org/2000/svg" ','xmlns:xlink="http://www.w3.org/1999/xlink" ','version="1.1" ','width="',s,'" ','height="',n,'" ',o,'xml:space="preserve">\n',"<desc>Created with Fabric.js ",A,"</desc>\n","<defs>\n",this.createSVGFontFacesMarkup(),this.createSVGRefElementsMarkup(),this.createSVGClipPathMarkup(e),"</defs>\n")}createSVGClipPathMarkup(t){const e=this.clipPath;return e?(e.clipPathId="CLIPPATH_".concat(bt()),'<clipPath id="'.concat(e.clipPathId,'" >\n').concat(e.toClipPathSVG(t.reviver),"</clipPath>\n")):""}createSVGRefElementsMarkup(){return["background","overlay"].map((t=>{const e=this["".concat(t,"Color")];if(Jt(e)){const s=this["".concat(t,"Vpt")],n=this.viewportTransform,i={isType:()=>!1,width:this.width/(s?n[0]:1),height:this.height/(s?n[3]:1)};return e.toSVG(i,{additionalTransform:s?Qt(n):""})}})).join("")}createSVGFontFacesMarkup(){const t=[],e={},s=p.fontPaths;this._objects.forEach((function e(s){t.push(s),ft(s)&&s._objects.forEach(e)})),t.forEach((t=>{if(!(n=t)||"function"!=typeof n._renderText)return;var n;const{styles:i,fontFamily:r}=t;!e[r]&&s[r]&&(e[r]=!0,i&&Object.values(i).forEach((t=>{Object.values(t).forEach((t=>{let{fontFamily:n=""}=t;!e[n]&&s[n]&&(e[n]=!0)}))})))}));const n=Object.keys(e).map((t=>"\t\t@font-face {\n\t\t\tfont-family: '".concat(t,"';\n\t\t\tsrc: url('").concat(s[t],"');\n\t\t}\n"))).join("");return n?'\t<style type="text/css"><![CDATA[\n'.concat(n,"]]></style>\n"):""}_setSVGObjects(t,e){this.forEachObject((s=>{s.excludeFromExport||this._setSVGObject(t,s,e)}))}_setSVGObject(t,e,s){t.push(e.toSVG(s))}_setSVGBgOverlayImage(t,e,s){const n=this[e];n&&!n.excludeFromExport&&n.toSVG&&t.push(n.toSVG(s))}_setSVGBgOverlayColor(t,e){const s=this["".concat(e,"Color")];if(s)if(Jt(s)){const n=s.repeat||"",i=this.width,r=this.height,o=this["".concat(e,"Vpt")]?Qt(Pt(this.viewportTransform)):"";t.push('<rect transform="'.concat(o," translate(").concat(i/2,",").concat(r/2,')" x="').concat(s.offsetX-i/2,'" y="').concat(s.offsetY-r/2,'" width="').concat("repeat-y"!==n&&"no-repeat"!==n||!$t(s)?i:s.source.width,'" height="').concat("repeat-x"!==n&&"no-repeat"!==n||!$t(s)?r:s.source.height,'" fill="url(#SVGID_').concat(s.id,')"></rect>\n'))}else t.push('<rect x="0" y="0" width="100%" height="100%" ','fill="',s,'"',"></rect>\n")}loadFromJSON(t,e){let{signal:s}=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};if(!t)return Promise.reject(new m("`json` is undefined"));const n="string"==typeof t?JSON.parse(t):t,{objects:i=[],backgroundImage:r,background:o,overlayImage:a,overlay:h,clipPath:c}=n,l=this.renderOnAddRemove;return this.renderOnAddRemove=!1,Promise.all([Gt(i,{reviver:e,signal:s}),Ht({backgroundImage:r,backgroundColor:o,overlayImage:a,overlayColor:h,clipPath:c},{signal:s})]).then((t=>{let[e,s]=t;return this.clear(),this.add(...e),this.set(n),this.set(s),this.renderOnAddRemove=l,this}))}clone(t){const e=this.toObject(t);return this.cloneWithoutData().loadFromJSON(e)}cloneWithoutData(){const t=St(this);return new this.constructor(t)}toDataURL(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};const{format:e="png",quality:s=1,multiplier:n=1,enableRetinaScaling:i=!1}=t,r=n*(i?this.getRetinaScaling():1);return Tt(this.toCanvasElement(r,t),e,s)}toBlob(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};const{format:e="png",quality:s=1,multiplier:n=1,enableRetinaScaling:i=!1}=t,r=n*(i?this.getRetinaScaling():1);return kt(this.toCanvasElement(r,t),e,s)}toCanvasElement(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,{width:e,height:s,left:n,top:i,filter:r}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const o=(e||this.width)*t,a=(s||this.height)*t,h=this.getZoom(),c=this.width,l=this.height,u=this.skipControlsDrawing,d=h*t,g=this.viewportTransform,p=[d,0,0,d,(g[4]-(n||0))*t,(g[5]-(i||0))*t],f=this.enableRetinaScaling,m=St({width:o,height:a}),_=r?this._objects.filter((t=>r(t))):this._objects;return this.enableRetinaScaling=!1,this.viewportTransform=p,this.width=o,this.height=a,this.skipControlsDrawing=!0,this.calcViewportBoundaries(),this.renderCanvas(m.getContext("2d"),_),this.viewportTransform=g,this.width=c,this.height=l,this.calcViewportBoundaries(),this.enableRetinaScaling=f,this.skipControlsDrawing=u,m}dispose(){return!this.disposed&&this.elements.cleanupDOM({width:this.width,height:this.height}),ht.cancelByCanvas(this),this.disposed=!0,new Promise(((t,e)=>{const s=()=>{this.destroy(),t(!0)};s.kill=e,this.__cleanupTask&&this.__cleanupTask.kill("aborted"),this.destroyed?t(!1):this.nextRenderHandle?this.__cleanupTask=s:s()}))}destroy(){this.destroyed=!0,this.cancelRequestedRender(),this.forEachObject((t=>t.dispose())),this._objects=[],this.backgroundImage&&this.backgroundImage.dispose(),this.backgroundImage=void 0,this.overlayImage&&this.overlayImage.dispose(),this.overlayImage=void 0,this.elements.dispose()}toString(){return"#<Canvas (".concat(this.complexity(),"): { objects: ").concat(this._objects.length," }>")}}h(ce,"ownDefaults",he);const le=["touchstart","touchmove","touchend"],ue=t=>{const e=ee(t.target),s=function(t){const e=t.changedTouches;return e&&e[0]?e[0]:t}(t);return new gt(s.clientX+e.left,s.clientY+e.top)},de=t=>le.includes(t.type)||"touch"===t.pointerType,ge=t=>{t.preventDefault(),t.stopPropagation()},pe=t=>{let e=0,s=0,n=0,i=0;for(let r=0,o=t.length;r<o;r++){const{x:o,y:a}=t[r];(o>n||!r)&&(n=o),(o<e||!r)&&(e=o),(a>i||!r)&&(i=a),(a<s||!r)&&(s=a)}return{left:e,top:s,width:n-e,height:i-s}},fe=["translateX","translateY","scaleX","scaleY"],me=(t,e)=>_e(t,It(e,t.calcOwnMatrix())),_e=(t,e)=>{const s=Ft(e),{translateX:n,translateY:i,scaleX:r,scaleY:o}=s,a=u(s,fe),h=new gt(n,i);t.flipX=!1,t.flipY=!1,Object.assign(t,a),t.set({scaleX:r,scaleY:o}),t.setPositionByOrigin(h,F,F)},ve=t=>{t.scaleX=1,t.scaleY=1,t.skewX=0,t.skewY=0,t.flipX=!1,t.flipY=!1,t.rotate(0)},ye=t=>({scaleX:t.scaleX,scaleY:t.scaleY,skewX:t.skewX,skewY:t.skewY,angle:t.angle,left:t.left,flipX:t.flipX,flipY:t.flipY,top:t.top}),Ce=(t,e,s)=>{const n=t/2,i=e/2,r=[new gt(-n,-i),new gt(n,-i),new gt(-n,i),new gt(n,i)].map((t=>t.transform(s))),o=pe(r);return new gt(o.width,o.height)},be=function(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:I;return It(Pt(arguments.length>1&&void 0!==arguments[1]?arguments[1]:I),t)},we=function(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:I,s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:I;return t.transform(be(e,s))},xe=function(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:I,s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:I;return t.transform(be(e,s),!0)},Se=(t,e,s)=>{const n=be(e,s);return _e(t,It(n,t.calcOwnMatrix())),n},Te=(t,e)=>{var s;const{transform:{target:n}}=e;null===(s=n.canvas)||void 0===s||s.fire("object:".concat(t),l(l({},e),{},{target:n})),n.fire(t,e)},ke={left:-.5,top:-.5,center:0,bottom:.5,right:.5},Ae=t=>"string"==typeof t?ke[t]:t-.5,Ee="not-allowed";function Oe(t){return Ae(t.originX)===Ae(F)&&Ae(t.originY)===Ae(F)}function De(t){return.5-Ae(t)}const Pe=(t,e)=>t[e],Ie=(t,e,s,n)=>({e:t,transform:e,pointer:new gt(s,n)});function Me(t,e){const s=t.getTotalAngle()+Et(Math.atan2(e.y,e.x))+360;return Math.round(s%360/45)}function Re(t,e,s,n,i){var r;let{target:o,corner:a}=t;const h=o.controls[a],c=(null===(r=o.canvas)||void 0===r?void 0:r.getZoom())||1,l=o.padding/c,u=function(t,e,s,n){const i=t.getRelativeCenterPoint(),r=void 0!==s&&void 0!==n?t.translateToGivenOrigin(i,F,F,s,n):new gt(t.left,t.top);return(t.angle?e.rotate(-At(t.angle),i):e).subtract(r)}(o,new gt(n,i),e,s);return u.x>=l&&(u.x-=l),u.x<=-l&&(u.x+=l),u.y>=l&&(u.y-=l),u.y<=l&&(u.y+=l),u.x-=h.offsetX,u.y-=h.offsetY,u}const Fe=(t,e,s,n)=>{const{target:i,offsetX:r,offsetY:o}=e,a=s-r,h=n-o,c=!Pe(i,"lockMovementX")&&i.left!==a,l=!Pe(i,"lockMovementY")&&i.top!==h;return c&&i.set(L,a),l&&i.set(j,h),(c||l)&&Te(Y,Ie(t,e,s,n)),c||l},Le={aliceblue:"#F0F8FF",antiquewhite:"#FAEBD7",aqua:"#0FF",aquamarine:"#7FFFD4",azure:"#F0FFFF",beige:"#F5F5DC",bisque:"#FFE4C4",black:"#000",blanchedalmond:"#FFEBCD",blue:"#00F",blueviolet:"#8A2BE2",brown:"#A52A2A",burlywood:"#DEB887",cadetblue:"#5F9EA0",chartreuse:"#7FFF00",chocolate:"#D2691E",coral:"#FF7F50",cornflowerblue:"#6495ED",cornsilk:"#FFF8DC",crimson:"#DC143C",cyan:"#0FF",darkblue:"#00008B",darkcyan:"#008B8B",darkgoldenrod:"#B8860B",darkgray:"#A9A9A9",darkgrey:"#A9A9A9",darkgreen:"#006400",darkkhaki:"#BDB76B",darkmagenta:"#8B008B",darkolivegreen:"#556B2F",darkorange:"#FF8C00",darkorchid:"#9932CC",darkred:"#8B0000",darksalmon:"#E9967A",darkseagreen:"#8FBC8F",darkslateblue:"#483D8B",darkslategray:"#2F4F4F",darkslategrey:"#2F4F4F",darkturquoise:"#00CED1",darkviolet:"#9400D3",deeppink:"#FF1493",deepskyblue:"#00BFFF",dimgray:"#696969",dimgrey:"#696969",dodgerblue:"#1E90FF",firebrick:"#B22222",floralwhite:"#FFFAF0",forestgreen:"#228B22",fuchsia:"#F0F",gainsboro:"#DCDCDC",ghostwhite:"#F8F8FF",gold:"#FFD700",goldenrod:"#DAA520",gray:"#808080",grey:"#808080",green:"#008000",greenyellow:"#ADFF2F",honeydew:"#F0FFF0",hotpink:"#FF69B4",indianred:"#CD5C5C",indigo:"#4B0082",ivory:"#FFFFF0",khaki:"#F0E68C",lavender:"#E6E6FA",lavenderblush:"#FFF0F5",lawngreen:"#7CFC00",lemonchiffon:"#FFFACD",lightblue:"#ADD8E6",lightcoral:"#F08080",lightcyan:"#E0FFFF",lightgoldenrodyellow:"#FAFAD2",lightgray:"#D3D3D3",lightgrey:"#D3D3D3",lightgreen:"#90EE90",lightpink:"#FFB6C1",lightsalmon:"#FFA07A",lightseagreen:"#20B2AA",lightskyblue:"#87CEFA",lightslategray:"#789",lightslategrey:"#789",lightsteelblue:"#B0C4DE",lightyellow:"#FFFFE0",lime:"#0F0",limegreen:"#32CD32",linen:"#FAF0E6",magenta:"#F0F",maroon:"#800000",mediumaquamarine:"#66CDAA",mediumblue:"#0000CD",mediumorchid:"#BA55D3",mediumpurple:"#9370DB",mediumseagreen:"#3CB371",mediumslateblue:"#7B68EE",mediumspringgreen:"#00FA9A",mediumturquoise:"#48D1CC",mediumvioletred:"#C71585",midnightblue:"#191970",mintcream:"#F5FFFA",mistyrose:"#FFE4E1",moccasin:"#FFE4B5",navajowhite:"#FFDEAD",navy:"#000080",oldlace:"#FDF5E6",olive:"#808000",olivedrab:"#6B8E23",orange:"#FFA500",orangered:"#FF4500",orchid:"#DA70D6",palegoldenrod:"#EEE8AA",palegreen:"#98FB98",paleturquoise:"#AFEEEE",palevioletred:"#DB7093",papayawhip:"#FFEFD5",peachpuff:"#FFDAB9",peru:"#CD853F",pink:"#FFC0CB",plum:"#DDA0DD",powderblue:"#B0E0E6",purple:"#800080",rebeccapurple:"#639",red:"#F00",rosybrown:"#BC8F8F",royalblue:"#4169E1",saddlebrown:"#8B4513",salmon:"#FA8072",sandybrown:"#F4A460",seagreen:"#2E8B57",seashell:"#FFF5EE",sienna:"#A0522D",silver:"#C0C0C0",skyblue:"#87CEEB",slateblue:"#6A5ACD",slategray:"#708090",slategrey:"#708090",snow:"#FFFAFA",springgreen:"#00FF7F",steelblue:"#4682B4",tan:"#D2B48C",teal:"#008080",thistle:"#D8BFD8",tomato:"#FF6347",turquoise:"#40E0D0",violet:"#EE82EE",wheat:"#F5DEB3",white:"#FFF",whitesmoke:"#F5F5F5",yellow:"#FF0",yellowgreen:"#9ACD32"},je=(t,e,s)=>(s<0&&(s+=1),s>1&&(s-=1),s<1/6?t+6*(e-t)*s:s<.5?e:s<2/3?t+(e-t)*(2/3-s)*6:t),Ne=(t,e,s,n)=>{t/=255,e/=255,s/=255;const i=Math.max(t,e,s),r=Math.min(t,e,s);let o,a;const h=(i+r)/2;if(i===r)o=a=0;else{const n=i-r;switch(a=h>.5?n/(2-i-r):n/(i+r),i){case t:o=(e-s)/n+(e<s?6:0);break;case e:o=(s-t)/n+2;break;case s:o=(t-e)/n+4}o/=6}return[Math.round(360*o),Math.round(100*a),Math.round(100*h),n]},Be=function(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"1";return parseFloat(t)/(t.endsWith("%")?100:1)},We=t=>Math.min(Math.round(t),255).toString(16).toUpperCase().padStart(2,"0"),Ue=t=>{let[e,s,n,i=1]=t;const r=Math.round(.3*e+.59*s+.11*n);return[r,r,r,i]};class Ye{constructor(t){if(h(this,"isUnrecognised",!1),t)if(t instanceof Ye)this.setSource([...t._source]);else if(Array.isArray(t)){const[e,s,n,i=1]=t;this.setSource([e,s,n,i])}else this.setSource(this._tryParsingColor(t));else this.setSource([0,0,0,1])}_tryParsingColor(t){return(t=t.toLowerCase())in Le&&(t=Le[t]),"transparent"===t?[255,255,255,0]:Ye.sourceFromHex(t)||Ye.sourceFromRgb(t)||Ye.sourceFromHsl(t)||(this.isUnrecognised=!0)&&[0,0,0,1]}getSource(){return this._source}setSource(t){this._source=t}toRgb(){const[t,e,s]=this.getSource();return"rgb(".concat(t,",").concat(e,",").concat(s,")")}toRgba(){return"rgba(".concat(this.getSource().join(","),")")}toHsl(){const[t,e,s]=Ne(...this.getSource());return"hsl(".concat(t,",").concat(e,"%,").concat(s,"%)")}toHsla(){const[t,e,s,n]=Ne(...this.getSource());return"hsla(".concat(t,",").concat(e,"%,").concat(s,"%,").concat(n,")")}toHex(){return this.toHexa().slice(0,6)}toHexa(){const[t,e,s,n]=this.getSource();return"".concat(We(t)).concat(We(e)).concat(We(s)).concat(We(Math.round(255*n)))}getAlpha(){return this.getSource()[3]}setAlpha(t){return this._source[3]=t,this}toGrayscale(){return this.setSource(Ue(this.getSource())),this}toBlackWhite(t){const[e,,,s]=Ue(this.getSource()),n=e<(t||127)?0:255;return this.setSource([n,n,n,s]),this}overlayWith(t){t instanceof Ye||(t=new Ye(t));const e=this.getSource(),s=t.getSource(),[n,i,r]=e.map(((t,e)=>Math.round(.5*t+.5*s[e])));return this.setSource([n,i,r,e[3]]),this}static fromRgb(t){return Ye.fromRgba(t)}static fromRgba(t){return new Ye(Ye.sourceFromRgb(t))}static sourceFromRgb(t){const e=t.match(/^rgba?\(\s*(\d{0,3}(?:\.\d+)?%?)\s*[\s|,]\s*(\d{0,3}(?:\.\d+)?%?)\s*[\s|,]\s*(\d{0,3}(?:\.\d+)?%?)\s*(?:\s*[,/]\s*(\d{0,3}(?:\.\d+)?%?)\s*)?\)$/i);if(e){const[t,s,n]=e.slice(1,4).map((t=>{const e=parseFloat(t);return t.endsWith("%")?Math.round(2.55*e):e}));return[t,s,n,Be(e[4])]}}static fromHsl(t){return Ye.fromHsla(t)}static fromHsla(t){return new Ye(Ye.sourceFromHsl(t))}static sourceFromHsl(t){const e=t.match(/^hsla?\(\s*([+-]?\d{0,3}(?:\.\d+)?(?:deg|turn|rad)?)\s*[\s|,]\s*(\d{0,3}(?:\.\d+)?%?)\s*[\s|,]\s*(\d{0,3}(?:\.\d+)?%?)\s*(?:\s*[,/]\s*(\d*(?:\.\d+)?%?)\s*)?\)$/i);if(!e)return;const s=(Ye.parseAngletoDegrees(e[1])%360+360)%360/360,n=parseFloat(e[2])/100,i=parseFloat(e[3])/100;let r,o,a;if(0===n)r=o=a=i;else{const t=i<=.5?i*(n+1):i+n-i*n,e=2*i-t;r=je(e,t,s+1/3),o=je(e,t,s),a=je(e,t,s-1/3)}return[Math.round(255*r),Math.round(255*o),Math.round(255*a),Be(e[4])]}static fromHex(t){return new Ye(Ye.sourceFromHex(t))}static sourceFromHex(t){if(t.match(/^#?(([0-9a-f]){3,4}|([0-9a-f]{2}){3,4})$/i)){const e=t.slice(t.indexOf("#")+1);let s;s=e.length<=4?e.split("").map((t=>t+t)):e.match(/.{2}/g);const[n,i,r,o=255]=s.map((t=>parseInt(t,16)));return[n,i,r,o/255]}}static parseAngletoDegrees(t){const e=t.toLowerCase(),s=parseFloat(e);return e.includes("rad")?Et(s):e.includes("turn")?360*s:s}}const Xe=function(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:M;const s=/\D{0,2}$/.exec(t),n=parseFloat(t),i=p.DPI;switch(null==s?void 0:s[0]){case"mm":return n*i/25.4;case"cm":return n*i/2.54;case"in":return n*i;case"pt":return n*i/72;case"pc":return n*i/72*12;case"em":return n*e;default:return n}},Ve=t=>{const[e,s]=t.trim().split(" "),[n,i]=(r=e)&&r!==W?[r.slice(1,4),r.slice(5,8)]:r===W?[r,r]:["Mid","Mid"];var r;return{meetOrSlice:s||"meet",alignX:n,alignY:i}},Ge=function(t,e){let s,n,i=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];if(e)if(e.toLive)s="url(#SVGID_".concat(e.id,")");else{const t=new Ye(e),i=t.getAlpha();s=t.toRgb(),1!==i&&(n=i.toString())}else s="none";return i?"".concat(t,": ").concat(s,"; ").concat(n?"".concat(t,"-opacity: ").concat(n,"; "):""):"".concat(t,'="').concat(s,'" ').concat(n?"".concat(t,'-opacity="').concat(n,'" '):"")};class He{getSvgStyles(t){const e=this.fillRule?this.fillRule:"nonzero",s=this.strokeWidth?this.strokeWidth:"0",n=this.strokeDashArray?this.strokeDashArray.join(" "):W,i=this.strokeDashOffset?this.strokeDashOffset:"0",r=this.strokeLineCap?this.strokeLineCap:"butt",o=this.strokeLineJoin?this.strokeLineJoin:"miter",a=this.strokeMiterLimit?this.strokeMiterLimit:"4",h=void 0!==this.opacity?this.opacity:"1",c=this.visible?"":" visibility: hidden;",l=t?"":this.getSvgFilter(),u=Ge(st,this.fill);return[Ge(nt,this.stroke),"stroke-width: ",s,"; ","stroke-dasharray: ",n,"; ","stroke-linecap: ",r,"; ","stroke-dashoffset: ",i,"; ","stroke-linejoin: ",o,"; ","stroke-miterlimit: ",a,"; ",u,"fill-rule: ",e,"; ","opacity: ",h,";",l,c].join("")}getSvgFilter(){return this.shadow?"filter: url(#SVGID_".concat(this.shadow.id,");"):""}getSvgCommons(){return[this.id?'id="'.concat(this.id,'" '):"",this.clipPath?'clip-path="url(#'.concat(this.clipPath.clipPathId,')" '):""].join("")}getSvgTransform(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";const s=t?this.calcTransformMatrix():this.calcOwnMatrix(),n='transform="'.concat(Qt(s));return"".concat(n).concat(e,'" ')}_toSVG(t){return[""]}toSVG(t){return this._createBaseSVGMarkup(this._toSVG(t),{reviver:t})}toClipPathSVG(t){return"\t"+this._createBaseClipPathSVGMarkup(this._toSVG(t),{reviver:t})}_createBaseClipPathSVGMarkup(t){let{reviver:e,additionalTransform:s=""}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const n=[this.getSvgTransform(!0,s),this.getSvgCommons()].join(""),i=t.indexOf("COMMON_PARTS");return t[i]=n,e?e(t.join("")):t.join("")}_createBaseSVGMarkup(t){let{noStyle:e,reviver:s,withShadow:n,additionalTransform:i}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const r=e?"":'style="'.concat(this.getSvgStyles(),'" '),o=n?'style="'.concat(this.getSvgFilter(),'" '):"",a=this.clipPath,h=this.strokeUniform?'vector-effect="non-scaling-stroke" ':"",c=a&&a.absolutePositioned,l=this.stroke,u=this.fill,d=this.shadow,g=[],p=t.indexOf("COMMON_PARTS");let f;a&&(a.clipPathId="CLIPPATH_".concat(bt()),f='<clipPath id="'.concat(a.clipPathId,'" >\n').concat(a.toClipPathSVG(s),"</clipPath>\n")),c&&g.push("<g ",o,this.getSvgCommons()," >\n"),g.push("<g ",this.getSvgTransform(!1),c?"":o+this.getSvgCommons()," >\n");const m=[r,h,e?"":this.addPaintOrder()," ",i?'transform="'.concat(i,'" '):""].join("");return t[p]=m,Jt(u)&&g.push(u.toSVG(this)),Jt(l)&&g.push(l.toSVG(this)),d&&g.push(d.toSVG(this)),a&&g.push(f),g.push(t.join("")),g.push("</g>\n"),c&&g.push("</g>\n"),s?s(g.join("")):g.join("")}addPaintOrder(){return this.paintFirst!==st?' paint-order="'.concat(this.paintFirst,'" '):""}}function ze(t){return new RegExp("^("+t.join("|")+")\\b","i")}const qe="textDecorationThickness",Ke=["fontSize","fontWeight","fontFamily","fontStyle"],Qe=["underline","overline","linethrough"],Je=[...Ke,"lineHeight","text","charSpacing","textAlign","styles","path","pathStartOffset","pathSide","pathAlign"],Ze=[...Je,...Qe,"textBackgroundColor","direction",qe],$e=[...Ke,...Qe,nt,"strokeWidth",st,"deltaY","textBackgroundColor",qe],ts={_reNewline:U,_reSpacesAndTabs:/[ \t\r]/g,_reSpaceAndTab:/[ \t\r]/,_reWords:/\S+/g,fontSize:40,fontWeight:"normal",fontFamily:"Times New Roman",underline:!1,overline:!1,linethrough:!1,textAlign:L,fontStyle:"normal",lineHeight:1.16,textBackgroundColor:"",stroke:null,shadow:null,path:void 0,pathStartOffset:0,pathSide:L,pathAlign:"baseline",charSpacing:0,deltaY:0,direction:"ltr",CACHE_FONT_SIZE:400,MIN_TEXT_WIDTH:2,superscript:{size:.6,baseline:-.35},subscript:{size:.6,baseline:.11},_fontSizeFraction:.222,offsets:{underline:.1,linethrough:-.28167,overline:-.81333},_fontSizeMult:1.13,[qe]:66.667},es="justify",ss="justify-left",ns="justify-right",is="justify-center";var rs,os,as;const hs=String.raw(rs||(rs=d(["[-+]?(?:d*.d+|d+.?)(?:[eE][-+]?d+)?"],["[-+]?(?:\\d*\\.\\d+|\\d+\\.?)(?:[eE][-+]?\\d+)?"]))),cs=String.raw(os||(os=d(["(?:s*,?s+|s*,s*)"],["(?:\\s*,?\\s+|\\s*,\\s*)"]))),ls="http://www.w3.org/2000/svg",us=new RegExp("(normal|italic)?\\s*(normal|small-caps)?\\s*(normal|bold|bolder|lighter|100|200|300|400|500|600|700|800|900)?\\s*("+hs+"(?:px|cm|mm|em|pt|pc|in)*)(?:\\/(normal|"+hs+"))?\\s+(.*)"),ds={cx:L,x:L,r:"radius",cy:j,y:j,display:"visible",visibility:"visible",transform:"transformMatrix","fill-opacity":"fillOpacity","fill-rule":"fillRule","font-family":"fontFamily","font-size":"fontSize","font-style":"fontStyle","font-weight":"fontWeight","letter-spacing":"charSpacing","paint-order":"paintFirst","stroke-dasharray":"strokeDashArray","stroke-dashoffset":"strokeDashOffset","stroke-linecap":"strokeLineCap","stroke-linejoin":"strokeLineJoin","stroke-miterlimit":"strokeMiterLimit","stroke-opacity":"strokeOpacity","stroke-width":"strokeWidth","text-decoration":"textDecoration","text-anchor":"textAnchor",opacity:"opacity","clip-path":"clipPath","clip-rule":"clipRule","vector-effect":"strokeUniform","image-rendering":"imageSmoothing","text-decoration-thickness":qe},gs="font-size",ps="clip-path",fs=ze(["path","circle","polygon","polyline","ellipse","rect","line","image","text"]),ms=ze(["symbol","image","marker","pattern","view","svg"]),_s=ze(["symbol","g","a","svg","clipPath","defs"]),vs=new RegExp(String.raw(as||(as=d(["^s*(",")","(",")","(",")","(",")s*$"],["^\\s*(",")","(",")","(",")","(",")\\s*$"])),hs,cs,hs,cs,hs,cs,hs)),ys=new gt(1,0),Cs=new gt,bs=(t,e)=>t.rotate(e),ws=(t,e)=>new gt(e).subtract(t),xs=t=>t.distanceFrom(Cs),Ss=(t,e)=>Math.atan2(Es(t,e),Os(t,e)),Ts=t=>Ss(ys,t),ks=t=>t.eq(Cs)?t:t.scalarDivide(xs(t)),As=function(t){let e=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];return ks(new gt(-t.y,t.x).scalarMultiply(e?1:-1))},Es=(t,e)=>t.x*e.y-t.y*e.x,Os=(t,e)=>t.x*e.x+t.y*e.y,Ds=(t,e,s)=>{if(t.eq(e)||t.eq(s))return!0;const n=Es(e,s),i=Es(e,t),r=Es(s,t);return n>=0?i>=0&&r<=0:!(i<=0&&r>=0)},Ps="(-?\\d+(?:\\.\\d*)?(?:px)?(?:\\s?|$))?",Is=new RegExp("(?:\\s|^)"+Ps+Ps+"("+hs+"?(?:px)?)?(?:\\s?|$)(?:$|\\s)");class Ms{constructor(t){const e="string"==typeof t?Ms.parseShadow(t):t;Object.assign(this,Ms.ownDefaults,e),this.id=bt()}static parseShadow(t){const e=t.trim(),[,s=0,n=0,i=0]=(Is.exec(e)||[]).map((t=>parseFloat(t)||0));return{color:(e.replace(Is,"")||"rgb(0,0,0)").trim(),offsetX:s,offsetY:n,blur:i}}toString(){return[this.offsetX,this.offsetY,this.blur,this.color].join("px ")}toSVG(t){const e=bs(new gt(this.offsetX,this.offsetY),At(-t.angle)),s=new Ye(this.color);let n=40,i=40;return t.width&&t.height&&(n=100*Kt((Math.abs(e.x)+this.blur)/t.width,p.NUM_FRACTION_DIGITS)+20,i=100*Kt((Math.abs(e.y)+this.blur)/t.height,p.NUM_FRACTION_DIGITS)+20),t.flipX&&(e.x*=-1),t.flipY&&(e.y*=-1),'<filter id="SVGID_'.concat(this.id,'" y="-').concat(i,'%" height="').concat(100+2*i,'%" x="-').concat(n,'%" width="').concat(100+2*n,'%" >\n\t<feGaussianBlur in="SourceAlpha" stdDeviation="').concat(Kt(this.blur?this.blur/2:0,p.NUM_FRACTION_DIGITS),'"></feGaussianBlur>\n\t<feOffset dx="').concat(Kt(e.x,p.NUM_FRACTION_DIGITS),'" dy="').concat(Kt(e.y,p.NUM_FRACTION_DIGITS),'" result="oBlur" ></feOffset>\n\t<feFlood flood-color="').concat(s.toRgb(),'" flood-opacity="').concat(s.getAlpha(),'"/>\n\t<feComposite in2="oBlur" operator="in" />\n\t<feMerge>\n\t\t<feMergeNode></feMergeNode>\n\t\t<feMergeNode in="SourceGraphic"></feMergeNode>\n\t</feMerge>\n</filter>\n')}toObject(){const t={color:this.color,blur:this.blur,offsetX:this.offsetX,offsetY:this.offsetY,affectStroke:this.affectStroke,nonScaling:this.nonScaling,type:this.constructor.type},e=Ms.ownDefaults;return this.includeDefaultValues?t:qt(t,((t,s)=>t!==e[s]))}static async fromObject(t){return new this(t)}}h(Ms,"ownDefaults",{color:"rgb(0,0,0)",blur:0,offsetX:0,offsetY:0,affectStroke:!1,includeDefaultValues:!0,nonScaling:!1}),h(Ms,"type","shadow"),at.setClass(Ms,"shadow");const Rs=(t,e,s)=>Math.max(t,Math.min(e,s)),Fs=[j,L,Z,$,"flipX","flipY","originX","originY","angle","opacity","globalCompositeOperation","shadow","visible",tt,et],Ls=[st,nt,"strokeWidth","strokeDashArray","width","height","paintFirst","strokeUniform","strokeLineCap","strokeDashOffset","strokeLineJoin","strokeMiterLimit","backgroundColor","clipPath"],js={top:0,left:0,width:0,height:0,angle:0,flipX:!1,flipY:!1,scaleX:1,scaleY:1,minScaleLimit:0,skewX:0,skewY:0,originX:L,originY:j,strokeWidth:1,strokeUniform:!1,padding:0,opacity:1,paintFirst:st,fill:"rgb(0,0,0)",fillRule:"nonzero",stroke:null,strokeDashArray:null,strokeDashOffset:0,strokeLineCap:"butt",strokeLineJoin:"miter",strokeMiterLimit:4,globalCompositeOperation:"source-over",backgroundColor:"",shadow:null,visible:!0,includeDefaultValues:!0,excludeFromExport:!1,objectCaching:!0,clipPath:void 0,inverted:!1,absolutePositioned:!1,centeredRotation:!0,centeredScaling:!1,dirty:!0},Ns=(t,e,s,n)=>(t<Math.abs(e)?(t=e,n=s/4):n=0===e&&0===t?s/D*Math.asin(1):s/D*Math.asin(e/t),{a:t,c:e,p:s,s:n}),Bs=(t,e,s,n,i)=>t*Math.pow(2,10*(n-=1))*Math.sin((n*i-e)*D/s),Ws=(t,e,s,n)=>-s*Math.cos(t/n*O)+s+e,Us=(t,e,s,n)=>(t/=n)<1/2.75?s*(7.5625*t*t)+e:t<2/2.75?s*(7.5625*(t-=1.5/2.75)*t+.75)+e:t<2.5/2.75?s*(7.5625*(t-=2.25/2.75)*t+.9375)+e:s*(7.5625*(t-=2.625/2.75)*t+.984375)+e,Ys=(t,e,s,n)=>s-Us(n-t,0,s,n)+e;var Xs=Object.freeze({__proto__:null,defaultEasing:Ws,easeInBack:function(t,e,s,n){let i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:1.70158;return s*(t/=n)*t*((i+1)*t-i)+e},easeInBounce:Ys,easeInCirc:(t,e,s,n)=>-s*(Math.sqrt(1-(t/=n)*t)-1)+e,easeInCubic:(t,e,s,n)=>s*(t/n)**3+e,easeInElastic:(t,e,s,n)=>{const i=s;let r=0;if(0===t)return e;if(1===(t/=n))return e+s;r||(r=.3*n);const{a:o,s:a,p:h}=Ns(i,s,r,1.70158);return-Bs(o,a,h,t,n)+e},easeInExpo:(t,e,s,n)=>0===t?e:s*2**(10*(t/n-1))+e,easeInOutBack:function(t,e,s,n){let i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:1.70158;return(t/=n/2)<1?s/2*(t*t*((1+(i*=1.525))*t-i))+e:s/2*((t-=2)*t*((1+(i*=1.525))*t+i)+2)+e},easeInOutBounce:(t,e,s,n)=>t<n/2?.5*Ys(2*t,0,s,n)+e:.5*Us(2*t-n,0,s,n)+.5*s+e,easeInOutCirc:(t,e,s,n)=>(t/=n/2)<1?-s/2*(Math.sqrt(1-t**2)-1)+e:s/2*(Math.sqrt(1-(t-=2)*t)+1)+e,easeInOutCubic:(t,e,s,n)=>(t/=n/2)<1?s/2*t**3+e:s/2*((t-2)**3+2)+e,easeInOutElastic:(t,e,s,n)=>{const i=s;let r=0;if(0===t)return e;if(2===(t/=n/2))return e+s;r||(r=n*(.3*1.5));const{a:o,s:a,p:h,c:c}=Ns(i,s,r,1.70158);return t<1?-.5*Bs(o,a,h,t,n)+e:o*Math.pow(2,-10*(t-=1))*Math.sin((t*n-a)*D/h)*.5+c+e},easeInOutExpo:(t,e,s,n)=>0===t?e:t===n?e+s:(t/=n/2)<1?s/2*2**(10*(t-1))+e:s/2*-(2**(-10*--t)+2)+e,easeInOutQuad:(t,e,s,n)=>(t/=n/2)<1?s/2*t**2+e:-s/2*(--t*(t-2)-1)+e,easeInOutQuart:(t,e,s,n)=>(t/=n/2)<1?s/2*t**4+e:-s/2*((t-=2)*t**3-2)+e,easeInOutQuint:(t,e,s,n)=>(t/=n/2)<1?s/2*t**5+e:s/2*((t-2)**5+2)+e,easeInOutSine:(t,e,s,n)=>-s/2*(Math.cos(Math.PI*t/n)-1)+e,easeInQuad:(t,e,s,n)=>s*(t/=n)*t+e,easeInQuart:(t,e,s,n)=>s*(t/=n)*t**3+e,easeInQuint:(t,e,s,n)=>s*(t/n)**5+e,easeInSine:(t,e,s,n)=>-s*Math.cos(t/n*O)+s+e,easeOutBack:function(t,e,s,n){let i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:1.70158;return s*((t=t/n-1)*t*((i+1)*t+i)+1)+e},easeOutBounce:Us,easeOutCirc:(t,e,s,n)=>s*Math.sqrt(1-(t=t/n-1)*t)+e,easeOutCubic:(t,e,s,n)=>s*((t/n-1)**3+1)+e,easeOutElastic:(t,e,s,n)=>{const i=s;let r=0;if(0===t)return e;if(1===(t/=n))return e+s;r||(r=.3*n);const{a:o,s:a,p:h,c:c}=Ns(i,s,r,1.70158);return o*2**(-10*t)*Math.sin((t*n-a)*D/h)+c+e},easeOutExpo:(t,e,s,n)=>t===n?e+s:s*-(2**(-10*t/n)+1)+e,easeOutQuad:(t,e,s,n)=>-s*(t/=n)*(t-2)+e,easeOutQuart:(t,e,s,n)=>-s*((t=t/n-1)*t**3-1)+e,easeOutQuint:(t,e,s,n)=>s*((t/n-1)**5+1)+e,easeOutSine:(t,e,s,n)=>s*Math.sin(t/n*O)+e});const Vs=()=>!1;class Gs{constructor(t){let{startValue:e,byValue:s,duration:n=500,delay:i=0,easing:r=Ws,onStart:o=E,onChange:a=E,onComplete:c=E,abort:l=Vs,target:u}=t;h(this,"_state","pending"),h(this,"durationProgress",0),h(this,"valueProgress",0),this.tick=this.tick.bind(this),this.duration=n,this.delay=i,this.easing=r,this._onStart=o,this._onChange=a,this._onComplete=c,this._abort=l,this.target=u,this.startValue=e,this.byValue=s,this.value=this.startValue,this.endValue=Object.freeze(this.calculate(this.duration).value)}get state(){return this._state}isDone(){return"aborted"===this._state||"completed"===this._state}start(){const t=t=>{"pending"===this._state&&(this.startTime=t||+new Date,this._state="running",this._onStart(),this.tick(this.startTime))};this.register(),this.delay>0?setTimeout((()=>vt(t)),this.delay):vt(t)}tick(t){const e=(t||+new Date)-this.startTime,s=Math.min(e,this.duration);this.durationProgress=s/this.duration;const{value:n,valueProgress:i}=this.calculate(s);this.value=Object.freeze(n),this.valueProgress=i,"aborted"!==this._state&&(this._abort(this.value,this.valueProgress,this.durationProgress)?(this._state="aborted",this.unregister()):e>=this.duration?(this.durationProgress=this.valueProgress=1,this._onChange(this.endValue,this.valueProgress,this.durationProgress),this._state="completed",this._onComplete(this.endValue,this.valueProgress,this.durationProgress),this.unregister()):(this._onChange(this.value,this.valueProgress,this.durationProgress),vt(this.tick)))}register(){ht.push(this)}unregister(){ht.remove(this)}abort(){this._state="aborted",this.unregister()}}const Hs=["startValue","endValue"];class zs extends Gs{constructor(t){let{startValue:e=0,endValue:s=100}=t;super(l(l({},u(t,Hs)),{},{startValue:e,byValue:s-e}))}calculate(t){const e=this.easing(t,this.startValue,this.byValue,this.duration);return{value:e,valueProgress:Math.abs((e-this.startValue)/this.byValue)}}}const qs=["startValue","endValue"];class Ks extends Gs{constructor(t){let{startValue:e=[0],endValue:s=[100]}=t;super(l(l({},u(t,qs)),{},{startValue:e,byValue:s.map(((t,s)=>t-e[s]))}))}calculate(t){const e=this.startValue.map(((e,s)=>this.easing(t,e,this.byValue[s],this.duration,s)));return{value:e,valueProgress:Math.abs((e[0]-this.startValue[0])/this.byValue[0])}}}const Qs=["startValue","endValue","easing","onChange","onComplete","abort"],Js=(t,e,s,n)=>e+s*(1-Math.cos(t/n*O)),Zs=t=>t&&((e,s,n)=>t(new Ye(e).toRgba(),s,n));class $s extends Gs{constructor(t){let{startValue:e,endValue:s,easing:n=Js,onChange:i,onComplete:r,abort:o}=t,a=u(t,Qs);const h=new Ye(e).getSource(),c=new Ye(s).getSource();super(l(l({},a),{},{startValue:h,byValue:c.map(((t,e)=>t-h[e])),easing:n,onChange:Zs(i),onComplete:Zs(r),abort:Zs(o)}))}calculate(t){const[e,s,n,i]=this.startValue.map(((e,s)=>this.easing(t,e,this.byValue[s],this.duration,s))),r=[...[e,s,n].map(Math.round),Rs(0,i,1)];return{value:r,valueProgress:r.map(((t,e)=>0!==this.byValue[e]?Math.abs((t-this.startValue[e])/this.byValue[e]):0)).find((t=>0!==t))||0}}}function tn(t){const e=(t=>Array.isArray(t.startValue)||Array.isArray(t.endValue))(t)?new Ks(t):new zs(t);return e.start(),e}function en(t){const e=new $s(t);return e.start(),e}class sn{constructor(t){this.status=t,this.points=[]}includes(t){return this.points.some((e=>e.eq(t)))}append(){for(var t=arguments.length,e=new Array(t),s=0;s<t;s++)e[s]=arguments[s];return this.points=this.points.concat(e.filter((t=>!this.includes(t)))),this}static isPointContained(t,e,s){let n=arguments.length>3&&void 0!==arguments[3]&&arguments[3];if(e.eq(s))return t.eq(e);if(e.x===s.x)return t.x===e.x&&(n||t.y>=Math.min(e.y,s.y)&&t.y<=Math.max(e.y,s.y));if(e.y===s.y)return t.y===e.y&&(n||t.x>=Math.min(e.x,s.x)&&t.x<=Math.max(e.x,s.x));{const i=ws(e,s),r=ws(e,t).divide(i);return n?Math.abs(r.x)===Math.abs(r.y):r.x===r.y&&r.x>=0&&r.x<=1}}static isPointInPolygon(t,e){const s=new gt(t).setX(Math.min(t.x-1,...e.map((t=>t.x))));let n=0;for(let i=0;i<e.length;i++){const r=this.intersectSegmentSegment(e[i],e[(i+1)%e.length],t,s);if(r.includes(t))return!0;n+=Number("Intersection"===r.status)}return n%2==1}static intersectLineLine(t,e,s,n){let i=!(arguments.length>4&&void 0!==arguments[4])||arguments[4],r=!(arguments.length>5&&void 0!==arguments[5])||arguments[5];const o=e.x-t.x,a=e.y-t.y,h=n.x-s.x,c=n.y-s.y,l=t.x-s.x,u=t.y-s.y,d=h*u-c*l,g=o*u-a*l,p=c*o-h*a;if(0!==p){const e=d/p,s=g/p;return(i||0<=e&&e<=1)&&(r||0<=s&&s<=1)?new sn("Intersection").append(new gt(t.x+e*o,t.y+e*a)):new sn}if(0===d||0===g){const o=i||r||sn.isPointContained(t,s,n)||sn.isPointContained(e,s,n)||sn.isPointContained(s,t,e)||sn.isPointContained(n,t,e);return new sn(o?"Coincident":void 0)}return new sn("Parallel")}static intersectSegmentLine(t,e,s,n){return sn.intersectLineLine(t,e,s,n,!1,!0)}static intersectSegmentSegment(t,e,s,n){return sn.intersectLineLine(t,e,s,n,!1,!1)}static intersectLinePolygon(t,e,s){let n=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];const i=new sn,r=s.length;for(let o,a,h,c=0;c<r;c++){if(o=s[c],a=s[(c+1)%r],h=sn.intersectLineLine(t,e,o,a,n,!1),"Coincident"===h.status)return h;i.append(...h.points)}return i.points.length>0&&(i.status="Intersection"),i}static intersectSegmentPolygon(t,e,s){return sn.intersectLinePolygon(t,e,s,!1)}static intersectPolygonPolygon(t,e){const s=new sn,n=t.length,i=[];for(let r=0;r<n;r++){const o=t[r],a=t[(r+1)%n],h=sn.intersectSegmentPolygon(o,a,e);"Coincident"===h.status?(i.push(h),s.append(o,a)):s.append(...h.points)}return i.length>0&&i.length===t.length?new sn("Coincident"):(s.points.length>0&&(s.status="Intersection"),s)}static intersectPolygonRectangle(t,e,s){const n=e.min(s),i=e.max(s),r=new gt(i.x,n.y),o=new gt(n.x,i.y);return sn.intersectPolygonPolygon(t,[n,r,i,o])}}class nn extends _t{getX(){return this.getXY().x}setX(t){this.setXY(this.getXY().setX(t))}getY(){return this.getXY().y}setY(t){this.setXY(this.getXY().setY(t))}getRelativeX(){return this.left}setRelativeX(t){this.left=t}getRelativeY(){return this.top}setRelativeY(t){this.top=t}getXY(){const t=this.getRelativeXY();return this.group?Dt(t,this.group.calcTransformMatrix()):t}setXY(t,e,s){this.group&&(t=Dt(t,Pt(this.group.calcTransformMatrix()))),this.setRelativeXY(t,e,s)}getRelativeXY(){return new gt(this.left,this.top)}setRelativeXY(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.originX,s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:this.originY;this.setPositionByOrigin(t,e,s)}isStrokeAccountedForInDimensions(){return!1}getCoords(){const{tl:t,tr:e,br:s,bl:n}=this.aCoords||(this.aCoords=this.calcACoords()),i=[t,e,s,n];if(this.group){const t=this.group.calcTransformMatrix();return i.map((e=>Dt(e,t)))}return i}intersectsWithRect(t,e){return"Intersection"===sn.intersectPolygonRectangle(this.getCoords(),t,e).status}intersectsWithObject(t){const e=sn.intersectPolygonPolygon(this.getCoords(),t.getCoords());return"Intersection"===e.status||"Coincident"===e.status||t.isContainedWithinObject(this)||this.isContainedWithinObject(t)}isContainedWithinObject(t){return this.getCoords().every((e=>t.containsPoint(e)))}isContainedWithinRect(t,e){const{left:s,top:n,width:i,height:r}=this.getBoundingRect();return s>=t.x&&s+i<=e.x&&n>=t.y&&n+r<=e.y}isOverlapping(t){return this.intersectsWithObject(t)||this.isContainedWithinObject(t)||t.isContainedWithinObject(this)}containsPoint(t){return sn.isPointInPolygon(t,this.getCoords())}isOnScreen(){if(!this.canvas)return!1;const{tl:t,br:e}=this.canvas.vptCoords;return!!this.getCoords().some((s=>s.x<=e.x&&s.x>=t.x&&s.y<=e.y&&s.y>=t.y))||!!this.intersectsWithRect(t,e)||this.containsPoint(t.midPointFrom(e))}isPartiallyOnScreen(){if(!this.canvas)return!1;const{tl:t,br:e}=this.canvas.vptCoords;return!!this.intersectsWithRect(t,e)||this.getCoords().every((s=>(s.x>=e.x||s.x<=t.x)&&(s.y>=e.y||s.y<=t.y)))&&this.containsPoint(t.midPointFrom(e))}getBoundingRect(){return pe(this.getCoords())}getScaledWidth(){return this._getTransformedDimensions().x}getScaledHeight(){return this._getTransformedDimensions().y}scale(t){this._set(Z,t),this._set($,t),this.setCoords()}scaleToWidth(t){const e=this.getBoundingRect().width/this.getScaledWidth();return this.scale(t/this.width/e)}scaleToHeight(t){const e=this.getBoundingRect().height/this.getScaledHeight();return this.scale(t/this.height/e)}getCanvasRetinaScaling(){var t;return(null===(t=this.canvas)||void 0===t?void 0:t.getRetinaScaling())||1}getTotalAngle(){return this.group?Et(Rt(this.calcTransformMatrix())):this.angle}getViewportTransform(){var t;return(null===(t=this.canvas)||void 0===t?void 0:t.viewportTransform)||I.concat()}calcACoords(){const t=jt({angle:this.angle}),{x:e,y:s}=this.getRelativeCenterPoint(),n=Lt(e,s),i=It(n,t),r=this._getTransformedDimensions(),o=r.x/2,a=r.y/2;return{tl:Dt({x:-o,y:-a},i),tr:Dt({x:o,y:-a},i),bl:Dt({x:-o,y:a},i),br:Dt({x:o,y:a},i)}}setCoords(){this.aCoords=this.calcACoords()}transformMatrixKey(){let t=arguments.length>0&&void 0!==arguments[0]&&arguments[0],e=[];return!t&&this.group&&(e=this.group.transformMatrixKey(t)),e.push(this.top,this.left,this.width,this.height,this.scaleX,this.scaleY,this.angle,this.strokeWidth,this.skewX,this.skewY,+this.flipX,+this.flipY,Ae(this.originX),Ae(this.originY)),e}calcTransformMatrix(){let t=arguments.length>0&&void 0!==arguments[0]&&arguments[0],e=this.calcOwnMatrix();if(t||!this.group)return e;const s=this.transformMatrixKey(t),n=this.matrixCache;return n&&n.key.every(((t,e)=>t===s[e]))?n.value:(this.group&&(e=It(this.group.calcTransformMatrix(!1),e)),this.matrixCache={key:s,value:e},e)}calcOwnMatrix(){const t=this.transformMatrixKey(!0),e=this.ownMatrixCache;if(e&&e.key===t)return e.value;const s=this.getRelativeCenterPoint(),n={angle:this.angle,translateX:s.x,translateY:s.y,scaleX:this.scaleX,scaleY:this.scaleY,skewX:this.skewX,skewY:this.skewY,flipX:this.flipX,flipY:this.flipY},i=Xt(n);return this.ownMatrixCache={key:t,value:i},i}_getNonTransformedDimensions(){return new gt(this.width,this.height).scalarAdd(this.strokeWidth)}_calculateCurrentDimensions(t){return this._getTransformedDimensions(t).transform(this.getViewportTransform(),!0).scalarAdd(2*this.padding)}_getTransformedDimensions(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};const e=l({scaleX:this.scaleX,scaleY:this.scaleY,skewX:this.skewX,skewY:this.skewY,width:this.width,height:this.height,strokeWidth:this.strokeWidth},t),s=e.strokeWidth;let n=s,i=0;this.strokeUniform&&(n=0,i=s);const r=e.width+n,o=e.height+n;let a;return a=0===e.skewX&&0===e.skewY?new gt(r*e.scaleX,o*e.scaleY):Ce(r,o,Yt(e)),a.scalarAdd(i)}translateToGivenOrigin(t,e,s,n,i){let r=t.x,o=t.y;const a=Ae(n)-Ae(e),h=Ae(i)-Ae(s);if(a||h){const t=this._getTransformedDimensions();r+=a*t.x,o+=h*t.y}return new gt(r,o)}translateToCenterPoint(t,e,s){if(e===F&&s===F)return t;const n=this.translateToGivenOrigin(t,e,s,F,F);return this.angle?n.rotate(At(this.angle),t):n}translateToOriginPoint(t,e,s){const n=this.translateToGivenOrigin(t,F,F,e,s);return this.angle?n.rotate(At(this.angle),t):n}getCenterPoint(){const t=this.getRelativeCenterPoint();return this.group?Dt(t,this.group.calcTransformMatrix()):t}getRelativeCenterPoint(){return this.translateToCenterPoint(new gt(this.left,this.top),this.originX,this.originY)}getPointByOrigin(t,e){return this.translateToOriginPoint(this.getRelativeCenterPoint(),t,e)}setPositionByOrigin(t,e,s){const n=this.translateToCenterPoint(t,e,s),i=this.translateToOriginPoint(n,this.originX,this.originY);this.set({left:i.x,top:i.y})}_getLeftTopCoords(){return this.translateToOriginPoint(this.getRelativeCenterPoint(),L,j)}}const rn=["type"],on=["extraParam"];let an=class t extends nn{static getDefaults(){return t.ownDefaults}get type(){const t=this.constructor.type;return"FabricObject"===t?"object":t.toLowerCase()}set type(t){f("warn","Setting type has no effect",t)}constructor(e){super(),h(this,"_cacheContext",null),Object.assign(this,t.ownDefaults),this.setOptions(e)}_createCacheCanvas(){this._cacheCanvas=wt(),this._cacheContext=this._cacheCanvas.getContext("2d"),this._updateCacheCanvas(),this.dirty=!0}_limitCacheSize(t){const e=t.width,s=t.height,n=p.maxCacheSideLimit,i=p.minCacheSideLimit;if(e<=n&&s<=n&&e*s<=p.perfLimitSizeTotal)return e<i&&(t.width=i),s<i&&(t.height=i),t;const r=e/s,[o,a]=k.limitDimsByArea(r),h=Rs(i,o,n),c=Rs(i,a,n);return e>h&&(t.zoomX/=e/h,t.width=h,t.capped=!0),s>c&&(t.zoomY/=s/c,t.height=c,t.capped=!0),t}_getCacheCanvasDimensions(){const t=this.getTotalObjectScaling(),e=this._getTransformedDimensions({skewX:0,skewY:0}),s=e.x*t.x/this.scaleX,n=e.y*t.y/this.scaleY;return{width:Math.ceil(s+2),height:Math.ceil(n+2),zoomX:t.x,zoomY:t.y,x:s,y:n}}_updateCacheCanvas(){const t=this._cacheCanvas,e=this._cacheContext,{width:s,height:n,zoomX:i,zoomY:r,x:o,y:a}=this._limitCacheSize(this._getCacheCanvasDimensions()),h=s!==t.width||n!==t.height,c=this.zoomX!==i||this.zoomY!==r;if(!t||!e)return!1;if(h||c){s!==t.width||n!==t.height?(t.width=s,t.height=n):(e.setTransform(1,0,0,1,0,0),e.clearRect(0,0,t.width,t.height));const h=o/2,c=a/2;return this.cacheTranslationX=Math.round(t.width/2-h)+h,this.cacheTranslationY=Math.round(t.height/2-c)+c,e.translate(this.cacheTranslationX,this.cacheTranslationY),e.scale(i,r),this.zoomX=i,this.zoomY=r,!0}return!1}setOptions(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};this._setOptions(t)}transform(t){const e=this.group&&!this.group._transformDone||this.group&&this.canvas&&t===this.canvas.contextTop,s=this.calcTransformMatrix(!e);t.transform(s[0],s[1],s[2],s[3],s[4],s[5])}getObjectScaling(){if(!this.group)return new gt(Math.abs(this.scaleX),Math.abs(this.scaleY));const t=Ft(this.calcTransformMatrix());return new gt(Math.abs(t.scaleX),Math.abs(t.scaleY))}getTotalObjectScaling(){const t=this.getObjectScaling();if(this.canvas){const e=this.canvas.getZoom(),s=this.getCanvasRetinaScaling();return t.scalarMultiply(e*s)}return t}getObjectOpacity(){let t=this.opacity;return this.group&&(t*=this.group.getObjectOpacity()),t}_constrainScale(t){return Math.abs(t)<this.minScaleLimit?t<0?-this.minScaleLimit:this.minScaleLimit:0===t?1e-4:t}_set(t,e){t!==Z&&t!==$||(e=this._constrainScale(e)),t===Z&&e<0?(this.flipX=!this.flipX,e*=-1):"scaleY"===t&&e<0?(this.flipY=!this.flipY,e*=-1):"shadow"!==t||!e||e instanceof Ms||(e=new Ms(e));const s=this[t]!==e;return this[t]=e,s&&this.constructor.cacheProperties.includes(t)&&(this.dirty=!0),this.parent&&(this.dirty||s&&this.constructor.stateProperties.includes(t))&&this.parent._set("dirty",!0),this}isNotVisible(){return 0===this.opacity||!this.width&&!this.height&&0===this.strokeWidth||!this.visible}render(t){this.isNotVisible()||this.canvas&&this.canvas.skipOffscreen&&!this.group&&!this.isOnScreen()||(t.save(),this._setupCompositeOperation(t),this.drawSelectionBackground(t),this.transform(t),this._setOpacity(t),this._setShadow(t),this.shouldCache()?(this.renderCache(),this.drawCacheOnCanvas(t)):(this._removeCacheCanvas(),this.drawObject(t,!1,{}),this.dirty=!1),t.restore())}drawSelectionBackground(t){}renderCache(t){if(t=t||{},this._cacheCanvas&&this._cacheContext||this._createCacheCanvas(),this.isCacheDirty()&&this._cacheContext){const{zoomX:e,zoomY:s,cacheTranslationX:n,cacheTranslationY:i}=this,{width:r,height:o}=this._cacheCanvas;this.drawObject(this._cacheContext,t.forClipping,{zoomX:e,zoomY:s,cacheTranslationX:n,cacheTranslationY:i,width:r,height:o,parentClipPaths:[]}),this.dirty=!1}}_removeCacheCanvas(){this._cacheCanvas=void 0,this._cacheContext=null}hasStroke(){return this.stroke&&"transparent"!==this.stroke&&0!==this.strokeWidth}hasFill(){return this.fill&&"transparent"!==this.fill}needsItsOwnCache(){return!!(this.paintFirst===nt&&this.hasFill()&&this.hasStroke()&&this.shadow)||!!this.clipPath}shouldCache(){return this.ownCaching=this.objectCaching&&(!this.parent||!this.parent.isOnACache())||this.needsItsOwnCache(),this.ownCaching}willDrawShadow(){return!!this.shadow&&(0!==this.shadow.offsetX||0!==this.shadow.offsetY)}drawClipPathOnCache(t,e,s){t.save(),e.inverted?t.globalCompositeOperation="destination-out":t.globalCompositeOperation="destination-in",t.setTransform(1,0,0,1,0,0),t.drawImage(s,0,0),t.restore()}drawObject(t,e,s){const n=this.fill,i=this.stroke;e?(this.fill="black",this.stroke="",this._setClippingProperties(t)):this._renderBackground(t),this._render(t),this._drawClipPath(t,this.clipPath,s),this.fill=n,this.stroke=i}createClipPathLayer(t,e){const s=St(e),n=s.getContext("2d");if(n.translate(e.cacheTranslationX,e.cacheTranslationY),n.scale(e.zoomX,e.zoomY),t._cacheCanvas=s,e.parentClipPaths.forEach((t=>{t.transform(n)})),e.parentClipPaths.push(t),t.absolutePositioned){const t=Pt(this.calcTransformMatrix());n.transform(t[0],t[1],t[2],t[3],t[4],t[5])}return t.transform(n),t.drawObject(n,!0,e),s}_drawClipPath(t,e,s){if(!e)return;e._transformDone=!0;const n=this.createClipPathLayer(e,s);this.drawClipPathOnCache(t,e,n)}drawCacheOnCanvas(t){t.scale(1/this.zoomX,1/this.zoomY),t.drawImage(this._cacheCanvas,-this.cacheTranslationX,-this.cacheTranslationY)}isCacheDirty(){let t=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(this.isNotVisible())return!1;const e=this._cacheCanvas,s=this._cacheContext;return!(!e||!s||t||!this._updateCacheCanvas())||!!(this.dirty||this.clipPath&&this.clipPath.absolutePositioned)&&(e&&s&&!t&&(s.save(),s.setTransform(1,0,0,1,0,0),s.clearRect(0,0,e.width,e.height),s.restore()),!0)}_renderBackground(t){if(!this.backgroundColor)return;const e=this._getNonTransformedDimensions();t.fillStyle=this.backgroundColor,t.fillRect(-e.x/2,-e.y/2,e.x,e.y),this._removeShadow(t)}_setOpacity(t){this.group&&!this.group._transformDone?t.globalAlpha=this.getObjectOpacity():t.globalAlpha*=this.opacity}_setStrokeStyles(t,e){const s=e.stroke;s&&(t.lineWidth=e.strokeWidth,t.lineCap=e.strokeLineCap,t.lineDashOffset=e.strokeDashOffset,t.lineJoin=e.strokeLineJoin,t.miterLimit=e.strokeMiterLimit,Jt(s)?"percentage"===s.gradientUnits||s.gradientTransform||s.patternTransform?this._applyPatternForTransformedGradient(t,s):(t.strokeStyle=s.toLive(t),this._applyPatternGradientTransform(t,s)):t.strokeStyle=e.stroke)}_setFillStyles(t,e){let{fill:s}=e;s&&(Jt(s)?(t.fillStyle=s.toLive(t),this._applyPatternGradientTransform(t,s)):t.fillStyle=s)}_setClippingProperties(t){t.globalAlpha=1,t.strokeStyle="transparent",t.fillStyle="#000000"}_setLineDash(t,e){e&&0!==e.length&&t.setLineDash(e)}_setShadow(t){if(!this.shadow)return;const e=this.shadow,s=this.canvas,n=this.getCanvasRetinaScaling(),[i,,,r]=(null==s?void 0:s.viewportTransform)||I,o=i*n,a=r*n,h=e.nonScaling?new gt(1,1):this.getObjectScaling();t.shadowColor=e.color,t.shadowBlur=e.blur*p.browserShadowBlurConstant*(o+a)*(h.x+h.y)/4,t.shadowOffsetX=e.offsetX*o*h.x,t.shadowOffsetY=e.offsetY*a*h.y}_removeShadow(t){this.shadow&&(t.shadowColor="",t.shadowBlur=t.shadowOffsetX=t.shadowOffsetY=0)}_applyPatternGradientTransform(t,e){if(!Jt(e))return{offsetX:0,offsetY:0};const s=e.gradientTransform||e.patternTransform,n=-this.width/2+e.offsetX||0,i=-this.height/2+e.offsetY||0;return"percentage"===e.gradientUnits?t.transform(this.width,0,0,this.height,n,i):t.transform(1,0,0,1,n,i),s&&t.transform(s[0],s[1],s[2],s[3],s[4],s[5]),{offsetX:n,offsetY:i}}_renderPaintInOrder(t){this.paintFirst===nt?(this._renderStroke(t),this._renderFill(t)):(this._renderFill(t),this._renderStroke(t))}_render(t){}_renderFill(t){this.fill&&(t.save(),this._setFillStyles(t,this),"evenodd"===this.fillRule?t.fill("evenodd"):t.fill(),t.restore())}_renderStroke(t){if(this.stroke&&0!==this.strokeWidth){if(this.shadow&&!this.shadow.affectStroke&&this._removeShadow(t),t.save(),this.strokeUniform){const e=this.getObjectScaling();t.scale(1/e.x,1/e.y)}this._setLineDash(t,this.strokeDashArray),this._setStrokeStyles(t,this),t.stroke(),t.restore()}}_applyPatternForTransformedGradient(t,e){var s;const n=this._limitCacheSize(this._getCacheCanvasDimensions()),i=this.getCanvasRetinaScaling(),r=n.x/this.scaleX/i,o=n.y/this.scaleY/i,a=St({width:Math.ceil(r),height:Math.ceil(o)}),h=a.getContext("2d");h&&(h.beginPath(),h.moveTo(0,0),h.lineTo(r,0),h.lineTo(r,o),h.lineTo(0,o),h.closePath(),h.translate(r/2,o/2),h.scale(n.zoomX/this.scaleX/i,n.zoomY/this.scaleY/i),this._applyPatternGradientTransform(h,e),h.fillStyle=e.toLive(t),h.fill(),t.translate(-this.width/2-this.strokeWidth/2,-this.height/2-this.strokeWidth/2),t.scale(i*this.scaleX/n.zoomX,i*this.scaleY/n.zoomY),t.strokeStyle=null!==(s=h.createPattern(a,"no-repeat"))&&void 0!==s?s:"")}_findCenterFromElement(){return new gt(this.left+this.width/2,this.top+this.height/2)}clone(t){const e=this.toObject(t);return this.constructor.fromObject(e)}cloneAsImage(t){const e=this.toCanvasElement(t);return new(at.getClass("image"))(e)}toCanvasElement(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};const e=ye(this),s=this.group,n=this.shadow,i=Math.abs,r=t.enableRetinaScaling?T():1,o=(t.multiplier||1)*r,a=t.canvasProvider||(t=>new ce(t,{enableRetinaScaling:!1,renderOnAddRemove:!1,skipOffscreen:!1}));delete this.group,t.withoutTransform&&ve(this),t.withoutShadow&&(this.shadow=null),t.viewportTransform&&Se(this,this.getViewportTransform()),this.setCoords();const h=wt(),c=this.getBoundingRect(),l=this.shadow,u=new gt;if(l){const t=l.blur,e=l.nonScaling?new gt(1,1):this.getObjectScaling();u.x=2*Math.round(i(l.offsetX)+t)*i(e.x),u.y=2*Math.round(i(l.offsetY)+t)*i(e.y)}const d=c.width+u.x,g=c.height+u.y;h.width=Math.ceil(d),h.height=Math.ceil(g);const p=a(h);"jpeg"===t.format&&(p.backgroundColor="#fff"),this.setPositionByOrigin(new gt(p.width/2,p.height/2),F,F);const f=this.canvas;p._objects=[this],this.set("canvas",p),this.setCoords();const m=p.toCanvasElement(o||1,t);return this.set("canvas",f),this.shadow=n,s&&(this.group=s),this.set(e),this.setCoords(),p._objects=[],p.destroy(),m}toDataURL(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return Tt(this.toCanvasElement(t),t.format||"png",t.quality||1)}toBlob(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return kt(this.toCanvasElement(t),t.format||"png",t.quality||1)}isType(){for(var t=arguments.length,e=new Array(t),s=0;s<t;s++)e[s]=arguments[s];return e.includes(this.constructor.type)||e.includes(this.type)}complexity(){return 1}toJSON(){return this.toObject()}rotate(t){const{centeredRotation:e,originX:s,originY:n}=this;if(e){const{x:t,y:e}=this.getRelativeCenterPoint();this.originX=F,this.originY=F,this.left=t,this.top=e}if(this.set("angle",t),e){const{x:t,y:e}=this.translateToOriginPoint(this.getRelativeCenterPoint(),s,n);this.left=t,this.top=e,this.originX=s,this.originY=n}}setOnGroup(){}_setupCompositeOperation(t){this.globalCompositeOperation&&(t.globalCompositeOperation=this.globalCompositeOperation)}dispose(){ht.cancelByTarget(this),this.off(),this._set("canvas",void 0),this._cacheCanvas&&w().dispose(this._cacheCanvas),this._cacheCanvas=void 0,this._cacheContext=null}animate(t,e){return Object.entries(t).reduce(((t,s)=>{let[n,i]=s;return t[n]=this._animate(n,i,e),t}),{})}_animate(t,e){let s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};const n=t.split("."),i=this.constructor.colorProperties.includes(n[n.length-1]),{abort:r,startValue:o,onChange:a,onComplete:h}=s,c=l(l({},s),{},{target:this,startValue:null!=o?o:n.reduce(((t,e)=>t[e]),this),endValue:e,abort:null==r?void 0:r.bind(this),onChange:(t,e,s)=>{n.reduce(((e,s,i)=>(i===n.length-1&&(e[s]=t),e[s])),this),a&&a(t,e,s)},onComplete:(t,e,s)=>{this.setCoords(),h&&h(t,e,s)}});return i?en(c):tn(c)}isDescendantOf(t){const{parent:e,group:s}=this;return e===t||s===t||!!e&&e.isDescendantOf(t)||!!s&&s!==e&&s.isDescendantOf(t)}getAncestors(){const t=[];let e=this;do{e=e.parent,e&&t.push(e)}while(e);return t}findCommonAncestors(t){if(this===t)return{fork:[],otherFork:[],common:[this,...this.getAncestors()]};const e=this.getAncestors(),s=t.getAncestors();if(0===e.length&&s.length>0&&this===s[s.length-1])return{fork:[],otherFork:[t,...s.slice(0,s.length-1)],common:[this]};for(let n,i=0;i<e.length;i++){if(n=e[i],n===t)return{fork:[this,...e.slice(0,i)],otherFork:[],common:e.slice(i)};for(let r=0;r<s.length;r++){if(this===s[r])return{fork:[],otherFork:[t,...s.slice(0,r)],common:[this,...e]};if(n===s[r])return{fork:[this,...e.slice(0,i)],otherFork:[t,...s.slice(0,r)],common:e.slice(i)}}}return{fork:[this,...e],otherFork:[t,...s],common:[]}}hasCommonAncestors(t){const e=this.findCommonAncestors(t);return e&&!!e.common.length}isInFrontOf(t){if(this===t)return;const e=this.findCommonAncestors(t);if(e.fork.includes(t))return!0;if(e.otherFork.includes(this))return!1;const s=e.common[0]||this.canvas;if(!s)return;const n=e.fork.pop(),i=e.otherFork.pop(),r=s._objects.indexOf(n),o=s._objects.indexOf(i);return r>-1&&r>o}toObject(){const e=(arguments.length>0&&void 0!==arguments[0]?arguments[0]:[]).concat(t.customProperties,this.constructor.customProperties||[]);let s;const n=p.NUM_FRACTION_DIGITS,{clipPath:i,fill:r,stroke:o,shadow:a,strokeDashArray:h,left:c,top:u,originX:d,originY:g,width:f,height:m,strokeWidth:_,strokeLineCap:v,strokeDashOffset:y,strokeLineJoin:C,strokeUniform:b,strokeMiterLimit:w,scaleX:x,scaleY:S,angle:T,flipX:k,flipY:E,opacity:O,visible:D,backgroundColor:P,fillRule:I,paintFirst:M,globalCompositeOperation:R,skewX:F,skewY:L}=this;i&&!i.excludeFromExport&&(s=i.toObject(e.concat("inverted","absolutePositioned")));const j=t=>Kt(t,n),N=l(l({},zt(this,e)),{},{type:this.constructor.type,version:A,originX:d,originY:g,left:j(c),top:j(u),width:j(f),height:j(m),fill:Zt(r)?r.toObject():r,stroke:Zt(o)?o.toObject():o,strokeWidth:j(_),strokeDashArray:h?h.concat():h,strokeLineCap:v,strokeDashOffset:y,strokeLineJoin:C,strokeUniform:b,strokeMiterLimit:j(w),scaleX:j(x),scaleY:j(S),angle:j(T),flipX:k,flipY:E,opacity:j(O),shadow:a?a.toObject():a,visible:D,backgroundColor:P,fillRule:I,paintFirst:M,globalCompositeOperation:R,skewX:j(F),skewY:j(L)},s?{clipPath:s}:null);return this.includeDefaultValues?N:this._removeDefaultValues(N)}toDatalessObject(t){return this.toObject(t)}_removeDefaultValues(t){const e=this.constructor.getDefaults(),s=Object.keys(e).length>0?e:Object.getPrototypeOf(this);return qt(t,((t,e)=>{if(e===L||e===j||"type"===e)return!0;const n=s[e];return t!==n&&!(Array.isArray(t)&&Array.isArray(n)&&0===t.length&&0===n.length)}))}toString(){return"#<".concat(this.constructor.type,">")}static _fromObject(t){let e=u(t,rn),s=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},{extraParam:n}=s,i=u(s,on);return Ht(e,i).then((t=>n?(delete t[n],new this(e[n],t)):new this(t)))}static fromObject(t,e){return this._fromObject(t,e)}};h(an,"stateProperties",Fs),h(an,"cacheProperties",Ls),h(an,"ownDefaults",js),h(an,"type","FabricObject"),h(an,"colorProperties",[st,nt,"backgroundColor"]),h(an,"customProperties",[]),at.setClass(an),at.setClass(an,"object");const hn=(t,e,s)=>(n,i,r,o)=>{const a=e(n,i,r,o);return a&&Te(t,l(l({},Ie(n,i,r,o)),s)),a};function cn(t){return(e,s,n,i)=>{const{target:r,originX:o,originY:a}=s,h=r.getRelativeCenterPoint(),c=r.translateToOriginPoint(h,o,a),l=t(e,s,n,i);return r.setPositionByOrigin(c,s.originX,s.originY),l}}const ln=hn(z,cn(((t,e,s,n)=>{const i=Re(e,e.originX,e.originY,s,n);if(Ae(e.originX)===Ae(F)||Ae(e.originX)===Ae(B)&&i.x<0||Ae(e.originX)===Ae(L)&&i.x>0){const{target:t}=e,s=t.strokeWidth/(t.strokeUniform?t.scaleX:1),n=Oe(e)?2:1,r=t.width,o=Math.abs(i.x*n/t.scaleX)-s;return t.set("width",Math.max(o,1)),r!==t.width}return!1})));function un(t,e,s,n,i){n=n||{};const r=this.sizeX||n.cornerSize||i.cornerSize,o=this.sizeY||n.cornerSize||i.cornerSize,a=void 0!==n.transparentCorners?n.transparentCorners:i.transparentCorners,h=a?nt:st,c=!a&&(n.cornerStrokeColor||i.cornerStrokeColor);let l,u=e,d=s;t.save(),t.fillStyle=n.cornerColor||i.cornerColor||"",t.strokeStyle=n.cornerStrokeColor||i.cornerStrokeColor||"",r>o?(l=r,t.scale(1,o/r),d=s*r/o):o>r?(l=o,t.scale(r/o,1),u=e*o/r):l=r,t.beginPath(),t.arc(u,d,l/2,0,D,!1),t[h](),c&&t.stroke(),t.restore()}function dn(t,e,s,n,i){n=n||{};const r=this.sizeX||n.cornerSize||i.cornerSize,o=this.sizeY||n.cornerSize||i.cornerSize,a=void 0!==n.transparentCorners?n.transparentCorners:i.transparentCorners,h=a?nt:st,c=!a&&(n.cornerStrokeColor||i.cornerStrokeColor),l=r/2,u=o/2;t.save(),t.fillStyle=n.cornerColor||i.cornerColor||"",t.strokeStyle=n.cornerStrokeColor||i.cornerStrokeColor||"",t.translate(e,s);const d=i.getTotalAngle();t.rotate(At(d)),t["".concat(h,"Rect")](-l,-u,r,o),c&&t.strokeRect(-l,-u,r,o),t.restore()}class gn{constructor(t){h(this,"visible",!0),h(this,"actionName",J),h(this,"angle",0),h(this,"x",0),h(this,"y",0),h(this,"offsetX",0),h(this,"offsetY",0),h(this,"sizeX",0),h(this,"sizeY",0),h(this,"touchSizeX",0),h(this,"touchSizeY",0),h(this,"cursorStyle","crosshair"),h(this,"withConnection",!1),Object.assign(this,t)}shouldActivate(t,e,s,n){var i;let{tl:r,tr:o,br:a,bl:h}=n;return(null===(i=e.canvas)||void 0===i?void 0:i.getActiveObject())===e&&e.isControlVisible(t)&&sn.isPointInPolygon(s,[r,o,a,h])}getActionHandler(t,e,s){return this.actionHandler}getMouseDownHandler(t,e,s){return this.mouseDownHandler}getMouseUpHandler(t,e,s){return this.mouseUpHandler}cursorStyleHandler(t,e,s){return e.cursorStyle}getActionName(t,e,s){return e.actionName}getVisibility(t,e){var s,n;return null!==(s=null===(n=t._controlsVisibility)||void 0===n?void 0:n[e])&&void 0!==s?s:this.visible}setVisibility(t,e,s){this.visible=t}positionHandler(t,e,s,n){return new gt(this.x*t.x+this.offsetX,this.y*t.y+this.offsetY).transform(e)}calcCornerCoords(t,e,s,n,i,r){const o=Mt([Lt(s,n),jt({angle:t}),Nt((i?this.touchSizeX:this.sizeX)||e,(i?this.touchSizeY:this.sizeY)||e)]);return{tl:new gt(-.5,-.5).transform(o),tr:new gt(.5,-.5).transform(o),br:new gt(.5,.5).transform(o),bl:new gt(-.5,.5).transform(o)}}render(t,e,s,n,i){"circle"===((n=n||{}).cornerStyle||i.cornerStyle)?un.call(this,t,e,s,n,i):dn.call(this,t,e,s,n,i)}}const pn=(t,e,s)=>s.lockRotation?Ee:e.cursorStyle,fn=hn(V,cn(((t,e,s,n)=>{let{target:i,ex:r,ey:o,theta:a,originX:h,originY:c}=e;const l=i.translateToOriginPoint(i.getRelativeCenterPoint(),h,c);if(Pe(i,"lockRotation"))return!1;const u=Math.atan2(o-l.y,r-l.x),d=Math.atan2(n-l.y,s-l.x);let g=Et(d-u+a);if(i.snapAngle&&i.snapAngle>0){const t=i.snapAngle,e=i.snapThreshold||t,s=Math.ceil(g/t)*t,n=Math.floor(g/t)*t;Math.abs(g-n)<e?g=n:Math.abs(g-s)<e&&(g=s)}g<0&&(g=360+g),g%=360;const p=i.angle!==g;return i.angle=g,p})));function mn(t,e){const s=e.canvas,n=t[s.uniScaleKey];return s.uniformScaling&&!n||!s.uniformScaling&&n}function _n(t,e,s){const n=Pe(t,"lockScalingX"),i=Pe(t,"lockScalingY");if(n&&i)return!0;if(!e&&(n||i)&&s)return!0;if(n&&"x"===e)return!0;if(i&&"y"===e)return!0;const{width:r,height:o,strokeWidth:a}=t;return 0===r&&0===a&&"y"!==e||0===o&&0===a&&"x"!==e}const vn=["e","se","s","sw","w","nw","n","ne","e"],yn=(t,e,s)=>{const n=mn(t,s);if(_n(s,0!==e.x&&0===e.y?"x":0===e.x&&0!==e.y?"y":"",n))return Ee;const i=Me(s,e);return"".concat(vn[i],"-resize")};function Cn(t,e,s,n){let i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:{};const r=e.target,o=i.by,a=mn(t,r);let h,c,l,u,d,g;if(_n(r,o,a))return!1;if(e.gestureScale)c=e.scaleX*e.gestureScale,l=e.scaleY*e.gestureScale;else{if(h=Re(e,e.originX,e.originY,s,n),d="y"!==o?Math.sign(h.x||e.signX||1):1,g="x"!==o?Math.sign(h.y||e.signY||1):1,e.signX||(e.signX=d),e.signY||(e.signY=g),Pe(r,"lockScalingFlip")&&(e.signX!==d||e.signY!==g))return!1;if(u=r._getTransformedDimensions(),a&&!o){const t=Math.abs(h.x)+Math.abs(h.y),{original:s}=e,n=t/(Math.abs(u.x*s.scaleX/r.scaleX)+Math.abs(u.y*s.scaleY/r.scaleY));c=s.scaleX*n,l=s.scaleY*n}else c=Math.abs(h.x*r.scaleX/u.x),l=Math.abs(h.y*r.scaleY/u.y);Oe(e)&&(c*=2,l*=2),e.signX!==d&&"y"!==o&&(e.originX=De(e.originX),c*=-1,e.signX=d),e.signY!==g&&"x"!==o&&(e.originY=De(e.originY),l*=-1,e.signY=g)}const p=r.scaleX,f=r.scaleY;return o?("x"===o&&r.set(Z,c),"y"===o&&r.set($,l)):(!Pe(r,"lockScalingX")&&r.set(Z,c),!Pe(r,"lockScalingY")&&r.set($,l)),p!==r.scaleX||f!==r.scaleY}const bn=hn(X,cn(((t,e,s,n)=>Cn(t,e,s,n)))),wn=hn(X,cn(((t,e,s,n)=>Cn(t,e,s,n,{by:"x"})))),xn=hn(X,cn(((t,e,s,n)=>Cn(t,e,s,n,{by:"y"})))),Sn=["target","ex","ey","skewingSide"],Tn={x:{counterAxis:"y",scale:Z,skew:tt,lockSkewing:"lockSkewingX",origin:"originX",flip:"flipX"},y:{counterAxis:"x",scale:$,skew:et,lockSkewing:"lockSkewingY",origin:"originY",flip:"flipY"}},kn=["ns","nesw","ew","nwse"],An=(t,e,s)=>{if(0!==e.x&&Pe(s,"lockSkewingY"))return Ee;if(0!==e.y&&Pe(s,"lockSkewingX"))return Ee;const n=Me(s,e)%4;return"".concat(kn[n],"-resize")};function En(t,e,s,n,i){const{target:r}=s,{counterAxis:o,origin:a,lockSkewing:h,skew:c,flip:d}=Tn[t];if(Pe(r,h))return!1;const{origin:g,flip:p}=Tn[o],f=Ae(s[g])*(r[p]?-1:1),m=-Math.sign(f)*(r[d]?-1:1),_=-(0===r[c]&&Re(s,F,F,n,i)[t]>0||r[c]>0?1:-1)*m*.5+.5,v=hn(H,cn(((e,s,n,i)=>function(t,e,s){let{target:n,ex:i,ey:r,skewingSide:o}=e,a=u(e,Sn);const{skew:h}=Tn[t],c=s.subtract(new gt(i,r)).divide(new gt(n.scaleX,n.scaleY))[t],l=n[h],d=a[h],g=Math.tan(At(d)),p="y"===t?n._getTransformedDimensions({scaleX:1,scaleY:1,skewX:0}).x:n._getTransformedDimensions({scaleX:1,scaleY:1}).y,f=2*c*o/Math.max(p,1)+g,m=Et(Math.atan(f));n.set(h,m);const _=l!==n[h];if(_&&"y"===t){const{skewX:t,scaleX:e}=n,s=n._getTransformedDimensions({skewY:l}),i=n._getTransformedDimensions(),r=0!==t?s.x/i.x:1;1!==r&&n.set(Z,r*e)}return _}(t,s,new gt(n,i)))));return v(e,l(l({},s),{},{[a]:_,skewingSide:m}),n,i)}const On=(t,e,s,n)=>En("x",t,e,s,n),Dn=(t,e,s,n)=>En("y",t,e,s,n);function Pn(t,e){return t[e.canvas.altActionKey]}const In=(t,e,s)=>{const n=Pn(t,s);return 0===e.x?n?tt:$:0===e.y?n?et:Z:""},Mn=(t,e,s)=>Pn(t,s)?An(0,e,s):yn(t,e,s),Rn=(t,e,s,n)=>Pn(t,e.target)?Dn(t,e,s,n):wn(t,e,s,n),Fn=(t,e,s,n)=>Pn(t,e.target)?On(t,e,s,n):xn(t,e,s,n),Ln=()=>({ml:new gn({x:-.5,y:0,cursorStyleHandler:Mn,actionHandler:Rn,getActionName:In}),mr:new gn({x:.5,y:0,cursorStyleHandler:Mn,actionHandler:Rn,getActionName:In}),mb:new gn({x:0,y:.5,cursorStyleHandler:Mn,actionHandler:Fn,getActionName:In}),mt:new gn({x:0,y:-.5,cursorStyleHandler:Mn,actionHandler:Fn,getActionName:In}),tl:new gn({x:-.5,y:-.5,cursorStyleHandler:yn,actionHandler:bn}),tr:new gn({x:.5,y:-.5,cursorStyleHandler:yn,actionHandler:bn}),bl:new gn({x:-.5,y:.5,cursorStyleHandler:yn,actionHandler:bn}),br:new gn({x:.5,y:.5,cursorStyleHandler:yn,actionHandler:bn}),mtr:new gn({x:0,y:-.5,actionHandler:fn,cursorStyleHandler:pn,offsetY:-40,withConnection:!0,actionName:G})}),jn=()=>({mr:new gn({x:.5,y:0,actionHandler:ln,cursorStyleHandler:Mn,actionName:z}),ml:new gn({x:-.5,y:0,actionHandler:ln,cursorStyleHandler:Mn,actionName:z})}),Nn=()=>l(l({},Ln()),jn());class Bn extends an{static getDefaults(){return l(l({},super.getDefaults()),Bn.ownDefaults)}constructor(t){super(),Object.assign(this,this.constructor.createControls(),Bn.ownDefaults),this.setOptions(t)}static createControls(){return{controls:Ln()}}_updateCacheCanvas(){const t=this.canvas;if(this.noScaleCache&&t&&t._currentTransform){const e=t._currentTransform,s=e.target,n=e.action;if(this===s&&n&&n.startsWith(J))return!1}return super._updateCacheCanvas()}getActiveControl(){const t=this.__corner;return t?{key:t,control:this.controls[t],coord:this.oCoords[t]}:void 0}findControl(t){let e=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(!this.hasControls||!this.canvas)return;this.__corner=void 0;const s=Object.entries(this.oCoords);for(let n=s.length-1;n>=0;n--){const[i,r]=s[n],o=this.controls[i];if(o.shouldActivate(i,this,t,e?r.touchCorner:r.corner))return this.__corner=i,{key:i,control:o,coord:this.oCoords[i]}}}calcOCoords(){const t=this.getViewportTransform(),e=this.getCenterPoint(),s=Lt(e.x,e.y),n=jt({angle:this.getTotalAngle()-(this.group&&this.flipX?180:0)}),i=It(s,n),r=It(t,i),o=It(r,[1/t[0],0,0,1/t[3],0,0]),a=this.group?Ft(this.calcTransformMatrix()):void 0;a&&(a.scaleX=Math.abs(a.scaleX),a.scaleY=Math.abs(a.scaleY));const h=this._calculateCurrentDimensions(a),c={};return this.forEachControl(((t,e)=>{const s=t.positionHandler(h,o,this,t);c[e]=Object.assign(s,this._calcCornerCoords(t,s))})),c}_calcCornerCoords(t,e){const s=this.getTotalAngle();return{corner:t.calcCornerCoords(s,this.cornerSize,e.x,e.y,!1,this),touchCorner:t.calcCornerCoords(s,this.touchCornerSize,e.x,e.y,!0,this)}}setCoords(){super.setCoords(),this.canvas&&(this.oCoords=this.calcOCoords())}forEachControl(t){for(const e in this.controls)t(this.controls[e],e,this)}drawSelectionBackground(t){if(!this.selectionBackgroundColor||this.canvas&&this.canvas._activeObject!==this)return;t.save();const e=this.getRelativeCenterPoint(),s=this._calculateCurrentDimensions(),n=this.getViewportTransform();t.translate(e.x,e.y),t.scale(1/n[0],1/n[3]),t.rotate(At(this.angle)),t.fillStyle=this.selectionBackgroundColor,t.fillRect(-s.x/2,-s.y/2,s.x,s.y),t.restore()}strokeBorders(t,e){t.strokeRect(-e.x/2,-e.y/2,e.x,e.y)}_drawBorders(t,e){let s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};const n=l({hasControls:this.hasControls,borderColor:this.borderColor,borderDashArray:this.borderDashArray},s);t.save(),t.strokeStyle=n.borderColor,this._setLineDash(t,n.borderDashArray),this.strokeBorders(t,e),n.hasControls&&this.drawControlsConnectingLines(t,e),t.restore()}_renderControls(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const{hasBorders:s,hasControls:n}=this,i=l({hasBorders:s,hasControls:n},e),r=this.getViewportTransform(),o=i.hasBorders,a=i.hasControls,h=It(r,this.calcTransformMatrix()),c=Ft(h);t.save(),t.translate(c.translateX,c.translateY),t.lineWidth=this.borderScaleFactor,this.group===this.parent&&(t.globalAlpha=this.isMoving?this.borderOpacityWhenMoving:1),this.flipX&&(c.angle-=180),t.rotate(At(this.group?c.angle:this.angle)),o&&this.drawBorders(t,c,e),a&&this.drawControls(t,e),t.restore()}drawBorders(t,e,s){let n;if(s&&s.forActiveSelection||this.group){const t=Ce(this.width,this.height,Yt(e)),s=this.isStrokeAccountedForInDimensions()?pt:(this.strokeUniform?(new gt).scalarAdd(this.canvas?this.canvas.getZoom():1):new gt(e.scaleX,e.scaleY)).scalarMultiply(this.strokeWidth);n=t.add(s).scalarAdd(this.borderScaleFactor).scalarAdd(2*this.padding)}else n=this._calculateCurrentDimensions().scalarAdd(this.borderScaleFactor);this._drawBorders(t,n,s)}drawControlsConnectingLines(t,e){let s=!1;t.beginPath(),this.forEachControl(((n,i)=>{n.withConnection&&n.getVisibility(this,i)&&(s=!0,t.moveTo(n.x*e.x,n.y*e.y),t.lineTo(n.x*e.x+n.offsetX,n.y*e.y+n.offsetY))})),s&&t.stroke()}drawControls(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};t.save();const s=this.getCanvasRetinaScaling(),{cornerStrokeColor:n,cornerDashArray:i,cornerColor:r}=this,o=l({cornerStrokeColor:n,cornerDashArray:i,cornerColor:r},e);t.setTransform(s,0,0,s,0,0),t.strokeStyle=t.fillStyle=o.cornerColor,this.transparentCorners||(t.strokeStyle=o.cornerStrokeColor),this._setLineDash(t,o.cornerDashArray),this.forEachControl(((e,s)=>{if(e.getVisibility(this,s)){const n=this.oCoords[s];e.render(t,n.x,n.y,o,this)}})),t.restore()}isControlVisible(t){return this.controls[t]&&this.controls[t].getVisibility(this,t)}setControlVisible(t,e){this._controlsVisibility||(this._controlsVisibility={}),this._controlsVisibility[t]=e}setControlsVisibility(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};Object.entries(t).forEach((t=>{let[e,s]=t;return this.setControlVisible(e,s)}))}clearContextTop(t){if(!this.canvas)return;const e=this.canvas.contextTop;if(!e)return;const s=this.canvas.viewportTransform;e.save(),e.transform(s[0],s[1],s[2],s[3],s[4],s[5]),this.transform(e);const n=this.width+4,i=this.height+4;return e.clearRect(-n/2,-i/2,n,i),t||e.restore(),e}onDeselect(t){return!1}onSelect(t){return!1}shouldStartDragging(t){return!1}onDragStart(t){return!1}canDrop(t){return!1}renderDragSourceEffect(t){}renderDropTargetEffect(t){}}function Wn(t,e){return e.forEach((e=>{Object.getOwnPropertyNames(e.prototype).forEach((s=>{"constructor"!==s&&Object.defineProperty(t.prototype,s,Object.getOwnPropertyDescriptor(e.prototype,s)||Object.create(null))}))})),t}h(Bn,"ownDefaults",{noScaleCache:!0,lockMovementX:!1,lockMovementY:!1,lockRotation:!1,lockScalingX:!1,lockScalingY:!1,lockSkewingX:!1,lockSkewingY:!1,lockScalingFlip:!1,cornerSize:13,touchCornerSize:24,transparentCorners:!0,cornerColor:"rgb(178,204,255)",cornerStrokeColor:"",cornerStyle:"rect",cornerDashArray:null,hasControls:!0,borderColor:"rgb(178,204,255)",borderDashArray:null,borderOpacityWhenMoving:.4,borderScaleFactor:1,hasBorders:!0,selectionBackgroundColor:"",selectable:!0,evented:!0,perPixelTargetFind:!1,activeOn:"down",hoverCursor:null,moveCursor:null});class Un extends Bn{}Wn(Un,[He]),at.setClass(Un),at.setClass(Un,"object");const Yn=(t,e,s,n)=>{const i=2*(n=Math.round(n))+1,{data:r}=t.getImageData(e-n,s-n,i,i);for(let o=3;o<r.length;o+=4)if(r[o]>0)return!1;return!0};class Xn{constructor(t){this.options=t,this.strokeProjectionMagnitude=this.options.strokeWidth/2,this.scale=new gt(this.options.scaleX,this.options.scaleY),this.strokeUniformScalar=this.options.strokeUniform?new gt(1/this.options.scaleX,1/this.options.scaleY):new gt(1,1)}createSideVector(t,e){const s=ws(t,e);return this.options.strokeUniform?s.multiply(this.scale):s}projectOrthogonally(t,e,s){return this.applySkew(t.add(this.calcOrthogonalProjection(t,e,s)))}isSkewed(){return 0!==this.options.skewX||0!==this.options.skewY}applySkew(t){const e=new gt(t);return e.y+=e.x*Math.tan(At(this.options.skewY)),e.x+=e.y*Math.tan(At(this.options.skewX)),e}scaleUnitVector(t,e){return t.multiply(this.strokeUniformScalar).scalarMultiply(e)}}const Vn=new gt;class Gn extends Xn{static getOrthogonalRotationFactor(t,e){const s=e?Ss(t,e):Ts(t);return Math.abs(s)<O?-1:1}constructor(t,e,s,n){super(n),h(this,"AB",void 0),h(this,"AC",void 0),h(this,"alpha",void 0),h(this,"bisector",void 0),this.A=new gt(t),this.B=new gt(e),this.C=new gt(s),this.AB=this.createSideVector(this.A,this.B),this.AC=this.createSideVector(this.A,this.C),this.alpha=Ss(this.AB,this.AC),this.bisector=ks(bs(this.AB.eq(Vn)?this.AC:this.AB,this.alpha/2))}calcOrthogonalProjection(t,e){let s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:this.strokeProjectionMagnitude;const n=this.createSideVector(t,e),i=As(n),r=Gn.getOrthogonalRotationFactor(i,this.bisector);return this.scaleUnitVector(i,s*r)}projectBevel(){const t=[];return(this.alpha%D==0?[this.B]:[this.B,this.C]).forEach((e=>{t.push(this.projectOrthogonally(this.A,e)),t.push(this.projectOrthogonally(this.A,e,-this.strokeProjectionMagnitude))})),t}projectMiter(){const t=[],e=Math.abs(this.alpha),s=1/Math.sin(e/2),n=this.scaleUnitVector(this.bisector,-this.strokeProjectionMagnitude*s),i=this.options.strokeUniform?xs(this.scaleUnitVector(this.bisector,this.options.strokeMiterLimit)):this.options.strokeMiterLimit;return xs(n)/this.strokeProjectionMagnitude<=i&&t.push(this.applySkew(this.A.add(n))),t.push(...this.projectBevel()),t}projectRoundNoSkew(t,e){const s=[],n=new gt(Gn.getOrthogonalRotationFactor(this.bisector),Gn.getOrthogonalRotationFactor(new gt(this.bisector.y,this.bisector.x)));return[new gt(1,0).scalarMultiply(this.strokeProjectionMagnitude).multiply(this.strokeUniformScalar).multiply(n),new gt(0,1).scalarMultiply(this.strokeProjectionMagnitude).multiply(this.strokeUniformScalar).multiply(n)].forEach((n=>{Ds(n,t,e)&&s.push(this.A.add(n))})),s}projectRoundWithSkew(t,e){const s=[],{skewX:n,skewY:i,scaleX:r,scaleY:o,strokeUniform:a}=this.options,h=new gt(Math.tan(At(n)),Math.tan(At(i))),c=this.strokeProjectionMagnitude,l=a?c/o/Math.sqrt(1/o**2+1/r**2*h.y**2):c/Math.sqrt(1+h.y**2),u=new gt(Math.sqrt(Math.max(c**2-l**2,0)),l),d=a?c/Math.sqrt(1+h.x**2*(1/o)**2/(1/r+1/r*h.x*h.y)**2):c/Math.sqrt(1+h.x**2/(1+h.x*h.y)**2),g=new gt(d,Math.sqrt(Math.max(c**2-d**2,0)));return[g,g.scalarMultiply(-1),u,u.scalarMultiply(-1)].map((t=>this.applySkew(a?t.multiply(this.strokeUniformScalar):t))).forEach((n=>{Ds(n,t,e)&&s.push(this.applySkew(this.A).add(n))})),s}projectRound(){const t=[];t.push(...this.projectBevel());const e=this.alpha%D==0,s=this.applySkew(this.A),n=t[e?0:2].subtract(s),i=t[e?1:0].subtract(s),r=e?this.applySkew(this.AB.scalarMultiply(-1)):this.applySkew(this.bisector.multiply(this.strokeUniformScalar).scalarMultiply(-1)),o=Es(n,r)>0,a=o?n:i,h=o?i:n;return this.isSkewed()?t.push(...this.projectRoundWithSkew(a,h)):t.push(...this.projectRoundNoSkew(a,h)),t}projectPoints(){switch(this.options.strokeLineJoin){case"miter":return this.projectMiter();case"round":return this.projectRound();default:return this.projectBevel()}}project(){return this.projectPoints().map((t=>({originPoint:this.A,projectedPoint:t,angle:this.alpha,bisector:this.bisector})))}}class Hn extends Xn{constructor(t,e,s){super(s),this.A=new gt(t),this.T=new gt(e)}calcOrthogonalProjection(t,e){let s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:this.strokeProjectionMagnitude;const n=this.createSideVector(t,e);return this.scaleUnitVector(As(n),s)}projectButt(){return[this.projectOrthogonally(this.A,this.T,this.strokeProjectionMagnitude),this.projectOrthogonally(this.A,this.T,-this.strokeProjectionMagnitude)]}projectRound(){const t=[];if(!this.isSkewed()&&this.A.eq(this.T)){const e=new gt(1,1).scalarMultiply(this.strokeProjectionMagnitude).multiply(this.strokeUniformScalar);t.push(this.applySkew(this.A.add(e)),this.applySkew(this.A.subtract(e)))}else t.push(...new Gn(this.A,this.T,this.T,this.options).projectRound());return t}projectSquare(){const t=[];if(this.A.eq(this.T)){const e=new gt(1,1).scalarMultiply(this.strokeProjectionMagnitude).multiply(this.strokeUniformScalar);t.push(this.A.add(e),this.A.subtract(e))}else{const e=this.calcOrthogonalProjection(this.A,this.T,this.strokeProjectionMagnitude),s=this.scaleUnitVector(ks(this.createSideVector(this.A,this.T)),-this.strokeProjectionMagnitude),n=this.A.add(s);t.push(n.add(e),n.subtract(e))}return t.map((t=>this.applySkew(t)))}projectPoints(){switch(this.options.strokeLineCap){case"round":return this.projectRound();case"square":return this.projectSquare();default:return this.projectButt()}}project(){return this.projectPoints().map((t=>({originPoint:this.A,projectedPoint:t})))}}const zn=function(t,e){let s=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const n=[];if(0===t.length)return n;const i=t.reduce(((t,e)=>(t[t.length-1].eq(e)||t.push(new gt(e)),t)),[new gt(t[0])]);if(1===i.length)s=!0;else if(!s){const t=i[0],e=((t,e)=>{for(let s=t.length-1;s>=0;s--)if(e(t[s],s,t))return s;return-1})(i,(e=>!e.eq(t)));i.splice(e+1)}return i.forEach(((t,i,r)=>{let o,a;0===i?(a=r[1],o=s?t:r[r.length-1]):i===r.length-1?(o=r[i-1],a=s?t:r[0]):(o=r[i-1],a=r[i+1]),s&&1===r.length?n.push(...new Hn(t,t,e).project()):!s||0!==i&&i!==r.length-1?n.push(...new Gn(t,o,a,e).project()):n.push(...new Hn(t,0===i?a:o,e).project())})),n},qn=t=>{const e={};return Object.keys(t).forEach((s=>{e[s]={},Object.keys(t[s]).forEach((n=>{e[s][n]=l({},t[s][n])}))})),e},Kn=t=>t.replace(/&/g,"&amp;").replace(/"/g,"&quot;").replace(/'/g,"&apos;").replace(/</g,"&lt;").replace(/>/g,"&gt;");let Qn;const Jn=t=>{if(Qn||Qn||(Qn="Intl"in S()&&"Segmenter"in Intl&&new Intl.Segmenter(void 0,{granularity:"grapheme"})),Qn){const e=Qn.segment(t);return Array.from(e).map((t=>{let{segment:e}=t;return e}))}return Zn(t)},Zn=t=>{const e=[];for(let s,n=0;n<t.length;n++)!1!==(s=$n(t,n))&&e.push(s);return e},$n=(t,e)=>{const s=t.charCodeAt(e);if(isNaN(s))return"";if(s<55296||s>57343)return t.charAt(e);if(55296<=s&&s<=56319){if(t.length<=e+1)throw"High surrogate without following low surrogate";const s=t.charCodeAt(e+1);if(56320>s||s>57343)throw"High surrogate without following low surrogate";return t.charAt(e)+t.charAt(e+1)}if(0===e)throw"Low surrogate without preceding high surrogate";const n=t.charCodeAt(e-1);if(55296>n||n>56319)throw"Low surrogate without preceding high surrogate";return!1};var ti=Object.freeze({__proto__:null,capitalize:function(t){let e=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return"".concat(t.charAt(0).toUpperCase()).concat(e?t.slice(1):t.slice(1).toLowerCase())},escapeXml:Kn,graphemeSplit:Jn});const ei=function(t,e){let s=arguments.length>2&&void 0!==arguments[2]&&arguments[2];return t.fill!==e.fill||t.stroke!==e.stroke||t.strokeWidth!==e.strokeWidth||t.fontSize!==e.fontSize||t.fontFamily!==e.fontFamily||t.fontWeight!==e.fontWeight||t.fontStyle!==e.fontStyle||t.textDecorationThickness!==e.textDecorationThickness||t.textBackgroundColor!==e.textBackgroundColor||t.deltaY!==e.deltaY||s&&(t.overline!==e.overline||t.underline!==e.underline||t.linethrough!==e.linethrough)},si=(t,e)=>{const s=e.split("\n"),n=[];let i=-1,r={};t=qn(t);for(let o=0;o<s.length;o++){const e=Jn(s[o]);if(t[o])for(let s=0;s<e.length;s++){i++;const e=t[o][s];e&&Object.keys(e).length>0&&(ei(r,e,!0)?n.push({start:i,end:i+1,style:e}):n[n.length-1].end++),r=e||{}}else i+=e.length,r={}}return n},ni=(t,e)=>{if(!Array.isArray(t))return qn(t);const s=e.split(U),n={};let i=-1,r=0;for(let o=0;o<s.length;o++){const e=Jn(s[o]);for(let s=0;s<e.length;s++)i++,t[r]&&t[r].start<=i&&i<t[r].end&&(n[o]=n[o]||{},n[o][s]=l({},t[r].style),i===t[r].end-1&&r++)}return n},ii=["display","transform",st,"fill-opacity","fill-rule","opacity",nt,"stroke-dasharray","stroke-linecap","stroke-dashoffset","stroke-linejoin","stroke-miterlimit","stroke-opacity","stroke-width","id","paint-order","vector-effect","instantiated_by_use","clip-path"];function ri(t,e){const s=t.nodeName,n=t.getAttribute("class"),i=t.getAttribute("id"),r="(?![a-zA-Z\\-]+)";let o;if(o=new RegExp("^"+s,"i"),e=e.replace(o,""),i&&e.length&&(o=new RegExp("#"+i+r,"i"),e=e.replace(o,"")),n&&e.length){const t=n.split(" ");for(let s=t.length;s--;)o=new RegExp("\\."+t[s]+r,"i"),e=e.replace(o,"")}return 0===e.length}function oi(t,e){let s=!0;const n=ri(t,e.pop());return n&&e.length&&(s=function(t,e){let s,n=!0;for(;t.parentElement&&1===t.parentElement.nodeType&&e.length;)n&&(s=e.pop()),n=ri(t=t.parentElement,s);return 0===e.length}(t,e)),n&&s&&0===e.length}const ai=t=>{var e;return null!==(e=ds[t])&&void 0!==e?e:t},hi=new RegExp("(".concat(hs,")"),"gi"),ci=t=>t.replace(hi," $1 ").replace(/,/gi," ").replace(/\s+/gi," ");var li,ui,di,gi,pi,fi,mi;const _i="(".concat(hs,")"),vi=String.raw(li||(li=d(["(skewX)(",")"],["(skewX)\\(","\\)"])),_i),yi=String.raw(ui||(ui=d(["(skewY)(",")"],["(skewY)\\(","\\)"])),_i),Ci=String.raw(di||(di=d(["(rotate)(","(?: "," ",")?)"],["(rotate)\\(","(?: "," ",")?\\)"])),_i,_i,_i),bi=String.raw(gi||(gi=d(["(scale)(","(?: ",")?)"],["(scale)\\(","(?: ",")?\\)"])),_i,_i),wi=String.raw(pi||(pi=d(["(translate)(","(?: ",")?)"],["(translate)\\(","(?: ",")?\\)"])),_i,_i),xi=String.raw(fi||(fi=d(["(matrix)("," "," "," "," "," ",")"],["(matrix)\\("," "," "," "," "," ","\\)"])),_i,_i,_i,_i,_i,_i),Si="(?:".concat(xi,"|").concat(wi,"|").concat(Ci,"|").concat(bi,"|").concat(vi,"|").concat(yi,")"),Ti="(?:".concat(Si,"*)"),ki=String.raw(mi||(mi=d(["^s*(?:","?)s*$"],["^\\s*(?:","?)\\s*$"])),Ti),Ai=new RegExp(ki),Ei=new RegExp(Si),Oi=new RegExp(Si,"g");function Di(t){const e=[];if(!(t=ci(t).replace(/\s*([()])\s*/gi,"$1"))||t&&!Ai.test(t))return[...I];for(const s of t.matchAll(Oi)){const t=Ei.exec(s[0]);if(!t)continue;let n=I;const i=t.filter((t=>!!t)),[,r,...o]=i,[a,h,c,l,u,d]=o.map((t=>parseFloat(t)));switch(r){case"translate":n=Lt(a,h);break;case G:n=jt({angle:a},{x:h,y:c});break;case J:n=Nt(a,h);break;case tt:n=Wt(a);break;case et:n=Ut(a);break;case"matrix":n=[a,h,c,l,u,d]}e.push(n)}return Mt(e)}function Pi(t,e,s,n){const i=Array.isArray(e);let r,o=e;if(t!==st&&t!==nt||e!==W){if("strokeUniform"===t)return"non-scaling-stroke"===e;if("strokeDashArray"===t)o=e===W?null:e.replace(/,/g," ").split(/\s+/).map(parseFloat);else if("transformMatrix"===t)o=s&&s.transformMatrix?It(s.transformMatrix,Di(e)):Di(e);else if("visible"===t)o=e!==W&&"hidden"!==e,s&&!1===s.visible&&(o=!1);else if("opacity"===t)o=parseFloat(e),s&&void 0!==s.opacity&&(o*=s.opacity);else if("textAnchor"===t)o="start"===e?L:"end"===e?B:F;else if("charSpacing"===t||t===qe)r=Xe(e,n)/n*1e3;else if("paintFirst"===t){const t=e.indexOf(st),s=e.indexOf(nt);o=st,(t>-1&&s>-1&&s<t||-1===t&&s>-1)&&(o=nt)}else{if("href"===t||"xlink:href"===t||"font"===t||"id"===t)return e;if("imageSmoothing"===t)return"optimizeQuality"===e;r=i?e.map(Xe):Xe(e,n)}}else o="";return!i&&isNaN(r)?o:r}function Ii(t,e){const s=t.match(us);if(!s)return;const n=s[1],i=s[3],r=s[4],o=s[5],a=s[6];n&&(e.fontStyle=n),i&&(e.fontWeight=isNaN(parseFloat(i))?i:parseFloat(i)),r&&(e.fontSize=Xe(r)),a&&(e.fontFamily=a),o&&(e.lineHeight="normal"===o?1:o)}function Mi(t,e){t.replace(/;\s*$/,"").split(";").forEach((t=>{if(!t)return;const[s,n]=t.split(":");e[s.trim().toLowerCase()]=n.trim()}))}function Ri(t){const e={},s=t.getAttribute("style");return s?("string"==typeof s?Mi(s,e):function(t,e){Object.entries(t).forEach((t=>{let[s,n]=t;void 0!==n&&(e[s.toLowerCase()]=n)}))}(s,e),e):e}const Fi={stroke:"strokeOpacity",fill:"fillOpacity"};function Li(t,e,s){if(!t)return{};let n,i={},r=M;t.parentNode&&_s.test(t.parentNode.nodeName)&&(i=Li(t.parentElement,e,s),i.fontSize&&(n=r=Xe(i.fontSize)));const o=l(l(l({},e.reduce(((e,s)=>{const n=t.getAttribute(s);return n&&(e[s]=n),e}),{})),function(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},s={};for(const n in e)oi(t,n.split(" "))&&(s=l(l({},s),e[n]));return s}(t,s)),Ri(t));o[ps]&&t.setAttribute(ps,o[ps]),o[gs]&&(n=Xe(o[gs],r),o[gs]="".concat(n));const a={};for(const c in o){const t=ai(c),e=Pi(t,o[c],i,n);a[t]=e}a&&a.font&&Ii(a.font,a);const h=l(l({},i),a);return _s.test(t.nodeName)?h:function(t){const e=Un.getDefaults();return Object.entries(Fi).forEach((s=>{let[n,i]=s;if(void 0===t[i]||""===t[n])return;if(void 0===t[n]){if(!e[n])return;t[n]=e[n]}if(0===t[n].indexOf("url("))return;const r=new Ye(t[n]);t[n]=r.setAlpha(Kt(r.getAlpha()*t[i],2)).toRgba()})),t}(h)}const ji=["left","top","width","height","visible"],Ni=["rx","ry"];class Bi extends Un{static getDefaults(){return l(l({},super.getDefaults()),Bi.ownDefaults)}constructor(t){super(),Object.assign(this,Bi.ownDefaults),this.setOptions(t),this._initRxRy()}_initRxRy(){const{rx:t,ry:e}=this;t&&!e?this.ry=t:e&&!t&&(this.rx=e)}_render(t){const{width:e,height:s}=this,n=-e/2,i=-s/2,r=this.rx?Math.min(this.rx,e/2):0,o=this.ry?Math.min(this.ry,s/2):0,a=0!==r||0!==o;t.beginPath(),t.moveTo(n+r,i),t.lineTo(n+e-r,i),a&&t.bezierCurveTo(n+e-R*r,i,n+e,i+R*o,n+e,i+o),t.lineTo(n+e,i+s-o),a&&t.bezierCurveTo(n+e,i+s-R*o,n+e-R*r,i+s,n+e-r,i+s),t.lineTo(n+r,i+s),a&&t.bezierCurveTo(n+R*r,i+s,n,i+s-R*o,n,i+s-o),t.lineTo(n,i+o),a&&t.bezierCurveTo(n,i+R*o,n+R*r,i,n+r,i),t.closePath(),this._renderPaintInOrder(t)}toObject(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];return super.toObject([...Ni,...t])}_toSVG(){const{width:t,height:e,rx:s,ry:n}=this;return["<rect ","COMMON_PARTS",'x="'.concat(-t/2,'" y="').concat(-e/2,'" rx="').concat(s,'" ry="').concat(n,'" width="').concat(t,'" height="').concat(e,'" />\n')]}static async fromElement(t,e,s){const n=Li(t,this.ATTRIBUTE_NAMES,s),{left:i=0,top:r=0,width:o=0,height:a=0,visible:h=!0}=n,c=u(n,ji);return new this(l(l(l({},e),c),{},{left:i,top:r,width:o,height:a,visible:Boolean(h&&o&&a)}))}}h(Bi,"type","Rect"),h(Bi,"cacheProperties",[...Ls,...Ni]),h(Bi,"ownDefaults",{rx:0,ry:0}),h(Bi,"ATTRIBUTE_NAMES",[...ii,"x","y","rx","ry","width","height"]),at.setClass(Bi),at.setSVGClass(Bi);const Wi="initialization",Ui="added",Yi="removed",Xi="imperative",Vi=(t,e)=>{const{strokeUniform:s,strokeWidth:n,width:i,height:r,group:o}=e,a=o&&o!==t?be(o.calcTransformMatrix(),t.calcTransformMatrix()):null,h=a?e.getRelativeCenterPoint().transform(a):e.getRelativeCenterPoint(),c=!e.isStrokeAccountedForInDimensions(),l=s&&c?xe(new gt(n,n),void 0,t.calcTransformMatrix()):pt,u=!s&&c?n:0,d=Ce(i+u,r+u,Mt([a,e.calcOwnMatrix()],!0)).add(l).scalarDivide(2);return[h.subtract(d),h.add(d)]};class Gi{calcLayoutResult(t,e){if(this.shouldPerformLayout(t))return this.calcBoundingBox(e,t)}shouldPerformLayout(t){let{type:e,prevStrategy:s,strategy:n}=t;return e===Wi||e===Xi||!!s&&n!==s}shouldLayoutClipPath(t){let{type:e,target:{clipPath:s}}=t;return e!==Wi&&s&&!s.absolutePositioned}getInitialSize(t,e){return e.size}calcBoundingBox(t,e){const{type:s,target:n}=e;if(s===Xi&&e.overrides)return e.overrides;if(0===t.length)return;const{left:i,top:r,width:o,height:a}=pe(t.map((t=>Vi(n,t))).reduce(((t,e)=>t.concat(e)),[])),h=new gt(o,a),c=new gt(i,r).add(h.scalarDivide(2));if(s===Wi){const t=this.getInitialSize(e,{size:h,center:c});return{center:c,relativeCorrection:new gt(0,0),size:t}}return{center:c.transform(n.calcOwnMatrix()),size:h}}}h(Gi,"type","strategy");class Hi extends Gi{shouldPerformLayout(t){return!0}}h(Hi,"type","fit-content"),at.setClass(Hi);const zi=["strategy"],qi=["target","strategy","bubbles","prevStrategy"],Ki="layoutManager";class Qi{constructor(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new Hi;h(this,"strategy",void 0),this.strategy=t,this._subscriptions=new Map}performLayout(t){const e=l(l({bubbles:!0,strategy:this.strategy},t),{},{prevStrategy:this._prevLayoutStrategy,stopPropagation(){this.bubbles=!1}});this.onBeforeLayout(e);const s=this.getLayoutResult(e);s&&this.commitLayout(e,s),this.onAfterLayout(e,s),this._prevLayoutStrategy=e.strategy}attachHandlers(t,e){const{target:s}=e;return[it,Y,z,V,X,H,Q,q,K].map((e=>t.on(e,(t=>this.performLayout(e===it?{type:"object_modified",trigger:e,e:t,target:s}:{type:"object_modifying",trigger:e,e:t,target:s})))))}subscribe(t,e){this.unsubscribe(t,e);const s=this.attachHandlers(t,e);this._subscriptions.set(t,s)}unsubscribe(t,e){(this._subscriptions.get(t)||[]).forEach((t=>t())),this._subscriptions.delete(t)}unsubscribeTargets(t){t.targets.forEach((e=>this.unsubscribe(e,t)))}subscribeTargets(t){t.targets.forEach((e=>this.subscribe(e,t)))}onBeforeLayout(t){const{target:e,type:s}=t,{canvas:n}=e;if(s===Wi||s===Ui?this.subscribeTargets(t):s===Yi&&this.unsubscribeTargets(t),e.fire("layout:before",{context:t}),n&&n.fire("object:layout:before",{target:e,context:t}),s===Xi&&t.deep){const s=u(t,zi);e.forEachObject((t=>t.layoutManager&&t.layoutManager.performLayout(l(l({},s),{},{bubbles:!1,target:t}))))}}getLayoutResult(t){const{target:e,strategy:s,type:n}=t,i=s.calcLayoutResult(t,e.getObjects());if(!i)return;const r=n===Wi?new gt:e.getRelativeCenterPoint(),{center:o,correction:a=new gt,relativeCorrection:h=new gt}=i,c=r.subtract(o).add(a).transform(n===Wi?I:Pt(e.calcOwnMatrix()),!0).add(h);return{result:i,prevCenter:r,nextCenter:o,offset:c}}commitLayout(t,e){const{target:s}=t,{result:{size:n},nextCenter:i}=e;var r,o;s.set({width:n.x,height:n.y}),this.layoutObjects(t,e),t.type===Wi?s.set({left:null!==(r=t.x)&&void 0!==r?r:i.x+n.x*Ae(s.originX),top:null!==(o=t.y)&&void 0!==o?o:i.y+n.y*Ae(s.originY)}):(s.setPositionByOrigin(i,F,F),s.setCoords(),s.set("dirty",!0))}layoutObjects(t,e){const{target:s}=t;s.forEachObject((n=>{n.group===s&&this.layoutObject(t,e,n)})),t.strategy.shouldLayoutClipPath(t)&&this.layoutObject(t,e,s.clipPath)}layoutObject(t,e,s){let{offset:n}=e;s.set({left:s.left+n.x,top:s.top+n.y})}onAfterLayout(t,e){const{target:s,strategy:n,bubbles:i,prevStrategy:r}=t,o=u(t,qi),{canvas:a}=s;s.fire("layout:after",{context:t,result:e}),a&&a.fire("object:layout:after",{context:t,result:e,target:s});const h=s.parent;i&&null!=h&&h.layoutManager&&((o.path||(o.path=[])).push(s),h.layoutManager.performLayout(l(l({},o),{},{target:h}))),s.set("dirty",!0)}dispose(){const{_subscriptions:t}=this;t.forEach((t=>t.forEach((t=>t())))),t.clear()}toObject(){return{type:Ki,strategy:this.strategy.constructor.type}}toJSON(){return this.toObject()}}at.setClass(Qi,Ki);const Ji=["type","objects","layoutManager"];class Zi extends Qi{performLayout(){}}class $i extends(mt(Un)){static getDefaults(){return l(l({},super.getDefaults()),$i.ownDefaults)}constructor(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};super(),h(this,"_activeObjects",[]),h(this,"__objectSelectionTracker",void 0),h(this,"__objectSelectionDisposer",void 0),Object.assign(this,$i.ownDefaults),this.setOptions(e),this.groupInit(t,e)}groupInit(t,e){var s;this._objects=[...t],this.__objectSelectionTracker=this.__objectSelectionMonitor.bind(this,!0),this.__objectSelectionDisposer=this.__objectSelectionMonitor.bind(this,!1),this.forEachObject((t=>{this.enterGroup(t,!1)})),this.layoutManager=null!==(s=e.layoutManager)&&void 0!==s?s:new Qi,this.layoutManager.performLayout({type:Wi,target:this,targets:[...t],x:e.left,y:e.top})}canEnterGroup(t){return t===this||this.isDescendantOf(t)?(f("error","Group: circular object trees are not supported, this call has no effect"),!1):-1===this._objects.indexOf(t)||(f("error","Group: duplicate objects are not supported inside group, this call has no effect"),!1)}_filterObjectsBeforeEnteringGroup(t){return t.filter(((t,e,s)=>this.canEnterGroup(t)&&s.indexOf(t)===e))}add(){for(var t=arguments.length,e=new Array(t),s=0;s<t;s++)e[s]=arguments[s];const n=this._filterObjectsBeforeEnteringGroup(e),i=super.add(...n);return this._onAfterObjectsChange(Ui,n),i}insertAt(t){for(var e=arguments.length,s=new Array(e>1?e-1:0),n=1;n<e;n++)s[n-1]=arguments[n];const i=this._filterObjectsBeforeEnteringGroup(s),r=super.insertAt(t,...i);return this._onAfterObjectsChange(Ui,i),r}remove(){const t=super.remove(...arguments);return this._onAfterObjectsChange(Yi,t),t}_onObjectAdded(t){this.enterGroup(t,!0),this.fire("object:added",{target:t}),t.fire("added",{target:this})}_onObjectRemoved(t,e){this.exitGroup(t,e),this.fire("object:removed",{target:t}),t.fire("removed",{target:this})}_onAfterObjectsChange(t,e){this.layoutManager.performLayout({type:t,targets:e,target:this})}_onStackOrderChanged(){this._set("dirty",!0)}_set(t,e){const s=this[t];return super._set(t,e),"canvas"===t&&s!==e&&(this._objects||[]).forEach((s=>{s._set(t,e)})),this}_shouldSetNestedCoords(){return this.subTargetCheck}removeAll(){return this._activeObjects=[],this.remove(...this._objects)}__objectSelectionMonitor(t,e){let{target:s}=e;const n=this._activeObjects;if(t)n.push(s),this._set("dirty",!0);else if(n.length>0){const t=n.indexOf(s);t>-1&&(n.splice(t,1),this._set("dirty",!0))}}_watchObject(t,e){t&&this._watchObject(!1,e),t?(e.on("selected",this.__objectSelectionTracker),e.on("deselected",this.__objectSelectionDisposer)):(e.off("selected",this.__objectSelectionTracker),e.off("deselected",this.__objectSelectionDisposer))}enterGroup(t,e){t.group&&t.group.remove(t),t._set("parent",this),this._enterGroup(t,e)}_enterGroup(t,e){e&&_e(t,It(Pt(this.calcTransformMatrix()),t.calcTransformMatrix())),this._shouldSetNestedCoords()&&t.setCoords(),t._set("group",this),t._set("canvas",this.canvas),this._watchObject(!0,t);const s=this.canvas&&this.canvas.getActiveObject&&this.canvas.getActiveObject();s&&(s===t||t.isDescendantOf(s))&&this._activeObjects.push(t)}exitGroup(t,e){this._exitGroup(t,e),t._set("parent",void 0),t._set("canvas",void 0)}_exitGroup(t,e){t._set("group",void 0),e||(_e(t,It(this.calcTransformMatrix(),t.calcTransformMatrix())),t.setCoords()),this._watchObject(!1,t);const s=this._activeObjects.length>0?this._activeObjects.indexOf(t):-1;s>-1&&this._activeObjects.splice(s,1)}shouldCache(){const t=Un.prototype.shouldCache.call(this);if(t)for(let e=0;e<this._objects.length;e++)if(this._objects[e].willDrawShadow())return this.ownCaching=!1,!1;return t}willDrawShadow(){if(super.willDrawShadow())return!0;for(let t=0;t<this._objects.length;t++)if(this._objects[t].willDrawShadow())return!0;return!1}isOnACache(){return this.ownCaching||!!this.parent&&this.parent.isOnACache()}drawObject(t,e,s){this._renderBackground(t);for(let i=0;i<this._objects.length;i++){var n;const e=this._objects[i];null!==(n=this.canvas)&&void 0!==n&&n.preserveObjectStacking&&e.group!==this?(t.save(),t.transform(...Pt(this.calcTransformMatrix())),e.render(t),t.restore()):e.group===this&&e.render(t)}this._drawClipPath(t,this.clipPath,s)}setCoords(){super.setCoords(),this._shouldSetNestedCoords()&&this.forEachObject((t=>t.setCoords()))}triggerLayout(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};this.layoutManager.performLayout(l({target:this,type:Xi},t))}render(t){this._transformDone=!0,super.render(t),this._transformDone=!1}__serializeObjects(t,e){const s=this.includeDefaultValues;return this._objects.filter((function(t){return!t.excludeFromExport})).map((function(n){const i=n.includeDefaultValues;n.includeDefaultValues=s;const r=n[t||"toObject"](e);return n.includeDefaultValues=i,r}))}toObject(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];const e=this.layoutManager.toObject();return l(l(l({},super.toObject(["subTargetCheck","interactive",...t])),"fit-content"!==e.strategy||this.includeDefaultValues?{layoutManager:e}:{}),{},{objects:this.__serializeObjects("toObject",t)})}toString(){return"#<Group: (".concat(this.complexity(),")>")}dispose(){this.layoutManager.unsubscribeTargets({targets:this.getObjects(),target:this}),this._activeObjects=[],this.forEachObject((t=>{this._watchObject(!1,t),t.dispose()})),super.dispose()}_createSVGBgRect(t){if(!this.backgroundColor)return"";const e=Bi.prototype._toSVG.call(this),s=e.indexOf("COMMON_PARTS");e[s]='for="group" ';const n=e.join("");return t?t(n):n}_toSVG(t){const e=["<g ","COMMON_PARTS"," >\n"],s=this._createSVGBgRect(t);s&&e.push("\t\t",s);for(let n=0;n<this._objects.length;n++)e.push("\t\t",this._objects[n].toSVG(t));return e.push("</g>\n"),e}getSvgStyles(){const t=void 0!==this.opacity&&1!==this.opacity?"opacity: ".concat(this.opacity,";"):"",e=this.visible?"":" visibility: hidden;";return[t,this.getSvgFilter(),e].join("")}toClipPathSVG(t){const e=[],s=this._createSVGBgRect(t);s&&e.push("\t",s);for(let n=0;n<this._objects.length;n++)e.push("\t",this._objects[n].toClipPathSVG(t));return this._createBaseClipPathSVGMarkup(e,{reviver:t})}static fromObject(t,e){let{type:s,objects:n=[],layoutManager:i}=t,r=u(t,Ji);return Promise.all([Gt(n,e),Ht(r,e)]).then((t=>{let[e,s]=t;const n=new this(e,l(l(l({},r),s),{},{layoutManager:new Zi}));if(i){const t=at.getClass(i.type),e=at.getClass(i.strategy);n.layoutManager=new t(new e)}else n.layoutManager=new Qi;return n.layoutManager.subscribeTargets({type:Wi,target:n,targets:n.getObjects()}),n.setCoords(),n}))}}h($i,"type","Group"),h($i,"ownDefaults",{strokeWidth:0,subTargetCheck:!1,interactive:!1}),at.setClass($i);const tr=(t,e)=>Math.min(e.width/t.width,e.height/t.height),er=(t,e)=>Math.max(e.width/t.width,e.height/t.height),sr="\\s*,?\\s*",nr="".concat(sr,"(").concat(hs,")"),ir="".concat(nr).concat(nr).concat(nr).concat(sr,"([01])").concat(sr,"([01])").concat(nr).concat(nr),rr={m:"l",M:"L"},or=(t,e,s,n,i,r,o,a,h,c,l)=>{const u=ut(t),d=dt(t),g=ut(e),p=dt(e),f=s*i*g-n*r*p+o,m=n*i*g+s*r*p+a;return["C",c+h*(-s*i*d-n*r*u),l+h*(-n*i*d+s*r*u),f+h*(s*i*p+n*r*g),m+h*(n*i*p-s*r*g),f,m]},ar=(t,e,s,n)=>{const i=Math.atan2(e,t),r=Math.atan2(n,s);return r>=i?r-i:2*Math.PI-(i-r)};function hr(t,e,s,n,i,r,o,a){let h;if(p.cachesBoundsOfCurve&&(h=[...arguments].join(),k.boundsOfCurveCache[h]))return k.boundsOfCurveCache[h];const c=Math.sqrt,l=Math.abs,u=[],d=[[0,0],[0,0]];let g=6*t-12*s+6*i,f=-3*t+9*s-9*i+3*o,m=3*s-3*t;for(let p=0;p<2;++p){if(p>0&&(g=6*e-12*n+6*r,f=-3*e+9*n-9*r+3*a,m=3*n-3*e),l(f)<1e-12){if(l(g)<1e-12)continue;const t=-m/g;0<t&&t<1&&u.push(t);continue}const t=g*g-4*m*f;if(t<0)continue;const s=c(t),i=(-g+s)/(2*f);0<i&&i<1&&u.push(i);const o=(-g-s)/(2*f);0<o&&o<1&&u.push(o)}let _=u.length;const v=_,y=dr(t,e,s,n,i,r,o,a);for(;_--;){const{x:t,y:e}=y(u[_]);d[0][_]=t,d[1][_]=e}d[0][v]=t,d[1][v]=e,d[0][v+1]=o,d[1][v+1]=a;const C=[new gt(Math.min(...d[0]),Math.min(...d[1])),new gt(Math.max(...d[0]),Math.max(...d[1]))];return p.cachesBoundsOfCurve&&(k.boundsOfCurveCache[h]=C),C}const cr=(t,e,s)=>{let[n,i,r,o,a,h,c,l]=s;const u=((t,e,s,n,i,r,o)=>{if(0===s||0===n)return[];let a=0,h=0,c=0;const l=Math.PI,u=o*P,d=dt(u),g=ut(u),p=.5*(-g*t-d*e),f=.5*(-g*e+d*t),m=s**2,_=n**2,v=f**2,y=p**2,C=m*_-m*v-_*y;let b=Math.abs(s),w=Math.abs(n);if(C<0){const t=Math.sqrt(1-C/(m*_));b*=t,w*=t}else c=(i===r?-1:1)*Math.sqrt(C/(m*v+_*y));const x=c*b*f/w,S=-c*w*p/b,T=g*x-d*S+.5*t,k=d*x+g*S+.5*e;let A=ar(1,0,(p-x)/b,(f-S)/w),E=ar((p-x)/b,(f-S)/w,(-p-x)/b,(-f-S)/w);0===r&&E>0?E-=2*l:1===r&&E<0&&(E+=2*l);const O=Math.ceil(Math.abs(E/l*2)),D=[],I=E/O,M=8/3*Math.sin(I/4)*Math.sin(I/4)/Math.sin(I/2);let R=A+I;for(let P=0;P<O;P++)D[P]=or(A,R,g,d,b,w,T,k,M,a,h),a=D[P][5],h=D[P][6],A=R,R+=I;return D})(c-t,l-e,i,r,a,h,o);for(let d=0,g=u.length;d<g;d++)u[d][1]+=t,u[d][2]+=e,u[d][3]+=t,u[d][4]+=e,u[d][5]+=t,u[d][6]+=e;return u},lr=t=>{let e=0,s=0,n=0,i=0;const r=[];let o,a=0,h=0;for(const c of t){const t=[...c];let l;switch(t[0]){case"l":t[1]+=e,t[2]+=s;case"L":e=t[1],s=t[2],l=["L",e,s];break;case"h":t[1]+=e;case"H":e=t[1],l=["L",e,s];break;case"v":t[1]+=s;case"V":s=t[1],l=["L",e,s];break;case"m":t[1]+=e,t[2]+=s;case"M":e=t[1],s=t[2],n=t[1],i=t[2],l=["M",e,s];break;case"c":t[1]+=e,t[2]+=s,t[3]+=e,t[4]+=s,t[5]+=e,t[6]+=s;case"C":a=t[3],h=t[4],e=t[5],s=t[6],l=["C",t[1],t[2],a,h,e,s];break;case"s":t[1]+=e,t[2]+=s,t[3]+=e,t[4]+=s;case"S":"C"===o?(a=2*e-a,h=2*s-h):(a=e,h=s),e=t[3],s=t[4],l=["C",a,h,t[1],t[2],e,s],a=l[3],h=l[4];break;case"q":t[1]+=e,t[2]+=s,t[3]+=e,t[4]+=s;case"Q":a=t[1],h=t[2],e=t[3],s=t[4],l=["Q",a,h,e,s];break;case"t":t[1]+=e,t[2]+=s;case"T":"Q"===o?(a=2*e-a,h=2*s-h):(a=e,h=s),e=t[1],s=t[2],l=["Q",a,h,e,s];break;case"a":t[6]+=e,t[7]+=s;case"A":cr(e,s,t).forEach((t=>r.push(t))),e=t[6],s=t[7];break;case"z":case"Z":e=n,s=i,l=["Z"]}l?(r.push(l),o=l[0]):o=""}return r},ur=(t,e,s,n)=>Math.sqrt((s-t)**2+(n-e)**2),dr=(t,e,s,n,i,r,o,a)=>h=>{const c=h**3,l=(t=>3*t**2*(1-t))(h),u=(t=>3*t*(1-t)**2)(h),d=(t=>(1-t)**3)(h);return new gt(o*c+i*l+s*u+t*d,a*c+r*l+n*u+e*d)},gr=t=>t**2,pr=t=>2*t*(1-t),fr=t=>(1-t)**2,mr=(t,e,s,n,i,r,o,a)=>h=>{const c=gr(h),l=pr(h),u=fr(h),d=3*(u*(s-t)+l*(i-s)+c*(o-i)),g=3*(u*(n-e)+l*(r-n)+c*(a-r));return Math.atan2(g,d)},_r=(t,e,s,n,i,r)=>o=>{const a=gr(o),h=pr(o),c=fr(o);return new gt(i*a+s*h+t*c,r*a+n*h+e*c)},vr=(t,e,s,n,i,r)=>o=>{const a=1-o,h=2*(a*(s-t)+o*(i-s)),c=2*(a*(n-e)+o*(r-n));return Math.atan2(c,h)},yr=(t,e,s)=>{let n=new gt(e,s),i=0;for(let r=1;r<=100;r+=1){const e=t(r/100);i+=ur(n.x,n.y,e.x,e.y),n=e}return i},Cr=(t,e)=>{let s,n=0,i=0,r={x:t.x,y:t.y},o=l({},r),a=.01,h=0;const c=t.iterator,u=t.angleFinder;for(;i<e&&a>1e-4;)o=c(n),h=n,s=ur(r.x,r.y,o.x,o.y),s+i>e?(n-=a,a/=2):(r=o,n+=a,i+=s);return l(l({},o),{},{angle:u(h)})},br=t=>{let e,s,n=0,i=0,r=0,o=0,a=0;const h=[];for(const c of t){const t={x:i,y:r,command:c[0],length:0};switch(c[0]){case"M":s=t,s.x=o=i=c[1],s.y=a=r=c[2];break;case"L":s=t,s.length=ur(i,r,c[1],c[2]),i=c[1],r=c[2];break;case"C":e=dr(i,r,c[1],c[2],c[3],c[4],c[5],c[6]),s=t,s.iterator=e,s.angleFinder=mr(i,r,c[1],c[2],c[3],c[4],c[5],c[6]),s.length=yr(e,i,r),i=c[5],r=c[6];break;case"Q":e=_r(i,r,c[1],c[2],c[3],c[4]),s=t,s.iterator=e,s.angleFinder=vr(i,r,c[1],c[2],c[3],c[4]),s.length=yr(e,i,r),i=c[3],r=c[4];break;case"Z":s=t,s.destX=o,s.destY=a,s.length=ur(i,r,o,a),i=o,r=a}n+=s.length,h.push(s)}return h.push({length:n,x:i,y:r}),h},wr=function(t,e){let s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:br(t),n=0;for(;e-s[n].length>0&&n<s.length-2;)e-=s[n].length,n++;const i=s[n],r=e/i.length,o=t[n];switch(i.command){case"M":return{x:i.x,y:i.y,angle:0};case"Z":return l(l({},new gt(i.x,i.y).lerp(new gt(i.destX,i.destY),r)),{},{angle:Math.atan2(i.destY-i.y,i.destX-i.x)});case"L":return l(l({},new gt(i.x,i.y).lerp(new gt(o[1],o[2]),r)),{},{angle:Math.atan2(o[2]-i.y,o[1]-i.x)});case"C":case"Q":return Cr(i,e)}},xr=new RegExp("[mzlhvcsqta][^mzlhvcsqta]*","gi"),Sr=new RegExp(ir,"g"),Tr=new RegExp(hs,"gi"),kr={m:2,l:2,h:1,v:1,c:6,s:4,q:4,t:2,a:7},Ar=t=>{var e;const s=[],n=null!==(e=t.match(xr))&&void 0!==e?e:[];for(const i of n){const t=i[0];if("z"===t||"Z"===t){s.push([t]);continue}const e=kr[t.toLowerCase()];let n=[];if("a"===t||"A"===t){Sr.lastIndex=0;for(let t=null;t=Sr.exec(i);)n.push(...t.slice(1))}else n=i.match(Tr)||[];for(let i=0;i<n.length;i+=e){const r=new Array(e),o=rr[t];r[0]=i>0&&o?o:t;for(let t=0;t<e;t++)r[t+1]=parseFloat(n[i+t]);s.push(r)}}return s},Er=function(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,s=new gt(t[0]),n=new gt(t[1]),i=1,r=0;const o=[],a=t.length,h=a>2;let c;for(h&&(i=t[2].x<n.x?-1:t[2].x===n.x?0:1,r=t[2].y<n.y?-1:t[2].y===n.y?0:1),o.push(["M",s.x-i*e,s.y-r*e]),c=1;c<a;c++){if(!s.eq(n)){const t=s.midPointFrom(n);o.push(["Q",s.x,s.y,t.x,t.y])}s=t[c],c+1<t.length&&(n=t[c+1])}return h&&(i=s.x>t[c-2].x?1:s.x===t[c-2].x?0:-1,r=s.y>t[c-2].y?1:s.y===t[c-2].y?0:-1),o.push(["L",s.x+i*e,s.y+r*e]),o},Or=(t,e)=>t.map((t=>t.map(((t,s)=>0===s||void 0===e?t:Kt(t,e))).join(" "))).join(" ");function Dr(t,e){const s=t.style;s&&e&&("string"==typeof e?s.cssText+=";"+e:Object.entries(e).forEach((t=>{let[e,n]=t;return s.setProperty(e,n)})))}const Pr=(t,e)=>Math.floor(Math.random()*(e-t+1))+t;function Ir(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const s=e.onComplete||E,n=new(S().XMLHttpRequest),i=e.signal,r=function(){n.abort()},o=function(){i&&i.removeEventListener("abort",r),n.onerror=n.ontimeout=E};if(i&&i.aborted)throw new _("request");return i&&i.addEventListener("abort",r,{once:!0}),n.onreadystatechange=function(){4===n.readyState&&(o(),s(n),n.onreadystatechange=E)},n.onerror=n.ontimeout=o,n.open("get",t,!0),n.send(),n}const Mr=(t,e)=>{let s=t._findCenterFromElement();t.transformMatrix&&((t=>{if(t.transformMatrix){const{scaleX:e,scaleY:s,angle:n,skewX:i}=Ft(t.transformMatrix);t.flipX=!1,t.flipY=!1,t.set(Z,e),t.set($,s),t.angle=n,t.skewX=i,t.skewY=0}})(t),s=s.transform(t.transformMatrix)),delete t.transformMatrix,e&&(t.scaleX*=e.scaleX,t.scaleY*=e.scaleY,t.cropX=e.cropX,t.cropY=e.cropY,s.x+=e.offsetLeft,s.y+=e.offsetTop,t.width=e.width,t.height=e.height),t.setPositionByOrigin(s,F,F)};var Rr=Object.freeze({__proto__:null,addTransformToObject:me,animate:tn,animateColor:en,applyTransformToObject:_e,calcAngleBetweenVectors:Ss,calcDimensionsMatrix:Yt,calcPlaneChangeMatrix:be,calcVectorRotation:Ts,cancelAnimFrame:yt,capValue:Rs,composeMatrix:Xt,copyCanvasElement:t=>{var e;const s=St(t);return null===(e=s.getContext("2d"))||void 0===e||e.drawImage(t,0,0),s},cos:ut,createCanvasElement:wt,createImage:xt,createRotateMatrix:jt,createScaleMatrix:Nt,createSkewXMatrix:Wt,createSkewYMatrix:Ut,createTranslateMatrix:Lt,createVector:ws,crossProduct:Es,degreesToRadians:At,dotProduct:Os,ease:Xs,enlivenObjectEnlivables:Ht,enlivenObjects:Gt,findScaleToCover:er,findScaleToFit:tr,getBoundsOfCurve:hr,getOrthonormalVector:As,getPathSegmentsInfo:br,getPointOnPath:wr,getPointer:ue,getRandomInt:Pr,getRegularPolygonPath:(t,e)=>{const s=2*Math.PI/t;let n=-O;t%2==0&&(n+=s/2);const i=new Array(t+1);for(let r=0;r<t;r++){const t=r*s+n,{x:o,y:a}=new gt(ut(t),dt(t)).scalarMultiply(e);i[r]=[0===r?"M":"L",o,a]}return i[t]=["Z"],i},getSmoothPathFromPoints:Er,getSvgAttributes:t=>{const e=["instantiated_by_use","style","id","class"];switch(t){case"linearGradient":return e.concat(["x1","y1","x2","y2","gradientUnits","gradientTransform"]);case"radialGradient":return e.concat(["gradientUnits","gradientTransform","cx","cy","r","fx","fy","fr"]);case"stop":return e.concat(["offset","stop-color","stop-opacity"])}return e},getUnitVector:ks,groupSVGElements:(t,e)=>t&&1===t.length?t[0]:new $i(t,e),hasStyleChanged:ei,invertTransform:Pt,isBetweenVectors:Ds,isIdentityMatrix:Ot,isTouchEvent:de,isTransparent:Yn,joinPath:Or,loadImage:Vt,magnitude:xs,makeBoundingBoxFromPoints:pe,makePathSimpler:lr,matrixToSVG:Qt,mergeClipPaths:(t,e)=>{var s;let n=t,i=e;n.inverted&&!i.inverted&&(n=e,i=t),Se(i,null===(s=i.group)||void 0===s?void 0:s.calcTransformMatrix(),n.calcTransformMatrix());const r=n.inverted&&i.inverted;return r&&(n.inverted=i.inverted=!1),new $i([n],{clipPath:i,inverted:r})},multiplyTransformMatrices:It,multiplyTransformMatrixArray:Mt,parsePath:Ar,parsePreserveAspectRatioAttribute:Ve,parseUnit:Xe,pick:zt,projectStrokeOnPoints:zn,qrDecompose:Ft,radiansToDegrees:Et,removeFromArray:lt,removeTransformFromObject:(t,e)=>{const s=Pt(e),n=It(s,t.calcOwnMatrix());_e(t,n)},removeTransformMatrixForSvgParsing:Mr,request:Ir,requestAnimFrame:vt,resetObjectTransform:ve,rotatePoint:(t,e,s)=>t.rotate(s,e),rotateVector:bs,saveObjectTransform:ye,sendObjectToPlane:Se,sendPointToPlane:we,sendVectorToPlane:xe,setStyle:Dr,sin:dt,sizeAfterTransform:Ce,string:ti,stylesFromArray:ni,stylesToArray:si,toBlob:kt,toDataURL:Tt,toFixed:Kt,transformPath:(t,e,s)=>(s&&(e=It(e,[1,0,0,1,-s.x,-s.y])),t.map((t=>{const s=[...t];for(let n=1;n<t.length-1;n+=2){const{x:i,y:r}=Dt({x:t[n],y:t[n+1]},e);s[n]=i,s[n+1]=r}return s}))),transformPoint:Dt});class Fr extends ae{constructor(t){let{allowTouchScrolling:e=!1,containerClass:s=""}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};super(t),h(this,"upper",void 0),h(this,"container",void 0);const{el:n}=this.lower,i=this.createUpperCanvas();this.upper={el:i,ctx:i.getContext("2d")},this.applyCanvasStyle(n,{allowTouchScrolling:e}),this.applyCanvasStyle(i,{allowTouchScrolling:e,styles:{position:"absolute",left:"0",top:"0"}});const r=this.createContainerElement();r.classList.add(s),n.parentNode&&n.parentNode.replaceChild(r,n),r.append(n,i),this.container=r}createUpperCanvas(){const{el:t}=this.lower,e=wt();return e.className=t.className,e.classList.remove("lower-canvas"),e.classList.add("upper-canvas"),e.setAttribute("data-fabric","top"),e.style.cssText=t.style.cssText,e.setAttribute("draggable","true"),e}createContainerElement(){const t=x().createElement("div");return t.setAttribute("data-fabric","wrapper"),Dr(t,{position:"relative"}),oe(t),t}applyCanvasStyle(t,e){const{styles:s,allowTouchScrolling:n}=e;Dr(t,l(l({},s),{},{"touch-action":n?"manipulation":W})),oe(t)}setDimensions(t,e){super.setDimensions(t,e);const{el:s,ctx:n}=this.upper;ie(s,n,t,e)}setCSSDimensions(t){super.setCSSDimensions(t),re(this.upper.el,t),re(this.container,t)}cleanupDOM(t){const e=this.container,{el:s}=this.lower,{el:n}=this.upper;super.cleanupDOM(t),e.removeChild(n),e.removeChild(s),e.parentNode&&e.parentNode.replaceChild(s,e)}dispose(){super.dispose(),w().dispose(this.upper.el),delete this.upper,delete this.container}}class Lr extends ce{constructor(){super(...arguments),h(this,"targets",[]),h(this,"_hoveredTargets",[]),h(this,"_objectsToRender",void 0),h(this,"_currentTransform",null),h(this,"_groupSelector",null),h(this,"contextTopDirty",!1)}static getDefaults(){return l(l({},super.getDefaults()),Lr.ownDefaults)}get upperCanvasEl(){var t;return null===(t=this.elements.upper)||void 0===t?void 0:t.el}get contextTop(){var t;return null===(t=this.elements.upper)||void 0===t?void 0:t.ctx}get wrapperEl(){return this.elements.container}initElements(t){this.elements=new Fr(t,{allowTouchScrolling:this.allowTouchScrolling,containerClass:this.containerClass}),this._createCacheCanvas()}_onObjectAdded(t){this._objectsToRender=void 0,super._onObjectAdded(t)}_onObjectRemoved(t){this._objectsToRender=void 0,t===this._activeObject&&(this.fire("before:selection:cleared",{deselected:[t]}),this._discardActiveObject(),this.fire("selection:cleared",{deselected:[t]}),t.fire("deselected",{target:t})),t===this._hoveredTarget&&(this._hoveredTarget=void 0,this._hoveredTargets=[]),super._onObjectRemoved(t)}_onStackOrderChanged(){this._objectsToRender=void 0,super._onStackOrderChanged()}_chooseObjectsToRender(){const t=this._activeObject;return!this.preserveObjectStacking&&t?this._objects.filter((e=>!e.group&&e!==t)).concat(t):this._objects}renderAll(){this.cancelRequestedRender(),this.destroyed||(!this.contextTopDirty||this._groupSelector||this.isDrawingMode||(this.clearContext(this.contextTop),this.contextTopDirty=!1),this.hasLostContext&&(this.renderTopLayer(this.contextTop),this.hasLostContext=!1),!this._objectsToRender&&(this._objectsToRender=this._chooseObjectsToRender()),this.renderCanvas(this.getContext(),this._objectsToRender))}renderTopLayer(t){t.save(),this.isDrawingMode&&this._isCurrentlyDrawing&&(this.freeDrawingBrush&&this.freeDrawingBrush._render(),this.contextTopDirty=!0),this.selection&&this._groupSelector&&(this._drawSelection(t),this.contextTopDirty=!0),t.restore()}renderTop(){const t=this.contextTop;this.clearContext(t),this.renderTopLayer(t),this.fire("after:render",{ctx:t})}setTargetFindTolerance(t){t=Math.round(t),this.targetFindTolerance=t;const e=this.getRetinaScaling(),s=Math.ceil((2*t+1)*e);this.pixelFindCanvasEl.width=this.pixelFindCanvasEl.height=s,this.pixelFindContext.scale(e,e)}isTargetTransparent(t,e,s){const n=this.targetFindTolerance,i=this.pixelFindContext;this.clearContext(i),i.save(),i.translate(-e+n,-s+n),i.transform(...this.viewportTransform);const r=t.selectionBackgroundColor;t.selectionBackgroundColor="",t.render(i),t.selectionBackgroundColor=r,i.restore();const o=Math.round(n*this.getRetinaScaling());return Yn(i,o,o,o)}_isSelectionKeyPressed(t){const e=this.selectionKey;return!!e&&(Array.isArray(e)?!!e.find((e=>!!e&&!0===t[e])):t[e])}_shouldClearSelection(t,e){const s=this.getActiveObjects(),n=this._activeObject;return!!(!e||e&&n&&s.length>1&&-1===s.indexOf(e)&&n!==e&&!this._isSelectionKeyPressed(t)||e&&!e.evented||e&&!e.selectable&&n&&n!==e)}_shouldCenterTransform(t,e,s){if(!t)return;let n;return e===J||e===Z||e===$||e===z?n=this.centeredScaling||t.centeredScaling:e===G&&(n=this.centeredRotation||t.centeredRotation),n?!s:s}_getOriginFromCorner(t,e){const s={x:t.originX,y:t.originY};return e?(["ml","tl","bl"].includes(e)?s.x=B:["mr","tr","br"].includes(e)&&(s.x=L),["tl","mt","tr"].includes(e)?s.y=N:["bl","mb","br"].includes(e)&&(s.y=j),s):s}_setupCurrentTransform(t,e,s){var n;const i=e.group?we(this.getScenePoint(t),void 0,e.group.calcTransformMatrix()):this.getScenePoint(t),{key:r="",control:o}=e.getActiveControl()||{},a=s&&o?null===(n=o.getActionHandler(t,e,o))||void 0===n?void 0:n.bind(o):Fe,h=((t,e,s,n)=>{if(!e||!t)return"drag";const i=n.controls[e];return i.getActionName(s,i,n)})(s,r,t,e),c=t[this.centeredKey],u=this._shouldCenterTransform(e,h,c)?{x:F,y:F}:this._getOriginFromCorner(e,r),d={target:e,action:h,actionHandler:a,actionPerformed:!1,corner:r,scaleX:e.scaleX,scaleY:e.scaleY,skewX:e.skewX,skewY:e.skewY,offsetX:i.x-e.left,offsetY:i.y-e.top,originX:u.x,originY:u.y,ex:i.x,ey:i.y,lastX:i.x,lastY:i.y,theta:At(e.angle),width:e.width,height:e.height,shiftKey:t.shiftKey,altKey:c,original:l(l({},ye(e)),{},{originX:u.x,originY:u.y})};this._currentTransform=d,this.fire("before:transform",{e:t,transform:d})}setCursor(t){this.upperCanvasEl.style.cursor=t}_drawSelection(t){const{x:e,y:s,deltaX:n,deltaY:i}=this._groupSelector,r=new gt(e,s).transform(this.viewportTransform),o=new gt(e+n,s+i).transform(this.viewportTransform),a=this.selectionLineWidth/2;let h=Math.min(r.x,o.x),c=Math.min(r.y,o.y),l=Math.max(r.x,o.x),u=Math.max(r.y,o.y);this.selectionColor&&(t.fillStyle=this.selectionColor,t.fillRect(h,c,l-h,u-c)),this.selectionLineWidth&&this.selectionBorderColor&&(t.lineWidth=this.selectionLineWidth,t.strokeStyle=this.selectionBorderColor,h+=a,c+=a,l-=a,u-=a,Un.prototype._setLineDash.call(this,t,this.selectionDashArray),t.strokeRect(h,c,l-h,u-c))}findTarget(t){if(this.skipTargetFind)return;const e=this.getViewportPoint(t),s=this._activeObject,n=this.getActiveObjects();if(this.targets=[],s&&n.length>=1){if(s.findControl(e,de(t)))return s;if(n.length>1&&this.searchPossibleTargets([s],e))return s;if(s===this.searchPossibleTargets([s],e)){if(this.preserveObjectStacking){const n=this.targets;this.targets=[];const i=this.searchPossibleTargets(this._objects,e);return t[this.altSelectionKey]&&i&&i!==s?(this.targets=n,s):i}return s}}return this.searchPossibleTargets(this._objects,e)}_pointIsInObjectSelectionArea(t,e){let s=t.getCoords();const n=this.getZoom(),i=t.padding/n;if(i){const[t,e,n,r]=s,o=Math.atan2(e.y-t.y,e.x-t.x),a=ut(o)*i,h=dt(o)*i,c=a+h,l=a-h;s=[new gt(t.x-l,t.y-c),new gt(e.x+c,e.y-l),new gt(n.x+l,n.y+c),new gt(r.x-c,r.y+l)]}return sn.isPointInPolygon(e,s)}_checkTarget(t,e){if(t&&t.visible&&t.evented&&this._pointIsInObjectSelectionArea(t,we(e,void 0,this.viewportTransform))){if(!this.perPixelTargetFind&&!t.perPixelTargetFind||t.isEditing)return!0;if(!this.isTargetTransparent(t,e.x,e.y))return!0}return!1}_searchPossibleTargets(t,e){let s=t.length;for(;s--;){const n=t[s];if(this._checkTarget(n,e)){if(ft(n)&&n.subTargetCheck){const t=this._searchPossibleTargets(n._objects,e);t&&this.targets.push(t)}return n}}}searchPossibleTargets(t,e){const s=this._searchPossibleTargets(t,e);if(s&&ft(s)&&s.interactive&&this.targets[0]){const t=this.targets;for(let e=t.length-1;e>0;e--){const s=t[e];if(!ft(s)||!s.interactive)return s}return t[0]}return s}getViewportPoint(t){return this._pointer?this._pointer:this.getPointer(t,!0)}getScenePoint(t){return this._absolutePointer?this._absolutePointer:this.getPointer(t)}getPointer(t){let e=arguments.length>1&&void 0!==arguments[1]&&arguments[1];const s=this.upperCanvasEl,n=s.getBoundingClientRect();let i=ue(t),r=n.width||0,o=n.height||0;r&&o||(j in n&&N in n&&(o=Math.abs(n.top-n.bottom)),B in n&&L in n&&(r=Math.abs(n.right-n.left))),this.calcOffset(),i.x=i.x-this._offset.left,i.y=i.y-this._offset.top,e||(i=we(i,void 0,this.viewportTransform));const a=this.getRetinaScaling();1!==a&&(i.x/=a,i.y/=a);const h=0===r||0===o?new gt(1,1):new gt(s.width/r,s.height/o);return i.multiply(h)}_setDimensionsImpl(t,e){this._resetTransformEventData(),super._setDimensionsImpl(t,e),this._isCurrentlyDrawing&&this.freeDrawingBrush&&this.freeDrawingBrush._setBrushStyles(this.contextTop)}_createCacheCanvas(){this.pixelFindCanvasEl=wt(),this.pixelFindContext=this.pixelFindCanvasEl.getContext("2d",{willReadFrequently:!0}),this.setTargetFindTolerance(this.targetFindTolerance)}getTopContext(){return this.elements.upper.ctx}getSelectionContext(){return this.elements.upper.ctx}getSelectionElement(){return this.elements.upper.el}getActiveObject(){return this._activeObject}getActiveObjects(){const t=this._activeObject;return te(t)?t.getObjects():t?[t]:[]}_fireSelectionEvents(t,e){let s=!1,n=!1;const i=this.getActiveObjects(),r=[],o=[];t.forEach((t=>{i.includes(t)||(s=!0,t.fire("deselected",{e:e,target:t}),o.push(t))})),i.forEach((n=>{t.includes(n)||(s=!0,n.fire("selected",{e:e,target:n}),r.push(n))})),t.length>0&&i.length>0?(n=!0,s&&this.fire("selection:updated",{e:e,selected:r,deselected:o})):i.length>0?(n=!0,this.fire("selection:created",{e:e,selected:r})):t.length>0&&(n=!0,this.fire("selection:cleared",{e:e,deselected:o})),n&&(this._objectsToRender=void 0)}setActiveObject(t,e){const s=this.getActiveObjects(),n=this._setActiveObject(t,e);return this._fireSelectionEvents(s,e),n}_setActiveObject(t,e){const s=this._activeObject;return s!==t&&!(!this._discardActiveObject(e,t)&&this._activeObject)&&!t.onSelect({e:e})&&(this._activeObject=t,te(t)&&s!==t&&t.set("canvas",this),t.setCoords(),!0)}_discardActiveObject(t,e){const s=this._activeObject;return!!s&&!s.onDeselect({e:t,object:e})&&(this._currentTransform&&this._currentTransform.target===s&&this.endCurrentTransform(t),te(s)&&s===this._hoveredTarget&&(this._hoveredTarget=void 0),this._activeObject=void 0,!0)}discardActiveObject(t){const e=this.getActiveObjects(),s=this.getActiveObject();e.length&&this.fire("before:selection:cleared",{e:t,deselected:[s]});const n=this._discardActiveObject(t);return this._fireSelectionEvents(e,t),n}endCurrentTransform(t){const e=this._currentTransform;this._finalizeCurrentTransform(t),e&&e.target&&(e.target.isMoving=!1),this._currentTransform=null}_finalizeCurrentTransform(t){const e=this._currentTransform,s=e.target,n={e:t,target:s,transform:e,action:e.action};s._scaling&&(s._scaling=!1),s.setCoords(),e.actionPerformed&&(this.fire("object:modified",n),s.fire(it,n))}setViewportTransform(t){super.setViewportTransform(t);const e=this._activeObject;e&&e.setCoords()}destroy(){const t=this._activeObject;te(t)&&(t.removeAll(),t.dispose()),delete this._activeObject,super.destroy(),this.pixelFindContext=null,this.pixelFindCanvasEl=void 0}clear(){this.discardActiveObject(),this._activeObject=void 0,this.clearContext(this.contextTop),super.clear()}drawControls(t){const e=this._activeObject;e&&e._renderControls(t)}_toObject(t,e,s){const n=this._realizeGroupTransformOnObject(t),i=super._toObject(t,e,s);return t.set(n),i}_realizeGroupTransformOnObject(t){const{group:e}=t;if(e&&te(e)&&this._activeObject===e){const s=zt(t,["angle","flipX","flipY",L,Z,$,tt,et,j]);return me(t,e.calcOwnMatrix()),s}return{}}_setSVGObject(t,e,s){const n=this._realizeGroupTransformOnObject(e);super._setSVGObject(t,e,s),e.set(n)}}h(Lr,"ownDefaults",{uniformScaling:!0,uniScaleKey:"shiftKey",centeredScaling:!1,centeredRotation:!1,centeredKey:"altKey",altActionKey:"shiftKey",selection:!0,selectionKey:"shiftKey",selectionColor:"rgba(100, 100, 255, 0.3)",selectionDashArray:[],selectionBorderColor:"rgba(255, 255, 255, 0.3)",selectionLineWidth:1,selectionFullyContained:!1,hoverCursor:"move",moveCursor:"move",defaultCursor:"default",freeDrawingCursor:"crosshair",notAllowedCursor:"not-allowed",perPixelTargetFind:!1,targetFindTolerance:0,skipTargetFind:!1,stopContextMenu:!1,fireRightClick:!1,fireMiddleClick:!1,enablePointerEvents:!1,containerClass:"canvas-container",preserveObjectStacking:!1});class jr{constructor(t){h(this,"targets",[]),h(this,"__disposer",void 0);const e=()=>{const{hiddenTextarea:e}=t.getActiveObject()||{};e&&e.focus()},s=t.upperCanvasEl;s.addEventListener("click",e),this.__disposer=()=>s.removeEventListener("click",e)}exitTextEditing(){this.target=void 0,this.targets.forEach((t=>{t.isEditing&&t.exitEditing()}))}add(t){this.targets.push(t)}remove(t){this.unregister(t),lt(this.targets,t)}register(t){this.target=t}unregister(t){t===this.target&&(this.target=void 0)}onMouseMove(t){var e;(null===(e=this.target)||void 0===e?void 0:e.isEditing)&&this.target.updateSelectionOnMouseMove(t)}clear(){this.targets=[],this.target=void 0}dispose(){this.clear(),this.__disposer(),delete this.__disposer}}const Nr=["target","oldTarget","fireCanvas","e"],Br={passive:!1},Wr=(t,e)=>{const s=t.getViewportPoint(e),n=t.getScenePoint(e);return{viewportPoint:s,scenePoint:n,pointer:s,absolutePointer:n}},Ur=function(t){for(var e=arguments.length,s=new Array(e>1?e-1:0),n=1;n<e;n++)s[n-1]=arguments[n];return t.addEventListener(...s)},Yr=function(t){for(var e=arguments.length,s=new Array(e>1?e-1:0),n=1;n<e;n++)s[n-1]=arguments[n];return t.removeEventListener(...s)},Xr={mouse:{in:"over",out:"out",targetIn:"mouseover",targetOut:"mouseout",canvasIn:"mouse:over",canvasOut:"mouse:out"},drag:{in:"enter",out:"leave",targetIn:"dragenter",targetOut:"dragleave",canvasIn:"drag:enter",canvasOut:"drag:leave"}};class Vr extends Lr{constructor(t){super(t,arguments.length>1&&void 0!==arguments[1]?arguments[1]:{}),h(this,"_isClick",void 0),h(this,"textEditingManager",new jr(this)),["_onMouseDown","_onTouchStart","_onMouseMove","_onMouseUp","_onTouchEnd","_onResize","_onMouseWheel","_onMouseOut","_onMouseEnter","_onContextMenu","_onClick","_onDragStart","_onDragEnd","_onDragProgress","_onDragOver","_onDragEnter","_onDragLeave","_onDrop"].forEach((t=>{this[t]=this[t].bind(this)})),this.addOrRemove(Ur,"add")}_getEventPrefix(){return this.enablePointerEvents?"pointer":"mouse"}addOrRemove(t,e){const s=this.upperCanvasEl,n=this._getEventPrefix();t(ne(s),"resize",this._onResize),t(s,n+"down",this._onMouseDown),t(s,"".concat(n,"move"),this._onMouseMove,Br),t(s,"".concat(n,"out"),this._onMouseOut),t(s,"".concat(n,"enter"),this._onMouseEnter),t(s,"wheel",this._onMouseWheel),t(s,"contextmenu",this._onContextMenu),t(s,"click",this._onClick),t(s,"dblclick",this._onClick),t(s,"dragstart",this._onDragStart),t(s,"dragend",this._onDragEnd),t(s,"dragover",this._onDragOver),t(s,"dragenter",this._onDragEnter),t(s,"dragleave",this._onDragLeave),t(s,"drop",this._onDrop),this.enablePointerEvents||t(s,"touchstart",this._onTouchStart,Br)}removeListeners(){this.addOrRemove(Yr,"remove");const t=this._getEventPrefix(),e=se(this.upperCanvasEl);Yr(e,"".concat(t,"up"),this._onMouseUp),Yr(e,"touchend",this._onTouchEnd,Br),Yr(e,"".concat(t,"move"),this._onMouseMove,Br),Yr(e,"touchmove",this._onMouseMove,Br),clearTimeout(this._willAddMouseDown)}_onMouseWheel(t){this.__onMouseWheel(t)}_onMouseOut(t){const e=this._hoveredTarget,s=l({e:t},Wr(this,t));this.fire("mouse:out",l(l({},s),{},{target:e})),this._hoveredTarget=void 0,e&&e.fire("mouseout",l({},s)),this._hoveredTargets.forEach((t=>{this.fire("mouse:out",l(l({},s),{},{target:t})),t&&t.fire("mouseout",l({},s))})),this._hoveredTargets=[]}_onMouseEnter(t){this._currentTransform||this.findTarget(t)||(this.fire("mouse:over",l({e:t},Wr(this,t))),this._hoveredTarget=void 0,this._hoveredTargets=[])}_onDragStart(t){this._isClick=!1;const e=this.getActiveObject();if(e&&e.onDragStart(t)){this._dragSource=e;const s={e:t,target:e};return this.fire("dragstart",s),e.fire("dragstart",s),void Ur(this.upperCanvasEl,"drag",this._onDragProgress)}ge(t)}_renderDragEffects(t,e,s){let n=!1;const i=this._dropTarget;i&&i!==e&&i!==s&&(i.clearContextTop(),n=!0),null==e||e.clearContextTop(),s!==e&&(null==s||s.clearContextTop());const r=this.contextTop;r.save(),r.transform(...this.viewportTransform),e&&(r.save(),e.transform(r),e.renderDragSourceEffect(t),r.restore(),n=!0),s&&(r.save(),s.transform(r),s.renderDropTargetEffect(t),r.restore(),n=!0),r.restore(),n&&(this.contextTopDirty=!0)}_onDragEnd(t){const e=!!t.dataTransfer&&t.dataTransfer.dropEffect!==W,s=e?this._activeObject:void 0,n={e:t,target:this._dragSource,subTargets:this.targets,dragSource:this._dragSource,didDrop:e,dropTarget:s};Yr(this.upperCanvasEl,"drag",this._onDragProgress),this.fire("dragend",n),this._dragSource&&this._dragSource.fire("dragend",n),delete this._dragSource,this._onMouseUp(t)}_onDragProgress(t){const e={e:t,target:this._dragSource,dragSource:this._dragSource,dropTarget:this._draggedoverTarget};this.fire("drag",e),this._dragSource&&this._dragSource.fire("drag",e)}findDragTargets(t){return this.targets=[],{target:this._searchPossibleTargets(this._objects,this.getViewportPoint(t)),targets:[...this.targets]}}_onDragOver(t){const e="dragover",{target:s,targets:n}=this.findDragTargets(t),i=this._dragSource,r={e:t,target:s,subTargets:n,dragSource:i,canDrop:!1,dropTarget:void 0};let o;this.fire(e,r),this._fireEnterLeaveEvents(s,r),s&&(s.canDrop(t)&&(o=s),s.fire(e,r));for(let a=0;a<n.length;a++){const s=n[a];s.canDrop(t)&&(o=s),s.fire(e,r)}this._renderDragEffects(t,i,o),this._dropTarget=o}_onDragEnter(t){const{target:e,targets:s}=this.findDragTargets(t),n={e:t,target:e,subTargets:s,dragSource:this._dragSource};this.fire("dragenter",n),this._fireEnterLeaveEvents(e,n)}_onDragLeave(t){const e={e:t,target:this._draggedoverTarget,subTargets:this.targets,dragSource:this._dragSource};this.fire("dragleave",e),this._fireEnterLeaveEvents(void 0,e),this._renderDragEffects(t,this._dragSource),this._dropTarget=void 0,this.targets=[],this._hoveredTargets=[]}_onDrop(t){const{target:e,targets:s}=this.findDragTargets(t),n=this._basicEventHandler("drop:before",l({e:t,target:e,subTargets:s,dragSource:this._dragSource},Wr(this,t)));n.didDrop=!1,n.dropTarget=void 0,this._basicEventHandler("drop",n),this.fire("drop:after",n)}_onContextMenu(t){const e=this.findTarget(t),s=this.targets||[],n=this._basicEventHandler("contextmenu:before",{e:t,target:e,subTargets:s});return this.stopContextMenu&&ge(t),this._basicEventHandler("contextmenu",n),!1}_onClick(t){const e=t.detail;e>3||e<2||(this._cacheTransformEventData(t),2==e&&"dblclick"===t.type&&this._handleEvent(t,"dblclick"),3==e&&this._handleEvent(t,"tripleclick"),this._resetTransformEventData())}getPointerId(t){const e=t.changedTouches;return e?e[0]&&e[0].identifier:this.enablePointerEvents?t.pointerId:-1}_isMainEvent(t){return!0===t.isPrimary||!1!==t.isPrimary&&("touchend"===t.type&&0===t.touches.length||!t.changedTouches||t.changedTouches[0].identifier===this.mainTouchId)}_onTouchStart(t){let e=!this.allowTouchScrolling;const s=this._activeObject;void 0===this.mainTouchId&&(this.mainTouchId=this.getPointerId(t)),this.__onMouseDown(t),(this.isDrawingMode||s&&this._target===s)&&(e=!0),e&&t.preventDefault(),this._resetTransformEventData();const n=this.upperCanvasEl,i=this._getEventPrefix(),r=se(n);Ur(r,"touchend",this._onTouchEnd,Br),e&&Ur(r,"touchmove",this._onMouseMove,Br),Yr(n,"".concat(i,"down"),this._onMouseDown)}_onMouseDown(t){this.__onMouseDown(t),this._resetTransformEventData();const e=this.upperCanvasEl,s=this._getEventPrefix();Yr(e,"".concat(s,"move"),this._onMouseMove,Br);const n=se(e);Ur(n,"".concat(s,"up"),this._onMouseUp),Ur(n,"".concat(s,"move"),this._onMouseMove,Br)}_onTouchEnd(t){if(t.touches.length>0)return;this.__onMouseUp(t),this._resetTransformEventData(),delete this.mainTouchId;const e=this._getEventPrefix(),s=se(this.upperCanvasEl);Yr(s,"touchend",this._onTouchEnd,Br),Yr(s,"touchmove",this._onMouseMove,Br),this._willAddMouseDown&&clearTimeout(this._willAddMouseDown),this._willAddMouseDown=setTimeout((()=>{Ur(this.upperCanvasEl,"".concat(e,"down"),this._onMouseDown),this._willAddMouseDown=0}),400)}_onMouseUp(t){this.__onMouseUp(t),this._resetTransformEventData();const e=this.upperCanvasEl,s=this._getEventPrefix();if(this._isMainEvent(t)){const t=se(this.upperCanvasEl);Yr(t,"".concat(s,"up"),this._onMouseUp),Yr(t,"".concat(s,"move"),this._onMouseMove,Br),Ur(e,"".concat(s,"move"),this._onMouseMove,Br)}}_onMouseMove(t){const e=this.getActiveObject();!this.allowTouchScrolling&&(!e||!e.shouldStartDragging(t))&&t.preventDefault&&t.preventDefault(),this.__onMouseMove(t)}_onResize(){this.calcOffset(),this._resetTransformEventData()}_shouldRender(t){const e=this.getActiveObject();return!!e!=!!t||e&&t&&e!==t}__onMouseUp(t){var e;this._cacheTransformEventData(t),this._handleEvent(t,"up:before");const s=this._currentTransform,n=this._isClick,i=this._target,{button:r}=t;if(r)return(this.fireMiddleClick&&1===r||this.fireRightClick&&2===r)&&this._handleEvent(t,"up"),void this._resetTransformEventData();if(this.isDrawingMode&&this._isCurrentlyDrawing)return void this._onMouseUpInDrawingMode(t);if(!this._isMainEvent(t))return;let o,a,h=!1;if(s&&(this._finalizeCurrentTransform(t),h=s.actionPerformed),!n){const e=i===this._activeObject;this.handleSelection(t),h||(h=this._shouldRender(i)||!e&&i===this._activeObject)}if(i){const e=i.findControl(this.getViewportPoint(t),de(t)),{key:n,control:r}=e||{};if(a=n,i.selectable&&i!==this._activeObject&&"up"===i.activeOn)this.setActiveObject(i,t),h=!0;else if(r){const e=r.getMouseUpHandler(t,i,r);e&&(o=this.getScenePoint(t),e.call(r,t,s,o.x,o.y))}i.isMoving=!1}if(s&&(s.target!==i||s.corner!==a)){const e=s.target&&s.target.controls[s.corner],n=e&&e.getMouseUpHandler(t,s.target,e);o=o||this.getScenePoint(t),n&&n.call(e,t,s,o.x,o.y)}this._setCursorFromEvent(t,i),this._handleEvent(t,"up"),this._groupSelector=null,this._currentTransform=null,i&&(i.__corner=void 0),h?this.requestRenderAll():n||null!==(e=this._activeObject)&&void 0!==e&&e.isEditing||this.renderTop()}_basicEventHandler(t,e){const{target:s,subTargets:n=[]}=e;this.fire(t,e),s&&s.fire(t,e);for(let i=0;i<n.length;i++)n[i]!==s&&n[i].fire(t,e);return e}_handleEvent(t,e,s){const n=this._target,i=this.targets||[],r=l(l(l({e:t,target:n,subTargets:i},Wr(this,t)),{},{transform:this._currentTransform},"up:before"===e||"up"===e?{isClick:this._isClick,currentTarget:this.findTarget(t),currentSubTargets:this.targets}:{}),"down:before"===e||"down"===e?s:{});this.fire("mouse:".concat(e),r),n&&n.fire("mouse".concat(e),r);for(let o=0;o<i.length;o++)i[o]!==n&&i[o].fire("mouse".concat(e),r)}_onMouseDownInDrawingMode(t){this._isCurrentlyDrawing=!0,this.getActiveObject()&&(this.discardActiveObject(t),this.requestRenderAll());const e=this.getScenePoint(t);this.freeDrawingBrush&&this.freeDrawingBrush.onMouseDown(e,{e:t,pointer:e}),this._handleEvent(t,"down",{alreadySelected:!1})}_onMouseMoveInDrawingMode(t){if(this._isCurrentlyDrawing){const e=this.getScenePoint(t);this.freeDrawingBrush&&this.freeDrawingBrush.onMouseMove(e,{e:t,pointer:e})}this.setCursor(this.freeDrawingCursor),this._handleEvent(t,"move")}_onMouseUpInDrawingMode(t){const e=this.getScenePoint(t);this.freeDrawingBrush?this._isCurrentlyDrawing=!!this.freeDrawingBrush.onMouseUp({e:t,pointer:e}):this._isCurrentlyDrawing=!1,this._handleEvent(t,"up")}__onMouseDown(t){this._isClick=!0,this._cacheTransformEventData(t),this._handleEvent(t,"down:before");let e=this._target,s=!!e&&e===this._activeObject;const{button:n}=t;if(n)return(this.fireMiddleClick&&1===n||this.fireRightClick&&2===n)&&this._handleEvent(t,"down",{alreadySelected:s}),void this._resetTransformEventData();if(this.isDrawingMode)return void this._onMouseDownInDrawingMode(t);if(!this._isMainEvent(t))return;if(this._currentTransform)return;let i=this._shouldRender(e),r=!1;if(this.handleMultiSelection(t,e)?(e=this._activeObject,r=!0,i=!0):this._shouldClearSelection(t,e)&&this.discardActiveObject(t),this.selection&&(!e||!e.selectable&&!e.isEditing&&e!==this._activeObject)){const e=this.getScenePoint(t);this._groupSelector={x:e.x,y:e.y,deltaY:0,deltaX:0}}if(s=!!e&&e===this._activeObject,e){e.selectable&&"down"===e.activeOn&&this.setActiveObject(e,t);const n=e.findControl(this.getViewportPoint(t),de(t));if(e===this._activeObject&&(n||!r)){this._setupCurrentTransform(t,e,s);const i=n?n.control:void 0,r=this.getScenePoint(t),o=i&&i.getMouseDownHandler(t,e,i);o&&o.call(i,t,this._currentTransform,r.x,r.y)}}i&&(this._objectsToRender=void 0),this._handleEvent(t,"down",{alreadySelected:s}),i&&this.requestRenderAll()}_resetTransformEventData(){this._target=this._pointer=this._absolutePointer=void 0}_cacheTransformEventData(t){this._resetTransformEventData(),this._pointer=this.getViewportPoint(t),this._absolutePointer=we(this._pointer,void 0,this.viewportTransform),this._target=this._currentTransform?this._currentTransform.target:this.findTarget(t)}__onMouseMove(t){if(this._isClick=!1,this._cacheTransformEventData(t),this._handleEvent(t,"move:before"),this.isDrawingMode)return void this._onMouseMoveInDrawingMode(t);if(!this._isMainEvent(t))return;const e=this._groupSelector;if(e){const s=this.getScenePoint(t);e.deltaX=s.x-e.x,e.deltaY=s.y-e.y,this.renderTop()}else if(this._currentTransform)this._transformObject(t);else{const e=this.findTarget(t);this._setCursorFromEvent(t,e),this._fireOverOutEvents(t,e)}this.textEditingManager.onMouseMove(t),this._handleEvent(t,"move"),this._resetTransformEventData()}_fireOverOutEvents(t,e){const s=this._hoveredTarget,n=this._hoveredTargets,i=this.targets,r=Math.max(n.length,i.length);this.fireSyntheticInOutEvents("mouse",{e:t,target:e,oldTarget:s,fireCanvas:!0});for(let o=0;o<r;o++)this.fireSyntheticInOutEvents("mouse",{e:t,target:i[o],oldTarget:n[o]});this._hoveredTarget=e,this._hoveredTargets=this.targets.concat()}_fireEnterLeaveEvents(t,e){const s=this._draggedoverTarget,n=this._hoveredTargets,i=this.targets,r=Math.max(n.length,i.length);this.fireSyntheticInOutEvents("drag",l(l({},e),{},{target:t,oldTarget:s,fireCanvas:!0}));for(let o=0;o<r;o++)this.fireSyntheticInOutEvents("drag",l(l({},e),{},{target:i[o],oldTarget:n[o]}));this._draggedoverTarget=t}fireSyntheticInOutEvents(t,e){let{target:s,oldTarget:n,fireCanvas:i,e:r}=e,o=u(e,Nr);const{targetIn:a,targetOut:h,canvasIn:c,canvasOut:d}=Xr[t],g=n!==s;if(n&&g){const t=l(l({},o),{},{e:r,target:n,nextTarget:s},Wr(this,r));i&&this.fire(d,t),n.fire(h,t)}if(s&&g){const t=l(l({},o),{},{e:r,target:s,previousTarget:n},Wr(this,r));i&&this.fire(c,t),s.fire(a,t)}}__onMouseWheel(t){this._cacheTransformEventData(t),this._handleEvent(t,"wheel"),this._resetTransformEventData()}_transformObject(t){const e=this.getScenePoint(t),s=this._currentTransform,n=s.target,i=n.group?we(e,void 0,n.group.calcTransformMatrix()):e;s.shiftKey=t.shiftKey,s.altKey=!!this.centeredKey&&t[this.centeredKey],this._performTransformAction(t,s,i),s.actionPerformed&&this.requestRenderAll()}_performTransformAction(t,e,s){const{action:n,actionHandler:i,target:r}=e,o=!!i&&i(t,e,s.x,s.y);o&&r.setCoords(),"drag"===n&&o&&(e.target.isMoving=!0,this.setCursor(e.target.moveCursor||this.moveCursor)),e.actionPerformed=e.actionPerformed||o}_setCursorFromEvent(t,e){if(!e)return void this.setCursor(this.defaultCursor);let s=e.hoverCursor||this.hoverCursor;const n=te(this._activeObject)?this._activeObject:null,i=(!n||e.group!==n)&&e.findControl(this.getViewportPoint(t));if(i){const s=i.control;this.setCursor(s.cursorStyleHandler(t,s,e))}else e.subTargetCheck&&this.targets.concat().reverse().map((t=>{s=t.hoverCursor||s})),this.setCursor(s)}handleMultiSelection(t,e){const s=this._activeObject,n=te(s);if(s&&this._isSelectionKeyPressed(t)&&this.selection&&e&&e.selectable&&(s!==e||n)&&(n||!e.isDescendantOf(s)&&!s.isDescendantOf(e))&&!e.onSelect({e:t})&&!s.getActiveControl()){if(n){const n=s.getObjects();if(e===s){const s=this.getViewportPoint(t);if(!(e=this.searchPossibleTargets(n,s)||this.searchPossibleTargets(this._objects,s))||!e.selectable)return!1}e.group===s?(s.remove(e),this._hoveredTarget=e,this._hoveredTargets=[...this.targets],1===s.size()&&this._setActiveObject(s.item(0),t)):(s.multiSelectAdd(e),this._hoveredTarget=s,this._hoveredTargets=[...this.targets]),this._fireSelectionEvents(n,t)}else{s.isEditing&&s.exitEditing();const n=new(at.getClass("ActiveSelection"))([],{canvas:this});n.multiSelectAdd(s,e),this._hoveredTarget=n,this._setActiveObject(n,t),this._fireSelectionEvents([s],t)}return!0}return!1}handleSelection(t){if(!this.selection||!this._groupSelector)return!1;const{x:e,y:s,deltaX:n,deltaY:i}=this._groupSelector,r=new gt(e,s),o=r.add(new gt(n,i)),a=r.min(o),h=r.max(o).subtract(a),c=this.collectObjects({left:a.x,top:a.y,width:h.x,height:h.y},{includeIntersecting:!this.selectionFullyContained}),l=r.eq(o)?c[0]?[c[0]]:[]:c.length>1?c.filter((e=>!e.onSelect({e:t}))).reverse():c;if(1===l.length)this.setActiveObject(l[0],t);else if(l.length>1){const e=at.getClass("ActiveSelection");this.setActiveObject(new e(l,{canvas:this}),t)}return this._groupSelector=null,!0}clear(){this.textEditingManager.clear(),super.clear()}destroy(){this.removeListeners(),this.textEditingManager.dispose(),super.destroy()}}const Gr={x1:0,y1:0,x2:0,y2:0},Hr=l(l({},Gr),{},{r1:0,r2:0}),zr=(t,e)=>isNaN(t)&&"number"==typeof e?e:t,qr=/^(\d+\.\d+)%|(\d+)%$/;function Kr(t){return t&&qr.test(t)}function Qr(t,e){const s="number"==typeof t?t:"string"==typeof t?parseFloat(t)/(Kr(t)?100:1):NaN;return Rs(0,zr(s,e),1)}const Jr=/\s*;\s*/,Zr=/\s*:\s*/;function $r(t,e){let s,n;const i=t.getAttribute("style");if(i){const t=i.split(Jr);""===t[t.length-1]&&t.pop();for(let e=t.length;e--;){const[i,r]=t[e].split(Zr).map((t=>t.trim()));"stop-color"===i?s=r:"stop-opacity"===i&&(n=r)}}const r=new Ye(s||t.getAttribute("stop-color")||"rgb(0,0,0)");return{offset:Qr(t.getAttribute("offset"),0),color:r.toRgb(),opacity:zr(parseFloat(n||t.getAttribute("stop-opacity")||""),1)*r.getAlpha()*e}}function to(t,e){const s=[],n=t.getElementsByTagName("stop"),i=Qr(e,1);for(let r=n.length;r--;)s.push($r(n[r],i));return s}function eo(t){return"linearGradient"===t.nodeName||"LINEARGRADIENT"===t.nodeName?"linear":"radial"}function so(t){return"userSpaceOnUse"===t.getAttribute("gradientUnits")?"pixels":"percentage"}function no(t,e){return t.getAttribute(e)}function io(t,e){return function(t,e){let s,{width:n,height:i,gradientUnits:r}=e;return Object.keys(t).reduce(((e,o)=>{const a=t[o];return"Infinity"===a?s=1:"-Infinity"===a?s=0:(s="string"==typeof a?parseFloat(a):a,"string"==typeof a&&Kr(a)&&(s*=.01,"pixels"===r&&("x1"!==o&&"x2"!==o&&"r2"!==o||(s*=n),"y1"!==o&&"y2"!==o||(s*=i)))),e[o]=s,e}),{})}("linear"===eo(t)?function(t){return{x1:no(t,"x1")||0,y1:no(t,"y1")||0,x2:no(t,"x2")||"100%",y2:no(t,"y2")||0}}(t):function(t){return{x1:no(t,"fx")||no(t,"cx")||"50%",y1:no(t,"fy")||no(t,"cy")||"50%",r1:0,x2:no(t,"cx")||"50%",y2:no(t,"cy")||"50%",r2:no(t,"r")||"50%"}}(t),l(l({},e),{},{gradientUnits:so(t)}))}class ro{constructor(t){const{type:e="linear",gradientUnits:s="pixels",coords:n={},colorStops:i=[],offsetX:r=0,offsetY:o=0,gradientTransform:a,id:h}=t||{};Object.assign(this,{type:e,gradientUnits:s,coords:l(l({},"radial"===e?Hr:Gr),n),colorStops:i,offsetX:r,offsetY:o,gradientTransform:a,id:h?"".concat(h,"_").concat(bt()):bt()})}addColorStop(t){for(const e in t){const s=new Ye(t[e]);this.colorStops.push({offset:parseFloat(e),color:s.toRgb(),opacity:s.getAlpha()})}return this}toObject(t){return l(l({},zt(this,t)),{},{type:this.type,coords:l({},this.coords),colorStops:this.colorStops.map((t=>l({},t))),offsetX:this.offsetX,offsetY:this.offsetY,gradientUnits:this.gradientUnits,gradientTransform:this.gradientTransform?[...this.gradientTransform]:void 0})}toSVG(t){let{additionalTransform:e}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const s=[],n=this.gradientTransform?this.gradientTransform.concat():I.concat(),i="pixels"===this.gradientUnits?"userSpaceOnUse":"objectBoundingBox",r=this.colorStops.map((t=>l({},t))).sort(((t,e)=>t.offset-e.offset));let o=-this.offsetX,a=-this.offsetY;var h;"objectBoundingBox"===i?(o/=t.width,a/=t.height):(o+=t.width/2,a+=t.height/2),(h=t)&&"function"==typeof h._renderPathCommands&&"percentage"!==this.gradientUnits&&(o-=t.pathOffset.x,a-=t.pathOffset.y),n[4]-=o,n[5]-=a;const c=['id="SVGID_'.concat(this.id,'"'),'gradientUnits="'.concat(i,'"'),'gradientTransform="'.concat(e?e+" ":"").concat(Qt(n),'"'),""].join(" ");if("linear"===this.type){const{x1:t,y1:e,x2:n,y2:i}=this.coords;s.push("<linearGradient ",c,' x1="',t,'" y1="',e,'" x2="',n,'" y2="',i,'">\n')}else if("radial"===this.type){const{x1:t,y1:e,x2:n,y2:i,r1:o,r2:a}=this.coords,h=o>a;s.push("<radialGradient ",c,' cx="',h?t:n,'" cy="',h?e:i,'" r="',h?o:a,'" fx="',h?n:t,'" fy="',h?i:e,'">\n'),h&&(r.reverse(),r.forEach((t=>{t.offset=1-t.offset})));const l=Math.min(o,a);if(l>0){const t=l/Math.max(o,a);r.forEach((e=>{e.offset+=t*(1-e.offset)}))}}return r.forEach((t=>{let{color:e,offset:n,opacity:i}=t;s.push("<stop ",'offset="',100*n+"%",'" style="stop-color:',e,void 0!==i?";stop-opacity: "+i:";",'"/>\n')})),s.push("linear"===this.type?"</linearGradient>":"</radialGradient>","\n"),s.join("")}toLive(t){const{x1:e,y1:s,x2:n,y2:i,r1:r,r2:o}=this.coords,a="linear"===this.type?t.createLinearGradient(e,s,n,i):t.createRadialGradient(e,s,r,n,i,o);return this.colorStops.forEach((t=>{let{color:e,opacity:s,offset:n}=t;a.addColorStop(n,void 0!==s?new Ye(e).setAlpha(s).toRgba():e)})),a}static async fromObject(t){const{colorStops:e,gradientTransform:s}=t;return new this(l(l({},t),{},{colorStops:e?e.map((t=>l({},t))):void 0,gradientTransform:s?[...s]:void 0}))}static fromElement(t,e,s){const n=so(t),i=e._findCenterFromElement();return new this(l({id:t.getAttribute("id")||void 0,type:eo(t),coords:io(t,{width:s.viewBoxWidth||s.width,height:s.viewBoxHeight||s.height}),colorStops:to(t,s.opacity),gradientUnits:n,gradientTransform:Di(t.getAttribute("gradientTransform")||"")},"pixels"===n?{offsetX:e.width/2-i.x,offsetY:e.height/2-i.y}:{offsetX:0,offsetY:0}))}}h(ro,"type","Gradient"),at.setClass(ro,"gradient"),at.setClass(ro,"linear"),at.setClass(ro,"radial");const oo=["type","source","patternTransform"];class ao{get type(){return"pattern"}set type(t){f("warn","Setting type has no effect",t)}constructor(t){h(this,"repeat","repeat"),h(this,"offsetX",0),h(this,"offsetY",0),h(this,"crossOrigin",""),this.id=bt(),Object.assign(this,t)}isImageSource(){return!!this.source&&"string"==typeof this.source.src}isCanvasSource(){return!!this.source&&!!this.source.toDataURL}sourceToString(){return this.isImageSource()?this.source.src:this.isCanvasSource()?this.source.toDataURL():""}toLive(t){return this.source&&(!this.isImageSource()||this.source.complete&&0!==this.source.naturalWidth&&0!==this.source.naturalHeight)?t.createPattern(this.source,this.repeat):null}toObject(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];const{repeat:e,crossOrigin:s}=this;return l(l({},zt(this,t)),{},{type:"pattern",source:this.sourceToString(),repeat:e,crossOrigin:s,offsetX:Kt(this.offsetX,p.NUM_FRACTION_DIGITS),offsetY:Kt(this.offsetY,p.NUM_FRACTION_DIGITS),patternTransform:this.patternTransform?[...this.patternTransform]:null})}toSVG(t){let{width:e,height:s}=t;const{source:n,repeat:i,id:r}=this,o=zr(this.offsetX/e,0),a=zr(this.offsetY/s,0),h="repeat-y"===i||"no-repeat"===i?1+Math.abs(o||0):zr(n.width/e,0),c="repeat-x"===i||"no-repeat"===i?1+Math.abs(a||0):zr(n.height/s,0);return['<pattern id="SVGID_'.concat(r,'" x="').concat(o,'" y="').concat(a,'" width="').concat(h,'" height="').concat(c,'">'),'<image x="0" y="0" width="'.concat(n.width,'" height="').concat(n.height,'" xlink:href="').concat(this.sourceToString(),'"></image>'),"</pattern>",""].join("\n")}static async fromObject(t,e){let{type:s,source:n,patternTransform:i}=t,r=u(t,oo);const o=await Vt(n,l(l({},e),{},{crossOrigin:r.crossOrigin}));return new this(l(l({},r),{},{patternTransform:i&&i.slice(0),source:o}))}}h(ao,"type","Pattern"),at.setClass(ao),at.setClass(ao,"pattern");const ho=["path","left","top"],co=["d"];class lo extends Un{constructor(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},{path:s,left:n,top:i}=e,r=u(e,ho);super(),Object.assign(this,lo.ownDefaults),this.setOptions(r),this._setPath(t||[],!0),"number"==typeof n&&this.set(L,n),"number"==typeof i&&this.set(j,i)}_setPath(t,e){this.path=lr(Array.isArray(t)?t:Ar(t)),this.setBoundingBox(e)}_findCenterFromElement(){const t=this._calcBoundsFromPath();return new gt(t.left+t.width/2,t.top+t.height/2)}_renderPathCommands(t){const e=-this.pathOffset.x,s=-this.pathOffset.y;t.beginPath();for(const n of this.path)switch(n[0]){case"L":t.lineTo(n[1]+e,n[2]+s);break;case"M":t.moveTo(n[1]+e,n[2]+s);break;case"C":t.bezierCurveTo(n[1]+e,n[2]+s,n[3]+e,n[4]+s,n[5]+e,n[6]+s);break;case"Q":t.quadraticCurveTo(n[1]+e,n[2]+s,n[3]+e,n[4]+s);break;case"Z":t.closePath()}}_render(t){this._renderPathCommands(t),this._renderPaintInOrder(t)}toString(){return"#<Path (".concat(this.complexity(),'): { "top": ').concat(this.top,', "left": ').concat(this.left," }>")}toObject(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];return l(l({},super.toObject(t)),{},{path:this.path.map((t=>t.slice()))})}toDatalessObject(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];const e=this.toObject(t);return this.sourcePath&&(delete e.path,e.sourcePath=this.sourcePath),e}_toSVG(){const t=Or(this.path,p.NUM_FRACTION_DIGITS);return["<path ","COMMON_PARTS",'d="'.concat(t,'" stroke-linecap="round" />\n')]}_getOffsetTransform(){const t=p.NUM_FRACTION_DIGITS;return" translate(".concat(Kt(-this.pathOffset.x,t),", ").concat(Kt(-this.pathOffset.y,t),")")}toClipPathSVG(t){const e=this._getOffsetTransform();return"\t"+this._createBaseClipPathSVGMarkup(this._toSVG(),{reviver:t,additionalTransform:e})}toSVG(t){const e=this._getOffsetTransform();return this._createBaseSVGMarkup(this._toSVG(),{reviver:t,additionalTransform:e})}complexity(){return this.path.length}setDimensions(){this.setBoundingBox()}setBoundingBox(t){const{width:e,height:s,pathOffset:n}=this._calcDimensions();this.set({width:e,height:s,pathOffset:n}),t&&this.setPositionByOrigin(n,F,F)}_calcBoundsFromPath(){const t=[];let e=0,s=0,n=0,i=0;for(const r of this.path)switch(r[0]){case"L":n=r[1],i=r[2],t.push({x:e,y:s},{x:n,y:i});break;case"M":n=r[1],i=r[2],e=n,s=i;break;case"C":t.push(...hr(n,i,r[1],r[2],r[3],r[4],r[5],r[6])),n=r[5],i=r[6];break;case"Q":t.push(...hr(n,i,r[1],r[2],r[1],r[2],r[3],r[4])),n=r[3],i=r[4];break;case"Z":n=e,i=s}return pe(t)}_calcDimensions(){const t=this._calcBoundsFromPath();return l(l({},t),{},{pathOffset:new gt(t.left+t.width/2,t.top+t.height/2)})}static fromObject(t){return this._fromObject(t,{extraParam:"path"})}static async fromElement(t,e,s){const n=Li(t,this.ATTRIBUTE_NAMES,s),{d:i}=n;return new this(i,l(l(l({},u(n,co)),e),{},{left:void 0,top:void 0}))}}h(lo,"type","Path"),h(lo,"cacheProperties",[...Ls,"path","fillRule"]),h(lo,"ATTRIBUTE_NAMES",[...ii,"d"]),at.setClass(lo),at.setSVGClass(lo);const uo=["left","top","radius"],go=["radius","startAngle","endAngle","counterClockwise"];class po extends Un{static getDefaults(){return l(l({},super.getDefaults()),po.ownDefaults)}constructor(t){super(),Object.assign(this,po.ownDefaults),this.setOptions(t)}_set(t,e){return super._set(t,e),"radius"===t&&this.setRadius(e),this}_render(t){t.beginPath(),t.arc(0,0,this.radius,At(this.startAngle),At(this.endAngle),this.counterClockwise),this._renderPaintInOrder(t)}getRadiusX(){return this.get("radius")*this.get(Z)}getRadiusY(){return this.get("radius")*this.get($)}setRadius(t){this.radius=t,this.set({width:2*t,height:2*t})}toObject(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];return super.toObject([...go,...t])}_toSVG(){const t=(this.endAngle-this.startAngle)%360;if(0===t)return["<circle ","COMMON_PARTS",'cx="0" cy="0" ','r="',"".concat(this.radius),'" />\n'];{const{radius:e}=this,s=At(this.startAngle),n=At(this.endAngle),i=ut(s)*e,r=dt(s)*e,o=ut(n)*e,a=dt(n)*e,h=t>180?1:0,c=this.counterClockwise?0:1;return['<path d="M '.concat(i," ").concat(r," A ").concat(e," ").concat(e," 0 ").concat(h," ").concat(c," ").concat(o," ").concat(a,'" '),"COMMON_PARTS"," />\n"]}}static async fromElement(t,e,s){const n=Li(t,this.ATTRIBUTE_NAMES,s),{left:i=0,top:r=0,radius:o=0}=n;return new this(l(l({},u(n,uo)),{},{radius:o,left:i-o,top:r-o}))}static fromObject(t){return super._fromObject(t)}}h(po,"type","Circle"),h(po,"cacheProperties",[...Ls,...go]),h(po,"ownDefaults",{radius:0,startAngle:0,endAngle:360,counterClockwise:!1}),h(po,"ATTRIBUTE_NAMES",["cx","cy","r",...ii]),at.setClass(po),at.setSVGClass(po);const fo=["x1","y1","x2","y2"],mo=["x1","y1","x2","y2"],_o=["x1","x2","y1","y2"];class vo extends Un{constructor(){let[t,e,s,n]=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[0,0,0,0],i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};super(),Object.assign(this,vo.ownDefaults),this.setOptions(i),this.x1=t,this.x2=s,this.y1=e,this.y2=n,this._setWidthHeight();const{left:r,top:o}=i;"number"==typeof r&&this.set(L,r),"number"==typeof o&&this.set(j,o)}_setWidthHeight(){const{x1:t,y1:e,x2:s,y2:n}=this;this.width=Math.abs(s-t),this.height=Math.abs(n-e);const{left:i,top:r,width:o,height:a}=pe([{x:t,y:e},{x:s,y:n}]),h=new gt(i+o/2,r+a/2);this.setPositionByOrigin(h,F,F)}_set(t,e){return super._set(t,e),_o.includes(t)&&this._setWidthHeight(),this}_render(t){t.beginPath();const e=this.calcLinePoints();t.moveTo(e.x1,e.y1),t.lineTo(e.x2,e.y2),t.lineWidth=this.strokeWidth;const s=t.strokeStyle;var n;Jt(this.stroke)?t.strokeStyle=this.stroke.toLive(t):t.strokeStyle=null!==(n=this.stroke)&&void 0!==n?n:t.fillStyle,this.stroke&&this._renderStroke(t),t.strokeStyle=s}_findCenterFromElement(){return new gt((this.x1+this.x2)/2,(this.y1+this.y2)/2)}toObject(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];return l(l({},super.toObject(t)),this.calcLinePoints())}_getNonTransformedDimensions(){const t=super._getNonTransformedDimensions();return"butt"===this.strokeLineCap&&(0===this.width&&(t.y-=this.strokeWidth),0===this.height&&(t.x-=this.strokeWidth)),t}calcLinePoints(){const{x1:t,x2:e,y1:s,y2:n,width:i,height:r}=this,o=t<=e?-1:1,a=s<=n?-1:1;return{x1:o*i/2,x2:o*-i/2,y1:a*r/2,y2:a*-r/2}}_toSVG(){const{x1:t,x2:e,y1:s,y2:n}=this.calcLinePoints();return["<line ","COMMON_PARTS",'x1="'.concat(t,'" y1="').concat(s,'" x2="').concat(e,'" y2="').concat(n,'" />\n')]}static async fromElement(t,e,s){const n=Li(t,this.ATTRIBUTE_NAMES,s),{x1:i=0,y1:r=0,x2:o=0,y2:a=0}=n;return new this([i,r,o,a],u(n,fo))}static fromObject(t){let{x1:e,y1:s,x2:n,y2:i}=t,r=u(t,mo);return this._fromObject(l(l({},r),{},{points:[e,s,n,i]}),{extraParam:"points"})}}h(vo,"type","Line"),h(vo,"cacheProperties",[...Ls,..._o]),h(vo,"ATTRIBUTE_NAMES",ii.concat(_o)),at.setClass(vo),at.setSVGClass(vo);class yo extends Un{static getDefaults(){return l(l({},super.getDefaults()),yo.ownDefaults)}constructor(t){super(),Object.assign(this,yo.ownDefaults),this.setOptions(t)}_render(t){const e=this.width/2,s=this.height/2;t.beginPath(),t.moveTo(-e,s),t.lineTo(0,-s),t.lineTo(e,s),t.closePath(),this._renderPaintInOrder(t)}_toSVG(){const t=this.width/2,e=this.height/2;return["<polygon ","COMMON_PARTS",'points="',"".concat(-t," ").concat(e,",0 ").concat(-e,",").concat(t," ").concat(e),'" />']}}h(yo,"type","Triangle"),h(yo,"ownDefaults",{width:100,height:100}),at.setClass(yo),at.setSVGClass(yo);const Co=["rx","ry"];class bo extends Un{static getDefaults(){return l(l({},super.getDefaults()),bo.ownDefaults)}constructor(t){super(),Object.assign(this,bo.ownDefaults),this.setOptions(t)}_set(t,e){switch(super._set(t,e),t){case"rx":this.rx=e,this.set("width",2*e);break;case"ry":this.ry=e,this.set("height",2*e)}return this}getRx(){return this.get("rx")*this.get(Z)}getRy(){return this.get("ry")*this.get($)}toObject(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];return super.toObject([...Co,...t])}_toSVG(){return["<ellipse ","COMMON_PARTS",'cx="0" cy="0" rx="'.concat(this.rx,'" ry="').concat(this.ry,'" />\n')]}_render(t){t.beginPath(),t.save(),t.transform(1,0,0,this.ry/this.rx,0,0),t.arc(0,0,this.rx,0,D,!1),t.restore(),this._renderPaintInOrder(t)}static async fromElement(t,e,s){const n=Li(t,this.ATTRIBUTE_NAMES,s);return n.left=(n.left||0)-n.rx,n.top=(n.top||0)-n.ry,new this(n)}}function wo(t){if(!t)return[];const e=t.replace(/,/g," ").trim().split(/\s+/),s=[];for(let n=0;n<e.length;n+=2)s.push({x:parseFloat(e[n]),y:parseFloat(e[n+1])});return s}h(bo,"type","Ellipse"),h(bo,"cacheProperties",[...Ls,...Co]),h(bo,"ownDefaults",{rx:0,ry:0}),h(bo,"ATTRIBUTE_NAMES",[...ii,"cx","cy","rx","ry"]),at.setClass(bo),at.setSVGClass(bo);const xo=["left","top"],So={exactBoundingBox:!1};class To extends Un{static getDefaults(){return l(l({},super.getDefaults()),To.ownDefaults)}constructor(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};super(),h(this,"strokeDiff",void 0),Object.assign(this,To.ownDefaults),this.setOptions(e),this.points=t;const{left:s,top:n}=e;this.initialized=!0,this.setBoundingBox(!0),"number"==typeof s&&this.set(L,s),"number"==typeof n&&this.set(j,n)}isOpen(){return!0}_projectStrokeOnPoints(t){return zn(this.points,t,this.isOpen())}_calcDimensions(t){t=l({scaleX:this.scaleX,scaleY:this.scaleY,skewX:this.skewX,skewY:this.skewY,strokeLineCap:this.strokeLineCap,strokeLineJoin:this.strokeLineJoin,strokeMiterLimit:this.strokeMiterLimit,strokeUniform:this.strokeUniform,strokeWidth:this.strokeWidth},t||{});const e=this.exactBoundingBox?this._projectStrokeOnPoints(t).map((t=>t.projectedPoint)):this.points;if(0===e.length)return{left:0,top:0,width:0,height:0,pathOffset:new gt,strokeOffset:new gt,strokeDiff:new gt};const s=pe(e),n=Yt(l(l({},t),{},{scaleX:1,scaleY:1})),i=pe(this.points.map((t=>Dt(t,n,!0)))),r=new gt(this.scaleX,this.scaleY);let o=s.left+s.width/2,a=s.top+s.height/2;return this.exactBoundingBox&&(o-=a*Math.tan(At(this.skewX)),a-=o*Math.tan(At(this.skewY))),l(l({},s),{},{pathOffset:new gt(o,a),strokeOffset:new gt(i.left,i.top).subtract(new gt(s.left,s.top)).multiply(r),strokeDiff:new gt(s.width,s.height).subtract(new gt(i.width,i.height)).multiply(r)})}_findCenterFromElement(){const t=pe(this.points);return new gt(t.left+t.width/2,t.top+t.height/2)}setDimensions(){this.setBoundingBox()}setBoundingBox(t){const{left:e,top:s,width:n,height:i,pathOffset:r,strokeOffset:o,strokeDiff:a}=this._calcDimensions();this.set({width:n,height:i,pathOffset:r,strokeOffset:o,strokeDiff:a}),t&&this.setPositionByOrigin(new gt(e+n/2,s+i/2),F,F)}isStrokeAccountedForInDimensions(){return this.exactBoundingBox}_getNonTransformedDimensions(){return this.exactBoundingBox?new gt(this.width,this.height):super._getNonTransformedDimensions()}_getTransformedDimensions(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};if(this.exactBoundingBox){let r;if(Object.keys(t).some((t=>this.strokeUniform||this.constructor.layoutProperties.includes(t)))){var e,s;const{width:n,height:i}=this._calcDimensions(t);r=new gt(null!==(e=t.width)&&void 0!==e?e:n,null!==(s=t.height)&&void 0!==s?s:i)}else{var n,i;r=new gt(null!==(n=t.width)&&void 0!==n?n:this.width,null!==(i=t.height)&&void 0!==i?i:this.height)}return r.multiply(new gt(t.scaleX||this.scaleX,t.scaleY||this.scaleY))}return super._getTransformedDimensions(t)}_set(t,e){const s=this.initialized&&this[t]!==e,n=super._set(t,e);return this.exactBoundingBox&&s&&((t===Z||t===$)&&this.strokeUniform&&this.constructor.layoutProperties.includes("strokeUniform")||this.constructor.layoutProperties.includes(t))&&this.setDimensions(),n}toObject(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];return l(l({},super.toObject(t)),{},{points:this.points.map((t=>{let{x:e,y:s}=t;return{x:e,y:s}}))})}_toSVG(){const t=[],e=this.pathOffset.x,s=this.pathOffset.y,n=p.NUM_FRACTION_DIGITS;for(let i=0,r=this.points.length;i<r;i++)t.push(Kt(this.points[i].x-e,n),",",Kt(this.points[i].y-s,n)," ");return["<".concat(this.constructor.type.toLowerCase()," "),"COMMON_PARTS",'points="'.concat(t.join(""),'" />\n')]}_render(t){const e=this.points.length,s=this.pathOffset.x,n=this.pathOffset.y;if(e&&!isNaN(this.points[e-1].y)){t.beginPath(),t.moveTo(this.points[0].x-s,this.points[0].y-n);for(let i=0;i<e;i++){const e=this.points[i];t.lineTo(e.x-s,e.y-n)}!this.isOpen()&&t.closePath(),this._renderPaintInOrder(t)}}complexity(){return this.points.length}static async fromElement(t,e,s){return new this(wo(t.getAttribute("points")),l(l({},u(Li(t,this.ATTRIBUTE_NAMES,s),xo)),e))}static fromObject(t){return this._fromObject(t,{extraParam:"points"})}}h(To,"ownDefaults",So),h(To,"type","Polyline"),h(To,"layoutProperties",[tt,et,"strokeLineCap","strokeLineJoin","strokeMiterLimit","strokeWidth","strokeUniform","points"]),h(To,"cacheProperties",[...Ls,"points"]),h(To,"ATTRIBUTE_NAMES",[...ii]),at.setClass(To),at.setSVGClass(To);class ko extends To{isOpen(){return!1}}h(ko,"ownDefaults",So),h(ko,"type","Polygon"),at.setClass(ko),at.setSVGClass(ko);class Ao extends Un{isEmptyStyles(t){if(!this.styles)return!0;if(void 0!==t&&!this.styles[t])return!0;const e=void 0===t?this.styles:{line:this.styles[t]};for(const s in e)for(const t in e[s])for(const n in e[s][t])return!1;return!0}styleHas(t,e){if(!this.styles)return!1;if(void 0!==e&&!this.styles[e])return!1;const s=void 0===e?this.styles:{0:this.styles[e]};for(const n in s)for(const e in s[n])if(void 0!==s[n][e][t])return!0;return!1}cleanStyle(t){if(!this.styles)return!1;const e=this.styles;let s,n,i=0,r=!0,o=0;for(const a in e){s=0;for(const o in e[a]){const h=e[a][o]||{};i++,void 0!==h[t]?(n?h[t]!==n&&(r=!1):n=h[t],h[t]===this[t]&&delete h[t]):r=!1,0!==Object.keys(h).length?s++:delete e[a][o]}0===s&&delete e[a]}for(let a=0;a<this._textLines.length;a++)o+=this._textLines[a].length;r&&i===o&&(this[t]=n,this.removeStyle(t))}removeStyle(t){if(!this.styles)return;const e=this.styles;let s,n,i;for(n in e){for(i in s=e[n],s)delete s[i][t],0===Object.keys(s[i]).length&&delete s[i];0===Object.keys(s).length&&delete e[n]}}_extendStyles(t,e){const{lineIndex:s,charIndex:n}=this.get2DCursorLocation(t);this._getLineStyle(s)||this._setLineStyle(s);const i=qt(l(l({},this._getStyleDeclaration(s,n)),e),(t=>void 0!==t));this._setStyleDeclaration(s,n,i)}getSelectionStyles(t,e,s){const n=[];for(let i=t;i<(e||t);i++)n.push(this.getStyleAtPosition(i,s));return n}getStyleAtPosition(t,e){const{lineIndex:s,charIndex:n}=this.get2DCursorLocation(t);return e?this.getCompleteStyleDeclaration(s,n):this._getStyleDeclaration(s,n)}setSelectionStyles(t,e,s){for(let n=e;n<(s||e);n++)this._extendStyles(n,t);this._forceClearCache=!0}_getStyleDeclaration(t,e){var s;const n=this.styles&&this.styles[t];return n&&null!==(s=n[e])&&void 0!==s?s:{}}getCompleteStyleDeclaration(t,e){return l(l({},zt(this,this.constructor._styleProperties)),this._getStyleDeclaration(t,e))}_setStyleDeclaration(t,e,s){this.styles[t][e]=s}_deleteStyleDeclaration(t,e){delete this.styles[t][e]}_getLineStyle(t){return!!this.styles[t]}_setLineStyle(t){this.styles[t]={}}_deleteLineStyle(t){delete this.styles[t]}}h(Ao,"_styleProperties",$e);const Eo=/  +/g,Oo=/"/g;function Do(t,e,s,n,i){return"\t\t".concat(function(t,e){let{left:s,top:n,width:i,height:r}=e,o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:p.NUM_FRACTION_DIGITS;const a=Ge(st,t,!1),[h,c,l,u]=[s,n,i,r].map((t=>Kt(t,o)));return"<rect ".concat(a,' x="').concat(h,'" y="').concat(c,'" width="').concat(l,'" height="').concat(u,'"></rect>')}(t,{left:e,top:s,width:n,height:i}),"\n")}const Po=["textAnchor","textDecoration","dx","dy","top","left","fontSize","strokeWidth"];let Io;class Mo extends Ao{static getDefaults(){return l(l({},super.getDefaults()),Mo.ownDefaults)}constructor(t,e){super(),h(this,"__charBounds",[]),Object.assign(this,Mo.ownDefaults),this.setOptions(e),this.styles||(this.styles={}),this.text=t,this.initialized=!0,this.path&&this.setPathInfo(),this.initDimensions(),this.setCoords()}setPathInfo(){const t=this.path;t&&(t.segmentsInfo=br(t.path))}_splitText(){const t=this._splitTextIntoLines(this.text);return this.textLines=t.lines,this._textLines=t.graphemeLines,this._unwrappedTextLines=t._unwrappedLines,this._text=t.graphemeText,t}initDimensions(){this._splitText(),this._clearCache(),this.dirty=!0,this.path?(this.width=this.path.width,this.height=this.path.height):(this.width=this.calcTextWidth()||this.cursorWidth||this.MIN_TEXT_WIDTH,this.height=this.calcTextHeight()),this.textAlign.includes(es)&&this.enlargeSpaces()}enlargeSpaces(){let t,e,s,n,i,r,o;for(let a=0,h=this._textLines.length;a<h;a++)if((this.textAlign===es||a!==h-1&&!this.isEndOfWrapping(a))&&(n=0,i=this._textLines[a],e=this.getLineWidth(a),e<this.width&&(o=this.textLines[a].match(this._reSpacesAndTabs)))){s=o.length,t=(this.width-e)/s;for(let e=0;e<=i.length;e++)r=this.__charBounds[a][e],this._reSpaceAndTab.test(i[e])?(r.width+=t,r.kernedWidth+=t,r.left+=n,n+=t):r.left+=n}}isEndOfWrapping(t){return t===this._textLines.length-1}missingNewlineOffset(t){return 1}get2DCursorLocation(t,e){const s=e?this._unwrappedTextLines:this._textLines;let n;for(n=0;n<s.length;n++){if(t<=s[n].length)return{lineIndex:n,charIndex:t};t-=s[n].length+this.missingNewlineOffset(n,e)}return{lineIndex:n-1,charIndex:s[n-1].length<t?s[n-1].length:t}}toString(){return"#<Text (".concat(this.complexity(),'): { "text": "').concat(this.text,'", "fontFamily": "').concat(this.fontFamily,'" }>')}_getCacheCanvasDimensions(){const t=super._getCacheCanvasDimensions(),e=this.fontSize;return t.width+=e*t.zoomX,t.height+=e*t.zoomY,t}_render(t){const e=this.path;e&&!e.isNotVisible()&&e._render(t),this._setTextStyles(t),this._renderTextLinesBackground(t),this._renderTextDecoration(t,"underline"),this._renderText(t),this._renderTextDecoration(t,"overline"),this._renderTextDecoration(t,"linethrough")}_renderText(t){this.paintFirst===nt?(this._renderTextStroke(t),this._renderTextFill(t)):(this._renderTextFill(t),this._renderTextStroke(t))}_setTextStyles(t,e,s){if(t.textBaseline="alphabetic",this.path)switch(this.pathAlign){case F:t.textBaseline="middle";break;case"ascender":t.textBaseline=j;break;case"descender":t.textBaseline=N}t.font=this._getFontDeclaration(e,s)}calcTextWidth(){let t=this.getLineWidth(0);for(let e=1,s=this._textLines.length;e<s;e++){const s=this.getLineWidth(e);s>t&&(t=s)}return t}_renderTextLine(t,e,s,n,i,r){this._renderChars(t,e,s,n,i,r)}_renderTextLinesBackground(t){if(!this.textBackgroundColor&&!this.styleHas("textBackgroundColor"))return;const e=t.fillStyle,s=this._getLeftOffset();let n=this._getTopOffset();for(let i=0,r=this._textLines.length;i<r;i++){const e=this.getHeightOfLine(i);if(!this.textBackgroundColor&&!this.styleHas("textBackgroundColor",i)){n+=e;continue}const r=this._textLines[i].length,o=this._getLineLeftOffset(i);let a,h,c=0,l=0,u=this.getValueOfPropertyAt(i,0,"textBackgroundColor");for(let d=0;d<r;d++){const r=this.__charBounds[i][d];h=this.getValueOfPropertyAt(i,d,"textBackgroundColor"),this.path?(t.save(),t.translate(r.renderLeft,r.renderTop),t.rotate(r.angle),t.fillStyle=h,h&&t.fillRect(-r.width/2,-e/this.lineHeight*(1-this._fontSizeFraction),r.width,e/this.lineHeight),t.restore()):h!==u?(a=s+o+l,"rtl"===this.direction&&(a=this.width-a-c),t.fillStyle=u,u&&t.fillRect(a,n,c,e/this.lineHeight),l=r.left,c=r.width,u=h):c+=r.kernedWidth}h&&!this.path&&(a=s+o+l,"rtl"===this.direction&&(a=this.width-a-c),t.fillStyle=h,t.fillRect(a,n,c,e/this.lineHeight)),n+=e}t.fillStyle=e,this._removeShadow(t)}_measureChar(t,e,s,n){const i=k.getFontCache(e),r=this._getFontDeclaration(e),o=s+t,a=s&&r===this._getFontDeclaration(n),h=e.fontSize/this.CACHE_FONT_SIZE;let c,l,u,d;if(s&&void 0!==i[s]&&(u=i[s]),void 0!==i[t]&&(d=c=i[t]),a&&void 0!==i[o]&&(l=i[o],d=l-u),void 0===c||void 0===u||void 0===l){const n=function(){if(!Io){const t=St({width:0,height:0});Io=t.getContext("2d")}return Io}();this._setTextStyles(n,e,!0),void 0===c&&(d=c=n.measureText(t).width,i[t]=c),void 0===u&&a&&s&&(u=n.measureText(s).width,i[s]=u),a&&void 0===l&&(l=n.measureText(o).width,i[o]=l,d=l-u)}return{width:c*h,kernedWidth:d*h}}getHeightOfChar(t,e){return this.getValueOfPropertyAt(t,e,"fontSize")}measureLine(t){const e=this._measureLine(t);return 0!==this.charSpacing&&(e.width-=this._getWidthOfCharSpacing()),e.width<0&&(e.width=0),e}_measureLine(t){let e,s,n=0;const i=this.pathSide===B,r=this.path,o=this._textLines[t],a=o.length,h=new Array(a);this.__charBounds[t]=h;for(let c=0;c<a;c++){const i=o[c];s=this._getGraphemeBox(i,t,c,e),h[c]=s,n+=s.kernedWidth,e=i}if(h[a]={left:s?s.left+s.width:0,width:0,kernedWidth:0,height:this.fontSize,deltaY:0},r&&r.segmentsInfo){let t=0;const e=r.segmentsInfo[r.segmentsInfo.length-1].length;switch(this.textAlign){case L:t=i?e-n:0;break;case F:t=(e-n)/2;break;case B:t=i?0:e-n}t+=this.pathStartOffset*(i?-1:1);for(let n=i?a-1:0;i?n>=0:n<a;i?n--:n++)s=h[n],t>e?t%=e:t<0&&(t+=e),this._setGraphemeOnPath(t,s),t+=s.kernedWidth}return{width:n,numOfSpaces:0}}_setGraphemeOnPath(t,e){const s=t+e.kernedWidth/2,n=this.path,i=wr(n.path,s,n.segmentsInfo);e.renderLeft=i.x-n.pathOffset.x,e.renderTop=i.y-n.pathOffset.y,e.angle=i.angle+(this.pathSide===B?Math.PI:0)}_getGraphemeBox(t,e,s,n,i){const r=this.getCompleteStyleDeclaration(e,s),o=n?this.getCompleteStyleDeclaration(e,s-1):{},a=this._measureChar(t,r,n,o);let h,c=a.kernedWidth,l=a.width;0!==this.charSpacing&&(h=this._getWidthOfCharSpacing(),l+=h,c+=h);const u={width:l,left:0,height:r.fontSize,kernedWidth:c,deltaY:r.deltaY};if(s>0&&!i){const t=this.__charBounds[e][s-1];u.left=t.left+t.width+a.kernedWidth-a.width}return u}getHeightOfLine(t){if(this.__lineHeights[t])return this.__lineHeights[t];let e=this.getHeightOfChar(t,0);for(let s=1,n=this._textLines[t].length;s<n;s++)e=Math.max(this.getHeightOfChar(t,s),e);return this.__lineHeights[t]=e*this.lineHeight*this._fontSizeMult}calcTextHeight(){let t,e=0;for(let s=0,n=this._textLines.length;s<n;s++)t=this.getHeightOfLine(s),e+=s===n-1?t/this.lineHeight:t;return e}_getLeftOffset(){return"ltr"===this.direction?-this.width/2:this.width/2}_getTopOffset(){return-this.height/2}_renderTextCommon(t,e){t.save();let s=0;const n=this._getLeftOffset(),i=this._getTopOffset();for(let r=0,o=this._textLines.length;r<o;r++){const o=this.getHeightOfLine(r),a=o/this.lineHeight,h=this._getLineLeftOffset(r);this._renderTextLine(e,t,this._textLines[r],n+h,i+s+a,r),s+=o}t.restore()}_renderTextFill(t){(this.fill||this.styleHas(st))&&this._renderTextCommon(t,"fillText")}_renderTextStroke(t){(this.stroke&&0!==this.strokeWidth||!this.isEmptyStyles())&&(this.shadow&&!this.shadow.affectStroke&&this._removeShadow(t),t.save(),this._setLineDash(t,this.strokeDashArray),t.beginPath(),this._renderTextCommon(t,"strokeText"),t.closePath(),t.restore())}_renderChars(t,e,s,n,i,r){const o=this.getHeightOfLine(r),a=this.textAlign.includes(es),h=this.path,c=!a&&0===this.charSpacing&&this.isEmptyStyles(r)&&!h,l="ltr"===this.direction,u="ltr"===this.direction?1:-1,d=e.direction;let g,p,f,m,_,v="",y=0;if(e.save(),d!==this.direction&&(e.canvas.setAttribute("dir",l?"ltr":"rtl"),e.direction=l?"ltr":"rtl",e.textAlign=l?L:B),i-=o*this._fontSizeFraction/this.lineHeight,c)return this._renderChar(t,e,r,0,s.join(""),n,i),void e.restore();for(let C=0,b=s.length-1;C<=b;C++)m=C===b||this.charSpacing||h,v+=s[C],f=this.__charBounds[r][C],0===y?(n+=u*(f.kernedWidth-f.width),y+=f.width):y+=f.kernedWidth,a&&!m&&this._reSpaceAndTab.test(s[C])&&(m=!0),m||(g=g||this.getCompleteStyleDeclaration(r,C),p=this.getCompleteStyleDeclaration(r,C+1),m=ei(g,p,!1)),m&&(h?(e.save(),e.translate(f.renderLeft,f.renderTop),e.rotate(f.angle),this._renderChar(t,e,r,C,v,-y/2,0),e.restore()):(_=n,this._renderChar(t,e,r,C,v,_,i)),v="",g=p,n+=u*y,y=0);e.restore()}_applyPatternGradientTransformText(t){const e=this.width+this.strokeWidth,s=this.height+this.strokeWidth,n=St({width:e,height:s}),i=n.getContext("2d");return n.width=e,n.height=s,i.beginPath(),i.moveTo(0,0),i.lineTo(e,0),i.lineTo(e,s),i.lineTo(0,s),i.closePath(),i.translate(e/2,s/2),i.fillStyle=t.toLive(i),this._applyPatternGradientTransform(i,t),i.fill(),i.createPattern(n,"no-repeat")}handleFiller(t,e,s){let n,i;return Jt(s)?"percentage"===s.gradientUnits||s.gradientTransform||s.patternTransform?(n=-this.width/2,i=-this.height/2,t.translate(n,i),t[e]=this._applyPatternGradientTransformText(s),{offsetX:n,offsetY:i}):(t[e]=s.toLive(t),this._applyPatternGradientTransform(t,s)):(t[e]=s,{offsetX:0,offsetY:0})}_setStrokeStyles(t,e){let{stroke:s,strokeWidth:n}=e;return t.lineWidth=n,t.lineCap=this.strokeLineCap,t.lineDashOffset=this.strokeDashOffset,t.lineJoin=this.strokeLineJoin,t.miterLimit=this.strokeMiterLimit,this.handleFiller(t,"strokeStyle",s)}_setFillStyles(t,e){let{fill:s}=e;return this.handleFiller(t,"fillStyle",s)}_renderChar(t,e,s,n,i,r,o){const a=this._getStyleDeclaration(s,n),h=this.getCompleteStyleDeclaration(s,n),c="fillText"===t&&h.fill,l="strokeText"===t&&h.stroke&&h.strokeWidth;if(l||c){if(e.save(),e.font=this._getFontDeclaration(h),a.textBackgroundColor&&this._removeShadow(e),a.deltaY&&(o+=a.deltaY),c){const t=this._setFillStyles(e,h);e.fillText(i,r-t.offsetX,o-t.offsetY)}if(l){const t=this._setStrokeStyles(e,h);e.strokeText(i,r-t.offsetX,o-t.offsetY)}e.restore()}}setSuperscript(t,e){this._setScript(t,e,this.superscript)}setSubscript(t,e){this._setScript(t,e,this.subscript)}_setScript(t,e,s){const n=this.get2DCursorLocation(t,!0),i=this.getValueOfPropertyAt(n.lineIndex,n.charIndex,"fontSize"),r=this.getValueOfPropertyAt(n.lineIndex,n.charIndex,"deltaY"),o={fontSize:i*s.size,deltaY:r+i*s.baseline};this.setSelectionStyles(o,t,e)}_getLineLeftOffset(t){const e=this.getLineWidth(t),s=this.width-e,n=this.textAlign,i=this.direction,r=this.isEndOfWrapping(t);let o=0;return n===es||n===is&&!r||n===ns&&!r||n===ss&&!r?0:(n===F&&(o=s/2),n===B&&(o=s),n===is&&(o=s/2),n===ns&&(o=s),"rtl"===i&&(n===B||n===es||n===ns?o=0:n===L||n===ss?o=-s:n!==F&&n!==is||(o=-s/2)),o)}_clearCache(){this._forceClearCache=!1,this.__lineWidths=[],this.__lineHeights=[],this.__charBounds=[]}getLineWidth(t){if(void 0!==this.__lineWidths[t])return this.__lineWidths[t];const{width:e}=this.measureLine(t);return this.__lineWidths[t]=e,e}_getWidthOfCharSpacing(){return 0!==this.charSpacing?this.fontSize*this.charSpacing/1e3:0}getValueOfPropertyAt(t,e,s){var n;return null!==(n=this._getStyleDeclaration(t,e)[s])&&void 0!==n?n:this[s]}_renderTextDecoration(t,e){if(!this[e]&&!this.styleHas(e))return;let s=this._getTopOffset();const n=this._getLeftOffset(),i=this.path,r=this._getWidthOfCharSpacing(),o="linethrough"===e?.5:"overline"===e?1:0,a=this.offsets[e];for(let h=0,c=this._textLines.length;h<c;h++){const c=this.getHeightOfLine(h);if(!this[e]&&!this.styleHas(e,h)){s+=c;continue}const l=this._textLines[h],u=c/this.lineHeight,d=this._getLineLeftOffset(h);let g=0,p=0,f=this.getValueOfPropertyAt(h,0,e),m=this.getValueOfPropertyAt(h,0,st),_=this.getValueOfPropertyAt(h,0,qe),v=f,y=m,C=_;const b=s+u*(1-this._fontSizeFraction);let w=this.getHeightOfChar(h,0),x=this.getValueOfPropertyAt(h,0,"deltaY");for(let s=0,r=l.length;s<r;s++){const r=this.__charBounds[h][s];v=this.getValueOfPropertyAt(h,s,e),y=this.getValueOfPropertyAt(h,s,st),C=this.getValueOfPropertyAt(h,s,qe);const c=this.getHeightOfChar(h,s),l=this.getValueOfPropertyAt(h,s,"deltaY");if(i&&v&&y){const e=this.fontSize*C/1e3;t.save(),t.fillStyle=m,t.translate(r.renderLeft,r.renderTop),t.rotate(r.angle),t.fillRect(-r.kernedWidth/2,a*c+l-o*e,r.kernedWidth,e),t.restore()}else if((v!==f||y!==m||c!==w||C!==_||l!==x)&&p>0){const e=this.fontSize*_/1e3;let s=n+d+g;"rtl"===this.direction&&(s=this.width-s-p),f&&m&&_&&(t.fillStyle=m,t.fillRect(s,b+a*w+x-o*e,p,e)),g=r.left,p=r.width,f=v,_=C,m=y,w=c,x=l}else p+=r.kernedWidth}let S=n+d+g;"rtl"===this.direction&&(S=this.width-S-p),t.fillStyle=y;const T=this.fontSize*C/1e3;v&&y&&C&&t.fillRect(S,b+a*w+x-o*T,p-r,T),s+=c}this._removeShadow(t)}_getFontDeclaration(){let{fontFamily:t=this.fontFamily,fontStyle:e=this.fontStyle,fontWeight:s=this.fontWeight,fontSize:n=this.fontSize}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},i=arguments.length>1?arguments[1]:void 0;const r=t.includes("'")||t.includes('"')||t.includes(",")||Mo.genericFonts.includes(t.toLowerCase())?t:'"'.concat(t,'"');return[e,s,"".concat(i?this.CACHE_FONT_SIZE:n,"px"),r].join(" ")}render(t){this.visible&&(this.canvas&&this.canvas.skipOffscreen&&!this.group&&!this.isOnScreen()||(this._forceClearCache&&this.initDimensions(),super.render(t)))}graphemeSplit(t){return Jn(t)}_splitTextIntoLines(t){const e=t.split(this._reNewline),s=new Array(e.length),n=["\n"];let i=[];for(let r=0;r<e.length;r++)s[r]=this.graphemeSplit(e[r]),i=i.concat(s[r],n);return i.pop(),{_unwrappedLines:s,lines:e,graphemeText:i,graphemeLines:s}}toObject(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];return l(l({},super.toObject([...Ze,...t])),{},{styles:si(this.styles,this.text)},this.path?{path:this.path.toObject()}:{})}set(t,e){const{textLayoutProperties:s}=this.constructor;super.set(t,e);let n=!1,i=!1;if("object"==typeof t)for(const r in t)"path"===r&&this.setPathInfo(),n=n||s.includes(r),i=i||"path"===r;else n=s.includes(t),i="path"===t;return i&&this.setPathInfo(),n&&this.initialized&&(this.initDimensions(),this.setCoords()),this}complexity(){return 1}static async fromElement(t,e,s){const n=Li(t,Mo.ATTRIBUTE_NAMES,s),i=l(l({},e),n),{textAnchor:r=L,textDecoration:o="",dx:a=0,dy:h=0,top:c=0,left:d=0,fontSize:g=M,strokeWidth:p=1}=i,f=u(i,Po),m=new this((t.textContent||"").replace(/^\s+|\s+$|\n+/g,"").replace(/\s+/g," "),l({left:d+a,top:c+h,underline:o.includes("underline"),overline:o.includes("overline"),linethrough:o.includes("line-through"),strokeWidth:0,fontSize:g},f)),_=m.getScaledHeight()/m.height,v=((m.height+m.strokeWidth)*m.lineHeight-m.height)*_,y=m.getScaledHeight()+v;let C=0;return r===F&&(C=m.getScaledWidth()/2),r===B&&(C=m.getScaledWidth()),m.set({left:m.left-C,top:m.top-(y-m.fontSize*(.07+m._fontSizeFraction))/m.lineHeight,strokeWidth:p}),m}static fromObject(t){return this._fromObject(l(l({},t),{},{styles:ni(t.styles||{},t.text)}),{extraParam:"text"})}}h(Mo,"textLayoutProperties",Je),h(Mo,"cacheProperties",[...Ls,...Ze]),h(Mo,"ownDefaults",ts),h(Mo,"type","Text"),h(Mo,"genericFonts",["serif","sans-serif","monospace","cursive","fantasy","system-ui","ui-serif","ui-sans-serif","ui-monospace","ui-rounded","math","emoji","fangsong"]),h(Mo,"ATTRIBUTE_NAMES",ii.concat("x","y","dx","dy","font-family","font-style","font-weight","font-size","letter-spacing","text-decoration","text-anchor")),Wn(Mo,[class extends He{_toSVG(){const t=this._getSVGLeftTopOffsets(),e=this._getSVGTextAndBg(t.textTop,t.textLeft);return this._wrapSVGTextAndBg(e)}toSVG(t){const e=this._createBaseSVGMarkup(this._toSVG(),{reviver:t,noStyle:!0,withShadow:!0}),s=this.path;return s?e+s._createBaseSVGMarkup(s._toSVG(),{reviver:t,withShadow:!0,additionalTransform:Qt(this.calcOwnMatrix())}):e}_getSVGLeftTopOffsets(){return{textLeft:-this.width/2,textTop:-this.height/2,lineTop:this.getHeightOfLine(0)}}_wrapSVGTextAndBg(t){let{textBgRects:e,textSpans:s}=t;const n=this.getSvgTextDecoration(this);return[e.join(""),'\t\t<text xml:space="preserve" ','font-family="'.concat(this.fontFamily.replace(Oo,"'"),'" '),'font-size="'.concat(this.fontSize,'" '),this.fontStyle?'font-style="'.concat(this.fontStyle,'" '):"",this.fontWeight?'font-weight="'.concat(this.fontWeight,'" '):"",n?'text-decoration="'.concat(n,'" '):"","rtl"===this.direction?'direction="'.concat(this.direction,'" '):"",'style="',this.getSvgStyles(!0),'"',this.addPaintOrder()," >",s.join(""),"</text>\n"]}_getSVGTextAndBg(t,e){const s=[],n=[];let i,r=t;this.backgroundColor&&n.push(...Do(this.backgroundColor,-this.width/2,-this.height/2,this.width,this.height));for(let o=0,a=this._textLines.length;o<a;o++)i=this._getLineLeftOffset(o),"rtl"===this.direction&&(i+=this.width),(this.textBackgroundColor||this.styleHas("textBackgroundColor",o))&&this._setSVGTextLineBg(n,o,e+i,r),this._setSVGTextLineText(s,o,e+i,r),r+=this.getHeightOfLine(o);return{textSpans:s,textBgRects:n}}_createTextCharSpan(t,e,s,n,i){const r=p.NUM_FRACTION_DIGITS,o=this.getSvgSpanStyles(e,t!==t.trim()||!!t.match(Eo)),a=o?'style="'.concat(o,'"'):"",h=e.deltaY,c=h?' dy="'.concat(Kt(h,r),'" '):"",{angle:l,renderLeft:u,renderTop:d,width:g}=i;let f="";if(void 0!==u){const t=g/2;l&&(f=' rotate="'.concat(Kt(Et(l),r),'"'));const e=jt({angle:Et(l)});e[4]=u,e[5]=d;const i=new gt(-t,0).transform(e);s=i.x,n=i.y}return'<tspan x="'.concat(Kt(s,r),'" y="').concat(Kt(n,r),'" ').concat(c).concat(f).concat(a,">").concat(Kn(t),"</tspan>")}_setSVGTextLineText(t,e,s,n){const i=this.getHeightOfLine(e),r=this.textAlign.includes(es),o=this._textLines[e];let a,h,c,l,u,d="",g=0;n+=i*(1-this._fontSizeFraction)/this.lineHeight;for(let p=0,f=o.length-1;p<=f;p++)u=p===f||this.charSpacing||this.path,d+=o[p],c=this.__charBounds[e][p],0===g?(s+=c.kernedWidth-c.width,g+=c.width):g+=c.kernedWidth,r&&!u&&this._reSpaceAndTab.test(o[p])&&(u=!0),u||(a=a||this.getCompleteStyleDeclaration(e,p),h=this.getCompleteStyleDeclaration(e,p+1),u=ei(a,h,!0)),u&&(l=this._getStyleDeclaration(e,p),t.push(this._createTextCharSpan(d,l,s,n,c)),d="",a=h,"rtl"===this.direction?s-=g:s+=g,g=0)}_setSVGTextLineBg(t,e,s,n){const i=this._textLines[e],r=this.getHeightOfLine(e)/this.lineHeight;let o,a=0,h=0,c=this.getValueOfPropertyAt(e,0,"textBackgroundColor");for(let l=0;l<i.length;l++){const{left:i,width:u,kernedWidth:d}=this.__charBounds[e][l];o=this.getValueOfPropertyAt(e,l,"textBackgroundColor"),o!==c?(c&&t.push(...Do(c,s+h,n,a,r)),h=i,a=u,c=o):a+=d}o&&t.push(...Do(c,s+h,n,a,r))}_getSVGLineTopOffset(t){let e,s=0;for(e=0;e<t;e++)s+=this.getHeightOfLine(e);const n=this.getHeightOfLine(e);return{lineTop:s,offset:(this._fontSizeMult-this._fontSizeFraction)*n/(this.lineHeight*this._fontSizeMult)}}getSvgStyles(t){return"".concat(super.getSvgStyles(t)," text-decoration-thickness: ").concat(Kt(this.textDecorationThickness*this.getObjectScaling().y/10,p.NUM_FRACTION_DIGITS),"%; white-space: pre;")}getSvgSpanStyles(t,e){const{fontFamily:s,strokeWidth:n,stroke:i,fill:r,fontSize:o,fontStyle:a,fontWeight:h,deltaY:c,textDecorationThickness:l,linethrough:u,overline:d,underline:g}=t,f=this.getSvgTextDecoration({underline:null!=g?g:this.underline,overline:null!=d?d:this.overline,linethrough:null!=u?u:this.linethrough}),m=l||this.textDecorationThickness;return[i?Ge(nt,i):"",n?"stroke-width: ".concat(n,"; "):"",s?"font-family: ".concat(s.includes("'")||s.includes('"')?s:"'".concat(s,"'"),"; "):"",o?"font-size: ".concat(o,"px; "):"",a?"font-style: ".concat(a,"; "):"",h?"font-weight: ".concat(h,"; "):"",f?"text-decoration: ".concat(f,"; text-decoration-thickness: ").concat(Kt(m*this.getObjectScaling().y/10,p.NUM_FRACTION_DIGITS),"%; "):"",r?Ge(st,r):"",c?"baseline-shift: ".concat(-c,"; "):"",e?"white-space: pre; ":""].join("")}getSvgTextDecoration(t){return["overline","underline","line-through"].filter((e=>t[e.replace("-","")])).join(" ")}}]),at.setClass(Mo),at.setSVGClass(Mo);class Ro{constructor(t){h(this,"target",void 0),h(this,"__mouseDownInPlace",!1),h(this,"__dragStartFired",!1),h(this,"__isDraggingOver",!1),h(this,"__dragStartSelection",void 0),h(this,"__dragImageDisposer",void 0),h(this,"_dispose",void 0),this.target=t;const e=[this.target.on("dragenter",this.dragEnterHandler.bind(this)),this.target.on("dragover",this.dragOverHandler.bind(this)),this.target.on("dragleave",this.dragLeaveHandler.bind(this)),this.target.on("dragend",this.dragEndHandler.bind(this)),this.target.on("drop",this.dropHandler.bind(this))];this._dispose=()=>{e.forEach((t=>t())),this._dispose=void 0}}isPointerOverSelection(t){const e=this.target,s=e.getSelectionStartFromPointer(t);return e.isEditing&&s>=e.selectionStart&&s<=e.selectionEnd&&e.selectionStart<e.selectionEnd}start(t){return this.__mouseDownInPlace=this.isPointerOverSelection(t)}isActive(){return this.__mouseDownInPlace}end(t){const e=this.isActive();return e&&!this.__dragStartFired&&(this.target.setCursorByClick(t),this.target.initDelayedCursor(!0)),this.__mouseDownInPlace=!1,this.__dragStartFired=!1,this.__isDraggingOver=!1,e}getDragStartSelection(){return this.__dragStartSelection}setDragImage(t,e){var s;let{selectionStart:n,selectionEnd:i}=e;const r=this.target,o=r.canvas,a=new gt(r.flipX?-1:1,r.flipY?-1:1),h=r._getCursorBoundaries(n),c=new gt(h.left+h.leftOffset,h.top+h.topOffset).multiply(a).transform(r.calcTransformMatrix()),l=o.getScenePoint(t).subtract(c),u=r.getCanvasRetinaScaling(),d=r.getBoundingRect(),g=c.subtract(new gt(d.left,d.top)),p=o.viewportTransform,f=g.add(l).transform(p,!0),m=r.backgroundColor,_=qn(r.styles);r.backgroundColor="";const v={stroke:"transparent",fill:"transparent",textBackgroundColor:"transparent"};r.setSelectionStyles(v,0,n),r.setSelectionStyles(v,i,r.text.length),r.dirty=!0;const y=r.toCanvasElement({enableRetinaScaling:o.enableRetinaScaling,viewportTransform:!0});r.backgroundColor=m,r.styles=_,r.dirty=!0,Dr(y,{position:"fixed",left:"".concat(-y.width,"px"),border:W,width:"".concat(y.width/u,"px"),height:"".concat(y.height/u,"px")}),this.__dragImageDisposer&&this.__dragImageDisposer(),this.__dragImageDisposer=()=>{y.remove()},se(t.target||this.target.hiddenTextarea).body.appendChild(y),null===(s=t.dataTransfer)||void 0===s||s.setDragImage(y,f.x,f.y)}onDragStart(t){this.__dragStartFired=!0;const e=this.target,s=this.isActive();if(s&&t.dataTransfer){const s=this.__dragStartSelection={selectionStart:e.selectionStart,selectionEnd:e.selectionEnd},n=e._text.slice(s.selectionStart,s.selectionEnd).join(""),i=l({text:e.text,value:n},s);t.dataTransfer.setData("text/plain",n),t.dataTransfer.setData("application/fabric",JSON.stringify({value:n,styles:e.getSelectionStyles(s.selectionStart,s.selectionEnd,!0)})),t.dataTransfer.effectAllowed="copyMove",this.setDragImage(t,i)}return e.abortCursorAnimation(),s}canDrop(t){if(this.target.editable&&!this.target.getActiveControl()&&!t.defaultPrevented){if(this.isActive()&&this.__dragStartSelection){const e=this.target.getSelectionStartFromPointer(t),s=this.__dragStartSelection;return e<s.selectionStart||e>s.selectionEnd}return!0}return!1}targetCanDrop(t){return this.target.canDrop(t)}dragEnterHandler(t){let{e:e}=t;const s=this.targetCanDrop(e);!this.__isDraggingOver&&s&&(this.__isDraggingOver=!0)}dragOverHandler(t){const{e:e}=t,s=this.targetCanDrop(e);!this.__isDraggingOver&&s?this.__isDraggingOver=!0:this.__isDraggingOver&&!s&&(this.__isDraggingOver=!1),this.__isDraggingOver&&(e.preventDefault(),t.canDrop=!0,t.dropTarget=this.target)}dragLeaveHandler(){(this.__isDraggingOver||this.isActive())&&(this.__isDraggingOver=!1)}dropHandler(t){var e;const{e:s}=t,n=s.defaultPrevented;this.__isDraggingOver=!1,s.preventDefault();let i=null===(e=s.dataTransfer)||void 0===e?void 0:e.getData("text/plain");if(i&&!n){const e=this.target,n=e.canvas;let r=e.getSelectionStartFromPointer(s);const{styles:o}=s.dataTransfer.types.includes("application/fabric")?JSON.parse(s.dataTransfer.getData("application/fabric")):{},a=i[Math.max(0,i.length-1)],h=0;if(this.__dragStartSelection){const t=this.__dragStartSelection.selectionStart,s=this.__dragStartSelection.selectionEnd;r>t&&r<=s?r=t:r>s&&(r-=s-t),e.removeChars(t,s),delete this.__dragStartSelection}e._reNewline.test(a)&&(e._reNewline.test(e._text[r])||r===e._text.length)&&(i=i.trimEnd()),t.didDrop=!0,t.dropTarget=e,e.insertChars(i,o,r),n.setActiveObject(e),e.enterEditing(s),e.selectionStart=Math.min(r+h,e._text.length),e.selectionEnd=Math.min(e.selectionStart+i.length,e._text.length),e.hiddenTextarea.value=e.text,e._updateTextarea(),e.hiddenTextarea.focus(),e.fire(Q,{index:r+h,action:"drop"}),n.fire("text:changed",{target:e}),n.contextTopDirty=!0,n.requestRenderAll()}}dragEndHandler(t){let{e:e}=t;if(this.isActive()&&this.__dragStartFired&&this.__dragStartSelection){var s;const t=this.target,n=this.target.canvas,{selectionStart:i,selectionEnd:r}=this.__dragStartSelection,o=(null===(s=e.dataTransfer)||void 0===s?void 0:s.dropEffect)||W;o===W?(t.selectionStart=i,t.selectionEnd=r,t._updateTextarea(),t.hiddenTextarea.focus()):(t.clearContextTop(),"move"===o&&(t.removeChars(i,r),t.selectionStart=t.selectionEnd=i,t.hiddenTextarea&&(t.hiddenTextarea.value=t.text),t._updateTextarea(),t.fire(Q,{index:i,action:"dragend"}),n.fire("text:changed",{target:t}),n.requestRenderAll()),t.exitEditing())}this.__dragImageDisposer&&this.__dragImageDisposer(),delete this.__dragImageDisposer,delete this.__dragStartSelection,this.__isDraggingOver=!1}dispose(){this._dispose&&this._dispose()}}const Fo=/[ \n\.,;!\?\-]/;class Lo extends Mo{constructor(){super(...arguments),h(this,"_currentCursorOpacity",1)}initBehavior(){this._tick=this._tick.bind(this),this._onTickComplete=this._onTickComplete.bind(this),this.updateSelectionOnMouseMove=this.updateSelectionOnMouseMove.bind(this)}onDeselect(t){return this.isEditing&&this.exitEditing(),this.selected=!1,super.onDeselect(t)}_animateCursor(t){let{toValue:e,duration:s,delay:n,onComplete:i}=t;return tn({startValue:this._currentCursorOpacity,endValue:e,duration:s,delay:n,onComplete:i,abort:()=>!this.canvas||this.selectionStart!==this.selectionEnd,onChange:t=>{this._currentCursorOpacity=t,this.renderCursorOrSelection()}})}_tick(t){this._currentTickState=this._animateCursor({toValue:0,duration:this.cursorDuration/2,delay:Math.max(t||0,100),onComplete:this._onTickComplete})}_onTickComplete(){var t;null===(t=this._currentTickCompleteState)||void 0===t||t.abort(),this._currentTickCompleteState=this._animateCursor({toValue:1,duration:this.cursorDuration,onComplete:this._tick})}initDelayedCursor(t){this.abortCursorAnimation(),this._tick(t?0:this.cursorDelay)}abortCursorAnimation(){let t=!1;[this._currentTickState,this._currentTickCompleteState].forEach((e=>{e&&!e.isDone()&&(t=!0,e.abort())})),this._currentCursorOpacity=1,t&&this.clearContextTop()}restartCursorIfNeeded(){[this._currentTickState,this._currentTickCompleteState].some((t=>!t||t.isDone()))&&this.initDelayedCursor()}selectAll(){return this.selectionStart=0,this.selectionEnd=this._text.length,this._fireSelectionChanged(),this._updateTextarea(),this}cmdAll(){this.selectAll(),this.renderCursorOrSelection()}getSelectedText(){return this._text.slice(this.selectionStart,this.selectionEnd).join("")}findWordBoundaryLeft(t){let e=0,s=t-1;if(this._reSpace.test(this._text[s]))for(;this._reSpace.test(this._text[s]);)e++,s--;for(;/\S/.test(this._text[s])&&s>-1;)e++,s--;return t-e}findWordBoundaryRight(t){let e=0,s=t;if(this._reSpace.test(this._text[s]))for(;this._reSpace.test(this._text[s]);)e++,s++;for(;/\S/.test(this._text[s])&&s<this._text.length;)e++,s++;return t+e}findLineBoundaryLeft(t){let e=0,s=t-1;for(;!/\n/.test(this._text[s])&&s>-1;)e++,s--;return t-e}findLineBoundaryRight(t){let e=0,s=t;for(;!/\n/.test(this._text[s])&&s<this._text.length;)e++,s++;return t+e}searchWordBoundary(t,e){const s=this._text;let n=t>0&&this._reSpace.test(s[t])&&(-1===e||!U.test(s[t-1]))?t-1:t,i=s[n];for(;n>0&&n<s.length&&!Fo.test(i);)n+=e,i=s[n];return-1===e&&Fo.test(i)&&n++,n}selectWord(t){var e;t=null!==(e=t)&&void 0!==e?e:this.selectionStart;const s=this.searchWordBoundary(t,-1),n=Math.max(s,this.searchWordBoundary(t,1));this.selectionStart=s,this.selectionEnd=n,this._fireSelectionChanged(),this._updateTextarea(),this.renderCursorOrSelection()}selectLine(t){var e;t=null!==(e=t)&&void 0!==e?e:this.selectionStart;const s=this.findLineBoundaryLeft(t),n=this.findLineBoundaryRight(t);this.selectionStart=s,this.selectionEnd=n,this._fireSelectionChanged(),this._updateTextarea()}enterEditing(t){!this.isEditing&&this.editable&&(this.enterEditingImpl(),this.fire("editing:entered",t?{e:t}:void 0),this._fireSelectionChanged(),this.canvas&&(this.canvas.fire("text:editing:entered",{target:this,e:t}),this.canvas.requestRenderAll()))}enterEditingImpl(){this.canvas&&(this.canvas.calcOffset(),this.canvas.textEditingManager.exitTextEditing()),this.isEditing=!0,this.initHiddenTextarea(),this.hiddenTextarea.focus(),this.hiddenTextarea.value=this.text,this._updateTextarea(),this._saveEditingProps(),this._setEditingProps(),this._textBeforeEdit=this.text,this._tick()}updateSelectionOnMouseMove(t){if(this.getActiveControl())return;const e=this.hiddenTextarea;se(e).activeElement!==e&&e.focus();const s=this.getSelectionStartFromPointer(t),n=this.selectionStart,i=this.selectionEnd;(s===this.__selectionStartOnMouseDown&&n!==i||n!==s&&i!==s)&&(s>this.__selectionStartOnMouseDown?(this.selectionStart=this.__selectionStartOnMouseDown,this.selectionEnd=s):(this.selectionStart=s,this.selectionEnd=this.__selectionStartOnMouseDown),this.selectionStart===n&&this.selectionEnd===i||(this._fireSelectionChanged(),this._updateTextarea(),this.renderCursorOrSelection()))}_setEditingProps(){this.hoverCursor="text",this.canvas&&(this.canvas.defaultCursor=this.canvas.moveCursor="text"),this.borderColor=this.editingBorderColor,this.hasControls=this.selectable=!1,this.lockMovementX=this.lockMovementY=!0}fromStringToGraphemeSelection(t,e,s){const n=s.slice(0,t),i=this.graphemeSplit(n).length;if(t===e)return{selectionStart:i,selectionEnd:i};const r=s.slice(t,e);return{selectionStart:i,selectionEnd:i+this.graphemeSplit(r).length}}fromGraphemeToStringSelection(t,e,s){const n=s.slice(0,t).join("").length;return t===e?{selectionStart:n,selectionEnd:n}:{selectionStart:n,selectionEnd:n+s.slice(t,e).join("").length}}_updateTextarea(){if(this.cursorOffsetCache={},this.hiddenTextarea){if(!this.inCompositionMode){const t=this.fromGraphemeToStringSelection(this.selectionStart,this.selectionEnd,this._text);this.hiddenTextarea.selectionStart=t.selectionStart,this.hiddenTextarea.selectionEnd=t.selectionEnd}this.updateTextareaPosition()}}updateFromTextArea(){if(!this.hiddenTextarea)return;this.cursorOffsetCache={};const t=this.hiddenTextarea;this.text=t.value,this.set("dirty",!0),this.initDimensions(),this.setCoords();const e=this.fromStringToGraphemeSelection(t.selectionStart,t.selectionEnd,t.value);this.selectionEnd=this.selectionStart=e.selectionEnd,this.inCompositionMode||(this.selectionStart=e.selectionStart),this.updateTextareaPosition()}updateTextareaPosition(){if(this.selectionStart===this.selectionEnd){const t=this._calcTextareaPosition();this.hiddenTextarea.style.left=t.left,this.hiddenTextarea.style.top=t.top}}_calcTextareaPosition(){if(!this.canvas)return{left:"1px",top:"1px"};const t=this.inCompositionMode?this.compositionStart:this.selectionStart,e=this._getCursorBoundaries(t),s=this.get2DCursorLocation(t),n=s.lineIndex,i=s.charIndex,r=this.getValueOfPropertyAt(n,i,"fontSize")*this.lineHeight,o=e.leftOffset,a=this.getCanvasRetinaScaling(),h=this.canvas.upperCanvasEl,c=h.width/a,l=h.height/a,u=c-r,d=l-r,g=new gt(e.left+o,e.top+e.topOffset+r).transform(this.calcTransformMatrix()).transform(this.canvas.viewportTransform).multiply(new gt(h.clientWidth/c,h.clientHeight/l));return g.x<0&&(g.x=0),g.x>u&&(g.x=u),g.y<0&&(g.y=0),g.y>d&&(g.y=d),g.x+=this.canvas._offset.left,g.y+=this.canvas._offset.top,{left:"".concat(g.x,"px"),top:"".concat(g.y,"px"),fontSize:"".concat(r,"px"),charHeight:r}}_saveEditingProps(){this._savedProps={hasControls:this.hasControls,borderColor:this.borderColor,lockMovementX:this.lockMovementX,lockMovementY:this.lockMovementY,hoverCursor:this.hoverCursor,selectable:this.selectable,defaultCursor:this.canvas&&this.canvas.defaultCursor,moveCursor:this.canvas&&this.canvas.moveCursor}}_restoreEditingProps(){this._savedProps&&(this.hoverCursor=this._savedProps.hoverCursor,this.hasControls=this._savedProps.hasControls,this.borderColor=this._savedProps.borderColor,this.selectable=this._savedProps.selectable,this.lockMovementX=this._savedProps.lockMovementX,this.lockMovementY=this._savedProps.lockMovementY,this.canvas&&(this.canvas.defaultCursor=this._savedProps.defaultCursor||this.canvas.defaultCursor,this.canvas.moveCursor=this._savedProps.moveCursor||this.canvas.moveCursor),delete this._savedProps)}_exitEditing(){const t=this.hiddenTextarea;this.selected=!1,this.isEditing=!1,t&&(t.blur&&t.blur(),t.parentNode&&t.parentNode.removeChild(t)),this.hiddenTextarea=null,this.abortCursorAnimation(),this.selectionStart!==this.selectionEnd&&this.clearContextTop()}exitEditingImpl(){this._exitEditing(),this.selectionEnd=this.selectionStart,this._restoreEditingProps(),this._forceClearCache&&(this.initDimensions(),this.setCoords())}exitEditing(){const t=this._textBeforeEdit!==this.text;return this.exitEditingImpl(),this.fire("editing:exited"),t&&this.fire(it),this.canvas&&(this.canvas.fire("text:editing:exited",{target:this}),t&&this.canvas.fire("object:modified",{target:this})),this}_removeExtraneousStyles(){for(const t in this.styles)this._textLines[t]||delete this.styles[t]}removeStyleFromTo(t,e){const{lineIndex:s,charIndex:n}=this.get2DCursorLocation(t,!0),{lineIndex:i,charIndex:r}=this.get2DCursorLocation(e,!0);if(s!==i){if(this.styles[s])for(let t=n;t<this._unwrappedTextLines[s].length;t++)delete this.styles[s][t];if(this.styles[i])for(let t=r;t<this._unwrappedTextLines[i].length;t++){const e=this.styles[i][t];e&&(this.styles[s]||(this.styles[s]={}),this.styles[s][n+t-r]=e)}for(let t=s+1;t<=i;t++)delete this.styles[t];this.shiftLineStyles(i,s-i)}else if(this.styles[s]){const t=this.styles[s],e=r-n;for(let s=n;s<r;s++)delete t[s];for(const n in this.styles[s]){const s=parseInt(n,10);s>=r&&(t[s-e]=t[n],delete t[n])}}}shiftLineStyles(t,e){const s=Object.assign({},this.styles);for(const n in this.styles){const i=parseInt(n,10);i>t&&(this.styles[i+e]=s[i],s[i-e]||delete this.styles[i])}}insertNewlineStyleObject(t,e,s,n){const i={},r=this._unwrappedTextLines[t].length,o=r===e;let a=!1;s||(s=1),this.shiftLineStyles(t,s);const h=this.styles[t]?this.styles[t][0===e?e:e-1]:void 0;for(const l in this.styles[t]){const s=parseInt(l,10);s>=e&&(a=!0,i[s-e]=this.styles[t][l],o&&0===e||delete this.styles[t][l])}let c=!1;for(a&&!o&&(this.styles[t+s]=i,c=!0),(c||r>e)&&s--;s>0;)n&&n[s-1]?this.styles[t+s]={0:l({},n[s-1])}:h?this.styles[t+s]={0:l({},h)}:delete this.styles[t+s],s--;this._forceClearCache=!0}insertCharStyleObject(t,e,s,n){this.styles||(this.styles={});const i=this.styles[t],r=i?l({},i):{};s||(s=1);for(const a in r){const t=parseInt(a,10);t>=e&&(i[t+s]=r[t],r[t-s]||delete i[t])}if(this._forceClearCache=!0,n){for(;s--;)Object.keys(n[s]).length&&(this.styles[t]||(this.styles[t]={}),this.styles[t][e+s]=l({},n[s]));return}if(!i)return;const o=i[e?e-1:1];for(;o&&s--;)this.styles[t][e+s]=l({},o)}insertNewStyleBlock(t,e,s){const n=this.get2DCursorLocation(e,!0),i=[0];let r,o=0;for(let a=0;a<t.length;a++)"\n"===t[a]?(o++,i[o]=0):i[o]++;for(i[0]>0&&(this.insertCharStyleObject(n.lineIndex,n.charIndex,i[0],s),s=s&&s.slice(i[0]+1)),o&&this.insertNewlineStyleObject(n.lineIndex,n.charIndex+i[0],o),r=1;r<o;r++)i[r]>0?this.insertCharStyleObject(n.lineIndex+r,0,i[r],s):s&&this.styles[n.lineIndex+r]&&s[0]&&(this.styles[n.lineIndex+r][0]=s[0]),s=s&&s.slice(i[r]+1);i[r]>0&&this.insertCharStyleObject(n.lineIndex+r,0,i[r],s)}removeChars(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:t+1;this.removeStyleFromTo(t,e),this._text.splice(t,e-t),this.text=this._text.join(""),this.set("dirty",!0),this.initDimensions(),this.setCoords(),this._removeExtraneousStyles()}insertChars(t,e,s){let n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:s;n>s&&this.removeStyleFromTo(s,n);const i=this.graphemeSplit(t);this.insertNewStyleBlock(i,s,e),this._text=[...this._text.slice(0,s),...i,...this._text.slice(n)],this.text=this._text.join(""),this.set("dirty",!0),this.initDimensions(),this.setCoords(),this._removeExtraneousStyles()}setSelectionStartEndWithShift(t,e,s){s<=t?(e===t?this._selectionDirection=L:this._selectionDirection===B&&(this._selectionDirection=L,this.selectionEnd=t),this.selectionStart=s):s>t&&s<e?this._selectionDirection===B?this.selectionEnd=s:this.selectionStart=s:(e===t?this._selectionDirection=B:this._selectionDirection===L&&(this._selectionDirection=B,this.selectionStart=e),this.selectionEnd=s)}}class jo extends Lo{initHiddenTextarea(){const t=this.canvas&&se(this.canvas.getElement())||x(),e=t.createElement("textarea");Object.entries({autocapitalize:"off",autocorrect:"off",autocomplete:"off",spellcheck:"false","data-fabric":"textarea",wrap:"off"}).map((t=>{let[s,n]=t;return e.setAttribute(s,n)}));const{top:s,left:n,fontSize:i}=this._calcTextareaPosition();e.style.cssText="position: absolute; top: ".concat(s,"; left: ").concat(n,"; z-index: -999; opacity: 0; width: 1px; height: 1px; font-size: 1px; padding-top: ").concat(i,";"),(this.hiddenTextareaContainer||t.body).appendChild(e),Object.entries({blur:"blur",keydown:"onKeyDown",keyup:"onKeyUp",input:"onInput",copy:"copy",cut:"copy",paste:"paste",compositionstart:"onCompositionStart",compositionupdate:"onCompositionUpdate",compositionend:"onCompositionEnd"}).map((t=>{let[s,n]=t;return e.addEventListener(s,this[n].bind(this))})),this.hiddenTextarea=e}blur(){this.abortCursorAnimation()}onKeyDown(t){if(!this.isEditing)return;const e="rtl"===this.direction?this.keysMapRtl:this.keysMap;if(t.keyCode in e)this[e[t.keyCode]](t);else{if(!(t.keyCode in this.ctrlKeysMapDown)||!t.ctrlKey&&!t.metaKey)return;this[this.ctrlKeysMapDown[t.keyCode]](t)}t.stopImmediatePropagation(),t.preventDefault(),t.keyCode>=33&&t.keyCode<=40?(this.inCompositionMode=!1,this.clearContextTop(),this.renderCursorOrSelection()):this.canvas&&this.canvas.requestRenderAll()}onKeyUp(t){!this.isEditing||this._copyDone||this.inCompositionMode?this._copyDone=!1:t.keyCode in this.ctrlKeysMapUp&&(t.ctrlKey||t.metaKey)&&(this[this.ctrlKeysMapUp[t.keyCode]](t),t.stopImmediatePropagation(),t.preventDefault(),this.canvas&&this.canvas.requestRenderAll())}onInput(t){const e=this.fromPaste,{value:s,selectionStart:n,selectionEnd:i}=this.hiddenTextarea;if(this.fromPaste=!1,t&&t.stopPropagation(),!this.isEditing)return;const r=()=>{this.updateFromTextArea(),this.fire(Q),this.canvas&&(this.canvas.fire("text:changed",{target:this}),this.canvas.requestRenderAll())};if(""===this.hiddenTextarea.value)return this.styles={},void r();const o=this._splitTextIntoLines(s).graphemeText,a=this._text.length,h=o.length,c=this.selectionStart,l=this.selectionEnd,u=c!==l;let d,g,f,m,_=h-a;const v=this.fromStringToGraphemeSelection(n,i,s),y=c>v.selectionStart;u?(g=this._text.slice(c,l),_+=l-c):h<a&&(g=y?this._text.slice(l+_,l):this._text.slice(c,c-_));const C=o.slice(v.selectionEnd-_,v.selectionEnd);if(g&&g.length&&(C.length&&(d=this.getSelectionStyles(c,c+1,!1),d=C.map((()=>d[0]))),u?(f=c,m=l):y?(f=l-g.length,m=l):(f=l,m=l+g.length),this.removeStyleFromTo(f,m)),C.length){const{copyPasteData:t}=w();e&&C.join("")===t.copiedText&&!p.disableStyleCopyPaste&&(d=t.copiedTextStyle),this.insertNewStyleBlock(C,c,d)}r()}onCompositionStart(){this.inCompositionMode=!0}onCompositionEnd(){this.inCompositionMode=!1}onCompositionUpdate(t){let{target:e}=t;const{selectionStart:s,selectionEnd:n}=e;this.compositionStart=s,this.compositionEnd=n,this.updateTextareaPosition()}copy(){if(this.selectionStart===this.selectionEnd)return;const{copyPasteData:t}=w();t.copiedText=this.getSelectedText(),p.disableStyleCopyPaste?t.copiedTextStyle=void 0:t.copiedTextStyle=this.getSelectionStyles(this.selectionStart,this.selectionEnd,!0),this._copyDone=!0}paste(){this.fromPaste=!0}_getWidthBeforeCursor(t,e){let s,n=this._getLineLeftOffset(t);return e>0&&(s=this.__charBounds[t][e-1],n+=s.left+s.width),n}getDownCursorOffset(t,e){const s=this._getSelectionForOffset(t,e),n=this.get2DCursorLocation(s),i=n.lineIndex;if(i===this._textLines.length-1||t.metaKey||34===t.keyCode)return this._text.length-s;const r=n.charIndex,o=this._getWidthBeforeCursor(i,r),a=this._getIndexOnLine(i+1,o);return this._textLines[i].slice(r).length+a+1+this.missingNewlineOffset(i)}_getSelectionForOffset(t,e){return t.shiftKey&&this.selectionStart!==this.selectionEnd&&e?this.selectionEnd:this.selectionStart}getUpCursorOffset(t,e){const s=this._getSelectionForOffset(t,e),n=this.get2DCursorLocation(s),i=n.lineIndex;if(0===i||t.metaKey||33===t.keyCode)return-s;const r=n.charIndex,o=this._getWidthBeforeCursor(i,r),a=this._getIndexOnLine(i-1,o),h=this._textLines[i].slice(0,r),c=this.missingNewlineOffset(i-1);return-this._textLines[i-1].length+a-h.length+(1-c)}_getIndexOnLine(t,e){const s=this._textLines[t];let n,i,r=this._getLineLeftOffset(t),o=0;for(let a=0,h=s.length;a<h;a++)if(n=this.__charBounds[t][a].width,r+=n,r>e){i=!0;const t=r-n,s=r,h=Math.abs(t-e);o=Math.abs(s-e)<h?a:a-1;break}return i||(o=s.length-1),o}moveCursorDown(t){this.selectionStart>=this._text.length&&this.selectionEnd>=this._text.length||this._moveCursorUpOrDown("Down",t)}moveCursorUp(t){0===this.selectionStart&&0===this.selectionEnd||this._moveCursorUpOrDown("Up",t)}_moveCursorUpOrDown(t,e){const s=this["get".concat(t,"CursorOffset")](e,this._selectionDirection===B);if(e.shiftKey?this.moveCursorWithShift(s):this.moveCursorWithoutShift(s),0!==s){const t=this.text.length;this.selectionStart=Rs(0,this.selectionStart,t),this.selectionEnd=Rs(0,this.selectionEnd,t),this.abortCursorAnimation(),this.initDelayedCursor(),this._fireSelectionChanged(),this._updateTextarea()}}moveCursorWithShift(t){const e=this._selectionDirection===L?this.selectionStart+t:this.selectionEnd+t;return this.setSelectionStartEndWithShift(this.selectionStart,this.selectionEnd,e),0!==t}moveCursorWithoutShift(t){return t<0?(this.selectionStart+=t,this.selectionEnd=this.selectionStart):(this.selectionEnd+=t,this.selectionStart=this.selectionEnd),0!==t}moveCursorLeft(t){0===this.selectionStart&&0===this.selectionEnd||this._moveCursorLeftOrRight("Left",t)}_move(t,e,s){let n;if(t.altKey)n=this["findWordBoundary".concat(s)](this[e]);else{if(!t.metaKey&&35!==t.keyCode&&36!==t.keyCode)return this[e]+="Left"===s?-1:1,!0;n=this["findLineBoundary".concat(s)](this[e])}return void 0!==n&&this[e]!==n&&(this[e]=n,!0)}_moveLeft(t,e){return this._move(t,e,"Left")}_moveRight(t,e){return this._move(t,e,"Right")}moveCursorLeftWithoutShift(t){let e=!0;return this._selectionDirection=L,this.selectionEnd===this.selectionStart&&0!==this.selectionStart&&(e=this._moveLeft(t,"selectionStart")),this.selectionEnd=this.selectionStart,e}moveCursorLeftWithShift(t){return this._selectionDirection===B&&this.selectionStart!==this.selectionEnd?this._moveLeft(t,"selectionEnd"):0!==this.selectionStart?(this._selectionDirection=L,this._moveLeft(t,"selectionStart")):void 0}moveCursorRight(t){this.selectionStart>=this._text.length&&this.selectionEnd>=this._text.length||this._moveCursorLeftOrRight("Right",t)}_moveCursorLeftOrRight(t,e){const s="moveCursor".concat(t).concat(e.shiftKey?"WithShift":"WithoutShift");this._currentCursorOpacity=1,this[s](e)&&(this.abortCursorAnimation(),this.initDelayedCursor(),this._fireSelectionChanged(),this._updateTextarea())}moveCursorRightWithShift(t){return this._selectionDirection===L&&this.selectionStart!==this.selectionEnd?this._moveRight(t,"selectionStart"):this.selectionEnd!==this._text.length?(this._selectionDirection=B,this._moveRight(t,"selectionEnd")):void 0}moveCursorRightWithoutShift(t){let e=!0;return this._selectionDirection=B,this.selectionStart===this.selectionEnd?(e=this._moveRight(t,"selectionStart"),this.selectionEnd=this.selectionStart):this.selectionStart=this.selectionEnd,e}}const No=t=>!!t.button;class Bo extends jo{constructor(){super(...arguments),h(this,"draggableTextDelegate",void 0)}initBehavior(){this.on("mousedown",this._mouseDownHandler),this.on("mouseup",this.mouseUpHandler),this.on("mousedblclick",this.doubleClickHandler),this.on("mousetripleclick",this.tripleClickHandler),this.draggableTextDelegate=new Ro(this),super.initBehavior()}shouldStartDragging(){return this.draggableTextDelegate.isActive()}onDragStart(t){return this.draggableTextDelegate.onDragStart(t)}canDrop(t){return this.draggableTextDelegate.canDrop(t)}doubleClickHandler(t){this.isEditing&&(this.selectWord(this.getSelectionStartFromPointer(t.e)),this.renderCursorOrSelection())}tripleClickHandler(t){this.isEditing&&(this.selectLine(this.getSelectionStartFromPointer(t.e)),this.renderCursorOrSelection())}_mouseDownHandler(t){let{e:e,alreadySelected:s}=t;this.canvas&&this.editable&&!No(e)&&!this.getActiveControl()&&(this.draggableTextDelegate.start(e)||(this.canvas.textEditingManager.register(this),s&&(this.inCompositionMode=!1,this.setCursorByClick(e)),this.isEditing&&(this.__selectionStartOnMouseDown=this.selectionStart,this.selectionStart===this.selectionEnd&&this.abortCursorAnimation(),this.renderCursorOrSelection()),this.selected||(this.selected=s||this.isEditing)))}mouseUpHandler(t){let{e:e,transform:s}=t;const n=this.draggableTextDelegate.end(e);if(this.canvas){this.canvas.textEditingManager.unregister(this);const t=this.canvas._activeObject;if(t&&t!==this)return}!this.editable||this.group&&!this.group.interactive||s&&s.actionPerformed||No(e)||n||this.selected&&!this.getActiveControl()&&(this.enterEditing(e),this.selectionStart===this.selectionEnd?this.initDelayedCursor(!0):this.renderCursorOrSelection())}setCursorByClick(t){const e=this.getSelectionStartFromPointer(t),s=this.selectionStart,n=this.selectionEnd;t.shiftKey?this.setSelectionStartEndWithShift(s,n,e):(this.selectionStart=e,this.selectionEnd=e),this.isEditing&&(this._fireSelectionChanged(),this._updateTextarea())}getSelectionStartFromPointer(t){const e=this.canvas.getScenePoint(t).transform(Pt(this.calcTransformMatrix())).add(new gt(-this._getLeftOffset(),-this._getTopOffset()));let s=0,n=0,i=0;for(let h=0;h<this._textLines.length&&s<=e.y;h++)s+=this.getHeightOfLine(h),i=h,h>0&&(n+=this._textLines[h-1].length+this.missingNewlineOffset(h-1));let r=Math.abs(this._getLineLeftOffset(i));const o=this._textLines[i].length,a=this.__charBounds[i];for(let h=0;h<o;h++){const t=r+a[h].kernedWidth;if(e.x<=t){Math.abs(e.x-t)<=Math.abs(e.x-r)&&n++;break}r=t,n++}return Math.min(this.flipX?o-n:n,this._text.length)}}const Wo="moveCursorUp",Uo="moveCursorDown",Yo="moveCursorLeft",Xo="moveCursorRight",Vo="exitEditing",Go=(t,e)=>{const s=e.getRetinaScaling();t.setTransform(s,0,0,s,0,0);const n=e.viewportTransform;t.transform(n[0],n[1],n[2],n[3],n[4],n[5])},Ho=l({selectionStart:0,selectionEnd:0,selectionColor:"rgba(17,119,255,0.3)",isEditing:!1,editable:!0,editingBorderColor:"rgba(102,153,255,0.25)",cursorWidth:2,cursorColor:"",cursorDelay:1e3,cursorDuration:600,caching:!0,hiddenTextareaContainer:null,keysMap:{9:Vo,27:Vo,33:Wo,34:Uo,35:Xo,36:Yo,37:Yo,38:Wo,39:Xo,40:Uo},keysMapRtl:{9:Vo,27:Vo,33:Wo,34:Uo,35:Yo,36:Xo,37:Xo,38:Wo,39:Yo,40:Uo},ctrlKeysMapDown:{65:"cmdAll"},ctrlKeysMapUp:{67:"copy",88:"cut"}},{_selectionDirection:null,_reSpace:/\s|\r?\n/,inCompositionMode:!1});class zo extends Bo{static getDefaults(){return l(l({},super.getDefaults()),zo.ownDefaults)}get type(){const t=super.type;return"itext"===t?"i-text":t}constructor(t,e){super(t,l(l({},zo.ownDefaults),e)),this.initBehavior()}_set(t,e){return this.isEditing&&this._savedProps&&t in this._savedProps?(this._savedProps[t]=e,this):("canvas"===t&&(this.canvas instanceof Vr&&this.canvas.textEditingManager.remove(this),e instanceof Vr&&e.textEditingManager.add(this)),super._set(t,e))}setSelectionStart(t){t=Math.max(t,0),this._updateAndFire("selectionStart",t)}setSelectionEnd(t){t=Math.min(t,this.text.length),this._updateAndFire("selectionEnd",t)}_updateAndFire(t,e){this[t]!==e&&(this._fireSelectionChanged(),this[t]=e),this._updateTextarea()}_fireSelectionChanged(){this.fire("selection:changed"),this.canvas&&this.canvas.fire("text:selection:changed",{target:this})}initDimensions(){this.isEditing&&this.initDelayedCursor(),super.initDimensions()}getSelectionStyles(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.selectionStart||0,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.selectionEnd,s=arguments.length>2?arguments[2]:void 0;return super.getSelectionStyles(t,e,s)}setSelectionStyles(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.selectionStart||0,s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:this.selectionEnd;return super.setSelectionStyles(t,e,s)}get2DCursorLocation(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.selectionStart,e=arguments.length>1?arguments[1]:void 0;return super.get2DCursorLocation(t,e)}render(t){super.render(t),this.cursorOffsetCache={},this.renderCursorOrSelection()}toCanvasElement(t){const e=this.isEditing;this.isEditing=!1;const s=super.toCanvasElement(t);return this.isEditing=e,s}renderCursorOrSelection(){if(!this.isEditing||!this.canvas)return;const t=this.clearContextTop(!0);if(!t)return;const e=this._getCursorBoundaries(),s=this.findAncestorsWithClipPath(),n=s.length>0;let i,r=t;if(n){i=St(t.canvas),r=i.getContext("2d"),Go(r,this.canvas);const e=this.calcTransformMatrix();r.transform(e[0],e[1],e[2],e[3],e[4],e[5])}if(this.selectionStart!==this.selectionEnd||this.inCompositionMode?this.renderSelection(r,e):this.renderCursor(r,e),n)for(const o of s){const e=o.clipPath,s=St(t.canvas),n=s.getContext("2d");if(Go(n,this.canvas),!e.absolutePositioned){const t=o.calcTransformMatrix();n.transform(t[0],t[1],t[2],t[3],t[4],t[5])}e.transform(n),e.drawObject(n,!0,{}),this.drawClipPathOnCache(r,e,s)}n&&(t.setTransform(1,0,0,1,0,0),t.drawImage(i,0,0)),this.canvas.contextTopDirty=!0,t.restore()}findAncestorsWithClipPath(){const t=[];let e=this;for(;e;)e.clipPath&&t.push(e),e=e.parent;return t}_getCursorBoundaries(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.selectionStart,e=arguments.length>1?arguments[1]:void 0;const s=this._getLeftOffset(),n=this._getTopOffset(),i=this._getCursorBoundariesOffsets(t,e);return{left:s,top:n,leftOffset:i.left,topOffset:i.top}}_getCursorBoundariesOffsets(t,e){return e?this.__getCursorBoundariesOffsets(t):this.cursorOffsetCache&&"top"in this.cursorOffsetCache?this.cursorOffsetCache:this.cursorOffsetCache=this.__getCursorBoundariesOffsets(t)}__getCursorBoundariesOffsets(t){let e=0,s=0;const{charIndex:n,lineIndex:i}=this.get2DCursorLocation(t);for(let h=0;h<i;h++)e+=this.getHeightOfLine(h);const r=this._getLineLeftOffset(i),o=this.__charBounds[i][n];o&&(s=o.left),0!==this.charSpacing&&n===this._textLines[i].length&&(s-=this._getWidthOfCharSpacing());const a={top:e,left:r+(s>0?s:0)};return"rtl"===this.direction&&(this.textAlign===B||this.textAlign===es||this.textAlign===ns?a.left*=-1:this.textAlign===L||this.textAlign===ss?a.left=r-(s>0?s:0):this.textAlign!==F&&this.textAlign!==is||(a.left=r-(s>0?s:0))),a}renderCursorAt(t){this._renderCursor(this.canvas.contextTop,this._getCursorBoundaries(t,!0),t)}renderCursor(t,e){this._renderCursor(t,e,this.selectionStart)}getCursorRenderingData(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.selectionStart,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this._getCursorBoundaries(t);const s=this.get2DCursorLocation(t),n=s.lineIndex,i=s.charIndex>0?s.charIndex-1:0,r=this.getValueOfPropertyAt(n,i,"fontSize"),o=this.getObjectScaling().x*this.canvas.getZoom(),a=this.cursorWidth/o,h=this.getValueOfPropertyAt(n,i,"deltaY"),c=e.topOffset+(1-this._fontSizeFraction)*this.getHeightOfLine(n)/this.lineHeight-r*(1-this._fontSizeFraction);return{color:this.cursorColor||this.getValueOfPropertyAt(n,i,"fill"),opacity:this._currentCursorOpacity,left:e.left+e.leftOffset-a/2,top:c+e.top+h,width:a,height:r}}_renderCursor(t,e,s){const{color:n,opacity:i,left:r,top:o,width:a,height:h}=this.getCursorRenderingData(s,e);t.fillStyle=n,t.globalAlpha=i,t.fillRect(r,o,a,h)}renderSelection(t,e){const s={selectionStart:this.inCompositionMode?this.hiddenTextarea.selectionStart:this.selectionStart,selectionEnd:this.inCompositionMode?this.hiddenTextarea.selectionEnd:this.selectionEnd};this._renderSelection(t,s,e)}renderDragSourceEffect(){const t=this.draggableTextDelegate.getDragStartSelection();this._renderSelection(this.canvas.contextTop,t,this._getCursorBoundaries(t.selectionStart,!0))}renderDropTargetEffect(t){const e=this.getSelectionStartFromPointer(t);this.renderCursorAt(e)}_renderSelection(t,e,s){const n=e.selectionStart,i=e.selectionEnd,r=this.textAlign.includes(es),o=this.get2DCursorLocation(n),a=this.get2DCursorLocation(i),h=o.lineIndex,c=a.lineIndex,l=o.charIndex<0?0:o.charIndex,u=a.charIndex<0?0:a.charIndex;for(let d=h;d<=c;d++){const e=this._getLineLeftOffset(d)||0;let n=this.getHeightOfLine(d),i=0,o=0,a=0;if(d===h&&(o=this.__charBounds[h][l].left),d>=h&&d<c)a=r&&!this.isEndOfWrapping(d)?this.width:this.getLineWidth(d)||5;else if(d===c)if(0===u)a=this.__charBounds[c][u].left;else{const t=this._getWidthOfCharSpacing();a=this.__charBounds[c][u-1].left+this.__charBounds[c][u-1].width-t}i=n,(this.lineHeight<1||d===c&&this.lineHeight>1)&&(n/=this.lineHeight);let g=s.left+e+o,p=n,f=0;const m=a-o;this.inCompositionMode?(t.fillStyle=this.compositionColor||"black",p=1,f=n):t.fillStyle=this.selectionColor,"rtl"===this.direction&&(this.textAlign===B||this.textAlign===es||this.textAlign===ns?g=this.width-g-m:this.textAlign===L||this.textAlign===ss?g=s.left+e-a:this.textAlign!==F&&this.textAlign!==is||(g=s.left+e-a)),t.fillRect(g,s.top+s.topOffset+f,m,p),s.topOffset+=i}}getCurrentCharFontSize(){const t=this._getCurrentCharIndex();return this.getValueOfPropertyAt(t.l,t.c,"fontSize")}getCurrentCharColor(){const t=this._getCurrentCharIndex();return this.getValueOfPropertyAt(t.l,t.c,st)}_getCurrentCharIndex(){const t=this.get2DCursorLocation(this.selectionStart,!0),e=t.charIndex>0?t.charIndex-1:0;return{l:t.lineIndex,c:e}}dispose(){this.exitEditingImpl(),this.draggableTextDelegate.dispose(),super.dispose()}}h(zo,"ownDefaults",Ho),h(zo,"type","IText"),at.setClass(zo),at.setClass(zo,"i-text");class qo extends zo{static getDefaults(){return l(l({},super.getDefaults()),qo.ownDefaults)}constructor(t,e){super(t,l(l({},qo.ownDefaults),e))}static createControls(){return{controls:Nn()}}initDimensions(){this.initialized&&(this.isEditing&&this.initDelayedCursor(),this._clearCache(),this.dynamicMinWidth=0,this._styleMap=this._generateStyleMap(this._splitText()),this.dynamicMinWidth>this.width&&this._set("width",this.dynamicMinWidth),this.textAlign.includes(es)&&this.enlargeSpaces(),this.height=this.calcTextHeight())}_generateStyleMap(t){let e=0,s=0,n=0;const i={};for(let r=0;r<t.graphemeLines.length;r++)"\n"===t.graphemeText[n]&&r>0?(s=0,n++,e++):!this.splitByGrapheme&&this._reSpaceAndTab.test(t.graphemeText[n])&&r>0&&(s++,n++),i[r]={line:e,offset:s},n+=t.graphemeLines[r].length,s+=t.graphemeLines[r].length;return i}styleHas(t,e){if(this._styleMap&&!this.isWrapping){const t=this._styleMap[e];t&&(e=t.line)}return super.styleHas(t,e)}isEmptyStyles(t){if(!this.styles)return!0;let e,s=0,n=t+1,i=!1;const r=this._styleMap[t],o=this._styleMap[t+1];r&&(t=r.line,s=r.offset),o&&(n=o.line,i=n===t,e=o.offset);const a=void 0===t?this.styles:{line:this.styles[t]};for(const h in a)for(const t in a[h]){const n=parseInt(t,10);if(n>=s&&(!i||n<e))for(const e in a[h][t])return!1}return!0}_getStyleDeclaration(t,e){if(this._styleMap&&!this.isWrapping){const s=this._styleMap[t];if(!s)return{};t=s.line,e=s.offset+e}return super._getStyleDeclaration(t,e)}_setStyleDeclaration(t,e,s){const n=this._styleMap[t];super._setStyleDeclaration(n.line,n.offset+e,s)}_deleteStyleDeclaration(t,e){const s=this._styleMap[t];super._deleteStyleDeclaration(s.line,s.offset+e)}_getLineStyle(t){const e=this._styleMap[t];return!!this.styles[e.line]}_setLineStyle(t){const e=this._styleMap[t];super._setLineStyle(e.line)}_wrapText(t,e){this.isWrapping=!0;const s=this.getGraphemeDataForRender(t),n=[];for(let i=0;i<s.wordsData.length;i++)n.push(...this._wrapLine(i,e,s));return this.isWrapping=!1,n}getGraphemeDataForRender(t){const e=this.splitByGrapheme,s=e?"":" ";let n=0;return{wordsData:t.map(((t,i)=>{let r=0;const o=e?this.graphemeSplit(t):this.wordSplit(t);return 0===o.length?[{word:[],width:0}]:o.map((t=>{const o=e?[t]:this.graphemeSplit(t),a=this._measureWord(o,i,r);return n=Math.max(a,n),r+=o.length+s.length,{word:o,width:a}}))})),largestWordWidth:n}}_measureWord(t,e){let s,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,i=0;for(let r=0,o=t.length;r<o;r++)i+=this._getGraphemeBox(t[r],e,r+n,s,!0).kernedWidth,s=t[r];return i}wordSplit(t){return t.split(this._wordJoiners)}_wrapLine(t,e,s){let{largestWordWidth:n,wordsData:i}=s,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;const o=this._getWidthOfCharSpacing(),a=this.splitByGrapheme,h=[],c=a?"":" ";let l=0,u=[],d=0,g=0,p=!0;e-=r;const f=Math.max(e,n,this.dynamicMinWidth),m=i[t];let _;for(d=0,_=0;_<m.length;_++){const{word:e,width:s}=m[_];d+=e.length,l+=g+s-o,l>f&&!p?(h.push(u),u=[],l=s,p=!0):l+=o,p||a||u.push(c),u=u.concat(e),g=a?0:this._measureWord([c],t,d),d++,p=!1}return _&&h.push(u),n+r>this.dynamicMinWidth&&(this.dynamicMinWidth=n-o+r),h}isEndOfWrapping(t){return!this._styleMap[t+1]||this._styleMap[t+1].line!==this._styleMap[t].line}missingNewlineOffset(t,e){return this.splitByGrapheme&&!e?this.isEndOfWrapping(t)?1:0:1}_splitTextIntoLines(t){const e=super._splitTextIntoLines(t),s=this._wrapText(e.lines,this.width),n=new Array(s.length);for(let i=0;i<s.length;i++)n[i]=s[i].join("");return e.lines=n,e.graphemeLines=s,e}getMinWidth(){return Math.max(this.minWidth,this.dynamicMinWidth)}_removeExtraneousStyles(){const t=new Map;for(const e in this._styleMap){const s=parseInt(e,10);if(this._textLines[s]){const s=this._styleMap[e].line;t.set("".concat(s),!0)}}for(const e in this.styles)t.has(e)||delete this.styles[e]}toObject(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];return super.toObject(["minWidth","splitByGrapheme",...t])}}h(qo,"type","Textbox"),h(qo,"textLayoutProperties",[...zo.textLayoutProperties,"width"]),h(qo,"ownDefaults",{minWidth:20,dynamicMinWidth:2,lockScalingFlip:!0,noScaleCache:!1,_wordJoiners:/[ \t\r]/,splitByGrapheme:!1}),at.setClass(qo);class Ko extends Gi{shouldPerformLayout(t){return!!t.target.clipPath&&super.shouldPerformLayout(t)}shouldLayoutClipPath(){return!1}calcLayoutResult(t,e){const{target:s}=t,{clipPath:n,group:i}=s;if(!n||!this.shouldPerformLayout(t))return;const{width:r,height:o}=pe(Vi(s,n)),a=new gt(r,o);if(n.absolutePositioned)return{center:we(n.getRelativeCenterPoint(),void 0,i?i.calcTransformMatrix():void 0),size:a};{const i=n.getRelativeCenterPoint().transform(s.calcOwnMatrix(),!0);if(this.shouldPerformLayout(t)){const{center:s=new gt,correction:n=new gt}=this.calcBoundingBox(e,t)||{};return{center:s.add(i),correction:n.subtract(i),size:a}}return{center:s.getRelativeCenterPoint().add(i),size:a}}}}h(Ko,"type","clip-path"),at.setClass(Ko);class Qo extends Gi{getInitialSize(t,e){let{target:s}=t,{size:n}=e;return new gt(s.width||n.x,s.height||n.y)}}h(Qo,"type","fixed"),at.setClass(Qo);class Jo extends Qi{subscribeTargets(t){const e=t.target;t.targets.reduce(((t,e)=>(e.parent&&t.add(e.parent),t)),new Set).forEach((t=>{t.layoutManager.subscribeTargets({target:t,targets:[e]})}))}unsubscribeTargets(t){const e=t.target,s=e.getObjects();t.targets.reduce(((t,e)=>(e.parent&&t.add(e.parent),t)),new Set).forEach((t=>{!s.some((e=>e.parent===t))&&t.layoutManager.unsubscribeTargets({target:t,targets:[e]})}))}}class Zo extends $i{static getDefaults(){return l(l({},super.getDefaults()),Zo.ownDefaults)}constructor(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};super(),Object.assign(this,Zo.ownDefaults),this.setOptions(e);const{left:s,top:n,layoutManager:i}=e;this.groupInit(t,{left:s,top:n,layoutManager:null!=i?i:new Jo})}_shouldSetNestedCoords(){return!0}__objectSelectionMonitor(){}multiSelectAdd(){for(var t=arguments.length,e=new Array(t),s=0;s<t;s++)e[s]=arguments[s];"selection-order"===this.multiSelectionStacking?this.add(...e):e.forEach((t=>{const e=this._objects.findIndex((e=>e.isInFrontOf(t))),s=-1===e?this.size():e;this.insertAt(s,t)}))}canEnterGroup(t){return this.getObjects().some((e=>e.isDescendantOf(t)||t.isDescendantOf(e)))?(f("error","ActiveSelection: circular object trees are not supported, this call has no effect"),!1):super.canEnterGroup(t)}enterGroup(t,e){t.parent&&t.parent===t.group?t.parent._exitGroup(t):t.group&&t.parent!==t.group&&t.group.remove(t),this._enterGroup(t,e)}exitGroup(t,e){this._exitGroup(t,e),t.parent&&t.parent._enterGroup(t,!0)}_onAfterObjectsChange(t,e){super._onAfterObjectsChange(t,e);const s=new Set;e.forEach((t=>{const{parent:e}=t;e&&s.add(e)})),t===Yi?s.forEach((t=>{t._onAfterObjectsChange(Ui,e)})):s.forEach((t=>{t._set("dirty",!0)}))}onDeselect(){return this.removeAll(),!1}toString(){return"#<ActiveSelection: (".concat(this.complexity(),")>")}shouldCache(){return!1}isOnACache(){return!1}_renderControls(t,e,s){t.save(),t.globalAlpha=this.isMoving?this.borderOpacityWhenMoving:1;const n=l(l({hasControls:!1},s),{},{forActiveSelection:!0});for(let i=0;i<this._objects.length;i++)this._objects[i]._renderControls(t,n);super._renderControls(t,e),t.restore()}}h(Zo,"type","ActiveSelection"),h(Zo,"ownDefaults",{multiSelectionStacking:"canvas-stacking"}),at.setClass(Zo),at.setClass(Zo,"activeSelection");class $o{constructor(){h(this,"resources",{})}applyFilters(t,e,s,n,i){const r=i.getContext("2d");if(!r)return;r.drawImage(e,0,0,s,n);const o={sourceWidth:s,sourceHeight:n,imageData:r.getImageData(0,0,s,n),originalEl:e,originalImageData:r.getImageData(0,0,s,n),canvasEl:i,ctx:r,filterBackend:this};t.forEach((t=>{t.applyTo(o)}));const{imageData:a}=o;return a.width===s&&a.height===n||(i.width=a.width,i.height=a.height),r.putImageData(a,0,0),o}}class ta{constructor(){let{tileSize:t=p.textureSize}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};h(this,"aPosition",new Float32Array([0,0,0,1,1,0,1,1])),h(this,"resources",{}),this.tileSize=t,this.setupGLContext(t,t),this.captureGPUInfo()}setupGLContext(t,e){this.dispose(),this.createWebGLCanvas(t,e)}createWebGLCanvas(t,e){const s=St({width:t,height:e}),n=s.getContext("webgl",{alpha:!0,premultipliedAlpha:!1,depth:!1,stencil:!1,antialias:!1});n&&(n.clearColor(0,0,0,0),this.canvas=s,this.gl=n)}applyFilters(t,e,s,n,i,r){const o=this.gl,a=i.getContext("2d");if(!o||!a)return;let h;r&&(h=this.getCachedTexture(r,e));const c={originalWidth:e.width||e.naturalWidth||0,originalHeight:e.height||e.naturalHeight||0,sourceWidth:s,sourceHeight:n,destinationWidth:s,destinationHeight:n,context:o,sourceTexture:this.createTexture(o,s,n,h?void 0:e),targetTexture:this.createTexture(o,s,n),originalTexture:h||this.createTexture(o,s,n,h?void 0:e),passes:t.length,webgl:!0,aPosition:this.aPosition,programCache:this.programCache,pass:0,filterBackend:this,targetCanvas:i},l=o.createFramebuffer();return o.bindFramebuffer(o.FRAMEBUFFER,l),t.forEach((t=>{t&&t.applyTo(c)})),function(t){const e=t.targetCanvas,s=e.width,n=e.height,i=t.destinationWidth,r=t.destinationHeight;s===i&&n===r||(e.width=i,e.height=r)}(c),this.copyGLTo2D(o,c),o.bindTexture(o.TEXTURE_2D,null),o.deleteTexture(c.sourceTexture),o.deleteTexture(c.targetTexture),o.deleteFramebuffer(l),a.setTransform(1,0,0,1,0,0),c}dispose(){this.canvas&&(this.canvas=null,this.gl=null),this.clearWebGLCaches()}clearWebGLCaches(){this.programCache={},this.textureCache={}}createTexture(t,e,s,n,i){const{NEAREST:r,TEXTURE_2D:o,RGBA:a,UNSIGNED_BYTE:h,CLAMP_TO_EDGE:c,TEXTURE_MAG_FILTER:l,TEXTURE_MIN_FILTER:u,TEXTURE_WRAP_S:d,TEXTURE_WRAP_T:g}=t,p=t.createTexture();return t.bindTexture(o,p),t.texParameteri(o,l,i||r),t.texParameteri(o,u,i||r),t.texParameteri(o,d,c),t.texParameteri(o,g,c),n?t.texImage2D(o,0,a,a,h,n):t.texImage2D(o,0,a,e,s,0,a,h,null),p}getCachedTexture(t,e,s){const{textureCache:n}=this;if(n[t])return n[t];{const i=this.createTexture(this.gl,e.width,e.height,e,s);return i&&(n[t]=i),i}}evictCachesForKey(t){this.textureCache[t]&&(this.gl.deleteTexture(this.textureCache[t]),delete this.textureCache[t])}copyGLTo2D(t,e){const s=t.canvas,n=e.targetCanvas,i=n.getContext("2d");if(!i)return;i.translate(0,n.height),i.scale(1,-1);const r=s.height-n.height;i.drawImage(s,0,r,n.width,n.height,0,0,n.width,n.height)}copyGLTo2DPutImageData(t,e){const s=e.targetCanvas.getContext("2d"),n=e.destinationWidth,i=e.destinationHeight,r=n*i*4;if(!s)return;const o=new Uint8Array(this.imageBuffer,0,r),a=new Uint8ClampedArray(this.imageBuffer,0,r);t.readPixels(0,0,n,i,t.RGBA,t.UNSIGNED_BYTE,o);const h=new ImageData(a,n,i);s.putImageData(h,0,0)}captureGPUInfo(){if(this.gpuInfo)return this.gpuInfo;const t=this.gl,e={renderer:"",vendor:""};if(!t)return e;const s=t.getExtension("WEBGL_debug_renderer_info");if(s){const n=t.getParameter(s.UNMASKED_RENDERER_WEBGL),i=t.getParameter(s.UNMASKED_VENDOR_WEBGL);n&&(e.renderer=n.toLowerCase()),i&&(e.vendor=i.toLowerCase())}return this.gpuInfo=e,e}}let ea;function sa(){const{WebGLProbe:t}=w();return t.queryWebGL(wt()),p.enableGLFiltering&&t.isSupported(p.textureSize)?new ta({tileSize:p.textureSize}):new $o}function na(){return!ea&&(!(arguments.length>0&&void 0!==arguments[0])||arguments[0])&&(ea=sa()),ea}const ia=["filters","resizeFilter","src","crossOrigin","type"],ra=["cropX","cropY"];class oa extends Un{static getDefaults(){return l(l({},super.getDefaults()),oa.ownDefaults)}constructor(t,e){super(),h(this,"_lastScaleX",1),h(this,"_lastScaleY",1),h(this,"_filterScalingX",1),h(this,"_filterScalingY",1),this.filters=[],Object.assign(this,oa.ownDefaults),this.setOptions(e),this.cacheKey="texture".concat(bt()),this.setElement("string"==typeof t?(this.canvas&&se(this.canvas.getElement())||x()).getElementById(t):t,e)}getElement(){return this._element}setElement(t){var e;let s=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};this.removeTexture(this.cacheKey),this.removeTexture("".concat(this.cacheKey,"_filtered")),this._element=t,this._originalElement=t,this._setWidthHeight(s),null===(e=t.classList)||void 0===e||e.add(oa.CSS_CANVAS),0!==this.filters.length&&this.applyFilters(),this.resizeFilter&&this.applyResizeFilters()}removeTexture(t){const e=na(!1);e instanceof ta&&e.evictCachesForKey(t)}dispose(){super.dispose(),this.removeTexture(this.cacheKey),this.removeTexture("".concat(this.cacheKey,"_filtered")),this._cacheContext=null,["_originalElement","_element","_filteredEl","_cacheCanvas"].forEach((t=>{const e=this[t];e&&w().dispose(e),this[t]=void 0}))}getCrossOrigin(){return this._originalElement&&(this._originalElement.crossOrigin||null)}getOriginalSize(){const t=this.getElement();return t?{width:t.naturalWidth||t.width,height:t.naturalHeight||t.height}:{width:0,height:0}}_stroke(t){if(!this.stroke||0===this.strokeWidth)return;const e=this.width/2,s=this.height/2;t.beginPath(),t.moveTo(-e,-s),t.lineTo(e,-s),t.lineTo(e,s),t.lineTo(-e,s),t.lineTo(-e,-s),t.closePath()}toObject(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];const e=[];return this.filters.forEach((t=>{t&&e.push(t.toObject())})),l(l({},super.toObject([...ra,...t])),{},{src:this.getSrc(),crossOrigin:this.getCrossOrigin(),filters:e},this.resizeFilter?{resizeFilter:this.resizeFilter.toObject()}:{})}hasCrop(){return!!this.cropX||!!this.cropY||this.width<this._element.width||this.height<this._element.height}_toSVG(){const t=[],e=this._element,s=-this.width/2,n=-this.height/2;let i=[],r=[],o="",a="";if(!e)return[];if(this.hasCrop()){const t=bt();i.push('<clipPath id="imageCrop_'+t+'">\n','\t<rect x="'+s+'" y="'+n+'" width="'+this.width+'" height="'+this.height+'" />\n',"</clipPath>\n"),o=' clip-path="url(#imageCrop_'+t+')" '}if(this.imageSmoothing||(a=' image-rendering="optimizeSpeed"'),t.push("\t<image ","COMMON_PARTS",'xlink:href="'.concat(this.getSvgSrc(!0),'" x="').concat(s-this.cropX,'" y="').concat(n-this.cropY,'" width="').concat(e.width||e.naturalWidth,'" height="').concat(e.height||e.naturalHeight,'"').concat(a).concat(o,"></image>\n")),this.stroke||this.strokeDashArray){const t=this.fill;this.fill=null,r=['\t<rect x="'.concat(s,'" y="').concat(n,'" width="').concat(this.width,'" height="').concat(this.height,'" style="').concat(this.getSvgStyles(),'" />\n')],this.fill=t}return i=this.paintFirst!==st?i.concat(r,t):i.concat(t,r),i}getSrc(t){const e=t?this._element:this._originalElement;return e?e.toDataURL?e.toDataURL():this.srcFromAttribute?e.getAttribute("src")||"":e.src:this.src||""}getSvgSrc(t){return this.getSrc(t)}setSrc(t){let{crossOrigin:e,signal:s}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return Vt(t,{crossOrigin:e,signal:s}).then((t=>{void 0!==e&&this.set({crossOrigin:e}),this.setElement(t)}))}toString(){return'#<Image: { src: "'.concat(this.getSrc(),'" }>')}applyResizeFilters(){const t=this.resizeFilter,e=this.minimumScaleTrigger,s=this.getTotalObjectScaling(),n=s.x,i=s.y,r=this._filteredEl||this._originalElement;if(this.group&&this.set("dirty",!0),!t||n>e&&i>e)return this._element=r,this._filterScalingX=1,this._filterScalingY=1,this._lastScaleX=n,void(this._lastScaleY=i);const o=St(r),{width:a,height:h}=r;this._element=o,this._lastScaleX=t.scaleX=n,this._lastScaleY=t.scaleY=i,na().applyFilters([t],r,a,h,this._element),this._filterScalingX=o.width/this._originalElement.width,this._filterScalingY=o.height/this._originalElement.height}applyFilters(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.filters||[];if(t=t.filter((t=>t&&!t.isNeutralState())),this.set("dirty",!0),this.removeTexture("".concat(this.cacheKey,"_filtered")),0===t.length)return this._element=this._originalElement,this._filteredEl=void 0,this._filterScalingX=1,void(this._filterScalingY=1);const e=this._originalElement,s=e.naturalWidth||e.width,n=e.naturalHeight||e.height;if(this._element===this._originalElement){const t=St({width:s,height:n});this._element=t,this._filteredEl=t}else this._filteredEl&&(this._element=this._filteredEl,this._filteredEl.getContext("2d").clearRect(0,0,s,n),this._lastScaleX=1,this._lastScaleY=1);na().applyFilters(t,this._originalElement,s,n,this._element,this.cacheKey),this._originalElement.width===this._element.width&&this._originalElement.height===this._element.height||(this._filterScalingX=this._element.width/this._originalElement.width,this._filterScalingY=this._element.height/this._originalElement.height)}_render(t){t.imageSmoothingEnabled=this.imageSmoothing,!0!==this.isMoving&&this.resizeFilter&&this._needsResize()&&this.applyResizeFilters(),this._stroke(t),this._renderPaintInOrder(t)}drawCacheOnCanvas(t){t.imageSmoothingEnabled=this.imageSmoothing,super.drawCacheOnCanvas(t)}shouldCache(){return this.needsItsOwnCache()}_renderFill(t){const e=this._element;if(!e)return;const s=this._filterScalingX,n=this._filterScalingY,i=this.width,r=this.height,o=Math.max(this.cropX,0),a=Math.max(this.cropY,0),h=e.naturalWidth||e.width,c=e.naturalHeight||e.height,l=o*s,u=a*n,d=Math.min(i*s,h-l),g=Math.min(r*n,c-u),p=-i/2,f=-r/2,m=Math.min(i,h/s-o),_=Math.min(r,c/n-a);e&&t.drawImage(e,l,u,d,g,p,f,m,_)}_needsResize(){const t=this.getTotalObjectScaling();return t.x!==this._lastScaleX||t.y!==this._lastScaleY}_resetWidthHeight(){this.set(this.getOriginalSize())}_setWidthHeight(){let{width:t,height:e}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};const s=this.getOriginalSize();this.width=t||s.width,this.height=e||s.height}parsePreserveAspectRatioAttribute(){const t=Ve(this.preserveAspectRatio||""),e=this.width,s=this.height,n={width:e,height:s};let i,r=this._element.width,o=this._element.height,a=1,h=1,c=0,l=0,u=0,d=0;return!t||t.alignX===W&&t.alignY===W?(a=e/r,h=s/o):("meet"===t.meetOrSlice&&(a=h=tr(this._element,n),i=(e-r*a)/2,"Min"===t.alignX&&(c=-i),"Max"===t.alignX&&(c=i),i=(s-o*h)/2,"Min"===t.alignY&&(l=-i),"Max"===t.alignY&&(l=i)),"slice"===t.meetOrSlice&&(a=h=er(this._element,n),i=r-e/a,"Mid"===t.alignX&&(u=i/2),"Max"===t.alignX&&(u=i),i=o-s/h,"Mid"===t.alignY&&(d=i/2),"Max"===t.alignY&&(d=i),r=e/a,o=s/h)),{width:r,height:o,scaleX:a,scaleY:h,offsetLeft:c,offsetTop:l,cropX:u,cropY:d}}static fromObject(t,e){let{filters:s,resizeFilter:n,src:i,crossOrigin:r,type:o}=t,a=u(t,ia);return Promise.all([Vt(i,l(l({},e),{},{crossOrigin:r})),s&&Gt(s,e),n&&Gt([n],e),Ht(a,e)]).then((t=>{let[e,s=[],[n]=[],r={}]=t;return new this(e,l(l({},a),{},{src:i,filters:s,resizeFilter:n},r))}))}static fromURL(t){let{crossOrigin:e=null,signal:s}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=arguments.length>2?arguments[2]:void 0;return Vt(t,{crossOrigin:e,signal:s}).then((t=>new this(t,n)))}static async fromElement(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},s=arguments.length>2?arguments[2]:void 0;const n=Li(t,this.ATTRIBUTE_NAMES,s);return this.fromURL(n["xlink:href"]||n.href,e,n).catch((t=>(f("log","Unable to parse Image",t),null)))}}function aa(t){if(!ms.test(t.nodeName))return{};const e=t.getAttribute("viewBox");let s,n,i=1,r=1,o=0,a=0;const h=t.getAttribute("width"),c=t.getAttribute("height"),l=t.getAttribute("x")||0,u=t.getAttribute("y")||0,d=!(e&&vs.test(e)),g=!h||!c||"100%"===h||"100%"===c;let p="",f=0,m=0;if(d&&(l||u)&&t.parentNode&&"#document"!==t.parentNode.nodeName&&(p=" translate("+Xe(l||"0")+" "+Xe(u||"0")+") ",s=(t.getAttribute("transform")||"")+p,t.setAttribute("transform",s),t.removeAttribute("x"),t.removeAttribute("y")),d&&g)return{width:0,height:0};const _={width:0,height:0};if(d)return _.width=Xe(h),_.height=Xe(c),_;const v=e.match(vs);o=-parseFloat(v[1]),a=-parseFloat(v[2]);const y=parseFloat(v[3]),C=parseFloat(v[4]);_.minX=o,_.minY=a,_.viewBoxWidth=y,_.viewBoxHeight=C,g?(_.width=y,_.height=C):(_.width=Xe(h),_.height=Xe(c),i=_.width/y,r=_.height/C);const b=Ve(t.getAttribute("preserveAspectRatio")||"");if(b.alignX!==W&&("meet"===b.meetOrSlice&&(r=i=i>r?r:i),"slice"===b.meetOrSlice&&(r=i=i>r?i:r),f=_.width-y*i,m=_.height-C*i,"Mid"===b.alignX&&(f/=2),"Mid"===b.alignY&&(m/=2),"Min"===b.alignX&&(f=0),"Min"===b.alignY&&(m=0)),1===i&&1===r&&0===o&&0===a&&0===l&&0===u)return _;if((l||u)&&"#document"!==t.parentNode.nodeName&&(p=" translate("+Xe(l||"0")+" "+Xe(u||"0")+") "),s=p+" matrix("+i+" 0 0 "+r+" "+(o*i+f)+" "+(a*r+m)+") ","svg"===t.nodeName){for(n=t.ownerDocument.createElementNS(ls,"g");t.firstChild;)n.appendChild(t.firstChild);t.appendChild(n)}else n=t,n.removeAttribute("x"),n.removeAttribute("y"),s=n.getAttribute("transform")+s;return n.setAttribute("transform",s),_}h(oa,"type","Image"),h(oa,"cacheProperties",[...Ls,...ra]),h(oa,"ownDefaults",{strokeWidth:0,srcFromAttribute:!1,minimumScaleTrigger:.5,cropX:0,cropY:0,imageSmoothing:!0}),h(oa,"CSS_CANVAS","canvas-img"),h(oa,"ATTRIBUTE_NAMES",[...ii,"x","y","width","height","preserveAspectRatio","xlink:href","href","crossOrigin","image-rendering"]),at.setClass(oa),at.setSVGClass(oa);const ha=t=>t.tagName.replace("svg:",""),ca=ze(["pattern","defs","symbol","metadata","clipPath","mask","desc"]);function la(t,e){let s,n,i,r,o=[];for(i=0,r=e.length;i<r;i++)s=e[i],n=t.getElementsByTagNameNS("http://www.w3.org/2000/svg",s),o=o.concat(Array.from(n));return o}const ua=["gradientTransform","x1","x2","y1","y2","gradientUnits","cx","cy","r","fx","fy"],da="xlink:href";function ga(t,e){var s;const n=(null===(s=e.getAttribute(da))||void 0===s?void 0:s.slice(1))||"",i=t.getElementById(n);if(i&&i.getAttribute(da)&&ga(t,i),i&&(ua.forEach((t=>{const s=i.getAttribute(t);!e.hasAttribute(t)&&s&&e.setAttribute(t,s)})),!e.children.length)){const t=i.cloneNode(!0);for(;t.firstChild;)e.appendChild(t.firstChild)}e.removeAttribute(da)}const pa=["linearGradient","radialGradient","svg:linearGradient","svg:radialGradient"];function fa(t){const e=t.getElementsByTagName("style");let s,n;const i={};for(s=0,n=e.length;s<n;s++){const t=(e[s].textContent||"").replace(/\/\*[\s\S]*?\*\//g,"");""!==t.trim()&&t.split("}").filter(((t,e,s)=>s.length>1&&t.trim())).forEach((t=>{if((t.match(/{/g)||[]).length>1&&t.trim().startsWith("@"))return;const e=t.split("{"),r={},o=e[1].trim().split(";").filter((function(t){return t.trim()}));for(s=0,n=o.length;s<n;s++){const t=o[s].split(":"),e=t[0].trim(),n=t[1].trim();r[e]=n}(t=e[0].trim()).split(",").forEach((t=>{""!==(t=t.replace(/^svg/i,"").trim())&&(i[t]=l(l({},i[t]||{}),r))}))}))}return i}const ma=t=>at.getSVGClass(ha(t).toLowerCase());class _a{constructor(t,e,s,n,i){this.elements=t,this.options=e,this.reviver=s,this.regexUrl=/^url\(['"]?#([^'"]+)['"]?\)/g,this.doc=n,this.clipPaths=i,this.gradientDefs=function(t){const e=la(t,pa),s={};let n=e.length;for(;n--;){const i=e[n];i.getAttribute("xlink:href")&&ga(t,i);const r=i.getAttribute("id");r&&(s[r]=i)}return s}(n),this.cssRules=fa(n)}parse(){return Promise.all(this.elements.map((t=>this.createObject(t))))}async createObject(t){const e=ma(t);if(e){const s=await e.fromElement(t,this.options,this.cssRules);return this.resolveGradient(s,t,st),this.resolveGradient(s,t,nt),s instanceof oa&&s._originalElement?Mr(s,s.parsePreserveAspectRatioAttribute()):Mr(s),await this.resolveClipPath(s,t),this.reviver&&this.reviver(t,s),s}return null}extractPropertyDefinition(t,e,s){const n=t[e],i=this.regexUrl;if(!i.test(n))return;i.lastIndex=0;const r=i.exec(n)[1];return i.lastIndex=0,s[r]}resolveGradient(t,e,s){const n=this.extractPropertyDefinition(t,s,this.gradientDefs);if(n){const i=e.getAttribute(s+"-opacity"),r=ro.fromElement(n,t,l(l({},this.options),{},{opacity:i}));t.set(s,r)}}async resolveClipPath(t,e,s){const n=this.extractPropertyDefinition(t,"clipPath",this.clipPaths);if(n){const i=Pt(t.calcTransformMatrix()),r=n[0].parentElement;let o=e;for(;!s&&o.parentElement&&o.getAttribute("clip-path")!==t.clipPath;)o=o.parentElement;o.parentElement.appendChild(r);const a=Di("".concat(o.getAttribute("transform")||""," ").concat(r.getAttribute("originalTransform")||""));r.setAttribute("transform","matrix(".concat(a.join(","),")"));const h=await Promise.all(n.map((t=>ma(t).fromElement(t,this.options,this.cssRules).then((t=>(Mr(t),t.fillRule=t.clipRule,delete t.clipRule,t)))))),c=1===h.length?h[0]:new $i(h),l=It(i,c.calcTransformMatrix());c.clipPath&&await this.resolveClipPath(c,o,r.getAttribute("clip-path")?o:void 0);const{scaleX:u,scaleY:d,angle:g,skewX:p,translateX:f,translateY:m}=Ft(l);c.set({flipX:!1,flipY:!1}),c.set({scaleX:u,scaleY:d,angle:g,skewX:p,skewY:0}),c.setPositionByOrigin(new gt(f,m),F,F),t.clipPath=c}else delete t.clipPath}}const va=t=>fs.test(ha(t)),ya=()=>({objects:[],elements:[],options:{},allElements:[]});async function Ca(t,e){let{crossOrigin:s,signal:n}=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};if(n&&n.aborted)return f("log",new _("parseSVGDocument")),ya();const i=t.documentElement;!function(t){const e=la(t,["use","svg:use"]),s=["x","y","xlink:href","href","transform"];for(const n of e){const e=n.attributes,i={};for(const t of e)t.value&&(i[t.name]=t.value);const r=(i["xlink:href"]||i.href||"").slice(1);if(""===r)return;const o=t.getElementById(r);if(null===o)return;let a=o.cloneNode(!0);const h=a.attributes,c={};for(const t of h)t.value&&(c[t.name]=t.value);const{x:l=0,y:u=0,transform:d=""}=i,g="".concat(d," ").concat(c.transform||""," translate(").concat(l,", ").concat(u,")");if(aa(a),/^svg$/i.test(a.nodeName)){const t=a.ownerDocument.createElementNS(ls,"g");Object.entries(c).forEach((e=>{let[s,n]=e;return t.setAttributeNS(ls,s,n)})),t.append(...a.childNodes),a=t}for(const t of e){if(!t)continue;const{name:e,value:n}=t;if(!s.includes(e))if("style"===e){const t={};Mi(n,t),Object.entries(c).forEach((e=>{let[s,n]=e;t[s]=n})),Mi(c.style||"",t);const s=Object.entries(t).map((t=>t.join(":"))).join(";");a.setAttribute(e,s)}else!c[e]&&a.setAttribute(e,n)}a.setAttribute("transform",g),a.setAttribute("instantiated_by_use","1"),a.removeAttribute("id"),n.parentNode.replaceChild(a,n)}}(t);const r=Array.from(i.getElementsByTagName("*")),o=l(l({},aa(i)),{},{crossOrigin:s,signal:n}),a=r.filter((t=>(aa(t),va(t)&&!function(t){let e=t;for(;e&&(e=e.parentElement);)if(e&&e.nodeName&&ca.test(ha(e))&&!e.getAttribute("instantiated_by_use"))return!0;return!1}(t))));if(!a||a&&!a.length)return l(l({},ya()),{},{options:o,allElements:r});const h={};r.filter((t=>"clipPath"===ha(t))).forEach((t=>{t.setAttribute("originalTransform",t.getAttribute("transform")||"");const e=t.getAttribute("id");h[e]=Array.from(t.getElementsByTagName("*")).filter((t=>va(t)))}));const c=new _a(a,o,e,t,h);return{objects:await c.parse(),elements:a,options:o,allElements:r}}function ba(t,e){let s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return new Promise(((e,n)=>{Ir(t.replace(/^\n\s*/,"").trim(),{onComplete:t=>{const s=t.responseXML;s&&e(s),n()},signal:s.signal})})).then((t=>Ca(t,e,s))).catch((()=>ya()))}const wa=q,xa=t=>function(e,s,n){const{points:i,pathOffset:r}=n;return new gt(i[t]).subtract(r).transform(It(n.getViewportTransform(),n.calcTransformMatrix()))},Sa=(t,e,s,n)=>{const{target:i,pointIndex:r}=e,o=i,a=we(new gt(s,n),void 0,o.calcOwnMatrix());return o.points[r]=a.add(o.pathOffset),o.setDimensions(),o.set("dirty",!0),!0},Ta=(t,e)=>function(s,n,i,r){const o=n.target,a=new gt(o.points[(t>0?t:o.points.length)-1]),h=a.subtract(o.pathOffset).transform(o.calcOwnMatrix()),c=e(s,l(l({},n),{},{pointIndex:t}),i,r),u=a.subtract(o.pathOffset).transform(o.calcOwnMatrix()).subtract(h);return o.left-=u.x,o.top-=u.y,c},ka=t=>hn(wa,Ta(t,Sa)),Aa=(t,e,s)=>{const{path:n,pathOffset:i}=t,r=n[e];return new gt(r[s]-i.x,r[s+1]-i.y).transform(It(t.getViewportTransform(),t.calcTransformMatrix()))};function Ea(t,e,s){const{commandIndex:n,pointIndex:i}=this;return Aa(s,n,i)}function Oa(t,e,s,n){const{target:i}=e,{commandIndex:r,pointIndex:o}=this,a=((t,e,s,n,i)=>{const{path:r,pathOffset:o}=t,a=r[(n>0?n:r.length)-1],h=new gt(a[i],a[i+1]),c=h.subtract(o).transform(t.calcOwnMatrix()),l=we(new gt(e,s),void 0,t.calcOwnMatrix());r[n][i]=l.x+o.x,r[n][i+1]=l.y+o.y,t.setDimensions();const u=h.subtract(t.pathOffset).transform(t.calcOwnMatrix()).subtract(c);return t.left-=u.x,t.top-=u.y,t.set("dirty",!0),!0})(i,s,n,r,o);return Te(this.actionName,l(l({},Ie(t,e,s,n)),{},{commandIndex:r,pointIndex:o})),a}class Da extends gn{constructor(t){super(t)}render(t,e,s,n,i){const r=l(l({},n),{},{cornerColor:this.controlFill,cornerStrokeColor:this.controlStroke,transparentCorners:!this.controlFill});super.render(t,e,s,r,i)}}class Pa extends Da{constructor(t){super(t)}render(t,e,s,n,i){const{path:r}=i,{commandIndex:o,pointIndex:a,connectToCommandIndex:h,connectToPointIndex:c}=this;t.save(),t.strokeStyle=this.controlStroke,this.connectionDashArray&&t.setLineDash(this.connectionDashArray);const[l]=r[o],u=Aa(i,h,c);if("Q"===l){const n=Aa(i,o,a+2);t.moveTo(n.x,n.y),t.lineTo(e,s)}else t.moveTo(e,s);t.lineTo(u.x,u.y),t.stroke(),t.restore(),super.render(t,e,s,n,i)}}const Ia=(t,e,s,n,i,r)=>new(s?Pa:Da)(l(l({commandIndex:t,pointIndex:e,actionName:"modifyPath",positionHandler:Ea,actionHandler:Oa,connectToCommandIndex:i,connectToPointIndex:r},n),s?n.controlPointStyle:n.pointStyle));var Ma=Object.freeze({__proto__:null,changeWidth:ln,createObjectDefaultControls:Ln,createPathControls:function(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const s={};let n="M";return t.path.forEach(((t,i)=>{const r=t[0];switch("Z"!==r&&(s["c_".concat(i,"_").concat(r)]=Ia(i,t.length-2,!1,e)),r){case"C":s["c_".concat(i,"_C_CP_1")]=Ia(i,1,!0,e,i-1,(t=>"C"===t?5:"Q"===t?3:1)(n)),s["c_".concat(i,"_C_CP_2")]=Ia(i,3,!0,e,i,5);break;case"Q":s["c_".concat(i,"_Q_CP_1")]=Ia(i,1,!0,e,i,3)}n=r})),s},createPolyActionHandler:ka,createPolyControls:function(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const s={};for(let n=0;n<("number"==typeof t?t:t.points.length);n++)s["p".concat(n)]=new gn(l({actionName:wa,positionHandler:xa(n),actionHandler:ka(n)},e));return s},createPolyPositionHandler:xa,createResizeControls:jn,createTextboxDefaultControls:Nn,dragHandler:Fe,factoryPolyActionHandler:Ta,getLocalPoint:Re,polyActionHandler:Sa,renderCircleControl:un,renderSquareControl:dn,rotationStyleHandler:pn,rotationWithSnapping:fn,scaleCursorStyleHandler:yn,scaleOrSkewActionName:In,scaleSkewCursorStyleHandler:Mn,scalingEqually:bn,scalingX:wn,scalingXOrSkewingY:Rn,scalingY:xn,scalingYOrSkewingX:Fn,skewCursorStyleHandler:An,skewHandlerX:On,skewHandlerY:Dn,wrapWithFireEvent:hn,wrapWithFixedAnchor:cn});const Ra=t=>void 0!==t.webgl,Fa="precision highp float",La="\n    ".concat(Fa,";\n    varying vec2 vTexCoord;\n    uniform sampler2D uTexture;\n    void main() {\n      gl_FragColor = texture2D(uTexture, vTexCoord);\n    }"),ja=["type"],Na=["type"],Ba=new RegExp(Fa,"g");class Wa{get type(){return this.constructor.type}constructor(){let t=u(arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},ja);Object.assign(this,this.constructor.defaults,t)}getFragmentSource(){return La}getVertexSource(){return"\n    attribute vec2 aPosition;\n    varying vec2 vTexCoord;\n    void main() {\n      vTexCoord = aPosition;\n      gl_Position = vec4(aPosition * 2.0 - 1.0, 0.0, 1.0);\n    }"}createProgram(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.getFragmentSource(),s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:this.getVertexSource();const{WebGLProbe:{GLPrecision:n="highp"}}=w();"highp"!==n&&(e=e.replace(Ba,Fa.replace("highp",n)));const i=t.createShader(t.VERTEX_SHADER),r=t.createShader(t.FRAGMENT_SHADER),o=t.createProgram();if(!i||!r||!o)throw new m("Vertex, fragment shader or program creation error");if(t.shaderSource(i,s),t.compileShader(i),!t.getShaderParameter(i,t.COMPILE_STATUS))throw new m("Vertex shader compile error for ".concat(this.type,": ").concat(t.getShaderInfoLog(i)));if(t.shaderSource(r,e),t.compileShader(r),!t.getShaderParameter(r,t.COMPILE_STATUS))throw new m("Fragment shader compile error for ".concat(this.type,": ").concat(t.getShaderInfoLog(r)));if(t.attachShader(o,i),t.attachShader(o,r),t.linkProgram(o),!t.getProgramParameter(o,t.LINK_STATUS))throw new m('Shader link error for "'.concat(this.type,'" ').concat(t.getProgramInfoLog(o)));const a=this.getUniformLocations(t,o)||{};return a.uStepW=t.getUniformLocation(o,"uStepW"),a.uStepH=t.getUniformLocation(o,"uStepH"),{program:o,attributeLocations:this.getAttributeLocations(t,o),uniformLocations:a}}getAttributeLocations(t,e){return{aPosition:t.getAttribLocation(e,"aPosition")}}getUniformLocations(t,e){const s=this.constructor.uniformLocations,n={};for(let i=0;i<s.length;i++)n[s[i]]=t.getUniformLocation(e,s[i]);return n}sendAttributeData(t,e,s){const n=e.aPosition,i=t.createBuffer();t.bindBuffer(t.ARRAY_BUFFER,i),t.enableVertexAttribArray(n),t.vertexAttribPointer(n,2,t.FLOAT,!1,0,0),t.bufferData(t.ARRAY_BUFFER,s,t.STATIC_DRAW)}_setupFrameBuffer(t){const e=t.context;if(t.passes>1){const s=t.destinationWidth,n=t.destinationHeight;t.sourceWidth===s&&t.sourceHeight===n||(e.deleteTexture(t.targetTexture),t.targetTexture=t.filterBackend.createTexture(e,s,n)),e.framebufferTexture2D(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0,e.TEXTURE_2D,t.targetTexture,0)}else e.bindFramebuffer(e.FRAMEBUFFER,null),e.finish()}_swapTextures(t){t.passes--,t.pass++;const e=t.targetTexture;t.targetTexture=t.sourceTexture,t.sourceTexture=e}isNeutralState(t){return!1}applyTo(t){Ra(t)?(this._setupFrameBuffer(t),this.applyToWebGL(t),this._swapTextures(t)):this.applyTo2d(t)}applyTo2d(t){}getCacheKey(){return this.type}retrieveShader(t){const e=this.getCacheKey();return t.programCache[e]||(t.programCache[e]=this.createProgram(t.context)),t.programCache[e]}applyToWebGL(t){const e=t.context,s=this.retrieveShader(t);0===t.pass&&t.originalTexture?e.bindTexture(e.TEXTURE_2D,t.originalTexture):e.bindTexture(e.TEXTURE_2D,t.sourceTexture),e.useProgram(s.program),this.sendAttributeData(e,s.attributeLocations,t.aPosition),e.uniform1f(s.uniformLocations.uStepW,1/t.sourceWidth),e.uniform1f(s.uniformLocations.uStepH,1/t.sourceHeight),this.sendUniformData(e,s.uniformLocations),e.viewport(0,0,t.destinationWidth,t.destinationHeight),e.drawArrays(e.TRIANGLE_STRIP,0,4)}bindAdditionalTexture(t,e,s){t.activeTexture(s),t.bindTexture(t.TEXTURE_2D,e),t.activeTexture(t.TEXTURE0)}unbindAdditionalTexture(t,e){t.activeTexture(e),t.bindTexture(t.TEXTURE_2D,null),t.activeTexture(t.TEXTURE0)}sendUniformData(t,e){}createHelpLayer(t){if(!t.helpLayer){const{sourceWidth:e,sourceHeight:s}=t,n=St({width:e,height:s});t.helpLayer=n}}toObject(){const t=Object.keys(this.constructor.defaults||{});return l({type:this.type},t.reduce(((t,e)=>(t[e]=this[e],t)),{}))}toJSON(){return this.toObject()}static async fromObject(t,e){return new this(u(t,Na))}}h(Wa,"type","BaseFilter"),h(Wa,"uniformLocations",[]);const Ua={multiply:"gl_FragColor.rgb *= uColor.rgb;\n",screen:"gl_FragColor.rgb = 1.0 - (1.0 - gl_FragColor.rgb) * (1.0 - uColor.rgb);\n",add:"gl_FragColor.rgb += uColor.rgb;\n",difference:"gl_FragColor.rgb = abs(gl_FragColor.rgb - uColor.rgb);\n",subtract:"gl_FragColor.rgb -= uColor.rgb;\n",lighten:"gl_FragColor.rgb = max(gl_FragColor.rgb, uColor.rgb);\n",darken:"gl_FragColor.rgb = min(gl_FragColor.rgb, uColor.rgb);\n",exclusion:"gl_FragColor.rgb += uColor.rgb - 2.0 * (uColor.rgb * gl_FragColor.rgb);\n",overlay:"\n    if (uColor.r < 0.5) {\n      gl_FragColor.r *= 2.0 * uColor.r;\n    } else {\n      gl_FragColor.r = 1.0 - 2.0 * (1.0 - gl_FragColor.r) * (1.0 - uColor.r);\n    }\n    if (uColor.g < 0.5) {\n      gl_FragColor.g *= 2.0 * uColor.g;\n    } else {\n      gl_FragColor.g = 1.0 - 2.0 * (1.0 - gl_FragColor.g) * (1.0 - uColor.g);\n    }\n    if (uColor.b < 0.5) {\n      gl_FragColor.b *= 2.0 * uColor.b;\n    } else {\n      gl_FragColor.b = 1.0 - 2.0 * (1.0 - gl_FragColor.b) * (1.0 - uColor.b);\n    }\n    ",tint:"\n    gl_FragColor.rgb *= (1.0 - uColor.a);\n    gl_FragColor.rgb += uColor.rgb;\n    "};class Ya extends Wa{getCacheKey(){return"".concat(this.type,"_").concat(this.mode)}getFragmentSource(){return"\n      precision highp float;\n      uniform sampler2D uTexture;\n      uniform vec4 uColor;\n      varying vec2 vTexCoord;\n      void main() {\n        vec4 color = texture2D(uTexture, vTexCoord);\n        gl_FragColor = color;\n        if (color.a > 0.0) {\n          ".concat(Ua[this.mode],"\n        }\n      }\n      ")}applyTo2d(t){let{imageData:{data:e}}=t;const s=new Ye(this.color).getSource(),n=this.alpha,i=s[0]*n,r=s[1]*n,o=s[2]*n,a=1-n;for(let h=0;h<e.length;h+=4){const t=e[h],s=e[h+1],n=e[h+2];let c,l,u;switch(this.mode){case"multiply":c=t*i/255,l=s*r/255,u=n*o/255;break;case"screen":c=255-(255-t)*(255-i)/255,l=255-(255-s)*(255-r)/255,u=255-(255-n)*(255-o)/255;break;case"add":c=t+i,l=s+r,u=n+o;break;case"difference":c=Math.abs(t-i),l=Math.abs(s-r),u=Math.abs(n-o);break;case"subtract":c=t-i,l=s-r,u=n-o;break;case"darken":c=Math.min(t,i),l=Math.min(s,r),u=Math.min(n,o);break;case"lighten":c=Math.max(t,i),l=Math.max(s,r),u=Math.max(n,o);break;case"overlay":c=i<128?2*t*i/255:255-2*(255-t)*(255-i)/255,l=r<128?2*s*r/255:255-2*(255-s)*(255-r)/255,u=o<128?2*n*o/255:255-2*(255-n)*(255-o)/255;break;case"exclusion":c=i+t-2*i*t/255,l=r+s-2*r*s/255,u=o+n-2*o*n/255;break;case"tint":c=i+t*a,l=r+s*a,u=o+n*a}e[h]=c,e[h+1]=l,e[h+2]=u}}sendUniformData(t,e){const s=new Ye(this.color).getSource();s[0]=this.alpha*s[0]/255,s[1]=this.alpha*s[1]/255,s[2]=this.alpha*s[2]/255,s[3]=this.alpha,t.uniform4fv(e.uColor,s)}}h(Ya,"defaults",{color:"#F95C63",mode:"multiply",alpha:1}),h(Ya,"type","BlendColor"),h(Ya,"uniformLocations",["uColor"]),at.setClass(Ya);const Xa={multiply:"\n    precision highp float;\n    uniform sampler2D uTexture;\n    uniform sampler2D uImage;\n    uniform vec4 uColor;\n    varying vec2 vTexCoord;\n    varying vec2 vTexCoord2;\n    void main() {\n      vec4 color = texture2D(uTexture, vTexCoord);\n      vec4 color2 = texture2D(uImage, vTexCoord2);\n      color.rgba *= color2.rgba;\n      gl_FragColor = color;\n    }\n    ",mask:"\n    precision highp float;\n    uniform sampler2D uTexture;\n    uniform sampler2D uImage;\n    uniform vec4 uColor;\n    varying vec2 vTexCoord;\n    varying vec2 vTexCoord2;\n    void main() {\n      vec4 color = texture2D(uTexture, vTexCoord);\n      vec4 color2 = texture2D(uImage, vTexCoord2);\n      color.a = color2.a;\n      gl_FragColor = color;\n    }\n    "},Va=["type","image"];class Ga extends Wa{getCacheKey(){return"".concat(this.type,"_").concat(this.mode)}getFragmentSource(){return Xa[this.mode]}getVertexSource(){return"\n    attribute vec2 aPosition;\n    varying vec2 vTexCoord;\n    varying vec2 vTexCoord2;\n    uniform mat3 uTransformMatrix;\n    void main() {\n      vTexCoord = aPosition;\n      vTexCoord2 = (uTransformMatrix * vec3(aPosition, 1.0)).xy;\n      gl_Position = vec4(aPosition * 2.0 - 1.0, 0.0, 1.0);\n    }\n    "}applyToWebGL(t){const e=t.context,s=this.createTexture(t.filterBackend,this.image);this.bindAdditionalTexture(e,s,e.TEXTURE1),super.applyToWebGL(t),this.unbindAdditionalTexture(e,e.TEXTURE1)}createTexture(t,e){return t.getCachedTexture(e.cacheKey,e.getElement())}calculateMatrix(){const t=this.image,{width:e,height:s}=t.getElement();return[1/t.scaleX,0,0,0,1/t.scaleY,0,-t.left/e,-t.top/s,1]}applyTo2d(t){let{imageData:{data:e,width:s,height:n},filterBackend:{resources:i}}=t;const r=this.image;i.blendImage||(i.blendImage=wt());const o=i.blendImage,a=o.getContext("2d");o.width!==s||o.height!==n?(o.width=s,o.height=n):a.clearRect(0,0,s,n),a.setTransform(r.scaleX,0,0,r.scaleY,r.left,r.top),a.drawImage(r.getElement(),0,0,s,n);const h=a.getImageData(0,0,s,n).data;for(let c=0;c<e.length;c+=4){const t=e[c],s=e[c+1],n=e[c+2],i=e[c+3],r=h[c],o=h[c+1],a=h[c+2],l=h[c+3];switch(this.mode){case"multiply":e[c]=t*r/255,e[c+1]=s*o/255,e[c+2]=n*a/255,e[c+3]=i*l/255;break;case"mask":e[c+3]=l}}}sendUniformData(t,e){const s=this.calculateMatrix();t.uniform1i(e.uImage,1),t.uniformMatrix3fv(e.uTransformMatrix,!1,s)}toObject(){return l(l({},super.toObject()),{},{image:this.image&&this.image.toObject()})}static async fromObject(t,e){let{type:s,image:n}=t,i=u(t,Va);return oa.fromObject(n,e).then((t=>new this(l(l({},i),{},{image:t}))))}}h(Ga,"type","BlendImage"),h(Ga,"defaults",{mode:"multiply",alpha:1}),h(Ga,"uniformLocations",["uTransformMatrix","uImage"]),at.setClass(Ga);class Ha extends Wa{getFragmentSource(){return"\n    precision highp float;\n    uniform sampler2D uTexture;\n    uniform vec2 uDelta;\n    varying vec2 vTexCoord;\n    const float nSamples = 15.0;\n    vec3 v3offset = vec3(12.9898, 78.233, 151.7182);\n    float random(vec3 scale) {\n      /* use the fragment position for a different seed per-pixel */\n      return fract(sin(dot(gl_FragCoord.xyz, scale)) * 43758.5453);\n    }\n    void main() {\n      vec4 color = vec4(0.0);\n      float totalC = 0.0;\n      float totalA = 0.0;\n      float offset = random(v3offset);\n      for (float t = -nSamples; t <= nSamples; t++) {\n        float percent = (t + offset - 0.5) / nSamples;\n        vec4 sample = texture2D(uTexture, vTexCoord + uDelta * percent);\n        float weight = 1.0 - abs(percent);\n        float alpha = weight * sample.a;\n        color.rgb += sample.rgb * alpha;\n        color.a += alpha;\n        totalA += weight;\n        totalC += alpha;\n      }\n      gl_FragColor.rgb = color.rgb / totalC;\n      gl_FragColor.a = color.a / totalA;\n    }\n  "}applyTo(t){Ra(t)?(this.aspectRatio=t.sourceWidth/t.sourceHeight,t.passes++,this._setupFrameBuffer(t),this.horizontal=!0,this.applyToWebGL(t),this._swapTextures(t),this._setupFrameBuffer(t),this.horizontal=!1,this.applyToWebGL(t),this._swapTextures(t)):this.applyTo2d(t)}applyTo2d(t){let{imageData:{data:e,width:s,height:n}}=t;this.aspectRatio=s/n,this.horizontal=!0;let i=this.getBlurValue()*s;const r=new Uint8ClampedArray(e),o=15,a=4*s;for(let h=0;h<e.length;h+=4){let t=0,s=0,n=0,c=0,l=0;const u=h-h%a,d=u+a;for(let r=-14;r<o;r++){const a=r/o,g=4*Math.floor(i*a),p=1-Math.abs(a);let f=h+g;f<u?f=u:f>d&&(f=d);const m=e[f+3]*p;t+=e[f]*m,s+=e[f+1]*m,n+=e[f+2]*m,c+=m,l+=p}r[h]=t/c,r[h+1]=s/c,r[h+2]=n/c,r[h+3]=c/l}this.horizontal=!1,i=this.getBlurValue()*n;for(let h=0;h<r.length;h+=4){let t=0,s=0,n=0,c=0,l=0;const u=h%a,d=r.length-a+u;for(let e=-14;e<o;e++){const g=e/o,p=Math.floor(i*g)*a,f=1-Math.abs(g);let m=h+p;m<u?m=u:m>d&&(m=d);const _=r[m+3]*f;t+=r[m]*_,s+=r[m+1]*_,n+=r[m+2]*_,c+=_,l+=f}e[h]=t/c,e[h+1]=s/c,e[h+2]=n/c,e[h+3]=c/l}}sendUniformData(t,e){const s=this.chooseRightDelta();t.uniform2fv(e.uDelta,s)}isNeutralState(){return 0===this.blur}getBlurValue(){let t=1;const{horizontal:e,aspectRatio:s}=this;return e?s>1&&(t=1/s):s<1&&(t=s),t*this.blur*.12}chooseRightDelta(){const t=this.getBlurValue();return this.horizontal?[t,0]:[0,t]}}h(Ha,"type","Blur"),h(Ha,"defaults",{blur:0}),h(Ha,"uniformLocations",["uDelta"]),at.setClass(Ha);class za extends Wa{getFragmentSource(){return"\n  precision highp float;\n  uniform sampler2D uTexture;\n  uniform float uBrightness;\n  varying vec2 vTexCoord;\n  void main() {\n    vec4 color = texture2D(uTexture, vTexCoord);\n    color.rgb += uBrightness;\n    gl_FragColor = color;\n  }\n"}applyTo2d(t){let{imageData:{data:e}}=t;const s=Math.round(255*this.brightness);for(let n=0;n<e.length;n+=4)e[n]+=s,e[n+1]+=s,e[n+2]+=s}isNeutralState(){return 0===this.brightness}sendUniformData(t,e){t.uniform1f(e.uBrightness,this.brightness)}}h(za,"type","Brightness"),h(za,"defaults",{brightness:0}),h(za,"uniformLocations",["uBrightness"]),at.setClass(za);const qa={matrix:[1,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,1,0],colorsOnly:!0};class Ka extends Wa{getFragmentSource(){return"\n  precision highp float;\n  uniform sampler2D uTexture;\n  varying vec2 vTexCoord;\n  uniform mat4 uColorMatrix;\n  uniform vec4 uConstants;\n  void main() {\n    vec4 color = texture2D(uTexture, vTexCoord);\n    color *= uColorMatrix;\n    color += uConstants;\n    gl_FragColor = color;\n  }"}applyTo2d(t){const e=t.imageData.data,s=this.matrix,n=this.colorsOnly;for(let i=0;i<e.length;i+=4){const t=e[i],r=e[i+1],o=e[i+2];if(e[i]=t*s[0]+r*s[1]+o*s[2]+255*s[4],e[i+1]=t*s[5]+r*s[6]+o*s[7]+255*s[9],e[i+2]=t*s[10]+r*s[11]+o*s[12]+255*s[14],!n){const n=e[i+3];e[i]+=n*s[3],e[i+1]+=n*s[8],e[i+2]+=n*s[13],e[i+3]=t*s[15]+r*s[16]+o*s[17]+n*s[18]+255*s[19]}}}sendUniformData(t,e){const s=this.matrix,n=[s[0],s[1],s[2],s[3],s[5],s[6],s[7],s[8],s[10],s[11],s[12],s[13],s[15],s[16],s[17],s[18]],i=[s[4],s[9],s[14],s[19]];t.uniformMatrix4fv(e.uColorMatrix,!1,n),t.uniform4fv(e.uConstants,i)}toObject(){return l(l({},super.toObject()),{},{matrix:[...this.matrix]})}}function Qa(t,e){var s;const n=(h(s=class extends Ka{toObject(){return{type:this.type,colorsOnly:this.colorsOnly}}},"type",t),h(s,"defaults",{colorsOnly:!1,matrix:e}),s);return at.setClass(n,t),n}h(Ka,"type","ColorMatrix"),h(Ka,"defaults",qa),h(Ka,"uniformLocations",["uColorMatrix","uConstants"]),at.setClass(Ka);const Ja=Qa("Brownie",[.5997,.34553,-.27082,0,.186,-.0377,.86095,.15059,0,-.1449,.24113,-.07441,.44972,0,-.02965,0,0,0,1,0]),Za=Qa("Vintage",[.62793,.32021,-.03965,0,.03784,.02578,.64411,.03259,0,.02926,.0466,-.08512,.52416,0,.02023,0,0,0,1,0]),$a=Qa("Kodachrome",[1.12855,-.39673,-.03992,0,.24991,-.16404,1.08352,-.05498,0,.09698,-.16786,-.56034,1.60148,0,.13972,0,0,0,1,0]),th=Qa("Technicolor",[1.91252,-.85453,-.09155,0,.04624,-.30878,1.76589,-.10601,0,-.27589,-.2311,-.75018,1.84759,0,.12137,0,0,0,1,0]),eh=Qa("Polaroid",[1.438,-.062,-.062,0,0,-.122,1.378,-.122,0,0,-.016,-.016,1.483,0,0,0,0,0,1,0]),sh=Qa("Sepia",[.393,.769,.189,0,0,.349,.686,.168,0,0,.272,.534,.131,0,0,0,0,0,1,0]),nh=Qa("BlackWhite",[1.5,1.5,1.5,0,-1,1.5,1.5,1.5,0,-1,1.5,1.5,1.5,0,-1,0,0,0,1,0]);class ih extends Wa{constructor(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};super(t),this.subFilters=t.subFilters||[]}applyTo(t){Ra(t)&&(t.passes+=this.subFilters.length-1),this.subFilters.forEach((e=>{e.applyTo(t)}))}toObject(){return{type:this.type,subFilters:this.subFilters.map((t=>t.toObject()))}}isNeutralState(){return!this.subFilters.some((t=>!t.isNeutralState()))}static fromObject(t,e){return Promise.all((t.subFilters||[]).map((t=>at.getClass(t.type).fromObject(t,e)))).then((t=>new this({subFilters:t})))}}h(ih,"type","Composed"),at.setClass(ih);class rh extends Wa{getFragmentSource(){return"\n  precision highp float;\n  uniform sampler2D uTexture;\n  uniform float uContrast;\n  varying vec2 vTexCoord;\n  void main() {\n    vec4 color = texture2D(uTexture, vTexCoord);\n    float contrastF = 1.015 * (uContrast + 1.0) / (1.0 * (1.015 - uContrast));\n    color.rgb = contrastF * (color.rgb - 0.5) + 0.5;\n    gl_FragColor = color;\n  }"}isNeutralState(){return 0===this.contrast}applyTo2d(t){let{imageData:{data:e}}=t;const s=Math.floor(255*this.contrast),n=259*(s+255)/(255*(259-s));for(let i=0;i<e.length;i+=4)e[i]=n*(e[i]-128)+128,e[i+1]=n*(e[i+1]-128)+128,e[i+2]=n*(e[i+2]-128)+128}sendUniformData(t,e){t.uniform1f(e.uContrast,this.contrast)}}h(rh,"type","Contrast"),h(rh,"defaults",{contrast:0}),h(rh,"uniformLocations",["uContrast"]),at.setClass(rh);const oh={Convolute_3_1:"\n    precision highp float;\n    uniform sampler2D uTexture;\n    uniform float uMatrix[9];\n    uniform float uStepW;\n    uniform float uStepH;\n    varying vec2 vTexCoord;\n    void main() {\n      vec4 color = vec4(0, 0, 0, 0);\n      for (float h = 0.0; h < 3.0; h+=1.0) {\n        for (float w = 0.0; w < 3.0; w+=1.0) {\n          vec2 matrixPos = vec2(uStepW * (w - 1), uStepH * (h - 1));\n          color += texture2D(uTexture, vTexCoord + matrixPos) * uMatrix[int(h * 3.0 + w)];\n        }\n      }\n      gl_FragColor = color;\n    }\n    ",Convolute_3_0:"\n    precision highp float;\n    uniform sampler2D uTexture;\n    uniform float uMatrix[9];\n    uniform float uStepW;\n    uniform float uStepH;\n    varying vec2 vTexCoord;\n    void main() {\n      vec4 color = vec4(0, 0, 0, 1);\n      for (float h = 0.0; h < 3.0; h+=1.0) {\n        for (float w = 0.0; w < 3.0; w+=1.0) {\n          vec2 matrixPos = vec2(uStepW * (w - 1.0), uStepH * (h - 1.0));\n          color.rgb += texture2D(uTexture, vTexCoord + matrixPos).rgb * uMatrix[int(h * 3.0 + w)];\n        }\n      }\n      float alpha = texture2D(uTexture, vTexCoord).a;\n      gl_FragColor = color;\n      gl_FragColor.a = alpha;\n    }\n    ",Convolute_5_1:"\n    precision highp float;\n    uniform sampler2D uTexture;\n    uniform float uMatrix[25];\n    uniform float uStepW;\n    uniform float uStepH;\n    varying vec2 vTexCoord;\n    void main() {\n      vec4 color = vec4(0, 0, 0, 0);\n      for (float h = 0.0; h < 5.0; h+=1.0) {\n        for (float w = 0.0; w < 5.0; w+=1.0) {\n          vec2 matrixPos = vec2(uStepW * (w - 2.0), uStepH * (h - 2.0));\n          color += texture2D(uTexture, vTexCoord + matrixPos) * uMatrix[int(h * 5.0 + w)];\n        }\n      }\n      gl_FragColor = color;\n    }\n    ",Convolute_5_0:"\n    precision highp float;\n    uniform sampler2D uTexture;\n    uniform float uMatrix[25];\n    uniform float uStepW;\n    uniform float uStepH;\n    varying vec2 vTexCoord;\n    void main() {\n      vec4 color = vec4(0, 0, 0, 1);\n      for (float h = 0.0; h < 5.0; h+=1.0) {\n        for (float w = 0.0; w < 5.0; w+=1.0) {\n          vec2 matrixPos = vec2(uStepW * (w - 2.0), uStepH * (h - 2.0));\n          color.rgb += texture2D(uTexture, vTexCoord + matrixPos).rgb * uMatrix[int(h * 5.0 + w)];\n        }\n      }\n      float alpha = texture2D(uTexture, vTexCoord).a;\n      gl_FragColor = color;\n      gl_FragColor.a = alpha;\n    }\n    ",Convolute_7_1:"\n    precision highp float;\n    uniform sampler2D uTexture;\n    uniform float uMatrix[49];\n    uniform float uStepW;\n    uniform float uStepH;\n    varying vec2 vTexCoord;\n    void main() {\n      vec4 color = vec4(0, 0, 0, 0);\n      for (float h = 0.0; h < 7.0; h+=1.0) {\n        for (float w = 0.0; w < 7.0; w+=1.0) {\n          vec2 matrixPos = vec2(uStepW * (w - 3.0), uStepH * (h - 3.0));\n          color += texture2D(uTexture, vTexCoord + matrixPos) * uMatrix[int(h * 7.0 + w)];\n        }\n      }\n      gl_FragColor = color;\n    }\n    ",Convolute_7_0:"\n    precision highp float;\n    uniform sampler2D uTexture;\n    uniform float uMatrix[49];\n    uniform float uStepW;\n    uniform float uStepH;\n    varying vec2 vTexCoord;\n    void main() {\n      vec4 color = vec4(0, 0, 0, 1);\n      for (float h = 0.0; h < 7.0; h+=1.0) {\n        for (float w = 0.0; w < 7.0; w+=1.0) {\n          vec2 matrixPos = vec2(uStepW * (w - 3.0), uStepH * (h - 3.0));\n          color.rgb += texture2D(uTexture, vTexCoord + matrixPos).rgb * uMatrix[int(h * 7.0 + w)];\n        }\n      }\n      float alpha = texture2D(uTexture, vTexCoord).a;\n      gl_FragColor = color;\n      gl_FragColor.a = alpha;\n    }\n    ",Convolute_9_1:"\n    precision highp float;\n    uniform sampler2D uTexture;\n    uniform float uMatrix[81];\n    uniform float uStepW;\n    uniform float uStepH;\n    varying vec2 vTexCoord;\n    void main() {\n      vec4 color = vec4(0, 0, 0, 0);\n      for (float h = 0.0; h < 9.0; h+=1.0) {\n        for (float w = 0.0; w < 9.0; w+=1.0) {\n          vec2 matrixPos = vec2(uStepW * (w - 4.0), uStepH * (h - 4.0));\n          color += texture2D(uTexture, vTexCoord + matrixPos) * uMatrix[int(h * 9.0 + w)];\n        }\n      }\n      gl_FragColor = color;\n    }\n    ",Convolute_9_0:"\n    precision highp float;\n    uniform sampler2D uTexture;\n    uniform float uMatrix[81];\n    uniform float uStepW;\n    uniform float uStepH;\n    varying vec2 vTexCoord;\n    void main() {\n      vec4 color = vec4(0, 0, 0, 1);\n      for (float h = 0.0; h < 9.0; h+=1.0) {\n        for (float w = 0.0; w < 9.0; w+=1.0) {\n          vec2 matrixPos = vec2(uStepW * (w - 4.0), uStepH * (h - 4.0));\n          color.rgb += texture2D(uTexture, vTexCoord + matrixPos).rgb * uMatrix[int(h * 9.0 + w)];\n        }\n      }\n      float alpha = texture2D(uTexture, vTexCoord).a;\n      gl_FragColor = color;\n      gl_FragColor.a = alpha;\n    }\n    "};class ah extends Wa{getCacheKey(){return"".concat(this.type,"_").concat(Math.sqrt(this.matrix.length),"_").concat(this.opaque?1:0)}getFragmentSource(){return oh[this.getCacheKey()]}applyTo2d(t){const e=t.imageData,s=e.data,n=this.matrix,i=Math.round(Math.sqrt(n.length)),r=Math.floor(i/2),o=e.width,a=e.height,h=t.ctx.createImageData(o,a),c=h.data,l=this.opaque?1:0;let u,d,g,p,f,m,_,v,y,C,b,w,x;for(b=0;b<a;b++)for(C=0;C<o;C++){for(f=4*(b*o+C),u=0,d=0,g=0,p=0,x=0;x<i;x++)for(w=0;w<i;w++)_=b+x-r,m=C+w-r,_<0||_>=a||m<0||m>=o||(v=4*(_*o+m),y=n[x*i+w],u+=s[v]*y,d+=s[v+1]*y,g+=s[v+2]*y,l||(p+=s[v+3]*y));c[f]=u,c[f+1]=d,c[f+2]=g,c[f+3]=l?s[f+3]:p}t.imageData=h}sendUniformData(t,e){t.uniform1fv(e.uMatrix,this.matrix)}toObject(){return l(l({},super.toObject()),{},{opaque:this.opaque,matrix:[...this.matrix]})}}h(ah,"type","Convolute"),h(ah,"defaults",{opaque:!1,matrix:[0,0,0,0,1,0,0,0,0]}),h(ah,"uniformLocations",["uMatrix","uOpaque","uHalfSize","uSize"]),at.setClass(ah);const hh="Gamma";class ch extends Wa{getFragmentSource(){return"\n  precision highp float;\n  uniform sampler2D uTexture;\n  uniform vec3 uGamma;\n  varying vec2 vTexCoord;\n  void main() {\n    vec4 color = texture2D(uTexture, vTexCoord);\n    vec3 correction = (1.0 / uGamma);\n    color.r = pow(color.r, correction.r);\n    color.g = pow(color.g, correction.g);\n    color.b = pow(color.b, correction.b);\n    gl_FragColor = color;\n    gl_FragColor.rgb *= color.a;\n  }\n"}constructor(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};super(t),this.gamma=t.gamma||this.constructor.defaults.gamma.concat()}applyTo2d(t){let{imageData:{data:e}}=t;const s=this.gamma,n=1/s[0],i=1/s[1],r=1/s[2];this.rgbValues||(this.rgbValues={r:new Uint8Array(256),g:new Uint8Array(256),b:new Uint8Array(256)});const o=this.rgbValues;for(let a=0;a<256;a++)o.r[a]=255*Math.pow(a/255,n),o.g[a]=255*Math.pow(a/255,i),o.b[a]=255*Math.pow(a/255,r);for(let a=0;a<e.length;a+=4)e[a]=o.r[e[a]],e[a+1]=o.g[e[a+1]],e[a+2]=o.b[e[a+2]]}sendUniformData(t,e){t.uniform3fv(e.uGamma,this.gamma)}isNeutralState(){const{gamma:t}=this;return 1===t[0]&&1===t[1]&&1===t[2]}toObject(){return{type:hh,gamma:this.gamma.concat()}}}h(ch,"type",hh),h(ch,"defaults",{gamma:[1,1,1]}),h(ch,"uniformLocations",["uGamma"]),at.setClass(ch);const lh={average:"\n    precision highp float;\n    uniform sampler2D uTexture;\n    varying vec2 vTexCoord;\n    void main() {\n      vec4 color = texture2D(uTexture, vTexCoord);\n      float average = (color.r + color.b + color.g) / 3.0;\n      gl_FragColor = vec4(average, average, average, color.a);\n    }\n    ",lightness:"\n    precision highp float;\n    uniform sampler2D uTexture;\n    uniform int uMode;\n    varying vec2 vTexCoord;\n    void main() {\n      vec4 col = texture2D(uTexture, vTexCoord);\n      float average = (max(max(col.r, col.g),col.b) + min(min(col.r, col.g),col.b)) / 2.0;\n      gl_FragColor = vec4(average, average, average, col.a);\n    }\n    ",luminosity:"\n    precision highp float;\n    uniform sampler2D uTexture;\n    uniform int uMode;\n    varying vec2 vTexCoord;\n    void main() {\n      vec4 col = texture2D(uTexture, vTexCoord);\n      float average = 0.21 * col.r + 0.72 * col.g + 0.07 * col.b;\n      gl_FragColor = vec4(average, average, average, col.a);\n    }\n    "};class uh extends Wa{applyTo2d(t){let{imageData:{data:e}}=t;for(let s,n=0;n<e.length;n+=4){const t=e[n],i=e[n+1],r=e[n+2];switch(this.mode){case"average":s=(t+i+r)/3;break;case"lightness":s=(Math.min(t,i,r)+Math.max(t,i,r))/2;break;case"luminosity":s=.21*t+.72*i+.07*r}e[n+2]=e[n+1]=e[n]=s}}getCacheKey(){return"".concat(this.type,"_").concat(this.mode)}getFragmentSource(){return lh[this.mode]}sendUniformData(t,e){t.uniform1i(e.uMode,1)}isNeutralState(){return!1}}h(uh,"type","Grayscale"),h(uh,"defaults",{mode:"average"}),h(uh,"uniformLocations",["uMode"]),at.setClass(uh);const dh=l(l({},qa),{},{rotation:0});class gh extends Ka{calculateMatrix(){const t=this.rotation*Math.PI,e=ut(t),s=dt(t),n=1/3,i=Math.sqrt(n)*s,r=1-e;this.matrix=[e+r/3,n*r-i,n*r+i,0,0,n*r+i,e+n*r,n*r-i,0,0,n*r-i,n*r+i,e+n*r,0,0,0,0,0,1,0]}isNeutralState(){return 0===this.rotation}applyTo(t){this.calculateMatrix(),super.applyTo(t)}toObject(){return{type:this.type,rotation:this.rotation}}}h(gh,"type","HueRotation"),h(gh,"defaults",dh),at.setClass(gh);class ph extends Wa{applyTo2d(t){let{imageData:{data:e}}=t;for(let s=0;s<e.length;s+=4)e[s]=255-e[s],e[s+1]=255-e[s+1],e[s+2]=255-e[s+2],this.alpha&&(e[s+3]=255-e[s+3])}getFragmentSource(){return"\n  precision highp float;\n  uniform sampler2D uTexture;\n  uniform int uInvert;\n  uniform int uAlpha;\n  varying vec2 vTexCoord;\n  void main() {\n    vec4 color = texture2D(uTexture, vTexCoord);\n    if (uInvert == 1) {\n      if (uAlpha == 1) {\n        gl_FragColor = vec4(1.0 - color.r,1.0 -color.g,1.0 -color.b,1.0 -color.a);\n      } else {\n        gl_FragColor = vec4(1.0 - color.r,1.0 -color.g,1.0 -color.b,color.a);\n      }\n    } else {\n      gl_FragColor = color;\n    }\n  }\n"}isNeutralState(){return!this.invert}sendUniformData(t,e){t.uniform1i(e.uInvert,Number(this.invert)),t.uniform1i(e.uAlpha,Number(this.alpha))}}h(ph,"type","Invert"),h(ph,"defaults",{alpha:!1,invert:!0}),h(ph,"uniformLocations",["uInvert","uAlpha"]),at.setClass(ph);class fh extends Wa{getFragmentSource(){return"\n  precision highp float;\n  uniform sampler2D uTexture;\n  uniform float uStepH;\n  uniform float uNoise;\n  uniform float uSeed;\n  varying vec2 vTexCoord;\n  float rand(vec2 co, float seed, float vScale) {\n    return fract(sin(dot(co.xy * vScale ,vec2(12.9898 , 78.233))) * 43758.5453 * (seed + 0.01) / 2.0);\n  }\n  void main() {\n    vec4 color = texture2D(uTexture, vTexCoord);\n    color.rgb += (0.5 - rand(vTexCoord, uSeed, 0.1 / uStepH)) * uNoise;\n    gl_FragColor = color;\n  }\n"}applyTo2d(t){let{imageData:{data:e}}=t;const s=this.noise;for(let n=0;n<e.length;n+=4){const t=(.5-Math.random())*s;e[n]+=t,e[n+1]+=t,e[n+2]+=t}}sendUniformData(t,e){t.uniform1f(e.uNoise,this.noise/255),t.uniform1f(e.uSeed,Math.random())}isNeutralState(){return 0===this.noise}}h(fh,"type","Noise"),h(fh,"defaults",{noise:0}),h(fh,"uniformLocations",["uNoise","uSeed"]),at.setClass(fh);class mh extends Wa{applyTo2d(t){let{imageData:{data:e,width:s,height:n}}=t;for(let i=0;i<n;i+=this.blocksize)for(let t=0;t<s;t+=this.blocksize){const r=4*i*s+4*t,o=e[r],a=e[r+1],h=e[r+2],c=e[r+3];for(let l=i;l<Math.min(i+this.blocksize,n);l++)for(let n=t;n<Math.min(t+this.blocksize,s);n++){const t=4*l*s+4*n;e[t]=o,e[t+1]=a,e[t+2]=h,e[t+3]=c}}}isNeutralState(){return 1===this.blocksize}getFragmentSource(){return"\n  precision highp float;\n  uniform sampler2D uTexture;\n  uniform float uBlocksize;\n  uniform float uStepW;\n  uniform float uStepH;\n  varying vec2 vTexCoord;\n  void main() {\n    float blockW = uBlocksize * uStepW;\n    float blockH = uBlocksize * uStepH;\n    int posX = int(vTexCoord.x / blockW);\n    int posY = int(vTexCoord.y / blockH);\n    float fposX = float(posX);\n    float fposY = float(posY);\n    vec2 squareCoords = vec2(fposX * blockW, fposY * blockH);\n    vec4 color = texture2D(uTexture, squareCoords);\n    gl_FragColor = color;\n  }\n"}sendUniformData(t,e){t.uniform1f(e.uBlocksize,this.blocksize)}}h(mh,"type","Pixelate"),h(mh,"defaults",{blocksize:4}),h(mh,"uniformLocations",["uBlocksize"]),at.setClass(mh);class _h extends Wa{getFragmentSource(){return"\nprecision highp float;\nuniform sampler2D uTexture;\nuniform vec4 uLow;\nuniform vec4 uHigh;\nvarying vec2 vTexCoord;\nvoid main() {\n  gl_FragColor = texture2D(uTexture, vTexCoord);\n  if(all(greaterThan(gl_FragColor.rgb,uLow.rgb)) && all(greaterThan(uHigh.rgb,gl_FragColor.rgb))) {\n    gl_FragColor.a = 0.0;\n  }\n}\n"}applyTo2d(t){let{imageData:{data:e}}=t;const s=255*this.distance,n=new Ye(this.color).getSource(),i=[n[0]-s,n[1]-s,n[2]-s],r=[n[0]+s,n[1]+s,n[2]+s];for(let o=0;o<e.length;o+=4){const t=e[o],s=e[o+1],n=e[o+2];t>i[0]&&s>i[1]&&n>i[2]&&t<r[0]&&s<r[1]&&n<r[2]&&(e[o+3]=0)}}sendUniformData(t,e){const s=new Ye(this.color).getSource(),n=this.distance,i=[0+s[0]/255-n,0+s[1]/255-n,0+s[2]/255-n,1],r=[s[0]/255+n,s[1]/255+n,s[2]/255+n,1];t.uniform4fv(e.uLow,i),t.uniform4fv(e.uHigh,r)}}h(_h,"type","RemoveColor"),h(_h,"defaults",{color:"#FFFFFF",distance:.02,useAlpha:!1}),h(_h,"uniformLocations",["uLow","uHigh"]),at.setClass(_h);class vh extends Wa{sendUniformData(t,e){t.uniform2fv(e.uDelta,this.horizontal?[1/this.width,0]:[0,1/this.height]),t.uniform1fv(e.uTaps,this.taps)}getFilterWindow(){const t=this.tempScale;return Math.ceil(this.lanczosLobes/t)}getCacheKey(){const t=this.getFilterWindow();return"".concat(this.type,"_").concat(t)}getFragmentSource(){const t=this.getFilterWindow();return this.generateShader(t)}getTaps(){const t=this.lanczosCreate(this.lanczosLobes),e=this.tempScale,s=this.getFilterWindow(),n=new Array(s);for(let i=1;i<=s;i++)n[i-1]=t(i*e);return n}generateShader(t){const e=new Array(t);for(let s=1;s<=t;s++)e[s-1]="".concat(s,".0 * uDelta");return"\n      precision highp float;\n      uniform sampler2D uTexture;\n      uniform vec2 uDelta;\n      varying vec2 vTexCoord;\n      uniform float uTaps[".concat(t,"];\n      void main() {\n        vec4 color = texture2D(uTexture, vTexCoord);\n        float sum = 1.0;\n        ").concat(e.map(((t,e)=>"\n              color += texture2D(uTexture, vTexCoord + ".concat(t,") * uTaps[").concat(e,"] + texture2D(uTexture, vTexCoord - ").concat(t,") * uTaps[").concat(e,"];\n              sum += 2.0 * uTaps[").concat(e,"];\n            "))).join("\n"),"\n        gl_FragColor = color / sum;\n      }\n    ")}applyToForWebgl(t){t.passes++,this.width=t.sourceWidth,this.horizontal=!0,this.dW=Math.round(this.width*this.scaleX),this.dH=t.sourceHeight,this.tempScale=this.dW/this.width,this.taps=this.getTaps(),t.destinationWidth=this.dW,super.applyTo(t),t.sourceWidth=t.destinationWidth,this.height=t.sourceHeight,this.horizontal=!1,this.dH=Math.round(this.height*this.scaleY),this.tempScale=this.dH/this.height,this.taps=this.getTaps(),t.destinationHeight=this.dH,super.applyTo(t),t.sourceHeight=t.destinationHeight}applyTo(t){Ra(t)?this.applyToForWebgl(t):this.applyTo2d(t)}isNeutralState(){return 1===this.scaleX&&1===this.scaleY}lanczosCreate(t){return e=>{if(e>=t||e<=-t)return 0;if(e<1.1920929e-7&&e>-1.1920929e-7)return 1;const s=(e*=Math.PI)/t;return Math.sin(e)/e*Math.sin(s)/s}}applyTo2d(t){const e=t.imageData,s=this.scaleX,n=this.scaleY;this.rcpScaleX=1/s,this.rcpScaleY=1/n;const i=e.width,r=e.height,o=Math.round(i*s),a=Math.round(r*n);let h;h="sliceHack"===this.resizeType?this.sliceByTwo(t,i,r,o,a):"hermite"===this.resizeType?this.hermiteFastResize(t,i,r,o,a):"bilinear"===this.resizeType?this.bilinearFiltering(t,i,r,o,a):"lanczos"===this.resizeType?this.lanczosResize(t,i,r,o,a):new ImageData(o,a),t.imageData=h}sliceByTwo(t,e,s,n,i){const r=t.imageData,o=.5;let a=!1,h=!1,c=e*o,l=s*o;const u=t.filterBackend.resources;let d=0,g=0;const p=e;let f=0;u.sliceByTwo||(u.sliceByTwo=wt());const m=u.sliceByTwo;(m.width<1.5*e||m.height<s)&&(m.width=1.5*e,m.height=s);const _=m.getContext("2d");for(_.clearRect(0,0,1.5*e,s),_.putImageData(r,0,0),n=Math.floor(n),i=Math.floor(i);!a||!h;)e=c,s=l,n<Math.floor(c*o)?c=Math.floor(c*o):(c=n,a=!0),i<Math.floor(l*o)?l=Math.floor(l*o):(l=i,h=!0),_.drawImage(m,d,g,e,s,p,f,c,l),d=p,g=f,f+=l;return _.getImageData(d,g,n,i)}lanczosResize(t,e,s,n,i){const r=t.imageData.data,o=t.ctx.createImageData(n,i),a=o.data,h=this.lanczosCreate(this.lanczosLobes),c=this.rcpScaleX,l=this.rcpScaleY,u=2/this.rcpScaleX,d=2/this.rcpScaleY,g=Math.ceil(c*this.lanczosLobes/2),p=Math.ceil(l*this.lanczosLobes/2),f={},m={x:0,y:0},_={x:0,y:0};return function t(v){let y,C,b,w,x,S,T,k,A,E,O;for(m.x=(v+.5)*c,_.x=Math.floor(m.x),y=0;y<i;y++){for(m.y=(y+.5)*l,_.y=Math.floor(m.y),x=0,S=0,T=0,k=0,A=0,C=_.x-g;C<=_.x+g;C++)if(!(C<0||C>=e)){E=Math.floor(1e3*Math.abs(C-m.x)),f[E]||(f[E]={});for(let t=_.y-p;t<=_.y+p;t++)t<0||t>=s||(O=Math.floor(1e3*Math.abs(t-m.y)),f[E][O]||(f[E][O]=h(Math.sqrt(Math.pow(E*u,2)+Math.pow(O*d,2))/1e3)),b=f[E][O],b>0&&(w=4*(t*e+C),x+=b,S+=b*r[w],T+=b*r[w+1],k+=b*r[w+2],A+=b*r[w+3]))}w=4*(y*n+v),a[w]=S/x,a[w+1]=T/x,a[w+2]=k/x,a[w+3]=A/x}return++v<n?t(v):o}(0)}bilinearFiltering(t,e,s,n,i){let r,o,a,h,c,l,u,d,g,p,f,m,_,v=0;const y=this.rcpScaleX,C=this.rcpScaleY,b=4*(e-1),w=t.imageData.data,x=t.ctx.createImageData(n,i),S=x.data;for(u=0;u<i;u++)for(d=0;d<n;d++)for(c=Math.floor(y*d),l=Math.floor(C*u),g=y*d-c,p=C*u-l,_=4*(l*e+c),f=0;f<4;f++)r=w[_+f],o=w[_+4+f],a=w[_+b+f],h=w[_+b+4+f],m=r*(1-g)*(1-p)+o*g*(1-p)+a*p*(1-g)+h*g*p,S[v++]=m;return x}hermiteFastResize(t,e,s,n,i){const r=this.rcpScaleX,o=this.rcpScaleY,a=Math.ceil(r/2),h=Math.ceil(o/2),c=t.imageData.data,l=t.ctx.createImageData(n,i),u=l.data;for(let d=0;d<i;d++)for(let t=0;t<n;t++){const s=4*(t+d*n);let i=0,l=0,g=0,p=0,f=0,m=0,_=0;const v=(d+.5)*o;for(let n=Math.floor(d*o);n<(d+1)*o;n++){const s=Math.abs(v-(n+.5))/h,o=(t+.5)*r,u=s*s;for(let h=Math.floor(t*r);h<(t+1)*r;h++){let t=Math.abs(o-(h+.5))/a;const s=Math.sqrt(u+t*t);s>1&&s<-1||(i=2*s*s*s-3*s*s+1,i>0&&(t=4*(h+n*e),_+=i*c[t+3],g+=i,c[t+3]<255&&(i=i*c[t+3]/250),p+=i*c[t],f+=i*c[t+1],m+=i*c[t+2],l+=i))}}u[s]=p/l,u[s+1]=f/l,u[s+2]=m/l,u[s+3]=_/g}return l}}h(vh,"type","Resize"),h(vh,"defaults",{resizeType:"hermite",scaleX:1,scaleY:1,lanczosLobes:3}),h(vh,"uniformLocations",["uDelta","uTaps"]),at.setClass(vh);class yh extends Wa{getFragmentSource(){return"\n  precision highp float;\n  uniform sampler2D uTexture;\n  uniform float uSaturation;\n  varying vec2 vTexCoord;\n  void main() {\n    vec4 color = texture2D(uTexture, vTexCoord);\n    float rgMax = max(color.r, color.g);\n    float rgbMax = max(rgMax, color.b);\n    color.r += rgbMax != color.r ? (rgbMax - color.r) * uSaturation : 0.00;\n    color.g += rgbMax != color.g ? (rgbMax - color.g) * uSaturation : 0.00;\n    color.b += rgbMax != color.b ? (rgbMax - color.b) * uSaturation : 0.00;\n    gl_FragColor = color;\n  }\n"}applyTo2d(t){let{imageData:{data:e}}=t;const s=-this.saturation;for(let n=0;n<e.length;n+=4){const t=e[n],i=e[n+1],r=e[n+2],o=Math.max(t,i,r);e[n]+=o!==t?(o-t)*s:0,e[n+1]+=o!==i?(o-i)*s:0,e[n+2]+=o!==r?(o-r)*s:0}}sendUniformData(t,e){t.uniform1f(e.uSaturation,-this.saturation)}isNeutralState(){return 0===this.saturation}}h(yh,"type","Saturation"),h(yh,"defaults",{saturation:0}),h(yh,"uniformLocations",["uSaturation"]),at.setClass(yh);class Ch extends Wa{getFragmentSource(){return"\n  precision highp float;\n  uniform sampler2D uTexture;\n  uniform float uVibrance;\n  varying vec2 vTexCoord;\n  void main() {\n    vec4 color = texture2D(uTexture, vTexCoord);\n    float max = max(color.r, max(color.g, color.b));\n    float avg = (color.r + color.g + color.b) / 3.0;\n    float amt = (abs(max - avg) * 2.0) * uVibrance;\n    color.r += max != color.r ? (max - color.r) * amt : 0.00;\n    color.g += max != color.g ? (max - color.g) * amt : 0.00;\n    color.b += max != color.b ? (max - color.b) * amt : 0.00;\n    gl_FragColor = color;\n  }\n"}applyTo2d(t){let{imageData:{data:e}}=t;const s=-this.vibrance;for(let n=0;n<e.length;n+=4){const t=e[n],i=e[n+1],r=e[n+2],o=Math.max(t,i,r),a=(t+i+r)/3,h=2*Math.abs(o-a)/255*s;e[n]+=o!==t?(o-t)*h:0,e[n+1]+=o!==i?(o-i)*h:0,e[n+2]+=o!==r?(o-r)*h:0}}sendUniformData(t,e){t.uniform1f(e.uVibrance,-this.vibrance)}isNeutralState(){return 0===this.vibrance}}h(Ch,"type","Vibrance"),h(Ch,"defaults",{vibrance:0}),h(Ch,"uniformLocations",["uVibrance"]),at.setClass(Ch);Object.freeze({__proto__:null,BaseFilter:Wa,BlackWhite:nh,BlendColor:Ya,BlendImage:Ga,Blur:Ha,Brightness:za,Brownie:Ja,ColorMatrix:Ka,Composed:ih,Contrast:rh,Convolute:ah,Gamma:ch,Grayscale:uh,HueRotation:gh,Invert:ph,Kodachrome:$a,Noise:fh,Pixelate:mh,Polaroid:eh,RemoveColor:_h,Resize:vh,Saturation:yh,Sepia:sh,Technicolor:th,Vibrance:Ch,Vintage:Za}),s(1560),s(3713),s(3055);var bh=s(4684),wh=s(8015),xh=s(795),Sh=s(9759),Th=s(7608);s(4979);const kh=()=>{},Ah={NODE_CLIENT:!1,NODE_ADMIN:!1,SDK_VERSION:"${JSCORE_VERSION}"},Eh=function(t,e){if(!t)throw Oh(e)},Oh=function(t){return new Error("Firebase Database ("+Ah.SDK_VERSION+") INTERNAL ASSERT FAILED: "+t)},Dh=function(t){const e=[];let s=0;for(let n=0;n<t.length;n++){let i=t.charCodeAt(n);i<128?e[s++]=i:i<2048?(e[s++]=i>>6|192,e[s++]=63&i|128):55296===(64512&i)&&n+1<t.length&&56320===(64512&t.charCodeAt(n+1))?(i=65536+((1023&i)<<10)+(1023&t.charCodeAt(++n)),e[s++]=i>>18|240,e[s++]=i>>12&63|128,e[s++]=i>>6&63|128,e[s++]=63&i|128):(e[s++]=i>>12|224,e[s++]=i>>6&63|128,e[s++]=63&i|128)}return e},Ph=function(t){const e=[];let s=0,n=0;while(s<t.length){const i=t[s++];if(i<128)e[n++]=String.fromCharCode(i);else if(i>191&&i<224){const r=t[s++];e[n++]=String.fromCharCode((31&i)<<6|63&r)}else if(i>239&&i<365){const r=t[s++],o=t[s++],a=t[s++],h=((7&i)<<18|(63&r)<<12|(63&o)<<6|63&a)-65536;e[n++]=String.fromCharCode(55296+(h>>10)),e[n++]=String.fromCharCode(56320+(1023&h))}else{const r=t[s++],o=t[s++];e[n++]=String.fromCharCode((15&i)<<12|(63&r)<<6|63&o)}}return e.join("")},Ih={byteToCharMap_:null,charToByteMap_:null,byteToCharMapWebSafe_:null,charToByteMapWebSafe_:null,ENCODED_VALS_BASE:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",get ENCODED_VALS(){return this.ENCODED_VALS_BASE+"+/="},get ENCODED_VALS_WEBSAFE(){return this.ENCODED_VALS_BASE+"-_."},HAS_NATIVE_SUPPORT:"function"===typeof atob,encodeByteArray(t,e){if(!Array.isArray(t))throw Error("encodeByteArray takes an array as a parameter");this.init_();const s=e?this.byteToCharMapWebSafe_:this.byteToCharMap_,n=[];for(let i=0;i<t.length;i+=3){const e=t[i],r=i+1<t.length,o=r?t[i+1]:0,a=i+2<t.length,h=a?t[i+2]:0,c=e>>2,l=(3&e)<<4|o>>4;let u=(15&o)<<2|h>>6,d=63&h;a||(d=64,r||(u=64)),n.push(s[c],s[l],s[u],s[d])}return n.join("")},encodeString(t,e){return this.HAS_NATIVE_SUPPORT&&!e?btoa(t):this.encodeByteArray(Dh(t),e)},decodeString(t,e){return this.HAS_NATIVE_SUPPORT&&!e?atob(t):Ph(this.decodeStringToByteArray(t,e))},decodeStringToByteArray(t,e){this.init_();const s=e?this.charToByteMapWebSafe_:this.charToByteMap_,n=[];for(let i=0;i<t.length;){const e=s[t.charAt(i++)],r=i<t.length,o=r?s[t.charAt(i)]:0;++i;const a=i<t.length,h=a?s[t.charAt(i)]:64;++i;const c=i<t.length,l=c?s[t.charAt(i)]:64;if(++i,null==e||null==o||null==h||null==l)throw new Mh;const u=e<<2|o>>4;if(n.push(u),64!==h){const t=o<<4&240|h>>2;if(n.push(t),64!==l){const t=h<<6&192|l;n.push(t)}}}return n},init_(){if(!this.byteToCharMap_){this.byteToCharMap_={},this.charToByteMap_={},this.byteToCharMapWebSafe_={},this.charToByteMapWebSafe_={};for(let t=0;t<this.ENCODED_VALS.length;t++)this.byteToCharMap_[t]=this.ENCODED_VALS.charAt(t),this.charToByteMap_[this.byteToCharMap_[t]]=t,this.byteToCharMapWebSafe_[t]=this.ENCODED_VALS_WEBSAFE.charAt(t),this.charToByteMapWebSafe_[this.byteToCharMapWebSafe_[t]]=t,t>=this.ENCODED_VALS_BASE.length&&(this.charToByteMap_[this.ENCODED_VALS_WEBSAFE.charAt(t)]=t,this.charToByteMapWebSafe_[this.ENCODED_VALS.charAt(t)]=t)}}};class Mh extends Error{constructor(){super(...arguments),this.name="DecodeBase64StringError"}}const Rh=function(t){const e=Dh(t);return Ih.encodeByteArray(e,!0)},Fh=function(t){return Rh(t).replace(/\./g,"")},Lh=function(t){try{return Ih.decodeString(t,!0)}catch(c){console.error("base64Decode failed: ",c)}return null};
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
function jh(t){return Nh(void 0,t)}function Nh(t,e){if(!(e instanceof Object))return e;switch(e.constructor){case Date:const s=e;return new Date(s.getTime());case Object:void 0===t&&(t={});break;case Array:t=[];break;default:return e}for(const s in e)e.hasOwnProperty(s)&&Bh(s)&&(t[s]=Nh(t[s],e[s]));return t}function Bh(t){return"__proto__"!==t}
/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Wh(){if("undefined"!==typeof self)return self;if("undefined"!==typeof window)return window;if("undefined"!==typeof s.g)return s.g;throw new Error("Unable to locate global object.")}
/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Uh=()=>Wh().__FIREBASE_DEFAULTS__,Yh=()=>{if("undefined"===typeof process)return;const t={NODE_ENV:"production",BASE_URL:"/alien_mood/"}.__FIREBASE_DEFAULTS__;return t?JSON.parse(t):void 0},Xh=()=>{if("undefined"===typeof document)return;let t;try{t=document.cookie.match(/__FIREBASE_DEFAULTS__=([^;]+)/)}catch(c){return}const e=t&&Lh(t[1]);return e&&JSON.parse(e)},Vh=()=>{try{return kh()||Uh()||Yh()||Xh()}catch(c){return void console.info(`Unable to get __FIREBASE_DEFAULTS__ due to: ${c}`)}},Gh=t=>{var e,s;return null===(s=null===(e=Vh())||void 0===e?void 0:e.emulatorHosts)||void 0===s?void 0:s[t]},Hh=t=>{const e=Gh(t);if(!e)return;const s=e.lastIndexOf(":");if(s<=0||s+1===e.length)throw new Error(`Invalid host ${e} with no separate hostname and port!`);const n=parseInt(e.substring(s+1),10);return"["===e[0]?[e.substring(1,s-1),n]:[e.substring(0,s),n]},zh=()=>{var t;return null===(t=Vh())||void 0===t?void 0:t.config};
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
class qh{constructor(){this.reject=()=>{},this.resolve=()=>{},this.promise=new Promise(((t,e)=>{this.resolve=t,this.reject=e}))}wrapCallback(t){return(e,s)=>{e?this.reject(e):this.resolve(s),"function"===typeof t&&(this.promise.catch((()=>{})),1===t.length?t(e):t(e,s))}}}
/**
 * @license
 * Copyright 2025 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Kh(t){return t.endsWith(".cloudworkstations.dev")}async function Qh(t){const e=await fetch(t,{credentials:"include"});return e.ok}
/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Jh(t,e){if(t.uid)throw new Error('The "uid" field is no longer supported by mockUserToken. Please use "sub" instead for Firebase Auth User ID.');const s={alg:"none",type:"JWT"},n=e||"demo-project",i=t.iat||0,r=t.sub||t.user_id;if(!r)throw new Error("mockUserToken must contain 'sub' or 'user_id' field!");const o=Object.assign({iss:`https://securetoken.google.com/${n}`,aud:n,iat:i,exp:i+3600,auth_time:i,sub:r,user_id:r,firebase:{sign_in_provider:"custom",identities:{}}},t),a="";return[Fh(JSON.stringify(s)),Fh(JSON.stringify(o)),a].join(".")}const Zh={};function $h(){const t={prod:[],emulator:[]};for(const e of Object.keys(Zh))Zh[e]?t.emulator.push(e):t.prod.push(e);return t}function tc(t){let e=document.getElementById(t),s=!1;return e||(e=document.createElement("div"),e.setAttribute("id",t),s=!0),{created:s,element:e}}let ec=!1;function sc(t,e){if("undefined"===typeof window||"undefined"===typeof document||!Kh(window.location.host)||Zh[t]===e||Zh[t]||ec)return;function s(t){return`__firebase__banner__${t}`}Zh[t]=e;const n="__firebase__banner",i=$h(),r=i.prod.length>0;function o(){const t=document.getElementById(n);t&&t.remove()}function a(t){t.style.display="flex",t.style.background="#7faaf0",t.style.position="fixed",t.style.bottom="5px",t.style.left="5px",t.style.padding=".5em",t.style.borderRadius="5px",t.style.alignItems="center"}function h(t,e){t.setAttribute("width","24"),t.setAttribute("id",e),t.setAttribute("height","24"),t.setAttribute("viewBox","0 0 24 24"),t.setAttribute("fill","none"),t.style.marginLeft="-6px"}function c(){const t=document.createElement("span");return t.style.cursor="pointer",t.style.marginLeft="16px",t.style.fontSize="24px",t.innerHTML=" &times;",t.onclick=()=>{ec=!0,o()},t}function l(t,e){t.setAttribute("id",e),t.innerText="Learn more",t.href="https://firebase.google.com/docs/studio/preview-apps#preview-backend",t.setAttribute("target","__blank"),t.style.paddingLeft="5px",t.style.textDecoration="underline"}function u(){const t=tc(n),e=s("text"),i=document.getElementById(e)||document.createElement("span"),o=s("learnmore"),u=document.getElementById(o)||document.createElement("a"),d=s("preprendIcon"),g=document.getElementById(d)||document.createElementNS("http://www.w3.org/2000/svg","svg");if(t.created){const e=t.element;a(e),l(u,o);const s=c();h(g,d),e.append(g,i,u,s),document.body.appendChild(e)}r?(i.innerText="Preview backend disconnected.",g.innerHTML='<g clip-path="url(#clip0_6013_33858)">\n<path d="M4.8 17.6L12 5.6L19.2 17.6H4.8ZM6.91667 16.4H17.0833L12 7.93333L6.91667 16.4ZM12 15.6C12.1667 15.6 12.3056 15.5444 12.4167 15.4333C12.5389 15.3111 12.6 15.1667 12.6 15C12.6 14.8333 12.5389 14.6944 12.4167 14.5833C12.3056 14.4611 12.1667 14.4 12 14.4C11.8333 14.4 11.6889 14.4611 11.5667 14.5833C11.4556 14.6944 11.4 14.8333 11.4 15C11.4 15.1667 11.4556 15.3111 11.5667 15.4333C11.6889 15.5444 11.8333 15.6 12 15.6ZM11.4 13.6H12.6V10.4H11.4V13.6Z" fill="#212121"/>\n</g>\n<defs>\n<clipPath id="clip0_6013_33858">\n<rect width="24" height="24" fill="white"/>\n</clipPath>\n</defs>'):(g.innerHTML='<g clip-path="url(#clip0_6083_34804)">\n<path d="M11.4 15.2H12.6V11.2H11.4V15.2ZM12 10C12.1667 10 12.3056 9.94444 12.4167 9.83333C12.5389 9.71111 12.6 9.56667 12.6 9.4C12.6 9.23333 12.5389 9.09444 12.4167 8.98333C12.3056 8.86111 12.1667 8.8 12 8.8C11.8333 8.8 11.6889 8.86111 11.5667 8.98333C11.4556 9.09444 11.4 9.23333 11.4 9.4C11.4 9.56667 11.4556 9.71111 11.5667 9.83333C11.6889 9.94444 11.8333 10 12 10ZM12 18.4C11.1222 18.4 10.2944 18.2333 9.51667 17.9C8.73889 17.5667 8.05556 17.1111 7.46667 16.5333C6.88889 15.9444 6.43333 15.2611 6.1 14.4833C5.76667 13.7056 5.6 12.8778 5.6 12C5.6 11.1111 5.76667 10.2833 6.1 9.51667C6.43333 8.73889 6.88889 8.06111 7.46667 7.48333C8.05556 6.89444 8.73889 6.43333 9.51667 6.1C10.2944 5.76667 11.1222 5.6 12 5.6C12.8889 5.6 13.7167 5.76667 14.4833 6.1C15.2611 6.43333 15.9389 6.89444 16.5167 7.48333C17.1056 8.06111 17.5667 8.73889 17.9 9.51667C18.2333 10.2833 18.4 11.1111 18.4 12C18.4 12.8778 18.2333 13.7056 17.9 14.4833C17.5667 15.2611 17.1056 15.9444 16.5167 16.5333C15.9389 17.1111 15.2611 17.5667 14.4833 17.9C13.7167 18.2333 12.8889 18.4 12 18.4ZM12 17.2C13.4444 17.2 14.6722 16.6944 15.6833 15.6833C16.6944 14.6722 17.2 13.4444 17.2 12C17.2 10.5556 16.6944 9.32778 15.6833 8.31667C14.6722 7.30555 13.4444 6.8 12 6.8C10.5556 6.8 9.32778 7.30555 8.31667 8.31667C7.30556 9.32778 6.8 10.5556 6.8 12C6.8 13.4444 7.30556 14.6722 8.31667 15.6833C9.32778 16.6944 10.5556 17.2 12 17.2Z" fill="#212121"/>\n</g>\n<defs>\n<clipPath id="clip0_6083_34804">\n<rect width="24" height="24" fill="white"/>\n</clipPath>\n</defs>',i.innerText="Preview backend running in this workspace."),i.setAttribute("id",e)}"loading"===document.readyState?window.addEventListener("DOMContentLoaded",u):u()}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function nc(){return"undefined"!==typeof navigator&&"string"===typeof navigator["userAgent"]?navigator["userAgent"]:""}function ic(){return"undefined"!==typeof window&&!!(window["cordova"]||window["phonegap"]||window["PhoneGap"])&&/ios|iphone|ipod|ipad|android|blackberry|iemobile/i.test(nc())}function rc(){return"object"===typeof navigator&&"ReactNative"===navigator["product"]}function oc(){return!0===Ah.NODE_CLIENT||!0===Ah.NODE_ADMIN}function ac(){try{return"object"===typeof indexedDB}catch(c){return!1}}function hc(){return new Promise(((t,e)=>{try{let s=!0;const n="validate-browser-context-for-indexeddb-analytics-module",i=self.indexedDB.open(n);i.onsuccess=()=>{i.result.close(),s||self.indexedDB.deleteDatabase(n),t(!0)},i.onupgradeneeded=()=>{s=!1},i.onerror=()=>{var t;e((null===(t=i.error)||void 0===t?void 0:t.message)||"")}}catch(Vu){e(Vu)}}))}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
const cc="FirebaseError";class lc extends Error{constructor(t,e,s){super(e),this.code=t,this.customData=s,this.name=cc,Object.setPrototypeOf(this,lc.prototype),Error.captureStackTrace&&Error.captureStackTrace(this,uc.prototype.create)}}class uc{constructor(t,e,s){this.service=t,this.serviceName=e,this.errors=s}create(t,...e){const s=e[0]||{},n=`${this.service}/${t}`,i=this.errors[t],r=i?dc(i,s):"Error",o=`${this.serviceName}: ${r} (${n}).`,a=new lc(n,o,s);return a}}function dc(t,e){return t.replace(gc,((t,s)=>{const n=e[s];return null!=n?String(n):`<${s}?>`}))}const gc=/\{\$([^}]+)}/g;
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function pc(t){return JSON.parse(t)}function fc(t){return JSON.stringify(t)}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const mc=function(t){let e={},s={},n={},i="";try{const r=t.split(".");e=pc(Lh(r[0])||""),s=pc(Lh(r[1])||""),i=r[2],n=s["d"]||{},delete s["d"]}catch(c){}return{header:e,claims:s,data:n,signature:i}},_c=function(t){const e=mc(t),s=e.claims;return!!s&&"object"===typeof s&&s.hasOwnProperty("iat")},vc=function(t){const e=mc(t).claims;return"object"===typeof e&&!0===e["admin"]};
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
function yc(t,e){return Object.prototype.hasOwnProperty.call(t,e)}function Cc(t,e){return Object.prototype.hasOwnProperty.call(t,e)?t[e]:void 0}function bc(t){for(const e in t)if(Object.prototype.hasOwnProperty.call(t,e))return!1;return!0}function wc(t,e,s){const n={};for(const i in t)Object.prototype.hasOwnProperty.call(t,i)&&(n[i]=e.call(s,t[i],i,t));return n}function xc(t,e){if(t===e)return!0;const s=Object.keys(t),n=Object.keys(e);for(const i of s){if(!n.includes(i))return!1;const s=t[i],r=e[i];if(Sc(s)&&Sc(r)){if(!xc(s,r))return!1}else if(s!==r)return!1}for(const i of n)if(!s.includes(i))return!1;return!0}function Sc(t){return null!==t&&"object"===typeof t}
/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
function Tc(t){const e=[];for(const[s,n]of Object.entries(t))Array.isArray(n)?n.forEach((t=>{e.push(encodeURIComponent(s)+"="+encodeURIComponent(t))})):e.push(encodeURIComponent(s)+"="+encodeURIComponent(n));return e.length?"&"+e.join("&"):""}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
class kc{constructor(){this.chain_=[],this.buf_=[],this.W_=[],this.pad_=[],this.inbuf_=0,this.total_=0,this.blockSize=64,this.pad_[0]=128;for(let t=1;t<this.blockSize;++t)this.pad_[t]=0;this.reset()}reset(){this.chain_[0]=1732584193,this.chain_[1]=4023233417,this.chain_[2]=2562383102,this.chain_[3]=271733878,this.chain_[4]=3285377520,this.inbuf_=0,this.total_=0}compress_(t,e){e||(e=0);const s=this.W_;if("string"===typeof t)for(let l=0;l<16;l++)s[l]=t.charCodeAt(e)<<24|t.charCodeAt(e+1)<<16|t.charCodeAt(e+2)<<8|t.charCodeAt(e+3),e+=4;else for(let l=0;l<16;l++)s[l]=t[e]<<24|t[e+1]<<16|t[e+2]<<8|t[e+3],e+=4;for(let l=16;l<80;l++){const t=s[l-3]^s[l-8]^s[l-14]^s[l-16];s[l]=4294967295&(t<<1|t>>>31)}let n,i,r=this.chain_[0],o=this.chain_[1],a=this.chain_[2],h=this.chain_[3],c=this.chain_[4];for(let l=0;l<80;l++){l<40?l<20?(n=h^o&(a^h),i=1518500249):(n=o^a^h,i=1859775393):l<60?(n=o&a|h&(o|a),i=2400959708):(n=o^a^h,i=3395469782);const t=(r<<5|r>>>27)+n+c+i+s[l]&4294967295;c=h,h=a,a=4294967295&(o<<30|o>>>2),o=r,r=t}this.chain_[0]=this.chain_[0]+r&4294967295,this.chain_[1]=this.chain_[1]+o&4294967295,this.chain_[2]=this.chain_[2]+a&4294967295,this.chain_[3]=this.chain_[3]+h&4294967295,this.chain_[4]=this.chain_[4]+c&4294967295}update(t,e){if(null==t)return;void 0===e&&(e=t.length);const s=e-this.blockSize;let n=0;const i=this.buf_;let r=this.inbuf_;while(n<e){if(0===r)while(n<=s)this.compress_(t,n),n+=this.blockSize;if("string"===typeof t){while(n<e)if(i[r]=t.charCodeAt(n),++r,++n,r===this.blockSize){this.compress_(i),r=0;break}}else while(n<e)if(i[r]=t[n],++r,++n,r===this.blockSize){this.compress_(i),r=0;break}}this.inbuf_=r,this.total_+=e}digest(){const t=[];let e=8*this.total_;this.inbuf_<56?this.update(this.pad_,56-this.inbuf_):this.update(this.pad_,this.blockSize-(this.inbuf_-56));for(let n=this.blockSize-1;n>=56;n--)this.buf_[n]=255&e,e/=256;this.compress_(this.buf_);let s=0;for(let n=0;n<5;n++)for(let e=24;e>=0;e-=8)t[s]=this.chain_[n]>>e&255,++s;return t}}function Ac(t,e){return`${t} failed: ${e} argument `}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
const Ec=function(t){const e=[];let s=0;for(let n=0;n<t.length;n++){let i=t.charCodeAt(n);if(i>=55296&&i<=56319){const e=i-55296;n++,Eh(n<t.length,"Surrogate pair missing trail surrogate.");const s=t.charCodeAt(n)-56320;i=65536+(e<<10)+s}i<128?e[s++]=i:i<2048?(e[s++]=i>>6|192,e[s++]=63&i|128):i<65536?(e[s++]=i>>12|224,e[s++]=i>>6&63|128,e[s++]=63&i|128):(e[s++]=i>>18|240,e[s++]=i>>12&63|128,e[s++]=i>>6&63|128,e[s++]=63&i|128)}return e},Oc=function(t){let e=0;for(let s=0;s<t.length;s++){const n=t.charCodeAt(s);n<128?e++:n<2048?e+=2:n>=55296&&n<=56319?(e+=4,s++):e+=3}return e};
/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
function Dc(t){return t&&t._delegate?t._delegate:t}class Pc{constructor(t,e,s){this.name=t,this.instanceFactory=e,this.type=s,this.multipleInstances=!1,this.serviceProps={},this.instantiationMode="LAZY",this.onInstanceCreated=null}setInstantiationMode(t){return this.instantiationMode=t,this}setMultipleInstances(t){return this.multipleInstances=t,this}setServiceProps(t){return this.serviceProps=t,this}setInstanceCreatedCallback(t){return this.onInstanceCreated=t,this}}
/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Ic="[DEFAULT]";
/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Mc{constructor(t,e){this.name=t,this.container=e,this.component=null,this.instances=new Map,this.instancesDeferred=new Map,this.instancesOptions=new Map,this.onInitCallbacks=new Map}get(t){const e=this.normalizeInstanceIdentifier(t);if(!this.instancesDeferred.has(e)){const t=new qh;if(this.instancesDeferred.set(e,t),this.isInitialized(e)||this.shouldAutoInitialize())try{const s=this.getOrInitializeService({instanceIdentifier:e});s&&t.resolve(s)}catch(c){}}return this.instancesDeferred.get(e).promise}getImmediate(t){var e;const s=this.normalizeInstanceIdentifier(null===t||void 0===t?void 0:t.identifier),n=null!==(e=null===t||void 0===t?void 0:t.optional)&&void 0!==e&&e;if(!this.isInitialized(s)&&!this.shouldAutoInitialize()){if(n)return null;throw Error(`Service ${this.name} is not available`)}try{return this.getOrInitializeService({instanceIdentifier:s})}catch(c){if(n)return null;throw c}}getComponent(){return this.component}setComponent(t){if(t.name!==this.name)throw Error(`Mismatching Component ${t.name} for Provider ${this.name}.`);if(this.component)throw Error(`Component for ${this.name} has already been provided`);if(this.component=t,this.shouldAutoInitialize()){if(Fc(t))try{this.getOrInitializeService({instanceIdentifier:Ic})}catch(c){}for(const[t,e]of this.instancesDeferred.entries()){const s=this.normalizeInstanceIdentifier(t);try{const t=this.getOrInitializeService({instanceIdentifier:s});e.resolve(t)}catch(c){}}}}clearInstance(t=Ic){this.instancesDeferred.delete(t),this.instancesOptions.delete(t),this.instances.delete(t)}async delete(){const t=Array.from(this.instances.values());await Promise.all([...t.filter((t=>"INTERNAL"in t)).map((t=>t.INTERNAL.delete())),...t.filter((t=>"_delete"in t)).map((t=>t._delete()))])}isComponentSet(){return null!=this.component}isInitialized(t=Ic){return this.instances.has(t)}getOptions(t=Ic){return this.instancesOptions.get(t)||{}}initialize(t={}){const{options:e={}}=t,s=this.normalizeInstanceIdentifier(t.instanceIdentifier);if(this.isInitialized(s))throw Error(`${this.name}(${s}) has already been initialized`);if(!this.isComponentSet())throw Error(`Component ${this.name} has not been registered yet`);const n=this.getOrInitializeService({instanceIdentifier:s,options:e});for(const[i,r]of this.instancesDeferred.entries()){const t=this.normalizeInstanceIdentifier(i);s===t&&r.resolve(n)}return n}onInit(t,e){var s;const n=this.normalizeInstanceIdentifier(e),i=null!==(s=this.onInitCallbacks.get(n))&&void 0!==s?s:new Set;i.add(t),this.onInitCallbacks.set(n,i);const r=this.instances.get(n);return r&&t(r,n),()=>{i.delete(t)}}invokeOnInitCallbacks(t,e){const s=this.onInitCallbacks.get(e);if(s)for(const n of s)try{n(t,e)}catch(Ca){}}getOrInitializeService({instanceIdentifier:t,options:e={}}){let s=this.instances.get(t);if(!s&&this.component&&(s=this.component.instanceFactory(this.container,{instanceIdentifier:Rc(t),options:e}),this.instances.set(t,s),this.instancesOptions.set(t,e),this.invokeOnInitCallbacks(s,t),this.component.onInstanceCreated))try{this.component.onInstanceCreated(this.container,t,s)}catch(Ca){}return s||null}normalizeInstanceIdentifier(t=Ic){return this.component?this.component.multipleInstances?t:Ic:t}shouldAutoInitialize(){return!!this.component&&"EXPLICIT"!==this.component.instantiationMode}}function Rc(t){return t===Ic?void 0:t}function Fc(t){return"EAGER"===t.instantiationMode}
/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Lc{constructor(t){this.name=t,this.providers=new Map}addComponent(t){const e=this.getProvider(t.name);if(e.isComponentSet())throw new Error(`Component ${t.name} has already been registered with ${this.name}`);e.setComponent(t)}addOrOverwriteComponent(t){const e=this.getProvider(t.name);e.isComponentSet()&&this.providers.delete(t.name),this.addComponent(t)}getProvider(t){if(this.providers.has(t))return this.providers.get(t);const e=new Mc(t,this);return this.providers.set(t,e),e}getProviders(){return Array.from(this.providers.values())}}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
const jc=[];var Nc;(function(t){t[t["DEBUG"]=0]="DEBUG",t[t["VERBOSE"]=1]="VERBOSE",t[t["INFO"]=2]="INFO",t[t["WARN"]=3]="WARN",t[t["ERROR"]=4]="ERROR",t[t["SILENT"]=5]="SILENT"})(Nc||(Nc={}));const Bc={debug:Nc.DEBUG,verbose:Nc.VERBOSE,info:Nc.INFO,warn:Nc.WARN,error:Nc.ERROR,silent:Nc.SILENT},Wc=Nc.INFO,Uc={[Nc.DEBUG]:"log",[Nc.VERBOSE]:"log",[Nc.INFO]:"info",[Nc.WARN]:"warn",[Nc.ERROR]:"error"},Yc=(t,e,...s)=>{if(e<t.logLevel)return;const n=(new Date).toISOString(),i=Uc[e];if(!i)throw new Error(`Attempted to log a message with an invalid logType (value: ${e})`);console[i](`[${n}]  ${t.name}:`,...s)};class Xc{constructor(t){this.name=t,this._logLevel=Wc,this._logHandler=Yc,this._userLogHandler=null,jc.push(this)}get logLevel(){return this._logLevel}set logLevel(t){if(!(t in Nc))throw new TypeError(`Invalid value "${t}" assigned to \`logLevel\``);this._logLevel=t}setLogLevel(t){this._logLevel="string"===typeof t?Bc[t]:t}get logHandler(){return this._logHandler}set logHandler(t){if("function"!==typeof t)throw new TypeError("Value assigned to `logHandler` must be a function");this._logHandler=t}get userLogHandler(){return this._userLogHandler}set userLogHandler(t){this._userLogHandler=t}debug(...t){this._userLogHandler&&this._userLogHandler(this,Nc.DEBUG,...t),this._logHandler(this,Nc.DEBUG,...t)}log(...t){this._userLogHandler&&this._userLogHandler(this,Nc.VERBOSE,...t),this._logHandler(this,Nc.VERBOSE,...t)}info(...t){this._userLogHandler&&this._userLogHandler(this,Nc.INFO,...t),this._logHandler(this,Nc.INFO,...t)}warn(...t){this._userLogHandler&&this._userLogHandler(this,Nc.WARN,...t),this._logHandler(this,Nc.WARN,...t)}error(...t){this._userLogHandler&&this._userLogHandler(this,Nc.ERROR,...t),this._logHandler(this,Nc.ERROR,...t)}}const Vc=(t,e)=>e.some((e=>t instanceof e));let Gc,Hc;function zc(){return Gc||(Gc=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction])}function qc(){return Hc||(Hc=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])}const Kc=new WeakMap,Qc=new WeakMap,Jc=new WeakMap,Zc=new WeakMap,$c=new WeakMap;function tl(t){const e=new Promise(((e,s)=>{const n=()=>{t.removeEventListener("success",i),t.removeEventListener("error",r)},i=()=>{e(ol(t.result)),n()},r=()=>{s(t.error),n()};t.addEventListener("success",i),t.addEventListener("error",r)}));return e.then((e=>{e instanceof IDBCursor&&Kc.set(e,t)})).catch((()=>{})),$c.set(e,t),e}function el(t){if(Qc.has(t))return;const e=new Promise(((e,s)=>{const n=()=>{t.removeEventListener("complete",i),t.removeEventListener("error",r),t.removeEventListener("abort",r)},i=()=>{e(),n()},r=()=>{s(t.error||new DOMException("AbortError","AbortError")),n()};t.addEventListener("complete",i),t.addEventListener("error",r),t.addEventListener("abort",r)}));Qc.set(t,e)}let sl={get(t,e,s){if(t instanceof IDBTransaction){if("done"===e)return Qc.get(t);if("objectStoreNames"===e)return t.objectStoreNames||Jc.get(t);if("store"===e)return s.objectStoreNames[1]?void 0:s.objectStore(s.objectStoreNames[0])}return ol(t[e])},set(t,e,s){return t[e]=s,!0},has(t,e){return t instanceof IDBTransaction&&("done"===e||"store"===e)||e in t}};function nl(t){sl=t(sl)}function il(t){return t!==IDBDatabase.prototype.transaction||"objectStoreNames"in IDBTransaction.prototype?qc().includes(t)?function(...e){return t.apply(al(this),e),ol(Kc.get(this))}:function(...e){return ol(t.apply(al(this),e))}:function(e,...s){const n=t.call(al(this),e,...s);return Jc.set(n,e.sort?e.sort():[e]),ol(n)}}function rl(t){return"function"===typeof t?il(t):(t instanceof IDBTransaction&&el(t),Vc(t,zc())?new Proxy(t,sl):t)}function ol(t){if(t instanceof IDBRequest)return tl(t);if(Zc.has(t))return Zc.get(t);const e=rl(t);return e!==t&&(Zc.set(t,e),$c.set(e,t)),e}const al=t=>$c.get(t);function hl(t,e,{blocked:s,upgrade:n,blocking:i,terminated:r}={}){const o=indexedDB.open(t,e),a=ol(o);return n&&o.addEventListener("upgradeneeded",(t=>{n(ol(o.result),t.oldVersion,t.newVersion,ol(o.transaction),t)})),s&&o.addEventListener("blocked",(t=>s(t.oldVersion,t.newVersion,t))),a.then((t=>{r&&t.addEventListener("close",(()=>r())),i&&t.addEventListener("versionchange",(t=>i(t.oldVersion,t.newVersion,t)))})).catch((()=>{})),a}const cl=["get","getKey","getAll","getAllKeys","count"],ll=["put","add","delete","clear"],ul=new Map;function dl(t,e){if(!(t instanceof IDBDatabase)||e in t||"string"!==typeof e)return;if(ul.get(e))return ul.get(e);const s=e.replace(/FromIndex$/,""),n=e!==s,i=ll.includes(s);if(!(s in(n?IDBIndex:IDBObjectStore).prototype)||!i&&!cl.includes(s))return;const r=async function(t,...e){const r=this.transaction(t,i?"readwrite":"readonly");let o=r.store;return n&&(o=o.index(e.shift())),(await Promise.all([o[s](...e),i&&r.done]))[0]};return ul.set(e,r),r}nl((t=>({...t,get:(e,s,n)=>dl(e,s)||t.get(e,s,n),has:(e,s)=>!!dl(e,s)||t.has(e,s)})));
/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
class gl{constructor(t){this.container=t}getPlatformInfoString(){const t=this.container.getProviders();return t.map((t=>{if(pl(t)){const e=t.getImmediate();return`${e.library}/${e.version}`}return null})).filter((t=>t)).join(" ")}}function pl(t){const e=t.getComponent();return"VERSION"===(null===e||void 0===e?void 0:e.type)}const fl="@firebase/app",ml="0.13.1",_l=new Xc("@firebase/app"),vl="@firebase/app-compat",yl="@firebase/analytics-compat",Cl="@firebase/analytics",bl="@firebase/app-check-compat",wl="@firebase/app-check",xl="@firebase/auth",Sl="@firebase/auth-compat",Tl="@firebase/database",kl="@firebase/data-connect",Al="@firebase/database-compat",El="@firebase/functions",Ol="@firebase/functions-compat",Dl="@firebase/installations",Pl="@firebase/installations-compat",Il="@firebase/messaging",Ml="@firebase/messaging-compat",Rl="@firebase/performance",Fl="@firebase/performance-compat",Ll="@firebase/remote-config",jl="@firebase/remote-config-compat",Nl="@firebase/storage",Bl="@firebase/storage-compat",Wl="@firebase/firestore",Ul="@firebase/ai",Yl="@firebase/firestore-compat",Xl="firebase",Vl="11.9.0",Gl="[DEFAULT]",Hl={[fl]:"fire-core",[vl]:"fire-core-compat",[Cl]:"fire-analytics",[yl]:"fire-analytics-compat",[wl]:"fire-app-check",[bl]:"fire-app-check-compat",[xl]:"fire-auth",[Sl]:"fire-auth-compat",[Tl]:"fire-rtdb",[kl]:"fire-data-connect",[Al]:"fire-rtdb-compat",[El]:"fire-fn",[Ol]:"fire-fn-compat",[Dl]:"fire-iid",[Pl]:"fire-iid-compat",[Il]:"fire-fcm",[Ml]:"fire-fcm-compat",[Rl]:"fire-perf",[Fl]:"fire-perf-compat",[Ll]:"fire-rc",[jl]:"fire-rc-compat",[Nl]:"fire-gcs",[Bl]:"fire-gcs-compat",[Wl]:"fire-fst",[Yl]:"fire-fst-compat",[Ul]:"fire-vertex","fire-js":"fire-js",[Xl]:"fire-js-all"},zl=new Map,ql=new Map,Kl=new Map;function Ql(t,e){try{t.container.addComponent(e)}catch(c){_l.debug(`Component ${e.name} failed to register with FirebaseApp ${t.name}`,c)}}function Jl(t){const e=t.name;if(Kl.has(e))return _l.debug(`There were multiple attempts to register component ${e}.`),!1;Kl.set(e,t);for(const s of zl.values())Ql(s,t);for(const s of ql.values())Ql(s,t);return!0}function Zl(t,e){const s=t.container.getProvider("heartbeat").getImmediate({optional:!0});return s&&s.triggerHeartbeat(),t.container.getProvider(e)}function $l(t){return null!==t&&void 0!==t&&void 0!==t.settings}
/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
const tu={["no-app"]:"No Firebase App '{$appName}' has been created - call initializeApp() first",["bad-app-name"]:"Illegal App name: '{$appName}'",["duplicate-app"]:"Firebase App named '{$appName}' already exists with different options or config",["app-deleted"]:"Firebase App named '{$appName}' already deleted",["server-app-deleted"]:"Firebase Server App has been deleted",["no-options"]:"Need to provide options, when not being deployed to hosting via source.",["invalid-app-argument"]:"firebase.{$appName}() takes either no argument or a Firebase App instance.",["invalid-log-argument"]:"First argument to `onLog` must be null or a function.",["idb-open"]:"Error thrown when opening IndexedDB. Original error: {$originalErrorMessage}.",["idb-get"]:"Error thrown when reading from IndexedDB. Original error: {$originalErrorMessage}.",["idb-set"]:"Error thrown when writing to IndexedDB. Original error: {$originalErrorMessage}.",["idb-delete"]:"Error thrown when deleting from IndexedDB. Original error: {$originalErrorMessage}.",["finalization-registry-not-supported"]:"FirebaseServerApp deleteOnDeref field defined but the JS runtime does not support FinalizationRegistry.",["invalid-server-app-environment"]:"FirebaseServerApp is not for use in browser environments."},eu=new uc("app","Firebase",tu);
/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
class su{constructor(t,e,s){this._isDeleted=!1,this._options=Object.assign({},t),this._config=Object.assign({},e),this._name=e.name,this._automaticDataCollectionEnabled=e.automaticDataCollectionEnabled,this._container=s,this.container.addComponent(new Pc("app",(()=>this),"PUBLIC"))}get automaticDataCollectionEnabled(){return this.checkDestroyed(),this._automaticDataCollectionEnabled}set automaticDataCollectionEnabled(t){this.checkDestroyed(),this._automaticDataCollectionEnabled=t}get name(){return this.checkDestroyed(),this._name}get options(){return this.checkDestroyed(),this._options}get config(){return this.checkDestroyed(),this._config}get container(){return this._container}get isDeleted(){return this._isDeleted}set isDeleted(t){this._isDeleted=t}checkDestroyed(){if(this.isDeleted)throw eu.create("app-deleted",{appName:this._name})}}
/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
const nu=Vl;function iu(t,e={}){let s=t;if("object"!==typeof e){const t=e;e={name:t}}const n=Object.assign({name:Gl,automaticDataCollectionEnabled:!0},e),i=n.name;if("string"!==typeof i||!i)throw eu.create("bad-app-name",{appName:String(i)});if(s||(s=zh()),!s)throw eu.create("no-options");const r=zl.get(i);if(r){if(xc(s,r.options)&&xc(n,r.config))return r;throw eu.create("duplicate-app",{appName:i})}const o=new Lc(i);for(const h of Kl.values())o.addComponent(h);const a=new su(s,n,o);return zl.set(i,a),a}function ru(t=Gl){const e=zl.get(t);if(!e&&t===Gl&&zh())return iu();if(!e)throw eu.create("no-app",{appName:t});return e}function ou(t,e,s){var n;let i=null!==(n=Hl[t])&&void 0!==n?n:t;s&&(i+=`-${s}`);const r=i.match(/\s|\//),o=e.match(/\s|\//);if(r||o){const t=[`Unable to register library "${i}" with version "${e}":`];return r&&t.push(`library name "${i}" contains illegal characters (whitespace or "/")`),r&&o&&t.push("and"),o&&t.push(`version name "${e}" contains illegal characters (whitespace or "/")`),void _l.warn(t.join(" "))}Jl(new Pc(`${i}-version`,(()=>({library:i,version:e})),"VERSION"))}
/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
const au="firebase-heartbeat-database",hu=1,cu="firebase-heartbeat-store";let lu=null;function uu(){return lu||(lu=hl(au,hu,{upgrade:(t,e)=>{switch(e){case 0:try{t.createObjectStore(cu)}catch(c){console.warn(c)}}}}).catch((t=>{throw eu.create("idb-open",{originalErrorMessage:t.message})}))),lu}async function du(t){try{const e=await uu(),s=e.transaction(cu),n=await s.objectStore(cu).get(pu(t));return await s.done,n}catch(c){if(c instanceof lc)_l.warn(c.message);else{const e=eu.create("idb-get",{originalErrorMessage:null===c||void 0===c?void 0:c.message});_l.warn(e.message)}}}async function gu(t,e){try{const s=await uu(),n=s.transaction(cu,"readwrite"),i=n.objectStore(cu);await i.put(e,pu(t)),await n.done}catch(c){if(c instanceof lc)_l.warn(c.message);else{const e=eu.create("idb-set",{originalErrorMessage:null===c||void 0===c?void 0:c.message});_l.warn(e.message)}}}function pu(t){return`${t.name}!${t.options.appId}`}
/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const fu=1024,mu=30;class _u{constructor(t){this.container=t,this._heartbeatsCache=null;const e=this.container.getProvider("app").getImmediate();this._storage=new Cu(e),this._heartbeatsCachePromise=this._storage.read().then((t=>(this._heartbeatsCache=t,t)))}async triggerHeartbeat(){var t,e;try{const s=this.container.getProvider("platform-logger").getImmediate(),n=s.getPlatformInfoString(),i=vu();if(null==(null===(t=this._heartbeatsCache)||void 0===t?void 0:t.heartbeats)&&(this._heartbeatsCache=await this._heartbeatsCachePromise,null==(null===(e=this._heartbeatsCache)||void 0===e?void 0:e.heartbeats)))return;if(this._heartbeatsCache.lastSentHeartbeatDate===i||this._heartbeatsCache.heartbeats.some((t=>t.date===i)))return;if(this._heartbeatsCache.heartbeats.push({date:i,agent:n}),this._heartbeatsCache.heartbeats.length>mu){const t=wu(this._heartbeatsCache.heartbeats);this._heartbeatsCache.heartbeats.splice(t,1)}return this._storage.overwrite(this._heartbeatsCache)}catch(c){_l.warn(c)}}async getHeartbeatsHeader(){var t;try{if(null===this._heartbeatsCache&&await this._heartbeatsCachePromise,null==(null===(t=this._heartbeatsCache)||void 0===t?void 0:t.heartbeats)||0===this._heartbeatsCache.heartbeats.length)return"";const e=vu(),{heartbeatsToSend:s,unsentEntries:n}=yu(this._heartbeatsCache.heartbeats),i=Fh(JSON.stringify({version:2,heartbeats:s}));return this._heartbeatsCache.lastSentHeartbeatDate=e,n.length>0?(this._heartbeatsCache.heartbeats=n,await this._storage.overwrite(this._heartbeatsCache)):(this._heartbeatsCache.heartbeats=[],this._storage.overwrite(this._heartbeatsCache)),i}catch(c){return _l.warn(c),""}}}function vu(){const t=new Date;return t.toISOString().substring(0,10)}function yu(t,e=fu){const s=[];let n=t.slice();for(const i of t){const t=s.find((t=>t.agent===i.agent));if(t){if(t.dates.push(i.date),bu(s)>e){t.dates.pop();break}}else if(s.push({agent:i.agent,dates:[i.date]}),bu(s)>e){s.pop();break}n=n.slice(1)}return{heartbeatsToSend:s,unsentEntries:n}}class Cu{constructor(t){this.app=t,this._canUseIndexedDBPromise=this.runIndexedDBEnvironmentCheck()}async runIndexedDBEnvironmentCheck(){return!!ac()&&hc().then((()=>!0)).catch((()=>!1))}async read(){const t=await this._canUseIndexedDBPromise;if(t){const t=await du(this.app);return(null===t||void 0===t?void 0:t.heartbeats)?t:{heartbeats:[]}}return{heartbeats:[]}}async overwrite(t){var e;const s=await this._canUseIndexedDBPromise;if(s){const s=await this.read();return gu(this.app,{lastSentHeartbeatDate:null!==(e=t.lastSentHeartbeatDate)&&void 0!==e?e:s.lastSentHeartbeatDate,heartbeats:t.heartbeats})}}async add(t){var e;const s=await this._canUseIndexedDBPromise;if(s){const s=await this.read();return gu(this.app,{lastSentHeartbeatDate:null!==(e=t.lastSentHeartbeatDate)&&void 0!==e?e:s.lastSentHeartbeatDate,heartbeats:[...s.heartbeats,...t.heartbeats]})}}}function bu(t){return Fh(JSON.stringify({version:2,heartbeats:t})).length}function wu(t){if(0===t.length)return-1;let e=0,s=t[0].date;for(let n=1;n<t.length;n++)t[n].date<s&&(s=t[n].date,e=n);return e}
/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function xu(t){Jl(new Pc("platform-logger",(t=>new gl(t)),"PRIVATE")),Jl(new Pc("heartbeat",(t=>new _u(t)),"PRIVATE")),ou(fl,ml,t),ou(fl,ml,"esm2017"),ou("fire-js","")}xu("");var Su="firebase",Tu="11.9.1";
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
ou(Su,Tu,"app");const ku="@firebase/database",Au="1.0.19";
/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let Eu="";function Ou(t){Eu=t}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Du{constructor(t){this.domStorage_=t,this.prefix_="firebase:"}set(t,e){null==e?this.domStorage_.removeItem(this.prefixedName_(t)):this.domStorage_.setItem(this.prefixedName_(t),fc(e))}get(t){const e=this.domStorage_.getItem(this.prefixedName_(t));return null==e?null:pc(e)}remove(t){this.domStorage_.removeItem(this.prefixedName_(t))}prefixedName_(t){return this.prefix_+t}toString(){return this.domStorage_.toString()}}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Pu{constructor(){this.cache_={},this.isInMemoryStorage=!0}set(t,e){null==e?delete this.cache_[t]:this.cache_[t]=e}get(t){return yc(this.cache_,t)?this.cache_[t]:null}remove(t){delete this.cache_[t]}}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Iu=function(t){try{if("undefined"!==typeof window&&"undefined"!==typeof window[t]){const e=window[t];return e.setItem("firebase:sentinel","cache"),e.removeItem("firebase:sentinel"),new Du(e)}}catch(c){}return new Pu},Mu=Iu("localStorage"),Ru=Iu("sessionStorage"),Fu=new Xc("@firebase/database"),Lu=function(){let t=1;return function(){return t++}}(),ju=function(t){const e=Ec(t),s=new kc;s.update(e);const n=s.digest();return Ih.encodeByteArray(n)},Nu=function(...t){let e="";for(let s=0;s<t.length;s++){const n=t[s];Array.isArray(n)||n&&"object"===typeof n&&"number"===typeof n.length?e+=Nu.apply(null,n):e+="object"===typeof n?fc(n):n,e+=" "}return e};let Bu=null,Wu=!0;const Uu=function(t,e){Eh(!e||!0===t||!1===t,"Can't turn on custom loggers persistently."),!0===t?(Fu.logLevel=Nc.VERBOSE,Bu=Fu.log.bind(Fu),e&&Ru.set("logging_enabled",!0)):"function"===typeof t?Bu=t:(Bu=null,Ru.remove("logging_enabled"))},Yu=function(...t){if(!0===Wu&&(Wu=!1,null===Bu&&!0===Ru.get("logging_enabled")&&Uu(!0)),Bu){const e=Nu.apply(null,t);Bu(e)}},Xu=function(t){return function(...e){Yu(t,...e)}},Vu=function(...t){const e="FIREBASE INTERNAL ERROR: "+Nu(...t);Fu.error(e)},Gu=function(...t){const e=`FIREBASE FATAL ERROR: ${Nu(...t)}`;throw Fu.error(e),new Error(e)},Hu=function(...t){const e="FIREBASE WARNING: "+Nu(...t);Fu.warn(e)},zu=function(){"undefined"!==typeof window&&window.location&&window.location.protocol&&-1!==window.location.protocol.indexOf("https:")&&Hu("Insecure Firebase access from a secure page. Please use https in calls to new Firebase().")},qu=function(t){return"number"===typeof t&&(t!==t||t===Number.POSITIVE_INFINITY||t===Number.NEGATIVE_INFINITY)},Ku=function(t){if(oc()||"complete"===document.readyState)t();else{let e=!1;const s=function(){document.body?e||(e=!0,t()):setTimeout(s,Math.floor(10))};document.addEventListener?(document.addEventListener("DOMContentLoaded",s,!1),window.addEventListener("load",s,!1)):document.attachEvent&&(document.attachEvent("onreadystatechange",(()=>{"complete"===document.readyState&&s()})),window.attachEvent("onload",s))}},Qu="[MIN_NAME]",Ju="[MAX_NAME]",Zu=function(t,e){if(t===e)return 0;if(t===Qu||e===Ju)return-1;if(e===Qu||t===Ju)return 1;{const s=ld(t),n=ld(e);return null!==s?null!==n?s-n===0?t.length-e.length:s-n:-1:null!==n?1:t<e?-1:1}},$u=function(t,e){return t===e?0:t<e?-1:1},td=function(t,e){if(e&&t in e)return e[t];throw new Error("Missing required key ("+t+") in object: "+fc(e))},ed=function(t){if("object"!==typeof t||null===t)return fc(t);const e=[];for(const n in t)e.push(n);e.sort();let s="{";for(let n=0;n<e.length;n++)0!==n&&(s+=","),s+=fc(e[n]),s+=":",s+=ed(t[e[n]]);return s+="}",s},sd=function(t,e){const s=t.length;if(s<=e)return[t];const n=[];for(let i=0;i<s;i+=e)i+e>s?n.push(t.substring(i,s)):n.push(t.substring(i,i+e));return n};function nd(t,e){for(const s in t)t.hasOwnProperty(s)&&e(s,t[s])}const id=function(t){Eh(!qu(t),"Invalid JSON number");const e=11,s=52,n=(1<<e-1)-1;let i,r,o,a,h;0===t?(r=0,o=0,i=1/t===-1/0?1:0):(i=t<0,t=Math.abs(t),t>=Math.pow(2,1-n)?(a=Math.min(Math.floor(Math.log(t)/Math.LN2),n),r=a+n,o=Math.round(t*Math.pow(2,s-a)-Math.pow(2,s))):(r=0,o=Math.round(t/Math.pow(2,1-n-s))));const c=[];for(h=s;h;h-=1)c.push(o%2?1:0),o=Math.floor(o/2);for(h=e;h;h-=1)c.push(r%2?1:0),r=Math.floor(r/2);c.push(i?1:0),c.reverse();const l=c.join("");let u="";for(h=0;h<64;h+=8){let t=parseInt(l.substr(h,8),2).toString(16);1===t.length&&(t="0"+t),u+=t}return u.toLowerCase()},rd=function(){return!("object"!==typeof window||!window["chrome"]||!window["chrome"]["extension"]||/^chrome/.test(window.location.href))},od=function(){return"object"===typeof Windows&&"object"===typeof Windows.UI};const ad=new RegExp("^-?(0*)\\d{1,10}$"),hd=-2147483648,cd=2147483647,ld=function(t){if(ad.test(t)){const e=Number(t);if(e>=hd&&e<=cd)return e}return null},ud=function(t){try{t()}catch(c){setTimeout((()=>{const e=c.stack||"";throw Hu("Exception was thrown by user callback.",e),c}),Math.floor(0))}},dd=function(){const t="object"===typeof window&&window["navigator"]&&window["navigator"]["userAgent"]||"";return t.search(/googlebot|google webmaster tools|bingbot|yahoo! slurp|baiduspider|yandexbot|duckduckbot/i)>=0},gd=function(t,e){const s=setTimeout(t,e);return"number"===typeof s&&"undefined"!==typeof Deno&&Deno["unrefTimer"]?Deno.unrefTimer(s):"object"===typeof s&&s["unref"]&&s["unref"](),s};
/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
class pd{constructor(t,e){this.appCheckProvider=e,this.appName=t.name,$l(t)&&t.settings.appCheckToken&&(this.serverAppAppCheckToken=t.settings.appCheckToken),this.appCheck=null===e||void 0===e?void 0:e.getImmediate({optional:!0}),this.appCheck||null===e||void 0===e||e.get().then((t=>this.appCheck=t))}getToken(t){if(this.serverAppAppCheckToken){if(t)throw new Error("Attempted reuse of `FirebaseServerApp.appCheckToken` after previous usage failed.");return Promise.resolve({token:this.serverAppAppCheckToken})}return this.appCheck?this.appCheck.getToken(t):new Promise(((e,s)=>{setTimeout((()=>{this.appCheck?this.getToken(t).then(e,s):e(null)}),0)}))}addTokenChangeListener(t){var e;null===(e=this.appCheckProvider)||void 0===e||e.get().then((e=>e.addTokenListener(t)))}notifyForInvalidToken(){Hu(`Provided AppCheck credentials for the app named "${this.appName}" are invalid. This usually indicates your app was not initialized correctly.`)}}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class fd{constructor(t,e,s){this.appName_=t,this.firebaseOptions_=e,this.authProvider_=s,this.auth_=null,this.auth_=s.getImmediate({optional:!0}),this.auth_||s.onInit((t=>this.auth_=t))}getToken(t){return this.auth_?this.auth_.getToken(t).catch((t=>t&&"auth/token-not-initialized"===t.code?(Yu("Got auth/token-not-initialized error.  Treating as null token."),null):Promise.reject(t))):new Promise(((e,s)=>{setTimeout((()=>{this.auth_?this.getToken(t).then(e,s):e(null)}),0)}))}addTokenChangeListener(t){this.auth_?this.auth_.addAuthTokenListener(t):this.authProvider_.get().then((e=>e.addAuthTokenListener(t)))}removeTokenChangeListener(t){this.authProvider_.get().then((e=>e.removeAuthTokenListener(t)))}notifyForInvalidToken(){let t='Provided authentication credentials for the app named "'+this.appName_+'" are invalid. This usually indicates your app was not initialized correctly. ';"credential"in this.firebaseOptions_?t+='Make sure the "credential" property provided to initializeApp() is authorized to access the specified "databaseURL" and is from the correct project.':"serviceAccount"in this.firebaseOptions_?t+='Make sure the "serviceAccount" property provided to initializeApp() is authorized to access the specified "databaseURL" and is from the correct project.':t+='Make sure the "apiKey" and "databaseURL" properties provided to initializeApp() match the values provided for your app at https://console.firebase.google.com/.',Hu(t)}}class md{constructor(t){this.accessToken=t}getToken(t){return Promise.resolve({accessToken:this.accessToken})}addTokenChangeListener(t){t(this.accessToken)}removeTokenChangeListener(t){}notifyForInvalidToken(){}}md.OWNER="owner";
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
const _d="5",vd="v",yd="s",Cd="r",bd="f",wd=/(console\.firebase|firebase-console-\w+\.corp|firebase\.corp)\.google\.com/,xd="ls",Sd="p",Td="ac",kd="websocket",Ad="long_polling";
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
class Ed{constructor(t,e,s,n,i=!1,r="",o=!1,a=!1,h=null){this.secure=e,this.namespace=s,this.webSocketOnly=n,this.nodeAdmin=i,this.persistenceKey=r,this.includeNamespaceInQueryParams=o,this.isUsingEmulator=a,this.emulatorOptions=h,this._host=t.toLowerCase(),this._domain=this._host.substr(this._host.indexOf(".")+1),this.internalHost=Mu.get("host:"+t)||this._host}isCacheableHost(){return"s-"===this.internalHost.substr(0,2)}isCustomHost(){return"firebaseio.com"!==this._domain&&"firebaseio-demo.com"!==this._domain}get host(){return this._host}set host(t){t!==this.internalHost&&(this.internalHost=t,this.isCacheableHost()&&Mu.set("host:"+this._host,this.internalHost))}toString(){let t=this.toURLString();return this.persistenceKey&&(t+="<"+this.persistenceKey+">"),t}toURLString(){const t=this.secure?"https://":"http://",e=this.includeNamespaceInQueryParams?`?ns=${this.namespace}`:"";return`${t}${this.host}/${e}`}}function Od(t){return t.host!==t.internalHost||t.isCustomHost()||t.includeNamespaceInQueryParams}function Dd(t,e,s){let n;if(Eh("string"===typeof e,"typeof type must == string"),Eh("object"===typeof s,"typeof params must == object"),e===kd)n=(t.secure?"wss://":"ws://")+t.internalHost+"/.ws?";else{if(e!==Ad)throw new Error("Unknown connection type: "+e);n=(t.secure?"https://":"http://")+t.internalHost+"/.lp?"}Od(t)&&(s["ns"]=t.namespace);const i=[];return nd(s,((t,e)=>{i.push(t+"="+e)})),n+i.join("&")}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Pd{constructor(){this.counters_={}}incrementCounter(t,e=1){yc(this.counters_,t)||(this.counters_[t]=0),this.counters_[t]+=e}get(){return jh(this.counters_)}}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Id={},Md={};function Rd(t){const e=t.toString();return Id[e]||(Id[e]=new Pd),Id[e]}function Fd(t,e){const s=t.toString();return Md[s]||(Md[s]=e()),Md[s]}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ld{constructor(t){this.onMessage_=t,this.pendingResponses=[],this.currentResponseNum=0,this.closeAfterResponse=-1,this.onClose=null}closeAfter(t,e){this.closeAfterResponse=t,this.onClose=e,this.closeAfterResponse<this.currentResponseNum&&(this.onClose(),this.onClose=null)}handleResponse(t,e){this.pendingResponses[t]=e;while(this.pendingResponses[this.currentResponseNum]){const t=this.pendingResponses[this.currentResponseNum];delete this.pendingResponses[this.currentResponseNum];for(let e=0;e<t.length;++e)t[e]&&ud((()=>{this.onMessage_(t[e])}));if(this.currentResponseNum===this.closeAfterResponse){this.onClose&&(this.onClose(),this.onClose=null);break}this.currentResponseNum++}}}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const jd="start",Nd="close",Bd="pLPCommand",Wd="pRTLPCB",Ud="id",Yd="pw",Xd="ser",Vd="cb",Gd="seg",Hd="ts",zd="d",qd="dframe",Kd=1870,Qd=30,Jd=Kd-Qd,Zd=25e3,$d=3e4;class tg{constructor(t,e,s,n,i,r,o){this.connId=t,this.repoInfo=e,this.applicationId=s,this.appCheckToken=n,this.authToken=i,this.transportSessionId=r,this.lastSessionId=o,this.bytesSent=0,this.bytesReceived=0,this.everConnected_=!1,this.log_=Xu(t),this.stats_=Rd(e),this.urlFn=t=>(this.appCheckToken&&(t[Td]=this.appCheckToken),Dd(e,Ad,t))}open(t,e){this.curSegmentNum=0,this.onDisconnect_=e,this.myPacketOrderer=new Ld(t),this.isClosed_=!1,this.connectTimeoutTimer_=setTimeout((()=>{this.log_("Timed out trying to connect."),this.onClosed_(),this.connectTimeoutTimer_=null}),Math.floor($d)),Ku((()=>{if(this.isClosed_)return;this.scriptTagHolder=new eg(((...t)=>{const[e,s,n,i,r]=t;if(this.incrementIncomingBytes_(t),this.scriptTagHolder)if(this.connectTimeoutTimer_&&(clearTimeout(this.connectTimeoutTimer_),this.connectTimeoutTimer_=null),this.everConnected_=!0,e===jd)this.id=s,this.password=n;else{if(e!==Nd)throw new Error("Unrecognized command received: "+e);s?(this.scriptTagHolder.sendNewPolls=!1,this.myPacketOrderer.closeAfter(s,(()=>{this.onClosed_()}))):this.onClosed_()}}),((...t)=>{const[e,s]=t;this.incrementIncomingBytes_(t),this.myPacketOrderer.handleResponse(e,s)}),(()=>{this.onClosed_()}),this.urlFn);const t={};t[jd]="t",t[Xd]=Math.floor(1e8*Math.random()),this.scriptTagHolder.uniqueCallbackIdentifier&&(t[Vd]=this.scriptTagHolder.uniqueCallbackIdentifier),t[vd]=_d,this.transportSessionId&&(t[yd]=this.transportSessionId),this.lastSessionId&&(t[xd]=this.lastSessionId),this.applicationId&&(t[Sd]=this.applicationId),this.appCheckToken&&(t[Td]=this.appCheckToken),"undefined"!==typeof location&&location.hostname&&wd.test(location.hostname)&&(t[Cd]=bd);const e=this.urlFn(t);this.log_("Connecting via long-poll to "+e),this.scriptTagHolder.addTag(e,(()=>{}))}))}start(){this.scriptTagHolder.startLongPoll(this.id,this.password),this.addDisconnectPingFrame(this.id,this.password)}static forceAllow(){tg.forceAllow_=!0}static forceDisallow(){tg.forceDisallow_=!0}static isAvailable(){return!oc()&&(!!tg.forceAllow_||!tg.forceDisallow_&&"undefined"!==typeof document&&null!=document.createElement&&!rd()&&!od())}markConnectionHealthy(){}shutdown_(){this.isClosed_=!0,this.scriptTagHolder&&(this.scriptTagHolder.close(),this.scriptTagHolder=null),this.myDisconnFrame&&(document.body.removeChild(this.myDisconnFrame),this.myDisconnFrame=null),this.connectTimeoutTimer_&&(clearTimeout(this.connectTimeoutTimer_),this.connectTimeoutTimer_=null)}onClosed_(){this.isClosed_||(this.log_("Longpoll is closing itself"),this.shutdown_(),this.onDisconnect_&&(this.onDisconnect_(this.everConnected_),this.onDisconnect_=null))}close(){this.isClosed_||(this.log_("Longpoll is being closed."),this.shutdown_())}send(t){const e=fc(t);this.bytesSent+=e.length,this.stats_.incrementCounter("bytes_sent",e.length);const s=Rh(e),n=sd(s,Jd);for(let i=0;i<n.length;i++)this.scriptTagHolder.enqueueSegment(this.curSegmentNum,n.length,n[i]),this.curSegmentNum++}addDisconnectPingFrame(t,e){if(oc())return;this.myDisconnFrame=document.createElement("iframe");const s={};s[qd]="t",s[Ud]=t,s[Yd]=e,this.myDisconnFrame.src=this.urlFn(s),this.myDisconnFrame.style.display="none",document.body.appendChild(this.myDisconnFrame)}incrementIncomingBytes_(t){const e=fc(t).length;this.bytesReceived+=e,this.stats_.incrementCounter("bytes_received",e)}}class eg{constructor(t,e,s,n){if(this.onDisconnect=s,this.urlFn=n,this.outstandingRequests=new Set,this.pendingSegs=[],this.currentSerial=Math.floor(1e8*Math.random()),this.sendNewPolls=!0,oc())this.commandCB=t,this.onMessageCB=e;else{this.uniqueCallbackIdentifier=Lu(),window[Bd+this.uniqueCallbackIdentifier]=t,window[Wd+this.uniqueCallbackIdentifier]=e,this.myIFrame=eg.createIFrame_();let s="";if(this.myIFrame.src&&"javascript:"===this.myIFrame.src.substr(0,11)){const t=document.domain;s='<script>document.domain="'+t+'";<\/script>'}const n="<html><body>"+s+"</body></html>";try{this.myIFrame.doc.open(),this.myIFrame.doc.write(n),this.myIFrame.doc.close()}catch(c){Yu("frame writing exception"),c.stack&&Yu(c.stack),Yu(c)}}}static createIFrame_(){const t=document.createElement("iframe");if(t.style.display="none",!document.body)throw"Document body has not initialized. Wait to initialize Firebase until after the document is ready.";document.body.appendChild(t);try{const e=t.contentWindow.document;e||Yu("No IE domain setting required")}catch(c){const s=document.domain;t.src="javascript:void((function(){document.open();document.domain='"+s+"';document.close();})())"}return t.contentDocument?t.doc=t.contentDocument:t.contentWindow?t.doc=t.contentWindow.document:t.document&&(t.doc=t.document),t}close(){this.alive=!1,this.myIFrame&&(this.myIFrame.doc.body.textContent="",setTimeout((()=>{null!==this.myIFrame&&(document.body.removeChild(this.myIFrame),this.myIFrame=null)}),Math.floor(0)));const t=this.onDisconnect;t&&(this.onDisconnect=null,t())}startLongPoll(t,e){this.myID=t,this.myPW=e,this.alive=!0;while(this.newRequest_());}newRequest_(){if(this.alive&&this.sendNewPolls&&this.outstandingRequests.size<(this.pendingSegs.length>0?2:1)){this.currentSerial++;const t={};t[Ud]=this.myID,t[Yd]=this.myPW,t[Xd]=this.currentSerial;let e=this.urlFn(t),s="",n=0;while(this.pendingSegs.length>0){const t=this.pendingSegs[0];if(!(t.d.length+Qd+s.length<=Kd))break;{const t=this.pendingSegs.shift();s=s+"&"+Gd+n+"="+t.seg+"&"+Hd+n+"="+t.ts+"&"+zd+n+"="+t.d,n++}}return e+=s,this.addLongPollTag_(e,this.currentSerial),!0}return!1}enqueueSegment(t,e,s){this.pendingSegs.push({seg:t,ts:e,d:s}),this.alive&&this.newRequest_()}addLongPollTag_(t,e){this.outstandingRequests.add(e);const s=()=>{this.outstandingRequests.delete(e),this.newRequest_()},n=setTimeout(s,Math.floor(Zd)),i=()=>{clearTimeout(n),s()};this.addTag(t,i)}addTag(t,e){oc()?this.doNodeLongPoll(t,e):setTimeout((()=>{try{if(!this.sendNewPolls)return;const s=this.myIFrame.doc.createElement("script");s.type="text/javascript",s.async=!0,s.src=t,s.onload=s.onreadystatechange=function(){const t=s.readyState;t&&"loaded"!==t&&"complete"!==t||(s.onload=s.onreadystatechange=null,s.parentNode&&s.parentNode.removeChild(s),e())},s.onerror=()=>{Yu("Long-poll script failed to load: "+t),this.sendNewPolls=!1,this.close()},this.myIFrame.doc.body.appendChild(s)}catch(c){}}),Math.floor(1))}}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const sg=16384,ng=45e3;let ig=null;"undefined"!==typeof MozWebSocket?ig=MozWebSocket:"undefined"!==typeof WebSocket&&(ig=WebSocket);class rg{constructor(t,e,s,n,i,r,o){this.connId=t,this.applicationId=s,this.appCheckToken=n,this.authToken=i,this.keepaliveTimer=null,this.frames=null,this.totalFrames=0,this.bytesSent=0,this.bytesReceived=0,this.log_=Xu(this.connId),this.stats_=Rd(e),this.connURL=rg.connectionURL_(e,r,o,n,s),this.nodeAdmin=e.nodeAdmin}static connectionURL_(t,e,s,n,i){const r={};return r[vd]=_d,!oc()&&"undefined"!==typeof location&&location.hostname&&wd.test(location.hostname)&&(r[Cd]=bd),e&&(r[yd]=e),s&&(r[xd]=s),n&&(r[Td]=n),i&&(r[Sd]=i),Dd(t,kd,r)}open(t,e){this.onDisconnect=e,this.onMessage=t,this.log_("Websocket connecting to "+this.connURL),this.everConnected_=!1,Mu.set("previous_websocket_failure",!0);try{let t;if(oc()){const e=this.nodeAdmin?"AdminNode":"Node";t={headers:{"User-Agent":`Firebase/${_d}/${Eu}/${process.platform}/${e}`,"X-Firebase-GMPID":this.applicationId||""}},this.authToken&&(t.headers["Authorization"]=`Bearer ${this.authToken}`),this.appCheckToken&&(t.headers["X-Firebase-AppCheck"]=this.appCheckToken);const s={NODE_ENV:"production",BASE_URL:"/alien_mood/"},n=0===this.connURL.indexOf("wss://")?s["HTTPS_PROXY"]||s["https_proxy"]:s["HTTP_PROXY"]||s["http_proxy"];n&&(t["proxy"]={origin:n})}this.mySock=new ig(this.connURL,[],t)}catch(c){this.log_("Error instantiating WebSocket.");const e=c.message||c.data;return e&&this.log_(e),void this.onClosed_()}this.mySock.onopen=()=>{this.log_("Websocket connected."),this.everConnected_=!0},this.mySock.onclose=()=>{this.log_("Websocket connection was disconnected."),this.mySock=null,this.onClosed_()},this.mySock.onmessage=t=>{this.handleIncomingFrame(t)},this.mySock.onerror=t=>{this.log_("WebSocket error.  Closing connection.");const e=t.message||t.data;e&&this.log_(e),this.onClosed_()}}start(){}static forceDisallow(){rg.forceDisallow_=!0}static isAvailable(){let t=!1;if("undefined"!==typeof navigator&&navigator.userAgent){const e=/Android ([0-9]{0,}\.[0-9]{0,})/,s=navigator.userAgent.match(e);s&&s.length>1&&parseFloat(s[1])<4.4&&(t=!0)}return!t&&null!==ig&&!rg.forceDisallow_}static previouslyFailed(){return Mu.isInMemoryStorage||!0===Mu.get("previous_websocket_failure")}markConnectionHealthy(){Mu.remove("previous_websocket_failure")}appendFrame_(t){if(this.frames.push(t),this.frames.length===this.totalFrames){const t=this.frames.join("");this.frames=null;const e=pc(t);this.onMessage(e)}}handleNewFrameCount_(t){this.totalFrames=t,this.frames=[]}extractFrameCount_(t){if(Eh(null===this.frames,"We already have a frame buffer"),t.length<=6){const e=Number(t);if(!isNaN(e))return this.handleNewFrameCount_(e),null}return this.handleNewFrameCount_(1),t}handleIncomingFrame(t){if(null===this.mySock)return;const e=t["data"];if(this.bytesReceived+=e.length,this.stats_.incrementCounter("bytes_received",e.length),this.resetKeepAlive(),null!==this.frames)this.appendFrame_(e);else{const t=this.extractFrameCount_(e);null!==t&&this.appendFrame_(t)}}send(t){this.resetKeepAlive();const e=fc(t);this.bytesSent+=e.length,this.stats_.incrementCounter("bytes_sent",e.length);const s=sd(e,sg);s.length>1&&this.sendString_(String(s.length));for(let n=0;n<s.length;n++)this.sendString_(s[n])}shutdown_(){this.isClosed_=!0,this.keepaliveTimer&&(clearInterval(this.keepaliveTimer),this.keepaliveTimer=null),this.mySock&&(this.mySock.close(),this.mySock=null)}onClosed_(){this.isClosed_||(this.log_("WebSocket is closing itself"),this.shutdown_(),this.onDisconnect&&(this.onDisconnect(this.everConnected_),this.onDisconnect=null))}close(){this.isClosed_||(this.log_("WebSocket is being closed"),this.shutdown_())}resetKeepAlive(){clearInterval(this.keepaliveTimer),this.keepaliveTimer=setInterval((()=>{this.mySock&&this.sendString_("0"),this.resetKeepAlive()}),Math.floor(ng))}sendString_(t){try{this.mySock.send(t)}catch(c){this.log_("Exception thrown from WebSocket.send():",c.message||c.data,"Closing connection."),setTimeout(this.onClosed_.bind(this),0)}}}rg.responsesRequiredToBeHealthy=2,rg.healthyTimeout=3e4;
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
class og{static get ALL_TRANSPORTS(){return[tg,rg]}static get IS_TRANSPORT_INITIALIZED(){return this.globalTransportInitialized_}constructor(t){this.initTransports_(t)}initTransports_(t){const e=rg&&rg["isAvailable"]();let s=e&&!rg.previouslyFailed();if(t.webSocketOnly&&(e||Hu("wss:// URL used, but browser isn't known to support websockets.  Trying anyway."),s=!0),s)this.transports_=[rg];else{const t=this.transports_=[];for(const e of og.ALL_TRANSPORTS)e&&e["isAvailable"]()&&t.push(e);og.globalTransportInitialized_=!0}}initialTransport(){if(this.transports_.length>0)return this.transports_[0];throw new Error("No transports available")}upgradeTransport(){return this.transports_.length>1?this.transports_[1]:null}}og.globalTransportInitialized_=!1;
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
const ag=6e4,hg=5e3,cg=10240,lg=102400,ug="t",dg="d",gg="s",pg="r",fg="e",mg="o",_g="a",vg="n",yg="p",Cg="h";class bg{constructor(t,e,s,n,i,r,o,a,h,c){this.id=t,this.repoInfo_=e,this.applicationId_=s,this.appCheckToken_=n,this.authToken_=i,this.onMessage_=r,this.onReady_=o,this.onDisconnect_=a,this.onKill_=h,this.lastSessionId=c,this.connectionCount=0,this.pendingDataMessages=[],this.state_=0,this.log_=Xu("c:"+this.id+":"),this.transportManager_=new og(e),this.log_("Connection created"),this.start_()}start_(){const t=this.transportManager_.initialTransport();this.conn_=new t(this.nextTransportId_(),this.repoInfo_,this.applicationId_,this.appCheckToken_,this.authToken_,null,this.lastSessionId),this.primaryResponsesRequired_=t["responsesRequiredToBeHealthy"]||0;const e=this.connReceiver_(this.conn_),s=this.disconnReceiver_(this.conn_);this.tx_=this.conn_,this.rx_=this.conn_,this.secondaryConn_=null,this.isHealthy_=!1,setTimeout((()=>{this.conn_&&this.conn_.open(e,s)}),Math.floor(0));const n=t["healthyTimeout"]||0;n>0&&(this.healthyTimeout_=gd((()=>{this.healthyTimeout_=null,this.isHealthy_||(this.conn_&&this.conn_.bytesReceived>lg?(this.log_("Connection exceeded healthy timeout but has received "+this.conn_.bytesReceived+" bytes.  Marking connection healthy."),this.isHealthy_=!0,this.conn_.markConnectionHealthy()):this.conn_&&this.conn_.bytesSent>cg?this.log_("Connection exceeded healthy timeout but has sent "+this.conn_.bytesSent+" bytes.  Leaving connection alive."):(this.log_("Closing unhealthy connection after timeout."),this.close()))}),Math.floor(n)))}nextTransportId_(){return"c:"+this.id+":"+this.connectionCount++}disconnReceiver_(t){return e=>{t===this.conn_?this.onConnectionLost_(e):t===this.secondaryConn_?(this.log_("Secondary connection lost."),this.onSecondaryConnectionLost_()):this.log_("closing an old connection")}}connReceiver_(t){return e=>{2!==this.state_&&(t===this.rx_?this.onPrimaryMessageReceived_(e):t===this.secondaryConn_?this.onSecondaryMessageReceived_(e):this.log_("message on old connection"))}}sendRequest(t){const e={t:"d",d:t};this.sendData_(e)}tryCleanupConnection(){this.tx_===this.secondaryConn_&&this.rx_===this.secondaryConn_&&(this.log_("cleaning up and promoting a connection: "+this.secondaryConn_.connId),this.conn_=this.secondaryConn_,this.secondaryConn_=null)}onSecondaryControl_(t){if(ug in t){const e=t[ug];e===_g?this.upgradeIfSecondaryHealthy_():e===pg?(this.log_("Got a reset on secondary, closing it"),this.secondaryConn_.close(),this.tx_!==this.secondaryConn_&&this.rx_!==this.secondaryConn_||this.close()):e===mg&&(this.log_("got pong on secondary."),this.secondaryResponsesRequired_--,this.upgradeIfSecondaryHealthy_())}}onSecondaryMessageReceived_(t){const e=td("t",t),s=td("d",t);if("c"===e)this.onSecondaryControl_(s);else{if("d"!==e)throw new Error("Unknown protocol layer: "+e);this.pendingDataMessages.push(s)}}upgradeIfSecondaryHealthy_(){this.secondaryResponsesRequired_<=0?(this.log_("Secondary connection is healthy."),this.isHealthy_=!0,this.secondaryConn_.markConnectionHealthy(),this.proceedWithUpgrade_()):(this.log_("sending ping on secondary."),this.secondaryConn_.send({t:"c",d:{t:yg,d:{}}}))}proceedWithUpgrade_(){this.secondaryConn_.start(),this.log_("sending client ack on secondary"),this.secondaryConn_.send({t:"c",d:{t:_g,d:{}}}),this.log_("Ending transmission on primary"),this.conn_.send({t:"c",d:{t:vg,d:{}}}),this.tx_=this.secondaryConn_,this.tryCleanupConnection()}onPrimaryMessageReceived_(t){const e=td("t",t),s=td("d",t);"c"===e?this.onControl_(s):"d"===e&&this.onDataMessage_(s)}onDataMessage_(t){this.onPrimaryResponse_(),this.onMessage_(t)}onPrimaryResponse_(){this.isHealthy_||(this.primaryResponsesRequired_--,this.primaryResponsesRequired_<=0&&(this.log_("Primary connection is healthy."),this.isHealthy_=!0,this.conn_.markConnectionHealthy()))}onControl_(t){const e=td(ug,t);if(dg in t){const s=t[dg];if(e===Cg){const t=Object.assign({},s);this.repoInfo_.isUsingEmulator&&(t.h=this.repoInfo_.host),this.onHandshake_(t)}else if(e===vg){this.log_("recvd end transmission on primary"),this.rx_=this.secondaryConn_;for(let t=0;t<this.pendingDataMessages.length;++t)this.onDataMessage_(this.pendingDataMessages[t]);this.pendingDataMessages=[],this.tryCleanupConnection()}else e===gg?this.onConnectionShutdown_(s):e===pg?this.onReset_(s):e===fg?Vu("Server Error: "+s):e===mg?(this.log_("got pong on primary."),this.onPrimaryResponse_(),this.sendPingOnPrimaryIfNecessary_()):Vu("Unknown control packet command: "+e)}}onHandshake_(t){const e=t.ts,s=t.v,n=t.h;this.sessionId=t.s,this.repoInfo_.host=n,0===this.state_&&(this.conn_.start(),this.onConnectionEstablished_(this.conn_,e),_d!==s&&Hu("Protocol version mismatch detected"),this.tryStartUpgrade_())}tryStartUpgrade_(){const t=this.transportManager_.upgradeTransport();t&&this.startUpgrade_(t)}startUpgrade_(t){this.secondaryConn_=new t(this.nextTransportId_(),this.repoInfo_,this.applicationId_,this.appCheckToken_,this.authToken_,this.sessionId),this.secondaryResponsesRequired_=t["responsesRequiredToBeHealthy"]||0;const e=this.connReceiver_(this.secondaryConn_),s=this.disconnReceiver_(this.secondaryConn_);this.secondaryConn_.open(e,s),gd((()=>{this.secondaryConn_&&(this.log_("Timed out trying to upgrade."),this.secondaryConn_.close())}),Math.floor(ag))}onReset_(t){this.log_("Reset packet received.  New host: "+t),this.repoInfo_.host=t,1===this.state_?this.close():(this.closeConnections_(),this.start_())}onConnectionEstablished_(t,e){this.log_("Realtime connection established."),this.conn_=t,this.state_=1,this.onReady_&&(this.onReady_(e,this.sessionId),this.onReady_=null),0===this.primaryResponsesRequired_?(this.log_("Primary connection is healthy."),this.isHealthy_=!0):gd((()=>{this.sendPingOnPrimaryIfNecessary_()}),Math.floor(hg))}sendPingOnPrimaryIfNecessary_(){this.isHealthy_||1!==this.state_||(this.log_("sending ping on primary."),this.sendData_({t:"c",d:{t:yg,d:{}}}))}onSecondaryConnectionLost_(){const t=this.secondaryConn_;this.secondaryConn_=null,this.tx_!==t&&this.rx_!==t||this.close()}onConnectionLost_(t){this.conn_=null,t||0!==this.state_?1===this.state_&&this.log_("Realtime connection lost."):(this.log_("Realtime connection failed."),this.repoInfo_.isCacheableHost()&&(Mu.remove("host:"+this.repoInfo_.host),this.repoInfo_.internalHost=this.repoInfo_.host)),this.close()}onConnectionShutdown_(t){this.log_("Connection shutdown command received. Shutting down..."),this.onKill_&&(this.onKill_(t),this.onKill_=null),this.onDisconnect_=null,this.close()}sendData_(t){if(1!==this.state_)throw"Connection is not connected";this.tx_.send(t)}close(){2!==this.state_&&(this.log_("Closing realtime connection."),this.state_=2,this.closeConnections_(),this.onDisconnect_&&(this.onDisconnect_(),this.onDisconnect_=null))}closeConnections_(){this.log_("Shutting down all connections"),this.conn_&&(this.conn_.close(),this.conn_=null),this.secondaryConn_&&(this.secondaryConn_.close(),this.secondaryConn_=null),this.healthyTimeout_&&(clearTimeout(this.healthyTimeout_),this.healthyTimeout_=null)}}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class wg{put(t,e,s,n){}merge(t,e,s,n){}refreshAuthToken(t){}refreshAppCheckToken(t){}onDisconnectPut(t,e,s){}onDisconnectMerge(t,e,s){}onDisconnectCancel(t,e){}reportStats(t){}}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class xg{constructor(t){this.allowedEvents_=t,this.listeners_={},Eh(Array.isArray(t)&&t.length>0,"Requires a non-empty array")}trigger(t,...e){if(Array.isArray(this.listeners_[t])){const s=[...this.listeners_[t]];for(let t=0;t<s.length;t++)s[t].callback.apply(s[t].context,e)}}on(t,e,s){this.validateEventType_(t),this.listeners_[t]=this.listeners_[t]||[],this.listeners_[t].push({callback:e,context:s});const n=this.getInitialEvent(t);n&&e.apply(s,n)}off(t,e,s){this.validateEventType_(t);const n=this.listeners_[t]||[];for(let i=0;i<n.length;i++)if(n[i].callback===e&&(!s||s===n[i].context))return void n.splice(i,1)}validateEventType_(t){Eh(this.allowedEvents_.find((e=>e===t)),"Unknown event: "+t)}}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Sg extends xg{static getInstance(){return new Sg}constructor(){super(["online"]),this.online_=!0,"undefined"===typeof window||"undefined"===typeof window.addEventListener||ic()||(window.addEventListener("online",(()=>{this.online_||(this.online_=!0,this.trigger("online",!0))}),!1),window.addEventListener("offline",(()=>{this.online_&&(this.online_=!1,this.trigger("online",!1))}),!1))}getInitialEvent(t){return Eh("online"===t,"Unknown event type: "+t),[this.online_]}currentlyOnline(){return this.online_}}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Tg=32,kg=768;class Ag{constructor(t,e){if(void 0===e){this.pieces_=t.split("/");let e=0;for(let t=0;t<this.pieces_.length;t++)this.pieces_[t].length>0&&(this.pieces_[e]=this.pieces_[t],e++);this.pieces_.length=e,this.pieceNum_=0}else this.pieces_=t,this.pieceNum_=e}toString(){let t="";for(let e=this.pieceNum_;e<this.pieces_.length;e++)""!==this.pieces_[e]&&(t+="/"+this.pieces_[e]);return t||"/"}}function Eg(){return new Ag("")}function Og(t){return t.pieceNum_>=t.pieces_.length?null:t.pieces_[t.pieceNum_]}function Dg(t){return t.pieces_.length-t.pieceNum_}function Pg(t){let e=t.pieceNum_;return e<t.pieces_.length&&e++,new Ag(t.pieces_,e)}function Ig(t){return t.pieceNum_<t.pieces_.length?t.pieces_[t.pieces_.length-1]:null}function Mg(t){let e="";for(let s=t.pieceNum_;s<t.pieces_.length;s++)""!==t.pieces_[s]&&(e+="/"+encodeURIComponent(String(t.pieces_[s])));return e||"/"}function Rg(t,e=0){return t.pieces_.slice(t.pieceNum_+e)}function Fg(t){if(t.pieceNum_>=t.pieces_.length)return null;const e=[];for(let s=t.pieceNum_;s<t.pieces_.length-1;s++)e.push(t.pieces_[s]);return new Ag(e,0)}function Lg(t,e){const s=[];for(let n=t.pieceNum_;n<t.pieces_.length;n++)s.push(t.pieces_[n]);if(e instanceof Ag)for(let n=e.pieceNum_;n<e.pieces_.length;n++)s.push(e.pieces_[n]);else{const t=e.split("/");for(let e=0;e<t.length;e++)t[e].length>0&&s.push(t[e])}return new Ag(s,0)}function jg(t){return t.pieceNum_>=t.pieces_.length}function Ng(t,e){const s=Og(t),n=Og(e);if(null===s)return e;if(s===n)return Ng(Pg(t),Pg(e));throw new Error("INTERNAL ERROR: innerPath ("+e+") is not within outerPath ("+t+")")}function Bg(t,e){if(Dg(t)!==Dg(e))return!1;for(let s=t.pieceNum_,n=e.pieceNum_;s<=t.pieces_.length;s++,n++)if(t.pieces_[s]!==e.pieces_[n])return!1;return!0}function Wg(t,e){let s=t.pieceNum_,n=e.pieceNum_;if(Dg(t)>Dg(e))return!1;while(s<t.pieces_.length){if(t.pieces_[s]!==e.pieces_[n])return!1;++s,++n}return!0}class Ug{constructor(t,e){this.errorPrefix_=e,this.parts_=Rg(t,0),this.byteLength_=Math.max(1,this.parts_.length);for(let s=0;s<this.parts_.length;s++)this.byteLength_+=Oc(this.parts_[s]);Vg(this)}}function Yg(t,e){t.parts_.length>0&&(t.byteLength_+=1),t.parts_.push(e),t.byteLength_+=Oc(e),Vg(t)}function Xg(t){const e=t.parts_.pop();t.byteLength_-=Oc(e),t.parts_.length>0&&(t.byteLength_-=1)}function Vg(t){if(t.byteLength_>kg)throw new Error(t.errorPrefix_+"has a key path longer than "+kg+" bytes ("+t.byteLength_+").");if(t.parts_.length>Tg)throw new Error(t.errorPrefix_+"path specified exceeds the maximum depth that can be written ("+Tg+") or object contains a cycle "+Gg(t))}function Gg(t){return 0===t.parts_.length?"":"in property '"+t.parts_.join(".")+"'"}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Hg extends xg{static getInstance(){return new Hg}constructor(){let t,e;super(["visible"]),"undefined"!==typeof document&&"undefined"!==typeof document.addEventListener&&("undefined"!==typeof document["hidden"]?(e="visibilitychange",t="hidden"):"undefined"!==typeof document["mozHidden"]?(e="mozvisibilitychange",t="mozHidden"):"undefined"!==typeof document["msHidden"]?(e="msvisibilitychange",t="msHidden"):"undefined"!==typeof document["webkitHidden"]&&(e="webkitvisibilitychange",t="webkitHidden")),this.visible_=!0,e&&document.addEventListener(e,(()=>{const e=!document[t];e!==this.visible_&&(this.visible_=e,this.trigger("visible",e))}),!1)}getInitialEvent(t){return Eh("visible"===t,"Unknown event type: "+t),[this.visible_]}}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const zg=1e3,qg=3e5,Kg=3e4,Qg=1.3,Jg=3e4,Zg="server_kill",$g=3;class tp extends wg{constructor(t,e,s,n,i,r,o,a){if(super(),this.repoInfo_=t,this.applicationId_=e,this.onDataUpdate_=s,this.onConnectStatus_=n,this.onServerInfoUpdate_=i,this.authTokenProvider_=r,this.appCheckTokenProvider_=o,this.authOverride_=a,this.id=tp.nextPersistentConnectionId_++,this.log_=Xu("p:"+this.id+":"),this.interruptReasons_={},this.listens=new Map,this.outstandingPuts_=[],this.outstandingGets_=[],this.outstandingPutCount_=0,this.outstandingGetCount_=0,this.onDisconnectRequestQueue_=[],this.connected_=!1,this.reconnectDelay_=zg,this.maxReconnectDelay_=qg,this.securityDebugCallback_=null,this.lastSessionId=null,this.establishConnectionTimer_=null,this.visible_=!1,this.requestCBHash_={},this.requestNumber_=0,this.realtime_=null,this.authToken_=null,this.appCheckToken_=null,this.forceTokenRefresh_=!1,this.invalidAuthTokenCount_=0,this.invalidAppCheckTokenCount_=0,this.firstConnection_=!0,this.lastConnectionAttemptTime_=null,this.lastConnectionEstablishedTime_=null,a&&!oc())throw new Error("Auth override specified in options, but not supported on non Node.js platforms");Hg.getInstance().on("visible",this.onVisible_,this),-1===t.host.indexOf("fblocal")&&Sg.getInstance().on("online",this.onOnline_,this)}sendRequest(t,e,s){const n=++this.requestNumber_,i={r:n,a:t,b:e};this.log_(fc(i)),Eh(this.connected_,"sendRequest call when we're not connected not allowed."),this.realtime_.sendRequest(i),s&&(this.requestCBHash_[n]=s)}get(t){this.initConnection_();const e=new qh,s={p:t._path.toString(),q:t._queryObject},n={action:"g",request:s,onComplete:t=>{const s=t["d"];"ok"===t["s"]?e.resolve(s):e.reject(s)}};this.outstandingGets_.push(n),this.outstandingGetCount_++;const i=this.outstandingGets_.length-1;return this.connected_&&this.sendGet_(i),e.promise}listen(t,e,s,n){this.initConnection_();const i=t._queryIdentifier,r=t._path.toString();this.log_("Listen called for "+r+" "+i),this.listens.has(r)||this.listens.set(r,new Map),Eh(t._queryParams.isDefault()||!t._queryParams.loadsAllData(),"listen() called for non-default but complete query"),Eh(!this.listens.get(r).has(i),"listen() called twice for same path/queryId.");const o={onComplete:n,hashFn:e,query:t,tag:s};this.listens.get(r).set(i,o),this.connected_&&this.sendListen_(o)}sendGet_(t){const e=this.outstandingGets_[t];this.sendRequest("g",e.request,(s=>{delete this.outstandingGets_[t],this.outstandingGetCount_--,0===this.outstandingGetCount_&&(this.outstandingGets_=[]),e.onComplete&&e.onComplete(s)}))}sendListen_(t){const e=t.query,s=e._path.toString(),n=e._queryIdentifier;this.log_("Listen on "+s+" for "+n);const i={p:s},r="q";t.tag&&(i["q"]=e._queryObject,i["t"]=t.tag),i["h"]=t.hashFn(),this.sendRequest(r,i,(i=>{const r=i["d"],o=i["s"];tp.warnOnListenWarnings_(r,e);const a=this.listens.get(s)&&this.listens.get(s).get(n);a===t&&(this.log_("listen response",i),"ok"!==o&&this.removeListen_(s,n),t.onComplete&&t.onComplete(o,r))}))}static warnOnListenWarnings_(t,e){if(t&&"object"===typeof t&&yc(t,"w")){const s=Cc(t,"w");if(Array.isArray(s)&&~s.indexOf("no_index")){const t='".indexOn": "'+e._queryParams.getIndex().toString()+'"',s=e._path.toString();Hu(`Using an unspecified index. Your data will be downloaded and filtered on the client. Consider adding ${t} at ${s} to your security rules for better performance.`)}}}refreshAuthToken(t){this.authToken_=t,this.log_("Auth token refreshed"),this.authToken_?this.tryAuth():this.connected_&&this.sendRequest("unauth",{},(()=>{})),this.reduceReconnectDelayIfAdminCredential_(t)}reduceReconnectDelayIfAdminCredential_(t){const e=t&&40===t.length;(e||vc(t))&&(this.log_("Admin auth credential detected.  Reducing max reconnect time."),this.maxReconnectDelay_=Kg)}refreshAppCheckToken(t){this.appCheckToken_=t,this.log_("App check token refreshed"),this.appCheckToken_?this.tryAppCheck():this.connected_&&this.sendRequest("unappeck",{},(()=>{}))}tryAuth(){if(this.connected_&&this.authToken_){const t=this.authToken_,e=_c(t)?"auth":"gauth",s={cred:t};null===this.authOverride_?s["noauth"]=!0:"object"===typeof this.authOverride_&&(s["authvar"]=this.authOverride_),this.sendRequest(e,s,(e=>{const s=e["s"],n=e["d"]||"error";this.authToken_===t&&("ok"===s?this.invalidAuthTokenCount_=0:this.onAuthRevoked_(s,n))}))}}tryAppCheck(){this.connected_&&this.appCheckToken_&&this.sendRequest("appcheck",{token:this.appCheckToken_},(t=>{const e=t["s"],s=t["d"]||"error";"ok"===e?this.invalidAppCheckTokenCount_=0:this.onAppCheckRevoked_(e,s)}))}unlisten(t,e){const s=t._path.toString(),n=t._queryIdentifier;this.log_("Unlisten called for "+s+" "+n),Eh(t._queryParams.isDefault()||!t._queryParams.loadsAllData(),"unlisten() called for non-default but complete query");const i=this.removeListen_(s,n);i&&this.connected_&&this.sendUnlisten_(s,n,t._queryObject,e)}sendUnlisten_(t,e,s,n){this.log_("Unlisten on "+t+" for "+e);const i={p:t},r="n";n&&(i["q"]=s,i["t"]=n),this.sendRequest(r,i)}onDisconnectPut(t,e,s){this.initConnection_(),this.connected_?this.sendOnDisconnect_("o",t,e,s):this.onDisconnectRequestQueue_.push({pathString:t,action:"o",data:e,onComplete:s})}onDisconnectMerge(t,e,s){this.initConnection_(),this.connected_?this.sendOnDisconnect_("om",t,e,s):this.onDisconnectRequestQueue_.push({pathString:t,action:"om",data:e,onComplete:s})}onDisconnectCancel(t,e){this.initConnection_(),this.connected_?this.sendOnDisconnect_("oc",t,null,e):this.onDisconnectRequestQueue_.push({pathString:t,action:"oc",data:null,onComplete:e})}sendOnDisconnect_(t,e,s,n){const i={p:e,d:s};this.log_("onDisconnect "+t,i),this.sendRequest(t,i,(t=>{n&&setTimeout((()=>{n(t["s"],t["d"])}),Math.floor(0))}))}put(t,e,s,n){this.putInternal("p",t,e,s,n)}merge(t,e,s,n){this.putInternal("m",t,e,s,n)}putInternal(t,e,s,n,i){this.initConnection_();const r={p:e,d:s};void 0!==i&&(r["h"]=i),this.outstandingPuts_.push({action:t,request:r,onComplete:n}),this.outstandingPutCount_++;const o=this.outstandingPuts_.length-1;this.connected_?this.sendPut_(o):this.log_("Buffering put: "+e)}sendPut_(t){const e=this.outstandingPuts_[t].action,s=this.outstandingPuts_[t].request,n=this.outstandingPuts_[t].onComplete;this.outstandingPuts_[t].queued=this.connected_,this.sendRequest(e,s,(s=>{this.log_(e+" response",s),delete this.outstandingPuts_[t],this.outstandingPutCount_--,0===this.outstandingPutCount_&&(this.outstandingPuts_=[]),n&&n(s["s"],s["d"])}))}reportStats(t){if(this.connected_){const e={c:t};this.log_("reportStats",e),this.sendRequest("s",e,(t=>{const e=t["s"];if("ok"!==e){const e=t["d"];this.log_("reportStats","Error sending stats: "+e)}}))}}onDataMessage_(t){if("r"in t){this.log_("from server: "+fc(t));const e=t["r"],s=this.requestCBHash_[e];s&&(delete this.requestCBHash_[e],s(t["b"]))}else{if("error"in t)throw"A server-side error has occurred: "+t["error"];"a"in t&&this.onDataPush_(t["a"],t["b"])}}onDataPush_(t,e){this.log_("handleServerMessage",t,e),"d"===t?this.onDataUpdate_(e["p"],e["d"],!1,e["t"]):"m"===t?this.onDataUpdate_(e["p"],e["d"],!0,e["t"]):"c"===t?this.onListenRevoked_(e["p"],e["q"]):"ac"===t?this.onAuthRevoked_(e["s"],e["d"]):"apc"===t?this.onAppCheckRevoked_(e["s"],e["d"]):"sd"===t?this.onSecurityDebugPacket_(e):Vu("Unrecognized action received from server: "+fc(t)+"\nAre you using the latest client?")}onReady_(t,e){this.log_("connection ready"),this.connected_=!0,this.lastConnectionEstablishedTime_=(new Date).getTime(),this.handleTimestamp_(t),this.lastSessionId=e,this.firstConnection_&&this.sendConnectStats_(),this.restoreState_(),this.firstConnection_=!1,this.onConnectStatus_(!0)}scheduleConnect_(t){Eh(!this.realtime_,"Scheduling a connect when we're already connected/ing?"),this.establishConnectionTimer_&&clearTimeout(this.establishConnectionTimer_),this.establishConnectionTimer_=setTimeout((()=>{this.establishConnectionTimer_=null,this.establishConnection_()}),Math.floor(t))}initConnection_(){!this.realtime_&&this.firstConnection_&&this.scheduleConnect_(0)}onVisible_(t){t&&!this.visible_&&this.reconnectDelay_===this.maxReconnectDelay_&&(this.log_("Window became visible.  Reducing delay."),this.reconnectDelay_=zg,this.realtime_||this.scheduleConnect_(0)),this.visible_=t}onOnline_(t){t?(this.log_("Browser went online."),this.reconnectDelay_=zg,this.realtime_||this.scheduleConnect_(0)):(this.log_("Browser went offline.  Killing connection."),this.realtime_&&this.realtime_.close())}onRealtimeDisconnect_(){if(this.log_("data client disconnected"),this.connected_=!1,this.realtime_=null,this.cancelSentTransactions_(),this.requestCBHash_={},this.shouldReconnect_()){if(this.visible_){if(this.lastConnectionEstablishedTime_){const t=(new Date).getTime()-this.lastConnectionEstablishedTime_;t>Jg&&(this.reconnectDelay_=zg),this.lastConnectionEstablishedTime_=null}}else this.log_("Window isn't visible.  Delaying reconnect."),this.reconnectDelay_=this.maxReconnectDelay_,this.lastConnectionAttemptTime_=(new Date).getTime();const t=Math.max(0,(new Date).getTime()-this.lastConnectionAttemptTime_);let e=Math.max(0,this.reconnectDelay_-t);e=Math.random()*e,this.log_("Trying to reconnect in "+e+"ms"),this.scheduleConnect_(e),this.reconnectDelay_=Math.min(this.maxReconnectDelay_,this.reconnectDelay_*Qg)}this.onConnectStatus_(!1)}async establishConnection_(){if(this.shouldReconnect_()){this.log_("Making a connection attempt"),this.lastConnectionAttemptTime_=(new Date).getTime(),this.lastConnectionEstablishedTime_=null;const t=this.onDataMessage_.bind(this),e=this.onReady_.bind(this),s=this.onRealtimeDisconnect_.bind(this),n=this.id+":"+tp.nextConnectionId_++,i=this.lastSessionId;let r=!1,o=null;const a=function(){o?o.close():(r=!0,s())},h=function(t){Eh(o,"sendRequest call when we're not connected not allowed."),o.sendRequest(t)};this.realtime_={close:a,sendRequest:h};const c=this.forceTokenRefresh_;this.forceTokenRefresh_=!1;try{const[a,h]=await Promise.all([this.authTokenProvider_.getToken(c),this.appCheckTokenProvider_.getToken(c)]);r?Yu("getToken() completed but was canceled"):(Yu("getToken() completed. Creating connection."),this.authToken_=a&&a.accessToken,this.appCheckToken_=h&&h.token,o=new bg(n,this.repoInfo_,this.applicationId_,this.appCheckToken_,this.authToken_,t,e,s,(t=>{Hu(t+" ("+this.repoInfo_.toString()+")"),this.interrupt(Zg)}),i))}catch(Vu){this.log_("Failed to get token: "+Vu),r||(this.repoInfo_.nodeAdmin&&Hu(Vu),a())}}}interrupt(t){Yu("Interrupting connection for reason: "+t),this.interruptReasons_[t]=!0,this.realtime_?this.realtime_.close():(this.establishConnectionTimer_&&(clearTimeout(this.establishConnectionTimer_),this.establishConnectionTimer_=null),this.connected_&&this.onRealtimeDisconnect_())}resume(t){Yu("Resuming connection for reason: "+t),delete this.interruptReasons_[t],bc(this.interruptReasons_)&&(this.reconnectDelay_=zg,this.realtime_||this.scheduleConnect_(0))}handleTimestamp_(t){const e=t-(new Date).getTime();this.onServerInfoUpdate_({serverTimeOffset:e})}cancelSentTransactions_(){for(let t=0;t<this.outstandingPuts_.length;t++){const e=this.outstandingPuts_[t];e&&"h"in e.request&&e.queued&&(e.onComplete&&e.onComplete("disconnect"),delete this.outstandingPuts_[t],this.outstandingPutCount_--)}0===this.outstandingPutCount_&&(this.outstandingPuts_=[])}onListenRevoked_(t,e){let s;s=e?e.map((t=>ed(t))).join("$"):"default";const n=this.removeListen_(t,s);n&&n.onComplete&&n.onComplete("permission_denied")}removeListen_(t,e){const s=new Ag(t).toString();let n;if(this.listens.has(s)){const t=this.listens.get(s);n=t.get(e),t.delete(e),0===t.size&&this.listens.delete(s)}else n=void 0;return n}onAuthRevoked_(t,e){Yu("Auth token revoked: "+t+"/"+e),this.authToken_=null,this.forceTokenRefresh_=!0,this.realtime_.close(),"invalid_token"!==t&&"permission_denied"!==t||(this.invalidAuthTokenCount_++,this.invalidAuthTokenCount_>=$g&&(this.reconnectDelay_=Kg,this.authTokenProvider_.notifyForInvalidToken()))}onAppCheckRevoked_(t,e){Yu("App check token revoked: "+t+"/"+e),this.appCheckToken_=null,this.forceTokenRefresh_=!0,"invalid_token"!==t&&"permission_denied"!==t||(this.invalidAppCheckTokenCount_++,this.invalidAppCheckTokenCount_>=$g&&this.appCheckTokenProvider_.notifyForInvalidToken())}onSecurityDebugPacket_(t){this.securityDebugCallback_?this.securityDebugCallback_(t):"msg"in t&&console.log("FIREBASE: "+t["msg"].replace("\n","\nFIREBASE: "))}restoreState_(){this.tryAuth(),this.tryAppCheck();for(const t of this.listens.values())for(const e of t.values())this.sendListen_(e);for(let t=0;t<this.outstandingPuts_.length;t++)this.outstandingPuts_[t]&&this.sendPut_(t);while(this.onDisconnectRequestQueue_.length){const t=this.onDisconnectRequestQueue_.shift();this.sendOnDisconnect_(t.action,t.pathString,t.data,t.onComplete)}for(let t=0;t<this.outstandingGets_.length;t++)this.outstandingGets_[t]&&this.sendGet_(t)}sendConnectStats_(){const t={};let e="js";oc()&&(e=this.repoInfo_.nodeAdmin?"admin_node":"node"),t["sdk."+e+"."+Eu.replace(/\./g,"-")]=1,ic()?t["framework.cordova"]=1:rc()&&(t["framework.reactnative"]=1),this.reportStats(t)}shouldReconnect_(){const t=Sg.getInstance().currentlyOnline();return bc(this.interruptReasons_)&&t}}tp.nextPersistentConnectionId_=0,tp.nextConnectionId_=0;
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
class ep{constructor(t,e){this.name=t,this.node=e}static Wrap(t,e){return new ep(t,e)}}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class sp{getCompare(){return this.compare.bind(this)}indexedValueChanged(t,e){const s=new ep(Qu,t),n=new ep(Qu,e);return 0!==this.compare(s,n)}minPost(){return ep.MIN}}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let np;class ip extends sp{static get __EMPTY_NODE(){return np}static set __EMPTY_NODE(t){np=t}compare(t,e){return Zu(t.name,e.name)}isDefinedOn(t){throw Oh("KeyIndex.isDefinedOn not expected to be called.")}indexedValueChanged(t,e){return!1}minPost(){return ep.MIN}maxPost(){return new ep(Ju,np)}makePost(t,e){return Eh("string"===typeof t,"KeyIndex indexValue must always be a string."),new ep(t,np)}toString(){return".key"}}const rp=new ip;
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class op{constructor(t,e,s,n,i=null){this.isReverse_=n,this.resultGenerator_=i,this.nodeStack_=[];let r=1;while(!t.isEmpty())if(r=e?s(t.key,e):1,n&&(r*=-1),r<0)t=this.isReverse_?t.left:t.right;else{if(0===r){this.nodeStack_.push(t);break}this.nodeStack_.push(t),t=this.isReverse_?t.right:t.left}}getNext(){if(0===this.nodeStack_.length)return null;let t,e=this.nodeStack_.pop();if(t=this.resultGenerator_?this.resultGenerator_(e.key,e.value):{key:e.key,value:e.value},this.isReverse_){e=e.left;while(!e.isEmpty())this.nodeStack_.push(e),e=e.right}else{e=e.right;while(!e.isEmpty())this.nodeStack_.push(e),e=e.left}return t}hasNext(){return this.nodeStack_.length>0}peek(){if(0===this.nodeStack_.length)return null;const t=this.nodeStack_[this.nodeStack_.length-1];return this.resultGenerator_?this.resultGenerator_(t.key,t.value):{key:t.key,value:t.value}}}class ap{constructor(t,e,s,n,i){this.key=t,this.value=e,this.color=null!=s?s:ap.RED,this.left=null!=n?n:cp.EMPTY_NODE,this.right=null!=i?i:cp.EMPTY_NODE}copy(t,e,s,n,i){return new ap(null!=t?t:this.key,null!=e?e:this.value,null!=s?s:this.color,null!=n?n:this.left,null!=i?i:this.right)}count(){return this.left.count()+1+this.right.count()}isEmpty(){return!1}inorderTraversal(t){return this.left.inorderTraversal(t)||!!t(this.key,this.value)||this.right.inorderTraversal(t)}reverseTraversal(t){return this.right.reverseTraversal(t)||t(this.key,this.value)||this.left.reverseTraversal(t)}min_(){return this.left.isEmpty()?this:this.left.min_()}minKey(){return this.min_().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(t,e,s){let n=this;const i=s(t,n.key);return n=i<0?n.copy(null,null,null,n.left.insert(t,e,s),null):0===i?n.copy(null,e,null,null,null):n.copy(null,null,null,null,n.right.insert(t,e,s)),n.fixUp_()}removeMin_(){if(this.left.isEmpty())return cp.EMPTY_NODE;let t=this;return t.left.isRed_()||t.left.left.isRed_()||(t=t.moveRedLeft_()),t=t.copy(null,null,null,t.left.removeMin_(),null),t.fixUp_()}remove(t,e){let s,n;if(s=this,e(t,s.key)<0)s.left.isEmpty()||s.left.isRed_()||s.left.left.isRed_()||(s=s.moveRedLeft_()),s=s.copy(null,null,null,s.left.remove(t,e),null);else{if(s.left.isRed_()&&(s=s.rotateRight_()),s.right.isEmpty()||s.right.isRed_()||s.right.left.isRed_()||(s=s.moveRedRight_()),0===e(t,s.key)){if(s.right.isEmpty())return cp.EMPTY_NODE;n=s.right.min_(),s=s.copy(n.key,n.value,null,null,s.right.removeMin_())}s=s.copy(null,null,null,null,s.right.remove(t,e))}return s.fixUp_()}isRed_(){return this.color}fixUp_(){let t=this;return t.right.isRed_()&&!t.left.isRed_()&&(t=t.rotateLeft_()),t.left.isRed_()&&t.left.left.isRed_()&&(t=t.rotateRight_()),t.left.isRed_()&&t.right.isRed_()&&(t=t.colorFlip_()),t}moveRedLeft_(){let t=this.colorFlip_();return t.right.left.isRed_()&&(t=t.copy(null,null,null,null,t.right.rotateRight_()),t=t.rotateLeft_(),t=t.colorFlip_()),t}moveRedRight_(){let t=this.colorFlip_();return t.left.left.isRed_()&&(t=t.rotateRight_(),t=t.colorFlip_()),t}rotateLeft_(){const t=this.copy(null,null,ap.RED,null,this.right.left);return this.right.copy(null,null,this.color,t,null)}rotateRight_(){const t=this.copy(null,null,ap.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,t)}colorFlip_(){const t=this.left.copy(null,null,!this.left.color,null,null),e=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,t,e)}checkMaxDepth_(){const t=this.check_();return Math.pow(2,t)<=this.count()+1}check_(){if(this.isRed_()&&this.left.isRed_())throw new Error("Red node has red child("+this.key+","+this.value+")");if(this.right.isRed_())throw new Error("Right child of ("+this.key+","+this.value+") is red");const t=this.left.check_();if(t!==this.right.check_())throw new Error("Black depths differ");return t+(this.isRed_()?0:1)}}ap.RED=!0,ap.BLACK=!1;class hp{copy(t,e,s,n,i){return this}insert(t,e,s){return new ap(t,e,null)}remove(t,e){return this}count(){return 0}isEmpty(){return!0}inorderTraversal(t){return!1}reverseTraversal(t){return!1}minKey(){return null}maxKey(){return null}check_(){return 0}isRed_(){return!1}}class cp{constructor(t,e=cp.EMPTY_NODE){this.comparator_=t,this.root_=e}insert(t,e){return new cp(this.comparator_,this.root_.insert(t,e,this.comparator_).copy(null,null,ap.BLACK,null,null))}remove(t){return new cp(this.comparator_,this.root_.remove(t,this.comparator_).copy(null,null,ap.BLACK,null,null))}get(t){let e,s=this.root_;while(!s.isEmpty()){if(e=this.comparator_(t,s.key),0===e)return s.value;e<0?s=s.left:e>0&&(s=s.right)}return null}getPredecessorKey(t){let e,s=this.root_,n=null;while(!s.isEmpty()){if(e=this.comparator_(t,s.key),0===e){if(s.left.isEmpty())return n?n.key:null;s=s.left;while(!s.right.isEmpty())s=s.right;return s.key}e<0?s=s.left:e>0&&(n=s,s=s.right)}throw new Error("Attempted to find predecessor key for a nonexistent key.  What gives?")}isEmpty(){return this.root_.isEmpty()}count(){return this.root_.count()}minKey(){return this.root_.minKey()}maxKey(){return this.root_.maxKey()}inorderTraversal(t){return this.root_.inorderTraversal(t)}reverseTraversal(t){return this.root_.reverseTraversal(t)}getIterator(t){return new op(this.root_,null,this.comparator_,!1,t)}getIteratorFrom(t,e){return new op(this.root_,t,this.comparator_,!1,e)}getReverseIteratorFrom(t,e){return new op(this.root_,t,this.comparator_,!0,e)}getReverseIterator(t){return new op(this.root_,null,this.comparator_,!0,t)}}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
function lp(t,e){return Zu(t.name,e.name)}function up(t,e){return Zu(t,e)}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let dp;function gp(t){dp=t}cp.EMPTY_NODE=new hp;const pp=function(t){return"number"===typeof t?"number:"+id(t):"string:"+t},fp=function(t){if(t.isLeafNode()){const e=t.val();Eh("string"===typeof e||"number"===typeof e||"object"===typeof e&&yc(e,".sv"),"Priority must be a string or number.")}else Eh(t===dp||t.isEmpty(),"priority of unexpected type.");Eh(t===dp||t.getPriority().isEmpty(),"Priority nodes can't have a priority of their own.")};
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
let mp,_p,vp;class yp{static set __childrenNodeConstructor(t){mp=t}static get __childrenNodeConstructor(){return mp}constructor(t,e=yp.__childrenNodeConstructor.EMPTY_NODE){this.value_=t,this.priorityNode_=e,this.lazyHash_=null,Eh(void 0!==this.value_&&null!==this.value_,"LeafNode shouldn't be created with null/undefined value."),fp(this.priorityNode_)}isLeafNode(){return!0}getPriority(){return this.priorityNode_}updatePriority(t){return new yp(this.value_,t)}getImmediateChild(t){return".priority"===t?this.priorityNode_:yp.__childrenNodeConstructor.EMPTY_NODE}getChild(t){return jg(t)?this:".priority"===Og(t)?this.priorityNode_:yp.__childrenNodeConstructor.EMPTY_NODE}hasChild(){return!1}getPredecessorChildName(t,e){return null}updateImmediateChild(t,e){return".priority"===t?this.updatePriority(e):e.isEmpty()&&".priority"!==t?this:yp.__childrenNodeConstructor.EMPTY_NODE.updateImmediateChild(t,e).updatePriority(this.priorityNode_)}updateChild(t,e){const s=Og(t);return null===s?e:e.isEmpty()&&".priority"!==s?this:(Eh(".priority"!==s||1===Dg(t),".priority must be the last token in a path"),this.updateImmediateChild(s,yp.__childrenNodeConstructor.EMPTY_NODE.updateChild(Pg(t),e)))}isEmpty(){return!1}numChildren(){return 0}forEachChild(t,e){return!1}val(t){return t&&!this.getPriority().isEmpty()?{".value":this.getValue(),".priority":this.getPriority().val()}:this.getValue()}hash(){if(null===this.lazyHash_){let t="";this.priorityNode_.isEmpty()||(t+="priority:"+pp(this.priorityNode_.val())+":");const e=typeof this.value_;t+=e+":",t+="number"===e?id(this.value_):this.value_,this.lazyHash_=ju(t)}return this.lazyHash_}getValue(){return this.value_}compareTo(t){return t===yp.__childrenNodeConstructor.EMPTY_NODE?1:t instanceof yp.__childrenNodeConstructor?-1:(Eh(t.isLeafNode(),"Unknown node type"),this.compareToLeafNode_(t))}compareToLeafNode_(t){const e=typeof t.value_,s=typeof this.value_,n=yp.VALUE_TYPE_ORDER.indexOf(e),i=yp.VALUE_TYPE_ORDER.indexOf(s);return Eh(n>=0,"Unknown leaf type: "+e),Eh(i>=0,"Unknown leaf type: "+s),n===i?"object"===s?0:this.value_<t.value_?-1:this.value_===t.value_?0:1:i-n}withIndex(){return this}isIndexed(){return!0}equals(t){if(t===this)return!0;if(t.isLeafNode()){const e=t;return this.value_===e.value_&&this.priorityNode_.equals(e.priorityNode_)}return!1}}function Cp(t){_p=t}function bp(t){vp=t}yp.VALUE_TYPE_ORDER=["object","boolean","number","string"];class wp extends sp{compare(t,e){const s=t.node.getPriority(),n=e.node.getPriority(),i=s.compareTo(n);return 0===i?Zu(t.name,e.name):i}isDefinedOn(t){return!t.getPriority().isEmpty()}indexedValueChanged(t,e){return!t.getPriority().equals(e.getPriority())}minPost(){return ep.MIN}maxPost(){return new ep(Ju,new yp("[PRIORITY-POST]",vp))}makePost(t,e){const s=_p(t);return new ep(e,new yp("[PRIORITY-POST]",s))}toString(){return".priority"}}const xp=new wp,Sp=Math.log(2);
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Tp{constructor(t){const e=t=>parseInt(Math.log(t)/Sp,10),s=t=>parseInt(Array(t+1).join("1"),2);this.count=e(t+1),this.current_=this.count-1;const n=s(this.count);this.bits_=t+1&n}nextBitIsOne(){const t=!(this.bits_&1<<this.current_);return this.current_--,t}}const kp=function(t,e,s,n){t.sort(e);const i=function(e,n){const r=n-e;let o,a;if(0===r)return null;if(1===r)return o=t[e],a=s?s(o):o,new ap(a,o.node,ap.BLACK,null,null);{const h=parseInt(r/2,10)+e,c=i(e,h),l=i(h+1,n);return o=t[h],a=s?s(o):o,new ap(a,o.node,ap.BLACK,c,l)}},r=function(e){let n=null,r=null,o=t.length;const a=function(e,n){const r=o-e,a=o;o-=e;const c=i(r+1,a),l=t[r],u=s?s(l):l;h(new ap(u,l.node,n,null,c))},h=function(t){n?(n.left=t,n=t):(r=t,n=t)};for(let t=0;t<e.count;++t){const s=e.nextBitIsOne(),n=Math.pow(2,e.count-(t+1));s?a(n,ap.BLACK):(a(n,ap.BLACK),a(n,ap.RED))}return r},o=new Tp(t.length),a=r(o);return new cp(n||e,a)};
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let Ap;const Ep={};class Op{static get Default(){return Eh(Ep&&xp,"ChildrenNode.ts has not been loaded"),Ap=Ap||new Op({".priority":Ep},{".priority":xp}),Ap}constructor(t,e){this.indexes_=t,this.indexSet_=e}get(t){const e=Cc(this.indexes_,t);if(!e)throw new Error("No index defined for "+t);return e instanceof cp?e:null}hasIndex(t){return yc(this.indexSet_,t.toString())}addIndex(t,e){Eh(t!==rp,"KeyIndex always exists and isn't meant to be added to the IndexMap.");const s=[];let n=!1;const i=e.getIterator(ep.Wrap);let r,o=i.getNext();while(o)n=n||t.isDefinedOn(o.node),s.push(o),o=i.getNext();r=n?kp(s,t.getCompare()):Ep;const a=t.toString(),h=Object.assign({},this.indexSet_);h[a]=t;const c=Object.assign({},this.indexes_);return c[a]=r,new Op(c,h)}addToIndexes(t,e){const s=wc(this.indexes_,((s,n)=>{const i=Cc(this.indexSet_,n);if(Eh(i,"Missing index implementation for "+n),s===Ep){if(i.isDefinedOn(t.node)){const s=[],n=e.getIterator(ep.Wrap);let r=n.getNext();while(r)r.name!==t.name&&s.push(r),r=n.getNext();return s.push(t),kp(s,i.getCompare())}return Ep}{const n=e.get(t.name);let i=s;return n&&(i=i.remove(new ep(t.name,n))),i.insert(t,t.node)}}));return new Op(s,this.indexSet_)}removeFromIndexes(t,e){const s=wc(this.indexes_,(s=>{if(s===Ep)return s;{const n=e.get(t.name);return n?s.remove(new ep(t.name,n)):s}}));return new Op(s,this.indexSet_)}}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let Dp;class Pp{static get EMPTY_NODE(){return Dp||(Dp=new Pp(new cp(up),null,Op.Default))}constructor(t,e,s){this.children_=t,this.priorityNode_=e,this.indexMap_=s,this.lazyHash_=null,this.priorityNode_&&fp(this.priorityNode_),this.children_.isEmpty()&&Eh(!this.priorityNode_||this.priorityNode_.isEmpty(),"An empty node cannot have a priority")}isLeafNode(){return!1}getPriority(){return this.priorityNode_||Dp}updatePriority(t){return this.children_.isEmpty()?this:new Pp(this.children_,t,this.indexMap_)}getImmediateChild(t){if(".priority"===t)return this.getPriority();{const e=this.children_.get(t);return null===e?Dp:e}}getChild(t){const e=Og(t);return null===e?this:this.getImmediateChild(e).getChild(Pg(t))}hasChild(t){return null!==this.children_.get(t)}updateImmediateChild(t,e){if(Eh(e,"We should always be passing snapshot nodes"),".priority"===t)return this.updatePriority(e);{const s=new ep(t,e);let n,i;e.isEmpty()?(n=this.children_.remove(t),i=this.indexMap_.removeFromIndexes(s,this.children_)):(n=this.children_.insert(t,e),i=this.indexMap_.addToIndexes(s,this.children_));const r=n.isEmpty()?Dp:this.priorityNode_;return new Pp(n,r,i)}}updateChild(t,e){const s=Og(t);if(null===s)return e;{Eh(".priority"!==Og(t)||1===Dg(t),".priority must be the last token in a path");const n=this.getImmediateChild(s).updateChild(Pg(t),e);return this.updateImmediateChild(s,n)}}isEmpty(){return this.children_.isEmpty()}numChildren(){return this.children_.count()}val(t){if(this.isEmpty())return null;const e={};let s=0,n=0,i=!0;if(this.forEachChild(xp,((r,o)=>{e[r]=o.val(t),s++,i&&Pp.INTEGER_REGEXP_.test(r)?n=Math.max(n,Number(r)):i=!1})),!t&&i&&n<2*s){const t=[];for(const s in e)t[s]=e[s];return t}return t&&!this.getPriority().isEmpty()&&(e[".priority"]=this.getPriority().val()),e}hash(){if(null===this.lazyHash_){let t="";this.getPriority().isEmpty()||(t+="priority:"+pp(this.getPriority().val())+":"),this.forEachChild(xp,((e,s)=>{const n=s.hash();""!==n&&(t+=":"+e+":"+n)})),this.lazyHash_=""===t?"":ju(t)}return this.lazyHash_}getPredecessorChildName(t,e,s){const n=this.resolveIndex_(s);if(n){const s=n.getPredecessorKey(new ep(t,e));return s?s.name:null}return this.children_.getPredecessorKey(t)}getFirstChildName(t){const e=this.resolveIndex_(t);if(e){const t=e.minKey();return t&&t.name}return this.children_.minKey()}getFirstChild(t){const e=this.getFirstChildName(t);return e?new ep(e,this.children_.get(e)):null}getLastChildName(t){const e=this.resolveIndex_(t);if(e){const t=e.maxKey();return t&&t.name}return this.children_.maxKey()}getLastChild(t){const e=this.getLastChildName(t);return e?new ep(e,this.children_.get(e)):null}forEachChild(t,e){const s=this.resolveIndex_(t);return s?s.inorderTraversal((t=>e(t.name,t.node))):this.children_.inorderTraversal(e)}getIterator(t){return this.getIteratorFrom(t.minPost(),t)}getIteratorFrom(t,e){const s=this.resolveIndex_(e);if(s)return s.getIteratorFrom(t,(t=>t));{const s=this.children_.getIteratorFrom(t.name,ep.Wrap);let n=s.peek();while(null!=n&&e.compare(n,t)<0)s.getNext(),n=s.peek();return s}}getReverseIterator(t){return this.getReverseIteratorFrom(t.maxPost(),t)}getReverseIteratorFrom(t,e){const s=this.resolveIndex_(e);if(s)return s.getReverseIteratorFrom(t,(t=>t));{const s=this.children_.getReverseIteratorFrom(t.name,ep.Wrap);let n=s.peek();while(null!=n&&e.compare(n,t)>0)s.getNext(),n=s.peek();return s}}compareTo(t){return this.isEmpty()?t.isEmpty()?0:-1:t.isLeafNode()||t.isEmpty()?1:t===Mp?-1:0}withIndex(t){if(t===rp||this.indexMap_.hasIndex(t))return this;{const e=this.indexMap_.addIndex(t,this.children_);return new Pp(this.children_,this.priorityNode_,e)}}isIndexed(t){return t===rp||this.indexMap_.hasIndex(t)}equals(t){if(t===this)return!0;if(t.isLeafNode())return!1;{const e=t;if(this.getPriority().equals(e.getPriority())){if(this.children_.count()===e.children_.count()){const t=this.getIterator(xp),s=e.getIterator(xp);let n=t.getNext(),i=s.getNext();while(n&&i){if(n.name!==i.name||!n.node.equals(i.node))return!1;n=t.getNext(),i=s.getNext()}return null===n&&null===i}return!1}return!1}}resolveIndex_(t){return t===rp?null:this.indexMap_.get(t.toString())}}Pp.INTEGER_REGEXP_=/^(0|[1-9]\d*)$/;class Ip extends Pp{constructor(){super(new cp(up),Pp.EMPTY_NODE,Op.Default)}compareTo(t){return t===this?0:1}equals(t){return t===this}getPriority(){return this}getImmediateChild(t){return Pp.EMPTY_NODE}isEmpty(){return!1}}const Mp=new Ip;Object.defineProperties(ep,{MIN:{value:new ep(Qu,Pp.EMPTY_NODE)},MAX:{value:new ep(Ju,Mp)}}),ip.__EMPTY_NODE=Pp.EMPTY_NODE,yp.__childrenNodeConstructor=Pp,gp(Mp),bp(Mp);
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
const Rp=!0;function Fp(t,e=null){if(null===t)return Pp.EMPTY_NODE;if("object"===typeof t&&".priority"in t&&(e=t[".priority"]),Eh(null===e||"string"===typeof e||"number"===typeof e||"object"===typeof e&&".sv"in e,"Invalid priority type found: "+typeof e),"object"===typeof t&&".value"in t&&null!==t[".value"]&&(t=t[".value"]),"object"!==typeof t||".sv"in t){const s=t;return new yp(s,Fp(e))}if(t instanceof Array||!Rp){let s=Pp.EMPTY_NODE;return nd(t,((e,n)=>{if(yc(t,e)&&"."!==e.substring(0,1)){const t=Fp(n);!t.isLeafNode()&&t.isEmpty()||(s=s.updateImmediateChild(e,t))}})),s.updatePriority(Fp(e))}{const s=[];let n=!1;const i=t;if(nd(i,((t,e)=>{if("."!==t.substring(0,1)){const i=Fp(e);i.isEmpty()||(n=n||!i.getPriority().isEmpty(),s.push(new ep(t,i)))}})),0===s.length)return Pp.EMPTY_NODE;const r=kp(s,lp,(t=>t.name),up);if(n){const t=kp(s,xp.getCompare());return new Pp(r,Fp(e),new Op({".priority":t},{".priority":xp}))}return new Pp(r,Fp(e),Op.Default)}}Cp(Fp);
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
class Lp extends sp{constructor(t){super(),this.indexPath_=t,Eh(!jg(t)&&".priority"!==Og(t),"Can't create PathIndex with empty path or .priority key")}extractChild(t){return t.getChild(this.indexPath_)}isDefinedOn(t){return!t.getChild(this.indexPath_).isEmpty()}compare(t,e){const s=this.extractChild(t.node),n=this.extractChild(e.node),i=s.compareTo(n);return 0===i?Zu(t.name,e.name):i}makePost(t,e){const s=Fp(t),n=Pp.EMPTY_NODE.updateChild(this.indexPath_,s);return new ep(e,n)}maxPost(){const t=Pp.EMPTY_NODE.updateChild(this.indexPath_,Mp);return new ep(Ju,t)}toString(){return Rg(this.indexPath_,0).join("/")}}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class jp extends sp{compare(t,e){const s=t.node.compareTo(e.node);return 0===s?Zu(t.name,e.name):s}isDefinedOn(t){return!0}indexedValueChanged(t,e){return!t.equals(e)}minPost(){return ep.MIN}maxPost(){return ep.MAX}makePost(t,e){const s=Fp(t);return new ep(e,s)}toString(){return".value"}}const Np=new jp;
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Bp(t){return{type:"value",snapshotNode:t}}function Wp(t,e){return{type:"child_added",snapshotNode:e,childName:t}}function Up(t,e){return{type:"child_removed",snapshotNode:e,childName:t}}function Yp(t,e,s){return{type:"child_changed",snapshotNode:e,childName:t,oldSnap:s}}function Xp(t,e){return{type:"child_moved",snapshotNode:e,childName:t}}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
class Vp{constructor(){this.limitSet_=!1,this.startSet_=!1,this.startNameSet_=!1,this.startAfterSet_=!1,this.endSet_=!1,this.endNameSet_=!1,this.endBeforeSet_=!1,this.limit_=0,this.viewFrom_="",this.indexStartValue_=null,this.indexStartName_="",this.indexEndValue_=null,this.indexEndName_="",this.index_=xp}hasStart(){return this.startSet_}isViewFromLeft(){return""===this.viewFrom_?this.startSet_:"l"===this.viewFrom_}getIndexStartValue(){return Eh(this.startSet_,"Only valid if start has been set"),this.indexStartValue_}getIndexStartName(){return Eh(this.startSet_,"Only valid if start has been set"),this.startNameSet_?this.indexStartName_:Qu}hasEnd(){return this.endSet_}getIndexEndValue(){return Eh(this.endSet_,"Only valid if end has been set"),this.indexEndValue_}getIndexEndName(){return Eh(this.endSet_,"Only valid if end has been set"),this.endNameSet_?this.indexEndName_:Ju}hasLimit(){return this.limitSet_}hasAnchoredLimit(){return this.limitSet_&&""!==this.viewFrom_}getLimit(){return Eh(this.limitSet_,"Only valid if limit has been set"),this.limit_}getIndex(){return this.index_}loadsAllData(){return!(this.startSet_||this.endSet_||this.limitSet_)}isDefault(){return this.loadsAllData()&&this.index_===xp}copy(){const t=new Vp;return t.limitSet_=this.limitSet_,t.limit_=this.limit_,t.startSet_=this.startSet_,t.startAfterSet_=this.startAfterSet_,t.indexStartValue_=this.indexStartValue_,t.startNameSet_=this.startNameSet_,t.indexStartName_=this.indexStartName_,t.endSet_=this.endSet_,t.endBeforeSet_=this.endBeforeSet_,t.indexEndValue_=this.indexEndValue_,t.endNameSet_=this.endNameSet_,t.indexEndName_=this.indexEndName_,t.index_=this.index_,t.viewFrom_=this.viewFrom_,t}}function Gp(t){const e={};if(t.isDefault())return e;let s;if(t.index_===xp?s="$priority":t.index_===Np?s="$value":t.index_===rp?s="$key":(Eh(t.index_ instanceof Lp,"Unrecognized index type!"),s=t.index_.toString()),e["orderBy"]=fc(s),t.startSet_){const s=t.startAfterSet_?"startAfter":"startAt";e[s]=fc(t.indexStartValue_),t.startNameSet_&&(e[s]+=","+fc(t.indexStartName_))}if(t.endSet_){const s=t.endBeforeSet_?"endBefore":"endAt";e[s]=fc(t.indexEndValue_),t.endNameSet_&&(e[s]+=","+fc(t.indexEndName_))}return t.limitSet_&&(t.isViewFromLeft()?e["limitToFirst"]=t.limit_:e["limitToLast"]=t.limit_),e}function Hp(t){const e={};if(t.startSet_&&(e["sp"]=t.indexStartValue_,t.startNameSet_&&(e["sn"]=t.indexStartName_),e["sin"]=!t.startAfterSet_),t.endSet_&&(e["ep"]=t.indexEndValue_,t.endNameSet_&&(e["en"]=t.indexEndName_),e["ein"]=!t.endBeforeSet_),t.limitSet_){e["l"]=t.limit_;let s=t.viewFrom_;""===s&&(s=t.isViewFromLeft()?"l":"r"),e["vf"]=s}return t.index_!==xp&&(e["i"]=t.index_.toString()),e}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class zp extends wg{reportStats(t){throw new Error("Method not implemented.")}static getListenId_(t,e){return void 0!==e?"tag$"+e:(Eh(t._queryParams.isDefault(),"should have a tag if it's not a default query."),t._path.toString())}constructor(t,e,s,n){super(),this.repoInfo_=t,this.onDataUpdate_=e,this.authTokenProvider_=s,this.appCheckTokenProvider_=n,this.log_=Xu("p:rest:"),this.listens_={}}listen(t,e,s,n){const i=t._path.toString();this.log_("Listen called for "+i+" "+t._queryIdentifier);const r=zp.getListenId_(t,s),o={};this.listens_[r]=o;const a=Gp(t._queryParams);this.restRequest_(i+".json",a,((t,e)=>{let a=e;if(404===t&&(a=null,t=null),null===t&&this.onDataUpdate_(i,a,!1,s),Cc(this.listens_,r)===o){let e;e=t?401===t?"permission_denied":"rest_error:"+t:"ok",n(e,null)}}))}unlisten(t,e){const s=zp.getListenId_(t,e);delete this.listens_[s]}get(t){const e=Gp(t._queryParams),s=t._path.toString(),n=new qh;return this.restRequest_(s+".json",e,((t,e)=>{let i=e;404===t&&(i=null,t=null),null===t?(this.onDataUpdate_(s,i,!1,null),n.resolve(i)):n.reject(new Error(i))})),n.promise}refreshAuthToken(t){}restRequest_(t,e={},s){return e["format"]="export",Promise.all([this.authTokenProvider_.getToken(!1),this.appCheckTokenProvider_.getToken(!1)]).then((([n,i])=>{n&&n.accessToken&&(e["auth"]=n.accessToken),i&&i.token&&(e["ac"]=i.token);const r=(this.repoInfo_.secure?"https://":"http://")+this.repoInfo_.host+t+"?ns="+this.repoInfo_.namespace+Tc(e);this.log_("Sending REST request for "+r);const o=new XMLHttpRequest;o.onreadystatechange=()=>{if(s&&4===o.readyState){this.log_("REST Response for "+r+" received. status:",o.status,"response:",o.responseText);let t=null;if(o.status>=200&&o.status<300){try{t=pc(o.responseText)}catch(c){Hu("Failed to parse JSON response for "+r+": "+o.responseText)}s(null,t)}else 401!==o.status&&404!==o.status&&Hu("Got unsuccessful REST response for "+r+" Status: "+o.status),s(o.status);s=null}},o.open("GET",r,!0),o.send()}))}}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class qp{constructor(){this.rootNode_=Pp.EMPTY_NODE}getNode(t){return this.rootNode_.getChild(t)}updateSnapshot(t,e){this.rootNode_=this.rootNode_.updateChild(t,e)}}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Kp(){return{value:null,children:new Map}}function Qp(t,e,s){if(jg(e))t.value=s,t.children.clear();else if(null!==t.value)t.value=t.value.updateChild(e,s);else{const n=Og(e);t.children.has(n)||t.children.set(n,Kp());const i=t.children.get(n);e=Pg(e),Qp(i,e,s)}}function Jp(t,e,s){null!==t.value?s(e,t.value):Zp(t,((t,n)=>{const i=new Ag(e.toString()+"/"+t);Jp(n,i,s)}))}function Zp(t,e){t.children.forEach(((t,s)=>{e(s,t)}))}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class $p{constructor(t){this.collection_=t,this.last_=null}get(){const t=this.collection_.get(),e=Object.assign({},t);return this.last_&&nd(this.last_,((t,s)=>{e[t]=e[t]-s})),this.last_=t,e}}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const tf=1e4,ef=3e4,sf=3e5;class nf{constructor(t,e){this.server_=e,this.statsToReport_={},this.statsListener_=new $p(t);const s=tf+(ef-tf)*Math.random();gd(this.reportStats_.bind(this),Math.floor(s))}reportStats_(){const t=this.statsListener_.get(),e={};let s=!1;nd(t,((t,n)=>{n>0&&yc(this.statsToReport_,t)&&(e[t]=n,s=!0)})),s&&this.server_.reportStats(e),gd(this.reportStats_.bind(this),Math.floor(2*Math.random()*sf))}}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var rf;function of(){return{fromUser:!0,fromServer:!1,queryId:null,tagged:!1}}function af(){return{fromUser:!1,fromServer:!0,queryId:null,tagged:!1}}function hf(t){return{fromUser:!1,fromServer:!0,queryId:t,tagged:!0}}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */(function(t){t[t["OVERWRITE"]=0]="OVERWRITE",t[t["MERGE"]=1]="MERGE",t[t["ACK_USER_WRITE"]=2]="ACK_USER_WRITE",t[t["LISTEN_COMPLETE"]=3]="LISTEN_COMPLETE"})(rf||(rf={}));class cf{constructor(t,e,s){this.path=t,this.affectedTree=e,this.revert=s,this.type=rf.ACK_USER_WRITE,this.source=of()}operationForChild(t){if(jg(this.path)){if(null!=this.affectedTree.value)return Eh(this.affectedTree.children.isEmpty(),"affectedTree should not have overlapping affected paths."),this;{const e=this.affectedTree.subtree(new Ag(t));return new cf(Eg(),e,this.revert)}}return Eh(Og(this.path)===t,"operationForChild called for unrelated child."),new cf(Pg(this.path),this.affectedTree,this.revert)}}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
class lf{constructor(t,e,s){this.source=t,this.path=e,this.snap=s,this.type=rf.OVERWRITE}operationForChild(t){return jg(this.path)?new lf(this.source,Eg(),this.snap.getImmediateChild(t)):new lf(this.source,Pg(this.path),this.snap)}}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class uf{constructor(t,e,s){this.source=t,this.path=e,this.children=s,this.type=rf.MERGE}operationForChild(t){if(jg(this.path)){const e=this.children.subtree(new Ag(t));return e.isEmpty()?null:e.value?new lf(this.source,Eg(),e.value):new uf(this.source,Eg(),e)}return Eh(Og(this.path)===t,"Can't get a merge for a child not on the path of the operation"),new uf(this.source,Pg(this.path),this.children)}toString(){return"Operation("+this.path+": "+this.source.toString()+" merge: "+this.children.toString()+")"}}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class df{constructor(t,e,s){this.node_=t,this.fullyInitialized_=e,this.filtered_=s}isFullyInitialized(){return this.fullyInitialized_}isFiltered(){return this.filtered_}isCompleteForPath(t){if(jg(t))return this.isFullyInitialized()&&!this.filtered_;const e=Og(t);return this.isCompleteForChild(e)}isCompleteForChild(t){return this.isFullyInitialized()&&!this.filtered_||this.node_.hasChild(t)}getNode(){return this.node_}}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function gf(t,e,s,n){const i=[],r=[];return e.forEach((e=>{"child_changed"===e.type&&t.index_.indexedValueChanged(e.oldSnap,e.snapshotNode)&&r.push(Xp(e.childName,e.snapshotNode))})),pf(t,i,"child_removed",e,n,s),pf(t,i,"child_added",e,n,s),pf(t,i,"child_moved",r,n,s),pf(t,i,"child_changed",e,n,s),pf(t,i,"value",e,n,s),i}function pf(t,e,s,n,i,r){const o=n.filter((t=>t.type===s));o.sort(((e,s)=>mf(t,e,s))),o.forEach((s=>{const n=ff(t,s,r);i.forEach((i=>{i.respondsTo(s.type)&&e.push(i.createEvent(n,t.query_))}))}))}function ff(t,e,s){return"value"===e.type||"child_removed"===e.type||(e.prevName=s.getPredecessorChildName(e.childName,e.snapshotNode,t.index_)),e}function mf(t,e,s){if(null==e.childName||null==s.childName)throw Oh("Should only compare child_ events.");const n=new ep(e.childName,e.snapshotNode),i=new ep(s.childName,s.snapshotNode);return t.index_.compare(n,i)}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function _f(t,e){return{eventCache:t,serverCache:e}}function vf(t,e,s,n){return _f(new df(e,s,n),t.serverCache)}function yf(t,e,s,n){return _f(t.eventCache,new df(e,s,n))}function Cf(t){return t.eventCache.isFullyInitialized()?t.eventCache.getNode():null}function bf(t){return t.serverCache.isFullyInitialized()?t.serverCache.getNode():null}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let wf;const xf=()=>(wf||(wf=new cp($u)),wf);class Sf{static fromObject(t){let e=new Sf(null);return nd(t,((t,s)=>{e=e.set(new Ag(t),s)})),e}constructor(t,e=xf()){this.value=t,this.children=e}isEmpty(){return null===this.value&&this.children.isEmpty()}findRootMostMatchingPathAndValue(t,e){if(null!=this.value&&e(this.value))return{path:Eg(),value:this.value};if(jg(t))return null;{const s=Og(t),n=this.children.get(s);if(null!==n){const i=n.findRootMostMatchingPathAndValue(Pg(t),e);if(null!=i){const t=Lg(new Ag(s),i.path);return{path:t,value:i.value}}return null}return null}}findRootMostValueAndPath(t){return this.findRootMostMatchingPathAndValue(t,(()=>!0))}subtree(t){if(jg(t))return this;{const e=Og(t),s=this.children.get(e);return null!==s?s.subtree(Pg(t)):new Sf(null)}}set(t,e){if(jg(t))return new Sf(e,this.children);{const s=Og(t),n=this.children.get(s)||new Sf(null),i=n.set(Pg(t),e),r=this.children.insert(s,i);return new Sf(this.value,r)}}remove(t){if(jg(t))return this.children.isEmpty()?new Sf(null):new Sf(null,this.children);{const e=Og(t),s=this.children.get(e);if(s){const n=s.remove(Pg(t));let i;return i=n.isEmpty()?this.children.remove(e):this.children.insert(e,n),null===this.value&&i.isEmpty()?new Sf(null):new Sf(this.value,i)}return this}}get(t){if(jg(t))return this.value;{const e=Og(t),s=this.children.get(e);return s?s.get(Pg(t)):null}}setTree(t,e){if(jg(t))return e;{const s=Og(t),n=this.children.get(s)||new Sf(null),i=n.setTree(Pg(t),e);let r;return r=i.isEmpty()?this.children.remove(s):this.children.insert(s,i),new Sf(this.value,r)}}fold(t){return this.fold_(Eg(),t)}fold_(t,e){const s={};return this.children.inorderTraversal(((n,i)=>{s[n]=i.fold_(Lg(t,n),e)})),e(t,this.value,s)}findOnPath(t,e){return this.findOnPath_(t,Eg(),e)}findOnPath_(t,e,s){const n=!!this.value&&s(e,this.value);if(n)return n;if(jg(t))return null;{const n=Og(t),i=this.children.get(n);return i?i.findOnPath_(Pg(t),Lg(e,n),s):null}}foreachOnPath(t,e){return this.foreachOnPath_(t,Eg(),e)}foreachOnPath_(t,e,s){if(jg(t))return this;{this.value&&s(e,this.value);const n=Og(t),i=this.children.get(n);return i?i.foreachOnPath_(Pg(t),Lg(e,n),s):new Sf(null)}}foreach(t){this.foreach_(Eg(),t)}foreach_(t,e){this.children.inorderTraversal(((s,n)=>{n.foreach_(Lg(t,s),e)})),this.value&&e(t,this.value)}foreachChild(t){this.children.inorderTraversal(((e,s)=>{s.value&&t(e,s.value)}))}}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Tf{constructor(t){this.writeTree_=t}static empty(){return new Tf(new Sf(null))}}function kf(t,e,s){if(jg(e))return new Tf(new Sf(s));{const n=t.writeTree_.findRootMostValueAndPath(e);if(null!=n){const i=n.path;let r=n.value;const o=Ng(i,e);return r=r.updateChild(o,s),new Tf(t.writeTree_.set(i,r))}{const n=new Sf(s),i=t.writeTree_.setTree(e,n);return new Tf(i)}}}function Af(t,e,s){let n=t;return nd(s,((t,s)=>{n=kf(n,Lg(e,t),s)})),n}function Ef(t,e){if(jg(e))return Tf.empty();{const s=t.writeTree_.setTree(e,new Sf(null));return new Tf(s)}}function Of(t,e){return null!=Df(t,e)}function Df(t,e){const s=t.writeTree_.findRootMostValueAndPath(e);return null!=s?t.writeTree_.get(s.path).getChild(Ng(s.path,e)):null}function Pf(t){const e=[],s=t.writeTree_.value;return null!=s?s.isLeafNode()||s.forEachChild(xp,((t,s)=>{e.push(new ep(t,s))})):t.writeTree_.children.inorderTraversal(((t,s)=>{null!=s.value&&e.push(new ep(t,s.value))})),e}function If(t,e){if(jg(e))return t;{const s=Df(t,e);return new Tf(null!=s?new Sf(s):t.writeTree_.subtree(e))}}function Mf(t){return t.writeTree_.isEmpty()}function Rf(t,e){return Ff(Eg(),t.writeTree_,e)}function Ff(t,e,s){if(null!=e.value)return s.updateChild(t,e.value);{let n=null;return e.children.inorderTraversal(((e,i)=>{".priority"===e?(Eh(null!==i.value,"Priority writes must always be leaf nodes"),n=i.value):s=Ff(Lg(t,e),i,s)})),s.getChild(t).isEmpty()||null===n||(s=s.updateChild(Lg(t,".priority"),n)),s}}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Lf(t,e){return im(e,t)}function jf(t,e,s,n,i){Eh(n>t.lastWriteId,"Stacking an older write on top of newer ones"),void 0===i&&(i=!0),t.allWrites.push({path:e,snap:s,writeId:n,visible:i}),i&&(t.visibleWrites=kf(t.visibleWrites,e,s)),t.lastWriteId=n}function Nf(t,e){for(let s=0;s<t.allWrites.length;s++){const n=t.allWrites[s];if(n.writeId===e)return n}return null}function Bf(t,e){const s=t.allWrites.findIndex((t=>t.writeId===e));Eh(s>=0,"removeWrite called with nonexistent writeId.");const n=t.allWrites[s];t.allWrites.splice(s,1);let i=n.visible,r=!1,o=t.allWrites.length-1;while(i&&o>=0){const e=t.allWrites[o];e.visible&&(o>=s&&Wf(e,n.path)?i=!1:Wg(n.path,e.path)&&(r=!0)),o--}if(i){if(r)return Uf(t),!0;if(n.snap)t.visibleWrites=Ef(t.visibleWrites,n.path);else{const e=n.children;nd(e,(e=>{t.visibleWrites=Ef(t.visibleWrites,Lg(n.path,e))}))}return!0}return!1}function Wf(t,e){if(t.snap)return Wg(t.path,e);for(const s in t.children)if(t.children.hasOwnProperty(s)&&Wg(Lg(t.path,s),e))return!0;return!1}function Uf(t){t.visibleWrites=Xf(t.allWrites,Yf,Eg()),t.allWrites.length>0?t.lastWriteId=t.allWrites[t.allWrites.length-1].writeId:t.lastWriteId=-1}function Yf(t){return t.visible}function Xf(t,e,s){let n=Tf.empty();for(let i=0;i<t.length;++i){const r=t[i];if(e(r)){const t=r.path;let e;if(r.snap)Wg(s,t)?(e=Ng(s,t),n=kf(n,e,r.snap)):Wg(t,s)&&(e=Ng(t,s),n=kf(n,Eg(),r.snap.getChild(e)));else{if(!r.children)throw Oh("WriteRecord should have .snap or .children");if(Wg(s,t))e=Ng(s,t),n=Af(n,e,r.children);else if(Wg(t,s))if(e=Ng(t,s),jg(e))n=Af(n,Eg(),r.children);else{const t=Cc(r.children,Og(e));if(t){const s=t.getChild(Pg(e));n=kf(n,Eg(),s)}}}}}return n}function Vf(t,e,s,n,i){if(n||i){const r=If(t.visibleWrites,e);if(!i&&Mf(r))return s;if(i||null!=s||Of(r,Eg())){const r=function(t){return(t.visible||i)&&(!n||!~n.indexOf(t.writeId))&&(Wg(t.path,e)||Wg(e,t.path))},o=Xf(t.allWrites,r,e),a=s||Pp.EMPTY_NODE;return Rf(o,a)}return null}{const n=Df(t.visibleWrites,e);if(null!=n)return n;{const n=If(t.visibleWrites,e);if(Mf(n))return s;if(null!=s||Of(n,Eg())){const t=s||Pp.EMPTY_NODE;return Rf(n,t)}return null}}}function Gf(t,e,s){let n=Pp.EMPTY_NODE;const i=Df(t.visibleWrites,e);if(i)return i.isLeafNode()||i.forEachChild(xp,((t,e)=>{n=n.updateImmediateChild(t,e)})),n;if(s){const i=If(t.visibleWrites,e);return s.forEachChild(xp,((t,e)=>{const s=Rf(If(i,new Ag(t)),e);n=n.updateImmediateChild(t,s)})),Pf(i).forEach((t=>{n=n.updateImmediateChild(t.name,t.node)})),n}{const s=If(t.visibleWrites,e);return Pf(s).forEach((t=>{n=n.updateImmediateChild(t.name,t.node)})),n}}function Hf(t,e,s,n,i){Eh(n||i,"Either existingEventSnap or existingServerSnap must exist");const r=Lg(e,s);if(Of(t.visibleWrites,r))return null;{const e=If(t.visibleWrites,r);return Mf(e)?i.getChild(s):Rf(e,i.getChild(s))}}function zf(t,e,s,n){const i=Lg(e,s),r=Df(t.visibleWrites,i);if(null!=r)return r;if(n.isCompleteForChild(s)){const e=If(t.visibleWrites,i);return Rf(e,n.getNode().getImmediateChild(s))}return null}function qf(t,e){return Df(t.visibleWrites,e)}function Kf(t,e,s,n,i,r,o){let a;const h=If(t.visibleWrites,e),c=Df(h,Eg());if(null!=c)a=c;else{if(null==s)return[];a=Rf(h,s)}if(a=a.withIndex(o),a.isEmpty()||a.isLeafNode())return[];{const t=[],e=o.getCompare(),s=r?a.getReverseIteratorFrom(n,o):a.getIteratorFrom(n,o);let h=s.getNext();while(h&&t.length<i)0!==e(h,n)&&t.push(h),h=s.getNext();return t}}function Qf(){return{visibleWrites:Tf.empty(),allWrites:[],lastWriteId:-1}}function Jf(t,e,s,n){return Vf(t.writeTree,t.treePath,e,s,n)}function Zf(t,e){return Gf(t.writeTree,t.treePath,e)}function $f(t,e,s,n){return Hf(t.writeTree,t.treePath,e,s,n)}function tm(t,e){return qf(t.writeTree,Lg(t.treePath,e))}function em(t,e,s,n,i,r){return Kf(t.writeTree,t.treePath,e,s,n,i,r)}function sm(t,e,s){return zf(t.writeTree,t.treePath,e,s)}function nm(t,e){return im(Lg(t.treePath,e),t.writeTree)}function im(t,e){return{treePath:t,writeTree:e}}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class rm{constructor(){this.changeMap=new Map}trackChildChange(t){const e=t.type,s=t.childName;Eh("child_added"===e||"child_changed"===e||"child_removed"===e,"Only child changes supported for tracking"),Eh(".priority"!==s,"Only non-priority child changes can be tracked.");const n=this.changeMap.get(s);if(n){const i=n.type;if("child_added"===e&&"child_removed"===i)this.changeMap.set(s,Yp(s,t.snapshotNode,n.snapshotNode));else if("child_removed"===e&&"child_added"===i)this.changeMap.delete(s);else if("child_removed"===e&&"child_changed"===i)this.changeMap.set(s,Up(s,n.oldSnap));else if("child_changed"===e&&"child_added"===i)this.changeMap.set(s,Wp(s,t.snapshotNode));else{if("child_changed"!==e||"child_changed"!==i)throw Oh("Illegal combination of changes: "+t+" occurred after "+n);this.changeMap.set(s,Yp(s,t.snapshotNode,n.oldSnap))}}else this.changeMap.set(s,t)}getChanges(){return Array.from(this.changeMap.values())}}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class om{getCompleteChild(t){return null}getChildAfterChild(t,e,s){return null}}const am=new om;class hm{constructor(t,e,s=null){this.writes_=t,this.viewCache_=e,this.optCompleteServerCache_=s}getCompleteChild(t){const e=this.viewCache_.eventCache;if(e.isCompleteForChild(t))return e.getNode().getImmediateChild(t);{const e=null!=this.optCompleteServerCache_?new df(this.optCompleteServerCache_,!0,!1):this.viewCache_.serverCache;return sm(this.writes_,t,e)}}getChildAfterChild(t,e,s){const n=null!=this.optCompleteServerCache_?this.optCompleteServerCache_:bf(this.viewCache_),i=em(this.writes_,n,e,1,s,t);return 0===i.length?null:i[0]}}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function cm(t,e){Eh(e.eventCache.getNode().isIndexed(t.filter.getIndex()),"Event snap not indexed"),Eh(e.serverCache.getNode().isIndexed(t.filter.getIndex()),"Server snap not indexed")}function lm(t,e,s,n,i){const r=new rm;let o,a;if(s.type===rf.OVERWRITE){const h=s;h.source.fromUser?o=pm(t,e,h.path,h.snap,n,i,r):(Eh(h.source.fromServer,"Unknown source."),a=h.source.tagged||e.serverCache.isFiltered()&&!jg(h.path),o=gm(t,e,h.path,h.snap,n,i,a,r))}else if(s.type===rf.MERGE){const h=s;h.source.fromUser?o=mm(t,e,h.path,h.children,n,i,r):(Eh(h.source.fromServer,"Unknown source."),a=h.source.tagged||e.serverCache.isFiltered(),o=vm(t,e,h.path,h.children,n,i,a,r))}else if(s.type===rf.ACK_USER_WRITE){const a=s;o=a.revert?bm(t,e,a.path,n,i,r):ym(t,e,a.path,a.affectedTree,n,i,r)}else{if(s.type!==rf.LISTEN_COMPLETE)throw Oh("Unknown operation type: "+s.type);o=Cm(t,e,s.path,n,r)}const h=r.getChanges();return um(e,o,h),{viewCache:o,changes:h}}function um(t,e,s){const n=e.eventCache;if(n.isFullyInitialized()){const i=n.getNode().isLeafNode()||n.getNode().isEmpty(),r=Cf(t);(s.length>0||!t.eventCache.isFullyInitialized()||i&&!n.getNode().equals(r)||!n.getNode().getPriority().equals(r.getPriority()))&&s.push(Bp(Cf(e)))}}function dm(t,e,s,n,i,r){const o=e.eventCache;if(null!=tm(n,s))return e;{let a,h;if(jg(s))if(Eh(e.serverCache.isFullyInitialized(),"If change path is empty, we must have complete server data"),e.serverCache.isFiltered()){const s=bf(e),i=s instanceof Pp?s:Pp.EMPTY_NODE,o=Zf(n,i);a=t.filter.updateFullNode(e.eventCache.getNode(),o,r)}else{const s=Jf(n,bf(e));a=t.filter.updateFullNode(e.eventCache.getNode(),s,r)}else{const c=Og(s);if(".priority"===c){Eh(1===Dg(s),"Can't have a priority with additional path components");const i=o.getNode();h=e.serverCache.getNode();const r=$f(n,s,i,h);a=null!=r?t.filter.updatePriority(i,r):o.getNode()}else{const l=Pg(s);let u;if(o.isCompleteForChild(c)){h=e.serverCache.getNode();const t=$f(n,s,o.getNode(),h);u=null!=t?o.getNode().getImmediateChild(c).updateChild(l,t):o.getNode().getImmediateChild(c)}else u=sm(n,c,e.serverCache);a=null!=u?t.filter.updateChild(o.getNode(),c,u,l,i,r):o.getNode()}}return vf(e,a,o.isFullyInitialized()||jg(s),t.filter.filtersNodes())}}function gm(t,e,s,n,i,r,o,a){const h=e.serverCache;let c;const l=o?t.filter:t.filter.getIndexedFilter();if(jg(s))c=l.updateFullNode(h.getNode(),n,null);else if(l.filtersNodes()&&!h.isFiltered()){const t=h.getNode().updateChild(s,n);c=l.updateFullNode(h.getNode(),t,null)}else{const t=Og(s);if(!h.isCompleteForPath(s)&&Dg(s)>1)return e;const i=Pg(s),r=h.getNode().getImmediateChild(t),o=r.updateChild(i,n);c=".priority"===t?l.updatePriority(h.getNode(),o):l.updateChild(h.getNode(),t,o,i,am,null)}const u=yf(e,c,h.isFullyInitialized()||jg(s),l.filtersNodes()),d=new hm(i,u,r);return dm(t,u,s,i,d,a)}function pm(t,e,s,n,i,r,o){const a=e.eventCache;let h,c;const l=new hm(i,e,r);if(jg(s))c=t.filter.updateFullNode(e.eventCache.getNode(),n,o),h=vf(e,c,!0,t.filter.filtersNodes());else{const i=Og(s);if(".priority"===i)c=t.filter.updatePriority(e.eventCache.getNode(),n),h=vf(e,c,a.isFullyInitialized(),a.isFiltered());else{const r=Pg(s),c=a.getNode().getImmediateChild(i);let u;if(jg(r))u=n;else{const t=l.getCompleteChild(i);u=null!=t?".priority"===Ig(r)&&t.getChild(Fg(r)).isEmpty()?t:t.updateChild(r,n):Pp.EMPTY_NODE}if(c.equals(u))h=e;else{const s=t.filter.updateChild(a.getNode(),i,u,r,l,o);h=vf(e,s,a.isFullyInitialized(),t.filter.filtersNodes())}}}return h}function fm(t,e){return t.eventCache.isCompleteForChild(e)}function mm(t,e,s,n,i,r,o){let a=e;return n.foreach(((n,h)=>{const c=Lg(s,n);fm(e,Og(c))&&(a=pm(t,a,c,h,i,r,o))})),n.foreach(((n,h)=>{const c=Lg(s,n);fm(e,Og(c))||(a=pm(t,a,c,h,i,r,o))})),a}function _m(t,e,s){return s.foreach(((t,s)=>{e=e.updateChild(t,s)})),e}function vm(t,e,s,n,i,r,o,a){if(e.serverCache.getNode().isEmpty()&&!e.serverCache.isFullyInitialized())return e;let h,c=e;h=jg(s)?n:new Sf(null).setTree(s,n);const l=e.serverCache.getNode();return h.children.inorderTraversal(((s,n)=>{if(l.hasChild(s)){const h=e.serverCache.getNode().getImmediateChild(s),l=_m(t,h,n);c=gm(t,c,new Ag(s),l,i,r,o,a)}})),h.children.inorderTraversal(((s,n)=>{const h=!e.serverCache.isCompleteForChild(s)&&null===n.value;if(!l.hasChild(s)&&!h){const h=e.serverCache.getNode().getImmediateChild(s),l=_m(t,h,n);c=gm(t,c,new Ag(s),l,i,r,o,a)}})),c}function ym(t,e,s,n,i,r,o){if(null!=tm(i,s))return e;const a=e.serverCache.isFiltered(),h=e.serverCache;if(null!=n.value){if(jg(s)&&h.isFullyInitialized()||h.isCompleteForPath(s))return gm(t,e,s,h.getNode().getChild(s),i,r,a,o);if(jg(s)){let n=new Sf(null);return h.getNode().forEachChild(rp,((t,e)=>{n=n.set(new Ag(t),e)})),vm(t,e,s,n,i,r,a,o)}return e}{let c=new Sf(null);return n.foreach(((t,e)=>{const n=Lg(s,t);h.isCompleteForPath(n)&&(c=c.set(t,h.getNode().getChild(n)))})),vm(t,e,s,c,i,r,a,o)}}function Cm(t,e,s,n,i){const r=e.serverCache,o=yf(e,r.getNode(),r.isFullyInitialized()||jg(s),r.isFiltered());return dm(t,o,s,n,am,i)}function bm(t,e,s,n,i,r){let o;if(null!=tm(n,s))return e;{const a=new hm(n,e,i),h=e.eventCache.getNode();let c;if(jg(s)||".priority"===Og(s)){let s;if(e.serverCache.isFullyInitialized())s=Jf(n,bf(e));else{const t=e.serverCache.getNode();Eh(t instanceof Pp,"serverChildren would be complete if leaf node"),s=Zf(n,t)}c=t.filter.updateFullNode(h,s,r)}else{const i=Og(s);let l=sm(n,i,e.serverCache);null==l&&e.serverCache.isCompleteForChild(i)&&(l=h.getImmediateChild(i)),c=null!=l?t.filter.updateChild(h,i,l,Pg(s),a,r):e.eventCache.getNode().hasChild(i)?t.filter.updateChild(h,i,Pp.EMPTY_NODE,Pg(s),a,r):h,c.isEmpty()&&e.serverCache.isFullyInitialized()&&(o=Jf(n,bf(e)),o.isLeafNode()&&(c=t.filter.updateFullNode(c,o,r)))}return o=e.serverCache.isFullyInitialized()||null!=tm(n,Eg()),vf(e,c,o,t.filter.filtersNodes())}}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function wm(t,e){const s=bf(t.viewCache_);return s&&(t.query._queryParams.loadsAllData()||!jg(e)&&!s.getImmediateChild(Og(e)).isEmpty())?s.getChild(e):null}function xm(t,e,s,n){e.type===rf.MERGE&&null!==e.source.queryId&&(Eh(bf(t.viewCache_),"We should always have a full cache before handling merges"),Eh(Cf(t.viewCache_),"Missing event cache, even though we have a server cache"));const i=t.viewCache_,r=lm(t.processor_,i,e,s,n);return cm(t.processor_,r.viewCache),Eh(r.viewCache.serverCache.isFullyInitialized()||!i.serverCache.isFullyInitialized(),"Once a server snap is complete, it should never go back"),t.viewCache_=r.viewCache,Sm(t,r.changes,r.viewCache.eventCache.getNode(),null)}function Sm(t,e,s,n){const i=n?[n]:t.eventRegistrations_;return gf(t.eventGenerator_,e,s,i)}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let Tm,km;function Am(t){Eh(!Tm,"__referenceConstructor has already been defined"),Tm=t}function Em(t,e,s,n){const i=e.source.queryId;if(null!==i){const r=t.views.get(i);return Eh(null!=r,"SyncTree gave us an op for an invalid query."),xm(r,e,s,n)}{let i=[];for(const r of t.views.values())i=i.concat(xm(r,e,s,n));return i}}function Om(t,e){let s=null;for(const n of t.views.values())s=s||wm(n,e);return s}function Dm(t){Eh(!km,"__referenceConstructor has already been defined"),km=t}class Pm{constructor(t){this.listenProvider_=t,this.syncPointTree_=new Sf(null),this.pendingWriteTree_=Qf(),this.tagToQueryMap=new Map,this.queryToTagMap=new Map}}function Im(t,e,s,n,i){return jf(t.pendingWriteTree_,e,s,n,i),i?Bm(t,new lf(of(),e,s)):[]}function Mm(t,e,s=!1){const n=Nf(t.pendingWriteTree_,e),i=Bf(t.pendingWriteTree_,e);if(i){let e=new Sf(null);return null!=n.snap?e=e.set(Eg(),!0):nd(n.children,(t=>{e=e.set(new Ag(t),!0)})),Bm(t,new cf(n.path,e,s))}return[]}function Rm(t,e,s){return Bm(t,new lf(af(),e,s))}function Fm(t,e,s){const n=Sf.fromObject(s);return Bm(t,new uf(af(),e,n))}function Lm(t,e,s,n){const i=Ym(t,n);if(null!=i){const n=Xm(i),r=n.path,o=n.queryId,a=Ng(r,e),h=new lf(hf(o),a,s);return Vm(t,r,h)}return[]}function jm(t,e,s,n){const i=Ym(t,n);if(i){const n=Xm(i),r=n.path,o=n.queryId,a=Ng(r,e),h=Sf.fromObject(s),c=new uf(hf(o),a,h);return Vm(t,r,c)}return[]}function Nm(t,e,s){const n=!0,i=t.pendingWriteTree_,r=t.syncPointTree_.findOnPath(e,((t,s)=>{const n=Ng(t,e),i=Om(s,n);if(i)return i}));return Vf(i,e,r,s,n)}function Bm(t,e){return Wm(e,t.syncPointTree_,null,Lf(t.pendingWriteTree_,Eg()))}function Wm(t,e,s,n){if(jg(t.path))return Um(t,e,s,n);{const i=e.get(Eg());null==s&&null!=i&&(s=Om(i,Eg()));let r=[];const o=Og(t.path),a=t.operationForChild(o),h=e.children.get(o);if(h&&a){const t=s?s.getImmediateChild(o):null,e=nm(n,o);r=r.concat(Wm(a,h,t,e))}return i&&(r=r.concat(Em(i,t,n,s))),r}}function Um(t,e,s,n){const i=e.get(Eg());null==s&&null!=i&&(s=Om(i,Eg()));let r=[];return e.children.inorderTraversal(((e,i)=>{const o=s?s.getImmediateChild(e):null,a=nm(n,e),h=t.operationForChild(e);h&&(r=r.concat(Um(h,i,o,a)))})),i&&(r=r.concat(Em(i,t,n,s))),r}function Ym(t,e){return t.tagToQueryMap.get(e)}function Xm(t){const e=t.indexOf("$");return Eh(-1!==e&&e<t.length-1,"Bad queryKey."),{queryId:t.substr(e+1),path:new Ag(t.substr(0,e))}}function Vm(t,e,s){const n=t.syncPointTree_.get(e);Eh(n,"Missing sync point for query tag that we're tracking");const i=Lf(t.pendingWriteTree_,e);return Em(n,s,i,null)}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
class Gm{constructor(t){this.node_=t}getImmediateChild(t){const e=this.node_.getImmediateChild(t);return new Gm(e)}node(){return this.node_}}class Hm{constructor(t,e){this.syncTree_=t,this.path_=e}getImmediateChild(t){const e=Lg(this.path_,t);return new Hm(this.syncTree_,e)}node(){return Nm(this.syncTree_,this.path_)}}const zm=function(t){return t=t||{},t["timestamp"]=t["timestamp"]||(new Date).getTime(),t},qm=function(t,e,s){return t&&"object"===typeof t?(Eh(".sv"in t,"Unexpected leaf node or priority contents"),"string"===typeof t[".sv"]?Km(t[".sv"],e,s):"object"===typeof t[".sv"]?Qm(t[".sv"],e):void Eh(!1,"Unexpected server value: "+JSON.stringify(t,null,2))):t},Km=function(t,e,s){switch(t){case"timestamp":return s["timestamp"];default:Eh(!1,"Unexpected server value: "+t)}},Qm=function(t,e,s){t.hasOwnProperty("increment")||Eh(!1,"Unexpected server value: "+JSON.stringify(t,null,2));const n=t["increment"];"number"!==typeof n&&Eh(!1,"Unexpected increment value: "+n);const i=e.node();if(Eh(null!==i&&"undefined"!==typeof i,"Expected ChildrenNode.EMPTY_NODE for nulls"),!i.isLeafNode())return n;const r=i,o=r.getValue();return"number"!==typeof o?n:o+n},Jm=function(t,e,s,n){return $m(e,new Hm(s,t),n)},Zm=function(t,e,s){return $m(t,new Gm(e),s)};function $m(t,e,s){const n=t.getPriority().val(),i=qm(n,e.getImmediateChild(".priority"),s);let r;if(t.isLeafNode()){const n=t,r=qm(n.getValue(),e,s);return r!==n.getValue()||i!==n.getPriority().val()?new yp(r,Fp(i)):t}{const n=t;return r=n,i!==n.getPriority().val()&&(r=r.updatePriority(new yp(i))),n.forEachChild(xp,((t,n)=>{const i=$m(n,e.getImmediateChild(t),s);i!==n&&(r=r.updateImmediateChild(t,i))})),r}}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class t_{constructor(t="",e=null,s={children:{},childCount:0}){this.name=t,this.parent=e,this.node=s}}function e_(t,e){let s=e instanceof Ag?e:new Ag(e),n=t,i=Og(s);while(null!==i){const t=Cc(n.node.children,i)||{children:{},childCount:0};n=new t_(i,n,t),s=Pg(s),i=Og(s)}return n}function s_(t){return t.node.value}function n_(t,e){t.node.value=e,l_(t)}function i_(t){return t.node.childCount>0}function r_(t){return void 0===s_(t)&&!i_(t)}function o_(t,e){nd(t.node.children,((s,n)=>{e(new t_(s,t,n))}))}function a_(t,e,s,n){s&&!n&&e(t),o_(t,(t=>{a_(t,e,!0,n)})),s&&n&&e(t)}function h_(t,e,s){let n=s?t:t.parent;while(null!==n){if(e(n))return!0;n=n.parent}return!1}function c_(t){return new Ag(null===t.parent?t.name:c_(t.parent)+"/"+t.name)}function l_(t){null!==t.parent&&u_(t.parent,t.name,t)}function u_(t,e,s){const n=r_(s),i=yc(t.node.children,e);n&&i?(delete t.node.children[e],t.node.childCount--,l_(t)):n||i||(t.node.children[e]=s.node,t.node.childCount++,l_(t))}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const d_=/[\[\].#$\/\u0000-\u001F\u007F]/,g_=/[\[\].#$\u0000-\u001F\u007F]/,p_=10485760,f_=function(t){return"string"===typeof t&&0!==t.length&&!d_.test(t)},m_=function(t){return"string"===typeof t&&0!==t.length&&!g_.test(t)},__=function(t){return t&&(t=t.replace(/^\/*\.info(\/|$)/,"/")),m_(t)},v_=function(t,e,s){const n=s instanceof Ag?new Ug(s,t):s;if(void 0===e)throw new Error(t+"contains undefined "+Gg(n));if("function"===typeof e)throw new Error(t+"contains a function "+Gg(n)+" with contents = "+e.toString());if(qu(e))throw new Error(t+"contains "+e.toString()+" "+Gg(n));if("string"===typeof e&&e.length>p_/3&&Oc(e)>p_)throw new Error(t+"contains a string greater than "+p_+" utf8 bytes "+Gg(n)+" ('"+e.substring(0,50)+"...')");if(e&&"object"===typeof e){let s=!1,i=!1;if(nd(e,((e,r)=>{if(".value"===e)s=!0;else if(".priority"!==e&&".sv"!==e&&(i=!0,!f_(e)))throw new Error(t+" contains an invalid key ("+e+") "+Gg(n)+'.  Keys must be non-empty strings and can\'t contain ".", "#", "$", "/", "[", or "]"');Yg(n,e),v_(t,r,n),Xg(n)})),s&&i)throw new Error(t+' contains ".value" child '+Gg(n)+" in addition to actual children.")}},y_=function(t,e){const s=e.path.toString();if("string"!==typeof e.repoInfo.host||0===e.repoInfo.host.length||!f_(e.repoInfo.namespace)&&"localhost"!==e.repoInfo.host.split(":")[0]||0!==s.length&&!__(s))throw new Error(Ac(t,"url")+'must be a valid firebase URL and the path can\'t contain ".", "#", "$", "[", or "]".')};
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
class C_{constructor(){this.eventLists_=[],this.recursionDepth_=0}}function b_(t,e){let s=null;for(let n=0;n<e.length;n++){const i=e[n],r=i.getPath();null===s||Bg(r,s.path)||(t.eventLists_.push(s),s=null),null===s&&(s={events:[],path:r}),s.events.push(i)}s&&t.eventLists_.push(s)}function w_(t,e,s){b_(t,s),x_(t,(t=>Wg(t,e)||Wg(e,t)))}function x_(t,e){t.recursionDepth_++;let s=!0;for(let n=0;n<t.eventLists_.length;n++){const i=t.eventLists_[n];if(i){const r=i.path;e(r)?(S_(t.eventLists_[n]),t.eventLists_[n]=null):s=!1}}s&&(t.eventLists_=[]),t.recursionDepth_--}function S_(t){for(let e=0;e<t.events.length;e++){const s=t.events[e];if(null!==s){t.events[e]=null;const n=s.getEventRunner();Bu&&Yu("event: "+s.toString()),ud(n)}}}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const T_="repo_interrupt",k_=25;class A_{constructor(t,e,s,n){this.repoInfo_=t,this.forceRestClient_=e,this.authTokenProvider_=s,this.appCheckProvider_=n,this.dataUpdateCount=0,this.statsListener_=null,this.eventQueue_=new C_,this.nextWriteId_=1,this.interceptServerDataCallback_=null,this.onDisconnect_=Kp(),this.transactionQueueTree_=new t_,this.persistentConnection_=null,this.key=this.repoInfo_.toURLString()}toString(){return(this.repoInfo_.secure?"https://":"http://")+this.repoInfo_.host}}function E_(t,e,s){if(t.stats_=Rd(t.repoInfo_),t.forceRestClient_||dd())t.server_=new zp(t.repoInfo_,((e,s,n,i)=>{P_(t,e,s,n,i)}),t.authTokenProvider_,t.appCheckProvider_),setTimeout((()=>I_(t,!0)),0);else{if("undefined"!==typeof s&&null!==s){if("object"!==typeof s)throw new Error("Only objects are supported for option databaseAuthVariableOverride");try{fc(s)}catch(c){throw new Error("Invalid authOverride provided: "+c)}}t.persistentConnection_=new tp(t.repoInfo_,e,((e,s,n,i)=>{P_(t,e,s,n,i)}),(e=>{I_(t,e)}),(e=>{M_(t,e)}),t.authTokenProvider_,t.appCheckProvider_,s),t.server_=t.persistentConnection_}t.authTokenProvider_.addTokenChangeListener((e=>{t.server_.refreshAuthToken(e)})),t.appCheckProvider_.addTokenChangeListener((e=>{t.server_.refreshAppCheckToken(e.token)})),t.statsReporter_=Fd(t.repoInfo_,(()=>new nf(t.stats_,t.server_))),t.infoData_=new qp,t.infoSyncTree_=new Pm({startListening:(e,s,n,i)=>{let r=[];const o=t.infoData_.getNode(e._path);return o.isEmpty()||(r=Rm(t.infoSyncTree_,e._path,o),setTimeout((()=>{i("ok")}),0)),r},stopListening:()=>{}}),R_(t,"connected",!1),t.serverSyncTree_=new Pm({startListening:(e,s,n,i)=>(t.server_.listen(e,n,s,((s,n)=>{const r=i(s,n);w_(t.eventQueue_,e._path,r)})),[]),stopListening:(e,s)=>{t.server_.unlisten(e,s)}})}function O_(t){const e=t.infoData_.getNode(new Ag(".info/serverTimeOffset")),s=e.val()||0;return(new Date).getTime()+s}function D_(t){return zm({timestamp:O_(t)})}function P_(t,e,s,n,i){t.dataUpdateCount++;const r=new Ag(e);s=t.interceptServerDataCallback_?t.interceptServerDataCallback_(e,s):s;let o=[];if(i)if(n){const e=wc(s,(t=>Fp(t)));o=jm(t.serverSyncTree_,r,e,i)}else{const e=Fp(s);o=Lm(t.serverSyncTree_,r,e,i)}else if(n){const e=wc(s,(t=>Fp(t)));o=Fm(t.serverSyncTree_,r,e)}else{const e=Fp(s);o=Rm(t.serverSyncTree_,r,e)}let a=r;o.length>0&&(a=Y_(t,r)),w_(t.eventQueue_,a,o)}function I_(t,e){R_(t,"connected",e),!1===e&&L_(t)}function M_(t,e){nd(e,((e,s)=>{R_(t,e,s)}))}function R_(t,e,s){const n=new Ag("/.info/"+e),i=Fp(s);t.infoData_.updateSnapshot(n,i);const r=Rm(t.infoSyncTree_,n,i);w_(t.eventQueue_,n,r)}function F_(t){return t.nextWriteId_++}function L_(t){N_(t,"onDisconnectEvents");const e=D_(t),s=Kp();Jp(t.onDisconnect_,Eg(),((n,i)=>{const r=Jm(n,i,t.serverSyncTree_,e);Qp(s,n,r)}));let n=[];Jp(s,Eg(),((e,s)=>{n=n.concat(Rm(t.serverSyncTree_,e,s));const i=q_(t,e);Y_(t,i)})),t.onDisconnect_=Kp(),w_(t.eventQueue_,Eg(),n)}function j_(t){t.persistentConnection_&&t.persistentConnection_.interrupt(T_)}function N_(t,...e){let s="";t.persistentConnection_&&(s=t.persistentConnection_.id+":"),Yu(s,...e)}function B_(t,e,s){return Nm(t.serverSyncTree_,e,s)||Pp.EMPTY_NODE}function W_(t,e=t.transactionQueueTree_){if(e||z_(t,e),s_(e)){const s=G_(t,e);Eh(s.length>0,"Sending zero length transaction queue");const n=s.every((t=>0===t.status));n&&U_(t,c_(e),s)}else i_(e)&&o_(e,(e=>{W_(t,e)}))}function U_(t,e,s){const n=s.map((t=>t.currentWriteId)),i=B_(t,e,n);let r=i;const o=i.hash();for(let c=0;c<s.length;c++){const t=s[c];Eh(0===t.status,"tryToSendTransactionQueue_: items in queue should all be run."),t.status=1,t.retryCount++;const n=Ng(e,t.path);r=r.updateChild(n,t.currentOutputSnapshotRaw)}const a=r.val(!0),h=e;t.server_.put(h.toString(),a,(n=>{N_(t,"transaction put response",{path:h.toString(),status:n});let i=[];if("ok"===n){const n=[];for(let e=0;e<s.length;e++)s[e].status=2,i=i.concat(Mm(t.serverSyncTree_,s[e].currentWriteId)),s[e].onComplete&&n.push((()=>s[e].onComplete(null,!0,s[e].currentOutputSnapshotResolved))),s[e].unwatcher();z_(t,e_(t.transactionQueueTree_,e)),W_(t,t.transactionQueueTree_),w_(t.eventQueue_,e,i);for(let t=0;t<n.length;t++)ud(n[t])}else{if("datastale"===n)for(let t=0;t<s.length;t++)3===s[t].status?s[t].status=4:s[t].status=0;else{Hu("transaction at "+h.toString()+" failed: "+n);for(let t=0;t<s.length;t++)s[t].status=4,s[t].abortReason=n}Y_(t,e)}}),o)}function Y_(t,e){const s=V_(t,e),n=c_(s),i=G_(t,s);return X_(t,i,n),n}function X_(t,e,s){if(0===e.length)return;const n=[];let i=[];const r=e.filter((t=>0===t.status)),o=r.map((t=>t.currentWriteId));for(let a=0;a<e.length;a++){const r=e[a],h=Ng(s,r.path);let c,l=!1;if(Eh(null!==h,"rerunTransactionsUnderNode_: relativePath should not be null."),4===r.status)l=!0,c=r.abortReason,i=i.concat(Mm(t.serverSyncTree_,r.currentWriteId,!0));else if(0===r.status)if(r.retryCount>=k_)l=!0,c="maxretry",i=i.concat(Mm(t.serverSyncTree_,r.currentWriteId,!0));else{const s=B_(t,r.path,o);r.currentInputSnapshot=s;const n=e[a].update(s.val());if(void 0!==n){v_("transaction failed: Data returned ",n,r.path);let e=Fp(n);const a="object"===typeof n&&null!=n&&yc(n,".priority");a||(e=e.updatePriority(s.getPriority()));const h=r.currentWriteId,c=D_(t),l=Zm(e,s,c);r.currentOutputSnapshotRaw=e,r.currentOutputSnapshotResolved=l,r.currentWriteId=F_(t),o.splice(o.indexOf(h),1),i=i.concat(Im(t.serverSyncTree_,r.path,l,r.currentWriteId,r.applyLocally)),i=i.concat(Mm(t.serverSyncTree_,h,!0))}else l=!0,c="nodata",i=i.concat(Mm(t.serverSyncTree_,r.currentWriteId,!0))}w_(t.eventQueue_,s,i),i=[],l&&(e[a].status=2,function(t){setTimeout(t,Math.floor(0))}(e[a].unwatcher),e[a].onComplete&&("nodata"===c?n.push((()=>e[a].onComplete(null,!1,e[a].currentInputSnapshot))):n.push((()=>e[a].onComplete(new Error(c),!1,null)))))}z_(t,t.transactionQueueTree_);for(let a=0;a<n.length;a++)ud(n[a]);W_(t,t.transactionQueueTree_)}function V_(t,e){let s,n=t.transactionQueueTree_;s=Og(e);while(null!==s&&void 0===s_(n))n=e_(n,s),e=Pg(e),s=Og(e);return n}function G_(t,e){const s=[];return H_(t,e,s),s.sort(((t,e)=>t.order-e.order)),s}function H_(t,e,s){const n=s_(e);if(n)for(let i=0;i<n.length;i++)s.push(n[i]);o_(e,(e=>{H_(t,e,s)}))}function z_(t,e){const s=s_(e);if(s){let t=0;for(let e=0;e<s.length;e++)2!==s[e].status&&(s[t]=s[e],t++);s.length=t,n_(e,s.length>0?s:void 0)}o_(e,(e=>{z_(t,e)}))}function q_(t,e){const s=c_(V_(t,e)),n=e_(t.transactionQueueTree_,e);return h_(n,(e=>{K_(t,e)})),K_(t,n),a_(n,(e=>{K_(t,e)})),s}function K_(t,e){const s=s_(e);if(s){const n=[];let i=[],r=-1;for(let e=0;e<s.length;e++)3===s[e].status||(1===s[e].status?(Eh(r===e-1,"All SENT items should be at beginning of queue."),r=e,s[e].status=3,s[e].abortReason="set"):(Eh(0===s[e].status,"Unexpected transaction status in abort"),s[e].unwatcher(),i=i.concat(Mm(t.serverSyncTree_,s[e].currentWriteId,!0)),s[e].onComplete&&n.push(s[e].onComplete.bind(null,new Error("set"),!1,null))));-1===r?n_(e,void 0):s.length=r+1,w_(t.eventQueue_,c_(e),i);for(let t=0;t<n.length;t++)ud(n[t])}}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Q_(t){let e="";const s=t.split("/");for(let n=0;n<s.length;n++)if(s[n].length>0){let t=s[n];try{t=decodeURIComponent(t.replace(/\+/g," "))}catch(c){}e+="/"+t}return e}function J_(t){const e={};"?"===t.charAt(0)&&(t=t.substring(1));for(const s of t.split("&")){if(0===s.length)continue;const n=s.split("=");2===n.length?e[decodeURIComponent(n[0])]=decodeURIComponent(n[1]):Hu(`Invalid query segment '${s}' in query '${t}'`)}return e}const Z_=function(t,e){const s=$_(t),n=s.namespace;"firebase.com"===s.domain&&Gu(s.host+" is no longer supported. Please use <YOUR FIREBASE>.firebaseio.com instead"),n&&"undefined"!==n||"localhost"===s.domain||Gu("Cannot parse Firebase url. Please use https://<YOUR FIREBASE>.firebaseio.com"),s.secure||zu();const i="ws"===s.scheme||"wss"===s.scheme;return{repoInfo:new Ed(s.host,s.secure,n,i,e,"",n!==s.subdomain),path:new Ag(s.pathString)}},$_=function(t){let e="",s="",n="",i="",r="",o=!0,a="https",h=443;if("string"===typeof t){let c=t.indexOf("//");c>=0&&(a=t.substring(0,c-1),t=t.substring(c+2));let l=t.indexOf("/");-1===l&&(l=t.length);let u=t.indexOf("?");-1===u&&(u=t.length),e=t.substring(0,Math.min(l,u)),l<u&&(i=Q_(t.substring(l,u)));const d=J_(t.substring(Math.min(t.length,u)));c=e.indexOf(":"),c>=0?(o="https"===a||"wss"===a,h=parseInt(e.substring(c+1),10)):c=e.length;const g=e.slice(0,c);if("localhost"===g.toLowerCase())s="localhost";else if(g.split(".").length<=2)s=g;else{const t=e.indexOf(".");n=e.substring(0,t).toLowerCase(),s=e.substring(t+1),r=n}"ns"in d&&(r=d["ns"])}return{host:e,port:h,domain:s,subdomain:n,secure:o,scheme:a,pathString:i,namespace:r}},tv="-0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ_abcdefghijklmnopqrstuvwxyz";(function(){let t=0;const e=[]})();
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
class ev{constructor(t,e,s,n){this._repo=t,this._path=e,this._queryParams=s,this._orderByCalled=n}get key(){return jg(this._path)?null:Ig(this._path)}get ref(){return new sv(this._repo,this._path)}get _queryIdentifier(){const t=Hp(this._queryParams),e=ed(t);return"{}"===e?"default":e}get _queryObject(){return Hp(this._queryParams)}isEqual(t){if(t=Dc(t),!(t instanceof ev))return!1;const e=this._repo===t._repo,s=Bg(this._path,t._path),n=this._queryIdentifier===t._queryIdentifier;return e&&s&&n}toJSON(){return this.toString()}toString(){return this._repo.toString()+Mg(this._path)}}class sv extends ev{constructor(t,e){super(t,e,new Vp,!1)}get parent(){const t=Fg(this._path);return null===t?null:new sv(this._repo,t)}get root(){let t=this;while(null!==t.parent)t=t.parent;return t}}Am(sv),Dm(sv);
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
const nv="FIREBASE_DATABASE_EMULATOR_HOST",iv={};let rv=!1;function ov(t,e,s,n){const i=e.lastIndexOf(":"),r=e.substring(0,i),o=Kh(r);t.repoInfo_=new Ed(e,o,t.repoInfo_.namespace,t.repoInfo_.webSocketOnly,t.repoInfo_.nodeAdmin,t.repoInfo_.persistenceKey,t.repoInfo_.includeNamespaceInQueryParams,!0,s),n&&(t.authTokenProvider_=n)}function av(t,e,s,n,i){let r=n||t.options.databaseURL;void 0===r&&(t.options.projectId||Gu("Can't determine Firebase Database URL. Be sure to include  a Project ID when calling firebase.initializeApp()."),Yu("Using default host for project ",t.options.projectId),r=`${t.options.projectId}-default-rtdb.firebaseio.com`);let o,a,h=Z_(r,i),c=h.repoInfo;"undefined"!==typeof process&&(a={NODE_ENV:"production",BASE_URL:"/alien_mood/"}[nv]),a?(o=!0,r=`http://${a}?ns=${c.namespace}`,h=Z_(r,i),c=h.repoInfo):o=!h.repoInfo.secure;const l=i&&o?new md(md.OWNER):new fd(t.name,t.options,e);y_("Invalid Firebase Database URL",h),jg(h.path)||Gu("Database URL must point to the root of a Firebase Database (not including a child path).");const u=cv(c,t,l,new pd(t,s));return new lv(u,t)}function hv(t,e){const s=iv[e];s&&s[t.key]===t||Gu(`Database ${e}(${t.repoInfo_}) has already been deleted.`),j_(t),delete s[t.key]}function cv(t,e,s,n){let i=iv[e.name];i||(i={},iv[e.name]=i);let r=i[t.toURLString()];return r&&Gu("Database initialized multiple times. Please make sure the format of the database URL matches with each database() call."),r=new A_(t,rv,s,n),i[t.toURLString()]=r,r}class lv{constructor(t,e){this._repoInternal=t,this.app=e,this["type"]="database",this._instanceStarted=!1}get _repo(){return this._instanceStarted||(E_(this._repoInternal,this.app.options.appId,this.app.options["databaseAuthVariableOverride"]),this._instanceStarted=!0),this._repoInternal}get _root(){return this._rootInternal||(this._rootInternal=new sv(this._repo,Eg())),this._rootInternal}_delete(){return null!==this._rootInternal&&(hv(this._repo,this.app.name),this._repoInternal=null,this._rootInternal=null),Promise.resolve()}_checkNotDeleted(t){null===this._rootInternal&&Gu("Cannot call "+t+" on a deleted database.")}}function uv(t=ru(),e){const s=Zl(t,"database").getImmediate({identifier:e});if(!s._instanceStarted){const t=Hh("database");t&&dv(s,...t)}return s}function dv(t,e,s,n={}){t=Dc(t),t._checkNotDeleted("useEmulator");const i=`${e}:${s}`,r=t._repoInternal;if(t._instanceStarted){if(i===t._repoInternal.repoInfo_.host&&xc(n,r.repoInfo_.emulatorOptions))return;Gu("connectDatabaseEmulator() cannot initialize or alter the emulator configuration after the database instance has started.")}let o;if(r.repoInfo_.nodeAdmin)n.mockUserToken&&Gu('mockUserToken is not supported by the Admin SDK. For client access with mock users, please use the "firebase" package instead of "firebase-admin".'),o=new md(md.OWNER);else if(n.mockUserToken){const e="string"===typeof n.mockUserToken?n.mockUserToken:Jh(n.mockUserToken,t.app.options.projectId);o=new md(e)}Kh(e)&&(Qh(e),sc("Database",!0)),ov(r,i,n,o)}
/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
function gv(t){Ou(nu),Jl(new Pc("database",((t,{instanceIdentifier:e})=>{const s=t.getProvider("app").getImmediate(),n=t.getProvider("auth-internal"),i=t.getProvider("app-check-internal");return av(s,n,i,e)}),"PUBLIC").setMultipleInstances(!0)),ou(ku,Au,t),ou(ku,Au,"esm2017")}
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */tp.prototype.simpleListen=function(t,e){this.sendRequest("q",{p:t},e)},tp.prototype.echo=function(t,e){this.sendRequest("echo",{d:t},e)};gv();const pv={apiKey:"AIzaSyDdvQbWbBmkDWSJeivHI01mJTVSnnYctTs",authDomain:"alien-mood.firebaseapp.com",databaseURL:"https://alien-mood-default-rtdb.firebaseio.com",projectId:"alien-mood",storageBucket:"alien-mood.firebasestorage.app",messagingSenderId:"450783398597",appId:"1:450783398597:web:70b656cd69807231633eac",measurementId:"G-F6ZE81HPV7"},fv=iu(pv);uv(fv);var mv=s(1241);var _v=JSON.parse('[{"src":"backround/다가오는솔라스 (1).jpg","label":"배경1"},{"src":"backround/다가오는솔라스 (2).jpg","label":"배경2"},{"src":"backround/다가오는솔라스 (3).jpg","label":"배경3"},{"src":"backround/다가오는솔라스 (4).jpg","label":"배경4"}]'),vv=JSON.parse('[{"src":"sticker/Ae.png","label":"에펙"},{"src":"sticker/Ai.png","label":"일러"},{"src":"sticker/html.png","label":"html"}]'),yv=JSON.parse('{"clothesList":[{"name":"드레스","icon":"clothes/dress.svg","svgUrl":{"인간":"clothes/dress.svg","인간팔":"clothes/dress팔.svg"},"position":{"인간":{"left":0,"top":0},"인간팔":{"left":0,"top":0}},"colorButtons":[{"label":"핑크/파랑","mainColor":"#ff69b4","targets":[{"type":"id","value":"dress_body1","color":"#ff69b4"},{"type":"id","value":"dress_body2","color":"#ff69b4"},{"type":"id","value":"belt","color":"#00bfff"}]},{"label":"핑크/노랑","mainColor":"#ffe066","targets":[{"type":"id","value":"dress_body1","color":"#ff69b4"},{"type":"id","value":"dress_body2","color":"#ff69b4"},{"type":"id","value":"belt","color":"#ffe066"}]},{"label":"노랑/파랑","mainColor":"#00cc44","targets":[{"type":"id","value":"dress_body1","color":"#00cc44"},{"type":"id","value":"dress_body2","color":"#00cc44"},{"type":"id","value":"belt","color":"#00bfff"}]}]},{"name":"셔츠","icon":"clothes/shirt.svg","svgUrl":{"인간":"clothes/shirt.svg","인간팔":"clothes/shirt팔.svg"},"position":{"인간":{"left":0,"top":0},"인간팔":{"left":0,"top":0}},"colorButtons":[{"label":"검정/흰색","mainColor":"#3E3E3EFF","targets":[{"type":"id","value":"main","color":"#3E3E3EFF"},{"type":"id","value":"collar","color":"#DDDDDDFF"}]},{"label":"주황/초록","mainColor":"#FF6969FF","targets":[{"type":"id","value":"main","color":"#FF6969FF"},{"type":"id","value":"collar","color":"#66FF87FF"}]},{"label":"보라/노랑","mainColor":"#C2CC00FF","targets":[{"type":"id","value":"main","color":"#C2CC00FF"},{"type":"id","value":"collar","color":"#5900FFFF"}]}]}]}');const Cv=s(8660),bv=(Cv.keys().map(((t,e)=>({src:Cv(t),label:`emoji${e+1}`}))),s(5350));function wv(t){try{return bv("./"+t)}catch{return""}}(_v.default||_v).map((t=>({...t,src:wv(t.src)}))),(vv.default||vv).map((t=>({...t,src:wv(t.src)})));const xv=yv.default||yv,Sv=xv.clothesList||[];Sv.map((t=>({...t,icon:wv(t.icon),svgUrl:Object.fromEntries(Object.entries(t.svgUrl).map((([t,e])=>[t,wv(e)])))})));var Tv=s(5130),kv=s(7222);const Av={ref:"canvas",style:{border:"1px solid #ccc"}},Ev={key:0},Ov={key:0,class:"h-full px-[30px]"},Dv={class:"flex flex-wrap gap-[15px] h-full pb-[56px] custom-scrollbar-hide",style:{"box-sizing":"border-box"}},Pv=["onClick"],Iv=["src","alt"],Mv={key:1},Rv={class:"avatar-panel"},Fv={class:"flex gap-[34px] h-[32px] leading-[18px] text-[18px] border-b-[1px] border-black-b200"},Lv=["onClick"],jv={class:"avatar-tab-content"},Nv={key:0},Bv={style:{display:"flex",gap:"8px"}},Wv=["onClick"],Uv={key:1},Yv={key:2},Xv={key:3},Vv={key:4},Gv={key:5},Hv={style:{display:"flex",gap:"8px"}},zv=["onClick"],qv=["src","alt"],Kv={key:0,style:{margin:"12px 0"}},Qv=["onClick"],Jv={key:2},Zv={class:"imgBox w-full h-[32px] text-center border-b text-black-b70 border-black-b600"},$v={class:"flex gap-[15px] mt-2"},ty=["src"],ey=["onClick"],sy={key:0,class:"w-[90px] h-[90px] bg-black-b600 rounded-[2px] cursor-pointer p-0 flex items-center justify-center"},ny={key:3},iy={key:4},ry={key:5},oy=["onClick"],ay=["src","alt"],hy={class:"panel-nav z-100 text-[20px] fixed left-1/2 bottom-0 flex justify-around items-center h-[48px] bg-black-b900/90 w-full max-w-[430px] -translate-x-1/2"},cy=["onClick"];function ly(t,e,s,i,r,a){return(0,n.uX)(),(0,n.CE)("div",{class:"mobile-wrapper relative bg-white max-w-[430px] mx-auto min-h-screen select-none",onTouchstart:e[6]||(e[6]=(...t)=>a.onTouchStart&&a.onTouchStart(...t)),onTouchmove:e[7]||(e[7]=(...t)=>a.onTouchMove&&a.onTouchMove(...t)),onTouchend:e[8]||(e[8]=(...t)=>a.onTouchEnd&&a.onTouchEnd(...t))},[(0,n.Lk)("canvas",Av,null,512),s.hideUi?(0,n.Q3)("",!0):((0,n.uX)(),(0,n.CE)("div",Ev,[r.panelOpen?((0,n.uX)(),(0,n.CE)("div",{key:0,class:"fixed left-0 right-0 top-0 bottom-[282px] z-10",style:{background:"transparent"},onClick:e[0]||(e[0]=(0,Tv.D$)((t=>r.panelOpen=!1),["stop"]))})):(0,n.Q3)("",!0),(0,n.Lk)("div",{class:"edit-panel z-0 fixed pt-[28px] left-1/2 bottom-0 rounded-t-[28px] w-full max-w-[430px] -translate-x-1/2 bg-black-b700 flex flex-col transition-all duration-300",style:(0,o.Tr)({height:r.panelOpen?"282px":"0px",transform:r.panelOpen?"translate(-50%, 0)":"translate(-50%, 100%)",overflow:r.panelOpen?"visible":"hidden",pointerEvents:r.panelOpen?"auto":"none"}),onClick:e[4]||(e[4]=(0,Tv.D$)((()=>{}),["stop"])),onTouchmove:e[5]||(e[5]=(0,Tv.D$)((()=>{}),["prevent"]))},[(0,n.Lk)("div",{class:"panel-handle absolute left-1/2 top-[12px] w-[30px] h-[4px] rounded-full cursor-pointer bg-black-b200 -translate-x-1/2 select-none",onClick:e[1]||(e[1]=(...t)=>a.togglePanel&&a.togglePanel(...t))}),(0,n.Lk)("div",{class:"panel-content w-full h-full px-[30px] pb-[12px] flex-1 min-h-0 overflow-y-auto",style:(0,o.Tr)({overflowY:r.panelOpen?"auto":"hidden"})},[0===r.activePanelTab?((0,n.uX)(),(0,n.CE)("div",Ov,[(0,n.Lk)("div",Dv,[((0,n.uX)(!0),(0,n.CE)(n.FK,null,(0,n.pI)(r.backroundList,((t,e)=>((0,n.uX)(),(0,n.CE)("div",{key:"replace-img-"+e,class:"flex-shrink-0 bg-red-50",style:{width:"calc((100% - 30px) / 3)"}},[(0,n.Lk)("button",{onClick:e=>a.replaceDefaultImage(t.src),class:"w-full h-full aspect-square overflow-hidden",style:{padding:"0"}},[(0,n.Lk)("img",{src:t.src,alt:"배경 "+(e+1),class:"w-full h-full object-cover",draggable:"false"},null,8,Iv)],8,Pv)])))),128))])])):1===r.activePanelTab?((0,n.uX)(),(0,n.CE)("div",Mv,[(0,n.Lk)("div",Rv,[(0,n.Lk)("div",Fv,[((0,n.uX)(!0),(0,n.CE)(n.FK,null,(0,n.pI)(r.avatarTabs,((t,e)=>((0,n.uX)(),(0,n.CE)("button",{key:t,class:(0,o.C4)(["flex-1 py-2",r.activeAvatarTab===e?"text-blue-500 border-b-2 border-blue-500":"text-gray-500"]),onClick:t=>r.activeAvatarTab=e},(0,o.v_)(t),11,Lv)))),128))]),(0,n.Lk)("div",jv,[0===r.activeAvatarTab?((0,n.uX)(),(0,n.CE)("div",Nv,[e[9]||(e[9]=(0,n.Lk)("p",null,"자세(포즈) 선택 영역",-1)),(0,n.Lk)("div",Bv,[((0,n.uX)(),(0,n.CE)(n.FK,null,(0,n.pI)(["인간","인간팔"],(t=>(0,n.Lk)("button",{key:t,style:(0,o.Tr)({background:r.currentPose===t?"#00bfff":"#eee",color:r.currentPose===t?"#fff":"#333",border:"1px solid #ccc",borderRadius:"6px",padding:"6px 16px",cursor:"pointer"}),onClick:e=>a.changePose(t)},(0,o.v_)(t),13,Wv))),64))])])):1===r.activeAvatarTab?((0,n.uX)(),(0,n.CE)("div",Uv,e[10]||(e[10]=[(0,n.Lk)("p",null,"얼굴형 선택 영역",-1)]))):2===r.activeAvatarTab?((0,n.uX)(),(0,n.CE)("div",Yv,e[11]||(e[11]=[(0,n.Lk)("p",null,"머리 선택 영역",-1)]))):3===r.activeAvatarTab?((0,n.uX)(),(0,n.CE)("div",Xv,e[12]||(e[12]=[(0,n.Lk)("p",null,"눈 선택 영역",-1)]))):4===r.activeAvatarTab?((0,n.uX)(),(0,n.CE)("div",Vv,e[13]||(e[13]=[(0,n.Lk)("p",null,"입 선택 영역",-1)]))):5===r.activeAvatarTab?((0,n.uX)(),(0,n.CE)("div",Gv,[(0,n.Lk)("div",Hv,[((0,n.uX)(!0),(0,n.CE)(n.FK,null,(0,n.pI)(r.clothesList,(t=>((0,n.uX)(),(0,n.CE)("button",{key:t.name,onClick:e=>a.selectClothes(t),style:{background:"none",border:"none",cursor:"pointer"}},[(0,n.Lk)("img",{src:t.icon,alt:t.name,width:"48",height:"48"},null,8,qv),(0,n.Lk)("div",null,(0,o.v_)(t.name),1)],8,zv)))),128))]),r.selectedClothes?((0,n.uX)(),(0,n.CE)("div",Kv,[((0,n.uX)(!0),(0,n.CE)(n.FK,null,(0,n.pI)(r.selectedClothes.colorButtons,((t,e)=>((0,n.uX)(),(0,n.CE)("button",{key:t.label+e,onClick:s=>a.changeClothesColors(t.targets,r.selectedClothes.name,e),style:{display:"flex","align-items":"center",gap:"8px"}},[t.mainColor?((0,n.uX)(),(0,n.CE)("span",{key:0,style:(0,o.Tr)({display:"inline-block",width:"18px",height:"18px",borderRadius:"50%",background:t.mainColor,border:"1px solid #aaa"})},null,4)):(0,n.Q3)("",!0),(0,n.eW)(" "+(0,o.v_)(t.label),1)],8,Qv)))),128))])):(0,n.Q3)("",!0)])):(0,n.Q3)("",!0)])])])):2===r.activePanelTab?((0,n.uX)(),(0,n.CE)("div",Jv,[(0,n.Lk)("div",Zv,[(0,n.Lk)("span",null,(0,o.v_)(r.imageCount)+"/3",1)]),(0,n.Lk)("div",$v,[((0,n.uX)(!0),(0,n.CE)(n.FK,null,(0,n.pI)(r.uploadedImages,((t,e)=>((0,n.uX)(),(0,n.CE)("div",{key:t.fabricObj.id||t.url,class:"w-[90px] h-[90px] bg-black-b600 rounded-[2px] flex items-center justify-center relative",style:{position:"relative"}},[(0,n.Lk)("img",{src:t.url,alt:"첨부 이미지",class:"object-cover w-full h-full rounded-[2px]"},null,8,ty),(0,n.Lk)("button",{onClick:t=>a.removePreviewImage(e),style:{position:"absolute",top:"4px",right:"4px",background:"rgba(0, 0, 0, 0.5)","border-radius":"50%",width:"24px",height:"24px",color:"#fff",border:"none","font-size":"18px",cursor:"pointer"},title:"삭제"}," × ",8,ey)])))),128)),r.uploadedImages.length<3?((0,n.uX)(),(0,n.CE)("label",sy,[e[14]||(e[14]=(0,n.Lk)("img",{src:kv,alt:"이미지 추가",width:"40",height:"40"},null,-1)),(0,n.Lk)("input",{type:"file",accept:"image/*",onChange:e[2]||(e[2]=(...t)=>a.onFileChange&&a.onFileChange(...t)),style:{display:"none"}},null,32)])):(0,n.Q3)("",!0)])])):3===r.activePanelTab?((0,n.uX)(),(0,n.CE)("div",ny,[(0,n.Lk)("button",{onClick:e[3]||(e[3]=(...t)=>a.addTextbox&&a.addTextbox(...t)),class:"w-[300px] h-[42px] bg-black-b600 rounded-[2px] cursor-pointer p-0 flex items-center justify-center",style:{margin:"0 auto"}},e[15]||(e[15]=[(0,n.Lk)("span",{style:{display:"flex","flex-direction":"column","align-items":"center",color:"#fff","font-size":"18px","font-weight":"bold",gap:"8px"}},[(0,n.Lk)("img",{src:kv,alt:"이미지 추가",width:"40",height:"40"})],-1)]))])):4===r.activePanelTab?((0,n.uX)(),(0,n.CE)("div",iy)):5===r.activePanelTab?((0,n.uX)(),(0,n.CE)("div",ry,[((0,n.uX)(!0),(0,n.CE)(n.FK,null,(0,n.pI)(r.StickerList,(t=>((0,n.uX)(),(0,n.CE)("button",{key:t.src,onClick:e=>a.addSticker(t.src),style:{background:"none",border:"none",cursor:"pointer"}},[(0,n.Lk)("img",{src:t.src,alt:t.label,width:"32",height:"32"},null,8,ay)],8,oy)))),128))])):(0,n.Q3)("",!0)],4)],36),(0,n.Lk)("div",hy,[((0,n.uX)(),(0,n.CE)(n.FK,null,(0,n.pI)(["배경","아바타","사진","텍스트","질문","스티커"],((t,e)=>(0,n.Lk)("button",{key:t,class:(0,o.C4)(["flex-1 h-full",r.activePanelTab===e?"text-green-300 ":"text-black-b100"]),onClick:t=>a.openPanel(e)},(0,o.v_)(t),11,cy))),64))])]))],32)}const uy=s(8660),dy=(uy.keys().map(((t,e)=>({src:uy(t),label:`emoji${e+1}`}))),s(5350));function gy(t){try{return dy("./"+t)}catch{return""}}const py=(_v.default||_v).map((t=>({...t,src:gy(t.src)}))),fy=(vv.default||vv).map((t=>({...t,src:gy(t.src)}))),my=yv.default||yv,_y=my.clothesList||[],vy=_y.map((t=>({...t,icon:gy(t.icon),svgUrl:Object.fromEntries(Object.entries(t.svgUrl).map((([t,e])=>[t,gy(e)])))})));var yy={props:{hideUi:{type:Boolean,default:!1}},data(){return{canvas:null,isRestoring:!1,backroundList:py,defaultImageObject:null,currentPose:"인간",StickerList:fy,clothesList:vy,selectedClothes:null,selectedColorIndexes:{},avatarTabs:["자세","얼굴형","머리","눈","입","장식"],activeAvatarTab:0,imageCount:0,uploadedImages:[],panelOpen:!0,touchStartY:0,touchMoveY:0,activePanelTab:2}},components:{},methods:{openPanel(t){this.activePanelTab=t,this.panelOpen=!0},togglePanel(){this.panelOpen=!this.panelOpen},onTouchStart(t){this.touchStartY=t.touches[0].clientY,this.touchMoveY=t.touches[0].clientY,this.touchStartTime=Date.now()},onTouchMove(t){this.touchMoveY=t.touches[0].clientY},onTouchEnd(){const t=this.touchStartY-this.touchMoveY,e=Date.now()-this.touchStartTime;this.panelOpen&&t<-30&&Math.abs(t)>30&&e<500?this.panelOpen=!1:!this.panelOpen&&t>80&&e<500&&(this.panelOpen=!0)},async addHumanControlLayer(){if(this.humanControlLayer&&(this.canvas.remove(this.humanControlLayer),this.humanControlLayer=null),!this.humanSvgGroup)return;const t=this.humanSvgGroup.getBoundingRect(),e=new Bi({left:this.humanSvgGroup.left,top:this.humanSvgGroup.top,width:t.width,height:t.height,originX:this.humanSvgGroup.originX,originY:this.humanSvgGroup.originY,fill:"rgba(0,0,0,0)",selectable:!0,evented:!0,hasControls:!1,hasBorders:!1,padding:12});this.addCharacterControls(e),this.canvas.add(e),this.humanControlLayer=e,e.on("moving",(()=>{if(this.humanSvgGroup.set({left:e.left,top:e.top}),this.clothesSvgGroup){const t=this.selectedClothes?.position?.[this.currentPose]||{left:0,top:0};this.clothesSvgGroup.set({left:e.left+t.left*e.scaleX,top:e.top+t.top*e.scaleY})}this.canvas.renderAll()})),e.on("scaling",(()=>{if(this.humanSvgGroup.set({scaleX:e.scaleX,scaleY:e.scaleY,left:e.left,top:e.top}),this.clothesSvgGroup){const t=this.selectedClothes?.position?.[this.currentPose]||{left:0,top:0};this.clothesSvgGroup.set({scaleX:e.scaleX,scaleY:e.scaleY,left:e.left+t.left*e.scaleX,top:e.top+t.top*e.scaleY})}this.canvas.renderAll()})),e.on("rotating",(()=>{this.humanSvgGroup.set({angle:e.angle}),this.clothesSvgGroup&&this.clothesSvgGroup.set({angle:e.angle}),this.canvas.renderAll()})),this.canvas.renderAll()},async addHumanSvg(){let t=100,e=this.canvas.height/2,s=1,n=1,i=0;this.humanSvgGroup&&(t=this.humanSvgGroup.left,e=this.humanSvgGroup.top,s=this.humanSvgGroup.scaleX,n=this.humanSvgGroup.scaleY,i=this.humanSvgGroup.angle,this.canvas.remove(this.humanSvgGroup),this.humanSvgGroup=null);const r="인간팔"===this.currentPose?Th:Sh,o=await ba(r);let a=Rr.groupSVGElements(o.objects);a.set({left:t,top:e,originX:"center",originY:"center",scaleX:s,scaleY:n,angle:i,selectable:!0,evented:!0,hasControls:!1,hasBorders:!1,lockMovementX:!1,lockMovementY:!1,lockScalingX:!1,lockScalingY:!1,lockRotation:!1}),this.addCharacterControls(a),this.canvas.add(a),this.humanSvgGroup=a,this.addHumanMoveListener(),await this.addHumanControlLayer(),this.canvas.renderAll()},async selectClothes(t){this.clothesSvgGroup&&this.canvas.remove(this.clothesSvgGroup);const e="object"===typeof t.svgUrl?t.svgUrl[this.currentPose]||t.svgUrl["인간"]:t.svgUrl,s=await ba(e);let n=Rr.groupSVGElements(s.objects);const i=this.humanSvgGroup,r=t.position?.[this.currentPose]||{left:0,top:0};n.set({left:i.left,top:i.top,originX:i.originX,originY:i.originY,scaleX:i.scaleX,scaleY:i.scaleY,angle:i.angle,selectable:!1,evented:!1,hasControls:!1,hasBorders:!1,lockMovementX:!0,lockMovementY:!0,lockScalingX:!0,lockScalingY:!0,lockRotation:!0}),n.forEachObject((t=>{t.left+=r.left,t.top+=r.top})),n.setCoords(),this.canvas.add(n),this.clothesSvgGroup=n,this.selectedClothes=t,this.canvas.renderAll();const o=this.selectedColorIndexes[t.name]??0,a=t.colorButtons[o];a&&this.changeClothesColors(a.targets,t.name,o),await this.addHumanControlLayer()},addHumanMoveListener(){this.humanSvgGroup&&(this.humanSvgGroup.set({selectable:!0,evented:!0}),this.humanSvgGroup.on("moving",(()=>{if(this.clothesSvgGroup&&this.selectedClothes){const t=this.selectedClothes.position?.[this.currentPose]||{left:0,top:0};this.clothesSvgGroup.set({left:this.humanSvgGroup.left+t.left*this.humanSvgGroup.scaleX,top:this.humanSvgGroup.top+t.top*this.humanSvgGroup.scaleY}),this.canvas.renderAll()}})),this.humanSvgGroup.on("scaling",(()=>{if(this.clothesSvgGroup&&this.selectedClothes){this.clothesSvgGroup.set({scaleX:this.humanSvgGroup.scaleX,scaleY:this.humanSvgGroup.scaleY});const t=this.selectedClothes.position?.[this.currentPose]||{left:0,top:0};this.clothesSvgGroup.set({left:this.humanSvgGroup.left+t.left*this.humanSvgGroup.scaleX,top:this.humanSvgGroup.top+t.top*this.humanSvgGroup.scaleY}),this.canvas.renderAll()}})))},async changePose(t){this.currentPose=t,this.humanSvgGroup&&this.canvas.remove(this.humanSvgGroup),this.clothesSvgGroup&&this.canvas.remove(this.clothesSvgGroup),await this.addHumanSvg(),this.addCharacterControls(this.humanSvgGroup),this.selectedClothes&&await this.selectClothes(this.selectedClothes),await this.addHumanControlLayer()},changeClothesColors(t,e,s){function n(e){e._objects?e._objects.forEach((t=>n(t))):t.forEach((({type:t,value:s,color:n})=>{("id"===t&&(e.id===s||e.get&&e.get("id")===s)||"class"===t&&(e.className===s||e.get&&e.get("class")===s))&&e.set("fill",n)}))}this.clothesSvgGroup&&(n(this.clothesSvgGroup),this.canvas.requestRenderAll(),this.selectedColorIndexes={...this.selectedColorIndexes,[e]:s})},saveCanvasAsImage(){let t=prompt("저장할 파일 이름을 입력하세요.","오늘기분외계인");if(null===t)return;t&&""!==t.trim()||(t="오늘기분외계인"),t.endsWith(".jpg")||t.endsWith(".png")||(t+=".jpg");const e=this.canvas.toDataURL({format:"jpg",quality:1,multiplier:4}),s=document.createElement("a");s.href=e,s.download=t,document.body.appendChild(s),s.click(),document.body.removeChild(s)},changeSvgColorsByIds(t){this.svgGroup&&(this.svgGroup.forEachObject((e=>{t.forEach((({id:t,color:s})=>{e.id!==t&&e.get("id")!==t||e.set("fill",s)}))})),this.canvas.requestRenderAll())},renderDeleteIcon(t,e,s,n,i){const r=36,o=12,a=r+2*o,h=new window.Image;h.src=bh,t.save(),t.translate(e,s),t.rotate(Rr.degreesToRadians(i.angle)),t.globalAlpha=1,t.drawImage(h,-r/2,-r/2,r,r),t.globalAlpha=.01,t.beginPath(),t.arc(0,0,a/2,0,2*Math.PI),t.fillStyle="#000",t.fill(),t.globalAlpha=1,t.restore()},renderRotateIcon(t,e,s,n,i){const r=36,o=12,a=r+2*o,h=new Image;h.src=wh,t.save(),t.translate(e,s),t.rotate(Rr.degreesToRadians(i.angle)),t.globalAlpha=1,t.drawImage(h,-r/2,-r/2,r,r),t.globalAlpha=.01,t.beginPath(),t.arc(0,0,a/2,0,2*Math.PI),t.fillStyle="#000",t.fill(),t.globalAlpha=1,t.restore()},renderResizeIcon(t,e,s,n,i){const r=36,o=12,a=r+2*o,h=new Image;h.src=xh,t.save(),t.translate(e,s),t.rotate(Rr.degreesToRadians(i.angle)),t.globalAlpha=1,t.drawImage(h,-r/2,-r/2,r,r),t.globalAlpha=.01,t.beginPath(),t.arc(0,0,a/2,0,2*Math.PI),t.fillStyle="#000",t.fill(),t.globalAlpha=1,t.restore()},deleteObject(t,e){const s=e.target.canvas;if("i-text"===e.target.type&&e.target._bgRect&&s.contains(e.target._bgRect)&&s.remove(e.target._bgRect),e.target===this.humanControlLayer||e.target===this.humanSvgGroup)return this.humanSvgGroup&&s.contains(this.humanSvgGroup)&&(s.remove(this.humanSvgGroup),this.humanSvgGroup=null),this.clothesSvgGroup&&s.contains(this.clothesSvgGroup)&&(s.remove(this.clothesSvgGroup),this.clothesSvgGroup=null,this.selectedClothes=null),this.humanControlLayer&&s.contains(this.humanControlLayer)&&(s.remove(this.humanControlLayer),this.humanControlLayer=null),void s.requestRenderAll();s.remove(e.target),s.requestRenderAll()},addCharacterControls(t){window.devicePixelRatio;t.setControlsVisibility({tl:!1,tr:!1,bl:!1,br:!1,mt:!1,mb:!1,ml:!1,mr:!1,mtr:!0,deleteControl:!0,rotateControl:!0,resizeControl:!0}),t.controls.deleteControl=new gn({x:.5,y:-.5,cursorStyle:"pointer",mouseUpHandler:this.deleteObject,render:this.renderDeleteIcon,cornerSize:24,hitbox:{width:60,height:60}}),t.controls.rotateControl=new gn({x:0,y:-.5,offsetY:-40,cursorStyle:"crosshair",render:this.renderRotateIcon,cornerSize:24,actionHandler:Ma.rotationWithSnapping,hitbox:{width:60,height:60}}),t.controls.resizeControl=new gn({x:.5,y:.5,cursorStyle:"se-resize",render:this.renderResizeIcon,cornerSize:24,actionHandler:Ma.scalingEqually,hitbox:{width:60,height:60}}),t.set({cornerColor:"#00000000",cornerSize:24,cornerStyle:"circle",borderColor:"#ffffff",borderDashArray:[6,4],transparentCorners:!1,hasBorders:!1,hasControls:!1}),t.on("selected",(()=>{t.set({hasBorders:!0,hasControls:!0}),t.setControlsVisibility({tl:!1,tr:!1,bl:!1,br:!1,mt:!1,mb:!1,ml:!1,mr:!1,mtr:!0,deleteControl:!0,rotateControl:!0,resizeControl:!0}),t.canvas.requestRenderAll()})),t.on("deselected",(()=>{t.set({hasBorders:!1,hasControls:!1}),t.setControlsVisibility({tl:!1,tr:!1,bl:!1,br:!1,mt:!1,mb:!1,ml:!1,mr:!1,mtr:!0,deleteControl:!0,rotateControl:!0,resizeControl:!0}),t.canvas.requestRenderAll()}))},addCustomControls(t){window.devicePixelRatio;t.setControlsVisibility({tl:!1,tr:!1,bl:!1,br:!1,mt:!1,mb:!1,ml:!1,mr:!1,mtr:!0,deleteControl:!0,rotateControl:!0,resizeControl:!0}),t.controls.deleteControl=new gn({x:.5,y:-.5,cursorStyle:"pointer",mouseUpHandler:this.deleteObject,render:this.renderDeleteIcon,cornerSize:24,hitbox:{width:60,height:60}}),t.controls.rotateControl=new gn({x:0,y:-.5,offsetY:-40,cursorStyle:"crosshair",render:this.renderRotateIcon,cornerSize:24,actionHandler:Ma.rotationWithSnapping,hitbox:{width:60,height:60}}),t.controls.resizeControl=new gn({x:.5,y:.5,cursorStyle:"se-resize",render:this.renderResizeIcon,cornerSize:24,actionHandler:Ma.scalingEqually,hitbox:{width:60,height:60}}),t.set({cornerColor:"#00000000",cornerSize:24,cornerStyle:"circle",borderColor:"#ffffff",borderDashArray:[6,4],transparentCorners:!1,hasBorders:!1,hasControls:!1}),t.on("selected",(()=>{t.set({hasBorders:!0,hasControls:!0}),t.setControlsVisibility({tl:!1,tr:!1,bl:!1,br:!1,mt:!1,mb:!1,ml:!1,mr:!1,mtr:!0,deleteControl:!0,rotateControl:!0,resizeControl:!0}),t.canvas.requestRenderAll()})),t.on("deselected",(()=>{t.set({hasBorders:!1,hasControls:!1}),t.setControlsVisibility({tl:!1,tr:!1,bl:!1,br:!1,mt:!1,mb:!1,ml:!1,mr:!1,mtr:!0,deleteControl:!0,rotateControl:!0,resizeControl:!0}),t.canvas.requestRenderAll()}))},addRectangle(){const t=new Bi({left:this.canvas.width/2,top:this.canvas.height/2,fill:"#ffe066",width:200,height:200,objectCaching:!1,originX:"center",originY:"center",centeredRotation:!0,padding:12,selectable:!0,evented:!0,hasControls:!1,hasBorders:!1});this.addCustomControls(t),this.canvas.add(t),this.canvas.setActiveObject(t),this.canvas.renderAll()},addTextbox(){const t="1.방문자 카운팅 ",e=12,s=new zo(t,{left:this.canvas.width/2,top:this.canvas.height/2,originX:"center",originY:"center",fontSize:32,fill:"#222",fontFamily:"sans-serif",editable:!0,selectable:!0,evented:!0,hasControls:!1,hasBorders:!1,backgroundColor:"transparent",textAlign:"center"}),n=new Bi({left:s.left,top:s.top,originX:"center",originY:"center",width:s.width+2*e,height:s.height+2*e,rx:18,ry:18,fill:"#fffbe6",selectable:!1,evented:!1,hasBorders:!1,hasControls:!1});s._bgRect=n,this.canvas.add(n),this.canvas.add(s);const i=()=>{const t=this.canvas.getObjects(),e=t.indexOf(n),i=t.indexOf(s);e>-1&&i>-1&&e!==i-1&&(t.splice(e,1),t.splice(i,0,n),this.canvas._objects=t)},r=()=>{s.setCoords(),n.set({width:s.width*s.scaleX+2*e,height:s.height*s.scaleY+2*e,left:s.left,top:s.top,scaleX:1,scaleY:1,angle:s.angle}),i(),this.canvas.requestRenderAll()};s.on("changed",r),s.on("scaling",r),s.on("moving",r),s.on("rotating",r),i(),this.addCustomControls(s),this.canvas.setActiveObject(s),this.canvas.renderAll()},addImage(t){const e=new window.Image;e.src=t,e.onload=()=>{let s=e.width,n=e.height;const i=12,r=new oa(e,{left:0,top:0,originX:"center",originY:"center",width:s,height:n,selectable:!1,evented:!1,hasControls:!1,hasBorders:!1}),o=new Bi({left:0,top:0,originX:"center",originY:"center",width:s+2*i,height:n+2*i,fill:"rgba(0,0,0,0)",selectable:!1,evented:!1,hasControls:!1,hasBorders:!1}),h=new $i([o,r],{left:this.canvas.width/2,top:this.canvas.height/2,originX:"center",originY:"center",selectable:!0,evented:!0,hasControls:!1,hasBorders:!1});this.addCustomControls(h),this.canvas.add(h),this.canvas.setActiveObject(h),this.canvas.renderAll(),this.uploadedImages.push({url:t,fabricObj:(0,a.IG)(h)}),this.updateImageCount()}},onFileChange(t){const e=t.target.files;if(!e||0===e.length)return;let s=this.uploadedImages.length;if(s>=3)return void alert("이미지는 최대 3개까지만 추가할 수 있습니다.");const n=e[0];if(!n)return;const i=new FileReader;i.onload=t=>{const e=new window.Image;e.src=t.target.result,e.onload=()=>{let s=e.width,n=e.height,i=1;s>400&&(i=400/s);const r=12,o=new oa(e,{left:0,top:0,originX:"center",originY:"center",width:s,height:n,scaleX:i,scaleY:i,selectable:!1,evented:!1,hasControls:!1,hasBorders:!1}),h=new Bi({left:0,top:0,originX:"center",originY:"center",width:s*i+2*r,height:n*i+2*r,fill:"rgba(0,0,0,0)",selectable:!1,evented:!1,hasControls:!1,hasBorders:!1}),c=new $i([h,o],{left:this.canvas.width/2,top:this.canvas.height/2,originX:"center",originY:"center",selectable:!0,evented:!0,hasControls:!1,hasBorders:!1});this.addCustomControls(c),this.canvas.add(c),this.canvas.setActiveObject(c),this.canvas.renderAll(),this.uploadedImages.push({url:t.target.result,fabricObj:(0,a.IG)(c)}),this.updateImageCount()}},i.readAsDataURL(n),t.target.value=""},removePreviewImage(t){const e=this.uploadedImages[t];e&&e.fabricObj&&this.canvas.contains(e.fabricObj)&&this.canvas.remove(e.fabricObj)},removeImageObject(t){this.canvas.remove(t),this.canvas.renderAll(),this.updateImageCount()},updateImageCount(){this.imageCount=this.canvas.getObjects().filter((t=>"image"===t.type&&!1!==t.selectable)).length},replaceDefaultImage(t){if(!this.defaultImageObject)return;const e=new window.Image;e.src=t,e.onload=()=>{const t=this.canvas.width,s=this.canvas.height,n=e.width,i=e.height,r=Math.max(t/n,s/i);this.defaultImageObject.setElement(e),this.defaultImageObject.set({scaleX:r,scaleY:r,left:(t-n*r)/2,top:(s-i*r)/2,originX:"left",originY:"top",width:n,height:i}),this.canvas.renderAll()}},async initializeCanvas(){const t=414,e=736;this.canvas=(0,a.IG)(new Vr(this.$refs.canvas,{width:t,height:e,selection:!1,backgroundColor:"#ffffff"})),this.$refs.canvas.style.width=t+"px",this.$refs.canvas.style.height=e+"px";const s=new window.Image;s.src=this.backroundList[0].src,s.onload=async()=>{const t=this.canvas.width,e=this.canvas.height,n=s.width,i=s.height,r=Math.max(t/n,e/i),o=new oa(s,{left:(t-n*r)/2,top:(e-i*r)/2,originX:"left",originY:"top",scaleX:r,scaleY:r,width:n,height:i,selectable:!1,evented:!1,hasControls:!1,hasBorders:!1,lockMovementX:!0,lockMovementY:!0,lockScalingX:!0,lockScalingY:!0,lockRotation:!0});this.canvas.add(o),this.defaultImageObject=o,this.canvas.renderAll(),await this.addHumanSvg(),await this.addHumanControlLayer()}},addSticker(t){const e=new window.Image;e.src=t,e.onload=()=>{let t=e.width,s=e.height;const n=12,i=new oa(e,{left:0,top:0,originX:"center",originY:"center",width:t,height:s,selectable:!1,evented:!1,hasControls:!1,hasBorders:!1}),r=new Bi({left:0,top:0,originX:"center",originY:"center",width:t+2*n,height:s+2*n,fill:"rgba(0,0,0,0)",selectable:!1,evented:!1,hasControls:!1,hasBorders:!1}),o=new $i([r,i],{left:this.canvas.width/2,top:this.canvas.height/2,originX:"center",originY:"center",selectable:!0,evented:!0,hasControls:!1,hasBorders:!1});this.addCustomControls(o),this.canvas.add(o),this.canvas.setActiveObject(o),this.canvas.renderAll()}}},mounted:async function(){this.$nextTick((async()=>{await this.initializeCanvas(),this.canvas&&this.canvas.on("object:removed",(t=>{const e=this.uploadedImages.findIndex((e=>e.fabricObj===t.target));-1!==e&&(this.uploadedImages.splice(e,1),this.uploadedImages=this.uploadedImages.slice()),this.updateImageCount()}));const t=this.$el.querySelector(".mobile-wrapper");t&&t.addEventListener("touchmove",(t=>{this.panelOpen&&t.preventDefault()}),{passive:!1})}))}};const Cy=(0,mv.A)(yy,[["render",ly],["__scopeId","data-v-d54b696c"]]);var by=Cy,wy=s(8713);const xy={class:"relative"},Sy={class:"TopBar h-[34px] flex items-center bg-gray-900 relative select-none"},Ty={style:{"padding-top":"34px"}};function ky(t,e,s,i,r,o){const a=(0,n.g2)("MainCanvas");return(0,n.uX)(),(0,n.CE)("div",xy,[(0,n.Lk)("div",Sy,[e[4]||(e[4]=(0,n.Lk)("span",{class:"absolute inset-0 flex items-center justify-center pointer-events-none text-[16px] text-[#9A9A9E]"}," 2025. 06. 08 ",-1)),r.showPopup?((0,n.uX)(),(0,n.CE)(n.FK,{key:1},[(0,n.Lk)("button",{class:"text-red-400 flex absolute left-[20px] z-10",onClick:e[1]||(e[1]=(...t)=>o.closePopup&&o.closePopup(...t))}," 취소 "),(0,n.Lk)("button",{class:"text-blue-400 flex absolute right-[20px] z-10",onClick:e[2]||(e[2]=(...t)=>o.save&&o.save(...t))}," 저장 ")],64)):((0,n.uX)(),(0,n.CE)("button",{key:0,class:"text-green-300 flex absolute right-[20px] z-10",onClick:e[0]||(e[0]=(...t)=>o.openPopup&&o.openPopup(...t))},e[3]||(e[3]=[(0,n.Lk)("img",{src:wy,alt:""},null,-1),(0,n.eW)(),(0,n.Lk)("span",null,"완료",-1)])))]),(0,n.Lk)("div",Ty,[(0,n.bF)(a,{ref:"mainCanvas",hideUi:r.showPopup},null,8,["hideUi"])])])}var Ay={components:{MainCanvas:by},data(){return{showPopup:!1}},methods:{openPopup(){this.showPopup=!0},closePopup(){this.showPopup=!1},save(){this.$refs.mainCanvas&&this.$refs.mainCanvas.saveCanvasAsImage&&this.$refs.mainCanvas.saveCanvasAsImage(),this.showPopup=!1}}};const Ey=(0,mv.A)(Ay,[["render",ky]]);var Oy=Ey,Dy={components:{CanvasUI:Oy},data(){return{activeTab:0,tabs:[],vhRaf:null,lastVh:0}},mounted(){this.setRealViewportHeight(),window.addEventListener("resize",this.setRealViewportHeight),window.addEventListener("orientationchange",this.setRealViewportHeight),window.addEventListener("scroll",this.setRealViewportHeight,{passive:!0}),this.startVhPolling()},beforeUnmount(){window.removeEventListener("resize",this.setRealViewportHeight),window.removeEventListener("orientationchange",this.setRealViewportHeight),window.removeEventListener("scroll",this.setRealViewportHeight),cancelAnimationFrame(this.vhRaf)},methods:{setRealViewportHeight(){const t=.01*window.innerHeight;document.documentElement.style.setProperty("--vh",`${t}px`);const e=this.$refs.contentArea;e&&(e.style.height="calc(var(--vh, 1vh) * 100)"),this.lastVh=t},startVhPolling(){const t=()=>{const e=.01*window.innerHeight;e!==this.lastVh&&this.setRealViewportHeight(),this.vhRaf=requestAnimationFrame(t)};this.vhRaf=requestAnimationFrame(t)}}};const Py=(0,mv.A)(Dy,[["render",r]]);var Iy=Py},2904:function(t,e,s){"use strict";t.exports=s.p+"img/dress.3251499f.svg"},3055:function(t,e,s){"use strict";t.exports=s.p+"img/다가오는솔라스 (4).f3685030.jpg"},3153:function(t){"use strict";t.exports="data:image/png;base64,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"},3167:function(t,e,s){"use strict";var n=s(4901),i=s(34),r=s(2967);t.exports=function(t,e,s){var o,a;return r&&n(o=e.constructor)&&o!==s&&i(a=o.prototype)&&a!==s.prototype&&r(t,a),t}},3713:function(t,e,s){"use strict";t.exports=s.p+"img/다가오는솔라스 (2).8d50a0bc.jpg"},4684:function(t,e,s){"use strict";t.exports=s.p+"img/delete.11980f64.svg"},4979:function(t,e,s){"use strict";var n=s(6518),i=s(4576),r=s(7751),o=s(6980),a=s(4913).f,h=s(9297),c=s(679),l=s(3167),u=s(2603),d=s(5002),g=s(6193),p=s(3724),f=s(6395),m="DOMException",_=r("Error"),v=r(m),y=function(){c(this,C);var t=arguments.length,e=u(t<1?void 0:arguments[0]),s=u(t<2?void 0:arguments[1],"Error"),n=new v(e,s),i=new _(e);return i.name=m,a(n,"stack",o(1,g(i.stack,1))),l(n,this,y),n},C=y.prototype=v.prototype,b="stack"in new _(m),w="stack"in new v(1,2),x=v&&p&&Object.getOwnPropertyDescriptor(i,m),S=!!x&&!(x.writable&&x.configurable),T=b&&!S&&!w;n({global:!0,constructor:!0,forced:f||T},{DOMException:T?y:v});var k=r(m),A=k.prototype;if(A.constructor!==k)for(var E in f||a(A,"constructor",o(1,k)),d)if(h(d,E)){var O=d[E],D=O.s;h(k,D)||a(k,D,o(6,O.c))}},5002:function(t){"use strict";t.exports={IndexSizeError:{s:"INDEX_SIZE_ERR",c:1,m:1},DOMStringSizeError:{s:"DOMSTRING_SIZE_ERR",c:2,m:0},HierarchyRequestError:{s:"HIERARCHY_REQUEST_ERR",c:3,m:1},WrongDocumentError:{s:"WRONG_DOCUMENT_ERR",c:4,m:1},InvalidCharacterError:{s:"INVALID_CHARACTER_ERR",c:5,m:1},NoDataAllowedError:{s:"NO_DATA_ALLOWED_ERR",c:6,m:0},NoModificationAllowedError:{s:"NO_MODIFICATION_ALLOWED_ERR",c:7,m:1},NotFoundError:{s:"NOT_FOUND_ERR",c:8,m:1},NotSupportedError:{s:"NOT_SUPPORTED_ERR",c:9,m:1},InUseAttributeError:{s:"INUSE_ATTRIBUTE_ERR",c:10,m:1},InvalidStateError:{s:"INVALID_STATE_ERR",c:11,m:1},SyntaxError:{s:"SYNTAX_ERR",c:12,m:1},InvalidModificationError:{s:"INVALID_MODIFICATION_ERR",c:13,m:1},NamespaceError:{s:"NAMESPACE_ERR",c:14,m:1},InvalidAccessError:{s:"INVALID_ACCESS_ERR",c:15,m:1},ValidationError:{s:"VALIDATION_ERR",c:16,m:0},TypeMismatchError:{s:"TYPE_MISMATCH_ERR",c:17,m:1},SecurityError:{s:"SECURITY_ERR",c:18,m:1},NetworkError:{s:"NETWORK_ERR",c:19,m:1},AbortError:{s:"ABORT_ERR",c:20,m:1},URLMismatchError:{s:"URL_MISMATCH_ERR",c:21,m:1},QuotaExceededError:{s:"QUOTA_EXCEEDED_ERR",c:22,m:1},TimeoutError:{s:"TIMEOUT_ERR",c:23,m:1},InvalidNodeTypeError:{s:"INVALID_NODE_TYPE_ERR",c:24,m:1},DataCloneError:{s:"DATA_CLONE_ERR",c:25,m:1}}},5350:function(t,e,s){var n={"./backround/다가오는솔라스 (1).jpg":1560,"./backround/다가오는솔라스 (2).jpg":3713,"./backround/다가오는솔라스 (3).jpg":6502,"./backround/다가오는솔라스 (4).jpg":3055,"./clothes/dress.svg":2904,"./clothes/dress팔.svg":5892,"./clothes/shirt.svg":1129,"./clothes/shirt팔.svg":8199,"./green.svg":2697,"./sticker/Ae.png":2592,"./sticker/Ai.png":5359,"./sticker/Figma.png":9124,"./sticker/Ps.png":2649,"./sticker/css.png":3153,"./sticker/html.png":7089,"./sticker/vsCode.png":7792,"./ui/add.svg":7222,"./ui/cached.png":9783,"./ui/cached.svg":8015,"./ui/delete.svg":4684,"./ui/deleteIcon.png":7155,"./ui/download.svg":8713,"./ui/open_in_full.png":5507,"./ui/open_in_full.svg":795,"./인간.svg":9759,"./인간팔.svg":7608};function i(t){var e=r(t);return s(e)}function r(t){if(!s.o(n,t)){var e=new Error("Cannot find module '"+t+"'");throw e.code="MODULE_NOT_FOUND",e}return n[t]}i.keys=function(){return Object.keys(n)},i.resolve=r,t.exports=i,i.id=5350},5359:function(t){"use strict";t.exports="data:image/png;base64,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"},5507:function(t){"use strict";t.exports="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABwAAAAdCAYAAAC5UQwxAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAItSURBVHgBvZa9UsJAEMc3CQwDVfh4gPgERmgssaJUnkBtsHSslEqtaLGyoEFm6PEJzAyNpW9g7JwBBiz4aAD/myFMQIG7QPjPHJe73N2PvezerUKC0qFwOGxMJhPT7RuPxz1UPcgSXUfZNCCVSmWn0+k9CoP0lQspSgNVo9PpvJAfoAeUJTnZ2IXLVVZr/3UmEokyQM94NEheOqy9iEQiymg0sjYC4/F4FROuaEthjWw0GjWGw+HrSiBbtguYR+YyVPPAHlDd0u7F0B9A37nhOA083lBV9ZOCUw+OdARHslVuAXZPwUp3GcoerHPFVh6ENE3jeCNZZTIZisVi83az2dw0ha08D4F6Cs8kWaXT6QWoAJBlqoAZ5EP1ep1arRZJKstOY8rOYquKxaJTVyoVmal6SHQkzlZqt9sLsFKpRIPBwOkXBSoIeCGPqdVqVC6XKZ/Pz2ESoLl4S23RwYVCYSsYouFD5R/RCQzDEUW5XI58yg7BSy08nG0a6XX7fr9PfgTjGnzScEB2aQ/ik0blhGRmZdCqzg9vJEM3FLBg3SPXzn2IVOAbdxYnSMcUgAB7gHXOJbxwiCaTyTcfSdNacRR0u90jt616X2Jr8zJhIgJDOfH2LQDZgWYDqrSlOAR4LV7T2/8na8P3HHHSgzTvC00THqyTnPiivQPnhtdafrn2IuQYRXUG6DXK2lsF1lhc8Pi0bJUwcAluoDrEIeGC+c9wDNv49hYYXyLr/AJ1Zg88ITXPsQAAAABJRU5ErkJggg=="},5892:function(t,e,s){"use strict";t.exports=s.p+"img/dress팔.4f5f98d8.svg"},6193:function(t,e,s){"use strict";var n=s(9504),i=Error,r=n("".replace),o=function(t){return String(new i(t).stack)}("zxcasd"),a=/\n\s*at [^:]*:[^\n]*/,h=a.test(o);t.exports=function(t,e){if(h&&"string"==typeof t&&!i.prepareStackTrace)while(e--)t=r(t,a,"");return t}},6502:function(t,e,s){"use strict";t.exports=s.p+"img/다가오는솔라스 (3).84a0f5cc.jpg"},7089:function(t){"use strict";t.exports="data:image/png;base64,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"},7155:function(t,e,s){"use strict";t.exports=s.p+"img/deleteIcon.3e9c3b8f.png"},7222:function(t,e,s){"use strict";t.exports=s.p+"img/add.7dfab8a5.svg"},7608:function(t,e,s){"use strict";t.exports=s.p+"img/인간팔.fbad4d85.svg"},7792:function(t){"use strict";t.exports="data:image/png;base64,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"},8015:function(t,e,s){"use strict";t.exports=s.p+"img/cached.f9dec18a.svg"},8199:function(t,e,s){"use strict";t.exports=s.p+"img/shirt팔.250fb48a.svg"},8660:function(t){function e(t){var e=new Error("Cannot find module '"+t+"'");throw e.code="MODULE_NOT_FOUND",e}e.keys=function(){return[]},e.resolve=e,e.id=8660,t.exports=e},8713:function(t,e,s){"use strict";t.exports=s.p+"img/download.f2d1c768.svg"},9124:function(t){"use strict";t.exports="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAEoAAABKCAYAAAAc0MJxAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAleSURBVHgB7VxrbBTXFT73zqzXGOO1AT/q9WMdVCAoFaEPlUqVMKRqA7bjNeHlJg0lqGrVKoX8olVLcERUqU2VgPpIFQkhpKohuO46AUxQGgyKUqQ2aQyozQvjxdhmjWNszNrrfcy9OWcfjhcv2LvZa1ivP+lqxjNzZzzfnHPvOd/MHgZxwOFw5GZkZGzF1QfDzYYtF1IDg9ic1KSUzX6//0xdXZ1zqp3ZVA46evRopaZpe/ACD9JFOOencXnO5/M58WKDkAIIP2QbhB7wKmx2bKeFEPtrampOT9b/jkSdOHHChoQcxGbDP/chMYdShZip4Pjx4z9kjJEBtOG9PX0nC7stUS0tLTtxsQNPsq+qqmo/zGAcO3ZsJxJG97q/urp6X6xjYhKFTDfgYiuyvDoeP05lhL2nFdshNIyGW/fzWzeESapNJ5IIa9eudaJVrcbV2jAHUYgiKuxuZEl16URSBEQWTlR1SNhWcsfx+8ZcL2J6Xq83rSwpFogLnA1bx3vVmEUhSS/SwJ3uJBHIsmhgN5vNB6N2UJyEftkBs4gCDkUdxA2tBy0K/ZKmxgaYRRTIwyjQpnUW9sf3cUrMg1lEIRzNd+BYVcGRpErc1gyzmIBwFtJM+a2OK7WUv4EakGvLJ6zz5m+2zXnuW3lmu4mzQnmHjEAGPJDzlU0Afs9tT4r9pc8Qve90X2ve/94HDa93dPSGryUg+TiD/KwiomwYN5yD5IPOHeioLjtSZjFtdN/0C2SHySkm4ncCnces8aLVpYU/XrPi/p9c6b/uKHvh4PrINSG5aKP0hp6CjVQASC7ovIH+zRUf52uybvimn26Otn1hksYDb4BB/wAUc61mcPfPPoEQSUm9RpgbG/3zuQoUAeG0lzaZPYEKIZkOiqEJoWd7Riu6nn7yVUgywtzkclCARwrmFpZnZawXoJ6kCDQhNevC3E3bly1TMnsrIepHi+Y2DLn9EqYZxqcD8rH7S54DBVBC1Mr5maQeJnWsmAo0HLJWlhTZQQGUEJWpQeG0sxQCm6PpRaAASoiCu8RS6NpMicsrIcrrly4IxoXTDAnS7ff3ggIoIerf170U6d8NouC9PpcDFEAJUU1do7+em21S49a3A1oT5Oex/afOPQsKoORmDnQNDVwe9r2KCYsB0wRD40Zn/2CTo7f3GiiAqqfO7nvtyhZfhn6Js6TnXtFASzIYM4bnZF4qf+HABlA0lagiirJ4fWFjx+I+Jl+fN88UzPghmeMWpvSCrrMwl7kM8XfL3j8ugVBSrGRsVJlikCXxiuYrj24sWWDdvci3x5rl+bbFpC+WEmNDvNNYnfwBYcD8+RqMDn2+EZNf2d9zE4YHBdMzc/DxCq/H0945Aq0v//PdZ35//nwfhBNxUITpyMWYN/fxwMl5O0DPtupZWgaXIfOK6SJFVtDrdrHx+xh89wdZvG7XXr7sgS1aRkYObmE+7yhkXevNEH/4hRngvATF0ZtKooLa0KEtPY1Wy5c2dA0JwYHxyaS1zEB0f+vJrkbtPuujgQ5DgB/7h1JIJMW8GPJKv6wfeGWbv/N3jqsPlanSo4JQNUYF3eCNJ92f6LzA3jNEGziP86EHSjtG2oWpqDZwWQbfgEzszxjtY7y4puR/biV6VATKBvO/1Xf+o3/UbDOklpDVFr/V6Qh0mMqY4JP3N7gues0VRW92HwFFUELUNwseKSywlNYZUo+fJPqPKit1vazUzkQcJAtNM9uKN+Z8b3vq6FGrl+9o6BmUCU3Tsv/GMN+067eByyLu/n6nIU0PP5Y6etSS3JV2mtIhAQh3pt+0vLIeEhlrcKw3LV2pRI9SMuvp+pzChKM+k9nCTWABT0JnYNycmT56lPwikpKEVNKjRhLXo/yeIRnwXk2wv5Sj7tTRoz789B2HBJEQUTw7oPnbWl+hXA7iBVqy7/zZ1NGjLvQe2V1i4Qmdmy2Yly2O//kZU0Xc/SVGXaz/6F9SR486+f8DA939PYc5C8SvR1GKc+yYx3ux+4jkxtT7a8LwXulsgn85+kABlOlRTzRa6y3mkXaNGZRWxOtG0vVwyWYtb+QSaJP2l4CE8tyRdtea8g2gCEr1qJqDliVcXG0uttDoIePVo/SuFZbFEnpeM5WzWP1xchTCZGNMCFdj14qcpaBQj1Kpawf1qPrDpRv3HN9uve766OU8l/vD/CEw8m+AXIiRe6xWMBDd/+rq8g19P623Bro/btIWGDd0K5PUtAW+m/7uC03Xdzfku75T+n2YCXpU20MXxLtbX9K9JULXTWYupLydbgesKBffToz9GRRlRt487MK2CSZaSyRiS656GgPK9ais/+xtgkX56zXnNZHlZpNaMMvOg+GJm2+nYk3bKzFVRAXdINt1sF30dpfJy30kHU3v66skQ9lgnnX+Nw4iCePOafv0RyXUELXmgUJenGefKSQRlBBl3vKNZ0Vn3/S/UlcIJURpX62oTVSPulehxvV0VggzDPeeHsXZPemyaojy+FwAiWjm2MeAIbgHoYQo4/0rpAklQhSI/3a+Bfcg1Cicpz7azWwFcZ5bSl5WyDzPv/FzuLsfN8aEGtdrPDsgLvUfxre7U9aTmKYZRtdAE5w61wN342u9SUBEDdLPrSC5YJ6v/aqeWeZeRLICdx6vMEPWkNCcue2e5b9U9n1ToghzM0hEOcMVJpKJoB41bNu5VPoDDl5eyEIa+HjCguuC2wqY8EMjHQuh3FPFL6QSRpgbJxHVhvewHJKPoJ7k+fqeTe7a5wuMs+1/gtHAVZz+BQajhvQFeoyzF19yP/7X+Wh9pCcxAMVf5yUGKlHipCfYhq0S2yFIPkLW8fbFPu/bF5/Ctacg9bAqWI+G6q1gtmFXME7NFNipMhCnn1khUW3hckezGAcqcoOL01TiIBgeGIZB78J2wiyiQJWAsEUXtWlpaWm9tcxGOoPKr6BFjb11Hgs4kblt9NtZHKtskOagEge42EE1pSLbxoiKlNnAsao1nckaVx4pqvzKhCgYzW0PLuzpWPEnXCyD3K25qqoq6huGCble+IDmdLOsiCVBDJIIMZNiOjDihukwwNPAHXG3WCQRJi0GiKb4Iq5StcSG6upqFdH7XUGkVCZOYDvxHp0YVG5LqBjgeCDjFMaTZVVia8b101R9I9XLS1K1RM55w7p1685M1j8uSSNsYZW4WguhYqXUUqpgKZFDmUi8pTI/Aw34RKGyZ3BiAAAAAElFTkSuQmCC"},9759:function(t,e,s){"use strict";t.exports=s.p+"img/인간.db6c9b9b.svg"},9783:function(t){"use strict";t.exports="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACEAAAAhCAYAAABX5MJvAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAPuSURBVHgBvVhNTBNREH7bXwyEUiKUCKggMVCCmnAAwwEIB43GePOuIcFwkuiBxAPWBA8k+HPRBGj0wMHWhAhJDZWk0R4oF1ETKvTW0CJ/CaEFW/r7nNnuNm1p6SuUfsl0u33v7Xwzb97MbDlyPHCCpIKmXPMKbnd3Vx2JRB5RSj+DOGkC4Pff4XB4xuv19i4vL1+G+TIQCckTuFAo1A16vtEc4Pf7J61WqxbWK0h6j7EBLYfnvaYngMfjeQeo7urqkuVMBiypi0ajTpoHwDatTk9PX8nJK/kkkEjEaDRea2hoUKYjIk28gfllMpnMxnHcRZJHSCQSVWNj4+2NjY2pnZ2df9vb25GMkyHK39BTxNbW1oRKpVKT2Ok5DNwGWgBYLJZ7oK6EpNkWDrzwgRYAe3t7C6BP09raKheVS0UvyOXy94QRkJTI4uJPYrMtELfbTSorK4hSqWRaq1AoalZWVibn5ua8cBuKD0D03me1ZGnJTrVNLbSm+kJcrrd30PFxPesjqN1uf1FSUlIhxgb/IZVK77JYgVY3N2tJb+8D4gFvaLVasgDeMJu/Et2z5/wcHMsGjUbTtr+/X4SqgRN/UjjIC7+ysTcaP/FW4zUVq6su3jsokCWzPYoeHByswfZdAt3FRAhQSbZFIgFRUomg4qEhXXyMhQjobVKr1Sr4ynECichR7rt54xZ/tdv/kNraGlJaWkpmzV+SxjFYXS532vF0gITYApc1EA9/TxlgMMS8gRanWmo0HO2pDJ5AEpi4JOJ2ZK0VqFjcd5fLdWhcJMJCAHKFA/Q2C9mTJ4E9wwxlAB5DVIREBgYe895Bz4yOvuLHMUBZsL6+/h1jAqRUDEzO5/M9oYxAIu1tHUnuR1KYP1gBqVsHehuE0xGD2WyupDkAt2Z21sx7Yn7exnQaEtHf338H1J4HSUqzMtgSKy0AnE6nCfRdBakkQrIUm9EI1PhhUgAMDw9PwMUH4ke9qeNyiNq39BQBhcuAXiguLq5CfelIcnq9/hy2YvQUAJX6b09PT3dRUVEd1A4MyIyvBDKTydSSbyJIoK+vD4skvpOUCd13ZmCzgU1pMBhkO/TsBBpBzkLlVRAGYPJQDg4O1mNPSE8Ah8PxsbOzs1vwQAUrgUQiuKB8ZGSkY3NzcyoX5dBR/xgbG3sI6/F9ow6fkyuBOIS9w6a0SqfTddpstqdwlC2Y+2mKyzEVw/hLwXIsTvUgGmG9LJvF2YBRLC8vL1cGAoEz0AApQPA7HjEp9IxYETmIoQg0KiEo0UFoWjAHoARILBdET0oikQzOR+VomZQkHzNUFBYkIgjTXwTHf2NO+I8Ct4T/gYvdkhzxH2ptvLAYzgqbAAAAAElFTkSuQmCC"}}]);
//# sourceMappingURL=700.6e5dcbd2.js.map