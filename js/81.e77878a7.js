(self["webpackChunkalien_mood"]=self["webpackChunkalien_mood"]||[]).push([[81],{515:function(t,e,s){"use strict";t.exports=s.p+"img/03.8e8b3848.svg"},655:function(t,e,s){"use strict";var i=s(6955),n=String;t.exports=function(t){if("Symbol"===i(t))throw new TypeError("Cannot convert a Symbol value to a string");return n(t)}},795:function(t,e,s){"use strict";t.exports=s.p+"img/open_in_full.746e6c15.svg"},1081:function(t,e,s){"use strict";s.r(e),s.d(e,{default:function(){return Hy}});var i=s(6768);const n={ref:"contentArea",class:"mobile-wrapper h-[full]"};function r(t,e,s,r,o,a){const l=(0,i.g2)("CanvasUI");return(0,i.uX)(),(0,i.CE)("div",n,[(0,i.bF)(l,{ref:"child"},null,512)],512)}var o=s(4232);s(4114),s(8111),s(2489),s(7588),s(1701);var a=s(144);s(1148),s(116),s(8237),s(3579),s(7642),s(8004),s(3853),s(5876),s(2475),s(5024),s(1698),s(9577);function l(t,e,s){return(e=function(t){var e=function(t,e){if("object"!=typeof t||!t)return t;var s=t[Symbol.toPrimitive];if(void 0!==s){var i=s.call(t,e||"default");if("object"!=typeof i)return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}(t,"string");return"symbol"==typeof e?e:e+""}(e))in t?Object.defineProperty(t,e,{value:s,enumerable:!0,configurable:!0,writable:!0}):t[e]=s,t}function h(t,e){var s=Object.keys(t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(t);e&&(i=i.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),s.push.apply(s,i)}return s}function c(t){for(var e=1;e<arguments.length;e++){var s=null!=arguments[e]?arguments[e]:{};e%2?h(Object(s),!0).forEach((function(e){l(t,e,s[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(s)):h(Object(s)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(s,e))}))}return t}function u(t,e){if(null==t)return{};var s,i,n=function(t,e){if(null==t)return{};var s={};for(var i in t)if({}.hasOwnProperty.call(t,i)){if(e.indexOf(i)>=0)continue;s[i]=t[i]}return s}(t,e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);for(i=0;i<r.length;i++)s=r[i],e.indexOf(s)>=0||{}.propertyIsEnumerable.call(t,s)&&(n[s]=t[s])}return n}function d(t,e){return e||(e=t.slice(0)),Object.freeze(Object.defineProperties(t,{raw:{value:Object.freeze(e)}}))}class g{constructor(){l(this,"browserShadowBlurConstant",1),l(this,"DPI",96),l(this,"devicePixelRatio","undefined"!=typeof window?window.devicePixelRatio:1),l(this,"perfLimitSizeTotal",2097152),l(this,"maxCacheSideLimit",4096),l(this,"minCacheSideLimit",256),l(this,"disableStyleCopyPaste",!1),l(this,"enableGLFiltering",!0),l(this,"textureSize",4096),l(this,"forceGLPutImageData",!1),l(this,"cachesBoundsOfCurve",!1),l(this,"fontPaths",{}),l(this,"NUM_FRACTION_DIGITS",4)}}const p=new class extends g{constructor(t){super(),this.configure(t)}configure(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};Object.assign(this,t)}addFonts(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};this.fontPaths=c(c({},this.fontPaths),t)}removeFonts(){(arguments.length>0&&void 0!==arguments[0]?arguments[0]:[]).forEach((t=>{delete this.fontPaths[t]}))}clearFonts(){this.fontPaths={}}restoreDefaults(t){const e=new g,s=(null==t?void 0:t.reduce(((t,s)=>(t[s]=e[s],t)),{}))||e;this.configure(s)}},f=function(t){for(var e=arguments.length,s=new Array(e>1?e-1:0),i=1;i<e;i++)s[i-1]=arguments[i];return console[t]("fabric",...s)};class m extends Error{constructor(t,e){super("fabric: ".concat(t),e)}}class _ extends m{constructor(t){super("".concat(t," 'options.signal' is in 'aborted' state"))}}class v{}class y extends v{testPrecision(t,e){const s="precision ".concat(e," float;\nvoid main(){}"),i=t.createShader(t.FRAGMENT_SHADER);return!!i&&(t.shaderSource(i,s),t.compileShader(i),!!t.getShaderParameter(i,t.COMPILE_STATUS))}queryWebGL(t){const e=t.getContext("webgl");e&&(this.maxTextureSize=e.getParameter(e.MAX_TEXTURE_SIZE),this.GLPrecision=["highp","mediump","lowp"].find((t=>this.testPrecision(e,t))),e.getExtension("WEBGL_lose_context").loseContext(),f("log","WebGL: max texture size ".concat(this.maxTextureSize)))}isSupported(t){return!!this.maxTextureSize&&this.maxTextureSize>=t}}const b={};let C;const x=()=>C||(C={document:document,window:window,isTouchSupported:"ontouchstart"in window||"ontouchstart"in document||window&&window.navigator&&window.navigator.maxTouchPoints>0,WebGLProbe:new y,dispose(){},copyPasteData:b}),w=()=>x().document,S=()=>x().window,T=()=>{var t;return Math.max(null!==(t=p.devicePixelRatio)&&void 0!==t?t:S().devicePixelRatio,1)},k=new class{constructor(){l(this,"charWidthsCache",{}),l(this,"boundsOfCurveCache",{})}getFontCache(t){let{fontFamily:e,fontStyle:s,fontWeight:i}=t;e=e.toLowerCase(),this.charWidthsCache[e]||(this.charWidthsCache[e]={});const n=this.charWidthsCache[e],r="".concat(s.toLowerCase(),"_").concat((i+"").toLowerCase());return n[r]||(n[r]={}),n[r]}clearFontCache(t){(t=(t||"").toLowerCase())?this.charWidthsCache[t]&&delete this.charWidthsCache[t]:this.charWidthsCache={}}limitDimsByArea(t){const{perfLimitSizeTotal:e}=p,s=Math.sqrt(e*t);return[Math.floor(s),Math.floor(e/s)]}},O="6.7.0";function E(){}const D=Math.PI/2,I=2*Math.PI,P=Math.PI/180,A=Object.freeze([1,0,0,1,0,0]),M=16,R=.4477152502,L="center",F="left",j="top",N="bottom",B="right",W="none",X=/\r?\n/,Y="moving",V="scaling",H="rotating",z="rotate",G="skewing",U="resizing",q="modifyPoly",K="modifyPath",$="changed",Q="scale",J="scaleX",Z="scaleY",tt="skewX",et="skewY",st="fill",it="stroke",nt="modified",rt="json",ot="svg",at=new class{constructor(){this[rt]=new Map,this[ot]=new Map}has(t){return this[rt].has(t)}getClass(t){const e=this[rt].get(t);if(!e)throw new m("No class registered for ".concat(t));return e}setClass(t,e){e?this[rt].set(e,t):(this[rt].set(t.type,t),this[rt].set(t.type.toLowerCase(),t))}getSVGClass(t){return this[ot].get(t)}setSVGClass(t,e){this[ot].set(null!=e?e:t.type.toLowerCase(),t)}},lt=new class extends Array{remove(t){const e=this.indexOf(t);e>-1&&this.splice(e,1)}cancelAll(){const t=this.splice(0);return t.forEach((t=>t.abort())),t}cancelByCanvas(t){if(!t)return[];const e=this.filter((e=>{var s;return e.target===t||"object"==typeof e.target&&(null===(s=e.target)||void 0===s?void 0:s.canvas)===t}));return e.forEach((t=>t.abort())),e}cancelByTarget(t){if(!t)return[];const e=this.filter((e=>e.target===t));return e.forEach((t=>t.abort())),e}};class ht{constructor(){l(this,"__eventListeners",{})}on(t,e){if(this.__eventListeners||(this.__eventListeners={}),"object"==typeof t)return Object.entries(t).forEach((t=>{let[e,s]=t;this.on(e,s)})),()=>this.off(t);if(e){const s=t;return this.__eventListeners[s]||(this.__eventListeners[s]=[]),this.__eventListeners[s].push(e),()=>this.off(s,e)}return()=>!1}once(t,e){if("object"==typeof t){const e=[];return Object.entries(t).forEach((t=>{let[s,i]=t;e.push(this.once(s,i))})),()=>e.forEach((t=>t()))}if(e){const s=this.on(t,(function(){for(var t=arguments.length,i=new Array(t),n=0;n<t;n++)i[n]=arguments[n];e.call(this,...i),s()}));return s}return()=>!1}_removeEventListener(t,e){if(this.__eventListeners[t])if(e){const s=this.__eventListeners[t],i=s.indexOf(e);i>-1&&s.splice(i,1)}else this.__eventListeners[t]=[]}off(t,e){if(this.__eventListeners)if(void 0===t)for(const s in this.__eventListeners)this._removeEventListener(s);else"object"==typeof t?Object.entries(t).forEach((t=>{let[e,s]=t;this._removeEventListener(e,s)})):this._removeEventListener(t,e)}fire(t,e){var s;if(!this.__eventListeners)return;const i=null===(s=this.__eventListeners[t])||void 0===s?void 0:s.concat();if(i)for(let n=0;n<i.length;n++)i[n].call(this,e||{})}}const ct=(t,e)=>{const s=t.indexOf(e);return-1!==s&&t.splice(s,1),t},ut=t=>{if(0===t)return 1;switch(Math.abs(t)/D){case 1:case 3:return 0;case 2:return-1}return Math.cos(t)},dt=t=>{if(0===t)return 0;const e=t/D,s=Math.sign(t);switch(e){case 1:return s;case 2:return 0;case 3:return-s}return Math.sin(t)};class gt{constructor(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;"object"==typeof t?(this.x=t.x,this.y=t.y):(this.x=t,this.y=e)}add(t){return new gt(this.x+t.x,this.y+t.y)}addEquals(t){return this.x+=t.x,this.y+=t.y,this}scalarAdd(t){return new gt(this.x+t,this.y+t)}scalarAddEquals(t){return this.x+=t,this.y+=t,this}subtract(t){return new gt(this.x-t.x,this.y-t.y)}subtractEquals(t){return this.x-=t.x,this.y-=t.y,this}scalarSubtract(t){return new gt(this.x-t,this.y-t)}scalarSubtractEquals(t){return this.x-=t,this.y-=t,this}multiply(t){return new gt(this.x*t.x,this.y*t.y)}scalarMultiply(t){return new gt(this.x*t,this.y*t)}scalarMultiplyEquals(t){return this.x*=t,this.y*=t,this}divide(t){return new gt(this.x/t.x,this.y/t.y)}scalarDivide(t){return new gt(this.x/t,this.y/t)}scalarDivideEquals(t){return this.x/=t,this.y/=t,this}eq(t){return this.x===t.x&&this.y===t.y}lt(t){return this.x<t.x&&this.y<t.y}lte(t){return this.x<=t.x&&this.y<=t.y}gt(t){return this.x>t.x&&this.y>t.y}gte(t){return this.x>=t.x&&this.y>=t.y}lerp(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:.5;return e=Math.max(Math.min(1,e),0),new gt(this.x+(t.x-this.x)*e,this.y+(t.y-this.y)*e)}distanceFrom(t){const e=this.x-t.x,s=this.y-t.y;return Math.sqrt(e*e+s*s)}midPointFrom(t){return this.lerp(t)}min(t){return new gt(Math.min(this.x,t.x),Math.min(this.y,t.y))}max(t){return new gt(Math.max(this.x,t.x),Math.max(this.y,t.y))}toString(){return"".concat(this.x,",").concat(this.y)}setXY(t,e){return this.x=t,this.y=e,this}setX(t){return this.x=t,this}setY(t){return this.y=t,this}setFromPoint(t){return this.x=t.x,this.y=t.y,this}swap(t){const e=this.x,s=this.y;this.x=t.x,this.y=t.y,t.x=e,t.y=s}clone(){return new gt(this.x,this.y)}rotate(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:pt;const s=dt(t),i=ut(t),n=this.subtract(e);return new gt(n.x*i-n.y*s,n.x*s+n.y*i).add(e)}transform(t){let e=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return new gt(t[0]*this.x+t[2]*this.y+(e?0:t[4]),t[1]*this.x+t[3]*this.y+(e?0:t[5]))}}const pt=new gt(0,0),ft=t=>!!t&&Array.isArray(t._objects);function mt(t){class e extends t{constructor(){super(...arguments),l(this,"_objects",[])}_onObjectAdded(t){}_onObjectRemoved(t){}_onStackOrderChanged(t){}add(){for(var t=arguments.length,e=new Array(t),s=0;s<t;s++)e[s]=arguments[s];const i=this._objects.push(...e);return e.forEach((t=>this._onObjectAdded(t))),i}insertAt(t){for(var e=arguments.length,s=new Array(e>1?e-1:0),i=1;i<e;i++)s[i-1]=arguments[i];return this._objects.splice(t,0,...s),s.forEach((t=>this._onObjectAdded(t))),this._objects.length}remove(){const t=this._objects,e=[];for(var s=arguments.length,i=new Array(s),n=0;n<s;n++)i[n]=arguments[n];return i.forEach((s=>{const i=t.indexOf(s);-1!==i&&(t.splice(i,1),e.push(s),this._onObjectRemoved(s))})),e}forEachObject(t){this.getObjects().forEach(((e,s,i)=>t(e,s,i)))}getObjects(){for(var t=arguments.length,e=new Array(t),s=0;s<t;s++)e[s]=arguments[s];return 0===e.length?[...this._objects]:this._objects.filter((t=>t.isType(...e)))}item(t){return this._objects[t]}isEmpty(){return 0===this._objects.length}size(){return this._objects.length}contains(t,s){return!!this._objects.includes(t)||!!s&&this._objects.some((s=>s instanceof e&&s.contains(t,!0)))}complexity(){return this._objects.reduce(((t,e)=>t+(e.complexity?e.complexity():0)),0)}sendObjectToBack(t){return!(!t||t===this._objects[0])&&(ct(this._objects,t),this._objects.unshift(t),this._onStackOrderChanged(t),!0)}bringObjectToFront(t){return!(!t||t===this._objects[this._objects.length-1])&&(ct(this._objects,t),this._objects.push(t),this._onStackOrderChanged(t),!0)}sendObjectBackwards(t,e){if(!t)return!1;const s=this._objects.indexOf(t);if(0!==s){const i=this.findNewLowerIndex(t,s,e);return ct(this._objects,t),this._objects.splice(i,0,t),this._onStackOrderChanged(t),!0}return!1}bringObjectForward(t,e){if(!t)return!1;const s=this._objects.indexOf(t);if(s!==this._objects.length-1){const i=this.findNewUpperIndex(t,s,e);return ct(this._objects,t),this._objects.splice(i,0,t),this._onStackOrderChanged(t),!0}return!1}moveObjectTo(t,e){return t!==this._objects[e]&&(ct(this._objects,t),this._objects.splice(e,0,t),this._onStackOrderChanged(t),!0)}findNewLowerIndex(t,e,s){let i;if(s){i=e;for(let s=e-1;s>=0;--s)if(t.isOverlapping(this._objects[s])){i=s;break}}else i=e-1;return i}findNewUpperIndex(t,e,s){let i;if(s){i=e;for(let s=e+1;s<this._objects.length;++s)if(t.isOverlapping(this._objects[s])){i=s;break}}else i=e+1;return i}collectObjects(t){let{left:e,top:s,width:i,height:n}=t,{includeIntersecting:r=!0}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const o=[],a=new gt(e,s),l=a.add(new gt(i,n));for(let h=this._objects.length-1;h>=0;h--){const t=this._objects[h];t.selectable&&t.visible&&(r&&t.intersectsWithRect(a,l)||t.isContainedWithinRect(a,l)||r&&t.containsPoint(a)||r&&t.containsPoint(l))&&o.push(t)}return o}}return e}class _t extends ht{_setOptions(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};for(const e in t)this.set(e,t[e])}_setObject(t){for(const e in t)this._set(e,t[e])}set(t,e){return"object"==typeof t?this._setObject(t):this._set(t,e),this}_set(t,e){this[t]=e}toggle(t){const e=this.get(t);return"boolean"==typeof e&&this.set(t,!e),this}get(t){return this[t]}}function vt(t){return S().requestAnimationFrame(t)}function yt(t){return S().cancelAnimationFrame(t)}let bt=0;const Ct=()=>bt++,xt=()=>{const t=w().createElement("canvas");if(!t||void 0===t.getContext)throw new m("Failed to create `canvas` element");return t},wt=()=>w().createElement("img"),St=t=>{const e=xt();return e.width=t.width,e.height=t.height,e},Tt=(t,e,s)=>t.toDataURL("image/".concat(e),s),kt=(t,e,s)=>new Promise(((i,n)=>{t.toBlob(i,"image/".concat(e),s)})),Ot=t=>t*P,Et=t=>t/P,Dt=t=>t.every(((t,e)=>t===A[e])),It=(t,e,s)=>new gt(t).transform(e,s),Pt=t=>{const e=1/(t[0]*t[3]-t[1]*t[2]),s=[e*t[3],-e*t[1],-e*t[2],e*t[0],0,0],{x:i,y:n}=new gt(t[4],t[5]).transform(s,!0);return s[4]=-i,s[5]=-n,s},At=(t,e,s)=>[t[0]*e[0]+t[2]*e[1],t[1]*e[0]+t[3]*e[1],t[0]*e[2]+t[2]*e[3],t[1]*e[2]+t[3]*e[3],s?0:t[0]*e[4]+t[2]*e[5]+t[4],s?0:t[1]*e[4]+t[3]*e[5]+t[5]],Mt=(t,e)=>t.reduceRight(((t,s)=>s&&t?At(s,t,e):s||t),void 0)||A.concat(),Rt=t=>{let[e,s]=t;return Math.atan2(s,e)},Lt=t=>{const e=Rt(t),s=Math.pow(t[0],2)+Math.pow(t[1],2),i=Math.sqrt(s),n=(t[0]*t[3]-t[2]*t[1])/i,r=Math.atan2(t[0]*t[2]+t[1]*t[3],s);return{angle:Et(e),scaleX:i,scaleY:n,skewX:Et(r),skewY:0,translateX:t[4]||0,translateY:t[5]||0}},Ft=function(t){return[1,0,0,1,t,arguments.length>1&&void 0!==arguments[1]?arguments[1]:0]};function jt(){let{angle:t=0}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},{x:e=0,y:s=0}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const i=Ot(t),n=ut(i),r=dt(i);return[n,r,-r,n,e?e-(n*e-r*s):0,s?s-(r*e+n*s):0]}const Nt=function(t){return[t,0,0,arguments.length>1&&void 0!==arguments[1]?arguments[1]:t,0,0]},Bt=t=>Math.tan(Ot(t)),Wt=t=>[1,0,Bt(t),1,0,0],Xt=t=>[1,Bt(t),0,1,0,0],Yt=t=>{let{scaleX:e=1,scaleY:s=1,flipX:i=!1,flipY:n=!1,skewX:r=0,skewY:o=0}=t,a=Nt(i?-e:e,n?-s:s);return r&&(a=At(a,Wt(r),!0)),o&&(a=At(a,Xt(o),!0)),a},Vt=t=>{const{translateX:e=0,translateY:s=0,angle:i=0}=t;let n=Ft(e,s);i&&(n=At(n,jt({angle:i})));const r=Yt(t);return Dt(r)||(n=At(n,r)),n},Ht=function(t){let{signal:e,crossOrigin:s=null}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return new Promise((function(i,n){if(e&&e.aborted)return n(new _("loadImage"));const r=wt();let o;e&&(o=function(t){r.src="",n(t)},e.addEventListener("abort",o,{once:!0}));const a=function(){r.onload=r.onerror=null,o&&(null==e||e.removeEventListener("abort",o)),i(r)};t?(r.onload=a,r.onerror=function(){o&&(null==e||e.removeEventListener("abort",o)),n(new m("Error loading ".concat(r.src)))},s&&(r.crossOrigin=s),r.src=t):a()}))},zt=function(t){let{signal:e,reviver:s=E}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return new Promise(((i,n)=>{const r=[];e&&e.addEventListener("abort",n,{once:!0}),Promise.all(t.map((t=>at.getClass(t.type).fromObject(t,{signal:e}).then((e=>(s(t,e),r.push(e),e)))))).then(i).catch((t=>{r.forEach((t=>{t.dispose&&t.dispose()})),n(t)})).finally((()=>{e&&e.removeEventListener("abort",n)}))}))},Gt=function(t){let{signal:e}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return new Promise(((s,i)=>{const n=[];e&&e.addEventListener("abort",i,{once:!0});const r=Object.values(t).map((t=>t&&t.type&&at.has(t.type)?zt([t],{signal:e}).then((t=>{let[e]=t;return n.push(e),e})):t)),o=Object.keys(t);Promise.all(r).then((t=>t.reduce(((t,e,s)=>(t[o[s]]=e,t)),{}))).then(s).catch((t=>{n.forEach((t=>{t.dispose&&t.dispose()})),i(t)})).finally((()=>{e&&e.removeEventListener("abort",i)}))}))},Ut=function(t){return(arguments.length>1&&void 0!==arguments[1]?arguments[1]:[]).reduce(((e,s)=>(s in t&&(e[s]=t[s]),e)),{})},qt=(t,e)=>Object.keys(t).reduce(((s,i)=>(e(t[i],i,t)&&(s[i]=t[i]),s)),{}),Kt=(t,e)=>parseFloat(Number(t).toFixed(e)),$t=t=>"matrix("+t.map((t=>Kt(t,p.NUM_FRACTION_DIGITS))).join(" ")+")",Qt=t=>!!t&&void 0!==t.toLive,Jt=t=>!!t&&"function"==typeof t.toObject,Zt=t=>!!t&&void 0!==t.offsetX&&"source"in t,te=t=>!!t&&"multiSelectionStacking"in t;function ee(t){const e=t&&se(t);let s=0,i=0;if(!t||!e)return{left:s,top:i};let n=t;const r=e.documentElement,o=e.body||{scrollLeft:0,scrollTop:0};for(;n&&(n.parentNode||n.host)&&(n=n.parentNode||n.host,n===e?(s=o.scrollLeft||r.scrollLeft||0,i=o.scrollTop||r.scrollTop||0):(s+=n.scrollLeft||0,i+=n.scrollTop||0),1!==n.nodeType||"fixed"!==n.style.position););return{left:s,top:i}}const se=t=>t.ownerDocument||null,ie=t=>{var e;return(null===(e=t.ownerDocument)||void 0===e?void 0:e.defaultView)||null},ne=function(t,e,s){let{width:i,height:n}=s,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1;t.width=i,t.height=n,r>1&&(t.setAttribute("width",(i*r).toString()),t.setAttribute("height",(n*r).toString()),e.scale(r,r))},re=(t,e)=>{let{width:s,height:i}=e;s&&(t.style.width="number"==typeof s?"".concat(s,"px"):s),i&&(t.style.height="number"==typeof i?"".concat(i,"px"):i)};function oe(t){return void 0!==t.onselectstart&&(t.onselectstart=()=>!1),t.style.userSelect=W,t}class ae{constructor(t){l(this,"_originalCanvasStyle",void 0),l(this,"lower",void 0);const e=this.createLowerCanvas(t);this.lower={el:e,ctx:e.getContext("2d")}}createLowerCanvas(t){const e=(s=t)&&void 0!==s.getContext?t:t&&w().getElementById(t)||xt();var s;if(e.hasAttribute("data-fabric"))throw new m("Trying to initialize a canvas that has already been initialized. Did you forget to dispose the canvas?");return this._originalCanvasStyle=e.style.cssText,e.setAttribute("data-fabric","main"),e.classList.add("lower-canvas"),e}cleanupDOM(t){let{width:e,height:s}=t;const{el:i}=this.lower;i.classList.remove("lower-canvas"),i.removeAttribute("data-fabric"),i.setAttribute("width","".concat(e)),i.setAttribute("height","".concat(s)),i.style.cssText=this._originalCanvasStyle||"",this._originalCanvasStyle=void 0}setDimensions(t,e){const{el:s,ctx:i}=this.lower;ne(s,i,t,e)}setCSSDimensions(t){re(this.lower.el,t)}calcOffset(){return function(t){var e;const s=t&&se(t),i={left:0,top:0};if(!s)return i;const n=(null===(e=ie(t))||void 0===e?void 0:e.getComputedStyle(t,null))||{};i.left+=parseInt(n.borderLeftWidth,10)||0,i.top+=parseInt(n.borderTopWidth,10)||0,i.left+=parseInt(n.paddingLeft,10)||0,i.top+=parseInt(n.paddingTop,10)||0;let r={left:0,top:0};const o=s.documentElement;void 0!==t.getBoundingClientRect&&(r=t.getBoundingClientRect());const a=ee(t);return{left:r.left+a.left-(o.clientLeft||0)+i.left,top:r.top+a.top-(o.clientTop||0)+i.top}}(this.lower.el)}dispose(){x().dispose(this.lower.el),delete this.lower}}const le={backgroundVpt:!0,backgroundColor:"",overlayVpt:!0,overlayColor:"",includeDefaultValues:!0,svgViewportTransformation:!0,renderOnAddRemove:!0,skipOffscreen:!0,enableRetinaScaling:!0,imageSmoothingEnabled:!0,controlsAboveOverlay:!1,allowTouchScrolling:!1,viewportTransform:[...A]};class he extends(mt(_t)){get lowerCanvasEl(){var t;return null===(t=this.elements.lower)||void 0===t?void 0:t.el}get contextContainer(){var t;return null===(t=this.elements.lower)||void 0===t?void 0:t.ctx}static getDefaults(){return he.ownDefaults}constructor(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};super(),Object.assign(this,this.constructor.getDefaults()),this.set(e),this.initElements(t),this._setDimensionsImpl({width:this.width||this.elements.lower.el.width||0,height:this.height||this.elements.lower.el.height||0}),this.skipControlsDrawing=!1,this.viewportTransform=[...this.viewportTransform],this.calcViewportBoundaries()}initElements(t){this.elements=new ae(t)}add(){const t=super.add(...arguments);return arguments.length>0&&this.renderOnAddRemove&&this.requestRenderAll(),t}insertAt(t){for(var e=arguments.length,s=new Array(e>1?e-1:0),i=1;i<e;i++)s[i-1]=arguments[i];const n=super.insertAt(t,...s);return s.length>0&&this.renderOnAddRemove&&this.requestRenderAll(),n}remove(){const t=super.remove(...arguments);return t.length>0&&this.renderOnAddRemove&&this.requestRenderAll(),t}_onObjectAdded(t){t.canvas&&t.canvas!==this&&(f("warn","Canvas is trying to add an object that belongs to a different canvas.\nResulting to default behavior: removing object from previous canvas and adding to new canvas"),t.canvas.remove(t)),t._set("canvas",this),t.setCoords(),this.fire("object:added",{target:t}),t.fire("added",{target:this})}_onObjectRemoved(t){t._set("canvas",void 0),this.fire("object:removed",{target:t}),t.fire("removed",{target:this})}_onStackOrderChanged(){this.renderOnAddRemove&&this.requestRenderAll()}getRetinaScaling(){return this.enableRetinaScaling?T():1}calcOffset(){return this._offset=this.elements.calcOffset()}getWidth(){return this.width}getHeight(){return this.height}setWidth(t,e){return this.setDimensions({width:t},e)}setHeight(t,e){return this.setDimensions({height:t},e)}_setDimensionsImpl(t){let{cssOnly:e=!1,backstoreOnly:s=!1}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(!e){const e=c({width:this.width,height:this.height},t);this.elements.setDimensions(e,this.getRetinaScaling()),this.hasLostContext=!0,this.width=e.width,this.height=e.height}s||this.elements.setCSSDimensions(t),this.calcOffset()}setDimensions(t,e){this._setDimensionsImpl(t,e),e&&e.cssOnly||this.requestRenderAll()}getZoom(){return this.viewportTransform[0]}setViewportTransform(t){this.viewportTransform=t,this.calcViewportBoundaries(),this.renderOnAddRemove&&this.requestRenderAll()}zoomToPoint(t,e){const s=t,i=[...this.viewportTransform],n=It(t,Pt(i));i[0]=e,i[3]=e;const r=It(n,i);i[4]+=s.x-r.x,i[5]+=s.y-r.y,this.setViewportTransform(i)}setZoom(t){this.zoomToPoint(new gt(0,0),t)}absolutePan(t){const e=[...this.viewportTransform];return e[4]=-t.x,e[5]=-t.y,this.setViewportTransform(e)}relativePan(t){return this.absolutePan(new gt(-t.x-this.viewportTransform[4],-t.y-this.viewportTransform[5]))}getElement(){return this.elements.lower.el}clearContext(t){t.clearRect(0,0,this.width,this.height)}getContext(){return this.elements.lower.ctx}clear(){this.remove(...this.getObjects()),this.backgroundImage=void 0,this.overlayImage=void 0,this.backgroundColor="",this.overlayColor="",this.clearContext(this.getContext()),this.fire("canvas:cleared"),this.renderOnAddRemove&&this.requestRenderAll()}renderAll(){this.cancelRequestedRender(),this.destroyed||this.renderCanvas(this.getContext(),this._objects)}renderAndReset(){this.nextRenderHandle=0,this.renderAll()}requestRenderAll(){this.nextRenderHandle||this.disposed||this.destroyed||(this.nextRenderHandle=vt((()=>this.renderAndReset())))}calcViewportBoundaries(){const t=this.width,e=this.height,s=Pt(this.viewportTransform),i=It({x:0,y:0},s),n=It({x:t,y:e},s),r=i.min(n),o=i.max(n);return this.vptCoords={tl:r,tr:new gt(o.x,r.y),bl:new gt(r.x,o.y),br:o}}cancelRequestedRender(){this.nextRenderHandle&&(yt(this.nextRenderHandle),this.nextRenderHandle=0)}drawControls(t){}renderCanvas(t,e){if(this.destroyed)return;const s=this.viewportTransform,i=this.clipPath;this.calcViewportBoundaries(),this.clearContext(t),t.imageSmoothingEnabled=this.imageSmoothingEnabled,t.patternQuality="best",this.fire("before:render",{ctx:t}),this._renderBackground(t),t.save(),t.transform(s[0],s[1],s[2],s[3],s[4],s[5]),this._renderObjects(t,e),t.restore(),this.controlsAboveOverlay||this.skipControlsDrawing||this.drawControls(t),i&&(i._set("canvas",this),i.shouldCache(),i._transformDone=!0,i.renderCache({forClipping:!0}),this.drawClipPathOnCanvas(t,i)),this._renderOverlay(t),this.controlsAboveOverlay&&!this.skipControlsDrawing&&this.drawControls(t),this.fire("after:render",{ctx:t}),this.__cleanupTask&&(this.__cleanupTask(),this.__cleanupTask=void 0)}drawClipPathOnCanvas(t,e){const s=this.viewportTransform;t.save(),t.transform(...s),t.globalCompositeOperation="destination-in",e.transform(t),t.scale(1/e.zoomX,1/e.zoomY),t.drawImage(e._cacheCanvas,-e.cacheTranslationX,-e.cacheTranslationY),t.restore()}_renderObjects(t,e){for(let s=0,i=e.length;s<i;++s)e[s]&&e[s].render(t)}_renderBackgroundOrOverlay(t,e){const s=this["".concat(e,"Color")],i=this["".concat(e,"Image")],n=this.viewportTransform,r=this["".concat(e,"Vpt")];if(!s&&!i)return;const o=Qt(s);if(s){if(t.save(),t.beginPath(),t.moveTo(0,0),t.lineTo(this.width,0),t.lineTo(this.width,this.height),t.lineTo(0,this.height),t.closePath(),t.fillStyle=o?s.toLive(t):s,r&&t.transform(...n),o){t.transform(1,0,0,1,s.offsetX||0,s.offsetY||0);const e=s.gradientTransform||s.patternTransform;e&&t.transform(...e)}t.fill(),t.restore()}if(i){t.save();const{skipOffscreen:e}=this;this.skipOffscreen=r,r&&t.transform(...n),i.render(t),this.skipOffscreen=e,t.restore()}}_renderBackground(t){this._renderBackgroundOrOverlay(t,"background")}_renderOverlay(t){this._renderBackgroundOrOverlay(t,"overlay")}getCenter(){return{top:this.height/2,left:this.width/2}}getCenterPoint(){return new gt(this.width/2,this.height/2)}centerObjectH(t){return this._centerObject(t,new gt(this.getCenterPoint().x,t.getCenterPoint().y))}centerObjectV(t){return this._centerObject(t,new gt(t.getCenterPoint().x,this.getCenterPoint().y))}centerObject(t){return this._centerObject(t,this.getCenterPoint())}viewportCenterObject(t){return this._centerObject(t,this.getVpCenter())}viewportCenterObjectH(t){return this._centerObject(t,new gt(this.getVpCenter().x,t.getCenterPoint().y))}viewportCenterObjectV(t){return this._centerObject(t,new gt(t.getCenterPoint().x,this.getVpCenter().y))}getVpCenter(){return It(this.getCenterPoint(),Pt(this.viewportTransform))}_centerObject(t,e){t.setXY(e,L,L),t.setCoords(),this.renderOnAddRemove&&this.requestRenderAll()}toDatalessJSON(t){return this.toDatalessObject(t)}toObject(t){return this._toObjectMethod("toObject",t)}toJSON(){return this.toObject()}toDatalessObject(t){return this._toObjectMethod("toDatalessObject",t)}_toObjectMethod(t,e){const s=this.clipPath,i=s&&!s.excludeFromExport?this._toObject(s,t,e):null;return c(c(c({version:O},Ut(this,e)),{},{objects:this._objects.filter((t=>!t.excludeFromExport)).map((s=>this._toObject(s,t,e)))},this.__serializeBgOverlay(t,e)),i?{clipPath:i}:null)}_toObject(t,e,s){let i;this.includeDefaultValues||(i=t.includeDefaultValues,t.includeDefaultValues=!1);const n=t[e](s);return this.includeDefaultValues||(t.includeDefaultValues=!!i),n}__serializeBgOverlay(t,e){const s={},i=this.backgroundImage,n=this.overlayImage,r=this.backgroundColor,o=this.overlayColor;return Qt(r)?r.excludeFromExport||(s.background=r.toObject(e)):r&&(s.background=r),Qt(o)?o.excludeFromExport||(s.overlay=o.toObject(e)):o&&(s.overlay=o),i&&!i.excludeFromExport&&(s.backgroundImage=this._toObject(i,t,e)),n&&!n.excludeFromExport&&(s.overlayImage=this._toObject(n,t,e)),s}toSVG(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},e=arguments.length>1?arguments[1]:void 0;t.reviver=e;const s=[];return this._setSVGPreamble(s,t),this._setSVGHeader(s,t),this.clipPath&&s.push('<g clip-path="url(#'.concat(this.clipPath.clipPathId,')" >\n')),this._setSVGBgOverlayColor(s,"background"),this._setSVGBgOverlayImage(s,"backgroundImage",e),this._setSVGObjects(s,e),this.clipPath&&s.push("</g>\n"),this._setSVGBgOverlayColor(s,"overlay"),this._setSVGBgOverlayImage(s,"overlayImage",e),s.push("</svg>"),s.join("")}_setSVGPreamble(t,e){e.suppressPreamble||t.push('<?xml version="1.0" encoding="',e.encoding||"UTF-8",'" standalone="no" ?>\n','<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN" ','"http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">\n')}_setSVGHeader(t,e){const s=e.width||"".concat(this.width),i=e.height||"".concat(this.height),n=p.NUM_FRACTION_DIGITS,r=e.viewBox;let o;if(r)o='viewBox="'.concat(r.x," ").concat(r.y," ").concat(r.width," ").concat(r.height,'" ');else if(this.svgViewportTransformation){const t=this.viewportTransform;o='viewBox="'.concat(Kt(-t[4]/t[0],n)," ").concat(Kt(-t[5]/t[3],n)," ").concat(Kt(this.width/t[0],n)," ").concat(Kt(this.height/t[3],n),'" ')}else o='viewBox="0 0 '.concat(this.width," ").concat(this.height,'" ');t.push("<svg ",'xmlns="http://www.w3.org/2000/svg" ','xmlns:xlink="http://www.w3.org/1999/xlink" ','version="1.1" ','width="',s,'" ','height="',i,'" ',o,'xml:space="preserve">\n',"<desc>Created with Fabric.js ",O,"</desc>\n","<defs>\n",this.createSVGFontFacesMarkup(),this.createSVGRefElementsMarkup(),this.createSVGClipPathMarkup(e),"</defs>\n")}createSVGClipPathMarkup(t){const e=this.clipPath;return e?(e.clipPathId="CLIPPATH_".concat(Ct()),'<clipPath id="'.concat(e.clipPathId,'" >\n').concat(e.toClipPathSVG(t.reviver),"</clipPath>\n")):""}createSVGRefElementsMarkup(){return["background","overlay"].map((t=>{const e=this["".concat(t,"Color")];if(Qt(e)){const s=this["".concat(t,"Vpt")],i=this.viewportTransform,n={isType:()=>!1,width:this.width/(s?i[0]:1),height:this.height/(s?i[3]:1)};return e.toSVG(n,{additionalTransform:s?$t(i):""})}})).join("")}createSVGFontFacesMarkup(){const t=[],e={},s=p.fontPaths;this._objects.forEach((function e(s){t.push(s),ft(s)&&s._objects.forEach(e)})),t.forEach((t=>{if(!(i=t)||"function"!=typeof i._renderText)return;var i;const{styles:n,fontFamily:r}=t;!e[r]&&s[r]&&(e[r]=!0,n&&Object.values(n).forEach((t=>{Object.values(t).forEach((t=>{let{fontFamily:i=""}=t;!e[i]&&s[i]&&(e[i]=!0)}))})))}));const i=Object.keys(e).map((t=>"\t\t@font-face {\n\t\t\tfont-family: '".concat(t,"';\n\t\t\tsrc: url('").concat(s[t],"');\n\t\t}\n"))).join("");return i?'\t<style type="text/css"><![CDATA[\n'.concat(i,"]]></style>\n"):""}_setSVGObjects(t,e){this.forEachObject((s=>{s.excludeFromExport||this._setSVGObject(t,s,e)}))}_setSVGObject(t,e,s){t.push(e.toSVG(s))}_setSVGBgOverlayImage(t,e,s){const i=this[e];i&&!i.excludeFromExport&&i.toSVG&&t.push(i.toSVG(s))}_setSVGBgOverlayColor(t,e){const s=this["".concat(e,"Color")];if(s)if(Qt(s)){const i=s.repeat||"",n=this.width,r=this.height,o=this["".concat(e,"Vpt")]?$t(Pt(this.viewportTransform)):"";t.push('<rect transform="'.concat(o," translate(").concat(n/2,",").concat(r/2,')" x="').concat(s.offsetX-n/2,'" y="').concat(s.offsetY-r/2,'" width="').concat("repeat-y"!==i&&"no-repeat"!==i||!Zt(s)?n:s.source.width,'" height="').concat("repeat-x"!==i&&"no-repeat"!==i||!Zt(s)?r:s.source.height,'" fill="url(#SVGID_').concat(s.id,')"></rect>\n'))}else t.push('<rect x="0" y="0" width="100%" height="100%" ','fill="',s,'"',"></rect>\n")}loadFromJSON(t,e){let{signal:s}=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};if(!t)return Promise.reject(new m("`json` is undefined"));const i="string"==typeof t?JSON.parse(t):t,{objects:n=[],backgroundImage:r,background:o,overlayImage:a,overlay:l,clipPath:h}=i,c=this.renderOnAddRemove;return this.renderOnAddRemove=!1,Promise.all([zt(n,{reviver:e,signal:s}),Gt({backgroundImage:r,backgroundColor:o,overlayImage:a,overlayColor:l,clipPath:h},{signal:s})]).then((t=>{let[e,s]=t;return this.clear(),this.add(...e),this.set(i),this.set(s),this.renderOnAddRemove=c,this}))}clone(t){const e=this.toObject(t);return this.cloneWithoutData().loadFromJSON(e)}cloneWithoutData(){const t=St(this);return new this.constructor(t)}toDataURL(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};const{format:e="png",quality:s=1,multiplier:i=1,enableRetinaScaling:n=!1}=t,r=i*(n?this.getRetinaScaling():1);return Tt(this.toCanvasElement(r,t),e,s)}toBlob(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};const{format:e="png",quality:s=1,multiplier:i=1,enableRetinaScaling:n=!1}=t,r=i*(n?this.getRetinaScaling():1);return kt(this.toCanvasElement(r,t),e,s)}toCanvasElement(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,{width:e,height:s,left:i,top:n,filter:r}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const o=(e||this.width)*t,a=(s||this.height)*t,l=this.getZoom(),h=this.width,c=this.height,u=this.skipControlsDrawing,d=l*t,g=this.viewportTransform,p=[d,0,0,d,(g[4]-(i||0))*t,(g[5]-(n||0))*t],f=this.enableRetinaScaling,m=St({width:o,height:a}),_=r?this._objects.filter((t=>r(t))):this._objects;return this.enableRetinaScaling=!1,this.viewportTransform=p,this.width=o,this.height=a,this.skipControlsDrawing=!0,this.calcViewportBoundaries(),this.renderCanvas(m.getContext("2d"),_),this.viewportTransform=g,this.width=h,this.height=c,this.calcViewportBoundaries(),this.enableRetinaScaling=f,this.skipControlsDrawing=u,m}dispose(){return!this.disposed&&this.elements.cleanupDOM({width:this.width,height:this.height}),lt.cancelByCanvas(this),this.disposed=!0,new Promise(((t,e)=>{const s=()=>{this.destroy(),t(!0)};s.kill=e,this.__cleanupTask&&this.__cleanupTask.kill("aborted"),this.destroyed?t(!1):this.nextRenderHandle?this.__cleanupTask=s:s()}))}destroy(){this.destroyed=!0,this.cancelRequestedRender(),this.forEachObject((t=>t.dispose())),this._objects=[],this.backgroundImage&&this.backgroundImage.dispose(),this.backgroundImage=void 0,this.overlayImage&&this.overlayImage.dispose(),this.overlayImage=void 0,this.elements.dispose()}toString(){return"#<Canvas (".concat(this.complexity(),"): { objects: ").concat(this._objects.length," }>")}}l(he,"ownDefaults",le);const ce=["touchstart","touchmove","touchend"],ue=t=>{const e=ee(t.target),s=function(t){const e=t.changedTouches;return e&&e[0]?e[0]:t}(t);return new gt(s.clientX+e.left,s.clientY+e.top)},de=t=>ce.includes(t.type)||"touch"===t.pointerType,ge=t=>{t.preventDefault(),t.stopPropagation()},pe=t=>{let e=0,s=0,i=0,n=0;for(let r=0,o=t.length;r<o;r++){const{x:o,y:a}=t[r];(o>i||!r)&&(i=o),(o<e||!r)&&(e=o),(a>n||!r)&&(n=a),(a<s||!r)&&(s=a)}return{left:e,top:s,width:i-e,height:n-s}},fe=["translateX","translateY","scaleX","scaleY"],me=(t,e)=>_e(t,At(e,t.calcOwnMatrix())),_e=(t,e)=>{const s=Lt(e),{translateX:i,translateY:n,scaleX:r,scaleY:o}=s,a=u(s,fe),l=new gt(i,n);t.flipX=!1,t.flipY=!1,Object.assign(t,a),t.set({scaleX:r,scaleY:o}),t.setPositionByOrigin(l,L,L)},ve=t=>{t.scaleX=1,t.scaleY=1,t.skewX=0,t.skewY=0,t.flipX=!1,t.flipY=!1,t.rotate(0)},ye=t=>({scaleX:t.scaleX,scaleY:t.scaleY,skewX:t.skewX,skewY:t.skewY,angle:t.angle,left:t.left,flipX:t.flipX,flipY:t.flipY,top:t.top}),be=(t,e,s)=>{const i=t/2,n=e/2,r=[new gt(-i,-n),new gt(i,-n),new gt(-i,n),new gt(i,n)].map((t=>t.transform(s))),o=pe(r);return new gt(o.width,o.height)},Ce=function(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:A;return At(Pt(arguments.length>1&&void 0!==arguments[1]?arguments[1]:A),t)},xe=function(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:A,s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:A;return t.transform(Ce(e,s))},we=function(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:A,s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:A;return t.transform(Ce(e,s),!0)},Se=(t,e,s)=>{const i=Ce(e,s);return _e(t,At(i,t.calcOwnMatrix())),i},Te=(t,e)=>{var s;const{transform:{target:i}}=e;null===(s=i.canvas)||void 0===s||s.fire("object:".concat(t),c(c({},e),{},{target:i})),i.fire(t,e)},ke={left:-.5,top:-.5,center:0,bottom:.5,right:.5},Oe=t=>"string"==typeof t?ke[t]:t-.5,Ee="not-allowed";function De(t){return Oe(t.originX)===Oe(L)&&Oe(t.originY)===Oe(L)}function Ie(t){return.5-Oe(t)}const Pe=(t,e)=>t[e],Ae=(t,e,s,i)=>({e:t,transform:e,pointer:new gt(s,i)});function Me(t,e){const s=t.getTotalAngle()+Et(Math.atan2(e.y,e.x))+360;return Math.round(s%360/45)}function Re(t,e,s,i,n){var r;let{target:o,corner:a}=t;const l=o.controls[a],h=(null===(r=o.canvas)||void 0===r?void 0:r.getZoom())||1,c=o.padding/h,u=function(t,e,s,i){const n=t.getRelativeCenterPoint(),r=void 0!==s&&void 0!==i?t.translateToGivenOrigin(n,L,L,s,i):new gt(t.left,t.top);return(t.angle?e.rotate(-Ot(t.angle),n):e).subtract(r)}(o,new gt(i,n),e,s);return u.x>=c&&(u.x-=c),u.x<=-c&&(u.x+=c),u.y>=c&&(u.y-=c),u.y<=c&&(u.y+=c),u.x-=l.offsetX,u.y-=l.offsetY,u}const Le=(t,e,s,i)=>{const{target:n,offsetX:r,offsetY:o}=e,a=s-r,l=i-o,h=!Pe(n,"lockMovementX")&&n.left!==a,c=!Pe(n,"lockMovementY")&&n.top!==l;return h&&n.set(F,a),c&&n.set(j,l),(h||c)&&Te(Y,Ae(t,e,s,i)),h||c},Fe={aliceblue:"#F0F8FF",antiquewhite:"#FAEBD7",aqua:"#0FF",aquamarine:"#7FFFD4",azure:"#F0FFFF",beige:"#F5F5DC",bisque:"#FFE4C4",black:"#000",blanchedalmond:"#FFEBCD",blue:"#00F",blueviolet:"#8A2BE2",brown:"#A52A2A",burlywood:"#DEB887",cadetblue:"#5F9EA0",chartreuse:"#7FFF00",chocolate:"#D2691E",coral:"#FF7F50",cornflowerblue:"#6495ED",cornsilk:"#FFF8DC",crimson:"#DC143C",cyan:"#0FF",darkblue:"#00008B",darkcyan:"#008B8B",darkgoldenrod:"#B8860B",darkgray:"#A9A9A9",darkgrey:"#A9A9A9",darkgreen:"#006400",darkkhaki:"#BDB76B",darkmagenta:"#8B008B",darkolivegreen:"#556B2F",darkorange:"#FF8C00",darkorchid:"#9932CC",darkred:"#8B0000",darksalmon:"#E9967A",darkseagreen:"#8FBC8F",darkslateblue:"#483D8B",darkslategray:"#2F4F4F",darkslategrey:"#2F4F4F",darkturquoise:"#00CED1",darkviolet:"#9400D3",deeppink:"#FF1493",deepskyblue:"#00BFFF",dimgray:"#696969",dimgrey:"#696969",dodgerblue:"#1E90FF",firebrick:"#B22222",floralwhite:"#FFFAF0",forestgreen:"#228B22",fuchsia:"#F0F",gainsboro:"#DCDCDC",ghostwhite:"#F8F8FF",gold:"#FFD700",goldenrod:"#DAA520",gray:"#808080",grey:"#808080",green:"#008000",greenyellow:"#ADFF2F",honeydew:"#F0FFF0",hotpink:"#FF69B4",indianred:"#CD5C5C",indigo:"#4B0082",ivory:"#FFFFF0",khaki:"#F0E68C",lavender:"#E6E6FA",lavenderblush:"#FFF0F5",lawngreen:"#7CFC00",lemonchiffon:"#FFFACD",lightblue:"#ADD8E6",lightcoral:"#F08080",lightcyan:"#E0FFFF",lightgoldenrodyellow:"#FAFAD2",lightgray:"#D3D3D3",lightgrey:"#D3D3D3",lightgreen:"#90EE90",lightpink:"#FFB6C1",lightsalmon:"#FFA07A",lightseagreen:"#20B2AA",lightskyblue:"#87CEFA",lightslategray:"#789",lightslategrey:"#789",lightsteelblue:"#B0C4DE",lightyellow:"#FFFFE0",lime:"#0F0",limegreen:"#32CD32",linen:"#FAF0E6",magenta:"#F0F",maroon:"#800000",mediumaquamarine:"#66CDAA",mediumblue:"#0000CD",mediumorchid:"#BA55D3",mediumpurple:"#9370DB",mediumseagreen:"#3CB371",mediumslateblue:"#7B68EE",mediumspringgreen:"#00FA9A",mediumturquoise:"#48D1CC",mediumvioletred:"#C71585",midnightblue:"#191970",mintcream:"#F5FFFA",mistyrose:"#FFE4E1",moccasin:"#FFE4B5",navajowhite:"#FFDEAD",navy:"#000080",oldlace:"#FDF5E6",olive:"#808000",olivedrab:"#6B8E23",orange:"#FFA500",orangered:"#FF4500",orchid:"#DA70D6",palegoldenrod:"#EEE8AA",palegreen:"#98FB98",paleturquoise:"#AFEEEE",palevioletred:"#DB7093",papayawhip:"#FFEFD5",peachpuff:"#FFDAB9",peru:"#CD853F",pink:"#FFC0CB",plum:"#DDA0DD",powderblue:"#B0E0E6",purple:"#800080",rebeccapurple:"#639",red:"#F00",rosybrown:"#BC8F8F",royalblue:"#4169E1",saddlebrown:"#8B4513",salmon:"#FA8072",sandybrown:"#F4A460",seagreen:"#2E8B57",seashell:"#FFF5EE",sienna:"#A0522D",silver:"#C0C0C0",skyblue:"#87CEEB",slateblue:"#6A5ACD",slategray:"#708090",slategrey:"#708090",snow:"#FFFAFA",springgreen:"#00FF7F",steelblue:"#4682B4",tan:"#D2B48C",teal:"#008080",thistle:"#D8BFD8",tomato:"#FF6347",turquoise:"#40E0D0",violet:"#EE82EE",wheat:"#F5DEB3",white:"#FFF",whitesmoke:"#F5F5F5",yellow:"#FF0",yellowgreen:"#9ACD32"},je=(t,e,s)=>(s<0&&(s+=1),s>1&&(s-=1),s<1/6?t+6*(e-t)*s:s<.5?e:s<2/3?t+(e-t)*(2/3-s)*6:t),Ne=(t,e,s,i)=>{t/=255,e/=255,s/=255;const n=Math.max(t,e,s),r=Math.min(t,e,s);let o,a;const l=(n+r)/2;if(n===r)o=a=0;else{const i=n-r;switch(a=l>.5?i/(2-n-r):i/(n+r),n){case t:o=(e-s)/i+(e<s?6:0);break;case e:o=(s-t)/i+2;break;case s:o=(t-e)/i+4}o/=6}return[Math.round(360*o),Math.round(100*a),Math.round(100*l),i]},Be=function(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"1";return parseFloat(t)/(t.endsWith("%")?100:1)},We=t=>Math.min(Math.round(t),255).toString(16).toUpperCase().padStart(2,"0"),Xe=t=>{let[e,s,i,n=1]=t;const r=Math.round(.3*e+.59*s+.11*i);return[r,r,r,n]};class Ye{constructor(t){if(l(this,"isUnrecognised",!1),t)if(t instanceof Ye)this.setSource([...t._source]);else if(Array.isArray(t)){const[e,s,i,n=1]=t;this.setSource([e,s,i,n])}else this.setSource(this._tryParsingColor(t));else this.setSource([0,0,0,1])}_tryParsingColor(t){return(t=t.toLowerCase())in Fe&&(t=Fe[t]),"transparent"===t?[255,255,255,0]:Ye.sourceFromHex(t)||Ye.sourceFromRgb(t)||Ye.sourceFromHsl(t)||(this.isUnrecognised=!0)&&[0,0,0,1]}getSource(){return this._source}setSource(t){this._source=t}toRgb(){const[t,e,s]=this.getSource();return"rgb(".concat(t,",").concat(e,",").concat(s,")")}toRgba(){return"rgba(".concat(this.getSource().join(","),")")}toHsl(){const[t,e,s]=Ne(...this.getSource());return"hsl(".concat(t,",").concat(e,"%,").concat(s,"%)")}toHsla(){const[t,e,s,i]=Ne(...this.getSource());return"hsla(".concat(t,",").concat(e,"%,").concat(s,"%,").concat(i,")")}toHex(){return this.toHexa().slice(0,6)}toHexa(){const[t,e,s,i]=this.getSource();return"".concat(We(t)).concat(We(e)).concat(We(s)).concat(We(Math.round(255*i)))}getAlpha(){return this.getSource()[3]}setAlpha(t){return this._source[3]=t,this}toGrayscale(){return this.setSource(Xe(this.getSource())),this}toBlackWhite(t){const[e,,,s]=Xe(this.getSource()),i=e<(t||127)?0:255;return this.setSource([i,i,i,s]),this}overlayWith(t){t instanceof Ye||(t=new Ye(t));const e=this.getSource(),s=t.getSource(),[i,n,r]=e.map(((t,e)=>Math.round(.5*t+.5*s[e])));return this.setSource([i,n,r,e[3]]),this}static fromRgb(t){return Ye.fromRgba(t)}static fromRgba(t){return new Ye(Ye.sourceFromRgb(t))}static sourceFromRgb(t){const e=t.match(/^rgba?\(\s*(\d{0,3}(?:\.\d+)?%?)\s*[\s|,]\s*(\d{0,3}(?:\.\d+)?%?)\s*[\s|,]\s*(\d{0,3}(?:\.\d+)?%?)\s*(?:\s*[,/]\s*(\d{0,3}(?:\.\d+)?%?)\s*)?\)$/i);if(e){const[t,s,i]=e.slice(1,4).map((t=>{const e=parseFloat(t);return t.endsWith("%")?Math.round(2.55*e):e}));return[t,s,i,Be(e[4])]}}static fromHsl(t){return Ye.fromHsla(t)}static fromHsla(t){return new Ye(Ye.sourceFromHsl(t))}static sourceFromHsl(t){const e=t.match(/^hsla?\(\s*([+-]?\d{0,3}(?:\.\d+)?(?:deg|turn|rad)?)\s*[\s|,]\s*(\d{0,3}(?:\.\d+)?%?)\s*[\s|,]\s*(\d{0,3}(?:\.\d+)?%?)\s*(?:\s*[,/]\s*(\d*(?:\.\d+)?%?)\s*)?\)$/i);if(!e)return;const s=(Ye.parseAngletoDegrees(e[1])%360+360)%360/360,i=parseFloat(e[2])/100,n=parseFloat(e[3])/100;let r,o,a;if(0===i)r=o=a=n;else{const t=n<=.5?n*(i+1):n+i-n*i,e=2*n-t;r=je(e,t,s+1/3),o=je(e,t,s),a=je(e,t,s-1/3)}return[Math.round(255*r),Math.round(255*o),Math.round(255*a),Be(e[4])]}static fromHex(t){return new Ye(Ye.sourceFromHex(t))}static sourceFromHex(t){if(t.match(/^#?(([0-9a-f]){3,4}|([0-9a-f]{2}){3,4})$/i)){const e=t.slice(t.indexOf("#")+1);let s;s=e.length<=4?e.split("").map((t=>t+t)):e.match(/.{2}/g);const[i,n,r,o=255]=s.map((t=>parseInt(t,16)));return[i,n,r,o/255]}}static parseAngletoDegrees(t){const e=t.toLowerCase(),s=parseFloat(e);return e.includes("rad")?Et(s):e.includes("turn")?360*s:s}}const Ve=function(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:M;const s=/\D{0,2}$/.exec(t),i=parseFloat(t),n=p.DPI;switch(null==s?void 0:s[0]){case"mm":return i*n/25.4;case"cm":return i*n/2.54;case"in":return i*n;case"pt":return i*n/72;case"pc":return i*n/72*12;case"em":return i*e;default:return i}},He=t=>{const[e,s]=t.trim().split(" "),[i,n]=(r=e)&&r!==W?[r.slice(1,4),r.slice(5,8)]:r===W?[r,r]:["Mid","Mid"];var r;return{meetOrSlice:s||"meet",alignX:i,alignY:n}},ze=function(t,e){let s,i,n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];if(e)if(e.toLive)s="url(#SVGID_".concat(e.id,")");else{const t=new Ye(e),n=t.getAlpha();s=t.toRgb(),1!==n&&(i=n.toString())}else s="none";return n?"".concat(t,": ").concat(s,"; ").concat(i?"".concat(t,"-opacity: ").concat(i,"; "):""):"".concat(t,'="').concat(s,'" ').concat(i?"".concat(t,'-opacity="').concat(i,'" '):"")};class Ge{getSvgStyles(t){const e=this.fillRule?this.fillRule:"nonzero",s=this.strokeWidth?this.strokeWidth:"0",i=this.strokeDashArray?this.strokeDashArray.join(" "):W,n=this.strokeDashOffset?this.strokeDashOffset:"0",r=this.strokeLineCap?this.strokeLineCap:"butt",o=this.strokeLineJoin?this.strokeLineJoin:"miter",a=this.strokeMiterLimit?this.strokeMiterLimit:"4",l=void 0!==this.opacity?this.opacity:"1",h=this.visible?"":" visibility: hidden;",c=t?"":this.getSvgFilter(),u=ze(st,this.fill);return[ze(it,this.stroke),"stroke-width: ",s,"; ","stroke-dasharray: ",i,"; ","stroke-linecap: ",r,"; ","stroke-dashoffset: ",n,"; ","stroke-linejoin: ",o,"; ","stroke-miterlimit: ",a,"; ",u,"fill-rule: ",e,"; ","opacity: ",l,";",c,h].join("")}getSvgFilter(){return this.shadow?"filter: url(#SVGID_".concat(this.shadow.id,");"):""}getSvgCommons(){return[this.id?'id="'.concat(this.id,'" '):"",this.clipPath?'clip-path="url(#'.concat(this.clipPath.clipPathId,')" '):""].join("")}getSvgTransform(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";const s=t?this.calcTransformMatrix():this.calcOwnMatrix(),i='transform="'.concat($t(s));return"".concat(i).concat(e,'" ')}_toSVG(t){return[""]}toSVG(t){return this._createBaseSVGMarkup(this._toSVG(t),{reviver:t})}toClipPathSVG(t){return"\t"+this._createBaseClipPathSVGMarkup(this._toSVG(t),{reviver:t})}_createBaseClipPathSVGMarkup(t){let{reviver:e,additionalTransform:s=""}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const i=[this.getSvgTransform(!0,s),this.getSvgCommons()].join(""),n=t.indexOf("COMMON_PARTS");return t[n]=i,e?e(t.join("")):t.join("")}_createBaseSVGMarkup(t){let{noStyle:e,reviver:s,withShadow:i,additionalTransform:n}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const r=e?"":'style="'.concat(this.getSvgStyles(),'" '),o=i?'style="'.concat(this.getSvgFilter(),'" '):"",a=this.clipPath,l=this.strokeUniform?'vector-effect="non-scaling-stroke" ':"",h=a&&a.absolutePositioned,c=this.stroke,u=this.fill,d=this.shadow,g=[],p=t.indexOf("COMMON_PARTS");let f;a&&(a.clipPathId="CLIPPATH_".concat(Ct()),f='<clipPath id="'.concat(a.clipPathId,'" >\n').concat(a.toClipPathSVG(s),"</clipPath>\n")),h&&g.push("<g ",o,this.getSvgCommons()," >\n"),g.push("<g ",this.getSvgTransform(!1),h?"":o+this.getSvgCommons()," >\n");const m=[r,l,e?"":this.addPaintOrder()," ",n?'transform="'.concat(n,'" '):""].join("");return t[p]=m,Qt(u)&&g.push(u.toSVG(this)),Qt(c)&&g.push(c.toSVG(this)),d&&g.push(d.toSVG(this)),a&&g.push(f),g.push(t.join("")),g.push("</g>\n"),h&&g.push("</g>\n"),s?s(g.join("")):g.join("")}addPaintOrder(){return this.paintFirst!==st?' paint-order="'.concat(this.paintFirst,'" '):""}}function Ue(t){return new RegExp("^("+t.join("|")+")\\b","i")}const qe="textDecorationThickness",Ke=["fontSize","fontWeight","fontFamily","fontStyle"],$e=["underline","overline","linethrough"],Qe=[...Ke,"lineHeight","text","charSpacing","textAlign","styles","path","pathStartOffset","pathSide","pathAlign"],Je=[...Qe,...$e,"textBackgroundColor","direction",qe],Ze=[...Ke,...$e,it,"strokeWidth",st,"deltaY","textBackgroundColor",qe],ts={_reNewline:X,_reSpacesAndTabs:/[ \t\r]/g,_reSpaceAndTab:/[ \t\r]/,_reWords:/\S+/g,fontSize:40,fontWeight:"normal",fontFamily:"Times New Roman",underline:!1,overline:!1,linethrough:!1,textAlign:F,fontStyle:"normal",lineHeight:1.16,textBackgroundColor:"",stroke:null,shadow:null,path:void 0,pathStartOffset:0,pathSide:F,pathAlign:"baseline",charSpacing:0,deltaY:0,direction:"ltr",CACHE_FONT_SIZE:400,MIN_TEXT_WIDTH:2,superscript:{size:.6,baseline:-.35},subscript:{size:.6,baseline:.11},_fontSizeFraction:.222,offsets:{underline:.1,linethrough:-.28167,overline:-.81333},_fontSizeMult:1.13,[qe]:66.667},es="justify",ss="justify-left",is="justify-right",ns="justify-center";var rs,os,as;const ls=String.raw(rs||(rs=d(["[-+]?(?:d*.d+|d+.?)(?:[eE][-+]?d+)?"],["[-+]?(?:\\d*\\.\\d+|\\d+\\.?)(?:[eE][-+]?\\d+)?"]))),hs=String.raw(os||(os=d(["(?:s*,?s+|s*,s*)"],["(?:\\s*,?\\s+|\\s*,\\s*)"]))),cs="http://www.w3.org/2000/svg",us=new RegExp("(normal|italic)?\\s*(normal|small-caps)?\\s*(normal|bold|bolder|lighter|100|200|300|400|500|600|700|800|900)?\\s*("+ls+"(?:px|cm|mm|em|pt|pc|in)*)(?:\\/(normal|"+ls+"))?\\s+(.*)"),ds={cx:F,x:F,r:"radius",cy:j,y:j,display:"visible",visibility:"visible",transform:"transformMatrix","fill-opacity":"fillOpacity","fill-rule":"fillRule","font-family":"fontFamily","font-size":"fontSize","font-style":"fontStyle","font-weight":"fontWeight","letter-spacing":"charSpacing","paint-order":"paintFirst","stroke-dasharray":"strokeDashArray","stroke-dashoffset":"strokeDashOffset","stroke-linecap":"strokeLineCap","stroke-linejoin":"strokeLineJoin","stroke-miterlimit":"strokeMiterLimit","stroke-opacity":"strokeOpacity","stroke-width":"strokeWidth","text-decoration":"textDecoration","text-anchor":"textAnchor",opacity:"opacity","clip-path":"clipPath","clip-rule":"clipRule","vector-effect":"strokeUniform","image-rendering":"imageSmoothing","text-decoration-thickness":qe},gs="font-size",ps="clip-path",fs=Ue(["path","circle","polygon","polyline","ellipse","rect","line","image","text"]),ms=Ue(["symbol","image","marker","pattern","view","svg"]),_s=Ue(["symbol","g","a","svg","clipPath","defs"]),vs=new RegExp(String.raw(as||(as=d(["^s*(",")","(",")","(",")","(",")s*$"],["^\\s*(",")","(",")","(",")","(",")\\s*$"])),ls,hs,ls,hs,ls,hs,ls)),ys=new gt(1,0),bs=new gt,Cs=(t,e)=>t.rotate(e),xs=(t,e)=>new gt(e).subtract(t),ws=t=>t.distanceFrom(bs),Ss=(t,e)=>Math.atan2(Es(t,e),Ds(t,e)),Ts=t=>Ss(ys,t),ks=t=>t.eq(bs)?t:t.scalarDivide(ws(t)),Os=function(t){let e=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];return ks(new gt(-t.y,t.x).scalarMultiply(e?1:-1))},Es=(t,e)=>t.x*e.y-t.y*e.x,Ds=(t,e)=>t.x*e.x+t.y*e.y,Is=(t,e,s)=>{if(t.eq(e)||t.eq(s))return!0;const i=Es(e,s),n=Es(e,t),r=Es(s,t);return i>=0?n>=0&&r<=0:!(n<=0&&r>=0)},Ps="(-?\\d+(?:\\.\\d*)?(?:px)?(?:\\s?|$))?",As=new RegExp("(?:\\s|^)"+Ps+Ps+"("+ls+"?(?:px)?)?(?:\\s?|$)(?:$|\\s)");class Ms{constructor(t){const e="string"==typeof t?Ms.parseShadow(t):t;Object.assign(this,Ms.ownDefaults,e),this.id=Ct()}static parseShadow(t){const e=t.trim(),[,s=0,i=0,n=0]=(As.exec(e)||[]).map((t=>parseFloat(t)||0));return{color:(e.replace(As,"")||"rgb(0,0,0)").trim(),offsetX:s,offsetY:i,blur:n}}toString(){return[this.offsetX,this.offsetY,this.blur,this.color].join("px ")}toSVG(t){const e=Cs(new gt(this.offsetX,this.offsetY),Ot(-t.angle)),s=new Ye(this.color);let i=40,n=40;return t.width&&t.height&&(i=100*Kt((Math.abs(e.x)+this.blur)/t.width,p.NUM_FRACTION_DIGITS)+20,n=100*Kt((Math.abs(e.y)+this.blur)/t.height,p.NUM_FRACTION_DIGITS)+20),t.flipX&&(e.x*=-1),t.flipY&&(e.y*=-1),'<filter id="SVGID_'.concat(this.id,'" y="-').concat(n,'%" height="').concat(100+2*n,'%" x="-').concat(i,'%" width="').concat(100+2*i,'%" >\n\t<feGaussianBlur in="SourceAlpha" stdDeviation="').concat(Kt(this.blur?this.blur/2:0,p.NUM_FRACTION_DIGITS),'"></feGaussianBlur>\n\t<feOffset dx="').concat(Kt(e.x,p.NUM_FRACTION_DIGITS),'" dy="').concat(Kt(e.y,p.NUM_FRACTION_DIGITS),'" result="oBlur" ></feOffset>\n\t<feFlood flood-color="').concat(s.toRgb(),'" flood-opacity="').concat(s.getAlpha(),'"/>\n\t<feComposite in2="oBlur" operator="in" />\n\t<feMerge>\n\t\t<feMergeNode></feMergeNode>\n\t\t<feMergeNode in="SourceGraphic"></feMergeNode>\n\t</feMerge>\n</filter>\n')}toObject(){const t={color:this.color,blur:this.blur,offsetX:this.offsetX,offsetY:this.offsetY,affectStroke:this.affectStroke,nonScaling:this.nonScaling,type:this.constructor.type},e=Ms.ownDefaults;return this.includeDefaultValues?t:qt(t,((t,s)=>t!==e[s]))}static async fromObject(t){return new this(t)}}l(Ms,"ownDefaults",{color:"rgb(0,0,0)",blur:0,offsetX:0,offsetY:0,affectStroke:!1,includeDefaultValues:!0,nonScaling:!1}),l(Ms,"type","shadow"),at.setClass(Ms,"shadow");const Rs=(t,e,s)=>Math.max(t,Math.min(e,s)),Ls=[j,F,J,Z,"flipX","flipY","originX","originY","angle","opacity","globalCompositeOperation","shadow","visible",tt,et],Fs=[st,it,"strokeWidth","strokeDashArray","width","height","paintFirst","strokeUniform","strokeLineCap","strokeDashOffset","strokeLineJoin","strokeMiterLimit","backgroundColor","clipPath"],js={top:0,left:0,width:0,height:0,angle:0,flipX:!1,flipY:!1,scaleX:1,scaleY:1,minScaleLimit:0,skewX:0,skewY:0,originX:F,originY:j,strokeWidth:1,strokeUniform:!1,padding:0,opacity:1,paintFirst:st,fill:"rgb(0,0,0)",fillRule:"nonzero",stroke:null,strokeDashArray:null,strokeDashOffset:0,strokeLineCap:"butt",strokeLineJoin:"miter",strokeMiterLimit:4,globalCompositeOperation:"source-over",backgroundColor:"",shadow:null,visible:!0,includeDefaultValues:!0,excludeFromExport:!1,objectCaching:!0,clipPath:void 0,inverted:!1,absolutePositioned:!1,centeredRotation:!0,centeredScaling:!1,dirty:!0},Ns=(t,e,s,i)=>(t<Math.abs(e)?(t=e,i=s/4):i=0===e&&0===t?s/I*Math.asin(1):s/I*Math.asin(e/t),{a:t,c:e,p:s,s:i}),Bs=(t,e,s,i,n)=>t*Math.pow(2,10*(i-=1))*Math.sin((i*n-e)*I/s),Ws=(t,e,s,i)=>-s*Math.cos(t/i*D)+s+e,Xs=(t,e,s,i)=>(t/=i)<1/2.75?s*(7.5625*t*t)+e:t<2/2.75?s*(7.5625*(t-=1.5/2.75)*t+.75)+e:t<2.5/2.75?s*(7.5625*(t-=2.25/2.75)*t+.9375)+e:s*(7.5625*(t-=2.625/2.75)*t+.984375)+e,Ys=(t,e,s,i)=>s-Xs(i-t,0,s,i)+e;var Vs=Object.freeze({__proto__:null,defaultEasing:Ws,easeInBack:function(t,e,s,i){let n=arguments.length>4&&void 0!==arguments[4]?arguments[4]:1.70158;return s*(t/=i)*t*((n+1)*t-n)+e},easeInBounce:Ys,easeInCirc:(t,e,s,i)=>-s*(Math.sqrt(1-(t/=i)*t)-1)+e,easeInCubic:(t,e,s,i)=>s*(t/i)**3+e,easeInElastic:(t,e,s,i)=>{const n=s;let r=0;if(0===t)return e;if(1===(t/=i))return e+s;r||(r=.3*i);const{a:o,s:a,p:l}=Ns(n,s,r,1.70158);return-Bs(o,a,l,t,i)+e},easeInExpo:(t,e,s,i)=>0===t?e:s*2**(10*(t/i-1))+e,easeInOutBack:function(t,e,s,i){let n=arguments.length>4&&void 0!==arguments[4]?arguments[4]:1.70158;return(t/=i/2)<1?s/2*(t*t*((1+(n*=1.525))*t-n))+e:s/2*((t-=2)*t*((1+(n*=1.525))*t+n)+2)+e},easeInOutBounce:(t,e,s,i)=>t<i/2?.5*Ys(2*t,0,s,i)+e:.5*Xs(2*t-i,0,s,i)+.5*s+e,easeInOutCirc:(t,e,s,i)=>(t/=i/2)<1?-s/2*(Math.sqrt(1-t**2)-1)+e:s/2*(Math.sqrt(1-(t-=2)*t)+1)+e,easeInOutCubic:(t,e,s,i)=>(t/=i/2)<1?s/2*t**3+e:s/2*((t-2)**3+2)+e,easeInOutElastic:(t,e,s,i)=>{const n=s;let r=0;if(0===t)return e;if(2===(t/=i/2))return e+s;r||(r=i*(.3*1.5));const{a:o,s:a,p:l,c:h}=Ns(n,s,r,1.70158);return t<1?-.5*Bs(o,a,l,t,i)+e:o*Math.pow(2,-10*(t-=1))*Math.sin((t*i-a)*I/l)*.5+h+e},easeInOutExpo:(t,e,s,i)=>0===t?e:t===i?e+s:(t/=i/2)<1?s/2*2**(10*(t-1))+e:s/2*-(2**(-10*--t)+2)+e,easeInOutQuad:(t,e,s,i)=>(t/=i/2)<1?s/2*t**2+e:-s/2*(--t*(t-2)-1)+e,easeInOutQuart:(t,e,s,i)=>(t/=i/2)<1?s/2*t**4+e:-s/2*((t-=2)*t**3-2)+e,easeInOutQuint:(t,e,s,i)=>(t/=i/2)<1?s/2*t**5+e:s/2*((t-2)**5+2)+e,easeInOutSine:(t,e,s,i)=>-s/2*(Math.cos(Math.PI*t/i)-1)+e,easeInQuad:(t,e,s,i)=>s*(t/=i)*t+e,easeInQuart:(t,e,s,i)=>s*(t/=i)*t**3+e,easeInQuint:(t,e,s,i)=>s*(t/i)**5+e,easeInSine:(t,e,s,i)=>-s*Math.cos(t/i*D)+s+e,easeOutBack:function(t,e,s,i){let n=arguments.length>4&&void 0!==arguments[4]?arguments[4]:1.70158;return s*((t=t/i-1)*t*((n+1)*t+n)+1)+e},easeOutBounce:Xs,easeOutCirc:(t,e,s,i)=>s*Math.sqrt(1-(t=t/i-1)*t)+e,easeOutCubic:(t,e,s,i)=>s*((t/i-1)**3+1)+e,easeOutElastic:(t,e,s,i)=>{const n=s;let r=0;if(0===t)return e;if(1===(t/=i))return e+s;r||(r=.3*i);const{a:o,s:a,p:l,c:h}=Ns(n,s,r,1.70158);return o*2**(-10*t)*Math.sin((t*i-a)*I/l)+h+e},easeOutExpo:(t,e,s,i)=>t===i?e+s:s*-(2**(-10*t/i)+1)+e,easeOutQuad:(t,e,s,i)=>-s*(t/=i)*(t-2)+e,easeOutQuart:(t,e,s,i)=>-s*((t=t/i-1)*t**3-1)+e,easeOutQuint:(t,e,s,i)=>s*((t/i-1)**5+1)+e,easeOutSine:(t,e,s,i)=>s*Math.sin(t/i*D)+e});const Hs=()=>!1;class zs{constructor(t){let{startValue:e,byValue:s,duration:i=500,delay:n=0,easing:r=Ws,onStart:o=E,onChange:a=E,onComplete:h=E,abort:c=Hs,target:u}=t;l(this,"_state","pending"),l(this,"durationProgress",0),l(this,"valueProgress",0),this.tick=this.tick.bind(this),this.duration=i,this.delay=n,this.easing=r,this._onStart=o,this._onChange=a,this._onComplete=h,this._abort=c,this.target=u,this.startValue=e,this.byValue=s,this.value=this.startValue,this.endValue=Object.freeze(this.calculate(this.duration).value)}get state(){return this._state}isDone(){return"aborted"===this._state||"completed"===this._state}start(){const t=t=>{"pending"===this._state&&(this.startTime=t||+new Date,this._state="running",this._onStart(),this.tick(this.startTime))};this.register(),this.delay>0?setTimeout((()=>vt(t)),this.delay):vt(t)}tick(t){const e=(t||+new Date)-this.startTime,s=Math.min(e,this.duration);this.durationProgress=s/this.duration;const{value:i,valueProgress:n}=this.calculate(s);this.value=Object.freeze(i),this.valueProgress=n,"aborted"!==this._state&&(this._abort(this.value,this.valueProgress,this.durationProgress)?(this._state="aborted",this.unregister()):e>=this.duration?(this.durationProgress=this.valueProgress=1,this._onChange(this.endValue,this.valueProgress,this.durationProgress),this._state="completed",this._onComplete(this.endValue,this.valueProgress,this.durationProgress),this.unregister()):(this._onChange(this.value,this.valueProgress,this.durationProgress),vt(this.tick)))}register(){lt.push(this)}unregister(){lt.remove(this)}abort(){this._state="aborted",this.unregister()}}const Gs=["startValue","endValue"];class Us extends zs{constructor(t){let{startValue:e=0,endValue:s=100}=t;super(c(c({},u(t,Gs)),{},{startValue:e,byValue:s-e}))}calculate(t){const e=this.easing(t,this.startValue,this.byValue,this.duration);return{value:e,valueProgress:Math.abs((e-this.startValue)/this.byValue)}}}const qs=["startValue","endValue"];class Ks extends zs{constructor(t){let{startValue:e=[0],endValue:s=[100]}=t;super(c(c({},u(t,qs)),{},{startValue:e,byValue:s.map(((t,s)=>t-e[s]))}))}calculate(t){const e=this.startValue.map(((e,s)=>this.easing(t,e,this.byValue[s],this.duration,s)));return{value:e,valueProgress:Math.abs((e[0]-this.startValue[0])/this.byValue[0])}}}const $s=["startValue","endValue","easing","onChange","onComplete","abort"],Qs=(t,e,s,i)=>e+s*(1-Math.cos(t/i*D)),Js=t=>t&&((e,s,i)=>t(new Ye(e).toRgba(),s,i));class Zs extends zs{constructor(t){let{startValue:e,endValue:s,easing:i=Qs,onChange:n,onComplete:r,abort:o}=t,a=u(t,$s);const l=new Ye(e).getSource(),h=new Ye(s).getSource();super(c(c({},a),{},{startValue:l,byValue:h.map(((t,e)=>t-l[e])),easing:i,onChange:Js(n),onComplete:Js(r),abort:Js(o)}))}calculate(t){const[e,s,i,n]=this.startValue.map(((e,s)=>this.easing(t,e,this.byValue[s],this.duration,s))),r=[...[e,s,i].map(Math.round),Rs(0,n,1)];return{value:r,valueProgress:r.map(((t,e)=>0!==this.byValue[e]?Math.abs((t-this.startValue[e])/this.byValue[e]):0)).find((t=>0!==t))||0}}}function ti(t){const e=(t=>Array.isArray(t.startValue)||Array.isArray(t.endValue))(t)?new Ks(t):new Us(t);return e.start(),e}function ei(t){const e=new Zs(t);return e.start(),e}class si{constructor(t){this.status=t,this.points=[]}includes(t){return this.points.some((e=>e.eq(t)))}append(){for(var t=arguments.length,e=new Array(t),s=0;s<t;s++)e[s]=arguments[s];return this.points=this.points.concat(e.filter((t=>!this.includes(t)))),this}static isPointContained(t,e,s){let i=arguments.length>3&&void 0!==arguments[3]&&arguments[3];if(e.eq(s))return t.eq(e);if(e.x===s.x)return t.x===e.x&&(i||t.y>=Math.min(e.y,s.y)&&t.y<=Math.max(e.y,s.y));if(e.y===s.y)return t.y===e.y&&(i||t.x>=Math.min(e.x,s.x)&&t.x<=Math.max(e.x,s.x));{const n=xs(e,s),r=xs(e,t).divide(n);return i?Math.abs(r.x)===Math.abs(r.y):r.x===r.y&&r.x>=0&&r.x<=1}}static isPointInPolygon(t,e){const s=new gt(t).setX(Math.min(t.x-1,...e.map((t=>t.x))));let i=0;for(let n=0;n<e.length;n++){const r=this.intersectSegmentSegment(e[n],e[(n+1)%e.length],t,s);if(r.includes(t))return!0;i+=Number("Intersection"===r.status)}return i%2==1}static intersectLineLine(t,e,s,i){let n=!(arguments.length>4&&void 0!==arguments[4])||arguments[4],r=!(arguments.length>5&&void 0!==arguments[5])||arguments[5];const o=e.x-t.x,a=e.y-t.y,l=i.x-s.x,h=i.y-s.y,c=t.x-s.x,u=t.y-s.y,d=l*u-h*c,g=o*u-a*c,p=h*o-l*a;if(0!==p){const e=d/p,s=g/p;return(n||0<=e&&e<=1)&&(r||0<=s&&s<=1)?new si("Intersection").append(new gt(t.x+e*o,t.y+e*a)):new si}if(0===d||0===g){const o=n||r||si.isPointContained(t,s,i)||si.isPointContained(e,s,i)||si.isPointContained(s,t,e)||si.isPointContained(i,t,e);return new si(o?"Coincident":void 0)}return new si("Parallel")}static intersectSegmentLine(t,e,s,i){return si.intersectLineLine(t,e,s,i,!1,!0)}static intersectSegmentSegment(t,e,s,i){return si.intersectLineLine(t,e,s,i,!1,!1)}static intersectLinePolygon(t,e,s){let i=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];const n=new si,r=s.length;for(let o,a,l,h=0;h<r;h++){if(o=s[h],a=s[(h+1)%r],l=si.intersectLineLine(t,e,o,a,i,!1),"Coincident"===l.status)return l;n.append(...l.points)}return n.points.length>0&&(n.status="Intersection"),n}static intersectSegmentPolygon(t,e,s){return si.intersectLinePolygon(t,e,s,!1)}static intersectPolygonPolygon(t,e){const s=new si,i=t.length,n=[];for(let r=0;r<i;r++){const o=t[r],a=t[(r+1)%i],l=si.intersectSegmentPolygon(o,a,e);"Coincident"===l.status?(n.push(l),s.append(o,a)):s.append(...l.points)}return n.length>0&&n.length===t.length?new si("Coincident"):(s.points.length>0&&(s.status="Intersection"),s)}static intersectPolygonRectangle(t,e,s){const i=e.min(s),n=e.max(s),r=new gt(n.x,i.y),o=new gt(i.x,n.y);return si.intersectPolygonPolygon(t,[i,r,n,o])}}class ii extends _t{getX(){return this.getXY().x}setX(t){this.setXY(this.getXY().setX(t))}getY(){return this.getXY().y}setY(t){this.setXY(this.getXY().setY(t))}getRelativeX(){return this.left}setRelativeX(t){this.left=t}getRelativeY(){return this.top}setRelativeY(t){this.top=t}getXY(){const t=this.getRelativeXY();return this.group?It(t,this.group.calcTransformMatrix()):t}setXY(t,e,s){this.group&&(t=It(t,Pt(this.group.calcTransformMatrix()))),this.setRelativeXY(t,e,s)}getRelativeXY(){return new gt(this.left,this.top)}setRelativeXY(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.originX,s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:this.originY;this.setPositionByOrigin(t,e,s)}isStrokeAccountedForInDimensions(){return!1}getCoords(){const{tl:t,tr:e,br:s,bl:i}=this.aCoords||(this.aCoords=this.calcACoords()),n=[t,e,s,i];if(this.group){const t=this.group.calcTransformMatrix();return n.map((e=>It(e,t)))}return n}intersectsWithRect(t,e){return"Intersection"===si.intersectPolygonRectangle(this.getCoords(),t,e).status}intersectsWithObject(t){const e=si.intersectPolygonPolygon(this.getCoords(),t.getCoords());return"Intersection"===e.status||"Coincident"===e.status||t.isContainedWithinObject(this)||this.isContainedWithinObject(t)}isContainedWithinObject(t){return this.getCoords().every((e=>t.containsPoint(e)))}isContainedWithinRect(t,e){const{left:s,top:i,width:n,height:r}=this.getBoundingRect();return s>=t.x&&s+n<=e.x&&i>=t.y&&i+r<=e.y}isOverlapping(t){return this.intersectsWithObject(t)||this.isContainedWithinObject(t)||t.isContainedWithinObject(this)}containsPoint(t){return si.isPointInPolygon(t,this.getCoords())}isOnScreen(){if(!this.canvas)return!1;const{tl:t,br:e}=this.canvas.vptCoords;return!!this.getCoords().some((s=>s.x<=e.x&&s.x>=t.x&&s.y<=e.y&&s.y>=t.y))||!!this.intersectsWithRect(t,e)||this.containsPoint(t.midPointFrom(e))}isPartiallyOnScreen(){if(!this.canvas)return!1;const{tl:t,br:e}=this.canvas.vptCoords;return!!this.intersectsWithRect(t,e)||this.getCoords().every((s=>(s.x>=e.x||s.x<=t.x)&&(s.y>=e.y||s.y<=t.y)))&&this.containsPoint(t.midPointFrom(e))}getBoundingRect(){return pe(this.getCoords())}getScaledWidth(){return this._getTransformedDimensions().x}getScaledHeight(){return this._getTransformedDimensions().y}scale(t){this._set(J,t),this._set(Z,t),this.setCoords()}scaleToWidth(t){const e=this.getBoundingRect().width/this.getScaledWidth();return this.scale(t/this.width/e)}scaleToHeight(t){const e=this.getBoundingRect().height/this.getScaledHeight();return this.scale(t/this.height/e)}getCanvasRetinaScaling(){var t;return(null===(t=this.canvas)||void 0===t?void 0:t.getRetinaScaling())||1}getTotalAngle(){return this.group?Et(Rt(this.calcTransformMatrix())):this.angle}getViewportTransform(){var t;return(null===(t=this.canvas)||void 0===t?void 0:t.viewportTransform)||A.concat()}calcACoords(){const t=jt({angle:this.angle}),{x:e,y:s}=this.getRelativeCenterPoint(),i=Ft(e,s),n=At(i,t),r=this._getTransformedDimensions(),o=r.x/2,a=r.y/2;return{tl:It({x:-o,y:-a},n),tr:It({x:o,y:-a},n),bl:It({x:-o,y:a},n),br:It({x:o,y:a},n)}}setCoords(){this.aCoords=this.calcACoords()}transformMatrixKey(){let t=arguments.length>0&&void 0!==arguments[0]&&arguments[0],e=[];return!t&&this.group&&(e=this.group.transformMatrixKey(t)),e.push(this.top,this.left,this.width,this.height,this.scaleX,this.scaleY,this.angle,this.strokeWidth,this.skewX,this.skewY,+this.flipX,+this.flipY,Oe(this.originX),Oe(this.originY)),e}calcTransformMatrix(){let t=arguments.length>0&&void 0!==arguments[0]&&arguments[0],e=this.calcOwnMatrix();if(t||!this.group)return e;const s=this.transformMatrixKey(t),i=this.matrixCache;return i&&i.key.every(((t,e)=>t===s[e]))?i.value:(this.group&&(e=At(this.group.calcTransformMatrix(!1),e)),this.matrixCache={key:s,value:e},e)}calcOwnMatrix(){const t=this.transformMatrixKey(!0),e=this.ownMatrixCache;if(e&&e.key===t)return e.value;const s=this.getRelativeCenterPoint(),i={angle:this.angle,translateX:s.x,translateY:s.y,scaleX:this.scaleX,scaleY:this.scaleY,skewX:this.skewX,skewY:this.skewY,flipX:this.flipX,flipY:this.flipY},n=Vt(i);return this.ownMatrixCache={key:t,value:n},n}_getNonTransformedDimensions(){return new gt(this.width,this.height).scalarAdd(this.strokeWidth)}_calculateCurrentDimensions(t){return this._getTransformedDimensions(t).transform(this.getViewportTransform(),!0).scalarAdd(2*this.padding)}_getTransformedDimensions(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};const e=c({scaleX:this.scaleX,scaleY:this.scaleY,skewX:this.skewX,skewY:this.skewY,width:this.width,height:this.height,strokeWidth:this.strokeWidth},t),s=e.strokeWidth;let i=s,n=0;this.strokeUniform&&(i=0,n=s);const r=e.width+i,o=e.height+i;let a;return a=0===e.skewX&&0===e.skewY?new gt(r*e.scaleX,o*e.scaleY):be(r,o,Yt(e)),a.scalarAdd(n)}translateToGivenOrigin(t,e,s,i,n){let r=t.x,o=t.y;const a=Oe(i)-Oe(e),l=Oe(n)-Oe(s);if(a||l){const t=this._getTransformedDimensions();r+=a*t.x,o+=l*t.y}return new gt(r,o)}translateToCenterPoint(t,e,s){if(e===L&&s===L)return t;const i=this.translateToGivenOrigin(t,e,s,L,L);return this.angle?i.rotate(Ot(this.angle),t):i}translateToOriginPoint(t,e,s){const i=this.translateToGivenOrigin(t,L,L,e,s);return this.angle?i.rotate(Ot(this.angle),t):i}getCenterPoint(){const t=this.getRelativeCenterPoint();return this.group?It(t,this.group.calcTransformMatrix()):t}getRelativeCenterPoint(){return this.translateToCenterPoint(new gt(this.left,this.top),this.originX,this.originY)}getPointByOrigin(t,e){return this.translateToOriginPoint(this.getRelativeCenterPoint(),t,e)}setPositionByOrigin(t,e,s){const i=this.translateToCenterPoint(t,e,s),n=this.translateToOriginPoint(i,this.originX,this.originY);this.set({left:n.x,top:n.y})}_getLeftTopCoords(){return this.translateToOriginPoint(this.getRelativeCenterPoint(),F,j)}}const ni=["type"],ri=["extraParam"];let oi=class t extends ii{static getDefaults(){return t.ownDefaults}get type(){const t=this.constructor.type;return"FabricObject"===t?"object":t.toLowerCase()}set type(t){f("warn","Setting type has no effect",t)}constructor(e){super(),l(this,"_cacheContext",null),Object.assign(this,t.ownDefaults),this.setOptions(e)}_createCacheCanvas(){this._cacheCanvas=xt(),this._cacheContext=this._cacheCanvas.getContext("2d"),this._updateCacheCanvas(),this.dirty=!0}_limitCacheSize(t){const e=t.width,s=t.height,i=p.maxCacheSideLimit,n=p.minCacheSideLimit;if(e<=i&&s<=i&&e*s<=p.perfLimitSizeTotal)return e<n&&(t.width=n),s<n&&(t.height=n),t;const r=e/s,[o,a]=k.limitDimsByArea(r),l=Rs(n,o,i),h=Rs(n,a,i);return e>l&&(t.zoomX/=e/l,t.width=l,t.capped=!0),s>h&&(t.zoomY/=s/h,t.height=h,t.capped=!0),t}_getCacheCanvasDimensions(){const t=this.getTotalObjectScaling(),e=this._getTransformedDimensions({skewX:0,skewY:0}),s=e.x*t.x/this.scaleX,i=e.y*t.y/this.scaleY;return{width:Math.ceil(s+2),height:Math.ceil(i+2),zoomX:t.x,zoomY:t.y,x:s,y:i}}_updateCacheCanvas(){const t=this._cacheCanvas,e=this._cacheContext,{width:s,height:i,zoomX:n,zoomY:r,x:o,y:a}=this._limitCacheSize(this._getCacheCanvasDimensions()),l=s!==t.width||i!==t.height,h=this.zoomX!==n||this.zoomY!==r;if(!t||!e)return!1;if(l||h){s!==t.width||i!==t.height?(t.width=s,t.height=i):(e.setTransform(1,0,0,1,0,0),e.clearRect(0,0,t.width,t.height));const l=o/2,h=a/2;return this.cacheTranslationX=Math.round(t.width/2-l)+l,this.cacheTranslationY=Math.round(t.height/2-h)+h,e.translate(this.cacheTranslationX,this.cacheTranslationY),e.scale(n,r),this.zoomX=n,this.zoomY=r,!0}return!1}setOptions(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};this._setOptions(t)}transform(t){const e=this.group&&!this.group._transformDone||this.group&&this.canvas&&t===this.canvas.contextTop,s=this.calcTransformMatrix(!e);t.transform(s[0],s[1],s[2],s[3],s[4],s[5])}getObjectScaling(){if(!this.group)return new gt(Math.abs(this.scaleX),Math.abs(this.scaleY));const t=Lt(this.calcTransformMatrix());return new gt(Math.abs(t.scaleX),Math.abs(t.scaleY))}getTotalObjectScaling(){const t=this.getObjectScaling();if(this.canvas){const e=this.canvas.getZoom(),s=this.getCanvasRetinaScaling();return t.scalarMultiply(e*s)}return t}getObjectOpacity(){let t=this.opacity;return this.group&&(t*=this.group.getObjectOpacity()),t}_constrainScale(t){return Math.abs(t)<this.minScaleLimit?t<0?-this.minScaleLimit:this.minScaleLimit:0===t?1e-4:t}_set(t,e){t!==J&&t!==Z||(e=this._constrainScale(e)),t===J&&e<0?(this.flipX=!this.flipX,e*=-1):"scaleY"===t&&e<0?(this.flipY=!this.flipY,e*=-1):"shadow"!==t||!e||e instanceof Ms||(e=new Ms(e));const s=this[t]!==e;return this[t]=e,s&&this.constructor.cacheProperties.includes(t)&&(this.dirty=!0),this.parent&&(this.dirty||s&&this.constructor.stateProperties.includes(t))&&this.parent._set("dirty",!0),this}isNotVisible(){return 0===this.opacity||!this.width&&!this.height&&0===this.strokeWidth||!this.visible}render(t){this.isNotVisible()||this.canvas&&this.canvas.skipOffscreen&&!this.group&&!this.isOnScreen()||(t.save(),this._setupCompositeOperation(t),this.drawSelectionBackground(t),this.transform(t),this._setOpacity(t),this._setShadow(t),this.shouldCache()?(this.renderCache(),this.drawCacheOnCanvas(t)):(this._removeCacheCanvas(),this.drawObject(t,!1,{}),this.dirty=!1),t.restore())}drawSelectionBackground(t){}renderCache(t){if(t=t||{},this._cacheCanvas&&this._cacheContext||this._createCacheCanvas(),this.isCacheDirty()&&this._cacheContext){const{zoomX:e,zoomY:s,cacheTranslationX:i,cacheTranslationY:n}=this,{width:r,height:o}=this._cacheCanvas;this.drawObject(this._cacheContext,t.forClipping,{zoomX:e,zoomY:s,cacheTranslationX:i,cacheTranslationY:n,width:r,height:o,parentClipPaths:[]}),this.dirty=!1}}_removeCacheCanvas(){this._cacheCanvas=void 0,this._cacheContext=null}hasStroke(){return this.stroke&&"transparent"!==this.stroke&&0!==this.strokeWidth}hasFill(){return this.fill&&"transparent"!==this.fill}needsItsOwnCache(){return!!(this.paintFirst===it&&this.hasFill()&&this.hasStroke()&&this.shadow)||!!this.clipPath}shouldCache(){return this.ownCaching=this.objectCaching&&(!this.parent||!this.parent.isOnACache())||this.needsItsOwnCache(),this.ownCaching}willDrawShadow(){return!!this.shadow&&(0!==this.shadow.offsetX||0!==this.shadow.offsetY)}drawClipPathOnCache(t,e,s){t.save(),e.inverted?t.globalCompositeOperation="destination-out":t.globalCompositeOperation="destination-in",t.setTransform(1,0,0,1,0,0),t.drawImage(s,0,0),t.restore()}drawObject(t,e,s){const i=this.fill,n=this.stroke;e?(this.fill="black",this.stroke="",this._setClippingProperties(t)):this._renderBackground(t),this._render(t),this._drawClipPath(t,this.clipPath,s),this.fill=i,this.stroke=n}createClipPathLayer(t,e){const s=St(e),i=s.getContext("2d");if(i.translate(e.cacheTranslationX,e.cacheTranslationY),i.scale(e.zoomX,e.zoomY),t._cacheCanvas=s,e.parentClipPaths.forEach((t=>{t.transform(i)})),e.parentClipPaths.push(t),t.absolutePositioned){const t=Pt(this.calcTransformMatrix());i.transform(t[0],t[1],t[2],t[3],t[4],t[5])}return t.transform(i),t.drawObject(i,!0,e),s}_drawClipPath(t,e,s){if(!e)return;e._transformDone=!0;const i=this.createClipPathLayer(e,s);this.drawClipPathOnCache(t,e,i)}drawCacheOnCanvas(t){t.scale(1/this.zoomX,1/this.zoomY),t.drawImage(this._cacheCanvas,-this.cacheTranslationX,-this.cacheTranslationY)}isCacheDirty(){let t=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(this.isNotVisible())return!1;const e=this._cacheCanvas,s=this._cacheContext;return!(!e||!s||t||!this._updateCacheCanvas())||!!(this.dirty||this.clipPath&&this.clipPath.absolutePositioned)&&(e&&s&&!t&&(s.save(),s.setTransform(1,0,0,1,0,0),s.clearRect(0,0,e.width,e.height),s.restore()),!0)}_renderBackground(t){if(!this.backgroundColor)return;const e=this._getNonTransformedDimensions();t.fillStyle=this.backgroundColor,t.fillRect(-e.x/2,-e.y/2,e.x,e.y),this._removeShadow(t)}_setOpacity(t){this.group&&!this.group._transformDone?t.globalAlpha=this.getObjectOpacity():t.globalAlpha*=this.opacity}_setStrokeStyles(t,e){const s=e.stroke;s&&(t.lineWidth=e.strokeWidth,t.lineCap=e.strokeLineCap,t.lineDashOffset=e.strokeDashOffset,t.lineJoin=e.strokeLineJoin,t.miterLimit=e.strokeMiterLimit,Qt(s)?"percentage"===s.gradientUnits||s.gradientTransform||s.patternTransform?this._applyPatternForTransformedGradient(t,s):(t.strokeStyle=s.toLive(t),this._applyPatternGradientTransform(t,s)):t.strokeStyle=e.stroke)}_setFillStyles(t,e){let{fill:s}=e;s&&(Qt(s)?(t.fillStyle=s.toLive(t),this._applyPatternGradientTransform(t,s)):t.fillStyle=s)}_setClippingProperties(t){t.globalAlpha=1,t.strokeStyle="transparent",t.fillStyle="#000000"}_setLineDash(t,e){e&&0!==e.length&&t.setLineDash(e)}_setShadow(t){if(!this.shadow)return;const e=this.shadow,s=this.canvas,i=this.getCanvasRetinaScaling(),[n,,,r]=(null==s?void 0:s.viewportTransform)||A,o=n*i,a=r*i,l=e.nonScaling?new gt(1,1):this.getObjectScaling();t.shadowColor=e.color,t.shadowBlur=e.blur*p.browserShadowBlurConstant*(o+a)*(l.x+l.y)/4,t.shadowOffsetX=e.offsetX*o*l.x,t.shadowOffsetY=e.offsetY*a*l.y}_removeShadow(t){this.shadow&&(t.shadowColor="",t.shadowBlur=t.shadowOffsetX=t.shadowOffsetY=0)}_applyPatternGradientTransform(t,e){if(!Qt(e))return{offsetX:0,offsetY:0};const s=e.gradientTransform||e.patternTransform,i=-this.width/2+e.offsetX||0,n=-this.height/2+e.offsetY||0;return"percentage"===e.gradientUnits?t.transform(this.width,0,0,this.height,i,n):t.transform(1,0,0,1,i,n),s&&t.transform(s[0],s[1],s[2],s[3],s[4],s[5]),{offsetX:i,offsetY:n}}_renderPaintInOrder(t){this.paintFirst===it?(this._renderStroke(t),this._renderFill(t)):(this._renderFill(t),this._renderStroke(t))}_render(t){}_renderFill(t){this.fill&&(t.save(),this._setFillStyles(t,this),"evenodd"===this.fillRule?t.fill("evenodd"):t.fill(),t.restore())}_renderStroke(t){if(this.stroke&&0!==this.strokeWidth){if(this.shadow&&!this.shadow.affectStroke&&this._removeShadow(t),t.save(),this.strokeUniform){const e=this.getObjectScaling();t.scale(1/e.x,1/e.y)}this._setLineDash(t,this.strokeDashArray),this._setStrokeStyles(t,this),t.stroke(),t.restore()}}_applyPatternForTransformedGradient(t,e){var s;const i=this._limitCacheSize(this._getCacheCanvasDimensions()),n=this.getCanvasRetinaScaling(),r=i.x/this.scaleX/n,o=i.y/this.scaleY/n,a=St({width:Math.ceil(r),height:Math.ceil(o)}),l=a.getContext("2d");l&&(l.beginPath(),l.moveTo(0,0),l.lineTo(r,0),l.lineTo(r,o),l.lineTo(0,o),l.closePath(),l.translate(r/2,o/2),l.scale(i.zoomX/this.scaleX/n,i.zoomY/this.scaleY/n),this._applyPatternGradientTransform(l,e),l.fillStyle=e.toLive(t),l.fill(),t.translate(-this.width/2-this.strokeWidth/2,-this.height/2-this.strokeWidth/2),t.scale(n*this.scaleX/i.zoomX,n*this.scaleY/i.zoomY),t.strokeStyle=null!==(s=l.createPattern(a,"no-repeat"))&&void 0!==s?s:"")}_findCenterFromElement(){return new gt(this.left+this.width/2,this.top+this.height/2)}clone(t){const e=this.toObject(t);return this.constructor.fromObject(e)}cloneAsImage(t){const e=this.toCanvasElement(t);return new(at.getClass("image"))(e)}toCanvasElement(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};const e=ye(this),s=this.group,i=this.shadow,n=Math.abs,r=t.enableRetinaScaling?T():1,o=(t.multiplier||1)*r,a=t.canvasProvider||(t=>new he(t,{enableRetinaScaling:!1,renderOnAddRemove:!1,skipOffscreen:!1}));delete this.group,t.withoutTransform&&ve(this),t.withoutShadow&&(this.shadow=null),t.viewportTransform&&Se(this,this.getViewportTransform()),this.setCoords();const l=xt(),h=this.getBoundingRect(),c=this.shadow,u=new gt;if(c){const t=c.blur,e=c.nonScaling?new gt(1,1):this.getObjectScaling();u.x=2*Math.round(n(c.offsetX)+t)*n(e.x),u.y=2*Math.round(n(c.offsetY)+t)*n(e.y)}const d=h.width+u.x,g=h.height+u.y;l.width=Math.ceil(d),l.height=Math.ceil(g);const p=a(l);"jpeg"===t.format&&(p.backgroundColor="#fff"),this.setPositionByOrigin(new gt(p.width/2,p.height/2),L,L);const f=this.canvas;p._objects=[this],this.set("canvas",p),this.setCoords();const m=p.toCanvasElement(o||1,t);return this.set("canvas",f),this.shadow=i,s&&(this.group=s),this.set(e),this.setCoords(),p._objects=[],p.destroy(),m}toDataURL(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return Tt(this.toCanvasElement(t),t.format||"png",t.quality||1)}toBlob(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return kt(this.toCanvasElement(t),t.format||"png",t.quality||1)}isType(){for(var t=arguments.length,e=new Array(t),s=0;s<t;s++)e[s]=arguments[s];return e.includes(this.constructor.type)||e.includes(this.type)}complexity(){return 1}toJSON(){return this.toObject()}rotate(t){const{centeredRotation:e,originX:s,originY:i}=this;if(e){const{x:t,y:e}=this.getRelativeCenterPoint();this.originX=L,this.originY=L,this.left=t,this.top=e}if(this.set("angle",t),e){const{x:t,y:e}=this.translateToOriginPoint(this.getRelativeCenterPoint(),s,i);this.left=t,this.top=e,this.originX=s,this.originY=i}}setOnGroup(){}_setupCompositeOperation(t){this.globalCompositeOperation&&(t.globalCompositeOperation=this.globalCompositeOperation)}dispose(){lt.cancelByTarget(this),this.off(),this._set("canvas",void 0),this._cacheCanvas&&x().dispose(this._cacheCanvas),this._cacheCanvas=void 0,this._cacheContext=null}animate(t,e){return Object.entries(t).reduce(((t,s)=>{let[i,n]=s;return t[i]=this._animate(i,n,e),t}),{})}_animate(t,e){let s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};const i=t.split("."),n=this.constructor.colorProperties.includes(i[i.length-1]),{abort:r,startValue:o,onChange:a,onComplete:l}=s,h=c(c({},s),{},{target:this,startValue:null!=o?o:i.reduce(((t,e)=>t[e]),this),endValue:e,abort:null==r?void 0:r.bind(this),onChange:(t,e,s)=>{i.reduce(((e,s,n)=>(n===i.length-1&&(e[s]=t),e[s])),this),a&&a(t,e,s)},onComplete:(t,e,s)=>{this.setCoords(),l&&l(t,e,s)}});return n?ei(h):ti(h)}isDescendantOf(t){const{parent:e,group:s}=this;return e===t||s===t||!!e&&e.isDescendantOf(t)||!!s&&s!==e&&s.isDescendantOf(t)}getAncestors(){const t=[];let e=this;do{e=e.parent,e&&t.push(e)}while(e);return t}findCommonAncestors(t){if(this===t)return{fork:[],otherFork:[],common:[this,...this.getAncestors()]};const e=this.getAncestors(),s=t.getAncestors();if(0===e.length&&s.length>0&&this===s[s.length-1])return{fork:[],otherFork:[t,...s.slice(0,s.length-1)],common:[this]};for(let i,n=0;n<e.length;n++){if(i=e[n],i===t)return{fork:[this,...e.slice(0,n)],otherFork:[],common:e.slice(n)};for(let r=0;r<s.length;r++){if(this===s[r])return{fork:[],otherFork:[t,...s.slice(0,r)],common:[this,...e]};if(i===s[r])return{fork:[this,...e.slice(0,n)],otherFork:[t,...s.slice(0,r)],common:e.slice(n)}}}return{fork:[this,...e],otherFork:[t,...s],common:[]}}hasCommonAncestors(t){const e=this.findCommonAncestors(t);return e&&!!e.common.length}isInFrontOf(t){if(this===t)return;const e=this.findCommonAncestors(t);if(e.fork.includes(t))return!0;if(e.otherFork.includes(this))return!1;const s=e.common[0]||this.canvas;if(!s)return;const i=e.fork.pop(),n=e.otherFork.pop(),r=s._objects.indexOf(i),o=s._objects.indexOf(n);return r>-1&&r>o}toObject(){const e=(arguments.length>0&&void 0!==arguments[0]?arguments[0]:[]).concat(t.customProperties,this.constructor.customProperties||[]);let s;const i=p.NUM_FRACTION_DIGITS,{clipPath:n,fill:r,stroke:o,shadow:a,strokeDashArray:l,left:h,top:u,originX:d,originY:g,width:f,height:m,strokeWidth:_,strokeLineCap:v,strokeDashOffset:y,strokeLineJoin:b,strokeUniform:C,strokeMiterLimit:x,scaleX:w,scaleY:S,angle:T,flipX:k,flipY:E,opacity:D,visible:I,backgroundColor:P,fillRule:A,paintFirst:M,globalCompositeOperation:R,skewX:L,skewY:F}=this;n&&!n.excludeFromExport&&(s=n.toObject(e.concat("inverted","absolutePositioned")));const j=t=>Kt(t,i),N=c(c({},Ut(this,e)),{},{type:this.constructor.type,version:O,originX:d,originY:g,left:j(h),top:j(u),width:j(f),height:j(m),fill:Jt(r)?r.toObject():r,stroke:Jt(o)?o.toObject():o,strokeWidth:j(_),strokeDashArray:l?l.concat():l,strokeLineCap:v,strokeDashOffset:y,strokeLineJoin:b,strokeUniform:C,strokeMiterLimit:j(x),scaleX:j(w),scaleY:j(S),angle:j(T),flipX:k,flipY:E,opacity:j(D),shadow:a?a.toObject():a,visible:I,backgroundColor:P,fillRule:A,paintFirst:M,globalCompositeOperation:R,skewX:j(L),skewY:j(F)},s?{clipPath:s}:null);return this.includeDefaultValues?N:this._removeDefaultValues(N)}toDatalessObject(t){return this.toObject(t)}_removeDefaultValues(t){const e=this.constructor.getDefaults(),s=Object.keys(e).length>0?e:Object.getPrototypeOf(this);return qt(t,((t,e)=>{if(e===F||e===j||"type"===e)return!0;const i=s[e];return t!==i&&!(Array.isArray(t)&&Array.isArray(i)&&0===t.length&&0===i.length)}))}toString(){return"#<".concat(this.constructor.type,">")}static _fromObject(t){let e=u(t,ni),s=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},{extraParam:i}=s,n=u(s,ri);return Gt(e,n).then((t=>i?(delete t[i],new this(e[i],t)):new this(t)))}static fromObject(t,e){return this._fromObject(t,e)}};l(oi,"stateProperties",Ls),l(oi,"cacheProperties",Fs),l(oi,"ownDefaults",js),l(oi,"type","FabricObject"),l(oi,"colorProperties",[st,it,"backgroundColor"]),l(oi,"customProperties",[]),at.setClass(oi),at.setClass(oi,"object");const ai=(t,e,s)=>(i,n,r,o)=>{const a=e(i,n,r,o);return a&&Te(t,c(c({},Ae(i,n,r,o)),s)),a};function li(t){return(e,s,i,n)=>{const{target:r,originX:o,originY:a}=s,l=r.getRelativeCenterPoint(),h=r.translateToOriginPoint(l,o,a),c=t(e,s,i,n);return r.setPositionByOrigin(h,s.originX,s.originY),c}}const hi=ai(U,li(((t,e,s,i)=>{const n=Re(e,e.originX,e.originY,s,i);if(Oe(e.originX)===Oe(L)||Oe(e.originX)===Oe(B)&&n.x<0||Oe(e.originX)===Oe(F)&&n.x>0){const{target:t}=e,s=t.strokeWidth/(t.strokeUniform?t.scaleX:1),i=De(e)?2:1,r=t.width,o=Math.abs(n.x*i/t.scaleX)-s;return t.set("width",Math.max(o,1)),r!==t.width}return!1})));function ci(t,e,s,i,n){i=i||{};const r=this.sizeX||i.cornerSize||n.cornerSize,o=this.sizeY||i.cornerSize||n.cornerSize,a=void 0!==i.transparentCorners?i.transparentCorners:n.transparentCorners,l=a?it:st,h=!a&&(i.cornerStrokeColor||n.cornerStrokeColor);let c,u=e,d=s;t.save(),t.fillStyle=i.cornerColor||n.cornerColor||"",t.strokeStyle=i.cornerStrokeColor||n.cornerStrokeColor||"",r>o?(c=r,t.scale(1,o/r),d=s*r/o):o>r?(c=o,t.scale(r/o,1),u=e*o/r):c=r,t.beginPath(),t.arc(u,d,c/2,0,I,!1),t[l](),h&&t.stroke(),t.restore()}function ui(t,e,s,i,n){i=i||{};const r=this.sizeX||i.cornerSize||n.cornerSize,o=this.sizeY||i.cornerSize||n.cornerSize,a=void 0!==i.transparentCorners?i.transparentCorners:n.transparentCorners,l=a?it:st,h=!a&&(i.cornerStrokeColor||n.cornerStrokeColor),c=r/2,u=o/2;t.save(),t.fillStyle=i.cornerColor||n.cornerColor||"",t.strokeStyle=i.cornerStrokeColor||n.cornerStrokeColor||"",t.translate(e,s);const d=n.getTotalAngle();t.rotate(Ot(d)),t["".concat(l,"Rect")](-c,-u,r,o),h&&t.strokeRect(-c,-u,r,o),t.restore()}class di{constructor(t){l(this,"visible",!0),l(this,"actionName",Q),l(this,"angle",0),l(this,"x",0),l(this,"y",0),l(this,"offsetX",0),l(this,"offsetY",0),l(this,"sizeX",0),l(this,"sizeY",0),l(this,"touchSizeX",0),l(this,"touchSizeY",0),l(this,"cursorStyle","crosshair"),l(this,"withConnection",!1),Object.assign(this,t)}shouldActivate(t,e,s,i){var n;let{tl:r,tr:o,br:a,bl:l}=i;return(null===(n=e.canvas)||void 0===n?void 0:n.getActiveObject())===e&&e.isControlVisible(t)&&si.isPointInPolygon(s,[r,o,a,l])}getActionHandler(t,e,s){return this.actionHandler}getMouseDownHandler(t,e,s){return this.mouseDownHandler}getMouseUpHandler(t,e,s){return this.mouseUpHandler}cursorStyleHandler(t,e,s){return e.cursorStyle}getActionName(t,e,s){return e.actionName}getVisibility(t,e){var s,i;return null!==(s=null===(i=t._controlsVisibility)||void 0===i?void 0:i[e])&&void 0!==s?s:this.visible}setVisibility(t,e,s){this.visible=t}positionHandler(t,e,s,i){return new gt(this.x*t.x+this.offsetX,this.y*t.y+this.offsetY).transform(e)}calcCornerCoords(t,e,s,i,n,r){const o=Mt([Ft(s,i),jt({angle:t}),Nt((n?this.touchSizeX:this.sizeX)||e,(n?this.touchSizeY:this.sizeY)||e)]);return{tl:new gt(-.5,-.5).transform(o),tr:new gt(.5,-.5).transform(o),br:new gt(.5,.5).transform(o),bl:new gt(-.5,.5).transform(o)}}render(t,e,s,i,n){"circle"===((i=i||{}).cornerStyle||n.cornerStyle)?ci.call(this,t,e,s,i,n):ui.call(this,t,e,s,i,n)}}const gi=(t,e,s)=>s.lockRotation?Ee:e.cursorStyle,pi=ai(H,li(((t,e,s,i)=>{let{target:n,ex:r,ey:o,theta:a,originX:l,originY:h}=e;const c=n.translateToOriginPoint(n.getRelativeCenterPoint(),l,h);if(Pe(n,"lockRotation"))return!1;const u=Math.atan2(o-c.y,r-c.x),d=Math.atan2(i-c.y,s-c.x);let g=Et(d-u+a);if(n.snapAngle&&n.snapAngle>0){const t=n.snapAngle,e=n.snapThreshold||t,s=Math.ceil(g/t)*t,i=Math.floor(g/t)*t;Math.abs(g-i)<e?g=i:Math.abs(g-s)<e&&(g=s)}g<0&&(g=360+g),g%=360;const p=n.angle!==g;return n.angle=g,p})));function fi(t,e){const s=e.canvas,i=t[s.uniScaleKey];return s.uniformScaling&&!i||!s.uniformScaling&&i}function mi(t,e,s){const i=Pe(t,"lockScalingX"),n=Pe(t,"lockScalingY");if(i&&n)return!0;if(!e&&(i||n)&&s)return!0;if(i&&"x"===e)return!0;if(n&&"y"===e)return!0;const{width:r,height:o,strokeWidth:a}=t;return 0===r&&0===a&&"y"!==e||0===o&&0===a&&"x"!==e}const _i=["e","se","s","sw","w","nw","n","ne","e"],vi=(t,e,s)=>{const i=fi(t,s);if(mi(s,0!==e.x&&0===e.y?"x":0===e.x&&0!==e.y?"y":"",i))return Ee;const n=Me(s,e);return"".concat(_i[n],"-resize")};function yi(t,e,s,i){let n=arguments.length>4&&void 0!==arguments[4]?arguments[4]:{};const r=e.target,o=n.by,a=fi(t,r);let l,h,c,u,d,g;if(mi(r,o,a))return!1;if(e.gestureScale)h=e.scaleX*e.gestureScale,c=e.scaleY*e.gestureScale;else{if(l=Re(e,e.originX,e.originY,s,i),d="y"!==o?Math.sign(l.x||e.signX||1):1,g="x"!==o?Math.sign(l.y||e.signY||1):1,e.signX||(e.signX=d),e.signY||(e.signY=g),Pe(r,"lockScalingFlip")&&(e.signX!==d||e.signY!==g))return!1;if(u=r._getTransformedDimensions(),a&&!o){const t=Math.abs(l.x)+Math.abs(l.y),{original:s}=e,i=t/(Math.abs(u.x*s.scaleX/r.scaleX)+Math.abs(u.y*s.scaleY/r.scaleY));h=s.scaleX*i,c=s.scaleY*i}else h=Math.abs(l.x*r.scaleX/u.x),c=Math.abs(l.y*r.scaleY/u.y);De(e)&&(h*=2,c*=2),e.signX!==d&&"y"!==o&&(e.originX=Ie(e.originX),h*=-1,e.signX=d),e.signY!==g&&"x"!==o&&(e.originY=Ie(e.originY),c*=-1,e.signY=g)}const p=r.scaleX,f=r.scaleY;return o?("x"===o&&r.set(J,h),"y"===o&&r.set(Z,c)):(!Pe(r,"lockScalingX")&&r.set(J,h),!Pe(r,"lockScalingY")&&r.set(Z,c)),p!==r.scaleX||f!==r.scaleY}const bi=ai(V,li(((t,e,s,i)=>yi(t,e,s,i)))),Ci=ai(V,li(((t,e,s,i)=>yi(t,e,s,i,{by:"x"})))),xi=ai(V,li(((t,e,s,i)=>yi(t,e,s,i,{by:"y"})))),wi=["target","ex","ey","skewingSide"],Si={x:{counterAxis:"y",scale:J,skew:tt,lockSkewing:"lockSkewingX",origin:"originX",flip:"flipX"},y:{counterAxis:"x",scale:Z,skew:et,lockSkewing:"lockSkewingY",origin:"originY",flip:"flipY"}},Ti=["ns","nesw","ew","nwse"],ki=(t,e,s)=>{if(0!==e.x&&Pe(s,"lockSkewingY"))return Ee;if(0!==e.y&&Pe(s,"lockSkewingX"))return Ee;const i=Me(s,e)%4;return"".concat(Ti[i],"-resize")};function Oi(t,e,s,i,n){const{target:r}=s,{counterAxis:o,origin:a,lockSkewing:l,skew:h,flip:d}=Si[t];if(Pe(r,l))return!1;const{origin:g,flip:p}=Si[o],f=Oe(s[g])*(r[p]?-1:1),m=-Math.sign(f)*(r[d]?-1:1),_=-(0===r[h]&&Re(s,L,L,i,n)[t]>0||r[h]>0?1:-1)*m*.5+.5,v=ai(G,li(((e,s,i,n)=>function(t,e,s){let{target:i,ex:n,ey:r,skewingSide:o}=e,a=u(e,wi);const{skew:l}=Si[t],h=s.subtract(new gt(n,r)).divide(new gt(i.scaleX,i.scaleY))[t],c=i[l],d=a[l],g=Math.tan(Ot(d)),p="y"===t?i._getTransformedDimensions({scaleX:1,scaleY:1,skewX:0}).x:i._getTransformedDimensions({scaleX:1,scaleY:1}).y,f=2*h*o/Math.max(p,1)+g,m=Et(Math.atan(f));i.set(l,m);const _=c!==i[l];if(_&&"y"===t){const{skewX:t,scaleX:e}=i,s=i._getTransformedDimensions({skewY:c}),n=i._getTransformedDimensions(),r=0!==t?s.x/n.x:1;1!==r&&i.set(J,r*e)}return _}(t,s,new gt(i,n)))));return v(e,c(c({},s),{},{[a]:_,skewingSide:m}),i,n)}const Ei=(t,e,s,i)=>Oi("x",t,e,s,i),Di=(t,e,s,i)=>Oi("y",t,e,s,i);function Ii(t,e){return t[e.canvas.altActionKey]}const Pi=(t,e,s)=>{const i=Ii(t,s);return 0===e.x?i?tt:Z:0===e.y?i?et:J:""},Ai=(t,e,s)=>Ii(t,s)?ki(0,e,s):vi(t,e,s),Mi=(t,e,s,i)=>Ii(t,e.target)?Di(t,e,s,i):Ci(t,e,s,i),Ri=(t,e,s,i)=>Ii(t,e.target)?Ei(t,e,s,i):xi(t,e,s,i),Li=()=>({ml:new di({x:-.5,y:0,cursorStyleHandler:Ai,actionHandler:Mi,getActionName:Pi}),mr:new di({x:.5,y:0,cursorStyleHandler:Ai,actionHandler:Mi,getActionName:Pi}),mb:new di({x:0,y:.5,cursorStyleHandler:Ai,actionHandler:Ri,getActionName:Pi}),mt:new di({x:0,y:-.5,cursorStyleHandler:Ai,actionHandler:Ri,getActionName:Pi}),tl:new di({x:-.5,y:-.5,cursorStyleHandler:vi,actionHandler:bi}),tr:new di({x:.5,y:-.5,cursorStyleHandler:vi,actionHandler:bi}),bl:new di({x:-.5,y:.5,cursorStyleHandler:vi,actionHandler:bi}),br:new di({x:.5,y:.5,cursorStyleHandler:vi,actionHandler:bi}),mtr:new di({x:0,y:-.5,actionHandler:pi,cursorStyleHandler:gi,offsetY:-40,withConnection:!0,actionName:z})}),Fi=()=>({mr:new di({x:.5,y:0,actionHandler:hi,cursorStyleHandler:Ai,actionName:U}),ml:new di({x:-.5,y:0,actionHandler:hi,cursorStyleHandler:Ai,actionName:U})}),ji=()=>c(c({},Li()),Fi());class Ni extends oi{static getDefaults(){return c(c({},super.getDefaults()),Ni.ownDefaults)}constructor(t){super(),Object.assign(this,this.constructor.createControls(),Ni.ownDefaults),this.setOptions(t)}static createControls(){return{controls:Li()}}_updateCacheCanvas(){const t=this.canvas;if(this.noScaleCache&&t&&t._currentTransform){const e=t._currentTransform,s=e.target,i=e.action;if(this===s&&i&&i.startsWith(Q))return!1}return super._updateCacheCanvas()}getActiveControl(){const t=this.__corner;return t?{key:t,control:this.controls[t],coord:this.oCoords[t]}:void 0}findControl(t){let e=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(!this.hasControls||!this.canvas)return;this.__corner=void 0;const s=Object.entries(this.oCoords);for(let i=s.length-1;i>=0;i--){const[n,r]=s[i],o=this.controls[n];if(o.shouldActivate(n,this,t,e?r.touchCorner:r.corner))return this.__corner=n,{key:n,control:o,coord:this.oCoords[n]}}}calcOCoords(){const t=this.getViewportTransform(),e=this.getCenterPoint(),s=Ft(e.x,e.y),i=jt({angle:this.getTotalAngle()-(this.group&&this.flipX?180:0)}),n=At(s,i),r=At(t,n),o=At(r,[1/t[0],0,0,1/t[3],0,0]),a=this.group?Lt(this.calcTransformMatrix()):void 0;a&&(a.scaleX=Math.abs(a.scaleX),a.scaleY=Math.abs(a.scaleY));const l=this._calculateCurrentDimensions(a),h={};return this.forEachControl(((t,e)=>{const s=t.positionHandler(l,o,this,t);h[e]=Object.assign(s,this._calcCornerCoords(t,s))})),h}_calcCornerCoords(t,e){const s=this.getTotalAngle();return{corner:t.calcCornerCoords(s,this.cornerSize,e.x,e.y,!1,this),touchCorner:t.calcCornerCoords(s,this.touchCornerSize,e.x,e.y,!0,this)}}setCoords(){super.setCoords(),this.canvas&&(this.oCoords=this.calcOCoords())}forEachControl(t){for(const e in this.controls)t(this.controls[e],e,this)}drawSelectionBackground(t){if(!this.selectionBackgroundColor||this.canvas&&this.canvas._activeObject!==this)return;t.save();const e=this.getRelativeCenterPoint(),s=this._calculateCurrentDimensions(),i=this.getViewportTransform();t.translate(e.x,e.y),t.scale(1/i[0],1/i[3]),t.rotate(Ot(this.angle)),t.fillStyle=this.selectionBackgroundColor,t.fillRect(-s.x/2,-s.y/2,s.x,s.y),t.restore()}strokeBorders(t,e){t.strokeRect(-e.x/2,-e.y/2,e.x,e.y)}_drawBorders(t,e){let s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};const i=c({hasControls:this.hasControls,borderColor:this.borderColor,borderDashArray:this.borderDashArray},s);t.save(),t.strokeStyle=i.borderColor,this._setLineDash(t,i.borderDashArray),this.strokeBorders(t,e),i.hasControls&&this.drawControlsConnectingLines(t,e),t.restore()}_renderControls(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const{hasBorders:s,hasControls:i}=this,n=c({hasBorders:s,hasControls:i},e),r=this.getViewportTransform(),o=n.hasBorders,a=n.hasControls,l=At(r,this.calcTransformMatrix()),h=Lt(l);t.save(),t.translate(h.translateX,h.translateY),t.lineWidth=this.borderScaleFactor,this.group===this.parent&&(t.globalAlpha=this.isMoving?this.borderOpacityWhenMoving:1),this.flipX&&(h.angle-=180),t.rotate(Ot(this.group?h.angle:this.angle)),o&&this.drawBorders(t,h,e),a&&this.drawControls(t,e),t.restore()}drawBorders(t,e,s){let i;if(s&&s.forActiveSelection||this.group){const t=be(this.width,this.height,Yt(e)),s=this.isStrokeAccountedForInDimensions()?pt:(this.strokeUniform?(new gt).scalarAdd(this.canvas?this.canvas.getZoom():1):new gt(e.scaleX,e.scaleY)).scalarMultiply(this.strokeWidth);i=t.add(s).scalarAdd(this.borderScaleFactor).scalarAdd(2*this.padding)}else i=this._calculateCurrentDimensions().scalarAdd(this.borderScaleFactor);this._drawBorders(t,i,s)}drawControlsConnectingLines(t,e){let s=!1;t.beginPath(),this.forEachControl(((i,n)=>{i.withConnection&&i.getVisibility(this,n)&&(s=!0,t.moveTo(i.x*e.x,i.y*e.y),t.lineTo(i.x*e.x+i.offsetX,i.y*e.y+i.offsetY))})),s&&t.stroke()}drawControls(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};t.save();const s=this.getCanvasRetinaScaling(),{cornerStrokeColor:i,cornerDashArray:n,cornerColor:r}=this,o=c({cornerStrokeColor:i,cornerDashArray:n,cornerColor:r},e);t.setTransform(s,0,0,s,0,0),t.strokeStyle=t.fillStyle=o.cornerColor,this.transparentCorners||(t.strokeStyle=o.cornerStrokeColor),this._setLineDash(t,o.cornerDashArray),this.forEachControl(((e,s)=>{if(e.getVisibility(this,s)){const i=this.oCoords[s];e.render(t,i.x,i.y,o,this)}})),t.restore()}isControlVisible(t){return this.controls[t]&&this.controls[t].getVisibility(this,t)}setControlVisible(t,e){this._controlsVisibility||(this._controlsVisibility={}),this._controlsVisibility[t]=e}setControlsVisibility(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};Object.entries(t).forEach((t=>{let[e,s]=t;return this.setControlVisible(e,s)}))}clearContextTop(t){if(!this.canvas)return;const e=this.canvas.contextTop;if(!e)return;const s=this.canvas.viewportTransform;e.save(),e.transform(s[0],s[1],s[2],s[3],s[4],s[5]),this.transform(e);const i=this.width+4,n=this.height+4;return e.clearRect(-i/2,-n/2,i,n),t||e.restore(),e}onDeselect(t){return!1}onSelect(t){return!1}shouldStartDragging(t){return!1}onDragStart(t){return!1}canDrop(t){return!1}renderDragSourceEffect(t){}renderDropTargetEffect(t){}}function Bi(t,e){return e.forEach((e=>{Object.getOwnPropertyNames(e.prototype).forEach((s=>{"constructor"!==s&&Object.defineProperty(t.prototype,s,Object.getOwnPropertyDescriptor(e.prototype,s)||Object.create(null))}))})),t}l(Ni,"ownDefaults",{noScaleCache:!0,lockMovementX:!1,lockMovementY:!1,lockRotation:!1,lockScalingX:!1,lockScalingY:!1,lockSkewingX:!1,lockSkewingY:!1,lockScalingFlip:!1,cornerSize:13,touchCornerSize:24,transparentCorners:!0,cornerColor:"rgb(178,204,255)",cornerStrokeColor:"",cornerStyle:"rect",cornerDashArray:null,hasControls:!0,borderColor:"rgb(178,204,255)",borderDashArray:null,borderOpacityWhenMoving:.4,borderScaleFactor:1,hasBorders:!0,selectionBackgroundColor:"",selectable:!0,evented:!0,perPixelTargetFind:!1,activeOn:"down",hoverCursor:null,moveCursor:null});class Wi extends Ni{}Bi(Wi,[Ge]),at.setClass(Wi),at.setClass(Wi,"object");const Xi=(t,e,s,i)=>{const n=2*(i=Math.round(i))+1,{data:r}=t.getImageData(e-i,s-i,n,n);for(let o=3;o<r.length;o+=4)if(r[o]>0)return!1;return!0};class Yi{constructor(t){this.options=t,this.strokeProjectionMagnitude=this.options.strokeWidth/2,this.scale=new gt(this.options.scaleX,this.options.scaleY),this.strokeUniformScalar=this.options.strokeUniform?new gt(1/this.options.scaleX,1/this.options.scaleY):new gt(1,1)}createSideVector(t,e){const s=xs(t,e);return this.options.strokeUniform?s.multiply(this.scale):s}projectOrthogonally(t,e,s){return this.applySkew(t.add(this.calcOrthogonalProjection(t,e,s)))}isSkewed(){return 0!==this.options.skewX||0!==this.options.skewY}applySkew(t){const e=new gt(t);return e.y+=e.x*Math.tan(Ot(this.options.skewY)),e.x+=e.y*Math.tan(Ot(this.options.skewX)),e}scaleUnitVector(t,e){return t.multiply(this.strokeUniformScalar).scalarMultiply(e)}}const Vi=new gt;class Hi extends Yi{static getOrthogonalRotationFactor(t,e){const s=e?Ss(t,e):Ts(t);return Math.abs(s)<D?-1:1}constructor(t,e,s,i){super(i),l(this,"AB",void 0),l(this,"AC",void 0),l(this,"alpha",void 0),l(this,"bisector",void 0),this.A=new gt(t),this.B=new gt(e),this.C=new gt(s),this.AB=this.createSideVector(this.A,this.B),this.AC=this.createSideVector(this.A,this.C),this.alpha=Ss(this.AB,this.AC),this.bisector=ks(Cs(this.AB.eq(Vi)?this.AC:this.AB,this.alpha/2))}calcOrthogonalProjection(t,e){let s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:this.strokeProjectionMagnitude;const i=this.createSideVector(t,e),n=Os(i),r=Hi.getOrthogonalRotationFactor(n,this.bisector);return this.scaleUnitVector(n,s*r)}projectBevel(){const t=[];return(this.alpha%I==0?[this.B]:[this.B,this.C]).forEach((e=>{t.push(this.projectOrthogonally(this.A,e)),t.push(this.projectOrthogonally(this.A,e,-this.strokeProjectionMagnitude))})),t}projectMiter(){const t=[],e=Math.abs(this.alpha),s=1/Math.sin(e/2),i=this.scaleUnitVector(this.bisector,-this.strokeProjectionMagnitude*s),n=this.options.strokeUniform?ws(this.scaleUnitVector(this.bisector,this.options.strokeMiterLimit)):this.options.strokeMiterLimit;return ws(i)/this.strokeProjectionMagnitude<=n&&t.push(this.applySkew(this.A.add(i))),t.push(...this.projectBevel()),t}projectRoundNoSkew(t,e){const s=[],i=new gt(Hi.getOrthogonalRotationFactor(this.bisector),Hi.getOrthogonalRotationFactor(new gt(this.bisector.y,this.bisector.x)));return[new gt(1,0).scalarMultiply(this.strokeProjectionMagnitude).multiply(this.strokeUniformScalar).multiply(i),new gt(0,1).scalarMultiply(this.strokeProjectionMagnitude).multiply(this.strokeUniformScalar).multiply(i)].forEach((i=>{Is(i,t,e)&&s.push(this.A.add(i))})),s}projectRoundWithSkew(t,e){const s=[],{skewX:i,skewY:n,scaleX:r,scaleY:o,strokeUniform:a}=this.options,l=new gt(Math.tan(Ot(i)),Math.tan(Ot(n))),h=this.strokeProjectionMagnitude,c=a?h/o/Math.sqrt(1/o**2+1/r**2*l.y**2):h/Math.sqrt(1+l.y**2),u=new gt(Math.sqrt(Math.max(h**2-c**2,0)),c),d=a?h/Math.sqrt(1+l.x**2*(1/o)**2/(1/r+1/r*l.x*l.y)**2):h/Math.sqrt(1+l.x**2/(1+l.x*l.y)**2),g=new gt(d,Math.sqrt(Math.max(h**2-d**2,0)));return[g,g.scalarMultiply(-1),u,u.scalarMultiply(-1)].map((t=>this.applySkew(a?t.multiply(this.strokeUniformScalar):t))).forEach((i=>{Is(i,t,e)&&s.push(this.applySkew(this.A).add(i))})),s}projectRound(){const t=[];t.push(...this.projectBevel());const e=this.alpha%I==0,s=this.applySkew(this.A),i=t[e?0:2].subtract(s),n=t[e?1:0].subtract(s),r=e?this.applySkew(this.AB.scalarMultiply(-1)):this.applySkew(this.bisector.multiply(this.strokeUniformScalar).scalarMultiply(-1)),o=Es(i,r)>0,a=o?i:n,l=o?n:i;return this.isSkewed()?t.push(...this.projectRoundWithSkew(a,l)):t.push(...this.projectRoundNoSkew(a,l)),t}projectPoints(){switch(this.options.strokeLineJoin){case"miter":return this.projectMiter();case"round":return this.projectRound();default:return this.projectBevel()}}project(){return this.projectPoints().map((t=>({originPoint:this.A,projectedPoint:t,angle:this.alpha,bisector:this.bisector})))}}class zi extends Yi{constructor(t,e,s){super(s),this.A=new gt(t),this.T=new gt(e)}calcOrthogonalProjection(t,e){let s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:this.strokeProjectionMagnitude;const i=this.createSideVector(t,e);return this.scaleUnitVector(Os(i),s)}projectButt(){return[this.projectOrthogonally(this.A,this.T,this.strokeProjectionMagnitude),this.projectOrthogonally(this.A,this.T,-this.strokeProjectionMagnitude)]}projectRound(){const t=[];if(!this.isSkewed()&&this.A.eq(this.T)){const e=new gt(1,1).scalarMultiply(this.strokeProjectionMagnitude).multiply(this.strokeUniformScalar);t.push(this.applySkew(this.A.add(e)),this.applySkew(this.A.subtract(e)))}else t.push(...new Hi(this.A,this.T,this.T,this.options).projectRound());return t}projectSquare(){const t=[];if(this.A.eq(this.T)){const e=new gt(1,1).scalarMultiply(this.strokeProjectionMagnitude).multiply(this.strokeUniformScalar);t.push(this.A.add(e),this.A.subtract(e))}else{const e=this.calcOrthogonalProjection(this.A,this.T,this.strokeProjectionMagnitude),s=this.scaleUnitVector(ks(this.createSideVector(this.A,this.T)),-this.strokeProjectionMagnitude),i=this.A.add(s);t.push(i.add(e),i.subtract(e))}return t.map((t=>this.applySkew(t)))}projectPoints(){switch(this.options.strokeLineCap){case"round":return this.projectRound();case"square":return this.projectSquare();default:return this.projectButt()}}project(){return this.projectPoints().map((t=>({originPoint:this.A,projectedPoint:t})))}}const Gi=function(t,e){let s=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const i=[];if(0===t.length)return i;const n=t.reduce(((t,e)=>(t[t.length-1].eq(e)||t.push(new gt(e)),t)),[new gt(t[0])]);if(1===n.length)s=!0;else if(!s){const t=n[0],e=((t,e)=>{for(let s=t.length-1;s>=0;s--)if(e(t[s],s,t))return s;return-1})(n,(e=>!e.eq(t)));n.splice(e+1)}return n.forEach(((t,n,r)=>{let o,a;0===n?(a=r[1],o=s?t:r[r.length-1]):n===r.length-1?(o=r[n-1],a=s?t:r[0]):(o=r[n-1],a=r[n+1]),s&&1===r.length?i.push(...new zi(t,t,e).project()):!s||0!==n&&n!==r.length-1?i.push(...new Hi(t,o,a,e).project()):i.push(...new zi(t,0===n?a:o,e).project())})),i},Ui=t=>{const e={};return Object.keys(t).forEach((s=>{e[s]={},Object.keys(t[s]).forEach((i=>{e[s][i]=c({},t[s][i])}))})),e},qi=t=>t.replace(/&/g,"&amp;").replace(/"/g,"&quot;").replace(/'/g,"&apos;").replace(/</g,"&lt;").replace(/>/g,"&gt;");let Ki;const $i=t=>{if(Ki||Ki||(Ki="Intl"in S()&&"Segmenter"in Intl&&new Intl.Segmenter(void 0,{granularity:"grapheme"})),Ki){const e=Ki.segment(t);return Array.from(e).map((t=>{let{segment:e}=t;return e}))}return Qi(t)},Qi=t=>{const e=[];for(let s,i=0;i<t.length;i++)!1!==(s=Ji(t,i))&&e.push(s);return e},Ji=(t,e)=>{const s=t.charCodeAt(e);if(isNaN(s))return"";if(s<55296||s>57343)return t.charAt(e);if(55296<=s&&s<=56319){if(t.length<=e+1)throw"High surrogate without following low surrogate";const s=t.charCodeAt(e+1);if(56320>s||s>57343)throw"High surrogate without following low surrogate";return t.charAt(e)+t.charAt(e+1)}if(0===e)throw"Low surrogate without preceding high surrogate";const i=t.charCodeAt(e-1);if(55296>i||i>56319)throw"Low surrogate without preceding high surrogate";return!1};var Zi=Object.freeze({__proto__:null,capitalize:function(t){let e=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return"".concat(t.charAt(0).toUpperCase()).concat(e?t.slice(1):t.slice(1).toLowerCase())},escapeXml:qi,graphemeSplit:$i});const tn=function(t,e){let s=arguments.length>2&&void 0!==arguments[2]&&arguments[2];return t.fill!==e.fill||t.stroke!==e.stroke||t.strokeWidth!==e.strokeWidth||t.fontSize!==e.fontSize||t.fontFamily!==e.fontFamily||t.fontWeight!==e.fontWeight||t.fontStyle!==e.fontStyle||t.textDecorationThickness!==e.textDecorationThickness||t.textBackgroundColor!==e.textBackgroundColor||t.deltaY!==e.deltaY||s&&(t.overline!==e.overline||t.underline!==e.underline||t.linethrough!==e.linethrough)},en=(t,e)=>{const s=e.split("\n"),i=[];let n=-1,r={};t=Ui(t);for(let o=0;o<s.length;o++){const e=$i(s[o]);if(t[o])for(let s=0;s<e.length;s++){n++;const e=t[o][s];e&&Object.keys(e).length>0&&(tn(r,e,!0)?i.push({start:n,end:n+1,style:e}):i[i.length-1].end++),r=e||{}}else n+=e.length,r={}}return i},sn=(t,e)=>{if(!Array.isArray(t))return Ui(t);const s=e.split(X),i={};let n=-1,r=0;for(let o=0;o<s.length;o++){const e=$i(s[o]);for(let s=0;s<e.length;s++)n++,t[r]&&t[r].start<=n&&n<t[r].end&&(i[o]=i[o]||{},i[o][s]=c({},t[r].style),n===t[r].end-1&&r++)}return i},nn=["display","transform",st,"fill-opacity","fill-rule","opacity",it,"stroke-dasharray","stroke-linecap","stroke-dashoffset","stroke-linejoin","stroke-miterlimit","stroke-opacity","stroke-width","id","paint-order","vector-effect","instantiated_by_use","clip-path"];function rn(t,e){const s=t.nodeName,i=t.getAttribute("class"),n=t.getAttribute("id"),r="(?![a-zA-Z\\-]+)";let o;if(o=new RegExp("^"+s,"i"),e=e.replace(o,""),n&&e.length&&(o=new RegExp("#"+n+r,"i"),e=e.replace(o,"")),i&&e.length){const t=i.split(" ");for(let s=t.length;s--;)o=new RegExp("\\."+t[s]+r,"i"),e=e.replace(o,"")}return 0===e.length}function on(t,e){let s=!0;const i=rn(t,e.pop());return i&&e.length&&(s=function(t,e){let s,i=!0;for(;t.parentElement&&1===t.parentElement.nodeType&&e.length;)i&&(s=e.pop()),i=rn(t=t.parentElement,s);return 0===e.length}(t,e)),i&&s&&0===e.length}const an=t=>{var e;return null!==(e=ds[t])&&void 0!==e?e:t},ln=new RegExp("(".concat(ls,")"),"gi"),hn=t=>t.replace(ln," $1 ").replace(/,/gi," ").replace(/\s+/gi," ");var cn,un,dn,gn,pn,fn,mn;const _n="(".concat(ls,")"),vn=String.raw(cn||(cn=d(["(skewX)(",")"],["(skewX)\\(","\\)"])),_n),yn=String.raw(un||(un=d(["(skewY)(",")"],["(skewY)\\(","\\)"])),_n),bn=String.raw(dn||(dn=d(["(rotate)(","(?: "," ",")?)"],["(rotate)\\(","(?: "," ",")?\\)"])),_n,_n,_n),Cn=String.raw(gn||(gn=d(["(scale)(","(?: ",")?)"],["(scale)\\(","(?: ",")?\\)"])),_n,_n),xn=String.raw(pn||(pn=d(["(translate)(","(?: ",")?)"],["(translate)\\(","(?: ",")?\\)"])),_n,_n),wn=String.raw(fn||(fn=d(["(matrix)("," "," "," "," "," ",")"],["(matrix)\\("," "," "," "," "," ","\\)"])),_n,_n,_n,_n,_n,_n),Sn="(?:".concat(wn,"|").concat(xn,"|").concat(bn,"|").concat(Cn,"|").concat(vn,"|").concat(yn,")"),Tn="(?:".concat(Sn,"*)"),kn=String.raw(mn||(mn=d(["^s*(?:","?)s*$"],["^\\s*(?:","?)\\s*$"])),Tn),On=new RegExp(kn),En=new RegExp(Sn),Dn=new RegExp(Sn,"g");function In(t){const e=[];if(!(t=hn(t).replace(/\s*([()])\s*/gi,"$1"))||t&&!On.test(t))return[...A];for(const s of t.matchAll(Dn)){const t=En.exec(s[0]);if(!t)continue;let i=A;const n=t.filter((t=>!!t)),[,r,...o]=n,[a,l,h,c,u,d]=o.map((t=>parseFloat(t)));switch(r){case"translate":i=Ft(a,l);break;case z:i=jt({angle:a},{x:l,y:h});break;case Q:i=Nt(a,l);break;case tt:i=Wt(a);break;case et:i=Xt(a);break;case"matrix":i=[a,l,h,c,u,d]}e.push(i)}return Mt(e)}function Pn(t,e,s,i){const n=Array.isArray(e);let r,o=e;if(t!==st&&t!==it||e!==W){if("strokeUniform"===t)return"non-scaling-stroke"===e;if("strokeDashArray"===t)o=e===W?null:e.replace(/,/g," ").split(/\s+/).map(parseFloat);else if("transformMatrix"===t)o=s&&s.transformMatrix?At(s.transformMatrix,In(e)):In(e);else if("visible"===t)o=e!==W&&"hidden"!==e,s&&!1===s.visible&&(o=!1);else if("opacity"===t)o=parseFloat(e),s&&void 0!==s.opacity&&(o*=s.opacity);else if("textAnchor"===t)o="start"===e?F:"end"===e?B:L;else if("charSpacing"===t||t===qe)r=Ve(e,i)/i*1e3;else if("paintFirst"===t){const t=e.indexOf(st),s=e.indexOf(it);o=st,(t>-1&&s>-1&&s<t||-1===t&&s>-1)&&(o=it)}else{if("href"===t||"xlink:href"===t||"font"===t||"id"===t)return e;if("imageSmoothing"===t)return"optimizeQuality"===e;r=n?e.map(Ve):Ve(e,i)}}else o="";return!n&&isNaN(r)?o:r}function An(t,e){const s=t.match(us);if(!s)return;const i=s[1],n=s[3],r=s[4],o=s[5],a=s[6];i&&(e.fontStyle=i),n&&(e.fontWeight=isNaN(parseFloat(n))?n:parseFloat(n)),r&&(e.fontSize=Ve(r)),a&&(e.fontFamily=a),o&&(e.lineHeight="normal"===o?1:o)}function Mn(t,e){t.replace(/;\s*$/,"").split(";").forEach((t=>{if(!t)return;const[s,i]=t.split(":");e[s.trim().toLowerCase()]=i.trim()}))}function Rn(t){const e={},s=t.getAttribute("style");return s?("string"==typeof s?Mn(s,e):function(t,e){Object.entries(t).forEach((t=>{let[s,i]=t;void 0!==i&&(e[s.toLowerCase()]=i)}))}(s,e),e):e}const Ln={stroke:"strokeOpacity",fill:"fillOpacity"};function Fn(t,e,s){if(!t)return{};let i,n={},r=M;t.parentNode&&_s.test(t.parentNode.nodeName)&&(n=Fn(t.parentElement,e,s),n.fontSize&&(i=r=Ve(n.fontSize)));const o=c(c(c({},e.reduce(((e,s)=>{const i=t.getAttribute(s);return i&&(e[s]=i),e}),{})),function(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},s={};for(const i in e)on(t,i.split(" "))&&(s=c(c({},s),e[i]));return s}(t,s)),Rn(t));o[ps]&&t.setAttribute(ps,o[ps]),o[gs]&&(i=Ve(o[gs],r),o[gs]="".concat(i));const a={};for(const h in o){const t=an(h),e=Pn(t,o[h],n,i);a[t]=e}a&&a.font&&An(a.font,a);const l=c(c({},n),a);return _s.test(t.nodeName)?l:function(t){const e=Wi.getDefaults();return Object.entries(Ln).forEach((s=>{let[i,n]=s;if(void 0===t[n]||""===t[i])return;if(void 0===t[i]){if(!e[i])return;t[i]=e[i]}if(0===t[i].indexOf("url("))return;const r=new Ye(t[i]);t[i]=r.setAlpha(Kt(r.getAlpha()*t[n],2)).toRgba()})),t}(l)}const jn=["left","top","width","height","visible"],Nn=["rx","ry"];class Bn extends Wi{static getDefaults(){return c(c({},super.getDefaults()),Bn.ownDefaults)}constructor(t){super(),Object.assign(this,Bn.ownDefaults),this.setOptions(t),this._initRxRy()}_initRxRy(){const{rx:t,ry:e}=this;t&&!e?this.ry=t:e&&!t&&(this.rx=e)}_render(t){const{width:e,height:s}=this,i=-e/2,n=-s/2,r=this.rx?Math.min(this.rx,e/2):0,o=this.ry?Math.min(this.ry,s/2):0,a=0!==r||0!==o;t.beginPath(),t.moveTo(i+r,n),t.lineTo(i+e-r,n),a&&t.bezierCurveTo(i+e-R*r,n,i+e,n+R*o,i+e,n+o),t.lineTo(i+e,n+s-o),a&&t.bezierCurveTo(i+e,n+s-R*o,i+e-R*r,n+s,i+e-r,n+s),t.lineTo(i+r,n+s),a&&t.bezierCurveTo(i+R*r,n+s,i,n+s-R*o,i,n+s-o),t.lineTo(i,n+o),a&&t.bezierCurveTo(i,n+R*o,i+R*r,n,i+r,n),t.closePath(),this._renderPaintInOrder(t)}toObject(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];return super.toObject([...Nn,...t])}_toSVG(){const{width:t,height:e,rx:s,ry:i}=this;return["<rect ","COMMON_PARTS",'x="'.concat(-t/2,'" y="').concat(-e/2,'" rx="').concat(s,'" ry="').concat(i,'" width="').concat(t,'" height="').concat(e,'" />\n')]}static async fromElement(t,e,s){const i=Fn(t,this.ATTRIBUTE_NAMES,s),{left:n=0,top:r=0,width:o=0,height:a=0,visible:l=!0}=i,h=u(i,jn);return new this(c(c(c({},e),h),{},{left:n,top:r,width:o,height:a,visible:Boolean(l&&o&&a)}))}}l(Bn,"type","Rect"),l(Bn,"cacheProperties",[...Fs,...Nn]),l(Bn,"ownDefaults",{rx:0,ry:0}),l(Bn,"ATTRIBUTE_NAMES",[...nn,"x","y","rx","ry","width","height"]),at.setClass(Bn),at.setSVGClass(Bn);const Wn="initialization",Xn="added",Yn="removed",Vn="imperative",Hn=(t,e)=>{const{strokeUniform:s,strokeWidth:i,width:n,height:r,group:o}=e,a=o&&o!==t?Ce(o.calcTransformMatrix(),t.calcTransformMatrix()):null,l=a?e.getRelativeCenterPoint().transform(a):e.getRelativeCenterPoint(),h=!e.isStrokeAccountedForInDimensions(),c=s&&h?we(new gt(i,i),void 0,t.calcTransformMatrix()):pt,u=!s&&h?i:0,d=be(n+u,r+u,Mt([a,e.calcOwnMatrix()],!0)).add(c).scalarDivide(2);return[l.subtract(d),l.add(d)]};class zn{calcLayoutResult(t,e){if(this.shouldPerformLayout(t))return this.calcBoundingBox(e,t)}shouldPerformLayout(t){let{type:e,prevStrategy:s,strategy:i}=t;return e===Wn||e===Vn||!!s&&i!==s}shouldLayoutClipPath(t){let{type:e,target:{clipPath:s}}=t;return e!==Wn&&s&&!s.absolutePositioned}getInitialSize(t,e){return e.size}calcBoundingBox(t,e){const{type:s,target:i}=e;if(s===Vn&&e.overrides)return e.overrides;if(0===t.length)return;const{left:n,top:r,width:o,height:a}=pe(t.map((t=>Hn(i,t))).reduce(((t,e)=>t.concat(e)),[])),l=new gt(o,a),h=new gt(n,r).add(l.scalarDivide(2));if(s===Wn){const t=this.getInitialSize(e,{size:l,center:h});return{center:h,relativeCorrection:new gt(0,0),size:t}}return{center:h.transform(i.calcOwnMatrix()),size:l}}}l(zn,"type","strategy");class Gn extends zn{shouldPerformLayout(t){return!0}}l(Gn,"type","fit-content"),at.setClass(Gn);const Un=["strategy"],qn=["target","strategy","bubbles","prevStrategy"],Kn="layoutManager";class $n{constructor(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new Gn;l(this,"strategy",void 0),this.strategy=t,this._subscriptions=new Map}performLayout(t){const e=c(c({bubbles:!0,strategy:this.strategy},t),{},{prevStrategy:this._prevLayoutStrategy,stopPropagation(){this.bubbles=!1}});this.onBeforeLayout(e);const s=this.getLayoutResult(e);s&&this.commitLayout(e,s),this.onAfterLayout(e,s),this._prevLayoutStrategy=e.strategy}attachHandlers(t,e){const{target:s}=e;return[nt,Y,U,H,V,G,$,q,K].map((e=>t.on(e,(t=>this.performLayout(e===nt?{type:"object_modified",trigger:e,e:t,target:s}:{type:"object_modifying",trigger:e,e:t,target:s})))))}subscribe(t,e){this.unsubscribe(t,e);const s=this.attachHandlers(t,e);this._subscriptions.set(t,s)}unsubscribe(t,e){(this._subscriptions.get(t)||[]).forEach((t=>t())),this._subscriptions.delete(t)}unsubscribeTargets(t){t.targets.forEach((e=>this.unsubscribe(e,t)))}subscribeTargets(t){t.targets.forEach((e=>this.subscribe(e,t)))}onBeforeLayout(t){const{target:e,type:s}=t,{canvas:i}=e;if(s===Wn||s===Xn?this.subscribeTargets(t):s===Yn&&this.unsubscribeTargets(t),e.fire("layout:before",{context:t}),i&&i.fire("object:layout:before",{target:e,context:t}),s===Vn&&t.deep){const s=u(t,Un);e.forEachObject((t=>t.layoutManager&&t.layoutManager.performLayout(c(c({},s),{},{bubbles:!1,target:t}))))}}getLayoutResult(t){const{target:e,strategy:s,type:i}=t,n=s.calcLayoutResult(t,e.getObjects());if(!n)return;const r=i===Wn?new gt:e.getRelativeCenterPoint(),{center:o,correction:a=new gt,relativeCorrection:l=new gt}=n,h=r.subtract(o).add(a).transform(i===Wn?A:Pt(e.calcOwnMatrix()),!0).add(l);return{result:n,prevCenter:r,nextCenter:o,offset:h}}commitLayout(t,e){const{target:s}=t,{result:{size:i},nextCenter:n}=e;var r,o;s.set({width:i.x,height:i.y}),this.layoutObjects(t,e),t.type===Wn?s.set({left:null!==(r=t.x)&&void 0!==r?r:n.x+i.x*Oe(s.originX),top:null!==(o=t.y)&&void 0!==o?o:n.y+i.y*Oe(s.originY)}):(s.setPositionByOrigin(n,L,L),s.setCoords(),s.set("dirty",!0))}layoutObjects(t,e){const{target:s}=t;s.forEachObject((i=>{i.group===s&&this.layoutObject(t,e,i)})),t.strategy.shouldLayoutClipPath(t)&&this.layoutObject(t,e,s.clipPath)}layoutObject(t,e,s){let{offset:i}=e;s.set({left:s.left+i.x,top:s.top+i.y})}onAfterLayout(t,e){const{target:s,strategy:i,bubbles:n,prevStrategy:r}=t,o=u(t,qn),{canvas:a}=s;s.fire("layout:after",{context:t,result:e}),a&&a.fire("object:layout:after",{context:t,result:e,target:s});const l=s.parent;n&&null!=l&&l.layoutManager&&((o.path||(o.path=[])).push(s),l.layoutManager.performLayout(c(c({},o),{},{target:l}))),s.set("dirty",!0)}dispose(){const{_subscriptions:t}=this;t.forEach((t=>t.forEach((t=>t())))),t.clear()}toObject(){return{type:Kn,strategy:this.strategy.constructor.type}}toJSON(){return this.toObject()}}at.setClass($n,Kn);const Qn=["type","objects","layoutManager"];class Jn extends $n{performLayout(){}}class Zn extends(mt(Wi)){static getDefaults(){return c(c({},super.getDefaults()),Zn.ownDefaults)}constructor(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};super(),l(this,"_activeObjects",[]),l(this,"__objectSelectionTracker",void 0),l(this,"__objectSelectionDisposer",void 0),Object.assign(this,Zn.ownDefaults),this.setOptions(e),this.groupInit(t,e)}groupInit(t,e){var s;this._objects=[...t],this.__objectSelectionTracker=this.__objectSelectionMonitor.bind(this,!0),this.__objectSelectionDisposer=this.__objectSelectionMonitor.bind(this,!1),this.forEachObject((t=>{this.enterGroup(t,!1)})),this.layoutManager=null!==(s=e.layoutManager)&&void 0!==s?s:new $n,this.layoutManager.performLayout({type:Wn,target:this,targets:[...t],x:e.left,y:e.top})}canEnterGroup(t){return t===this||this.isDescendantOf(t)?(f("error","Group: circular object trees are not supported, this call has no effect"),!1):-1===this._objects.indexOf(t)||(f("error","Group: duplicate objects are not supported inside group, this call has no effect"),!1)}_filterObjectsBeforeEnteringGroup(t){return t.filter(((t,e,s)=>this.canEnterGroup(t)&&s.indexOf(t)===e))}add(){for(var t=arguments.length,e=new Array(t),s=0;s<t;s++)e[s]=arguments[s];const i=this._filterObjectsBeforeEnteringGroup(e),n=super.add(...i);return this._onAfterObjectsChange(Xn,i),n}insertAt(t){for(var e=arguments.length,s=new Array(e>1?e-1:0),i=1;i<e;i++)s[i-1]=arguments[i];const n=this._filterObjectsBeforeEnteringGroup(s),r=super.insertAt(t,...n);return this._onAfterObjectsChange(Xn,n),r}remove(){const t=super.remove(...arguments);return this._onAfterObjectsChange(Yn,t),t}_onObjectAdded(t){this.enterGroup(t,!0),this.fire("object:added",{target:t}),t.fire("added",{target:this})}_onObjectRemoved(t,e){this.exitGroup(t,e),this.fire("object:removed",{target:t}),t.fire("removed",{target:this})}_onAfterObjectsChange(t,e){this.layoutManager.performLayout({type:t,targets:e,target:this})}_onStackOrderChanged(){this._set("dirty",!0)}_set(t,e){const s=this[t];return super._set(t,e),"canvas"===t&&s!==e&&(this._objects||[]).forEach((s=>{s._set(t,e)})),this}_shouldSetNestedCoords(){return this.subTargetCheck}removeAll(){return this._activeObjects=[],this.remove(...this._objects)}__objectSelectionMonitor(t,e){let{target:s}=e;const i=this._activeObjects;if(t)i.push(s),this._set("dirty",!0);else if(i.length>0){const t=i.indexOf(s);t>-1&&(i.splice(t,1),this._set("dirty",!0))}}_watchObject(t,e){t&&this._watchObject(!1,e),t?(e.on("selected",this.__objectSelectionTracker),e.on("deselected",this.__objectSelectionDisposer)):(e.off("selected",this.__objectSelectionTracker),e.off("deselected",this.__objectSelectionDisposer))}enterGroup(t,e){t.group&&t.group.remove(t),t._set("parent",this),this._enterGroup(t,e)}_enterGroup(t,e){e&&_e(t,At(Pt(this.calcTransformMatrix()),t.calcTransformMatrix())),this._shouldSetNestedCoords()&&t.setCoords(),t._set("group",this),t._set("canvas",this.canvas),this._watchObject(!0,t);const s=this.canvas&&this.canvas.getActiveObject&&this.canvas.getActiveObject();s&&(s===t||t.isDescendantOf(s))&&this._activeObjects.push(t)}exitGroup(t,e){this._exitGroup(t,e),t._set("parent",void 0),t._set("canvas",void 0)}_exitGroup(t,e){t._set("group",void 0),e||(_e(t,At(this.calcTransformMatrix(),t.calcTransformMatrix())),t.setCoords()),this._watchObject(!1,t);const s=this._activeObjects.length>0?this._activeObjects.indexOf(t):-1;s>-1&&this._activeObjects.splice(s,1)}shouldCache(){const t=Wi.prototype.shouldCache.call(this);if(t)for(let e=0;e<this._objects.length;e++)if(this._objects[e].willDrawShadow())return this.ownCaching=!1,!1;return t}willDrawShadow(){if(super.willDrawShadow())return!0;for(let t=0;t<this._objects.length;t++)if(this._objects[t].willDrawShadow())return!0;return!1}isOnACache(){return this.ownCaching||!!this.parent&&this.parent.isOnACache()}drawObject(t,e,s){this._renderBackground(t);for(let n=0;n<this._objects.length;n++){var i;const e=this._objects[n];null!==(i=this.canvas)&&void 0!==i&&i.preserveObjectStacking&&e.group!==this?(t.save(),t.transform(...Pt(this.calcTransformMatrix())),e.render(t),t.restore()):e.group===this&&e.render(t)}this._drawClipPath(t,this.clipPath,s)}setCoords(){super.setCoords(),this._shouldSetNestedCoords()&&this.forEachObject((t=>t.setCoords()))}triggerLayout(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};this.layoutManager.performLayout(c({target:this,type:Vn},t))}render(t){this._transformDone=!0,super.render(t),this._transformDone=!1}__serializeObjects(t,e){const s=this.includeDefaultValues;return this._objects.filter((function(t){return!t.excludeFromExport})).map((function(i){const n=i.includeDefaultValues;i.includeDefaultValues=s;const r=i[t||"toObject"](e);return i.includeDefaultValues=n,r}))}toObject(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];const e=this.layoutManager.toObject();return c(c(c({},super.toObject(["subTargetCheck","interactive",...t])),"fit-content"!==e.strategy||this.includeDefaultValues?{layoutManager:e}:{}),{},{objects:this.__serializeObjects("toObject",t)})}toString(){return"#<Group: (".concat(this.complexity(),")>")}dispose(){this.layoutManager.unsubscribeTargets({targets:this.getObjects(),target:this}),this._activeObjects=[],this.forEachObject((t=>{this._watchObject(!1,t),t.dispose()})),super.dispose()}_createSVGBgRect(t){if(!this.backgroundColor)return"";const e=Bn.prototype._toSVG.call(this),s=e.indexOf("COMMON_PARTS");e[s]='for="group" ';const i=e.join("");return t?t(i):i}_toSVG(t){const e=["<g ","COMMON_PARTS"," >\n"],s=this._createSVGBgRect(t);s&&e.push("\t\t",s);for(let i=0;i<this._objects.length;i++)e.push("\t\t",this._objects[i].toSVG(t));return e.push("</g>\n"),e}getSvgStyles(){const t=void 0!==this.opacity&&1!==this.opacity?"opacity: ".concat(this.opacity,";"):"",e=this.visible?"":" visibility: hidden;";return[t,this.getSvgFilter(),e].join("")}toClipPathSVG(t){const e=[],s=this._createSVGBgRect(t);s&&e.push("\t",s);for(let i=0;i<this._objects.length;i++)e.push("\t",this._objects[i].toClipPathSVG(t));return this._createBaseClipPathSVGMarkup(e,{reviver:t})}static fromObject(t,e){let{type:s,objects:i=[],layoutManager:n}=t,r=u(t,Qn);return Promise.all([zt(i,e),Gt(r,e)]).then((t=>{let[e,s]=t;const i=new this(e,c(c(c({},r),s),{},{layoutManager:new Jn}));if(n){const t=at.getClass(n.type),e=at.getClass(n.strategy);i.layoutManager=new t(new e)}else i.layoutManager=new $n;return i.layoutManager.subscribeTargets({type:Wn,target:i,targets:i.getObjects()}),i.setCoords(),i}))}}l(Zn,"type","Group"),l(Zn,"ownDefaults",{strokeWidth:0,subTargetCheck:!1,interactive:!1}),at.setClass(Zn);const tr=(t,e)=>Math.min(e.width/t.width,e.height/t.height),er=(t,e)=>Math.max(e.width/t.width,e.height/t.height),sr="\\s*,?\\s*",ir="".concat(sr,"(").concat(ls,")"),nr="".concat(ir).concat(ir).concat(ir).concat(sr,"([01])").concat(sr,"([01])").concat(ir).concat(ir),rr={m:"l",M:"L"},or=(t,e,s,i,n,r,o,a,l,h,c)=>{const u=ut(t),d=dt(t),g=ut(e),p=dt(e),f=s*n*g-i*r*p+o,m=i*n*g+s*r*p+a;return["C",h+l*(-s*n*d-i*r*u),c+l*(-i*n*d+s*r*u),f+l*(s*n*p+i*r*g),m+l*(i*n*p-s*r*g),f,m]},ar=(t,e,s,i)=>{const n=Math.atan2(e,t),r=Math.atan2(i,s);return r>=n?r-n:2*Math.PI-(n-r)};function lr(t,e,s,i,n,r,o,a){let l;if(p.cachesBoundsOfCurve&&(l=[...arguments].join(),k.boundsOfCurveCache[l]))return k.boundsOfCurveCache[l];const h=Math.sqrt,c=Math.abs,u=[],d=[[0,0],[0,0]];let g=6*t-12*s+6*n,f=-3*t+9*s-9*n+3*o,m=3*s-3*t;for(let p=0;p<2;++p){if(p>0&&(g=6*e-12*i+6*r,f=-3*e+9*i-9*r+3*a,m=3*i-3*e),c(f)<1e-12){if(c(g)<1e-12)continue;const t=-m/g;0<t&&t<1&&u.push(t);continue}const t=g*g-4*m*f;if(t<0)continue;const s=h(t),n=(-g+s)/(2*f);0<n&&n<1&&u.push(n);const o=(-g-s)/(2*f);0<o&&o<1&&u.push(o)}let _=u.length;const v=_,y=dr(t,e,s,i,n,r,o,a);for(;_--;){const{x:t,y:e}=y(u[_]);d[0][_]=t,d[1][_]=e}d[0][v]=t,d[1][v]=e,d[0][v+1]=o,d[1][v+1]=a;const b=[new gt(Math.min(...d[0]),Math.min(...d[1])),new gt(Math.max(...d[0]),Math.max(...d[1]))];return p.cachesBoundsOfCurve&&(k.boundsOfCurveCache[l]=b),b}const hr=(t,e,s)=>{let[i,n,r,o,a,l,h,c]=s;const u=((t,e,s,i,n,r,o)=>{if(0===s||0===i)return[];let a=0,l=0,h=0;const c=Math.PI,u=o*P,d=dt(u),g=ut(u),p=.5*(-g*t-d*e),f=.5*(-g*e+d*t),m=s**2,_=i**2,v=f**2,y=p**2,b=m*_-m*v-_*y;let C=Math.abs(s),x=Math.abs(i);if(b<0){const t=Math.sqrt(1-b/(m*_));C*=t,x*=t}else h=(n===r?-1:1)*Math.sqrt(b/(m*v+_*y));const w=h*C*f/x,S=-h*x*p/C,T=g*w-d*S+.5*t,k=d*w+g*S+.5*e;let O=ar(1,0,(p-w)/C,(f-S)/x),E=ar((p-w)/C,(f-S)/x,(-p-w)/C,(-f-S)/x);0===r&&E>0?E-=2*c:1===r&&E<0&&(E+=2*c);const D=Math.ceil(Math.abs(E/c*2)),I=[],A=E/D,M=8/3*Math.sin(A/4)*Math.sin(A/4)/Math.sin(A/2);let R=O+A;for(let P=0;P<D;P++)I[P]=or(O,R,g,d,C,x,T,k,M,a,l),a=I[P][5],l=I[P][6],O=R,R+=A;return I})(h-t,c-e,n,r,a,l,o);for(let d=0,g=u.length;d<g;d++)u[d][1]+=t,u[d][2]+=e,u[d][3]+=t,u[d][4]+=e,u[d][5]+=t,u[d][6]+=e;return u},cr=t=>{let e=0,s=0,i=0,n=0;const r=[];let o,a=0,l=0;for(const h of t){const t=[...h];let c;switch(t[0]){case"l":t[1]+=e,t[2]+=s;case"L":e=t[1],s=t[2],c=["L",e,s];break;case"h":t[1]+=e;case"H":e=t[1],c=["L",e,s];break;case"v":t[1]+=s;case"V":s=t[1],c=["L",e,s];break;case"m":t[1]+=e,t[2]+=s;case"M":e=t[1],s=t[2],i=t[1],n=t[2],c=["M",e,s];break;case"c":t[1]+=e,t[2]+=s,t[3]+=e,t[4]+=s,t[5]+=e,t[6]+=s;case"C":a=t[3],l=t[4],e=t[5],s=t[6],c=["C",t[1],t[2],a,l,e,s];break;case"s":t[1]+=e,t[2]+=s,t[3]+=e,t[4]+=s;case"S":"C"===o?(a=2*e-a,l=2*s-l):(a=e,l=s),e=t[3],s=t[4],c=["C",a,l,t[1],t[2],e,s],a=c[3],l=c[4];break;case"q":t[1]+=e,t[2]+=s,t[3]+=e,t[4]+=s;case"Q":a=t[1],l=t[2],e=t[3],s=t[4],c=["Q",a,l,e,s];break;case"t":t[1]+=e,t[2]+=s;case"T":"Q"===o?(a=2*e-a,l=2*s-l):(a=e,l=s),e=t[1],s=t[2],c=["Q",a,l,e,s];break;case"a":t[6]+=e,t[7]+=s;case"A":hr(e,s,t).forEach((t=>r.push(t))),e=t[6],s=t[7];break;case"z":case"Z":e=i,s=n,c=["Z"]}c?(r.push(c),o=c[0]):o=""}return r},ur=(t,e,s,i)=>Math.sqrt((s-t)**2+(i-e)**2),dr=(t,e,s,i,n,r,o,a)=>l=>{const h=l**3,c=(t=>3*t**2*(1-t))(l),u=(t=>3*t*(1-t)**2)(l),d=(t=>(1-t)**3)(l);return new gt(o*h+n*c+s*u+t*d,a*h+r*c+i*u+e*d)},gr=t=>t**2,pr=t=>2*t*(1-t),fr=t=>(1-t)**2,mr=(t,e,s,i,n,r,o,a)=>l=>{const h=gr(l),c=pr(l),u=fr(l),d=3*(u*(s-t)+c*(n-s)+h*(o-n)),g=3*(u*(i-e)+c*(r-i)+h*(a-r));return Math.atan2(g,d)},_r=(t,e,s,i,n,r)=>o=>{const a=gr(o),l=pr(o),h=fr(o);return new gt(n*a+s*l+t*h,r*a+i*l+e*h)},vr=(t,e,s,i,n,r)=>o=>{const a=1-o,l=2*(a*(s-t)+o*(n-s)),h=2*(a*(i-e)+o*(r-i));return Math.atan2(h,l)},yr=(t,e,s)=>{let i=new gt(e,s),n=0;for(let r=1;r<=100;r+=1){const e=t(r/100);n+=ur(i.x,i.y,e.x,e.y),i=e}return n},br=(t,e)=>{let s,i=0,n=0,r={x:t.x,y:t.y},o=c({},r),a=.01,l=0;const h=t.iterator,u=t.angleFinder;for(;n<e&&a>1e-4;)o=h(i),l=i,s=ur(r.x,r.y,o.x,o.y),s+n>e?(i-=a,a/=2):(r=o,i+=a,n+=s);return c(c({},o),{},{angle:u(l)})},Cr=t=>{let e,s,i=0,n=0,r=0,o=0,a=0;const l=[];for(const h of t){const t={x:n,y:r,command:h[0],length:0};switch(h[0]){case"M":s=t,s.x=o=n=h[1],s.y=a=r=h[2];break;case"L":s=t,s.length=ur(n,r,h[1],h[2]),n=h[1],r=h[2];break;case"C":e=dr(n,r,h[1],h[2],h[3],h[4],h[5],h[6]),s=t,s.iterator=e,s.angleFinder=mr(n,r,h[1],h[2],h[3],h[4],h[5],h[6]),s.length=yr(e,n,r),n=h[5],r=h[6];break;case"Q":e=_r(n,r,h[1],h[2],h[3],h[4]),s=t,s.iterator=e,s.angleFinder=vr(n,r,h[1],h[2],h[3],h[4]),s.length=yr(e,n,r),n=h[3],r=h[4];break;case"Z":s=t,s.destX=o,s.destY=a,s.length=ur(n,r,o,a),n=o,r=a}i+=s.length,l.push(s)}return l.push({length:i,x:n,y:r}),l},xr=function(t,e){let s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:Cr(t),i=0;for(;e-s[i].length>0&&i<s.length-2;)e-=s[i].length,i++;const n=s[i],r=e/n.length,o=t[i];switch(n.command){case"M":return{x:n.x,y:n.y,angle:0};case"Z":return c(c({},new gt(n.x,n.y).lerp(new gt(n.destX,n.destY),r)),{},{angle:Math.atan2(n.destY-n.y,n.destX-n.x)});case"L":return c(c({},new gt(n.x,n.y).lerp(new gt(o[1],o[2]),r)),{},{angle:Math.atan2(o[2]-n.y,o[1]-n.x)});case"C":case"Q":return br(n,e)}},wr=new RegExp("[mzlhvcsqta][^mzlhvcsqta]*","gi"),Sr=new RegExp(nr,"g"),Tr=new RegExp(ls,"gi"),kr={m:2,l:2,h:1,v:1,c:6,s:4,q:4,t:2,a:7},Or=t=>{var e;const s=[],i=null!==(e=t.match(wr))&&void 0!==e?e:[];for(const n of i){const t=n[0];if("z"===t||"Z"===t){s.push([t]);continue}const e=kr[t.toLowerCase()];let i=[];if("a"===t||"A"===t){Sr.lastIndex=0;for(let t=null;t=Sr.exec(n);)i.push(...t.slice(1))}else i=n.match(Tr)||[];for(let n=0;n<i.length;n+=e){const r=new Array(e),o=rr[t];r[0]=n>0&&o?o:t;for(let t=0;t<e;t++)r[t+1]=parseFloat(i[n+t]);s.push(r)}}return s},Er=function(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,s=new gt(t[0]),i=new gt(t[1]),n=1,r=0;const o=[],a=t.length,l=a>2;let h;for(l&&(n=t[2].x<i.x?-1:t[2].x===i.x?0:1,r=t[2].y<i.y?-1:t[2].y===i.y?0:1),o.push(["M",s.x-n*e,s.y-r*e]),h=1;h<a;h++){if(!s.eq(i)){const t=s.midPointFrom(i);o.push(["Q",s.x,s.y,t.x,t.y])}s=t[h],h+1<t.length&&(i=t[h+1])}return l&&(n=s.x>t[h-2].x?1:s.x===t[h-2].x?0:-1,r=s.y>t[h-2].y?1:s.y===t[h-2].y?0:-1),o.push(["L",s.x+n*e,s.y+r*e]),o},Dr=(t,e)=>t.map((t=>t.map(((t,s)=>0===s||void 0===e?t:Kt(t,e))).join(" "))).join(" ");function Ir(t,e){const s=t.style;s&&e&&("string"==typeof e?s.cssText+=";"+e:Object.entries(e).forEach((t=>{let[e,i]=t;return s.setProperty(e,i)})))}const Pr=(t,e)=>Math.floor(Math.random()*(e-t+1))+t;function Ar(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const s=e.onComplete||E,i=new(S().XMLHttpRequest),n=e.signal,r=function(){i.abort()},o=function(){n&&n.removeEventListener("abort",r),i.onerror=i.ontimeout=E};if(n&&n.aborted)throw new _("request");return n&&n.addEventListener("abort",r,{once:!0}),i.onreadystatechange=function(){4===i.readyState&&(o(),s(i),i.onreadystatechange=E)},i.onerror=i.ontimeout=o,i.open("get",t,!0),i.send(),i}const Mr=(t,e)=>{let s=t._findCenterFromElement();t.transformMatrix&&((t=>{if(t.transformMatrix){const{scaleX:e,scaleY:s,angle:i,skewX:n}=Lt(t.transformMatrix);t.flipX=!1,t.flipY=!1,t.set(J,e),t.set(Z,s),t.angle=i,t.skewX=n,t.skewY=0}})(t),s=s.transform(t.transformMatrix)),delete t.transformMatrix,e&&(t.scaleX*=e.scaleX,t.scaleY*=e.scaleY,t.cropX=e.cropX,t.cropY=e.cropY,s.x+=e.offsetLeft,s.y+=e.offsetTop,t.width=e.width,t.height=e.height),t.setPositionByOrigin(s,L,L)};var Rr=Object.freeze({__proto__:null,addTransformToObject:me,animate:ti,animateColor:ei,applyTransformToObject:_e,calcAngleBetweenVectors:Ss,calcDimensionsMatrix:Yt,calcPlaneChangeMatrix:Ce,calcVectorRotation:Ts,cancelAnimFrame:yt,capValue:Rs,composeMatrix:Vt,copyCanvasElement:t=>{var e;const s=St(t);return null===(e=s.getContext("2d"))||void 0===e||e.drawImage(t,0,0),s},cos:ut,createCanvasElement:xt,createImage:wt,createRotateMatrix:jt,createScaleMatrix:Nt,createSkewXMatrix:Wt,createSkewYMatrix:Xt,createTranslateMatrix:Ft,createVector:xs,crossProduct:Es,degreesToRadians:Ot,dotProduct:Ds,ease:Vs,enlivenObjectEnlivables:Gt,enlivenObjects:zt,findScaleToCover:er,findScaleToFit:tr,getBoundsOfCurve:lr,getOrthonormalVector:Os,getPathSegmentsInfo:Cr,getPointOnPath:xr,getPointer:ue,getRandomInt:Pr,getRegularPolygonPath:(t,e)=>{const s=2*Math.PI/t;let i=-D;t%2==0&&(i+=s/2);const n=new Array(t+1);for(let r=0;r<t;r++){const t=r*s+i,{x:o,y:a}=new gt(ut(t),dt(t)).scalarMultiply(e);n[r]=[0===r?"M":"L",o,a]}return n[t]=["Z"],n},getSmoothPathFromPoints:Er,getSvgAttributes:t=>{const e=["instantiated_by_use","style","id","class"];switch(t){case"linearGradient":return e.concat(["x1","y1","x2","y2","gradientUnits","gradientTransform"]);case"radialGradient":return e.concat(["gradientUnits","gradientTransform","cx","cy","r","fx","fy","fr"]);case"stop":return e.concat(["offset","stop-color","stop-opacity"])}return e},getUnitVector:ks,groupSVGElements:(t,e)=>t&&1===t.length?t[0]:new Zn(t,e),hasStyleChanged:tn,invertTransform:Pt,isBetweenVectors:Is,isIdentityMatrix:Dt,isTouchEvent:de,isTransparent:Xi,joinPath:Dr,loadImage:Ht,magnitude:ws,makeBoundingBoxFromPoints:pe,makePathSimpler:cr,matrixToSVG:$t,mergeClipPaths:(t,e)=>{var s;let i=t,n=e;i.inverted&&!n.inverted&&(i=e,n=t),Se(n,null===(s=n.group)||void 0===s?void 0:s.calcTransformMatrix(),i.calcTransformMatrix());const r=i.inverted&&n.inverted;return r&&(i.inverted=n.inverted=!1),new Zn([i],{clipPath:n,inverted:r})},multiplyTransformMatrices:At,multiplyTransformMatrixArray:Mt,parsePath:Or,parsePreserveAspectRatioAttribute:He,parseUnit:Ve,pick:Ut,projectStrokeOnPoints:Gi,qrDecompose:Lt,radiansToDegrees:Et,removeFromArray:ct,removeTransformFromObject:(t,e)=>{const s=Pt(e),i=At(s,t.calcOwnMatrix());_e(t,i)},removeTransformMatrixForSvgParsing:Mr,request:Ar,requestAnimFrame:vt,resetObjectTransform:ve,rotatePoint:(t,e,s)=>t.rotate(s,e),rotateVector:Cs,saveObjectTransform:ye,sendObjectToPlane:Se,sendPointToPlane:xe,sendVectorToPlane:we,setStyle:Ir,sin:dt,sizeAfterTransform:be,string:Zi,stylesFromArray:sn,stylesToArray:en,toBlob:kt,toDataURL:Tt,toFixed:Kt,transformPath:(t,e,s)=>(s&&(e=At(e,[1,0,0,1,-s.x,-s.y])),t.map((t=>{const s=[...t];for(let i=1;i<t.length-1;i+=2){const{x:n,y:r}=It({x:t[i],y:t[i+1]},e);s[i]=n,s[i+1]=r}return s}))),transformPoint:It});class Lr extends ae{constructor(t){let{allowTouchScrolling:e=!1,containerClass:s=""}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};super(t),l(this,"upper",void 0),l(this,"container",void 0);const{el:i}=this.lower,n=this.createUpperCanvas();this.upper={el:n,ctx:n.getContext("2d")},this.applyCanvasStyle(i,{allowTouchScrolling:e}),this.applyCanvasStyle(n,{allowTouchScrolling:e,styles:{position:"absolute",left:"0",top:"0"}});const r=this.createContainerElement();r.classList.add(s),i.parentNode&&i.parentNode.replaceChild(r,i),r.append(i,n),this.container=r}createUpperCanvas(){const{el:t}=this.lower,e=xt();return e.className=t.className,e.classList.remove("lower-canvas"),e.classList.add("upper-canvas"),e.setAttribute("data-fabric","top"),e.style.cssText=t.style.cssText,e.setAttribute("draggable","true"),e}createContainerElement(){const t=w().createElement("div");return t.setAttribute("data-fabric","wrapper"),Ir(t,{position:"relative"}),oe(t),t}applyCanvasStyle(t,e){const{styles:s,allowTouchScrolling:i}=e;Ir(t,c(c({},s),{},{"touch-action":i?"manipulation":W})),oe(t)}setDimensions(t,e){super.setDimensions(t,e);const{el:s,ctx:i}=this.upper;ne(s,i,t,e)}setCSSDimensions(t){super.setCSSDimensions(t),re(this.upper.el,t),re(this.container,t)}cleanupDOM(t){const e=this.container,{el:s}=this.lower,{el:i}=this.upper;super.cleanupDOM(t),e.removeChild(i),e.removeChild(s),e.parentNode&&e.parentNode.replaceChild(s,e)}dispose(){super.dispose(),x().dispose(this.upper.el),delete this.upper,delete this.container}}class Fr extends he{constructor(){super(...arguments),l(this,"targets",[]),l(this,"_hoveredTargets",[]),l(this,"_objectsToRender",void 0),l(this,"_currentTransform",null),l(this,"_groupSelector",null),l(this,"contextTopDirty",!1)}static getDefaults(){return c(c({},super.getDefaults()),Fr.ownDefaults)}get upperCanvasEl(){var t;return null===(t=this.elements.upper)||void 0===t?void 0:t.el}get contextTop(){var t;return null===(t=this.elements.upper)||void 0===t?void 0:t.ctx}get wrapperEl(){return this.elements.container}initElements(t){this.elements=new Lr(t,{allowTouchScrolling:this.allowTouchScrolling,containerClass:this.containerClass}),this._createCacheCanvas()}_onObjectAdded(t){this._objectsToRender=void 0,super._onObjectAdded(t)}_onObjectRemoved(t){this._objectsToRender=void 0,t===this._activeObject&&(this.fire("before:selection:cleared",{deselected:[t]}),this._discardActiveObject(),this.fire("selection:cleared",{deselected:[t]}),t.fire("deselected",{target:t})),t===this._hoveredTarget&&(this._hoveredTarget=void 0,this._hoveredTargets=[]),super._onObjectRemoved(t)}_onStackOrderChanged(){this._objectsToRender=void 0,super._onStackOrderChanged()}_chooseObjectsToRender(){const t=this._activeObject;return!this.preserveObjectStacking&&t?this._objects.filter((e=>!e.group&&e!==t)).concat(t):this._objects}renderAll(){this.cancelRequestedRender(),this.destroyed||(!this.contextTopDirty||this._groupSelector||this.isDrawingMode||(this.clearContext(this.contextTop),this.contextTopDirty=!1),this.hasLostContext&&(this.renderTopLayer(this.contextTop),this.hasLostContext=!1),!this._objectsToRender&&(this._objectsToRender=this._chooseObjectsToRender()),this.renderCanvas(this.getContext(),this._objectsToRender))}renderTopLayer(t){t.save(),this.isDrawingMode&&this._isCurrentlyDrawing&&(this.freeDrawingBrush&&this.freeDrawingBrush._render(),this.contextTopDirty=!0),this.selection&&this._groupSelector&&(this._drawSelection(t),this.contextTopDirty=!0),t.restore()}renderTop(){const t=this.contextTop;this.clearContext(t),this.renderTopLayer(t),this.fire("after:render",{ctx:t})}setTargetFindTolerance(t){t=Math.round(t),this.targetFindTolerance=t;const e=this.getRetinaScaling(),s=Math.ceil((2*t+1)*e);this.pixelFindCanvasEl.width=this.pixelFindCanvasEl.height=s,this.pixelFindContext.scale(e,e)}isTargetTransparent(t,e,s){const i=this.targetFindTolerance,n=this.pixelFindContext;this.clearContext(n),n.save(),n.translate(-e+i,-s+i),n.transform(...this.viewportTransform);const r=t.selectionBackgroundColor;t.selectionBackgroundColor="",t.render(n),t.selectionBackgroundColor=r,n.restore();const o=Math.round(i*this.getRetinaScaling());return Xi(n,o,o,o)}_isSelectionKeyPressed(t){const e=this.selectionKey;return!!e&&(Array.isArray(e)?!!e.find((e=>!!e&&!0===t[e])):t[e])}_shouldClearSelection(t,e){const s=this.getActiveObjects(),i=this._activeObject;return!!(!e||e&&i&&s.length>1&&-1===s.indexOf(e)&&i!==e&&!this._isSelectionKeyPressed(t)||e&&!e.evented||e&&!e.selectable&&i&&i!==e)}_shouldCenterTransform(t,e,s){if(!t)return;let i;return e===Q||e===J||e===Z||e===U?i=this.centeredScaling||t.centeredScaling:e===z&&(i=this.centeredRotation||t.centeredRotation),i?!s:s}_getOriginFromCorner(t,e){const s={x:t.originX,y:t.originY};return e?(["ml","tl","bl"].includes(e)?s.x=B:["mr","tr","br"].includes(e)&&(s.x=F),["tl","mt","tr"].includes(e)?s.y=N:["bl","mb","br"].includes(e)&&(s.y=j),s):s}_setupCurrentTransform(t,e,s){var i;const n=e.group?xe(this.getScenePoint(t),void 0,e.group.calcTransformMatrix()):this.getScenePoint(t),{key:r="",control:o}=e.getActiveControl()||{},a=s&&o?null===(i=o.getActionHandler(t,e,o))||void 0===i?void 0:i.bind(o):Le,l=((t,e,s,i)=>{if(!e||!t)return"drag";const n=i.controls[e];return n.getActionName(s,n,i)})(s,r,t,e),h=t[this.centeredKey],u=this._shouldCenterTransform(e,l,h)?{x:L,y:L}:this._getOriginFromCorner(e,r),d={target:e,action:l,actionHandler:a,actionPerformed:!1,corner:r,scaleX:e.scaleX,scaleY:e.scaleY,skewX:e.skewX,skewY:e.skewY,offsetX:n.x-e.left,offsetY:n.y-e.top,originX:u.x,originY:u.y,ex:n.x,ey:n.y,lastX:n.x,lastY:n.y,theta:Ot(e.angle),width:e.width,height:e.height,shiftKey:t.shiftKey,altKey:h,original:c(c({},ye(e)),{},{originX:u.x,originY:u.y})};this._currentTransform=d,this.fire("before:transform",{e:t,transform:d})}setCursor(t){this.upperCanvasEl.style.cursor=t}_drawSelection(t){const{x:e,y:s,deltaX:i,deltaY:n}=this._groupSelector,r=new gt(e,s).transform(this.viewportTransform),o=new gt(e+i,s+n).transform(this.viewportTransform),a=this.selectionLineWidth/2;let l=Math.min(r.x,o.x),h=Math.min(r.y,o.y),c=Math.max(r.x,o.x),u=Math.max(r.y,o.y);this.selectionColor&&(t.fillStyle=this.selectionColor,t.fillRect(l,h,c-l,u-h)),this.selectionLineWidth&&this.selectionBorderColor&&(t.lineWidth=this.selectionLineWidth,t.strokeStyle=this.selectionBorderColor,l+=a,h+=a,c-=a,u-=a,Wi.prototype._setLineDash.call(this,t,this.selectionDashArray),t.strokeRect(l,h,c-l,u-h))}findTarget(t){if(this.skipTargetFind)return;const e=this.getViewportPoint(t),s=this._activeObject,i=this.getActiveObjects();if(this.targets=[],s&&i.length>=1){if(s.findControl(e,de(t)))return s;if(i.length>1&&this.searchPossibleTargets([s],e))return s;if(s===this.searchPossibleTargets([s],e)){if(this.preserveObjectStacking){const i=this.targets;this.targets=[];const n=this.searchPossibleTargets(this._objects,e);return t[this.altSelectionKey]&&n&&n!==s?(this.targets=i,s):n}return s}}return this.searchPossibleTargets(this._objects,e)}_pointIsInObjectSelectionArea(t,e){let s=t.getCoords();const i=this.getZoom(),n=t.padding/i;if(n){const[t,e,i,r]=s,o=Math.atan2(e.y-t.y,e.x-t.x),a=ut(o)*n,l=dt(o)*n,h=a+l,c=a-l;s=[new gt(t.x-c,t.y-h),new gt(e.x+h,e.y-c),new gt(i.x+c,i.y+h),new gt(r.x-h,r.y+c)]}return si.isPointInPolygon(e,s)}_checkTarget(t,e){if(t&&t.visible&&t.evented&&this._pointIsInObjectSelectionArea(t,xe(e,void 0,this.viewportTransform))){if(!this.perPixelTargetFind&&!t.perPixelTargetFind||t.isEditing)return!0;if(!this.isTargetTransparent(t,e.x,e.y))return!0}return!1}_searchPossibleTargets(t,e){let s=t.length;for(;s--;){const i=t[s];if(this._checkTarget(i,e)){if(ft(i)&&i.subTargetCheck){const t=this._searchPossibleTargets(i._objects,e);t&&this.targets.push(t)}return i}}}searchPossibleTargets(t,e){const s=this._searchPossibleTargets(t,e);if(s&&ft(s)&&s.interactive&&this.targets[0]){const t=this.targets;for(let e=t.length-1;e>0;e--){const s=t[e];if(!ft(s)||!s.interactive)return s}return t[0]}return s}getViewportPoint(t){return this._pointer?this._pointer:this.getPointer(t,!0)}getScenePoint(t){return this._absolutePointer?this._absolutePointer:this.getPointer(t)}getPointer(t){let e=arguments.length>1&&void 0!==arguments[1]&&arguments[1];const s=this.upperCanvasEl,i=s.getBoundingClientRect();let n=ue(t),r=i.width||0,o=i.height||0;r&&o||(j in i&&N in i&&(o=Math.abs(i.top-i.bottom)),B in i&&F in i&&(r=Math.abs(i.right-i.left))),this.calcOffset(),n.x=n.x-this._offset.left,n.y=n.y-this._offset.top,e||(n=xe(n,void 0,this.viewportTransform));const a=this.getRetinaScaling();1!==a&&(n.x/=a,n.y/=a);const l=0===r||0===o?new gt(1,1):new gt(s.width/r,s.height/o);return n.multiply(l)}_setDimensionsImpl(t,e){this._resetTransformEventData(),super._setDimensionsImpl(t,e),this._isCurrentlyDrawing&&this.freeDrawingBrush&&this.freeDrawingBrush._setBrushStyles(this.contextTop)}_createCacheCanvas(){this.pixelFindCanvasEl=xt(),this.pixelFindContext=this.pixelFindCanvasEl.getContext("2d",{willReadFrequently:!0}),this.setTargetFindTolerance(this.targetFindTolerance)}getTopContext(){return this.elements.upper.ctx}getSelectionContext(){return this.elements.upper.ctx}getSelectionElement(){return this.elements.upper.el}getActiveObject(){return this._activeObject}getActiveObjects(){const t=this._activeObject;return te(t)?t.getObjects():t?[t]:[]}_fireSelectionEvents(t,e){let s=!1,i=!1;const n=this.getActiveObjects(),r=[],o=[];t.forEach((t=>{n.includes(t)||(s=!0,t.fire("deselected",{e:e,target:t}),o.push(t))})),n.forEach((i=>{t.includes(i)||(s=!0,i.fire("selected",{e:e,target:i}),r.push(i))})),t.length>0&&n.length>0?(i=!0,s&&this.fire("selection:updated",{e:e,selected:r,deselected:o})):n.length>0?(i=!0,this.fire("selection:created",{e:e,selected:r})):t.length>0&&(i=!0,this.fire("selection:cleared",{e:e,deselected:o})),i&&(this._objectsToRender=void 0)}setActiveObject(t,e){const s=this.getActiveObjects(),i=this._setActiveObject(t,e);return this._fireSelectionEvents(s,e),i}_setActiveObject(t,e){const s=this._activeObject;return s!==t&&!(!this._discardActiveObject(e,t)&&this._activeObject)&&!t.onSelect({e:e})&&(this._activeObject=t,te(t)&&s!==t&&t.set("canvas",this),t.setCoords(),!0)}_discardActiveObject(t,e){const s=this._activeObject;return!!s&&!s.onDeselect({e:t,object:e})&&(this._currentTransform&&this._currentTransform.target===s&&this.endCurrentTransform(t),te(s)&&s===this._hoveredTarget&&(this._hoveredTarget=void 0),this._activeObject=void 0,!0)}discardActiveObject(t){const e=this.getActiveObjects(),s=this.getActiveObject();e.length&&this.fire("before:selection:cleared",{e:t,deselected:[s]});const i=this._discardActiveObject(t);return this._fireSelectionEvents(e,t),i}endCurrentTransform(t){const e=this._currentTransform;this._finalizeCurrentTransform(t),e&&e.target&&(e.target.isMoving=!1),this._currentTransform=null}_finalizeCurrentTransform(t){const e=this._currentTransform,s=e.target,i={e:t,target:s,transform:e,action:e.action};s._scaling&&(s._scaling=!1),s.setCoords(),e.actionPerformed&&(this.fire("object:modified",i),s.fire(nt,i))}setViewportTransform(t){super.setViewportTransform(t);const e=this._activeObject;e&&e.setCoords()}destroy(){const t=this._activeObject;te(t)&&(t.removeAll(),t.dispose()),delete this._activeObject,super.destroy(),this.pixelFindContext=null,this.pixelFindCanvasEl=void 0}clear(){this.discardActiveObject(),this._activeObject=void 0,this.clearContext(this.contextTop),super.clear()}drawControls(t){const e=this._activeObject;e&&e._renderControls(t)}_toObject(t,e,s){const i=this._realizeGroupTransformOnObject(t),n=super._toObject(t,e,s);return t.set(i),n}_realizeGroupTransformOnObject(t){const{group:e}=t;if(e&&te(e)&&this._activeObject===e){const s=Ut(t,["angle","flipX","flipY",F,J,Z,tt,et,j]);return me(t,e.calcOwnMatrix()),s}return{}}_setSVGObject(t,e,s){const i=this._realizeGroupTransformOnObject(e);super._setSVGObject(t,e,s),e.set(i)}}l(Fr,"ownDefaults",{uniformScaling:!0,uniScaleKey:"shiftKey",centeredScaling:!1,centeredRotation:!1,centeredKey:"altKey",altActionKey:"shiftKey",selection:!0,selectionKey:"shiftKey",selectionColor:"rgba(100, 100, 255, 0.3)",selectionDashArray:[],selectionBorderColor:"rgba(255, 255, 255, 0.3)",selectionLineWidth:1,selectionFullyContained:!1,hoverCursor:"move",moveCursor:"move",defaultCursor:"default",freeDrawingCursor:"crosshair",notAllowedCursor:"not-allowed",perPixelTargetFind:!1,targetFindTolerance:0,skipTargetFind:!1,stopContextMenu:!1,fireRightClick:!1,fireMiddleClick:!1,enablePointerEvents:!1,containerClass:"canvas-container",preserveObjectStacking:!1});class jr{constructor(t){l(this,"targets",[]),l(this,"__disposer",void 0);const e=()=>{const{hiddenTextarea:e}=t.getActiveObject()||{};e&&e.focus()},s=t.upperCanvasEl;s.addEventListener("click",e),this.__disposer=()=>s.removeEventListener("click",e)}exitTextEditing(){this.target=void 0,this.targets.forEach((t=>{t.isEditing&&t.exitEditing()}))}add(t){this.targets.push(t)}remove(t){this.unregister(t),ct(this.targets,t)}register(t){this.target=t}unregister(t){t===this.target&&(this.target=void 0)}onMouseMove(t){var e;(null===(e=this.target)||void 0===e?void 0:e.isEditing)&&this.target.updateSelectionOnMouseMove(t)}clear(){this.targets=[],this.target=void 0}dispose(){this.clear(),this.__disposer(),delete this.__disposer}}const Nr=["target","oldTarget","fireCanvas","e"],Br={passive:!1},Wr=(t,e)=>{const s=t.getViewportPoint(e),i=t.getScenePoint(e);return{viewportPoint:s,scenePoint:i,pointer:s,absolutePointer:i}},Xr=function(t){for(var e=arguments.length,s=new Array(e>1?e-1:0),i=1;i<e;i++)s[i-1]=arguments[i];return t.addEventListener(...s)},Yr=function(t){for(var e=arguments.length,s=new Array(e>1?e-1:0),i=1;i<e;i++)s[i-1]=arguments[i];return t.removeEventListener(...s)},Vr={mouse:{in:"over",out:"out",targetIn:"mouseover",targetOut:"mouseout",canvasIn:"mouse:over",canvasOut:"mouse:out"},drag:{in:"enter",out:"leave",targetIn:"dragenter",targetOut:"dragleave",canvasIn:"drag:enter",canvasOut:"drag:leave"}};class Hr extends Fr{constructor(t){super(t,arguments.length>1&&void 0!==arguments[1]?arguments[1]:{}),l(this,"_isClick",void 0),l(this,"textEditingManager",new jr(this)),["_onMouseDown","_onTouchStart","_onMouseMove","_onMouseUp","_onTouchEnd","_onResize","_onMouseWheel","_onMouseOut","_onMouseEnter","_onContextMenu","_onClick","_onDragStart","_onDragEnd","_onDragProgress","_onDragOver","_onDragEnter","_onDragLeave","_onDrop"].forEach((t=>{this[t]=this[t].bind(this)})),this.addOrRemove(Xr,"add")}_getEventPrefix(){return this.enablePointerEvents?"pointer":"mouse"}addOrRemove(t,e){const s=this.upperCanvasEl,i=this._getEventPrefix();t(ie(s),"resize",this._onResize),t(s,i+"down",this._onMouseDown),t(s,"".concat(i,"move"),this._onMouseMove,Br),t(s,"".concat(i,"out"),this._onMouseOut),t(s,"".concat(i,"enter"),this._onMouseEnter),t(s,"wheel",this._onMouseWheel),t(s,"contextmenu",this._onContextMenu),t(s,"click",this._onClick),t(s,"dblclick",this._onClick),t(s,"dragstart",this._onDragStart),t(s,"dragend",this._onDragEnd),t(s,"dragover",this._onDragOver),t(s,"dragenter",this._onDragEnter),t(s,"dragleave",this._onDragLeave),t(s,"drop",this._onDrop),this.enablePointerEvents||t(s,"touchstart",this._onTouchStart,Br)}removeListeners(){this.addOrRemove(Yr,"remove");const t=this._getEventPrefix(),e=se(this.upperCanvasEl);Yr(e,"".concat(t,"up"),this._onMouseUp),Yr(e,"touchend",this._onTouchEnd,Br),Yr(e,"".concat(t,"move"),this._onMouseMove,Br),Yr(e,"touchmove",this._onMouseMove,Br),clearTimeout(this._willAddMouseDown)}_onMouseWheel(t){this.__onMouseWheel(t)}_onMouseOut(t){const e=this._hoveredTarget,s=c({e:t},Wr(this,t));this.fire("mouse:out",c(c({},s),{},{target:e})),this._hoveredTarget=void 0,e&&e.fire("mouseout",c({},s)),this._hoveredTargets.forEach((t=>{this.fire("mouse:out",c(c({},s),{},{target:t})),t&&t.fire("mouseout",c({},s))})),this._hoveredTargets=[]}_onMouseEnter(t){this._currentTransform||this.findTarget(t)||(this.fire("mouse:over",c({e:t},Wr(this,t))),this._hoveredTarget=void 0,this._hoveredTargets=[])}_onDragStart(t){this._isClick=!1;const e=this.getActiveObject();if(e&&e.onDragStart(t)){this._dragSource=e;const s={e:t,target:e};return this.fire("dragstart",s),e.fire("dragstart",s),void Xr(this.upperCanvasEl,"drag",this._onDragProgress)}ge(t)}_renderDragEffects(t,e,s){let i=!1;const n=this._dropTarget;n&&n!==e&&n!==s&&(n.clearContextTop(),i=!0),null==e||e.clearContextTop(),s!==e&&(null==s||s.clearContextTop());const r=this.contextTop;r.save(),r.transform(...this.viewportTransform),e&&(r.save(),e.transform(r),e.renderDragSourceEffect(t),r.restore(),i=!0),s&&(r.save(),s.transform(r),s.renderDropTargetEffect(t),r.restore(),i=!0),r.restore(),i&&(this.contextTopDirty=!0)}_onDragEnd(t){const e=!!t.dataTransfer&&t.dataTransfer.dropEffect!==W,s=e?this._activeObject:void 0,i={e:t,target:this._dragSource,subTargets:this.targets,dragSource:this._dragSource,didDrop:e,dropTarget:s};Yr(this.upperCanvasEl,"drag",this._onDragProgress),this.fire("dragend",i),this._dragSource&&this._dragSource.fire("dragend",i),delete this._dragSource,this._onMouseUp(t)}_onDragProgress(t){const e={e:t,target:this._dragSource,dragSource:this._dragSource,dropTarget:this._draggedoverTarget};this.fire("drag",e),this._dragSource&&this._dragSource.fire("drag",e)}findDragTargets(t){return this.targets=[],{target:this._searchPossibleTargets(this._objects,this.getViewportPoint(t)),targets:[...this.targets]}}_onDragOver(t){const e="dragover",{target:s,targets:i}=this.findDragTargets(t),n=this._dragSource,r={e:t,target:s,subTargets:i,dragSource:n,canDrop:!1,dropTarget:void 0};let o;this.fire(e,r),this._fireEnterLeaveEvents(s,r),s&&(s.canDrop(t)&&(o=s),s.fire(e,r));for(let a=0;a<i.length;a++){const s=i[a];s.canDrop(t)&&(o=s),s.fire(e,r)}this._renderDragEffects(t,n,o),this._dropTarget=o}_onDragEnter(t){const{target:e,targets:s}=this.findDragTargets(t),i={e:t,target:e,subTargets:s,dragSource:this._dragSource};this.fire("dragenter",i),this._fireEnterLeaveEvents(e,i)}_onDragLeave(t){const e={e:t,target:this._draggedoverTarget,subTargets:this.targets,dragSource:this._dragSource};this.fire("dragleave",e),this._fireEnterLeaveEvents(void 0,e),this._renderDragEffects(t,this._dragSource),this._dropTarget=void 0,this.targets=[],this._hoveredTargets=[]}_onDrop(t){const{target:e,targets:s}=this.findDragTargets(t),i=this._basicEventHandler("drop:before",c({e:t,target:e,subTargets:s,dragSource:this._dragSource},Wr(this,t)));i.didDrop=!1,i.dropTarget=void 0,this._basicEventHandler("drop",i),this.fire("drop:after",i)}_onContextMenu(t){const e=this.findTarget(t),s=this.targets||[],i=this._basicEventHandler("contextmenu:before",{e:t,target:e,subTargets:s});return this.stopContextMenu&&ge(t),this._basicEventHandler("contextmenu",i),!1}_onClick(t){const e=t.detail;e>3||e<2||(this._cacheTransformEventData(t),2==e&&"dblclick"===t.type&&this._handleEvent(t,"dblclick"),3==e&&this._handleEvent(t,"tripleclick"),this._resetTransformEventData())}getPointerId(t){const e=t.changedTouches;return e?e[0]&&e[0].identifier:this.enablePointerEvents?t.pointerId:-1}_isMainEvent(t){return!0===t.isPrimary||!1!==t.isPrimary&&("touchend"===t.type&&0===t.touches.length||!t.changedTouches||t.changedTouches[0].identifier===this.mainTouchId)}_onTouchStart(t){let e=!this.allowTouchScrolling;const s=this._activeObject;void 0===this.mainTouchId&&(this.mainTouchId=this.getPointerId(t)),this.__onMouseDown(t),(this.isDrawingMode||s&&this._target===s)&&(e=!0),e&&t.preventDefault(),this._resetTransformEventData();const i=this.upperCanvasEl,n=this._getEventPrefix(),r=se(i);Xr(r,"touchend",this._onTouchEnd,Br),e&&Xr(r,"touchmove",this._onMouseMove,Br),Yr(i,"".concat(n,"down"),this._onMouseDown)}_onMouseDown(t){this.__onMouseDown(t),this._resetTransformEventData();const e=this.upperCanvasEl,s=this._getEventPrefix();Yr(e,"".concat(s,"move"),this._onMouseMove,Br);const i=se(e);Xr(i,"".concat(s,"up"),this._onMouseUp),Xr(i,"".concat(s,"move"),this._onMouseMove,Br)}_onTouchEnd(t){if(t.touches.length>0)return;this.__onMouseUp(t),this._resetTransformEventData(),delete this.mainTouchId;const e=this._getEventPrefix(),s=se(this.upperCanvasEl);Yr(s,"touchend",this._onTouchEnd,Br),Yr(s,"touchmove",this._onMouseMove,Br),this._willAddMouseDown&&clearTimeout(this._willAddMouseDown),this._willAddMouseDown=setTimeout((()=>{Xr(this.upperCanvasEl,"".concat(e,"down"),this._onMouseDown),this._willAddMouseDown=0}),400)}_onMouseUp(t){this.__onMouseUp(t),this._resetTransformEventData();const e=this.upperCanvasEl,s=this._getEventPrefix();if(this._isMainEvent(t)){const t=se(this.upperCanvasEl);Yr(t,"".concat(s,"up"),this._onMouseUp),Yr(t,"".concat(s,"move"),this._onMouseMove,Br),Xr(e,"".concat(s,"move"),this._onMouseMove,Br)}}_onMouseMove(t){const e=this.getActiveObject();!this.allowTouchScrolling&&(!e||!e.shouldStartDragging(t))&&t.preventDefault&&t.preventDefault(),this.__onMouseMove(t)}_onResize(){this.calcOffset(),this._resetTransformEventData()}_shouldRender(t){const e=this.getActiveObject();return!!e!=!!t||e&&t&&e!==t}__onMouseUp(t){var e;this._cacheTransformEventData(t),this._handleEvent(t,"up:before");const s=this._currentTransform,i=this._isClick,n=this._target,{button:r}=t;if(r)return(this.fireMiddleClick&&1===r||this.fireRightClick&&2===r)&&this._handleEvent(t,"up"),void this._resetTransformEventData();if(this.isDrawingMode&&this._isCurrentlyDrawing)return void this._onMouseUpInDrawingMode(t);if(!this._isMainEvent(t))return;let o,a,l=!1;if(s&&(this._finalizeCurrentTransform(t),l=s.actionPerformed),!i){const e=n===this._activeObject;this.handleSelection(t),l||(l=this._shouldRender(n)||!e&&n===this._activeObject)}if(n){const e=n.findControl(this.getViewportPoint(t),de(t)),{key:i,control:r}=e||{};if(a=i,n.selectable&&n!==this._activeObject&&"up"===n.activeOn)this.setActiveObject(n,t),l=!0;else if(r){const e=r.getMouseUpHandler(t,n,r);e&&(o=this.getScenePoint(t),e.call(r,t,s,o.x,o.y))}n.isMoving=!1}if(s&&(s.target!==n||s.corner!==a)){const e=s.target&&s.target.controls[s.corner],i=e&&e.getMouseUpHandler(t,s.target,e);o=o||this.getScenePoint(t),i&&i.call(e,t,s,o.x,o.y)}this._setCursorFromEvent(t,n),this._handleEvent(t,"up"),this._groupSelector=null,this._currentTransform=null,n&&(n.__corner=void 0),l?this.requestRenderAll():i||null!==(e=this._activeObject)&&void 0!==e&&e.isEditing||this.renderTop()}_basicEventHandler(t,e){const{target:s,subTargets:i=[]}=e;this.fire(t,e),s&&s.fire(t,e);for(let n=0;n<i.length;n++)i[n]!==s&&i[n].fire(t,e);return e}_handleEvent(t,e,s){const i=this._target,n=this.targets||[],r=c(c(c({e:t,target:i,subTargets:n},Wr(this,t)),{},{transform:this._currentTransform},"up:before"===e||"up"===e?{isClick:this._isClick,currentTarget:this.findTarget(t),currentSubTargets:this.targets}:{}),"down:before"===e||"down"===e?s:{});this.fire("mouse:".concat(e),r),i&&i.fire("mouse".concat(e),r);for(let o=0;o<n.length;o++)n[o]!==i&&n[o].fire("mouse".concat(e),r)}_onMouseDownInDrawingMode(t){this._isCurrentlyDrawing=!0,this.getActiveObject()&&(this.discardActiveObject(t),this.requestRenderAll());const e=this.getScenePoint(t);this.freeDrawingBrush&&this.freeDrawingBrush.onMouseDown(e,{e:t,pointer:e}),this._handleEvent(t,"down",{alreadySelected:!1})}_onMouseMoveInDrawingMode(t){if(this._isCurrentlyDrawing){const e=this.getScenePoint(t);this.freeDrawingBrush&&this.freeDrawingBrush.onMouseMove(e,{e:t,pointer:e})}this.setCursor(this.freeDrawingCursor),this._handleEvent(t,"move")}_onMouseUpInDrawingMode(t){const e=this.getScenePoint(t);this.freeDrawingBrush?this._isCurrentlyDrawing=!!this.freeDrawingBrush.onMouseUp({e:t,pointer:e}):this._isCurrentlyDrawing=!1,this._handleEvent(t,"up")}__onMouseDown(t){this._isClick=!0,this._cacheTransformEventData(t),this._handleEvent(t,"down:before");let e=this._target,s=!!e&&e===this._activeObject;const{button:i}=t;if(i)return(this.fireMiddleClick&&1===i||this.fireRightClick&&2===i)&&this._handleEvent(t,"down",{alreadySelected:s}),void this._resetTransformEventData();if(this.isDrawingMode)return void this._onMouseDownInDrawingMode(t);if(!this._isMainEvent(t))return;if(this._currentTransform)return;let n=this._shouldRender(e),r=!1;if(this.handleMultiSelection(t,e)?(e=this._activeObject,r=!0,n=!0):this._shouldClearSelection(t,e)&&this.discardActiveObject(t),this.selection&&(!e||!e.selectable&&!e.isEditing&&e!==this._activeObject)){const e=this.getScenePoint(t);this._groupSelector={x:e.x,y:e.y,deltaY:0,deltaX:0}}if(s=!!e&&e===this._activeObject,e){e.selectable&&"down"===e.activeOn&&this.setActiveObject(e,t);const i=e.findControl(this.getViewportPoint(t),de(t));if(e===this._activeObject&&(i||!r)){this._setupCurrentTransform(t,e,s);const n=i?i.control:void 0,r=this.getScenePoint(t),o=n&&n.getMouseDownHandler(t,e,n);o&&o.call(n,t,this._currentTransform,r.x,r.y)}}n&&(this._objectsToRender=void 0),this._handleEvent(t,"down",{alreadySelected:s}),n&&this.requestRenderAll()}_resetTransformEventData(){this._target=this._pointer=this._absolutePointer=void 0}_cacheTransformEventData(t){this._resetTransformEventData(),this._pointer=this.getViewportPoint(t),this._absolutePointer=xe(this._pointer,void 0,this.viewportTransform),this._target=this._currentTransform?this._currentTransform.target:this.findTarget(t)}__onMouseMove(t){if(this._isClick=!1,this._cacheTransformEventData(t),this._handleEvent(t,"move:before"),this.isDrawingMode)return void this._onMouseMoveInDrawingMode(t);if(!this._isMainEvent(t))return;const e=this._groupSelector;if(e){const s=this.getScenePoint(t);e.deltaX=s.x-e.x,e.deltaY=s.y-e.y,this.renderTop()}else if(this._currentTransform)this._transformObject(t);else{const e=this.findTarget(t);this._setCursorFromEvent(t,e),this._fireOverOutEvents(t,e)}this.textEditingManager.onMouseMove(t),this._handleEvent(t,"move"),this._resetTransformEventData()}_fireOverOutEvents(t,e){const s=this._hoveredTarget,i=this._hoveredTargets,n=this.targets,r=Math.max(i.length,n.length);this.fireSyntheticInOutEvents("mouse",{e:t,target:e,oldTarget:s,fireCanvas:!0});for(let o=0;o<r;o++)this.fireSyntheticInOutEvents("mouse",{e:t,target:n[o],oldTarget:i[o]});this._hoveredTarget=e,this._hoveredTargets=this.targets.concat()}_fireEnterLeaveEvents(t,e){const s=this._draggedoverTarget,i=this._hoveredTargets,n=this.targets,r=Math.max(i.length,n.length);this.fireSyntheticInOutEvents("drag",c(c({},e),{},{target:t,oldTarget:s,fireCanvas:!0}));for(let o=0;o<r;o++)this.fireSyntheticInOutEvents("drag",c(c({},e),{},{target:n[o],oldTarget:i[o]}));this._draggedoverTarget=t}fireSyntheticInOutEvents(t,e){let{target:s,oldTarget:i,fireCanvas:n,e:r}=e,o=u(e,Nr);const{targetIn:a,targetOut:l,canvasIn:h,canvasOut:d}=Vr[t],g=i!==s;if(i&&g){const t=c(c({},o),{},{e:r,target:i,nextTarget:s},Wr(this,r));n&&this.fire(d,t),i.fire(l,t)}if(s&&g){const t=c(c({},o),{},{e:r,target:s,previousTarget:i},Wr(this,r));n&&this.fire(h,t),s.fire(a,t)}}__onMouseWheel(t){this._cacheTransformEventData(t),this._handleEvent(t,"wheel"),this._resetTransformEventData()}_transformObject(t){const e=this.getScenePoint(t),s=this._currentTransform,i=s.target,n=i.group?xe(e,void 0,i.group.calcTransformMatrix()):e;s.shiftKey=t.shiftKey,s.altKey=!!this.centeredKey&&t[this.centeredKey],this._performTransformAction(t,s,n),s.actionPerformed&&this.requestRenderAll()}_performTransformAction(t,e,s){const{action:i,actionHandler:n,target:r}=e,o=!!n&&n(t,e,s.x,s.y);o&&r.setCoords(),"drag"===i&&o&&(e.target.isMoving=!0,this.setCursor(e.target.moveCursor||this.moveCursor)),e.actionPerformed=e.actionPerformed||o}_setCursorFromEvent(t,e){if(!e)return void this.setCursor(this.defaultCursor);let s=e.hoverCursor||this.hoverCursor;const i=te(this._activeObject)?this._activeObject:null,n=(!i||e.group!==i)&&e.findControl(this.getViewportPoint(t));if(n){const s=n.control;this.setCursor(s.cursorStyleHandler(t,s,e))}else e.subTargetCheck&&this.targets.concat().reverse().map((t=>{s=t.hoverCursor||s})),this.setCursor(s)}handleMultiSelection(t,e){const s=this._activeObject,i=te(s);if(s&&this._isSelectionKeyPressed(t)&&this.selection&&e&&e.selectable&&(s!==e||i)&&(i||!e.isDescendantOf(s)&&!s.isDescendantOf(e))&&!e.onSelect({e:t})&&!s.getActiveControl()){if(i){const i=s.getObjects();if(e===s){const s=this.getViewportPoint(t);if(!(e=this.searchPossibleTargets(i,s)||this.searchPossibleTargets(this._objects,s))||!e.selectable)return!1}e.group===s?(s.remove(e),this._hoveredTarget=e,this._hoveredTargets=[...this.targets],1===s.size()&&this._setActiveObject(s.item(0),t)):(s.multiSelectAdd(e),this._hoveredTarget=s,this._hoveredTargets=[...this.targets]),this._fireSelectionEvents(i,t)}else{s.isEditing&&s.exitEditing();const i=new(at.getClass("ActiveSelection"))([],{canvas:this});i.multiSelectAdd(s,e),this._hoveredTarget=i,this._setActiveObject(i,t),this._fireSelectionEvents([s],t)}return!0}return!1}handleSelection(t){if(!this.selection||!this._groupSelector)return!1;const{x:e,y:s,deltaX:i,deltaY:n}=this._groupSelector,r=new gt(e,s),o=r.add(new gt(i,n)),a=r.min(o),l=r.max(o).subtract(a),h=this.collectObjects({left:a.x,top:a.y,width:l.x,height:l.y},{includeIntersecting:!this.selectionFullyContained}),c=r.eq(o)?h[0]?[h[0]]:[]:h.length>1?h.filter((e=>!e.onSelect({e:t}))).reverse():h;if(1===c.length)this.setActiveObject(c[0],t);else if(c.length>1){const e=at.getClass("ActiveSelection");this.setActiveObject(new e(c,{canvas:this}),t)}return this._groupSelector=null,!0}clear(){this.textEditingManager.clear(),super.clear()}destroy(){this.removeListeners(),this.textEditingManager.dispose(),super.destroy()}}const zr={x1:0,y1:0,x2:0,y2:0},Gr=c(c({},zr),{},{r1:0,r2:0}),Ur=(t,e)=>isNaN(t)&&"number"==typeof e?e:t,qr=/^(\d+\.\d+)%|(\d+)%$/;function Kr(t){return t&&qr.test(t)}function $r(t,e){const s="number"==typeof t?t:"string"==typeof t?parseFloat(t)/(Kr(t)?100:1):NaN;return Rs(0,Ur(s,e),1)}const Qr=/\s*;\s*/,Jr=/\s*:\s*/;function Zr(t,e){let s,i;const n=t.getAttribute("style");if(n){const t=n.split(Qr);""===t[t.length-1]&&t.pop();for(let e=t.length;e--;){const[n,r]=t[e].split(Jr).map((t=>t.trim()));"stop-color"===n?s=r:"stop-opacity"===n&&(i=r)}}const r=new Ye(s||t.getAttribute("stop-color")||"rgb(0,0,0)");return{offset:$r(t.getAttribute("offset"),0),color:r.toRgb(),opacity:Ur(parseFloat(i||t.getAttribute("stop-opacity")||""),1)*r.getAlpha()*e}}function to(t,e){const s=[],i=t.getElementsByTagName("stop"),n=$r(e,1);for(let r=i.length;r--;)s.push(Zr(i[r],n));return s}function eo(t){return"linearGradient"===t.nodeName||"LINEARGRADIENT"===t.nodeName?"linear":"radial"}function so(t){return"userSpaceOnUse"===t.getAttribute("gradientUnits")?"pixels":"percentage"}function io(t,e){return t.getAttribute(e)}function no(t,e){return function(t,e){let s,{width:i,height:n,gradientUnits:r}=e;return Object.keys(t).reduce(((e,o)=>{const a=t[o];return"Infinity"===a?s=1:"-Infinity"===a?s=0:(s="string"==typeof a?parseFloat(a):a,"string"==typeof a&&Kr(a)&&(s*=.01,"pixels"===r&&("x1"!==o&&"x2"!==o&&"r2"!==o||(s*=i),"y1"!==o&&"y2"!==o||(s*=n)))),e[o]=s,e}),{})}("linear"===eo(t)?function(t){return{x1:io(t,"x1")||0,y1:io(t,"y1")||0,x2:io(t,"x2")||"100%",y2:io(t,"y2")||0}}(t):function(t){return{x1:io(t,"fx")||io(t,"cx")||"50%",y1:io(t,"fy")||io(t,"cy")||"50%",r1:0,x2:io(t,"cx")||"50%",y2:io(t,"cy")||"50%",r2:io(t,"r")||"50%"}}(t),c(c({},e),{},{gradientUnits:so(t)}))}class ro{constructor(t){const{type:e="linear",gradientUnits:s="pixels",coords:i={},colorStops:n=[],offsetX:r=0,offsetY:o=0,gradientTransform:a,id:l}=t||{};Object.assign(this,{type:e,gradientUnits:s,coords:c(c({},"radial"===e?Gr:zr),i),colorStops:n,offsetX:r,offsetY:o,gradientTransform:a,id:l?"".concat(l,"_").concat(Ct()):Ct()})}addColorStop(t){for(const e in t){const s=new Ye(t[e]);this.colorStops.push({offset:parseFloat(e),color:s.toRgb(),opacity:s.getAlpha()})}return this}toObject(t){return c(c({},Ut(this,t)),{},{type:this.type,coords:c({},this.coords),colorStops:this.colorStops.map((t=>c({},t))),offsetX:this.offsetX,offsetY:this.offsetY,gradientUnits:this.gradientUnits,gradientTransform:this.gradientTransform?[...this.gradientTransform]:void 0})}toSVG(t){let{additionalTransform:e}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const s=[],i=this.gradientTransform?this.gradientTransform.concat():A.concat(),n="pixels"===this.gradientUnits?"userSpaceOnUse":"objectBoundingBox",r=this.colorStops.map((t=>c({},t))).sort(((t,e)=>t.offset-e.offset));let o=-this.offsetX,a=-this.offsetY;var l;"objectBoundingBox"===n?(o/=t.width,a/=t.height):(o+=t.width/2,a+=t.height/2),(l=t)&&"function"==typeof l._renderPathCommands&&"percentage"!==this.gradientUnits&&(o-=t.pathOffset.x,a-=t.pathOffset.y),i[4]-=o,i[5]-=a;const h=['id="SVGID_'.concat(this.id,'"'),'gradientUnits="'.concat(n,'"'),'gradientTransform="'.concat(e?e+" ":"").concat($t(i),'"'),""].join(" ");if("linear"===this.type){const{x1:t,y1:e,x2:i,y2:n}=this.coords;s.push("<linearGradient ",h,' x1="',t,'" y1="',e,'" x2="',i,'" y2="',n,'">\n')}else if("radial"===this.type){const{x1:t,y1:e,x2:i,y2:n,r1:o,r2:a}=this.coords,l=o>a;s.push("<radialGradient ",h,' cx="',l?t:i,'" cy="',l?e:n,'" r="',l?o:a,'" fx="',l?i:t,'" fy="',l?n:e,'">\n'),l&&(r.reverse(),r.forEach((t=>{t.offset=1-t.offset})));const c=Math.min(o,a);if(c>0){const t=c/Math.max(o,a);r.forEach((e=>{e.offset+=t*(1-e.offset)}))}}return r.forEach((t=>{let{color:e,offset:i,opacity:n}=t;s.push("<stop ",'offset="',100*i+"%",'" style="stop-color:',e,void 0!==n?";stop-opacity: "+n:";",'"/>\n')})),s.push("linear"===this.type?"</linearGradient>":"</radialGradient>","\n"),s.join("")}toLive(t){const{x1:e,y1:s,x2:i,y2:n,r1:r,r2:o}=this.coords,a="linear"===this.type?t.createLinearGradient(e,s,i,n):t.createRadialGradient(e,s,r,i,n,o);return this.colorStops.forEach((t=>{let{color:e,opacity:s,offset:i}=t;a.addColorStop(i,void 0!==s?new Ye(e).setAlpha(s).toRgba():e)})),a}static async fromObject(t){const{colorStops:e,gradientTransform:s}=t;return new this(c(c({},t),{},{colorStops:e?e.map((t=>c({},t))):void 0,gradientTransform:s?[...s]:void 0}))}static fromElement(t,e,s){const i=so(t),n=e._findCenterFromElement();return new this(c({id:t.getAttribute("id")||void 0,type:eo(t),coords:no(t,{width:s.viewBoxWidth||s.width,height:s.viewBoxHeight||s.height}),colorStops:to(t,s.opacity),gradientUnits:i,gradientTransform:In(t.getAttribute("gradientTransform")||"")},"pixels"===i?{offsetX:e.width/2-n.x,offsetY:e.height/2-n.y}:{offsetX:0,offsetY:0}))}}l(ro,"type","Gradient"),at.setClass(ro,"gradient"),at.setClass(ro,"linear"),at.setClass(ro,"radial");const oo=["type","source","patternTransform"];class ao{get type(){return"pattern"}set type(t){f("warn","Setting type has no effect",t)}constructor(t){l(this,"repeat","repeat"),l(this,"offsetX",0),l(this,"offsetY",0),l(this,"crossOrigin",""),this.id=Ct(),Object.assign(this,t)}isImageSource(){return!!this.source&&"string"==typeof this.source.src}isCanvasSource(){return!!this.source&&!!this.source.toDataURL}sourceToString(){return this.isImageSource()?this.source.src:this.isCanvasSource()?this.source.toDataURL():""}toLive(t){return this.source&&(!this.isImageSource()||this.source.complete&&0!==this.source.naturalWidth&&0!==this.source.naturalHeight)?t.createPattern(this.source,this.repeat):null}toObject(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];const{repeat:e,crossOrigin:s}=this;return c(c({},Ut(this,t)),{},{type:"pattern",source:this.sourceToString(),repeat:e,crossOrigin:s,offsetX:Kt(this.offsetX,p.NUM_FRACTION_DIGITS),offsetY:Kt(this.offsetY,p.NUM_FRACTION_DIGITS),patternTransform:this.patternTransform?[...this.patternTransform]:null})}toSVG(t){let{width:e,height:s}=t;const{source:i,repeat:n,id:r}=this,o=Ur(this.offsetX/e,0),a=Ur(this.offsetY/s,0),l="repeat-y"===n||"no-repeat"===n?1+Math.abs(o||0):Ur(i.width/e,0),h="repeat-x"===n||"no-repeat"===n?1+Math.abs(a||0):Ur(i.height/s,0);return['<pattern id="SVGID_'.concat(r,'" x="').concat(o,'" y="').concat(a,'" width="').concat(l,'" height="').concat(h,'">'),'<image x="0" y="0" width="'.concat(i.width,'" height="').concat(i.height,'" xlink:href="').concat(this.sourceToString(),'"></image>'),"</pattern>",""].join("\n")}static async fromObject(t,e){let{type:s,source:i,patternTransform:n}=t,r=u(t,oo);const o=await Ht(i,c(c({},e),{},{crossOrigin:r.crossOrigin}));return new this(c(c({},r),{},{patternTransform:n&&n.slice(0),source:o}))}}l(ao,"type","Pattern"),at.setClass(ao),at.setClass(ao,"pattern");const lo=["path","left","top"],ho=["d"];class co extends Wi{constructor(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},{path:s,left:i,top:n}=e,r=u(e,lo);super(),Object.assign(this,co.ownDefaults),this.setOptions(r),this._setPath(t||[],!0),"number"==typeof i&&this.set(F,i),"number"==typeof n&&this.set(j,n)}_setPath(t,e){this.path=cr(Array.isArray(t)?t:Or(t)),this.setBoundingBox(e)}_findCenterFromElement(){const t=this._calcBoundsFromPath();return new gt(t.left+t.width/2,t.top+t.height/2)}_renderPathCommands(t){const e=-this.pathOffset.x,s=-this.pathOffset.y;t.beginPath();for(const i of this.path)switch(i[0]){case"L":t.lineTo(i[1]+e,i[2]+s);break;case"M":t.moveTo(i[1]+e,i[2]+s);break;case"C":t.bezierCurveTo(i[1]+e,i[2]+s,i[3]+e,i[4]+s,i[5]+e,i[6]+s);break;case"Q":t.quadraticCurveTo(i[1]+e,i[2]+s,i[3]+e,i[4]+s);break;case"Z":t.closePath()}}_render(t){this._renderPathCommands(t),this._renderPaintInOrder(t)}toString(){return"#<Path (".concat(this.complexity(),'): { "top": ').concat(this.top,', "left": ').concat(this.left," }>")}toObject(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];return c(c({},super.toObject(t)),{},{path:this.path.map((t=>t.slice()))})}toDatalessObject(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];const e=this.toObject(t);return this.sourcePath&&(delete e.path,e.sourcePath=this.sourcePath),e}_toSVG(){const t=Dr(this.path,p.NUM_FRACTION_DIGITS);return["<path ","COMMON_PARTS",'d="'.concat(t,'" stroke-linecap="round" />\n')]}_getOffsetTransform(){const t=p.NUM_FRACTION_DIGITS;return" translate(".concat(Kt(-this.pathOffset.x,t),", ").concat(Kt(-this.pathOffset.y,t),")")}toClipPathSVG(t){const e=this._getOffsetTransform();return"\t"+this._createBaseClipPathSVGMarkup(this._toSVG(),{reviver:t,additionalTransform:e})}toSVG(t){const e=this._getOffsetTransform();return this._createBaseSVGMarkup(this._toSVG(),{reviver:t,additionalTransform:e})}complexity(){return this.path.length}setDimensions(){this.setBoundingBox()}setBoundingBox(t){const{width:e,height:s,pathOffset:i}=this._calcDimensions();this.set({width:e,height:s,pathOffset:i}),t&&this.setPositionByOrigin(i,L,L)}_calcBoundsFromPath(){const t=[];let e=0,s=0,i=0,n=0;for(const r of this.path)switch(r[0]){case"L":i=r[1],n=r[2],t.push({x:e,y:s},{x:i,y:n});break;case"M":i=r[1],n=r[2],e=i,s=n;break;case"C":t.push(...lr(i,n,r[1],r[2],r[3],r[4],r[5],r[6])),i=r[5],n=r[6];break;case"Q":t.push(...lr(i,n,r[1],r[2],r[1],r[2],r[3],r[4])),i=r[3],n=r[4];break;case"Z":i=e,n=s}return pe(t)}_calcDimensions(){const t=this._calcBoundsFromPath();return c(c({},t),{},{pathOffset:new gt(t.left+t.width/2,t.top+t.height/2)})}static fromObject(t){return this._fromObject(t,{extraParam:"path"})}static async fromElement(t,e,s){const i=Fn(t,this.ATTRIBUTE_NAMES,s),{d:n}=i;return new this(n,c(c(c({},u(i,ho)),e),{},{left:void 0,top:void 0}))}}l(co,"type","Path"),l(co,"cacheProperties",[...Fs,"path","fillRule"]),l(co,"ATTRIBUTE_NAMES",[...nn,"d"]),at.setClass(co),at.setSVGClass(co);const uo=["left","top","radius"],go=["radius","startAngle","endAngle","counterClockwise"];class po extends Wi{static getDefaults(){return c(c({},super.getDefaults()),po.ownDefaults)}constructor(t){super(),Object.assign(this,po.ownDefaults),this.setOptions(t)}_set(t,e){return super._set(t,e),"radius"===t&&this.setRadius(e),this}_render(t){t.beginPath(),t.arc(0,0,this.radius,Ot(this.startAngle),Ot(this.endAngle),this.counterClockwise),this._renderPaintInOrder(t)}getRadiusX(){return this.get("radius")*this.get(J)}getRadiusY(){return this.get("radius")*this.get(Z)}setRadius(t){this.radius=t,this.set({width:2*t,height:2*t})}toObject(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];return super.toObject([...go,...t])}_toSVG(){const t=(this.endAngle-this.startAngle)%360;if(0===t)return["<circle ","COMMON_PARTS",'cx="0" cy="0" ','r="',"".concat(this.radius),'" />\n'];{const{radius:e}=this,s=Ot(this.startAngle),i=Ot(this.endAngle),n=ut(s)*e,r=dt(s)*e,o=ut(i)*e,a=dt(i)*e,l=t>180?1:0,h=this.counterClockwise?0:1;return['<path d="M '.concat(n," ").concat(r," A ").concat(e," ").concat(e," 0 ").concat(l," ").concat(h," ").concat(o," ").concat(a,'" '),"COMMON_PARTS"," />\n"]}}static async fromElement(t,e,s){const i=Fn(t,this.ATTRIBUTE_NAMES,s),{left:n=0,top:r=0,radius:o=0}=i;return new this(c(c({},u(i,uo)),{},{radius:o,left:n-o,top:r-o}))}static fromObject(t){return super._fromObject(t)}}l(po,"type","Circle"),l(po,"cacheProperties",[...Fs,...go]),l(po,"ownDefaults",{radius:0,startAngle:0,endAngle:360,counterClockwise:!1}),l(po,"ATTRIBUTE_NAMES",["cx","cy","r",...nn]),at.setClass(po),at.setSVGClass(po);const fo=["x1","y1","x2","y2"],mo=["x1","y1","x2","y2"],_o=["x1","x2","y1","y2"];class vo extends Wi{constructor(){let[t,e,s,i]=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[0,0,0,0],n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};super(),Object.assign(this,vo.ownDefaults),this.setOptions(n),this.x1=t,this.x2=s,this.y1=e,this.y2=i,this._setWidthHeight();const{left:r,top:o}=n;"number"==typeof r&&this.set(F,r),"number"==typeof o&&this.set(j,o)}_setWidthHeight(){const{x1:t,y1:e,x2:s,y2:i}=this;this.width=Math.abs(s-t),this.height=Math.abs(i-e);const{left:n,top:r,width:o,height:a}=pe([{x:t,y:e},{x:s,y:i}]),l=new gt(n+o/2,r+a/2);this.setPositionByOrigin(l,L,L)}_set(t,e){return super._set(t,e),_o.includes(t)&&this._setWidthHeight(),this}_render(t){t.beginPath();const e=this.calcLinePoints();t.moveTo(e.x1,e.y1),t.lineTo(e.x2,e.y2),t.lineWidth=this.strokeWidth;const s=t.strokeStyle;var i;Qt(this.stroke)?t.strokeStyle=this.stroke.toLive(t):t.strokeStyle=null!==(i=this.stroke)&&void 0!==i?i:t.fillStyle,this.stroke&&this._renderStroke(t),t.strokeStyle=s}_findCenterFromElement(){return new gt((this.x1+this.x2)/2,(this.y1+this.y2)/2)}toObject(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];return c(c({},super.toObject(t)),this.calcLinePoints())}_getNonTransformedDimensions(){const t=super._getNonTransformedDimensions();return"butt"===this.strokeLineCap&&(0===this.width&&(t.y-=this.strokeWidth),0===this.height&&(t.x-=this.strokeWidth)),t}calcLinePoints(){const{x1:t,x2:e,y1:s,y2:i,width:n,height:r}=this,o=t<=e?-1:1,a=s<=i?-1:1;return{x1:o*n/2,x2:o*-n/2,y1:a*r/2,y2:a*-r/2}}_toSVG(){const{x1:t,x2:e,y1:s,y2:i}=this.calcLinePoints();return["<line ","COMMON_PARTS",'x1="'.concat(t,'" y1="').concat(s,'" x2="').concat(e,'" y2="').concat(i,'" />\n')]}static async fromElement(t,e,s){const i=Fn(t,this.ATTRIBUTE_NAMES,s),{x1:n=0,y1:r=0,x2:o=0,y2:a=0}=i;return new this([n,r,o,a],u(i,fo))}static fromObject(t){let{x1:e,y1:s,x2:i,y2:n}=t,r=u(t,mo);return this._fromObject(c(c({},r),{},{points:[e,s,i,n]}),{extraParam:"points"})}}l(vo,"type","Line"),l(vo,"cacheProperties",[...Fs,..._o]),l(vo,"ATTRIBUTE_NAMES",nn.concat(_o)),at.setClass(vo),at.setSVGClass(vo);class yo extends Wi{static getDefaults(){return c(c({},super.getDefaults()),yo.ownDefaults)}constructor(t){super(),Object.assign(this,yo.ownDefaults),this.setOptions(t)}_render(t){const e=this.width/2,s=this.height/2;t.beginPath(),t.moveTo(-e,s),t.lineTo(0,-s),t.lineTo(e,s),t.closePath(),this._renderPaintInOrder(t)}_toSVG(){const t=this.width/2,e=this.height/2;return["<polygon ","COMMON_PARTS",'points="',"".concat(-t," ").concat(e,",0 ").concat(-e,",").concat(t," ").concat(e),'" />']}}l(yo,"type","Triangle"),l(yo,"ownDefaults",{width:100,height:100}),at.setClass(yo),at.setSVGClass(yo);const bo=["rx","ry"];class Co extends Wi{static getDefaults(){return c(c({},super.getDefaults()),Co.ownDefaults)}constructor(t){super(),Object.assign(this,Co.ownDefaults),this.setOptions(t)}_set(t,e){switch(super._set(t,e),t){case"rx":this.rx=e,this.set("width",2*e);break;case"ry":this.ry=e,this.set("height",2*e)}return this}getRx(){return this.get("rx")*this.get(J)}getRy(){return this.get("ry")*this.get(Z)}toObject(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];return super.toObject([...bo,...t])}_toSVG(){return["<ellipse ","COMMON_PARTS",'cx="0" cy="0" rx="'.concat(this.rx,'" ry="').concat(this.ry,'" />\n')]}_render(t){t.beginPath(),t.save(),t.transform(1,0,0,this.ry/this.rx,0,0),t.arc(0,0,this.rx,0,I,!1),t.restore(),this._renderPaintInOrder(t)}static async fromElement(t,e,s){const i=Fn(t,this.ATTRIBUTE_NAMES,s);return i.left=(i.left||0)-i.rx,i.top=(i.top||0)-i.ry,new this(i)}}function xo(t){if(!t)return[];const e=t.replace(/,/g," ").trim().split(/\s+/),s=[];for(let i=0;i<e.length;i+=2)s.push({x:parseFloat(e[i]),y:parseFloat(e[i+1])});return s}l(Co,"type","Ellipse"),l(Co,"cacheProperties",[...Fs,...bo]),l(Co,"ownDefaults",{rx:0,ry:0}),l(Co,"ATTRIBUTE_NAMES",[...nn,"cx","cy","rx","ry"]),at.setClass(Co),at.setSVGClass(Co);const wo=["left","top"],So={exactBoundingBox:!1};class To extends Wi{static getDefaults(){return c(c({},super.getDefaults()),To.ownDefaults)}constructor(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};super(),l(this,"strokeDiff",void 0),Object.assign(this,To.ownDefaults),this.setOptions(e),this.points=t;const{left:s,top:i}=e;this.initialized=!0,this.setBoundingBox(!0),"number"==typeof s&&this.set(F,s),"number"==typeof i&&this.set(j,i)}isOpen(){return!0}_projectStrokeOnPoints(t){return Gi(this.points,t,this.isOpen())}_calcDimensions(t){t=c({scaleX:this.scaleX,scaleY:this.scaleY,skewX:this.skewX,skewY:this.skewY,strokeLineCap:this.strokeLineCap,strokeLineJoin:this.strokeLineJoin,strokeMiterLimit:this.strokeMiterLimit,strokeUniform:this.strokeUniform,strokeWidth:this.strokeWidth},t||{});const e=this.exactBoundingBox?this._projectStrokeOnPoints(t).map((t=>t.projectedPoint)):this.points;if(0===e.length)return{left:0,top:0,width:0,height:0,pathOffset:new gt,strokeOffset:new gt,strokeDiff:new gt};const s=pe(e),i=Yt(c(c({},t),{},{scaleX:1,scaleY:1})),n=pe(this.points.map((t=>It(t,i,!0)))),r=new gt(this.scaleX,this.scaleY);let o=s.left+s.width/2,a=s.top+s.height/2;return this.exactBoundingBox&&(o-=a*Math.tan(Ot(this.skewX)),a-=o*Math.tan(Ot(this.skewY))),c(c({},s),{},{pathOffset:new gt(o,a),strokeOffset:new gt(n.left,n.top).subtract(new gt(s.left,s.top)).multiply(r),strokeDiff:new gt(s.width,s.height).subtract(new gt(n.width,n.height)).multiply(r)})}_findCenterFromElement(){const t=pe(this.points);return new gt(t.left+t.width/2,t.top+t.height/2)}setDimensions(){this.setBoundingBox()}setBoundingBox(t){const{left:e,top:s,width:i,height:n,pathOffset:r,strokeOffset:o,strokeDiff:a}=this._calcDimensions();this.set({width:i,height:n,pathOffset:r,strokeOffset:o,strokeDiff:a}),t&&this.setPositionByOrigin(new gt(e+i/2,s+n/2),L,L)}isStrokeAccountedForInDimensions(){return this.exactBoundingBox}_getNonTransformedDimensions(){return this.exactBoundingBox?new gt(this.width,this.height):super._getNonTransformedDimensions()}_getTransformedDimensions(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};if(this.exactBoundingBox){let r;if(Object.keys(t).some((t=>this.strokeUniform||this.constructor.layoutProperties.includes(t)))){var e,s;const{width:i,height:n}=this._calcDimensions(t);r=new gt(null!==(e=t.width)&&void 0!==e?e:i,null!==(s=t.height)&&void 0!==s?s:n)}else{var i,n;r=new gt(null!==(i=t.width)&&void 0!==i?i:this.width,null!==(n=t.height)&&void 0!==n?n:this.height)}return r.multiply(new gt(t.scaleX||this.scaleX,t.scaleY||this.scaleY))}return super._getTransformedDimensions(t)}_set(t,e){const s=this.initialized&&this[t]!==e,i=super._set(t,e);return this.exactBoundingBox&&s&&((t===J||t===Z)&&this.strokeUniform&&this.constructor.layoutProperties.includes("strokeUniform")||this.constructor.layoutProperties.includes(t))&&this.setDimensions(),i}toObject(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];return c(c({},super.toObject(t)),{},{points:this.points.map((t=>{let{x:e,y:s}=t;return{x:e,y:s}}))})}_toSVG(){const t=[],e=this.pathOffset.x,s=this.pathOffset.y,i=p.NUM_FRACTION_DIGITS;for(let n=0,r=this.points.length;n<r;n++)t.push(Kt(this.points[n].x-e,i),",",Kt(this.points[n].y-s,i)," ");return["<".concat(this.constructor.type.toLowerCase()," "),"COMMON_PARTS",'points="'.concat(t.join(""),'" />\n')]}_render(t){const e=this.points.length,s=this.pathOffset.x,i=this.pathOffset.y;if(e&&!isNaN(this.points[e-1].y)){t.beginPath(),t.moveTo(this.points[0].x-s,this.points[0].y-i);for(let n=0;n<e;n++){const e=this.points[n];t.lineTo(e.x-s,e.y-i)}!this.isOpen()&&t.closePath(),this._renderPaintInOrder(t)}}complexity(){return this.points.length}static async fromElement(t,e,s){return new this(xo(t.getAttribute("points")),c(c({},u(Fn(t,this.ATTRIBUTE_NAMES,s),wo)),e))}static fromObject(t){return this._fromObject(t,{extraParam:"points"})}}l(To,"ownDefaults",So),l(To,"type","Polyline"),l(To,"layoutProperties",[tt,et,"strokeLineCap","strokeLineJoin","strokeMiterLimit","strokeWidth","strokeUniform","points"]),l(To,"cacheProperties",[...Fs,"points"]),l(To,"ATTRIBUTE_NAMES",[...nn]),at.setClass(To),at.setSVGClass(To);class ko extends To{isOpen(){return!1}}l(ko,"ownDefaults",So),l(ko,"type","Polygon"),at.setClass(ko),at.setSVGClass(ko);class Oo extends Wi{isEmptyStyles(t){if(!this.styles)return!0;if(void 0!==t&&!this.styles[t])return!0;const e=void 0===t?this.styles:{line:this.styles[t]};for(const s in e)for(const t in e[s])for(const i in e[s][t])return!1;return!0}styleHas(t,e){if(!this.styles)return!1;if(void 0!==e&&!this.styles[e])return!1;const s=void 0===e?this.styles:{0:this.styles[e]};for(const i in s)for(const e in s[i])if(void 0!==s[i][e][t])return!0;return!1}cleanStyle(t){if(!this.styles)return!1;const e=this.styles;let s,i,n=0,r=!0,o=0;for(const a in e){s=0;for(const o in e[a]){const l=e[a][o]||{};n++,void 0!==l[t]?(i?l[t]!==i&&(r=!1):i=l[t],l[t]===this[t]&&delete l[t]):r=!1,0!==Object.keys(l).length?s++:delete e[a][o]}0===s&&delete e[a]}for(let a=0;a<this._textLines.length;a++)o+=this._textLines[a].length;r&&n===o&&(this[t]=i,this.removeStyle(t))}removeStyle(t){if(!this.styles)return;const e=this.styles;let s,i,n;for(i in e){for(n in s=e[i],s)delete s[n][t],0===Object.keys(s[n]).length&&delete s[n];0===Object.keys(s).length&&delete e[i]}}_extendStyles(t,e){const{lineIndex:s,charIndex:i}=this.get2DCursorLocation(t);this._getLineStyle(s)||this._setLineStyle(s);const n=qt(c(c({},this._getStyleDeclaration(s,i)),e),(t=>void 0!==t));this._setStyleDeclaration(s,i,n)}getSelectionStyles(t,e,s){const i=[];for(let n=t;n<(e||t);n++)i.push(this.getStyleAtPosition(n,s));return i}getStyleAtPosition(t,e){const{lineIndex:s,charIndex:i}=this.get2DCursorLocation(t);return e?this.getCompleteStyleDeclaration(s,i):this._getStyleDeclaration(s,i)}setSelectionStyles(t,e,s){for(let i=e;i<(s||e);i++)this._extendStyles(i,t);this._forceClearCache=!0}_getStyleDeclaration(t,e){var s;const i=this.styles&&this.styles[t];return i&&null!==(s=i[e])&&void 0!==s?s:{}}getCompleteStyleDeclaration(t,e){return c(c({},Ut(this,this.constructor._styleProperties)),this._getStyleDeclaration(t,e))}_setStyleDeclaration(t,e,s){this.styles[t][e]=s}_deleteStyleDeclaration(t,e){delete this.styles[t][e]}_getLineStyle(t){return!!this.styles[t]}_setLineStyle(t){this.styles[t]={}}_deleteLineStyle(t){delete this.styles[t]}}l(Oo,"_styleProperties",Ze);const Eo=/  +/g,Do=/"/g;function Io(t,e,s,i,n){return"\t\t".concat(function(t,e){let{left:s,top:i,width:n,height:r}=e,o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:p.NUM_FRACTION_DIGITS;const a=ze(st,t,!1),[l,h,c,u]=[s,i,n,r].map((t=>Kt(t,o)));return"<rect ".concat(a,' x="').concat(l,'" y="').concat(h,'" width="').concat(c,'" height="').concat(u,'"></rect>')}(t,{left:e,top:s,width:i,height:n}),"\n")}const Po=["textAnchor","textDecoration","dx","dy","top","left","fontSize","strokeWidth"];let Ao;class Mo extends Oo{static getDefaults(){return c(c({},super.getDefaults()),Mo.ownDefaults)}constructor(t,e){super(),l(this,"__charBounds",[]),Object.assign(this,Mo.ownDefaults),this.setOptions(e),this.styles||(this.styles={}),this.text=t,this.initialized=!0,this.path&&this.setPathInfo(),this.initDimensions(),this.setCoords()}setPathInfo(){const t=this.path;t&&(t.segmentsInfo=Cr(t.path))}_splitText(){const t=this._splitTextIntoLines(this.text);return this.textLines=t.lines,this._textLines=t.graphemeLines,this._unwrappedTextLines=t._unwrappedLines,this._text=t.graphemeText,t}initDimensions(){this._splitText(),this._clearCache(),this.dirty=!0,this.path?(this.width=this.path.width,this.height=this.path.height):(this.width=this.calcTextWidth()||this.cursorWidth||this.MIN_TEXT_WIDTH,this.height=this.calcTextHeight()),this.textAlign.includes(es)&&this.enlargeSpaces()}enlargeSpaces(){let t,e,s,i,n,r,o;for(let a=0,l=this._textLines.length;a<l;a++)if((this.textAlign===es||a!==l-1&&!this.isEndOfWrapping(a))&&(i=0,n=this._textLines[a],e=this.getLineWidth(a),e<this.width&&(o=this.textLines[a].match(this._reSpacesAndTabs)))){s=o.length,t=(this.width-e)/s;for(let e=0;e<=n.length;e++)r=this.__charBounds[a][e],this._reSpaceAndTab.test(n[e])?(r.width+=t,r.kernedWidth+=t,r.left+=i,i+=t):r.left+=i}}isEndOfWrapping(t){return t===this._textLines.length-1}missingNewlineOffset(t){return 1}get2DCursorLocation(t,e){const s=e?this._unwrappedTextLines:this._textLines;let i;for(i=0;i<s.length;i++){if(t<=s[i].length)return{lineIndex:i,charIndex:t};t-=s[i].length+this.missingNewlineOffset(i,e)}return{lineIndex:i-1,charIndex:s[i-1].length<t?s[i-1].length:t}}toString(){return"#<Text (".concat(this.complexity(),'): { "text": "').concat(this.text,'", "fontFamily": "').concat(this.fontFamily,'" }>')}_getCacheCanvasDimensions(){const t=super._getCacheCanvasDimensions(),e=this.fontSize;return t.width+=e*t.zoomX,t.height+=e*t.zoomY,t}_render(t){const e=this.path;e&&!e.isNotVisible()&&e._render(t),this._setTextStyles(t),this._renderTextLinesBackground(t),this._renderTextDecoration(t,"underline"),this._renderText(t),this._renderTextDecoration(t,"overline"),this._renderTextDecoration(t,"linethrough")}_renderText(t){this.paintFirst===it?(this._renderTextStroke(t),this._renderTextFill(t)):(this._renderTextFill(t),this._renderTextStroke(t))}_setTextStyles(t,e,s){if(t.textBaseline="alphabetic",this.path)switch(this.pathAlign){case L:t.textBaseline="middle";break;case"ascender":t.textBaseline=j;break;case"descender":t.textBaseline=N}t.font=this._getFontDeclaration(e,s)}calcTextWidth(){let t=this.getLineWidth(0);for(let e=1,s=this._textLines.length;e<s;e++){const s=this.getLineWidth(e);s>t&&(t=s)}return t}_renderTextLine(t,e,s,i,n,r){this._renderChars(t,e,s,i,n,r)}_renderTextLinesBackground(t){if(!this.textBackgroundColor&&!this.styleHas("textBackgroundColor"))return;const e=t.fillStyle,s=this._getLeftOffset();let i=this._getTopOffset();for(let n=0,r=this._textLines.length;n<r;n++){const e=this.getHeightOfLine(n);if(!this.textBackgroundColor&&!this.styleHas("textBackgroundColor",n)){i+=e;continue}const r=this._textLines[n].length,o=this._getLineLeftOffset(n);let a,l,h=0,c=0,u=this.getValueOfPropertyAt(n,0,"textBackgroundColor");for(let d=0;d<r;d++){const r=this.__charBounds[n][d];l=this.getValueOfPropertyAt(n,d,"textBackgroundColor"),this.path?(t.save(),t.translate(r.renderLeft,r.renderTop),t.rotate(r.angle),t.fillStyle=l,l&&t.fillRect(-r.width/2,-e/this.lineHeight*(1-this._fontSizeFraction),r.width,e/this.lineHeight),t.restore()):l!==u?(a=s+o+c,"rtl"===this.direction&&(a=this.width-a-h),t.fillStyle=u,u&&t.fillRect(a,i,h,e/this.lineHeight),c=r.left,h=r.width,u=l):h+=r.kernedWidth}l&&!this.path&&(a=s+o+c,"rtl"===this.direction&&(a=this.width-a-h),t.fillStyle=l,t.fillRect(a,i,h,e/this.lineHeight)),i+=e}t.fillStyle=e,this._removeShadow(t)}_measureChar(t,e,s,i){const n=k.getFontCache(e),r=this._getFontDeclaration(e),o=s+t,a=s&&r===this._getFontDeclaration(i),l=e.fontSize/this.CACHE_FONT_SIZE;let h,c,u,d;if(s&&void 0!==n[s]&&(u=n[s]),void 0!==n[t]&&(d=h=n[t]),a&&void 0!==n[o]&&(c=n[o],d=c-u),void 0===h||void 0===u||void 0===c){const i=function(){if(!Ao){const t=St({width:0,height:0});Ao=t.getContext("2d")}return Ao}();this._setTextStyles(i,e,!0),void 0===h&&(d=h=i.measureText(t).width,n[t]=h),void 0===u&&a&&s&&(u=i.measureText(s).width,n[s]=u),a&&void 0===c&&(c=i.measureText(o).width,n[o]=c,d=c-u)}return{width:h*l,kernedWidth:d*l}}getHeightOfChar(t,e){return this.getValueOfPropertyAt(t,e,"fontSize")}measureLine(t){const e=this._measureLine(t);return 0!==this.charSpacing&&(e.width-=this._getWidthOfCharSpacing()),e.width<0&&(e.width=0),e}_measureLine(t){let e,s,i=0;const n=this.pathSide===B,r=this.path,o=this._textLines[t],a=o.length,l=new Array(a);this.__charBounds[t]=l;for(let h=0;h<a;h++){const n=o[h];s=this._getGraphemeBox(n,t,h,e),l[h]=s,i+=s.kernedWidth,e=n}if(l[a]={left:s?s.left+s.width:0,width:0,kernedWidth:0,height:this.fontSize,deltaY:0},r&&r.segmentsInfo){let t=0;const e=r.segmentsInfo[r.segmentsInfo.length-1].length;switch(this.textAlign){case F:t=n?e-i:0;break;case L:t=(e-i)/2;break;case B:t=n?0:e-i}t+=this.pathStartOffset*(n?-1:1);for(let i=n?a-1:0;n?i>=0:i<a;n?i--:i++)s=l[i],t>e?t%=e:t<0&&(t+=e),this._setGraphemeOnPath(t,s),t+=s.kernedWidth}return{width:i,numOfSpaces:0}}_setGraphemeOnPath(t,e){const s=t+e.kernedWidth/2,i=this.path,n=xr(i.path,s,i.segmentsInfo);e.renderLeft=n.x-i.pathOffset.x,e.renderTop=n.y-i.pathOffset.y,e.angle=n.angle+(this.pathSide===B?Math.PI:0)}_getGraphemeBox(t,e,s,i,n){const r=this.getCompleteStyleDeclaration(e,s),o=i?this.getCompleteStyleDeclaration(e,s-1):{},a=this._measureChar(t,r,i,o);let l,h=a.kernedWidth,c=a.width;0!==this.charSpacing&&(l=this._getWidthOfCharSpacing(),c+=l,h+=l);const u={width:c,left:0,height:r.fontSize,kernedWidth:h,deltaY:r.deltaY};if(s>0&&!n){const t=this.__charBounds[e][s-1];u.left=t.left+t.width+a.kernedWidth-a.width}return u}getHeightOfLine(t){if(this.__lineHeights[t])return this.__lineHeights[t];let e=this.getHeightOfChar(t,0);for(let s=1,i=this._textLines[t].length;s<i;s++)e=Math.max(this.getHeightOfChar(t,s),e);return this.__lineHeights[t]=e*this.lineHeight*this._fontSizeMult}calcTextHeight(){let t,e=0;for(let s=0,i=this._textLines.length;s<i;s++)t=this.getHeightOfLine(s),e+=s===i-1?t/this.lineHeight:t;return e}_getLeftOffset(){return"ltr"===this.direction?-this.width/2:this.width/2}_getTopOffset(){return-this.height/2}_renderTextCommon(t,e){t.save();let s=0;const i=this._getLeftOffset(),n=this._getTopOffset();for(let r=0,o=this._textLines.length;r<o;r++){const o=this.getHeightOfLine(r),a=o/this.lineHeight,l=this._getLineLeftOffset(r);this._renderTextLine(e,t,this._textLines[r],i+l,n+s+a,r),s+=o}t.restore()}_renderTextFill(t){(this.fill||this.styleHas(st))&&this._renderTextCommon(t,"fillText")}_renderTextStroke(t){(this.stroke&&0!==this.strokeWidth||!this.isEmptyStyles())&&(this.shadow&&!this.shadow.affectStroke&&this._removeShadow(t),t.save(),this._setLineDash(t,this.strokeDashArray),t.beginPath(),this._renderTextCommon(t,"strokeText"),t.closePath(),t.restore())}_renderChars(t,e,s,i,n,r){const o=this.getHeightOfLine(r),a=this.textAlign.includes(es),l=this.path,h=!a&&0===this.charSpacing&&this.isEmptyStyles(r)&&!l,c="ltr"===this.direction,u="ltr"===this.direction?1:-1,d=e.direction;let g,p,f,m,_,v="",y=0;if(e.save(),d!==this.direction&&(e.canvas.setAttribute("dir",c?"ltr":"rtl"),e.direction=c?"ltr":"rtl",e.textAlign=c?F:B),n-=o*this._fontSizeFraction/this.lineHeight,h)return this._renderChar(t,e,r,0,s.join(""),i,n),void e.restore();for(let b=0,C=s.length-1;b<=C;b++)m=b===C||this.charSpacing||l,v+=s[b],f=this.__charBounds[r][b],0===y?(i+=u*(f.kernedWidth-f.width),y+=f.width):y+=f.kernedWidth,a&&!m&&this._reSpaceAndTab.test(s[b])&&(m=!0),m||(g=g||this.getCompleteStyleDeclaration(r,b),p=this.getCompleteStyleDeclaration(r,b+1),m=tn(g,p,!1)),m&&(l?(e.save(),e.translate(f.renderLeft,f.renderTop),e.rotate(f.angle),this._renderChar(t,e,r,b,v,-y/2,0),e.restore()):(_=i,this._renderChar(t,e,r,b,v,_,n)),v="",g=p,i+=u*y,y=0);e.restore()}_applyPatternGradientTransformText(t){const e=this.width+this.strokeWidth,s=this.height+this.strokeWidth,i=St({width:e,height:s}),n=i.getContext("2d");return i.width=e,i.height=s,n.beginPath(),n.moveTo(0,0),n.lineTo(e,0),n.lineTo(e,s),n.lineTo(0,s),n.closePath(),n.translate(e/2,s/2),n.fillStyle=t.toLive(n),this._applyPatternGradientTransform(n,t),n.fill(),n.createPattern(i,"no-repeat")}handleFiller(t,e,s){let i,n;return Qt(s)?"percentage"===s.gradientUnits||s.gradientTransform||s.patternTransform?(i=-this.width/2,n=-this.height/2,t.translate(i,n),t[e]=this._applyPatternGradientTransformText(s),{offsetX:i,offsetY:n}):(t[e]=s.toLive(t),this._applyPatternGradientTransform(t,s)):(t[e]=s,{offsetX:0,offsetY:0})}_setStrokeStyles(t,e){let{stroke:s,strokeWidth:i}=e;return t.lineWidth=i,t.lineCap=this.strokeLineCap,t.lineDashOffset=this.strokeDashOffset,t.lineJoin=this.strokeLineJoin,t.miterLimit=this.strokeMiterLimit,this.handleFiller(t,"strokeStyle",s)}_setFillStyles(t,e){let{fill:s}=e;return this.handleFiller(t,"fillStyle",s)}_renderChar(t,e,s,i,n,r,o){const a=this._getStyleDeclaration(s,i),l=this.getCompleteStyleDeclaration(s,i),h="fillText"===t&&l.fill,c="strokeText"===t&&l.stroke&&l.strokeWidth;if(c||h){if(e.save(),e.font=this._getFontDeclaration(l),a.textBackgroundColor&&this._removeShadow(e),a.deltaY&&(o+=a.deltaY),h){const t=this._setFillStyles(e,l);e.fillText(n,r-t.offsetX,o-t.offsetY)}if(c){const t=this._setStrokeStyles(e,l);e.strokeText(n,r-t.offsetX,o-t.offsetY)}e.restore()}}setSuperscript(t,e){this._setScript(t,e,this.superscript)}setSubscript(t,e){this._setScript(t,e,this.subscript)}_setScript(t,e,s){const i=this.get2DCursorLocation(t,!0),n=this.getValueOfPropertyAt(i.lineIndex,i.charIndex,"fontSize"),r=this.getValueOfPropertyAt(i.lineIndex,i.charIndex,"deltaY"),o={fontSize:n*s.size,deltaY:r+n*s.baseline};this.setSelectionStyles(o,t,e)}_getLineLeftOffset(t){const e=this.getLineWidth(t),s=this.width-e,i=this.textAlign,n=this.direction,r=this.isEndOfWrapping(t);let o=0;return i===es||i===ns&&!r||i===is&&!r||i===ss&&!r?0:(i===L&&(o=s/2),i===B&&(o=s),i===ns&&(o=s/2),i===is&&(o=s),"rtl"===n&&(i===B||i===es||i===is?o=0:i===F||i===ss?o=-s:i!==L&&i!==ns||(o=-s/2)),o)}_clearCache(){this._forceClearCache=!1,this.__lineWidths=[],this.__lineHeights=[],this.__charBounds=[]}getLineWidth(t){if(void 0!==this.__lineWidths[t])return this.__lineWidths[t];const{width:e}=this.measureLine(t);return this.__lineWidths[t]=e,e}_getWidthOfCharSpacing(){return 0!==this.charSpacing?this.fontSize*this.charSpacing/1e3:0}getValueOfPropertyAt(t,e,s){var i;return null!==(i=this._getStyleDeclaration(t,e)[s])&&void 0!==i?i:this[s]}_renderTextDecoration(t,e){if(!this[e]&&!this.styleHas(e))return;let s=this._getTopOffset();const i=this._getLeftOffset(),n=this.path,r=this._getWidthOfCharSpacing(),o="linethrough"===e?.5:"overline"===e?1:0,a=this.offsets[e];for(let l=0,h=this._textLines.length;l<h;l++){const h=this.getHeightOfLine(l);if(!this[e]&&!this.styleHas(e,l)){s+=h;continue}const c=this._textLines[l],u=h/this.lineHeight,d=this._getLineLeftOffset(l);let g=0,p=0,f=this.getValueOfPropertyAt(l,0,e),m=this.getValueOfPropertyAt(l,0,st),_=this.getValueOfPropertyAt(l,0,qe),v=f,y=m,b=_;const C=s+u*(1-this._fontSizeFraction);let x=this.getHeightOfChar(l,0),w=this.getValueOfPropertyAt(l,0,"deltaY");for(let s=0,r=c.length;s<r;s++){const r=this.__charBounds[l][s];v=this.getValueOfPropertyAt(l,s,e),y=this.getValueOfPropertyAt(l,s,st),b=this.getValueOfPropertyAt(l,s,qe);const h=this.getHeightOfChar(l,s),c=this.getValueOfPropertyAt(l,s,"deltaY");if(n&&v&&y){const e=this.fontSize*b/1e3;t.save(),t.fillStyle=m,t.translate(r.renderLeft,r.renderTop),t.rotate(r.angle),t.fillRect(-r.kernedWidth/2,a*h+c-o*e,r.kernedWidth,e),t.restore()}else if((v!==f||y!==m||h!==x||b!==_||c!==w)&&p>0){const e=this.fontSize*_/1e3;let s=i+d+g;"rtl"===this.direction&&(s=this.width-s-p),f&&m&&_&&(t.fillStyle=m,t.fillRect(s,C+a*x+w-o*e,p,e)),g=r.left,p=r.width,f=v,_=b,m=y,x=h,w=c}else p+=r.kernedWidth}let S=i+d+g;"rtl"===this.direction&&(S=this.width-S-p),t.fillStyle=y;const T=this.fontSize*b/1e3;v&&y&&b&&t.fillRect(S,C+a*x+w-o*T,p-r,T),s+=h}this._removeShadow(t)}_getFontDeclaration(){let{fontFamily:t=this.fontFamily,fontStyle:e=this.fontStyle,fontWeight:s=this.fontWeight,fontSize:i=this.fontSize}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=arguments.length>1?arguments[1]:void 0;const r=t.includes("'")||t.includes('"')||t.includes(",")||Mo.genericFonts.includes(t.toLowerCase())?t:'"'.concat(t,'"');return[e,s,"".concat(n?this.CACHE_FONT_SIZE:i,"px"),r].join(" ")}render(t){this.visible&&(this.canvas&&this.canvas.skipOffscreen&&!this.group&&!this.isOnScreen()||(this._forceClearCache&&this.initDimensions(),super.render(t)))}graphemeSplit(t){return $i(t)}_splitTextIntoLines(t){const e=t.split(this._reNewline),s=new Array(e.length),i=["\n"];let n=[];for(let r=0;r<e.length;r++)s[r]=this.graphemeSplit(e[r]),n=n.concat(s[r],i);return n.pop(),{_unwrappedLines:s,lines:e,graphemeText:n,graphemeLines:s}}toObject(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];return c(c({},super.toObject([...Je,...t])),{},{styles:en(this.styles,this.text)},this.path?{path:this.path.toObject()}:{})}set(t,e){const{textLayoutProperties:s}=this.constructor;super.set(t,e);let i=!1,n=!1;if("object"==typeof t)for(const r in t)"path"===r&&this.setPathInfo(),i=i||s.includes(r),n=n||"path"===r;else i=s.includes(t),n="path"===t;return n&&this.setPathInfo(),i&&this.initialized&&(this.initDimensions(),this.setCoords()),this}complexity(){return 1}static async fromElement(t,e,s){const i=Fn(t,Mo.ATTRIBUTE_NAMES,s),n=c(c({},e),i),{textAnchor:r=F,textDecoration:o="",dx:a=0,dy:l=0,top:h=0,left:d=0,fontSize:g=M,strokeWidth:p=1}=n,f=u(n,Po),m=new this((t.textContent||"").replace(/^\s+|\s+$|\n+/g,"").replace(/\s+/g," "),c({left:d+a,top:h+l,underline:o.includes("underline"),overline:o.includes("overline"),linethrough:o.includes("line-through"),strokeWidth:0,fontSize:g},f)),_=m.getScaledHeight()/m.height,v=((m.height+m.strokeWidth)*m.lineHeight-m.height)*_,y=m.getScaledHeight()+v;let b=0;return r===L&&(b=m.getScaledWidth()/2),r===B&&(b=m.getScaledWidth()),m.set({left:m.left-b,top:m.top-(y-m.fontSize*(.07+m._fontSizeFraction))/m.lineHeight,strokeWidth:p}),m}static fromObject(t){return this._fromObject(c(c({},t),{},{styles:sn(t.styles||{},t.text)}),{extraParam:"text"})}}l(Mo,"textLayoutProperties",Qe),l(Mo,"cacheProperties",[...Fs,...Je]),l(Mo,"ownDefaults",ts),l(Mo,"type","Text"),l(Mo,"genericFonts",["serif","sans-serif","monospace","cursive","fantasy","system-ui","ui-serif","ui-sans-serif","ui-monospace","ui-rounded","math","emoji","fangsong"]),l(Mo,"ATTRIBUTE_NAMES",nn.concat("x","y","dx","dy","font-family","font-style","font-weight","font-size","letter-spacing","text-decoration","text-anchor")),Bi(Mo,[class extends Ge{_toSVG(){const t=this._getSVGLeftTopOffsets(),e=this._getSVGTextAndBg(t.textTop,t.textLeft);return this._wrapSVGTextAndBg(e)}toSVG(t){const e=this._createBaseSVGMarkup(this._toSVG(),{reviver:t,noStyle:!0,withShadow:!0}),s=this.path;return s?e+s._createBaseSVGMarkup(s._toSVG(),{reviver:t,withShadow:!0,additionalTransform:$t(this.calcOwnMatrix())}):e}_getSVGLeftTopOffsets(){return{textLeft:-this.width/2,textTop:-this.height/2,lineTop:this.getHeightOfLine(0)}}_wrapSVGTextAndBg(t){let{textBgRects:e,textSpans:s}=t;const i=this.getSvgTextDecoration(this);return[e.join(""),'\t\t<text xml:space="preserve" ','font-family="'.concat(this.fontFamily.replace(Do,"'"),'" '),'font-size="'.concat(this.fontSize,'" '),this.fontStyle?'font-style="'.concat(this.fontStyle,'" '):"",this.fontWeight?'font-weight="'.concat(this.fontWeight,'" '):"",i?'text-decoration="'.concat(i,'" '):"","rtl"===this.direction?'direction="'.concat(this.direction,'" '):"",'style="',this.getSvgStyles(!0),'"',this.addPaintOrder()," >",s.join(""),"</text>\n"]}_getSVGTextAndBg(t,e){const s=[],i=[];let n,r=t;this.backgroundColor&&i.push(...Io(this.backgroundColor,-this.width/2,-this.height/2,this.width,this.height));for(let o=0,a=this._textLines.length;o<a;o++)n=this._getLineLeftOffset(o),"rtl"===this.direction&&(n+=this.width),(this.textBackgroundColor||this.styleHas("textBackgroundColor",o))&&this._setSVGTextLineBg(i,o,e+n,r),this._setSVGTextLineText(s,o,e+n,r),r+=this.getHeightOfLine(o);return{textSpans:s,textBgRects:i}}_createTextCharSpan(t,e,s,i,n){const r=p.NUM_FRACTION_DIGITS,o=this.getSvgSpanStyles(e,t!==t.trim()||!!t.match(Eo)),a=o?'style="'.concat(o,'"'):"",l=e.deltaY,h=l?' dy="'.concat(Kt(l,r),'" '):"",{angle:c,renderLeft:u,renderTop:d,width:g}=n;let f="";if(void 0!==u){const t=g/2;c&&(f=' rotate="'.concat(Kt(Et(c),r),'"'));const e=jt({angle:Et(c)});e[4]=u,e[5]=d;const n=new gt(-t,0).transform(e);s=n.x,i=n.y}return'<tspan x="'.concat(Kt(s,r),'" y="').concat(Kt(i,r),'" ').concat(h).concat(f).concat(a,">").concat(qi(t),"</tspan>")}_setSVGTextLineText(t,e,s,i){const n=this.getHeightOfLine(e),r=this.textAlign.includes(es),o=this._textLines[e];let a,l,h,c,u,d="",g=0;i+=n*(1-this._fontSizeFraction)/this.lineHeight;for(let p=0,f=o.length-1;p<=f;p++)u=p===f||this.charSpacing||this.path,d+=o[p],h=this.__charBounds[e][p],0===g?(s+=h.kernedWidth-h.width,g+=h.width):g+=h.kernedWidth,r&&!u&&this._reSpaceAndTab.test(o[p])&&(u=!0),u||(a=a||this.getCompleteStyleDeclaration(e,p),l=this.getCompleteStyleDeclaration(e,p+1),u=tn(a,l,!0)),u&&(c=this._getStyleDeclaration(e,p),t.push(this._createTextCharSpan(d,c,s,i,h)),d="",a=l,"rtl"===this.direction?s-=g:s+=g,g=0)}_setSVGTextLineBg(t,e,s,i){const n=this._textLines[e],r=this.getHeightOfLine(e)/this.lineHeight;let o,a=0,l=0,h=this.getValueOfPropertyAt(e,0,"textBackgroundColor");for(let c=0;c<n.length;c++){const{left:n,width:u,kernedWidth:d}=this.__charBounds[e][c];o=this.getValueOfPropertyAt(e,c,"textBackgroundColor"),o!==h?(h&&t.push(...Io(h,s+l,i,a,r)),l=n,a=u,h=o):a+=d}o&&t.push(...Io(h,s+l,i,a,r))}_getSVGLineTopOffset(t){let e,s=0;for(e=0;e<t;e++)s+=this.getHeightOfLine(e);const i=this.getHeightOfLine(e);return{lineTop:s,offset:(this._fontSizeMult-this._fontSizeFraction)*i/(this.lineHeight*this._fontSizeMult)}}getSvgStyles(t){return"".concat(super.getSvgStyles(t)," text-decoration-thickness: ").concat(Kt(this.textDecorationThickness*this.getObjectScaling().y/10,p.NUM_FRACTION_DIGITS),"%; white-space: pre;")}getSvgSpanStyles(t,e){const{fontFamily:s,strokeWidth:i,stroke:n,fill:r,fontSize:o,fontStyle:a,fontWeight:l,deltaY:h,textDecorationThickness:c,linethrough:u,overline:d,underline:g}=t,f=this.getSvgTextDecoration({underline:null!=g?g:this.underline,overline:null!=d?d:this.overline,linethrough:null!=u?u:this.linethrough}),m=c||this.textDecorationThickness;return[n?ze(it,n):"",i?"stroke-width: ".concat(i,"; "):"",s?"font-family: ".concat(s.includes("'")||s.includes('"')?s:"'".concat(s,"'"),"; "):"",o?"font-size: ".concat(o,"px; "):"",a?"font-style: ".concat(a,"; "):"",l?"font-weight: ".concat(l,"; "):"",f?"text-decoration: ".concat(f,"; text-decoration-thickness: ").concat(Kt(m*this.getObjectScaling().y/10,p.NUM_FRACTION_DIGITS),"%; "):"",r?ze(st,r):"",h?"baseline-shift: ".concat(-h,"; "):"",e?"white-space: pre; ":""].join("")}getSvgTextDecoration(t){return["overline","underline","line-through"].filter((e=>t[e.replace("-","")])).join(" ")}}]),at.setClass(Mo),at.setSVGClass(Mo);class Ro{constructor(t){l(this,"target",void 0),l(this,"__mouseDownInPlace",!1),l(this,"__dragStartFired",!1),l(this,"__isDraggingOver",!1),l(this,"__dragStartSelection",void 0),l(this,"__dragImageDisposer",void 0),l(this,"_dispose",void 0),this.target=t;const e=[this.target.on("dragenter",this.dragEnterHandler.bind(this)),this.target.on("dragover",this.dragOverHandler.bind(this)),this.target.on("dragleave",this.dragLeaveHandler.bind(this)),this.target.on("dragend",this.dragEndHandler.bind(this)),this.target.on("drop",this.dropHandler.bind(this))];this._dispose=()=>{e.forEach((t=>t())),this._dispose=void 0}}isPointerOverSelection(t){const e=this.target,s=e.getSelectionStartFromPointer(t);return e.isEditing&&s>=e.selectionStart&&s<=e.selectionEnd&&e.selectionStart<e.selectionEnd}start(t){return this.__mouseDownInPlace=this.isPointerOverSelection(t)}isActive(){return this.__mouseDownInPlace}end(t){const e=this.isActive();return e&&!this.__dragStartFired&&(this.target.setCursorByClick(t),this.target.initDelayedCursor(!0)),this.__mouseDownInPlace=!1,this.__dragStartFired=!1,this.__isDraggingOver=!1,e}getDragStartSelection(){return this.__dragStartSelection}setDragImage(t,e){var s;let{selectionStart:i,selectionEnd:n}=e;const r=this.target,o=r.canvas,a=new gt(r.flipX?-1:1,r.flipY?-1:1),l=r._getCursorBoundaries(i),h=new gt(l.left+l.leftOffset,l.top+l.topOffset).multiply(a).transform(r.calcTransformMatrix()),c=o.getScenePoint(t).subtract(h),u=r.getCanvasRetinaScaling(),d=r.getBoundingRect(),g=h.subtract(new gt(d.left,d.top)),p=o.viewportTransform,f=g.add(c).transform(p,!0),m=r.backgroundColor,_=Ui(r.styles);r.backgroundColor="";const v={stroke:"transparent",fill:"transparent",textBackgroundColor:"transparent"};r.setSelectionStyles(v,0,i),r.setSelectionStyles(v,n,r.text.length),r.dirty=!0;const y=r.toCanvasElement({enableRetinaScaling:o.enableRetinaScaling,viewportTransform:!0});r.backgroundColor=m,r.styles=_,r.dirty=!0,Ir(y,{position:"fixed",left:"".concat(-y.width,"px"),border:W,width:"".concat(y.width/u,"px"),height:"".concat(y.height/u,"px")}),this.__dragImageDisposer&&this.__dragImageDisposer(),this.__dragImageDisposer=()=>{y.remove()},se(t.target||this.target.hiddenTextarea).body.appendChild(y),null===(s=t.dataTransfer)||void 0===s||s.setDragImage(y,f.x,f.y)}onDragStart(t){this.__dragStartFired=!0;const e=this.target,s=this.isActive();if(s&&t.dataTransfer){const s=this.__dragStartSelection={selectionStart:e.selectionStart,selectionEnd:e.selectionEnd},i=e._text.slice(s.selectionStart,s.selectionEnd).join(""),n=c({text:e.text,value:i},s);t.dataTransfer.setData("text/plain",i),t.dataTransfer.setData("application/fabric",JSON.stringify({value:i,styles:e.getSelectionStyles(s.selectionStart,s.selectionEnd,!0)})),t.dataTransfer.effectAllowed="copyMove",this.setDragImage(t,n)}return e.abortCursorAnimation(),s}canDrop(t){if(this.target.editable&&!this.target.getActiveControl()&&!t.defaultPrevented){if(this.isActive()&&this.__dragStartSelection){const e=this.target.getSelectionStartFromPointer(t),s=this.__dragStartSelection;return e<s.selectionStart||e>s.selectionEnd}return!0}return!1}targetCanDrop(t){return this.target.canDrop(t)}dragEnterHandler(t){let{e:e}=t;const s=this.targetCanDrop(e);!this.__isDraggingOver&&s&&(this.__isDraggingOver=!0)}dragOverHandler(t){const{e:e}=t,s=this.targetCanDrop(e);!this.__isDraggingOver&&s?this.__isDraggingOver=!0:this.__isDraggingOver&&!s&&(this.__isDraggingOver=!1),this.__isDraggingOver&&(e.preventDefault(),t.canDrop=!0,t.dropTarget=this.target)}dragLeaveHandler(){(this.__isDraggingOver||this.isActive())&&(this.__isDraggingOver=!1)}dropHandler(t){var e;const{e:s}=t,i=s.defaultPrevented;this.__isDraggingOver=!1,s.preventDefault();let n=null===(e=s.dataTransfer)||void 0===e?void 0:e.getData("text/plain");if(n&&!i){const e=this.target,i=e.canvas;let r=e.getSelectionStartFromPointer(s);const{styles:o}=s.dataTransfer.types.includes("application/fabric")?JSON.parse(s.dataTransfer.getData("application/fabric")):{},a=n[Math.max(0,n.length-1)],l=0;if(this.__dragStartSelection){const t=this.__dragStartSelection.selectionStart,s=this.__dragStartSelection.selectionEnd;r>t&&r<=s?r=t:r>s&&(r-=s-t),e.removeChars(t,s),delete this.__dragStartSelection}e._reNewline.test(a)&&(e._reNewline.test(e._text[r])||r===e._text.length)&&(n=n.trimEnd()),t.didDrop=!0,t.dropTarget=e,e.insertChars(n,o,r),i.setActiveObject(e),e.enterEditing(s),e.selectionStart=Math.min(r+l,e._text.length),e.selectionEnd=Math.min(e.selectionStart+n.length,e._text.length),e.hiddenTextarea.value=e.text,e._updateTextarea(),e.hiddenTextarea.focus(),e.fire($,{index:r+l,action:"drop"}),i.fire("text:changed",{target:e}),i.contextTopDirty=!0,i.requestRenderAll()}}dragEndHandler(t){let{e:e}=t;if(this.isActive()&&this.__dragStartFired&&this.__dragStartSelection){var s;const t=this.target,i=this.target.canvas,{selectionStart:n,selectionEnd:r}=this.__dragStartSelection,o=(null===(s=e.dataTransfer)||void 0===s?void 0:s.dropEffect)||W;o===W?(t.selectionStart=n,t.selectionEnd=r,t._updateTextarea(),t.hiddenTextarea.focus()):(t.clearContextTop(),"move"===o&&(t.removeChars(n,r),t.selectionStart=t.selectionEnd=n,t.hiddenTextarea&&(t.hiddenTextarea.value=t.text),t._updateTextarea(),t.fire($,{index:n,action:"dragend"}),i.fire("text:changed",{target:t}),i.requestRenderAll()),t.exitEditing())}this.__dragImageDisposer&&this.__dragImageDisposer(),delete this.__dragImageDisposer,delete this.__dragStartSelection,this.__isDraggingOver=!1}dispose(){this._dispose&&this._dispose()}}const Lo=/[ \n\.,;!\?\-]/;class Fo extends Mo{constructor(){super(...arguments),l(this,"_currentCursorOpacity",1)}initBehavior(){this._tick=this._tick.bind(this),this._onTickComplete=this._onTickComplete.bind(this),this.updateSelectionOnMouseMove=this.updateSelectionOnMouseMove.bind(this)}onDeselect(t){return this.isEditing&&this.exitEditing(),this.selected=!1,super.onDeselect(t)}_animateCursor(t){let{toValue:e,duration:s,delay:i,onComplete:n}=t;return ti({startValue:this._currentCursorOpacity,endValue:e,duration:s,delay:i,onComplete:n,abort:()=>!this.canvas||this.selectionStart!==this.selectionEnd,onChange:t=>{this._currentCursorOpacity=t,this.renderCursorOrSelection()}})}_tick(t){this._currentTickState=this._animateCursor({toValue:0,duration:this.cursorDuration/2,delay:Math.max(t||0,100),onComplete:this._onTickComplete})}_onTickComplete(){var t;null===(t=this._currentTickCompleteState)||void 0===t||t.abort(),this._currentTickCompleteState=this._animateCursor({toValue:1,duration:this.cursorDuration,onComplete:this._tick})}initDelayedCursor(t){this.abortCursorAnimation(),this._tick(t?0:this.cursorDelay)}abortCursorAnimation(){let t=!1;[this._currentTickState,this._currentTickCompleteState].forEach((e=>{e&&!e.isDone()&&(t=!0,e.abort())})),this._currentCursorOpacity=1,t&&this.clearContextTop()}restartCursorIfNeeded(){[this._currentTickState,this._currentTickCompleteState].some((t=>!t||t.isDone()))&&this.initDelayedCursor()}selectAll(){return this.selectionStart=0,this.selectionEnd=this._text.length,this._fireSelectionChanged(),this._updateTextarea(),this}cmdAll(){this.selectAll(),this.renderCursorOrSelection()}getSelectedText(){return this._text.slice(this.selectionStart,this.selectionEnd).join("")}findWordBoundaryLeft(t){let e=0,s=t-1;if(this._reSpace.test(this._text[s]))for(;this._reSpace.test(this._text[s]);)e++,s--;for(;/\S/.test(this._text[s])&&s>-1;)e++,s--;return t-e}findWordBoundaryRight(t){let e=0,s=t;if(this._reSpace.test(this._text[s]))for(;this._reSpace.test(this._text[s]);)e++,s++;for(;/\S/.test(this._text[s])&&s<this._text.length;)e++,s++;return t+e}findLineBoundaryLeft(t){let e=0,s=t-1;for(;!/\n/.test(this._text[s])&&s>-1;)e++,s--;return t-e}findLineBoundaryRight(t){let e=0,s=t;for(;!/\n/.test(this._text[s])&&s<this._text.length;)e++,s++;return t+e}searchWordBoundary(t,e){const s=this._text;let i=t>0&&this._reSpace.test(s[t])&&(-1===e||!X.test(s[t-1]))?t-1:t,n=s[i];for(;i>0&&i<s.length&&!Lo.test(n);)i+=e,n=s[i];return-1===e&&Lo.test(n)&&i++,i}selectWord(t){var e;t=null!==(e=t)&&void 0!==e?e:this.selectionStart;const s=this.searchWordBoundary(t,-1),i=Math.max(s,this.searchWordBoundary(t,1));this.selectionStart=s,this.selectionEnd=i,this._fireSelectionChanged(),this._updateTextarea(),this.renderCursorOrSelection()}selectLine(t){var e;t=null!==(e=t)&&void 0!==e?e:this.selectionStart;const s=this.findLineBoundaryLeft(t),i=this.findLineBoundaryRight(t);this.selectionStart=s,this.selectionEnd=i,this._fireSelectionChanged(),this._updateTextarea()}enterEditing(t){!this.isEditing&&this.editable&&(this.enterEditingImpl(),this.fire("editing:entered",t?{e:t}:void 0),this._fireSelectionChanged(),this.canvas&&(this.canvas.fire("text:editing:entered",{target:this,e:t}),this.canvas.requestRenderAll()))}enterEditingImpl(){this.canvas&&(this.canvas.calcOffset(),this.canvas.textEditingManager.exitTextEditing()),this.isEditing=!0,this.initHiddenTextarea(),this.hiddenTextarea.focus(),this.hiddenTextarea.value=this.text,this._updateTextarea(),this._saveEditingProps(),this._setEditingProps(),this._textBeforeEdit=this.text,this._tick()}updateSelectionOnMouseMove(t){if(this.getActiveControl())return;const e=this.hiddenTextarea;se(e).activeElement!==e&&e.focus();const s=this.getSelectionStartFromPointer(t),i=this.selectionStart,n=this.selectionEnd;(s===this.__selectionStartOnMouseDown&&i!==n||i!==s&&n!==s)&&(s>this.__selectionStartOnMouseDown?(this.selectionStart=this.__selectionStartOnMouseDown,this.selectionEnd=s):(this.selectionStart=s,this.selectionEnd=this.__selectionStartOnMouseDown),this.selectionStart===i&&this.selectionEnd===n||(this._fireSelectionChanged(),this._updateTextarea(),this.renderCursorOrSelection()))}_setEditingProps(){this.hoverCursor="text",this.canvas&&(this.canvas.defaultCursor=this.canvas.moveCursor="text"),this.borderColor=this.editingBorderColor,this.hasControls=this.selectable=!1,this.lockMovementX=this.lockMovementY=!0}fromStringToGraphemeSelection(t,e,s){const i=s.slice(0,t),n=this.graphemeSplit(i).length;if(t===e)return{selectionStart:n,selectionEnd:n};const r=s.slice(t,e);return{selectionStart:n,selectionEnd:n+this.graphemeSplit(r).length}}fromGraphemeToStringSelection(t,e,s){const i=s.slice(0,t).join("").length;return t===e?{selectionStart:i,selectionEnd:i}:{selectionStart:i,selectionEnd:i+s.slice(t,e).join("").length}}_updateTextarea(){if(this.cursorOffsetCache={},this.hiddenTextarea){if(!this.inCompositionMode){const t=this.fromGraphemeToStringSelection(this.selectionStart,this.selectionEnd,this._text);this.hiddenTextarea.selectionStart=t.selectionStart,this.hiddenTextarea.selectionEnd=t.selectionEnd}this.updateTextareaPosition()}}updateFromTextArea(){if(!this.hiddenTextarea)return;this.cursorOffsetCache={};const t=this.hiddenTextarea;this.text=t.value,this.set("dirty",!0),this.initDimensions(),this.setCoords();const e=this.fromStringToGraphemeSelection(t.selectionStart,t.selectionEnd,t.value);this.selectionEnd=this.selectionStart=e.selectionEnd,this.inCompositionMode||(this.selectionStart=e.selectionStart),this.updateTextareaPosition()}updateTextareaPosition(){if(this.selectionStart===this.selectionEnd){const t=this._calcTextareaPosition();this.hiddenTextarea.style.left=t.left,this.hiddenTextarea.style.top=t.top}}_calcTextareaPosition(){if(!this.canvas)return{left:"1px",top:"1px"};const t=this.inCompositionMode?this.compositionStart:this.selectionStart,e=this._getCursorBoundaries(t),s=this.get2DCursorLocation(t),i=s.lineIndex,n=s.charIndex,r=this.getValueOfPropertyAt(i,n,"fontSize")*this.lineHeight,o=e.leftOffset,a=this.getCanvasRetinaScaling(),l=this.canvas.upperCanvasEl,h=l.width/a,c=l.height/a,u=h-r,d=c-r,g=new gt(e.left+o,e.top+e.topOffset+r).transform(this.calcTransformMatrix()).transform(this.canvas.viewportTransform).multiply(new gt(l.clientWidth/h,l.clientHeight/c));return g.x<0&&(g.x=0),g.x>u&&(g.x=u),g.y<0&&(g.y=0),g.y>d&&(g.y=d),g.x+=this.canvas._offset.left,g.y+=this.canvas._offset.top,{left:"".concat(g.x,"px"),top:"".concat(g.y,"px"),fontSize:"".concat(r,"px"),charHeight:r}}_saveEditingProps(){this._savedProps={hasControls:this.hasControls,borderColor:this.borderColor,lockMovementX:this.lockMovementX,lockMovementY:this.lockMovementY,hoverCursor:this.hoverCursor,selectable:this.selectable,defaultCursor:this.canvas&&this.canvas.defaultCursor,moveCursor:this.canvas&&this.canvas.moveCursor}}_restoreEditingProps(){this._savedProps&&(this.hoverCursor=this._savedProps.hoverCursor,this.hasControls=this._savedProps.hasControls,this.borderColor=this._savedProps.borderColor,this.selectable=this._savedProps.selectable,this.lockMovementX=this._savedProps.lockMovementX,this.lockMovementY=this._savedProps.lockMovementY,this.canvas&&(this.canvas.defaultCursor=this._savedProps.defaultCursor||this.canvas.defaultCursor,this.canvas.moveCursor=this._savedProps.moveCursor||this.canvas.moveCursor),delete this._savedProps)}_exitEditing(){const t=this.hiddenTextarea;this.selected=!1,this.isEditing=!1,t&&(t.blur&&t.blur(),t.parentNode&&t.parentNode.removeChild(t)),this.hiddenTextarea=null,this.abortCursorAnimation(),this.selectionStart!==this.selectionEnd&&this.clearContextTop()}exitEditingImpl(){this._exitEditing(),this.selectionEnd=this.selectionStart,this._restoreEditingProps(),this._forceClearCache&&(this.initDimensions(),this.setCoords())}exitEditing(){const t=this._textBeforeEdit!==this.text;return this.exitEditingImpl(),this.fire("editing:exited"),t&&this.fire(nt),this.canvas&&(this.canvas.fire("text:editing:exited",{target:this}),t&&this.canvas.fire("object:modified",{target:this})),this}_removeExtraneousStyles(){for(const t in this.styles)this._textLines[t]||delete this.styles[t]}removeStyleFromTo(t,e){const{lineIndex:s,charIndex:i}=this.get2DCursorLocation(t,!0),{lineIndex:n,charIndex:r}=this.get2DCursorLocation(e,!0);if(s!==n){if(this.styles[s])for(let t=i;t<this._unwrappedTextLines[s].length;t++)delete this.styles[s][t];if(this.styles[n])for(let t=r;t<this._unwrappedTextLines[n].length;t++){const e=this.styles[n][t];e&&(this.styles[s]||(this.styles[s]={}),this.styles[s][i+t-r]=e)}for(let t=s+1;t<=n;t++)delete this.styles[t];this.shiftLineStyles(n,s-n)}else if(this.styles[s]){const t=this.styles[s],e=r-i;for(let s=i;s<r;s++)delete t[s];for(const i in this.styles[s]){const s=parseInt(i,10);s>=r&&(t[s-e]=t[i],delete t[i])}}}shiftLineStyles(t,e){const s=Object.assign({},this.styles);for(const i in this.styles){const n=parseInt(i,10);n>t&&(this.styles[n+e]=s[n],s[n-e]||delete this.styles[n])}}insertNewlineStyleObject(t,e,s,i){const n={},r=this._unwrappedTextLines[t].length,o=r===e;let a=!1;s||(s=1),this.shiftLineStyles(t,s);const l=this.styles[t]?this.styles[t][0===e?e:e-1]:void 0;for(const c in this.styles[t]){const s=parseInt(c,10);s>=e&&(a=!0,n[s-e]=this.styles[t][c],o&&0===e||delete this.styles[t][c])}let h=!1;for(a&&!o&&(this.styles[t+s]=n,h=!0),(h||r>e)&&s--;s>0;)i&&i[s-1]?this.styles[t+s]={0:c({},i[s-1])}:l?this.styles[t+s]={0:c({},l)}:delete this.styles[t+s],s--;this._forceClearCache=!0}insertCharStyleObject(t,e,s,i){this.styles||(this.styles={});const n=this.styles[t],r=n?c({},n):{};s||(s=1);for(const a in r){const t=parseInt(a,10);t>=e&&(n[t+s]=r[t],r[t-s]||delete n[t])}if(this._forceClearCache=!0,i){for(;s--;)Object.keys(i[s]).length&&(this.styles[t]||(this.styles[t]={}),this.styles[t][e+s]=c({},i[s]));return}if(!n)return;const o=n[e?e-1:1];for(;o&&s--;)this.styles[t][e+s]=c({},o)}insertNewStyleBlock(t,e,s){const i=this.get2DCursorLocation(e,!0),n=[0];let r,o=0;for(let a=0;a<t.length;a++)"\n"===t[a]?(o++,n[o]=0):n[o]++;for(n[0]>0&&(this.insertCharStyleObject(i.lineIndex,i.charIndex,n[0],s),s=s&&s.slice(n[0]+1)),o&&this.insertNewlineStyleObject(i.lineIndex,i.charIndex+n[0],o),r=1;r<o;r++)n[r]>0?this.insertCharStyleObject(i.lineIndex+r,0,n[r],s):s&&this.styles[i.lineIndex+r]&&s[0]&&(this.styles[i.lineIndex+r][0]=s[0]),s=s&&s.slice(n[r]+1);n[r]>0&&this.insertCharStyleObject(i.lineIndex+r,0,n[r],s)}removeChars(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:t+1;this.removeStyleFromTo(t,e),this._text.splice(t,e-t),this.text=this._text.join(""),this.set("dirty",!0),this.initDimensions(),this.setCoords(),this._removeExtraneousStyles()}insertChars(t,e,s){let i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:s;i>s&&this.removeStyleFromTo(s,i);const n=this.graphemeSplit(t);this.insertNewStyleBlock(n,s,e),this._text=[...this._text.slice(0,s),...n,...this._text.slice(i)],this.text=this._text.join(""),this.set("dirty",!0),this.initDimensions(),this.setCoords(),this._removeExtraneousStyles()}setSelectionStartEndWithShift(t,e,s){s<=t?(e===t?this._selectionDirection=F:this._selectionDirection===B&&(this._selectionDirection=F,this.selectionEnd=t),this.selectionStart=s):s>t&&s<e?this._selectionDirection===B?this.selectionEnd=s:this.selectionStart=s:(e===t?this._selectionDirection=B:this._selectionDirection===F&&(this._selectionDirection=B,this.selectionStart=e),this.selectionEnd=s)}}class jo extends Fo{initHiddenTextarea(){const t=this.canvas&&se(this.canvas.getElement())||w(),e=t.createElement("textarea");Object.entries({autocapitalize:"off",autocorrect:"off",autocomplete:"off",spellcheck:"false","data-fabric":"textarea",wrap:"off"}).map((t=>{let[s,i]=t;return e.setAttribute(s,i)}));const{top:s,left:i,fontSize:n}=this._calcTextareaPosition();e.style.cssText="position: absolute; top: ".concat(s,"; left: ").concat(i,"; z-index: -999; opacity: 0; width: 1px; height: 1px; font-size: 1px; padding-top: ").concat(n,";"),(this.hiddenTextareaContainer||t.body).appendChild(e),Object.entries({blur:"blur",keydown:"onKeyDown",keyup:"onKeyUp",input:"onInput",copy:"copy",cut:"copy",paste:"paste",compositionstart:"onCompositionStart",compositionupdate:"onCompositionUpdate",compositionend:"onCompositionEnd"}).map((t=>{let[s,i]=t;return e.addEventListener(s,this[i].bind(this))})),this.hiddenTextarea=e}blur(){this.abortCursorAnimation()}onKeyDown(t){if(!this.isEditing)return;const e="rtl"===this.direction?this.keysMapRtl:this.keysMap;if(t.keyCode in e)this[e[t.keyCode]](t);else{if(!(t.keyCode in this.ctrlKeysMapDown)||!t.ctrlKey&&!t.metaKey)return;this[this.ctrlKeysMapDown[t.keyCode]](t)}t.stopImmediatePropagation(),t.preventDefault(),t.keyCode>=33&&t.keyCode<=40?(this.inCompositionMode=!1,this.clearContextTop(),this.renderCursorOrSelection()):this.canvas&&this.canvas.requestRenderAll()}onKeyUp(t){!this.isEditing||this._copyDone||this.inCompositionMode?this._copyDone=!1:t.keyCode in this.ctrlKeysMapUp&&(t.ctrlKey||t.metaKey)&&(this[this.ctrlKeysMapUp[t.keyCode]](t),t.stopImmediatePropagation(),t.preventDefault(),this.canvas&&this.canvas.requestRenderAll())}onInput(t){const e=this.fromPaste,{value:s,selectionStart:i,selectionEnd:n}=this.hiddenTextarea;if(this.fromPaste=!1,t&&t.stopPropagation(),!this.isEditing)return;const r=()=>{this.updateFromTextArea(),this.fire($),this.canvas&&(this.canvas.fire("text:changed",{target:this}),this.canvas.requestRenderAll())};if(""===this.hiddenTextarea.value)return this.styles={},void r();const o=this._splitTextIntoLines(s).graphemeText,a=this._text.length,l=o.length,h=this.selectionStart,c=this.selectionEnd,u=h!==c;let d,g,f,m,_=l-a;const v=this.fromStringToGraphemeSelection(i,n,s),y=h>v.selectionStart;u?(g=this._text.slice(h,c),_+=c-h):l<a&&(g=y?this._text.slice(c+_,c):this._text.slice(h,h-_));const b=o.slice(v.selectionEnd-_,v.selectionEnd);if(g&&g.length&&(b.length&&(d=this.getSelectionStyles(h,h+1,!1),d=b.map((()=>d[0]))),u?(f=h,m=c):y?(f=c-g.length,m=c):(f=c,m=c+g.length),this.removeStyleFromTo(f,m)),b.length){const{copyPasteData:t}=x();e&&b.join("")===t.copiedText&&!p.disableStyleCopyPaste&&(d=t.copiedTextStyle),this.insertNewStyleBlock(b,h,d)}r()}onCompositionStart(){this.inCompositionMode=!0}onCompositionEnd(){this.inCompositionMode=!1}onCompositionUpdate(t){let{target:e}=t;const{selectionStart:s,selectionEnd:i}=e;this.compositionStart=s,this.compositionEnd=i,this.updateTextareaPosition()}copy(){if(this.selectionStart===this.selectionEnd)return;const{copyPasteData:t}=x();t.copiedText=this.getSelectedText(),p.disableStyleCopyPaste?t.copiedTextStyle=void 0:t.copiedTextStyle=this.getSelectionStyles(this.selectionStart,this.selectionEnd,!0),this._copyDone=!0}paste(){this.fromPaste=!0}_getWidthBeforeCursor(t,e){let s,i=this._getLineLeftOffset(t);return e>0&&(s=this.__charBounds[t][e-1],i+=s.left+s.width),i}getDownCursorOffset(t,e){const s=this._getSelectionForOffset(t,e),i=this.get2DCursorLocation(s),n=i.lineIndex;if(n===this._textLines.length-1||t.metaKey||34===t.keyCode)return this._text.length-s;const r=i.charIndex,o=this._getWidthBeforeCursor(n,r),a=this._getIndexOnLine(n+1,o);return this._textLines[n].slice(r).length+a+1+this.missingNewlineOffset(n)}_getSelectionForOffset(t,e){return t.shiftKey&&this.selectionStart!==this.selectionEnd&&e?this.selectionEnd:this.selectionStart}getUpCursorOffset(t,e){const s=this._getSelectionForOffset(t,e),i=this.get2DCursorLocation(s),n=i.lineIndex;if(0===n||t.metaKey||33===t.keyCode)return-s;const r=i.charIndex,o=this._getWidthBeforeCursor(n,r),a=this._getIndexOnLine(n-1,o),l=this._textLines[n].slice(0,r),h=this.missingNewlineOffset(n-1);return-this._textLines[n-1].length+a-l.length+(1-h)}_getIndexOnLine(t,e){const s=this._textLines[t];let i,n,r=this._getLineLeftOffset(t),o=0;for(let a=0,l=s.length;a<l;a++)if(i=this.__charBounds[t][a].width,r+=i,r>e){n=!0;const t=r-i,s=r,l=Math.abs(t-e);o=Math.abs(s-e)<l?a:a-1;break}return n||(o=s.length-1),o}moveCursorDown(t){this.selectionStart>=this._text.length&&this.selectionEnd>=this._text.length||this._moveCursorUpOrDown("Down",t)}moveCursorUp(t){0===this.selectionStart&&0===this.selectionEnd||this._moveCursorUpOrDown("Up",t)}_moveCursorUpOrDown(t,e){const s=this["get".concat(t,"CursorOffset")](e,this._selectionDirection===B);if(e.shiftKey?this.moveCursorWithShift(s):this.moveCursorWithoutShift(s),0!==s){const t=this.text.length;this.selectionStart=Rs(0,this.selectionStart,t),this.selectionEnd=Rs(0,this.selectionEnd,t),this.abortCursorAnimation(),this.initDelayedCursor(),this._fireSelectionChanged(),this._updateTextarea()}}moveCursorWithShift(t){const e=this._selectionDirection===F?this.selectionStart+t:this.selectionEnd+t;return this.setSelectionStartEndWithShift(this.selectionStart,this.selectionEnd,e),0!==t}moveCursorWithoutShift(t){return t<0?(this.selectionStart+=t,this.selectionEnd=this.selectionStart):(this.selectionEnd+=t,this.selectionStart=this.selectionEnd),0!==t}moveCursorLeft(t){0===this.selectionStart&&0===this.selectionEnd||this._moveCursorLeftOrRight("Left",t)}_move(t,e,s){let i;if(t.altKey)i=this["findWordBoundary".concat(s)](this[e]);else{if(!t.metaKey&&35!==t.keyCode&&36!==t.keyCode)return this[e]+="Left"===s?-1:1,!0;i=this["findLineBoundary".concat(s)](this[e])}return void 0!==i&&this[e]!==i&&(this[e]=i,!0)}_moveLeft(t,e){return this._move(t,e,"Left")}_moveRight(t,e){return this._move(t,e,"Right")}moveCursorLeftWithoutShift(t){let e=!0;return this._selectionDirection=F,this.selectionEnd===this.selectionStart&&0!==this.selectionStart&&(e=this._moveLeft(t,"selectionStart")),this.selectionEnd=this.selectionStart,e}moveCursorLeftWithShift(t){return this._selectionDirection===B&&this.selectionStart!==this.selectionEnd?this._moveLeft(t,"selectionEnd"):0!==this.selectionStart?(this._selectionDirection=F,this._moveLeft(t,"selectionStart")):void 0}moveCursorRight(t){this.selectionStart>=this._text.length&&this.selectionEnd>=this._text.length||this._moveCursorLeftOrRight("Right",t)}_moveCursorLeftOrRight(t,e){const s="moveCursor".concat(t).concat(e.shiftKey?"WithShift":"WithoutShift");this._currentCursorOpacity=1,this[s](e)&&(this.abortCursorAnimation(),this.initDelayedCursor(),this._fireSelectionChanged(),this._updateTextarea())}moveCursorRightWithShift(t){return this._selectionDirection===F&&this.selectionStart!==this.selectionEnd?this._moveRight(t,"selectionStart"):this.selectionEnd!==this._text.length?(this._selectionDirection=B,this._moveRight(t,"selectionEnd")):void 0}moveCursorRightWithoutShift(t){let e=!0;return this._selectionDirection=B,this.selectionStart===this.selectionEnd?(e=this._moveRight(t,"selectionStart"),this.selectionEnd=this.selectionStart):this.selectionStart=this.selectionEnd,e}}const No=t=>!!t.button;class Bo extends jo{constructor(){super(...arguments),l(this,"draggableTextDelegate",void 0)}initBehavior(){this.on("mousedown",this._mouseDownHandler),this.on("mouseup",this.mouseUpHandler),this.on("mousedblclick",this.doubleClickHandler),this.on("mousetripleclick",this.tripleClickHandler),this.draggableTextDelegate=new Ro(this),super.initBehavior()}shouldStartDragging(){return this.draggableTextDelegate.isActive()}onDragStart(t){return this.draggableTextDelegate.onDragStart(t)}canDrop(t){return this.draggableTextDelegate.canDrop(t)}doubleClickHandler(t){this.isEditing&&(this.selectWord(this.getSelectionStartFromPointer(t.e)),this.renderCursorOrSelection())}tripleClickHandler(t){this.isEditing&&(this.selectLine(this.getSelectionStartFromPointer(t.e)),this.renderCursorOrSelection())}_mouseDownHandler(t){let{e:e,alreadySelected:s}=t;this.canvas&&this.editable&&!No(e)&&!this.getActiveControl()&&(this.draggableTextDelegate.start(e)||(this.canvas.textEditingManager.register(this),s&&(this.inCompositionMode=!1,this.setCursorByClick(e)),this.isEditing&&(this.__selectionStartOnMouseDown=this.selectionStart,this.selectionStart===this.selectionEnd&&this.abortCursorAnimation(),this.renderCursorOrSelection()),this.selected||(this.selected=s||this.isEditing)))}mouseUpHandler(t){let{e:e,transform:s}=t;const i=this.draggableTextDelegate.end(e);if(this.canvas){this.canvas.textEditingManager.unregister(this);const t=this.canvas._activeObject;if(t&&t!==this)return}!this.editable||this.group&&!this.group.interactive||s&&s.actionPerformed||No(e)||i||this.selected&&!this.getActiveControl()&&(this.enterEditing(e),this.selectionStart===this.selectionEnd?this.initDelayedCursor(!0):this.renderCursorOrSelection())}setCursorByClick(t){const e=this.getSelectionStartFromPointer(t),s=this.selectionStart,i=this.selectionEnd;t.shiftKey?this.setSelectionStartEndWithShift(s,i,e):(this.selectionStart=e,this.selectionEnd=e),this.isEditing&&(this._fireSelectionChanged(),this._updateTextarea())}getSelectionStartFromPointer(t){const e=this.canvas.getScenePoint(t).transform(Pt(this.calcTransformMatrix())).add(new gt(-this._getLeftOffset(),-this._getTopOffset()));let s=0,i=0,n=0;for(let l=0;l<this._textLines.length&&s<=e.y;l++)s+=this.getHeightOfLine(l),n=l,l>0&&(i+=this._textLines[l-1].length+this.missingNewlineOffset(l-1));let r=Math.abs(this._getLineLeftOffset(n));const o=this._textLines[n].length,a=this.__charBounds[n];for(let l=0;l<o;l++){const t=r+a[l].kernedWidth;if(e.x<=t){Math.abs(e.x-t)<=Math.abs(e.x-r)&&i++;break}r=t,i++}return Math.min(this.flipX?o-i:i,this._text.length)}}const Wo="moveCursorUp",Xo="moveCursorDown",Yo="moveCursorLeft",Vo="moveCursorRight",Ho="exitEditing",zo=(t,e)=>{const s=e.getRetinaScaling();t.setTransform(s,0,0,s,0,0);const i=e.viewportTransform;t.transform(i[0],i[1],i[2],i[3],i[4],i[5])},Go=c({selectionStart:0,selectionEnd:0,selectionColor:"rgba(17,119,255,0.3)",isEditing:!1,editable:!0,editingBorderColor:"rgba(102,153,255,0.25)",cursorWidth:2,cursorColor:"",cursorDelay:1e3,cursorDuration:600,caching:!0,hiddenTextareaContainer:null,keysMap:{9:Ho,27:Ho,33:Wo,34:Xo,35:Vo,36:Yo,37:Yo,38:Wo,39:Vo,40:Xo},keysMapRtl:{9:Ho,27:Ho,33:Wo,34:Xo,35:Yo,36:Vo,37:Vo,38:Wo,39:Yo,40:Xo},ctrlKeysMapDown:{65:"cmdAll"},ctrlKeysMapUp:{67:"copy",88:"cut"}},{_selectionDirection:null,_reSpace:/\s|\r?\n/,inCompositionMode:!1});class Uo extends Bo{static getDefaults(){return c(c({},super.getDefaults()),Uo.ownDefaults)}get type(){const t=super.type;return"itext"===t?"i-text":t}constructor(t,e){super(t,c(c({},Uo.ownDefaults),e)),this.initBehavior()}_set(t,e){return this.isEditing&&this._savedProps&&t in this._savedProps?(this._savedProps[t]=e,this):("canvas"===t&&(this.canvas instanceof Hr&&this.canvas.textEditingManager.remove(this),e instanceof Hr&&e.textEditingManager.add(this)),super._set(t,e))}setSelectionStart(t){t=Math.max(t,0),this._updateAndFire("selectionStart",t)}setSelectionEnd(t){t=Math.min(t,this.text.length),this._updateAndFire("selectionEnd",t)}_updateAndFire(t,e){this[t]!==e&&(this._fireSelectionChanged(),this[t]=e),this._updateTextarea()}_fireSelectionChanged(){this.fire("selection:changed"),this.canvas&&this.canvas.fire("text:selection:changed",{target:this})}initDimensions(){this.isEditing&&this.initDelayedCursor(),super.initDimensions()}getSelectionStyles(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.selectionStart||0,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.selectionEnd,s=arguments.length>2?arguments[2]:void 0;return super.getSelectionStyles(t,e,s)}setSelectionStyles(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.selectionStart||0,s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:this.selectionEnd;return super.setSelectionStyles(t,e,s)}get2DCursorLocation(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.selectionStart,e=arguments.length>1?arguments[1]:void 0;return super.get2DCursorLocation(t,e)}render(t){super.render(t),this.cursorOffsetCache={},this.renderCursorOrSelection()}toCanvasElement(t){const e=this.isEditing;this.isEditing=!1;const s=super.toCanvasElement(t);return this.isEditing=e,s}renderCursorOrSelection(){if(!this.isEditing||!this.canvas)return;const t=this.clearContextTop(!0);if(!t)return;const e=this._getCursorBoundaries(),s=this.findAncestorsWithClipPath(),i=s.length>0;let n,r=t;if(i){n=St(t.canvas),r=n.getContext("2d"),zo(r,this.canvas);const e=this.calcTransformMatrix();r.transform(e[0],e[1],e[2],e[3],e[4],e[5])}if(this.selectionStart!==this.selectionEnd||this.inCompositionMode?this.renderSelection(r,e):this.renderCursor(r,e),i)for(const o of s){const e=o.clipPath,s=St(t.canvas),i=s.getContext("2d");if(zo(i,this.canvas),!e.absolutePositioned){const t=o.calcTransformMatrix();i.transform(t[0],t[1],t[2],t[3],t[4],t[5])}e.transform(i),e.drawObject(i,!0,{}),this.drawClipPathOnCache(r,e,s)}i&&(t.setTransform(1,0,0,1,0,0),t.drawImage(n,0,0)),this.canvas.contextTopDirty=!0,t.restore()}findAncestorsWithClipPath(){const t=[];let e=this;for(;e;)e.clipPath&&t.push(e),e=e.parent;return t}_getCursorBoundaries(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.selectionStart,e=arguments.length>1?arguments[1]:void 0;const s=this._getLeftOffset(),i=this._getTopOffset(),n=this._getCursorBoundariesOffsets(t,e);return{left:s,top:i,leftOffset:n.left,topOffset:n.top}}_getCursorBoundariesOffsets(t,e){return e?this.__getCursorBoundariesOffsets(t):this.cursorOffsetCache&&"top"in this.cursorOffsetCache?this.cursorOffsetCache:this.cursorOffsetCache=this.__getCursorBoundariesOffsets(t)}__getCursorBoundariesOffsets(t){let e=0,s=0;const{charIndex:i,lineIndex:n}=this.get2DCursorLocation(t);for(let l=0;l<n;l++)e+=this.getHeightOfLine(l);const r=this._getLineLeftOffset(n),o=this.__charBounds[n][i];o&&(s=o.left),0!==this.charSpacing&&i===this._textLines[n].length&&(s-=this._getWidthOfCharSpacing());const a={top:e,left:r+(s>0?s:0)};return"rtl"===this.direction&&(this.textAlign===B||this.textAlign===es||this.textAlign===is?a.left*=-1:this.textAlign===F||this.textAlign===ss?a.left=r-(s>0?s:0):this.textAlign!==L&&this.textAlign!==ns||(a.left=r-(s>0?s:0))),a}renderCursorAt(t){this._renderCursor(this.canvas.contextTop,this._getCursorBoundaries(t,!0),t)}renderCursor(t,e){this._renderCursor(t,e,this.selectionStart)}getCursorRenderingData(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.selectionStart,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this._getCursorBoundaries(t);const s=this.get2DCursorLocation(t),i=s.lineIndex,n=s.charIndex>0?s.charIndex-1:0,r=this.getValueOfPropertyAt(i,n,"fontSize"),o=this.getObjectScaling().x*this.canvas.getZoom(),a=this.cursorWidth/o,l=this.getValueOfPropertyAt(i,n,"deltaY"),h=e.topOffset+(1-this._fontSizeFraction)*this.getHeightOfLine(i)/this.lineHeight-r*(1-this._fontSizeFraction);return{color:this.cursorColor||this.getValueOfPropertyAt(i,n,"fill"),opacity:this._currentCursorOpacity,left:e.left+e.leftOffset-a/2,top:h+e.top+l,width:a,height:r}}_renderCursor(t,e,s){const{color:i,opacity:n,left:r,top:o,width:a,height:l}=this.getCursorRenderingData(s,e);t.fillStyle=i,t.globalAlpha=n,t.fillRect(r,o,a,l)}renderSelection(t,e){const s={selectionStart:this.inCompositionMode?this.hiddenTextarea.selectionStart:this.selectionStart,selectionEnd:this.inCompositionMode?this.hiddenTextarea.selectionEnd:this.selectionEnd};this._renderSelection(t,s,e)}renderDragSourceEffect(){const t=this.draggableTextDelegate.getDragStartSelection();this._renderSelection(this.canvas.contextTop,t,this._getCursorBoundaries(t.selectionStart,!0))}renderDropTargetEffect(t){const e=this.getSelectionStartFromPointer(t);this.renderCursorAt(e)}_renderSelection(t,e,s){const i=e.selectionStart,n=e.selectionEnd,r=this.textAlign.includes(es),o=this.get2DCursorLocation(i),a=this.get2DCursorLocation(n),l=o.lineIndex,h=a.lineIndex,c=o.charIndex<0?0:o.charIndex,u=a.charIndex<0?0:a.charIndex;for(let d=l;d<=h;d++){const e=this._getLineLeftOffset(d)||0;let i=this.getHeightOfLine(d),n=0,o=0,a=0;if(d===l&&(o=this.__charBounds[l][c].left),d>=l&&d<h)a=r&&!this.isEndOfWrapping(d)?this.width:this.getLineWidth(d)||5;else if(d===h)if(0===u)a=this.__charBounds[h][u].left;else{const t=this._getWidthOfCharSpacing();a=this.__charBounds[h][u-1].left+this.__charBounds[h][u-1].width-t}n=i,(this.lineHeight<1||d===h&&this.lineHeight>1)&&(i/=this.lineHeight);let g=s.left+e+o,p=i,f=0;const m=a-o;this.inCompositionMode?(t.fillStyle=this.compositionColor||"black",p=1,f=i):t.fillStyle=this.selectionColor,"rtl"===this.direction&&(this.textAlign===B||this.textAlign===es||this.textAlign===is?g=this.width-g-m:this.textAlign===F||this.textAlign===ss?g=s.left+e-a:this.textAlign!==L&&this.textAlign!==ns||(g=s.left+e-a)),t.fillRect(g,s.top+s.topOffset+f,m,p),s.topOffset+=n}}getCurrentCharFontSize(){const t=this._getCurrentCharIndex();return this.getValueOfPropertyAt(t.l,t.c,"fontSize")}getCurrentCharColor(){const t=this._getCurrentCharIndex();return this.getValueOfPropertyAt(t.l,t.c,st)}_getCurrentCharIndex(){const t=this.get2DCursorLocation(this.selectionStart,!0),e=t.charIndex>0?t.charIndex-1:0;return{l:t.lineIndex,c:e}}dispose(){this.exitEditingImpl(),this.draggableTextDelegate.dispose(),super.dispose()}}l(Uo,"ownDefaults",Go),l(Uo,"type","IText"),at.setClass(Uo),at.setClass(Uo,"i-text");class qo extends Uo{static getDefaults(){return c(c({},super.getDefaults()),qo.ownDefaults)}constructor(t,e){super(t,c(c({},qo.ownDefaults),e))}static createControls(){return{controls:ji()}}initDimensions(){this.initialized&&(this.isEditing&&this.initDelayedCursor(),this._clearCache(),this.dynamicMinWidth=0,this._styleMap=this._generateStyleMap(this._splitText()),this.dynamicMinWidth>this.width&&this._set("width",this.dynamicMinWidth),this.textAlign.includes(es)&&this.enlargeSpaces(),this.height=this.calcTextHeight())}_generateStyleMap(t){let e=0,s=0,i=0;const n={};for(let r=0;r<t.graphemeLines.length;r++)"\n"===t.graphemeText[i]&&r>0?(s=0,i++,e++):!this.splitByGrapheme&&this._reSpaceAndTab.test(t.graphemeText[i])&&r>0&&(s++,i++),n[r]={line:e,offset:s},i+=t.graphemeLines[r].length,s+=t.graphemeLines[r].length;return n}styleHas(t,e){if(this._styleMap&&!this.isWrapping){const t=this._styleMap[e];t&&(e=t.line)}return super.styleHas(t,e)}isEmptyStyles(t){if(!this.styles)return!0;let e,s=0,i=t+1,n=!1;const r=this._styleMap[t],o=this._styleMap[t+1];r&&(t=r.line,s=r.offset),o&&(i=o.line,n=i===t,e=o.offset);const a=void 0===t?this.styles:{line:this.styles[t]};for(const l in a)for(const t in a[l]){const i=parseInt(t,10);if(i>=s&&(!n||i<e))for(const e in a[l][t])return!1}return!0}_getStyleDeclaration(t,e){if(this._styleMap&&!this.isWrapping){const s=this._styleMap[t];if(!s)return{};t=s.line,e=s.offset+e}return super._getStyleDeclaration(t,e)}_setStyleDeclaration(t,e,s){const i=this._styleMap[t];super._setStyleDeclaration(i.line,i.offset+e,s)}_deleteStyleDeclaration(t,e){const s=this._styleMap[t];super._deleteStyleDeclaration(s.line,s.offset+e)}_getLineStyle(t){const e=this._styleMap[t];return!!this.styles[e.line]}_setLineStyle(t){const e=this._styleMap[t];super._setLineStyle(e.line)}_wrapText(t,e){this.isWrapping=!0;const s=this.getGraphemeDataForRender(t),i=[];for(let n=0;n<s.wordsData.length;n++)i.push(...this._wrapLine(n,e,s));return this.isWrapping=!1,i}getGraphemeDataForRender(t){const e=this.splitByGrapheme,s=e?"":" ";let i=0;return{wordsData:t.map(((t,n)=>{let r=0;const o=e?this.graphemeSplit(t):this.wordSplit(t);return 0===o.length?[{word:[],width:0}]:o.map((t=>{const o=e?[t]:this.graphemeSplit(t),a=this._measureWord(o,n,r);return i=Math.max(a,i),r+=o.length+s.length,{word:o,width:a}}))})),largestWordWidth:i}}_measureWord(t,e){let s,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,n=0;for(let r=0,o=t.length;r<o;r++)n+=this._getGraphemeBox(t[r],e,r+i,s,!0).kernedWidth,s=t[r];return n}wordSplit(t){return t.split(this._wordJoiners)}_wrapLine(t,e,s){let{largestWordWidth:i,wordsData:n}=s,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;const o=this._getWidthOfCharSpacing(),a=this.splitByGrapheme,l=[],h=a?"":" ";let c=0,u=[],d=0,g=0,p=!0;e-=r;const f=Math.max(e,i,this.dynamicMinWidth),m=n[t];let _;for(d=0,_=0;_<m.length;_++){const{word:e,width:s}=m[_];d+=e.length,c+=g+s-o,c>f&&!p?(l.push(u),u=[],c=s,p=!0):c+=o,p||a||u.push(h),u=u.concat(e),g=a?0:this._measureWord([h],t,d),d++,p=!1}return _&&l.push(u),i+r>this.dynamicMinWidth&&(this.dynamicMinWidth=i-o+r),l}isEndOfWrapping(t){return!this._styleMap[t+1]||this._styleMap[t+1].line!==this._styleMap[t].line}missingNewlineOffset(t,e){return this.splitByGrapheme&&!e?this.isEndOfWrapping(t)?1:0:1}_splitTextIntoLines(t){const e=super._splitTextIntoLines(t),s=this._wrapText(e.lines,this.width),i=new Array(s.length);for(let n=0;n<s.length;n++)i[n]=s[n].join("");return e.lines=i,e.graphemeLines=s,e}getMinWidth(){return Math.max(this.minWidth,this.dynamicMinWidth)}_removeExtraneousStyles(){const t=new Map;for(const e in this._styleMap){const s=parseInt(e,10);if(this._textLines[s]){const s=this._styleMap[e].line;t.set("".concat(s),!0)}}for(const e in this.styles)t.has(e)||delete this.styles[e]}toObject(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];return super.toObject(["minWidth","splitByGrapheme",...t])}}l(qo,"type","Textbox"),l(qo,"textLayoutProperties",[...Uo.textLayoutProperties,"width"]),l(qo,"ownDefaults",{minWidth:20,dynamicMinWidth:2,lockScalingFlip:!0,noScaleCache:!1,_wordJoiners:/[ \t\r]/,splitByGrapheme:!1}),at.setClass(qo);class Ko extends zn{shouldPerformLayout(t){return!!t.target.clipPath&&super.shouldPerformLayout(t)}shouldLayoutClipPath(){return!1}calcLayoutResult(t,e){const{target:s}=t,{clipPath:i,group:n}=s;if(!i||!this.shouldPerformLayout(t))return;const{width:r,height:o}=pe(Hn(s,i)),a=new gt(r,o);if(i.absolutePositioned)return{center:xe(i.getRelativeCenterPoint(),void 0,n?n.calcTransformMatrix():void 0),size:a};{const n=i.getRelativeCenterPoint().transform(s.calcOwnMatrix(),!0);if(this.shouldPerformLayout(t)){const{center:s=new gt,correction:i=new gt}=this.calcBoundingBox(e,t)||{};return{center:s.add(n),correction:i.subtract(n),size:a}}return{center:s.getRelativeCenterPoint().add(n),size:a}}}}l(Ko,"type","clip-path"),at.setClass(Ko);class $o extends zn{getInitialSize(t,e){let{target:s}=t,{size:i}=e;return new gt(s.width||i.x,s.height||i.y)}}l($o,"type","fixed"),at.setClass($o);class Qo extends $n{subscribeTargets(t){const e=t.target;t.targets.reduce(((t,e)=>(e.parent&&t.add(e.parent),t)),new Set).forEach((t=>{t.layoutManager.subscribeTargets({target:t,targets:[e]})}))}unsubscribeTargets(t){const e=t.target,s=e.getObjects();t.targets.reduce(((t,e)=>(e.parent&&t.add(e.parent),t)),new Set).forEach((t=>{!s.some((e=>e.parent===t))&&t.layoutManager.unsubscribeTargets({target:t,targets:[e]})}))}}class Jo extends Zn{static getDefaults(){return c(c({},super.getDefaults()),Jo.ownDefaults)}constructor(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};super(),Object.assign(this,Jo.ownDefaults),this.setOptions(e);const{left:s,top:i,layoutManager:n}=e;this.groupInit(t,{left:s,top:i,layoutManager:null!=n?n:new Qo})}_shouldSetNestedCoords(){return!0}__objectSelectionMonitor(){}multiSelectAdd(){for(var t=arguments.length,e=new Array(t),s=0;s<t;s++)e[s]=arguments[s];"selection-order"===this.multiSelectionStacking?this.add(...e):e.forEach((t=>{const e=this._objects.findIndex((e=>e.isInFrontOf(t))),s=-1===e?this.size():e;this.insertAt(s,t)}))}canEnterGroup(t){return this.getObjects().some((e=>e.isDescendantOf(t)||t.isDescendantOf(e)))?(f("error","ActiveSelection: circular object trees are not supported, this call has no effect"),!1):super.canEnterGroup(t)}enterGroup(t,e){t.parent&&t.parent===t.group?t.parent._exitGroup(t):t.group&&t.parent!==t.group&&t.group.remove(t),this._enterGroup(t,e)}exitGroup(t,e){this._exitGroup(t,e),t.parent&&t.parent._enterGroup(t,!0)}_onAfterObjectsChange(t,e){super._onAfterObjectsChange(t,e);const s=new Set;e.forEach((t=>{const{parent:e}=t;e&&s.add(e)})),t===Yn?s.forEach((t=>{t._onAfterObjectsChange(Xn,e)})):s.forEach((t=>{t._set("dirty",!0)}))}onDeselect(){return this.removeAll(),!1}toString(){return"#<ActiveSelection: (".concat(this.complexity(),")>")}shouldCache(){return!1}isOnACache(){return!1}_renderControls(t,e,s){t.save(),t.globalAlpha=this.isMoving?this.borderOpacityWhenMoving:1;const i=c(c({hasControls:!1},s),{},{forActiveSelection:!0});for(let n=0;n<this._objects.length;n++)this._objects[n]._renderControls(t,i);super._renderControls(t,e),t.restore()}}l(Jo,"type","ActiveSelection"),l(Jo,"ownDefaults",{multiSelectionStacking:"canvas-stacking"}),at.setClass(Jo),at.setClass(Jo,"activeSelection");class Zo{constructor(){l(this,"resources",{})}applyFilters(t,e,s,i,n){const r=n.getContext("2d");if(!r)return;r.drawImage(e,0,0,s,i);const o={sourceWidth:s,sourceHeight:i,imageData:r.getImageData(0,0,s,i),originalEl:e,originalImageData:r.getImageData(0,0,s,i),canvasEl:n,ctx:r,filterBackend:this};t.forEach((t=>{t.applyTo(o)}));const{imageData:a}=o;return a.width===s&&a.height===i||(n.width=a.width,n.height=a.height),r.putImageData(a,0,0),o}}class ta{constructor(){let{tileSize:t=p.textureSize}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};l(this,"aPosition",new Float32Array([0,0,0,1,1,0,1,1])),l(this,"resources",{}),this.tileSize=t,this.setupGLContext(t,t),this.captureGPUInfo()}setupGLContext(t,e){this.dispose(),this.createWebGLCanvas(t,e)}createWebGLCanvas(t,e){const s=St({width:t,height:e}),i=s.getContext("webgl",{alpha:!0,premultipliedAlpha:!1,depth:!1,stencil:!1,antialias:!1});i&&(i.clearColor(0,0,0,0),this.canvas=s,this.gl=i)}applyFilters(t,e,s,i,n,r){const o=this.gl,a=n.getContext("2d");if(!o||!a)return;let l;r&&(l=this.getCachedTexture(r,e));const h={originalWidth:e.width||e.naturalWidth||0,originalHeight:e.height||e.naturalHeight||0,sourceWidth:s,sourceHeight:i,destinationWidth:s,destinationHeight:i,context:o,sourceTexture:this.createTexture(o,s,i,l?void 0:e),targetTexture:this.createTexture(o,s,i),originalTexture:l||this.createTexture(o,s,i,l?void 0:e),passes:t.length,webgl:!0,aPosition:this.aPosition,programCache:this.programCache,pass:0,filterBackend:this,targetCanvas:n},c=o.createFramebuffer();return o.bindFramebuffer(o.FRAMEBUFFER,c),t.forEach((t=>{t&&t.applyTo(h)})),function(t){const e=t.targetCanvas,s=e.width,i=e.height,n=t.destinationWidth,r=t.destinationHeight;s===n&&i===r||(e.width=n,e.height=r)}(h),this.copyGLTo2D(o,h),o.bindTexture(o.TEXTURE_2D,null),o.deleteTexture(h.sourceTexture),o.deleteTexture(h.targetTexture),o.deleteFramebuffer(c),a.setTransform(1,0,0,1,0,0),h}dispose(){this.canvas&&(this.canvas=null,this.gl=null),this.clearWebGLCaches()}clearWebGLCaches(){this.programCache={},this.textureCache={}}createTexture(t,e,s,i,n){const{NEAREST:r,TEXTURE_2D:o,RGBA:a,UNSIGNED_BYTE:l,CLAMP_TO_EDGE:h,TEXTURE_MAG_FILTER:c,TEXTURE_MIN_FILTER:u,TEXTURE_WRAP_S:d,TEXTURE_WRAP_T:g}=t,p=t.createTexture();return t.bindTexture(o,p),t.texParameteri(o,c,n||r),t.texParameteri(o,u,n||r),t.texParameteri(o,d,h),t.texParameteri(o,g,h),i?t.texImage2D(o,0,a,a,l,i):t.texImage2D(o,0,a,e,s,0,a,l,null),p}getCachedTexture(t,e,s){const{textureCache:i}=this;if(i[t])return i[t];{const n=this.createTexture(this.gl,e.width,e.height,e,s);return n&&(i[t]=n),n}}evictCachesForKey(t){this.textureCache[t]&&(this.gl.deleteTexture(this.textureCache[t]),delete this.textureCache[t])}copyGLTo2D(t,e){const s=t.canvas,i=e.targetCanvas,n=i.getContext("2d");if(!n)return;n.translate(0,i.height),n.scale(1,-1);const r=s.height-i.height;n.drawImage(s,0,r,i.width,i.height,0,0,i.width,i.height)}copyGLTo2DPutImageData(t,e){const s=e.targetCanvas.getContext("2d"),i=e.destinationWidth,n=e.destinationHeight,r=i*n*4;if(!s)return;const o=new Uint8Array(this.imageBuffer,0,r),a=new Uint8ClampedArray(this.imageBuffer,0,r);t.readPixels(0,0,i,n,t.RGBA,t.UNSIGNED_BYTE,o);const l=new ImageData(a,i,n);s.putImageData(l,0,0)}captureGPUInfo(){if(this.gpuInfo)return this.gpuInfo;const t=this.gl,e={renderer:"",vendor:""};if(!t)return e;const s=t.getExtension("WEBGL_debug_renderer_info");if(s){const i=t.getParameter(s.UNMASKED_RENDERER_WEBGL),n=t.getParameter(s.UNMASKED_VENDOR_WEBGL);i&&(e.renderer=i.toLowerCase()),n&&(e.vendor=n.toLowerCase())}return this.gpuInfo=e,e}}let ea;function sa(){const{WebGLProbe:t}=x();return t.queryWebGL(xt()),p.enableGLFiltering&&t.isSupported(p.textureSize)?new ta({tileSize:p.textureSize}):new Zo}function ia(){return!ea&&(!(arguments.length>0&&void 0!==arguments[0])||arguments[0])&&(ea=sa()),ea}const na=["filters","resizeFilter","src","crossOrigin","type"],ra=["cropX","cropY"];class oa extends Wi{static getDefaults(){return c(c({},super.getDefaults()),oa.ownDefaults)}constructor(t,e){super(),l(this,"_lastScaleX",1),l(this,"_lastScaleY",1),l(this,"_filterScalingX",1),l(this,"_filterScalingY",1),this.filters=[],Object.assign(this,oa.ownDefaults),this.setOptions(e),this.cacheKey="texture".concat(Ct()),this.setElement("string"==typeof t?(this.canvas&&se(this.canvas.getElement())||w()).getElementById(t):t,e)}getElement(){return this._element}setElement(t){var e;let s=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};this.removeTexture(this.cacheKey),this.removeTexture("".concat(this.cacheKey,"_filtered")),this._element=t,this._originalElement=t,this._setWidthHeight(s),null===(e=t.classList)||void 0===e||e.add(oa.CSS_CANVAS),0!==this.filters.length&&this.applyFilters(),this.resizeFilter&&this.applyResizeFilters()}removeTexture(t){const e=ia(!1);e instanceof ta&&e.evictCachesForKey(t)}dispose(){super.dispose(),this.removeTexture(this.cacheKey),this.removeTexture("".concat(this.cacheKey,"_filtered")),this._cacheContext=null,["_originalElement","_element","_filteredEl","_cacheCanvas"].forEach((t=>{const e=this[t];e&&x().dispose(e),this[t]=void 0}))}getCrossOrigin(){return this._originalElement&&(this._originalElement.crossOrigin||null)}getOriginalSize(){const t=this.getElement();return t?{width:t.naturalWidth||t.width,height:t.naturalHeight||t.height}:{width:0,height:0}}_stroke(t){if(!this.stroke||0===this.strokeWidth)return;const e=this.width/2,s=this.height/2;t.beginPath(),t.moveTo(-e,-s),t.lineTo(e,-s),t.lineTo(e,s),t.lineTo(-e,s),t.lineTo(-e,-s),t.closePath()}toObject(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];const e=[];return this.filters.forEach((t=>{t&&e.push(t.toObject())})),c(c({},super.toObject([...ra,...t])),{},{src:this.getSrc(),crossOrigin:this.getCrossOrigin(),filters:e},this.resizeFilter?{resizeFilter:this.resizeFilter.toObject()}:{})}hasCrop(){return!!this.cropX||!!this.cropY||this.width<this._element.width||this.height<this._element.height}_toSVG(){const t=[],e=this._element,s=-this.width/2,i=-this.height/2;let n=[],r=[],o="",a="";if(!e)return[];if(this.hasCrop()){const t=Ct();n.push('<clipPath id="imageCrop_'+t+'">\n','\t<rect x="'+s+'" y="'+i+'" width="'+this.width+'" height="'+this.height+'" />\n',"</clipPath>\n"),o=' clip-path="url(#imageCrop_'+t+')" '}if(this.imageSmoothing||(a=' image-rendering="optimizeSpeed"'),t.push("\t<image ","COMMON_PARTS",'xlink:href="'.concat(this.getSvgSrc(!0),'" x="').concat(s-this.cropX,'" y="').concat(i-this.cropY,'" width="').concat(e.width||e.naturalWidth,'" height="').concat(e.height||e.naturalHeight,'"').concat(a).concat(o,"></image>\n")),this.stroke||this.strokeDashArray){const t=this.fill;this.fill=null,r=['\t<rect x="'.concat(s,'" y="').concat(i,'" width="').concat(this.width,'" height="').concat(this.height,'" style="').concat(this.getSvgStyles(),'" />\n')],this.fill=t}return n=this.paintFirst!==st?n.concat(r,t):n.concat(t,r),n}getSrc(t){const e=t?this._element:this._originalElement;return e?e.toDataURL?e.toDataURL():this.srcFromAttribute?e.getAttribute("src")||"":e.src:this.src||""}getSvgSrc(t){return this.getSrc(t)}setSrc(t){let{crossOrigin:e,signal:s}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return Ht(t,{crossOrigin:e,signal:s}).then((t=>{void 0!==e&&this.set({crossOrigin:e}),this.setElement(t)}))}toString(){return'#<Image: { src: "'.concat(this.getSrc(),'" }>')}applyResizeFilters(){const t=this.resizeFilter,e=this.minimumScaleTrigger,s=this.getTotalObjectScaling(),i=s.x,n=s.y,r=this._filteredEl||this._originalElement;if(this.group&&this.set("dirty",!0),!t||i>e&&n>e)return this._element=r,this._filterScalingX=1,this._filterScalingY=1,this._lastScaleX=i,void(this._lastScaleY=n);const o=St(r),{width:a,height:l}=r;this._element=o,this._lastScaleX=t.scaleX=i,this._lastScaleY=t.scaleY=n,ia().applyFilters([t],r,a,l,this._element),this._filterScalingX=o.width/this._originalElement.width,this._filterScalingY=o.height/this._originalElement.height}applyFilters(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.filters||[];if(t=t.filter((t=>t&&!t.isNeutralState())),this.set("dirty",!0),this.removeTexture("".concat(this.cacheKey,"_filtered")),0===t.length)return this._element=this._originalElement,this._filteredEl=void 0,this._filterScalingX=1,void(this._filterScalingY=1);const e=this._originalElement,s=e.naturalWidth||e.width,i=e.naturalHeight||e.height;if(this._element===this._originalElement){const t=St({width:s,height:i});this._element=t,this._filteredEl=t}else this._filteredEl&&(this._element=this._filteredEl,this._filteredEl.getContext("2d").clearRect(0,0,s,i),this._lastScaleX=1,this._lastScaleY=1);ia().applyFilters(t,this._originalElement,s,i,this._element,this.cacheKey),this._originalElement.width===this._element.width&&this._originalElement.height===this._element.height||(this._filterScalingX=this._element.width/this._originalElement.width,this._filterScalingY=this._element.height/this._originalElement.height)}_render(t){t.imageSmoothingEnabled=this.imageSmoothing,!0!==this.isMoving&&this.resizeFilter&&this._needsResize()&&this.applyResizeFilters(),this._stroke(t),this._renderPaintInOrder(t)}drawCacheOnCanvas(t){t.imageSmoothingEnabled=this.imageSmoothing,super.drawCacheOnCanvas(t)}shouldCache(){return this.needsItsOwnCache()}_renderFill(t){const e=this._element;if(!e)return;const s=this._filterScalingX,i=this._filterScalingY,n=this.width,r=this.height,o=Math.max(this.cropX,0),a=Math.max(this.cropY,0),l=e.naturalWidth||e.width,h=e.naturalHeight||e.height,c=o*s,u=a*i,d=Math.min(n*s,l-c),g=Math.min(r*i,h-u),p=-n/2,f=-r/2,m=Math.min(n,l/s-o),_=Math.min(r,h/i-a);e&&t.drawImage(e,c,u,d,g,p,f,m,_)}_needsResize(){const t=this.getTotalObjectScaling();return t.x!==this._lastScaleX||t.y!==this._lastScaleY}_resetWidthHeight(){this.set(this.getOriginalSize())}_setWidthHeight(){let{width:t,height:e}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};const s=this.getOriginalSize();this.width=t||s.width,this.height=e||s.height}parsePreserveAspectRatioAttribute(){const t=He(this.preserveAspectRatio||""),e=this.width,s=this.height,i={width:e,height:s};let n,r=this._element.width,o=this._element.height,a=1,l=1,h=0,c=0,u=0,d=0;return!t||t.alignX===W&&t.alignY===W?(a=e/r,l=s/o):("meet"===t.meetOrSlice&&(a=l=tr(this._element,i),n=(e-r*a)/2,"Min"===t.alignX&&(h=-n),"Max"===t.alignX&&(h=n),n=(s-o*l)/2,"Min"===t.alignY&&(c=-n),"Max"===t.alignY&&(c=n)),"slice"===t.meetOrSlice&&(a=l=er(this._element,i),n=r-e/a,"Mid"===t.alignX&&(u=n/2),"Max"===t.alignX&&(u=n),n=o-s/l,"Mid"===t.alignY&&(d=n/2),"Max"===t.alignY&&(d=n),r=e/a,o=s/l)),{width:r,height:o,scaleX:a,scaleY:l,offsetLeft:h,offsetTop:c,cropX:u,cropY:d}}static fromObject(t,e){let{filters:s,resizeFilter:i,src:n,crossOrigin:r,type:o}=t,a=u(t,na);return Promise.all([Ht(n,c(c({},e),{},{crossOrigin:r})),s&&zt(s,e),i&&zt([i],e),Gt(a,e)]).then((t=>{let[e,s=[],[i]=[],r={}]=t;return new this(e,c(c({},a),{},{src:n,filters:s,resizeFilter:i},r))}))}static fromURL(t){let{crossOrigin:e=null,signal:s}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},i=arguments.length>2?arguments[2]:void 0;return Ht(t,{crossOrigin:e,signal:s}).then((t=>new this(t,i)))}static async fromElement(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},s=arguments.length>2?arguments[2]:void 0;const i=Fn(t,this.ATTRIBUTE_NAMES,s);return this.fromURL(i["xlink:href"]||i.href,e,i).catch((t=>(f("log","Unable to parse Image",t),null)))}}function aa(t){if(!ms.test(t.nodeName))return{};const e=t.getAttribute("viewBox");let s,i,n=1,r=1,o=0,a=0;const l=t.getAttribute("width"),h=t.getAttribute("height"),c=t.getAttribute("x")||0,u=t.getAttribute("y")||0,d=!(e&&vs.test(e)),g=!l||!h||"100%"===l||"100%"===h;let p="",f=0,m=0;if(d&&(c||u)&&t.parentNode&&"#document"!==t.parentNode.nodeName&&(p=" translate("+Ve(c||"0")+" "+Ve(u||"0")+") ",s=(t.getAttribute("transform")||"")+p,t.setAttribute("transform",s),t.removeAttribute("x"),t.removeAttribute("y")),d&&g)return{width:0,height:0};const _={width:0,height:0};if(d)return _.width=Ve(l),_.height=Ve(h),_;const v=e.match(vs);o=-parseFloat(v[1]),a=-parseFloat(v[2]);const y=parseFloat(v[3]),b=parseFloat(v[4]);_.minX=o,_.minY=a,_.viewBoxWidth=y,_.viewBoxHeight=b,g?(_.width=y,_.height=b):(_.width=Ve(l),_.height=Ve(h),n=_.width/y,r=_.height/b);const C=He(t.getAttribute("preserveAspectRatio")||"");if(C.alignX!==W&&("meet"===C.meetOrSlice&&(r=n=n>r?r:n),"slice"===C.meetOrSlice&&(r=n=n>r?n:r),f=_.width-y*n,m=_.height-b*n,"Mid"===C.alignX&&(f/=2),"Mid"===C.alignY&&(m/=2),"Min"===C.alignX&&(f=0),"Min"===C.alignY&&(m=0)),1===n&&1===r&&0===o&&0===a&&0===c&&0===u)return _;if((c||u)&&"#document"!==t.parentNode.nodeName&&(p=" translate("+Ve(c||"0")+" "+Ve(u||"0")+") "),s=p+" matrix("+n+" 0 0 "+r+" "+(o*n+f)+" "+(a*r+m)+") ","svg"===t.nodeName){for(i=t.ownerDocument.createElementNS(cs,"g");t.firstChild;)i.appendChild(t.firstChild);t.appendChild(i)}else i=t,i.removeAttribute("x"),i.removeAttribute("y"),s=i.getAttribute("transform")+s;return i.setAttribute("transform",s),_}l(oa,"type","Image"),l(oa,"cacheProperties",[...Fs,...ra]),l(oa,"ownDefaults",{strokeWidth:0,srcFromAttribute:!1,minimumScaleTrigger:.5,cropX:0,cropY:0,imageSmoothing:!0}),l(oa,"CSS_CANVAS","canvas-img"),l(oa,"ATTRIBUTE_NAMES",[...nn,"x","y","width","height","preserveAspectRatio","xlink:href","href","crossOrigin","image-rendering"]),at.setClass(oa),at.setSVGClass(oa);const la=t=>t.tagName.replace("svg:",""),ha=Ue(["pattern","defs","symbol","metadata","clipPath","mask","desc"]);function ca(t,e){let s,i,n,r,o=[];for(n=0,r=e.length;n<r;n++)s=e[n],i=t.getElementsByTagNameNS("http://www.w3.org/2000/svg",s),o=o.concat(Array.from(i));return o}const ua=["gradientTransform","x1","x2","y1","y2","gradientUnits","cx","cy","r","fx","fy"],da="xlink:href";function ga(t,e){var s;const i=(null===(s=e.getAttribute(da))||void 0===s?void 0:s.slice(1))||"",n=t.getElementById(i);if(n&&n.getAttribute(da)&&ga(t,n),n&&(ua.forEach((t=>{const s=n.getAttribute(t);!e.hasAttribute(t)&&s&&e.setAttribute(t,s)})),!e.children.length)){const t=n.cloneNode(!0);for(;t.firstChild;)e.appendChild(t.firstChild)}e.removeAttribute(da)}const pa=["linearGradient","radialGradient","svg:linearGradient","svg:radialGradient"];function fa(t){const e=t.getElementsByTagName("style");let s,i;const n={};for(s=0,i=e.length;s<i;s++){const t=(e[s].textContent||"").replace(/\/\*[\s\S]*?\*\//g,"");""!==t.trim()&&t.split("}").filter(((t,e,s)=>s.length>1&&t.trim())).forEach((t=>{if((t.match(/{/g)||[]).length>1&&t.trim().startsWith("@"))return;const e=t.split("{"),r={},o=e[1].trim().split(";").filter((function(t){return t.trim()}));for(s=0,i=o.length;s<i;s++){const t=o[s].split(":"),e=t[0].trim(),i=t[1].trim();r[e]=i}(t=e[0].trim()).split(",").forEach((t=>{""!==(t=t.replace(/^svg/i,"").trim())&&(n[t]=c(c({},n[t]||{}),r))}))}))}return n}const ma=t=>at.getSVGClass(la(t).toLowerCase());class _a{constructor(t,e,s,i,n){this.elements=t,this.options=e,this.reviver=s,this.regexUrl=/^url\(['"]?#([^'"]+)['"]?\)/g,this.doc=i,this.clipPaths=n,this.gradientDefs=function(t){const e=ca(t,pa),s={};let i=e.length;for(;i--;){const n=e[i];n.getAttribute("xlink:href")&&ga(t,n);const r=n.getAttribute("id");r&&(s[r]=n)}return s}(i),this.cssRules=fa(i)}parse(){return Promise.all(this.elements.map((t=>this.createObject(t))))}async createObject(t){const e=ma(t);if(e){const s=await e.fromElement(t,this.options,this.cssRules);return this.resolveGradient(s,t,st),this.resolveGradient(s,t,it),s instanceof oa&&s._originalElement?Mr(s,s.parsePreserveAspectRatioAttribute()):Mr(s),await this.resolveClipPath(s,t),this.reviver&&this.reviver(t,s),s}return null}extractPropertyDefinition(t,e,s){const i=t[e],n=this.regexUrl;if(!n.test(i))return;n.lastIndex=0;const r=n.exec(i)[1];return n.lastIndex=0,s[r]}resolveGradient(t,e,s){const i=this.extractPropertyDefinition(t,s,this.gradientDefs);if(i){const n=e.getAttribute(s+"-opacity"),r=ro.fromElement(i,t,c(c({},this.options),{},{opacity:n}));t.set(s,r)}}async resolveClipPath(t,e,s){const i=this.extractPropertyDefinition(t,"clipPath",this.clipPaths);if(i){const n=Pt(t.calcTransformMatrix()),r=i[0].parentElement;let o=e;for(;!s&&o.parentElement&&o.getAttribute("clip-path")!==t.clipPath;)o=o.parentElement;o.parentElement.appendChild(r);const a=In("".concat(o.getAttribute("transform")||""," ").concat(r.getAttribute("originalTransform")||""));r.setAttribute("transform","matrix(".concat(a.join(","),")"));const l=await Promise.all(i.map((t=>ma(t).fromElement(t,this.options,this.cssRules).then((t=>(Mr(t),t.fillRule=t.clipRule,delete t.clipRule,t)))))),h=1===l.length?l[0]:new Zn(l),c=At(n,h.calcTransformMatrix());h.clipPath&&await this.resolveClipPath(h,o,r.getAttribute("clip-path")?o:void 0);const{scaleX:u,scaleY:d,angle:g,skewX:p,translateX:f,translateY:m}=Lt(c);h.set({flipX:!1,flipY:!1}),h.set({scaleX:u,scaleY:d,angle:g,skewX:p,skewY:0}),h.setPositionByOrigin(new gt(f,m),L,L),t.clipPath=h}else delete t.clipPath}}const va=t=>fs.test(la(t)),ya=()=>({objects:[],elements:[],options:{},allElements:[]});async function ba(t,e){let{crossOrigin:s,signal:i}=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};if(i&&i.aborted)return f("log",new _("parseSVGDocument")),ya();const n=t.documentElement;!function(t){const e=ca(t,["use","svg:use"]),s=["x","y","xlink:href","href","transform"];for(const i of e){const e=i.attributes,n={};for(const t of e)t.value&&(n[t.name]=t.value);const r=(n["xlink:href"]||n.href||"").slice(1);if(""===r)return;const o=t.getElementById(r);if(null===o)return;let a=o.cloneNode(!0);const l=a.attributes,h={};for(const t of l)t.value&&(h[t.name]=t.value);const{x:c=0,y:u=0,transform:d=""}=n,g="".concat(d," ").concat(h.transform||""," translate(").concat(c,", ").concat(u,")");if(aa(a),/^svg$/i.test(a.nodeName)){const t=a.ownerDocument.createElementNS(cs,"g");Object.entries(h).forEach((e=>{let[s,i]=e;return t.setAttributeNS(cs,s,i)})),t.append(...a.childNodes),a=t}for(const t of e){if(!t)continue;const{name:e,value:i}=t;if(!s.includes(e))if("style"===e){const t={};Mn(i,t),Object.entries(h).forEach((e=>{let[s,i]=e;t[s]=i})),Mn(h.style||"",t);const s=Object.entries(t).map((t=>t.join(":"))).join(";");a.setAttribute(e,s)}else!h[e]&&a.setAttribute(e,i)}a.setAttribute("transform",g),a.setAttribute("instantiated_by_use","1"),a.removeAttribute("id"),i.parentNode.replaceChild(a,i)}}(t);const r=Array.from(n.getElementsByTagName("*")),o=c(c({},aa(n)),{},{crossOrigin:s,signal:i}),a=r.filter((t=>(aa(t),va(t)&&!function(t){let e=t;for(;e&&(e=e.parentElement);)if(e&&e.nodeName&&ha.test(la(e))&&!e.getAttribute("instantiated_by_use"))return!0;return!1}(t))));if(!a||a&&!a.length)return c(c({},ya()),{},{options:o,allElements:r});const l={};r.filter((t=>"clipPath"===la(t))).forEach((t=>{t.setAttribute("originalTransform",t.getAttribute("transform")||"");const e=t.getAttribute("id");l[e]=Array.from(t.getElementsByTagName("*")).filter((t=>va(t)))}));const h=new _a(a,o,e,t,l);return{objects:await h.parse(),elements:a,options:o,allElements:r}}function Ca(t,e){let s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return new Promise(((e,i)=>{Ar(t.replace(/^\n\s*/,"").trim(),{onComplete:t=>{const s=t.responseXML;s&&e(s),i()},signal:s.signal})})).then((t=>ba(t,e,s))).catch((()=>ya()))}const xa=q,wa=t=>function(e,s,i){const{points:n,pathOffset:r}=i;return new gt(n[t]).subtract(r).transform(At(i.getViewportTransform(),i.calcTransformMatrix()))},Sa=(t,e,s,i)=>{const{target:n,pointIndex:r}=e,o=n,a=xe(new gt(s,i),void 0,o.calcOwnMatrix());return o.points[r]=a.add(o.pathOffset),o.setDimensions(),o.set("dirty",!0),!0},Ta=(t,e)=>function(s,i,n,r){const o=i.target,a=new gt(o.points[(t>0?t:o.points.length)-1]),l=a.subtract(o.pathOffset).transform(o.calcOwnMatrix()),h=e(s,c(c({},i),{},{pointIndex:t}),n,r),u=a.subtract(o.pathOffset).transform(o.calcOwnMatrix()).subtract(l);return o.left-=u.x,o.top-=u.y,h},ka=t=>ai(xa,Ta(t,Sa)),Oa=(t,e,s)=>{const{path:i,pathOffset:n}=t,r=i[e];return new gt(r[s]-n.x,r[s+1]-n.y).transform(At(t.getViewportTransform(),t.calcTransformMatrix()))};function Ea(t,e,s){const{commandIndex:i,pointIndex:n}=this;return Oa(s,i,n)}function Da(t,e,s,i){const{target:n}=e,{commandIndex:r,pointIndex:o}=this,a=((t,e,s,i,n)=>{const{path:r,pathOffset:o}=t,a=r[(i>0?i:r.length)-1],l=new gt(a[n],a[n+1]),h=l.subtract(o).transform(t.calcOwnMatrix()),c=xe(new gt(e,s),void 0,t.calcOwnMatrix());r[i][n]=c.x+o.x,r[i][n+1]=c.y+o.y,t.setDimensions();const u=l.subtract(t.pathOffset).transform(t.calcOwnMatrix()).subtract(h);return t.left-=u.x,t.top-=u.y,t.set("dirty",!0),!0})(n,s,i,r,o);return Te(this.actionName,c(c({},Ae(t,e,s,i)),{},{commandIndex:r,pointIndex:o})),a}class Ia extends di{constructor(t){super(t)}render(t,e,s,i,n){const r=c(c({},i),{},{cornerColor:this.controlFill,cornerStrokeColor:this.controlStroke,transparentCorners:!this.controlFill});super.render(t,e,s,r,n)}}class Pa extends Ia{constructor(t){super(t)}render(t,e,s,i,n){const{path:r}=n,{commandIndex:o,pointIndex:a,connectToCommandIndex:l,connectToPointIndex:h}=this;t.save(),t.strokeStyle=this.controlStroke,this.connectionDashArray&&t.setLineDash(this.connectionDashArray);const[c]=r[o],u=Oa(n,l,h);if("Q"===c){const i=Oa(n,o,a+2);t.moveTo(i.x,i.y),t.lineTo(e,s)}else t.moveTo(e,s);t.lineTo(u.x,u.y),t.stroke(),t.restore(),super.render(t,e,s,i,n)}}const Aa=(t,e,s,i,n,r)=>new(s?Pa:Ia)(c(c({commandIndex:t,pointIndex:e,actionName:"modifyPath",positionHandler:Ea,actionHandler:Da,connectToCommandIndex:n,connectToPointIndex:r},i),s?i.controlPointStyle:i.pointStyle));var Ma=Object.freeze({__proto__:null,changeWidth:hi,createObjectDefaultControls:Li,createPathControls:function(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const s={};let i="M";return t.path.forEach(((t,n)=>{const r=t[0];switch("Z"!==r&&(s["c_".concat(n,"_").concat(r)]=Aa(n,t.length-2,!1,e)),r){case"C":s["c_".concat(n,"_C_CP_1")]=Aa(n,1,!0,e,n-1,(t=>"C"===t?5:"Q"===t?3:1)(i)),s["c_".concat(n,"_C_CP_2")]=Aa(n,3,!0,e,n,5);break;case"Q":s["c_".concat(n,"_Q_CP_1")]=Aa(n,1,!0,e,n,3)}i=r})),s},createPolyActionHandler:ka,createPolyControls:function(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const s={};for(let i=0;i<("number"==typeof t?t:t.points.length);i++)s["p".concat(i)]=new di(c({actionName:xa,positionHandler:wa(i),actionHandler:ka(i)},e));return s},createPolyPositionHandler:wa,createResizeControls:Fi,createTextboxDefaultControls:ji,dragHandler:Le,factoryPolyActionHandler:Ta,getLocalPoint:Re,polyActionHandler:Sa,renderCircleControl:ci,renderSquareControl:ui,rotationStyleHandler:gi,rotationWithSnapping:pi,scaleCursorStyleHandler:vi,scaleOrSkewActionName:Pi,scaleSkewCursorStyleHandler:Ai,scalingEqually:bi,scalingX:Ci,scalingXOrSkewingY:Mi,scalingY:xi,scalingYOrSkewingX:Ri,skewCursorStyleHandler:ki,skewHandlerX:Ei,skewHandlerY:Di,wrapWithFireEvent:ai,wrapWithFixedAnchor:li});const Ra=t=>void 0!==t.webgl,La="precision highp float",Fa="\n    ".concat(La,";\n    varying vec2 vTexCoord;\n    uniform sampler2D uTexture;\n    void main() {\n      gl_FragColor = texture2D(uTexture, vTexCoord);\n    }"),ja=["type"],Na=["type"],Ba=new RegExp(La,"g");class Wa{get type(){return this.constructor.type}constructor(){let t=u(arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},ja);Object.assign(this,this.constructor.defaults,t)}getFragmentSource(){return Fa}getVertexSource(){return"\n    attribute vec2 aPosition;\n    varying vec2 vTexCoord;\n    void main() {\n      vTexCoord = aPosition;\n      gl_Position = vec4(aPosition * 2.0 - 1.0, 0.0, 1.0);\n    }"}createProgram(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.getFragmentSource(),s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:this.getVertexSource();const{WebGLProbe:{GLPrecision:i="highp"}}=x();"highp"!==i&&(e=e.replace(Ba,La.replace("highp",i)));const n=t.createShader(t.VERTEX_SHADER),r=t.createShader(t.FRAGMENT_SHADER),o=t.createProgram();if(!n||!r||!o)throw new m("Vertex, fragment shader or program creation error");if(t.shaderSource(n,s),t.compileShader(n),!t.getShaderParameter(n,t.COMPILE_STATUS))throw new m("Vertex shader compile error for ".concat(this.type,": ").concat(t.getShaderInfoLog(n)));if(t.shaderSource(r,e),t.compileShader(r),!t.getShaderParameter(r,t.COMPILE_STATUS))throw new m("Fragment shader compile error for ".concat(this.type,": ").concat(t.getShaderInfoLog(r)));if(t.attachShader(o,n),t.attachShader(o,r),t.linkProgram(o),!t.getProgramParameter(o,t.LINK_STATUS))throw new m('Shader link error for "'.concat(this.type,'" ').concat(t.getProgramInfoLog(o)));const a=this.getUniformLocations(t,o)||{};return a.uStepW=t.getUniformLocation(o,"uStepW"),a.uStepH=t.getUniformLocation(o,"uStepH"),{program:o,attributeLocations:this.getAttributeLocations(t,o),uniformLocations:a}}getAttributeLocations(t,e){return{aPosition:t.getAttribLocation(e,"aPosition")}}getUniformLocations(t,e){const s=this.constructor.uniformLocations,i={};for(let n=0;n<s.length;n++)i[s[n]]=t.getUniformLocation(e,s[n]);return i}sendAttributeData(t,e,s){const i=e.aPosition,n=t.createBuffer();t.bindBuffer(t.ARRAY_BUFFER,n),t.enableVertexAttribArray(i),t.vertexAttribPointer(i,2,t.FLOAT,!1,0,0),t.bufferData(t.ARRAY_BUFFER,s,t.STATIC_DRAW)}_setupFrameBuffer(t){const e=t.context;if(t.passes>1){const s=t.destinationWidth,i=t.destinationHeight;t.sourceWidth===s&&t.sourceHeight===i||(e.deleteTexture(t.targetTexture),t.targetTexture=t.filterBackend.createTexture(e,s,i)),e.framebufferTexture2D(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0,e.TEXTURE_2D,t.targetTexture,0)}else e.bindFramebuffer(e.FRAMEBUFFER,null),e.finish()}_swapTextures(t){t.passes--,t.pass++;const e=t.targetTexture;t.targetTexture=t.sourceTexture,t.sourceTexture=e}isNeutralState(t){return!1}applyTo(t){Ra(t)?(this._setupFrameBuffer(t),this.applyToWebGL(t),this._swapTextures(t)):this.applyTo2d(t)}applyTo2d(t){}getCacheKey(){return this.type}retrieveShader(t){const e=this.getCacheKey();return t.programCache[e]||(t.programCache[e]=this.createProgram(t.context)),t.programCache[e]}applyToWebGL(t){const e=t.context,s=this.retrieveShader(t);0===t.pass&&t.originalTexture?e.bindTexture(e.TEXTURE_2D,t.originalTexture):e.bindTexture(e.TEXTURE_2D,t.sourceTexture),e.useProgram(s.program),this.sendAttributeData(e,s.attributeLocations,t.aPosition),e.uniform1f(s.uniformLocations.uStepW,1/t.sourceWidth),e.uniform1f(s.uniformLocations.uStepH,1/t.sourceHeight),this.sendUniformData(e,s.uniformLocations),e.viewport(0,0,t.destinationWidth,t.destinationHeight),e.drawArrays(e.TRIANGLE_STRIP,0,4)}bindAdditionalTexture(t,e,s){t.activeTexture(s),t.bindTexture(t.TEXTURE_2D,e),t.activeTexture(t.TEXTURE0)}unbindAdditionalTexture(t,e){t.activeTexture(e),t.bindTexture(t.TEXTURE_2D,null),t.activeTexture(t.TEXTURE0)}sendUniformData(t,e){}createHelpLayer(t){if(!t.helpLayer){const{sourceWidth:e,sourceHeight:s}=t,i=St({width:e,height:s});t.helpLayer=i}}toObject(){const t=Object.keys(this.constructor.defaults||{});return c({type:this.type},t.reduce(((t,e)=>(t[e]=this[e],t)),{}))}toJSON(){return this.toObject()}static async fromObject(t,e){return new this(u(t,Na))}}l(Wa,"type","BaseFilter"),l(Wa,"uniformLocations",[]);const Xa={multiply:"gl_FragColor.rgb *= uColor.rgb;\n",screen:"gl_FragColor.rgb = 1.0 - (1.0 - gl_FragColor.rgb) * (1.0 - uColor.rgb);\n",add:"gl_FragColor.rgb += uColor.rgb;\n",difference:"gl_FragColor.rgb = abs(gl_FragColor.rgb - uColor.rgb);\n",subtract:"gl_FragColor.rgb -= uColor.rgb;\n",lighten:"gl_FragColor.rgb = max(gl_FragColor.rgb, uColor.rgb);\n",darken:"gl_FragColor.rgb = min(gl_FragColor.rgb, uColor.rgb);\n",exclusion:"gl_FragColor.rgb += uColor.rgb - 2.0 * (uColor.rgb * gl_FragColor.rgb);\n",overlay:"\n    if (uColor.r < 0.5) {\n      gl_FragColor.r *= 2.0 * uColor.r;\n    } else {\n      gl_FragColor.r = 1.0 - 2.0 * (1.0 - gl_FragColor.r) * (1.0 - uColor.r);\n    }\n    if (uColor.g < 0.5) {\n      gl_FragColor.g *= 2.0 * uColor.g;\n    } else {\n      gl_FragColor.g = 1.0 - 2.0 * (1.0 - gl_FragColor.g) * (1.0 - uColor.g);\n    }\n    if (uColor.b < 0.5) {\n      gl_FragColor.b *= 2.0 * uColor.b;\n    } else {\n      gl_FragColor.b = 1.0 - 2.0 * (1.0 - gl_FragColor.b) * (1.0 - uColor.b);\n    }\n    ",tint:"\n    gl_FragColor.rgb *= (1.0 - uColor.a);\n    gl_FragColor.rgb += uColor.rgb;\n    "};class Ya extends Wa{getCacheKey(){return"".concat(this.type,"_").concat(this.mode)}getFragmentSource(){return"\n      precision highp float;\n      uniform sampler2D uTexture;\n      uniform vec4 uColor;\n      varying vec2 vTexCoord;\n      void main() {\n        vec4 color = texture2D(uTexture, vTexCoord);\n        gl_FragColor = color;\n        if (color.a > 0.0) {\n          ".concat(Xa[this.mode],"\n        }\n      }\n      ")}applyTo2d(t){let{imageData:{data:e}}=t;const s=new Ye(this.color).getSource(),i=this.alpha,n=s[0]*i,r=s[1]*i,o=s[2]*i,a=1-i;for(let l=0;l<e.length;l+=4){const t=e[l],s=e[l+1],i=e[l+2];let h,c,u;switch(this.mode){case"multiply":h=t*n/255,c=s*r/255,u=i*o/255;break;case"screen":h=255-(255-t)*(255-n)/255,c=255-(255-s)*(255-r)/255,u=255-(255-i)*(255-o)/255;break;case"add":h=t+n,c=s+r,u=i+o;break;case"difference":h=Math.abs(t-n),c=Math.abs(s-r),u=Math.abs(i-o);break;case"subtract":h=t-n,c=s-r,u=i-o;break;case"darken":h=Math.min(t,n),c=Math.min(s,r),u=Math.min(i,o);break;case"lighten":h=Math.max(t,n),c=Math.max(s,r),u=Math.max(i,o);break;case"overlay":h=n<128?2*t*n/255:255-2*(255-t)*(255-n)/255,c=r<128?2*s*r/255:255-2*(255-s)*(255-r)/255,u=o<128?2*i*o/255:255-2*(255-i)*(255-o)/255;break;case"exclusion":h=n+t-2*n*t/255,c=r+s-2*r*s/255,u=o+i-2*o*i/255;break;case"tint":h=n+t*a,c=r+s*a,u=o+i*a}e[l]=h,e[l+1]=c,e[l+2]=u}}sendUniformData(t,e){const s=new Ye(this.color).getSource();s[0]=this.alpha*s[0]/255,s[1]=this.alpha*s[1]/255,s[2]=this.alpha*s[2]/255,s[3]=this.alpha,t.uniform4fv(e.uColor,s)}}l(Ya,"defaults",{color:"#F95C63",mode:"multiply",alpha:1}),l(Ya,"type","BlendColor"),l(Ya,"uniformLocations",["uColor"]),at.setClass(Ya);const Va={multiply:"\n    precision highp float;\n    uniform sampler2D uTexture;\n    uniform sampler2D uImage;\n    uniform vec4 uColor;\n    varying vec2 vTexCoord;\n    varying vec2 vTexCoord2;\n    void main() {\n      vec4 color = texture2D(uTexture, vTexCoord);\n      vec4 color2 = texture2D(uImage, vTexCoord2);\n      color.rgba *= color2.rgba;\n      gl_FragColor = color;\n    }\n    ",mask:"\n    precision highp float;\n    uniform sampler2D uTexture;\n    uniform sampler2D uImage;\n    uniform vec4 uColor;\n    varying vec2 vTexCoord;\n    varying vec2 vTexCoord2;\n    void main() {\n      vec4 color = texture2D(uTexture, vTexCoord);\n      vec4 color2 = texture2D(uImage, vTexCoord2);\n      color.a = color2.a;\n      gl_FragColor = color;\n    }\n    "},Ha=["type","image"];class za extends Wa{getCacheKey(){return"".concat(this.type,"_").concat(this.mode)}getFragmentSource(){return Va[this.mode]}getVertexSource(){return"\n    attribute vec2 aPosition;\n    varying vec2 vTexCoord;\n    varying vec2 vTexCoord2;\n    uniform mat3 uTransformMatrix;\n    void main() {\n      vTexCoord = aPosition;\n      vTexCoord2 = (uTransformMatrix * vec3(aPosition, 1.0)).xy;\n      gl_Position = vec4(aPosition * 2.0 - 1.0, 0.0, 1.0);\n    }\n    "}applyToWebGL(t){const e=t.context,s=this.createTexture(t.filterBackend,this.image);this.bindAdditionalTexture(e,s,e.TEXTURE1),super.applyToWebGL(t),this.unbindAdditionalTexture(e,e.TEXTURE1)}createTexture(t,e){return t.getCachedTexture(e.cacheKey,e.getElement())}calculateMatrix(){const t=this.image,{width:e,height:s}=t.getElement();return[1/t.scaleX,0,0,0,1/t.scaleY,0,-t.left/e,-t.top/s,1]}applyTo2d(t){let{imageData:{data:e,width:s,height:i},filterBackend:{resources:n}}=t;const r=this.image;n.blendImage||(n.blendImage=xt());const o=n.blendImage,a=o.getContext("2d");o.width!==s||o.height!==i?(o.width=s,o.height=i):a.clearRect(0,0,s,i),a.setTransform(r.scaleX,0,0,r.scaleY,r.left,r.top),a.drawImage(r.getElement(),0,0,s,i);const l=a.getImageData(0,0,s,i).data;for(let h=0;h<e.length;h+=4){const t=e[h],s=e[h+1],i=e[h+2],n=e[h+3],r=l[h],o=l[h+1],a=l[h+2],c=l[h+3];switch(this.mode){case"multiply":e[h]=t*r/255,e[h+1]=s*o/255,e[h+2]=i*a/255,e[h+3]=n*c/255;break;case"mask":e[h+3]=c}}}sendUniformData(t,e){const s=this.calculateMatrix();t.uniform1i(e.uImage,1),t.uniformMatrix3fv(e.uTransformMatrix,!1,s)}toObject(){return c(c({},super.toObject()),{},{image:this.image&&this.image.toObject()})}static async fromObject(t,e){let{type:s,image:i}=t,n=u(t,Ha);return oa.fromObject(i,e).then((t=>new this(c(c({},n),{},{image:t}))))}}l(za,"type","BlendImage"),l(za,"defaults",{mode:"multiply",alpha:1}),l(za,"uniformLocations",["uTransformMatrix","uImage"]),at.setClass(za);class Ga extends Wa{getFragmentSource(){return"\n    precision highp float;\n    uniform sampler2D uTexture;\n    uniform vec2 uDelta;\n    varying vec2 vTexCoord;\n    const float nSamples = 15.0;\n    vec3 v3offset = vec3(12.9898, 78.233, 151.7182);\n    float random(vec3 scale) {\n      /* use the fragment position for a different seed per-pixel */\n      return fract(sin(dot(gl_FragCoord.xyz, scale)) * 43758.5453);\n    }\n    void main() {\n      vec4 color = vec4(0.0);\n      float totalC = 0.0;\n      float totalA = 0.0;\n      float offset = random(v3offset);\n      for (float t = -nSamples; t <= nSamples; t++) {\n        float percent = (t + offset - 0.5) / nSamples;\n        vec4 sample = texture2D(uTexture, vTexCoord + uDelta * percent);\n        float weight = 1.0 - abs(percent);\n        float alpha = weight * sample.a;\n        color.rgb += sample.rgb * alpha;\n        color.a += alpha;\n        totalA += weight;\n        totalC += alpha;\n      }\n      gl_FragColor.rgb = color.rgb / totalC;\n      gl_FragColor.a = color.a / totalA;\n    }\n  "}applyTo(t){Ra(t)?(this.aspectRatio=t.sourceWidth/t.sourceHeight,t.passes++,this._setupFrameBuffer(t),this.horizontal=!0,this.applyToWebGL(t),this._swapTextures(t),this._setupFrameBuffer(t),this.horizontal=!1,this.applyToWebGL(t),this._swapTextures(t)):this.applyTo2d(t)}applyTo2d(t){let{imageData:{data:e,width:s,height:i}}=t;this.aspectRatio=s/i,this.horizontal=!0;let n=this.getBlurValue()*s;const r=new Uint8ClampedArray(e),o=15,a=4*s;for(let l=0;l<e.length;l+=4){let t=0,s=0,i=0,h=0,c=0;const u=l-l%a,d=u+a;for(let r=-14;r<o;r++){const a=r/o,g=4*Math.floor(n*a),p=1-Math.abs(a);let f=l+g;f<u?f=u:f>d&&(f=d);const m=e[f+3]*p;t+=e[f]*m,s+=e[f+1]*m,i+=e[f+2]*m,h+=m,c+=p}r[l]=t/h,r[l+1]=s/h,r[l+2]=i/h,r[l+3]=h/c}this.horizontal=!1,n=this.getBlurValue()*i;for(let l=0;l<r.length;l+=4){let t=0,s=0,i=0,h=0,c=0;const u=l%a,d=r.length-a+u;for(let e=-14;e<o;e++){const g=e/o,p=Math.floor(n*g)*a,f=1-Math.abs(g);let m=l+p;m<u?m=u:m>d&&(m=d);const _=r[m+3]*f;t+=r[m]*_,s+=r[m+1]*_,i+=r[m+2]*_,h+=_,c+=f}e[l]=t/h,e[l+1]=s/h,e[l+2]=i/h,e[l+3]=h/c}}sendUniformData(t,e){const s=this.chooseRightDelta();t.uniform2fv(e.uDelta,s)}isNeutralState(){return 0===this.blur}getBlurValue(){let t=1;const{horizontal:e,aspectRatio:s}=this;return e?s>1&&(t=1/s):s<1&&(t=s),t*this.blur*.12}chooseRightDelta(){const t=this.getBlurValue();return this.horizontal?[t,0]:[0,t]}}l(Ga,"type","Blur"),l(Ga,"defaults",{blur:0}),l(Ga,"uniformLocations",["uDelta"]),at.setClass(Ga);class Ua extends Wa{getFragmentSource(){return"\n  precision highp float;\n  uniform sampler2D uTexture;\n  uniform float uBrightness;\n  varying vec2 vTexCoord;\n  void main() {\n    vec4 color = texture2D(uTexture, vTexCoord);\n    color.rgb += uBrightness;\n    gl_FragColor = color;\n  }\n"}applyTo2d(t){let{imageData:{data:e}}=t;const s=Math.round(255*this.brightness);for(let i=0;i<e.length;i+=4)e[i]+=s,e[i+1]+=s,e[i+2]+=s}isNeutralState(){return 0===this.brightness}sendUniformData(t,e){t.uniform1f(e.uBrightness,this.brightness)}}l(Ua,"type","Brightness"),l(Ua,"defaults",{brightness:0}),l(Ua,"uniformLocations",["uBrightness"]),at.setClass(Ua);const qa={matrix:[1,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,1,0],colorsOnly:!0};class Ka extends Wa{getFragmentSource(){return"\n  precision highp float;\n  uniform sampler2D uTexture;\n  varying vec2 vTexCoord;\n  uniform mat4 uColorMatrix;\n  uniform vec4 uConstants;\n  void main() {\n    vec4 color = texture2D(uTexture, vTexCoord);\n    color *= uColorMatrix;\n    color += uConstants;\n    gl_FragColor = color;\n  }"}applyTo2d(t){const e=t.imageData.data,s=this.matrix,i=this.colorsOnly;for(let n=0;n<e.length;n+=4){const t=e[n],r=e[n+1],o=e[n+2];if(e[n]=t*s[0]+r*s[1]+o*s[2]+255*s[4],e[n+1]=t*s[5]+r*s[6]+o*s[7]+255*s[9],e[n+2]=t*s[10]+r*s[11]+o*s[12]+255*s[14],!i){const i=e[n+3];e[n]+=i*s[3],e[n+1]+=i*s[8],e[n+2]+=i*s[13],e[n+3]=t*s[15]+r*s[16]+o*s[17]+i*s[18]+255*s[19]}}}sendUniformData(t,e){const s=this.matrix,i=[s[0],s[1],s[2],s[3],s[5],s[6],s[7],s[8],s[10],s[11],s[12],s[13],s[15],s[16],s[17],s[18]],n=[s[4],s[9],s[14],s[19]];t.uniformMatrix4fv(e.uColorMatrix,!1,i),t.uniform4fv(e.uConstants,n)}toObject(){return c(c({},super.toObject()),{},{matrix:[...this.matrix]})}}function $a(t,e){var s;const i=(l(s=class extends Ka{toObject(){return{type:this.type,colorsOnly:this.colorsOnly}}},"type",t),l(s,"defaults",{colorsOnly:!1,matrix:e}),s);return at.setClass(i,t),i}l(Ka,"type","ColorMatrix"),l(Ka,"defaults",qa),l(Ka,"uniformLocations",["uColorMatrix","uConstants"]),at.setClass(Ka);const Qa=$a("Brownie",[.5997,.34553,-.27082,0,.186,-.0377,.86095,.15059,0,-.1449,.24113,-.07441,.44972,0,-.02965,0,0,0,1,0]),Ja=$a("Vintage",[.62793,.32021,-.03965,0,.03784,.02578,.64411,.03259,0,.02926,.0466,-.08512,.52416,0,.02023,0,0,0,1,0]),Za=$a("Kodachrome",[1.12855,-.39673,-.03992,0,.24991,-.16404,1.08352,-.05498,0,.09698,-.16786,-.56034,1.60148,0,.13972,0,0,0,1,0]),tl=$a("Technicolor",[1.91252,-.85453,-.09155,0,.04624,-.30878,1.76589,-.10601,0,-.27589,-.2311,-.75018,1.84759,0,.12137,0,0,0,1,0]),el=$a("Polaroid",[1.438,-.062,-.062,0,0,-.122,1.378,-.122,0,0,-.016,-.016,1.483,0,0,0,0,0,1,0]),sl=$a("Sepia",[.393,.769,.189,0,0,.349,.686,.168,0,0,.272,.534,.131,0,0,0,0,0,1,0]),il=$a("BlackWhite",[1.5,1.5,1.5,0,-1,1.5,1.5,1.5,0,-1,1.5,1.5,1.5,0,-1,0,0,0,1,0]);class nl extends Wa{constructor(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};super(t),this.subFilters=t.subFilters||[]}applyTo(t){Ra(t)&&(t.passes+=this.subFilters.length-1),this.subFilters.forEach((e=>{e.applyTo(t)}))}toObject(){return{type:this.type,subFilters:this.subFilters.map((t=>t.toObject()))}}isNeutralState(){return!this.subFilters.some((t=>!t.isNeutralState()))}static fromObject(t,e){return Promise.all((t.subFilters||[]).map((t=>at.getClass(t.type).fromObject(t,e)))).then((t=>new this({subFilters:t})))}}l(nl,"type","Composed"),at.setClass(nl);class rl extends Wa{getFragmentSource(){return"\n  precision highp float;\n  uniform sampler2D uTexture;\n  uniform float uContrast;\n  varying vec2 vTexCoord;\n  void main() {\n    vec4 color = texture2D(uTexture, vTexCoord);\n    float contrastF = 1.015 * (uContrast + 1.0) / (1.0 * (1.015 - uContrast));\n    color.rgb = contrastF * (color.rgb - 0.5) + 0.5;\n    gl_FragColor = color;\n  }"}isNeutralState(){return 0===this.contrast}applyTo2d(t){let{imageData:{data:e}}=t;const s=Math.floor(255*this.contrast),i=259*(s+255)/(255*(259-s));for(let n=0;n<e.length;n+=4)e[n]=i*(e[n]-128)+128,e[n+1]=i*(e[n+1]-128)+128,e[n+2]=i*(e[n+2]-128)+128}sendUniformData(t,e){t.uniform1f(e.uContrast,this.contrast)}}l(rl,"type","Contrast"),l(rl,"defaults",{contrast:0}),l(rl,"uniformLocations",["uContrast"]),at.setClass(rl);const ol={Convolute_3_1:"\n    precision highp float;\n    uniform sampler2D uTexture;\n    uniform float uMatrix[9];\n    uniform float uStepW;\n    uniform float uStepH;\n    varying vec2 vTexCoord;\n    void main() {\n      vec4 color = vec4(0, 0, 0, 0);\n      for (float h = 0.0; h < 3.0; h+=1.0) {\n        for (float w = 0.0; w < 3.0; w+=1.0) {\n          vec2 matrixPos = vec2(uStepW * (w - 1), uStepH * (h - 1));\n          color += texture2D(uTexture, vTexCoord + matrixPos) * uMatrix[int(h * 3.0 + w)];\n        }\n      }\n      gl_FragColor = color;\n    }\n    ",Convolute_3_0:"\n    precision highp float;\n    uniform sampler2D uTexture;\n    uniform float uMatrix[9];\n    uniform float uStepW;\n    uniform float uStepH;\n    varying vec2 vTexCoord;\n    void main() {\n      vec4 color = vec4(0, 0, 0, 1);\n      for (float h = 0.0; h < 3.0; h+=1.0) {\n        for (float w = 0.0; w < 3.0; w+=1.0) {\n          vec2 matrixPos = vec2(uStepW * (w - 1.0), uStepH * (h - 1.0));\n          color.rgb += texture2D(uTexture, vTexCoord + matrixPos).rgb * uMatrix[int(h * 3.0 + w)];\n        }\n      }\n      float alpha = texture2D(uTexture, vTexCoord).a;\n      gl_FragColor = color;\n      gl_FragColor.a = alpha;\n    }\n    ",Convolute_5_1:"\n    precision highp float;\n    uniform sampler2D uTexture;\n    uniform float uMatrix[25];\n    uniform float uStepW;\n    uniform float uStepH;\n    varying vec2 vTexCoord;\n    void main() {\n      vec4 color = vec4(0, 0, 0, 0);\n      for (float h = 0.0; h < 5.0; h+=1.0) {\n        for (float w = 0.0; w < 5.0; w+=1.0) {\n          vec2 matrixPos = vec2(uStepW * (w - 2.0), uStepH * (h - 2.0));\n          color += texture2D(uTexture, vTexCoord + matrixPos) * uMatrix[int(h * 5.0 + w)];\n        }\n      }\n      gl_FragColor = color;\n    }\n    ",Convolute_5_0:"\n    precision highp float;\n    uniform sampler2D uTexture;\n    uniform float uMatrix[25];\n    uniform float uStepW;\n    uniform float uStepH;\n    varying vec2 vTexCoord;\n    void main() {\n      vec4 color = vec4(0, 0, 0, 1);\n      for (float h = 0.0; h < 5.0; h+=1.0) {\n        for (float w = 0.0; w < 5.0; w+=1.0) {\n          vec2 matrixPos = vec2(uStepW * (w - 2.0), uStepH * (h - 2.0));\n          color.rgb += texture2D(uTexture, vTexCoord + matrixPos).rgb * uMatrix[int(h * 5.0 + w)];\n        }\n      }\n      float alpha = texture2D(uTexture, vTexCoord).a;\n      gl_FragColor = color;\n      gl_FragColor.a = alpha;\n    }\n    ",Convolute_7_1:"\n    precision highp float;\n    uniform sampler2D uTexture;\n    uniform float uMatrix[49];\n    uniform float uStepW;\n    uniform float uStepH;\n    varying vec2 vTexCoord;\n    void main() {\n      vec4 color = vec4(0, 0, 0, 0);\n      for (float h = 0.0; h < 7.0; h+=1.0) {\n        for (float w = 0.0; w < 7.0; w+=1.0) {\n          vec2 matrixPos = vec2(uStepW * (w - 3.0), uStepH * (h - 3.0));\n          color += texture2D(uTexture, vTexCoord + matrixPos) * uMatrix[int(h * 7.0 + w)];\n        }\n      }\n      gl_FragColor = color;\n    }\n    ",Convolute_7_0:"\n    precision highp float;\n    uniform sampler2D uTexture;\n    uniform float uMatrix[49];\n    uniform float uStepW;\n    uniform float uStepH;\n    varying vec2 vTexCoord;\n    void main() {\n      vec4 color = vec4(0, 0, 0, 1);\n      for (float h = 0.0; h < 7.0; h+=1.0) {\n        for (float w = 0.0; w < 7.0; w+=1.0) {\n          vec2 matrixPos = vec2(uStepW * (w - 3.0), uStepH * (h - 3.0));\n          color.rgb += texture2D(uTexture, vTexCoord + matrixPos).rgb * uMatrix[int(h * 7.0 + w)];\n        }\n      }\n      float alpha = texture2D(uTexture, vTexCoord).a;\n      gl_FragColor = color;\n      gl_FragColor.a = alpha;\n    }\n    ",Convolute_9_1:"\n    precision highp float;\n    uniform sampler2D uTexture;\n    uniform float uMatrix[81];\n    uniform float uStepW;\n    uniform float uStepH;\n    varying vec2 vTexCoord;\n    void main() {\n      vec4 color = vec4(0, 0, 0, 0);\n      for (float h = 0.0; h < 9.0; h+=1.0) {\n        for (float w = 0.0; w < 9.0; w+=1.0) {\n          vec2 matrixPos = vec2(uStepW * (w - 4.0), uStepH * (h - 4.0));\n          color += texture2D(uTexture, vTexCoord + matrixPos) * uMatrix[int(h * 9.0 + w)];\n        }\n      }\n      gl_FragColor = color;\n    }\n    ",Convolute_9_0:"\n    precision highp float;\n    uniform sampler2D uTexture;\n    uniform float uMatrix[81];\n    uniform float uStepW;\n    uniform float uStepH;\n    varying vec2 vTexCoord;\n    void main() {\n      vec4 color = vec4(0, 0, 0, 1);\n      for (float h = 0.0; h < 9.0; h+=1.0) {\n        for (float w = 0.0; w < 9.0; w+=1.0) {\n          vec2 matrixPos = vec2(uStepW * (w - 4.0), uStepH * (h - 4.0));\n          color.rgb += texture2D(uTexture, vTexCoord + matrixPos).rgb * uMatrix[int(h * 9.0 + w)];\n        }\n      }\n      float alpha = texture2D(uTexture, vTexCoord).a;\n      gl_FragColor = color;\n      gl_FragColor.a = alpha;\n    }\n    "};class al extends Wa{getCacheKey(){return"".concat(this.type,"_").concat(Math.sqrt(this.matrix.length),"_").concat(this.opaque?1:0)}getFragmentSource(){return ol[this.getCacheKey()]}applyTo2d(t){const e=t.imageData,s=e.data,i=this.matrix,n=Math.round(Math.sqrt(i.length)),r=Math.floor(n/2),o=e.width,a=e.height,l=t.ctx.createImageData(o,a),h=l.data,c=this.opaque?1:0;let u,d,g,p,f,m,_,v,y,b,C,x,w;for(C=0;C<a;C++)for(b=0;b<o;b++){for(f=4*(C*o+b),u=0,d=0,g=0,p=0,w=0;w<n;w++)for(x=0;x<n;x++)_=C+w-r,m=b+x-r,_<0||_>=a||m<0||m>=o||(v=4*(_*o+m),y=i[w*n+x],u+=s[v]*y,d+=s[v+1]*y,g+=s[v+2]*y,c||(p+=s[v+3]*y));h[f]=u,h[f+1]=d,h[f+2]=g,h[f+3]=c?s[f+3]:p}t.imageData=l}sendUniformData(t,e){t.uniform1fv(e.uMatrix,this.matrix)}toObject(){return c(c({},super.toObject()),{},{opaque:this.opaque,matrix:[...this.matrix]})}}l(al,"type","Convolute"),l(al,"defaults",{opaque:!1,matrix:[0,0,0,0,1,0,0,0,0]}),l(al,"uniformLocations",["uMatrix","uOpaque","uHalfSize","uSize"]),at.setClass(al);const ll="Gamma";class hl extends Wa{getFragmentSource(){return"\n  precision highp float;\n  uniform sampler2D uTexture;\n  uniform vec3 uGamma;\n  varying vec2 vTexCoord;\n  void main() {\n    vec4 color = texture2D(uTexture, vTexCoord);\n    vec3 correction = (1.0 / uGamma);\n    color.r = pow(color.r, correction.r);\n    color.g = pow(color.g, correction.g);\n    color.b = pow(color.b, correction.b);\n    gl_FragColor = color;\n    gl_FragColor.rgb *= color.a;\n  }\n"}constructor(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};super(t),this.gamma=t.gamma||this.constructor.defaults.gamma.concat()}applyTo2d(t){let{imageData:{data:e}}=t;const s=this.gamma,i=1/s[0],n=1/s[1],r=1/s[2];this.rgbValues||(this.rgbValues={r:new Uint8Array(256),g:new Uint8Array(256),b:new Uint8Array(256)});const o=this.rgbValues;for(let a=0;a<256;a++)o.r[a]=255*Math.pow(a/255,i),o.g[a]=255*Math.pow(a/255,n),o.b[a]=255*Math.pow(a/255,r);for(let a=0;a<e.length;a+=4)e[a]=o.r[e[a]],e[a+1]=o.g[e[a+1]],e[a+2]=o.b[e[a+2]]}sendUniformData(t,e){t.uniform3fv(e.uGamma,this.gamma)}isNeutralState(){const{gamma:t}=this;return 1===t[0]&&1===t[1]&&1===t[2]}toObject(){return{type:ll,gamma:this.gamma.concat()}}}l(hl,"type",ll),l(hl,"defaults",{gamma:[1,1,1]}),l(hl,"uniformLocations",["uGamma"]),at.setClass(hl);const cl={average:"\n    precision highp float;\n    uniform sampler2D uTexture;\n    varying vec2 vTexCoord;\n    void main() {\n      vec4 color = texture2D(uTexture, vTexCoord);\n      float average = (color.r + color.b + color.g) / 3.0;\n      gl_FragColor = vec4(average, average, average, color.a);\n    }\n    ",lightness:"\n    precision highp float;\n    uniform sampler2D uTexture;\n    uniform int uMode;\n    varying vec2 vTexCoord;\n    void main() {\n      vec4 col = texture2D(uTexture, vTexCoord);\n      float average = (max(max(col.r, col.g),col.b) + min(min(col.r, col.g),col.b)) / 2.0;\n      gl_FragColor = vec4(average, average, average, col.a);\n    }\n    ",luminosity:"\n    precision highp float;\n    uniform sampler2D uTexture;\n    uniform int uMode;\n    varying vec2 vTexCoord;\n    void main() {\n      vec4 col = texture2D(uTexture, vTexCoord);\n      float average = 0.21 * col.r + 0.72 * col.g + 0.07 * col.b;\n      gl_FragColor = vec4(average, average, average, col.a);\n    }\n    "};class ul extends Wa{applyTo2d(t){let{imageData:{data:e}}=t;for(let s,i=0;i<e.length;i+=4){const t=e[i],n=e[i+1],r=e[i+2];switch(this.mode){case"average":s=(t+n+r)/3;break;case"lightness":s=(Math.min(t,n,r)+Math.max(t,n,r))/2;break;case"luminosity":s=.21*t+.72*n+.07*r}e[i+2]=e[i+1]=e[i]=s}}getCacheKey(){return"".concat(this.type,"_").concat(this.mode)}getFragmentSource(){return cl[this.mode]}sendUniformData(t,e){t.uniform1i(e.uMode,1)}isNeutralState(){return!1}}l(ul,"type","Grayscale"),l(ul,"defaults",{mode:"average"}),l(ul,"uniformLocations",["uMode"]),at.setClass(ul);const dl=c(c({},qa),{},{rotation:0});class gl extends Ka{calculateMatrix(){const t=this.rotation*Math.PI,e=ut(t),s=dt(t),i=1/3,n=Math.sqrt(i)*s,r=1-e;this.matrix=[e+r/3,i*r-n,i*r+n,0,0,i*r+n,e+i*r,i*r-n,0,0,i*r-n,i*r+n,e+i*r,0,0,0,0,0,1,0]}isNeutralState(){return 0===this.rotation}applyTo(t){this.calculateMatrix(),super.applyTo(t)}toObject(){return{type:this.type,rotation:this.rotation}}}l(gl,"type","HueRotation"),l(gl,"defaults",dl),at.setClass(gl);class pl extends Wa{applyTo2d(t){let{imageData:{data:e}}=t;for(let s=0;s<e.length;s+=4)e[s]=255-e[s],e[s+1]=255-e[s+1],e[s+2]=255-e[s+2],this.alpha&&(e[s+3]=255-e[s+3])}getFragmentSource(){return"\n  precision highp float;\n  uniform sampler2D uTexture;\n  uniform int uInvert;\n  uniform int uAlpha;\n  varying vec2 vTexCoord;\n  void main() {\n    vec4 color = texture2D(uTexture, vTexCoord);\n    if (uInvert == 1) {\n      if (uAlpha == 1) {\n        gl_FragColor = vec4(1.0 - color.r,1.0 -color.g,1.0 -color.b,1.0 -color.a);\n      } else {\n        gl_FragColor = vec4(1.0 - color.r,1.0 -color.g,1.0 -color.b,color.a);\n      }\n    } else {\n      gl_FragColor = color;\n    }\n  }\n"}isNeutralState(){return!this.invert}sendUniformData(t,e){t.uniform1i(e.uInvert,Number(this.invert)),t.uniform1i(e.uAlpha,Number(this.alpha))}}l(pl,"type","Invert"),l(pl,"defaults",{alpha:!1,invert:!0}),l(pl,"uniformLocations",["uInvert","uAlpha"]),at.setClass(pl);class fl extends Wa{getFragmentSource(){return"\n  precision highp float;\n  uniform sampler2D uTexture;\n  uniform float uStepH;\n  uniform float uNoise;\n  uniform float uSeed;\n  varying vec2 vTexCoord;\n  float rand(vec2 co, float seed, float vScale) {\n    return fract(sin(dot(co.xy * vScale ,vec2(12.9898 , 78.233))) * 43758.5453 * (seed + 0.01) / 2.0);\n  }\n  void main() {\n    vec4 color = texture2D(uTexture, vTexCoord);\n    color.rgb += (0.5 - rand(vTexCoord, uSeed, 0.1 / uStepH)) * uNoise;\n    gl_FragColor = color;\n  }\n"}applyTo2d(t){let{imageData:{data:e}}=t;const s=this.noise;for(let i=0;i<e.length;i+=4){const t=(.5-Math.random())*s;e[i]+=t,e[i+1]+=t,e[i+2]+=t}}sendUniformData(t,e){t.uniform1f(e.uNoise,this.noise/255),t.uniform1f(e.uSeed,Math.random())}isNeutralState(){return 0===this.noise}}l(fl,"type","Noise"),l(fl,"defaults",{noise:0}),l(fl,"uniformLocations",["uNoise","uSeed"]),at.setClass(fl);class ml extends Wa{applyTo2d(t){let{imageData:{data:e,width:s,height:i}}=t;for(let n=0;n<i;n+=this.blocksize)for(let t=0;t<s;t+=this.blocksize){const r=4*n*s+4*t,o=e[r],a=e[r+1],l=e[r+2],h=e[r+3];for(let c=n;c<Math.min(n+this.blocksize,i);c++)for(let i=t;i<Math.min(t+this.blocksize,s);i++){const t=4*c*s+4*i;e[t]=o,e[t+1]=a,e[t+2]=l,e[t+3]=h}}}isNeutralState(){return 1===this.blocksize}getFragmentSource(){return"\n  precision highp float;\n  uniform sampler2D uTexture;\n  uniform float uBlocksize;\n  uniform float uStepW;\n  uniform float uStepH;\n  varying vec2 vTexCoord;\n  void main() {\n    float blockW = uBlocksize * uStepW;\n    float blockH = uBlocksize * uStepH;\n    int posX = int(vTexCoord.x / blockW);\n    int posY = int(vTexCoord.y / blockH);\n    float fposX = float(posX);\n    float fposY = float(posY);\n    vec2 squareCoords = vec2(fposX * blockW, fposY * blockH);\n    vec4 color = texture2D(uTexture, squareCoords);\n    gl_FragColor = color;\n  }\n"}sendUniformData(t,e){t.uniform1f(e.uBlocksize,this.blocksize)}}l(ml,"type","Pixelate"),l(ml,"defaults",{blocksize:4}),l(ml,"uniformLocations",["uBlocksize"]),at.setClass(ml);class _l extends Wa{getFragmentSource(){return"\nprecision highp float;\nuniform sampler2D uTexture;\nuniform vec4 uLow;\nuniform vec4 uHigh;\nvarying vec2 vTexCoord;\nvoid main() {\n  gl_FragColor = texture2D(uTexture, vTexCoord);\n  if(all(greaterThan(gl_FragColor.rgb,uLow.rgb)) && all(greaterThan(uHigh.rgb,gl_FragColor.rgb))) {\n    gl_FragColor.a = 0.0;\n  }\n}\n"}applyTo2d(t){let{imageData:{data:e}}=t;const s=255*this.distance,i=new Ye(this.color).getSource(),n=[i[0]-s,i[1]-s,i[2]-s],r=[i[0]+s,i[1]+s,i[2]+s];for(let o=0;o<e.length;o+=4){const t=e[o],s=e[o+1],i=e[o+2];t>n[0]&&s>n[1]&&i>n[2]&&t<r[0]&&s<r[1]&&i<r[2]&&(e[o+3]=0)}}sendUniformData(t,e){const s=new Ye(this.color).getSource(),i=this.distance,n=[0+s[0]/255-i,0+s[1]/255-i,0+s[2]/255-i,1],r=[s[0]/255+i,s[1]/255+i,s[2]/255+i,1];t.uniform4fv(e.uLow,n),t.uniform4fv(e.uHigh,r)}}l(_l,"type","RemoveColor"),l(_l,"defaults",{color:"#FFFFFF",distance:.02,useAlpha:!1}),l(_l,"uniformLocations",["uLow","uHigh"]),at.setClass(_l);class vl extends Wa{sendUniformData(t,e){t.uniform2fv(e.uDelta,this.horizontal?[1/this.width,0]:[0,1/this.height]),t.uniform1fv(e.uTaps,this.taps)}getFilterWindow(){const t=this.tempScale;return Math.ceil(this.lanczosLobes/t)}getCacheKey(){const t=this.getFilterWindow();return"".concat(this.type,"_").concat(t)}getFragmentSource(){const t=this.getFilterWindow();return this.generateShader(t)}getTaps(){const t=this.lanczosCreate(this.lanczosLobes),e=this.tempScale,s=this.getFilterWindow(),i=new Array(s);for(let n=1;n<=s;n++)i[n-1]=t(n*e);return i}generateShader(t){const e=new Array(t);for(let s=1;s<=t;s++)e[s-1]="".concat(s,".0 * uDelta");return"\n      precision highp float;\n      uniform sampler2D uTexture;\n      uniform vec2 uDelta;\n      varying vec2 vTexCoord;\n      uniform float uTaps[".concat(t,"];\n      void main() {\n        vec4 color = texture2D(uTexture, vTexCoord);\n        float sum = 1.0;\n        ").concat(e.map(((t,e)=>"\n              color += texture2D(uTexture, vTexCoord + ".concat(t,") * uTaps[").concat(e,"] + texture2D(uTexture, vTexCoord - ").concat(t,") * uTaps[").concat(e,"];\n              sum += 2.0 * uTaps[").concat(e,"];\n            "))).join("\n"),"\n        gl_FragColor = color / sum;\n      }\n    ")}applyToForWebgl(t){t.passes++,this.width=t.sourceWidth,this.horizontal=!0,this.dW=Math.round(this.width*this.scaleX),this.dH=t.sourceHeight,this.tempScale=this.dW/this.width,this.taps=this.getTaps(),t.destinationWidth=this.dW,super.applyTo(t),t.sourceWidth=t.destinationWidth,this.height=t.sourceHeight,this.horizontal=!1,this.dH=Math.round(this.height*this.scaleY),this.tempScale=this.dH/this.height,this.taps=this.getTaps(),t.destinationHeight=this.dH,super.applyTo(t),t.sourceHeight=t.destinationHeight}applyTo(t){Ra(t)?this.applyToForWebgl(t):this.applyTo2d(t)}isNeutralState(){return 1===this.scaleX&&1===this.scaleY}lanczosCreate(t){return e=>{if(e>=t||e<=-t)return 0;if(e<1.1920929e-7&&e>-1.1920929e-7)return 1;const s=(e*=Math.PI)/t;return Math.sin(e)/e*Math.sin(s)/s}}applyTo2d(t){const e=t.imageData,s=this.scaleX,i=this.scaleY;this.rcpScaleX=1/s,this.rcpScaleY=1/i;const n=e.width,r=e.height,o=Math.round(n*s),a=Math.round(r*i);let l;l="sliceHack"===this.resizeType?this.sliceByTwo(t,n,r,o,a):"hermite"===this.resizeType?this.hermiteFastResize(t,n,r,o,a):"bilinear"===this.resizeType?this.bilinearFiltering(t,n,r,o,a):"lanczos"===this.resizeType?this.lanczosResize(t,n,r,o,a):new ImageData(o,a),t.imageData=l}sliceByTwo(t,e,s,i,n){const r=t.imageData,o=.5;let a=!1,l=!1,h=e*o,c=s*o;const u=t.filterBackend.resources;let d=0,g=0;const p=e;let f=0;u.sliceByTwo||(u.sliceByTwo=xt());const m=u.sliceByTwo;(m.width<1.5*e||m.height<s)&&(m.width=1.5*e,m.height=s);const _=m.getContext("2d");for(_.clearRect(0,0,1.5*e,s),_.putImageData(r,0,0),i=Math.floor(i),n=Math.floor(n);!a||!l;)e=h,s=c,i<Math.floor(h*o)?h=Math.floor(h*o):(h=i,a=!0),n<Math.floor(c*o)?c=Math.floor(c*o):(c=n,l=!0),_.drawImage(m,d,g,e,s,p,f,h,c),d=p,g=f,f+=c;return _.getImageData(d,g,i,n)}lanczosResize(t,e,s,i,n){const r=t.imageData.data,o=t.ctx.createImageData(i,n),a=o.data,l=this.lanczosCreate(this.lanczosLobes),h=this.rcpScaleX,c=this.rcpScaleY,u=2/this.rcpScaleX,d=2/this.rcpScaleY,g=Math.ceil(h*this.lanczosLobes/2),p=Math.ceil(c*this.lanczosLobes/2),f={},m={x:0,y:0},_={x:0,y:0};return function t(v){let y,b,C,x,w,S,T,k,O,E,D;for(m.x=(v+.5)*h,_.x=Math.floor(m.x),y=0;y<n;y++){for(m.y=(y+.5)*c,_.y=Math.floor(m.y),w=0,S=0,T=0,k=0,O=0,b=_.x-g;b<=_.x+g;b++)if(!(b<0||b>=e)){E=Math.floor(1e3*Math.abs(b-m.x)),f[E]||(f[E]={});for(let t=_.y-p;t<=_.y+p;t++)t<0||t>=s||(D=Math.floor(1e3*Math.abs(t-m.y)),f[E][D]||(f[E][D]=l(Math.sqrt(Math.pow(E*u,2)+Math.pow(D*d,2))/1e3)),C=f[E][D],C>0&&(x=4*(t*e+b),w+=C,S+=C*r[x],T+=C*r[x+1],k+=C*r[x+2],O+=C*r[x+3]))}x=4*(y*i+v),a[x]=S/w,a[x+1]=T/w,a[x+2]=k/w,a[x+3]=O/w}return++v<i?t(v):o}(0)}bilinearFiltering(t,e,s,i,n){let r,o,a,l,h,c,u,d,g,p,f,m,_,v=0;const y=this.rcpScaleX,b=this.rcpScaleY,C=4*(e-1),x=t.imageData.data,w=t.ctx.createImageData(i,n),S=w.data;for(u=0;u<n;u++)for(d=0;d<i;d++)for(h=Math.floor(y*d),c=Math.floor(b*u),g=y*d-h,p=b*u-c,_=4*(c*e+h),f=0;f<4;f++)r=x[_+f],o=x[_+4+f],a=x[_+C+f],l=x[_+C+4+f],m=r*(1-g)*(1-p)+o*g*(1-p)+a*p*(1-g)+l*g*p,S[v++]=m;return w}hermiteFastResize(t,e,s,i,n){const r=this.rcpScaleX,o=this.rcpScaleY,a=Math.ceil(r/2),l=Math.ceil(o/2),h=t.imageData.data,c=t.ctx.createImageData(i,n),u=c.data;for(let d=0;d<n;d++)for(let t=0;t<i;t++){const s=4*(t+d*i);let n=0,c=0,g=0,p=0,f=0,m=0,_=0;const v=(d+.5)*o;for(let i=Math.floor(d*o);i<(d+1)*o;i++){const s=Math.abs(v-(i+.5))/l,o=(t+.5)*r,u=s*s;for(let l=Math.floor(t*r);l<(t+1)*r;l++){let t=Math.abs(o-(l+.5))/a;const s=Math.sqrt(u+t*t);s>1&&s<-1||(n=2*s*s*s-3*s*s+1,n>0&&(t=4*(l+i*e),_+=n*h[t+3],g+=n,h[t+3]<255&&(n=n*h[t+3]/250),p+=n*h[t],f+=n*h[t+1],m+=n*h[t+2],c+=n))}}u[s]=p/c,u[s+1]=f/c,u[s+2]=m/c,u[s+3]=_/g}return c}}l(vl,"type","Resize"),l(vl,"defaults",{resizeType:"hermite",scaleX:1,scaleY:1,lanczosLobes:3}),l(vl,"uniformLocations",["uDelta","uTaps"]),at.setClass(vl);class yl extends Wa{getFragmentSource(){return"\n  precision highp float;\n  uniform sampler2D uTexture;\n  uniform float uSaturation;\n  varying vec2 vTexCoord;\n  void main() {\n    vec4 color = texture2D(uTexture, vTexCoord);\n    float rgMax = max(color.r, color.g);\n    float rgbMax = max(rgMax, color.b);\n    color.r += rgbMax != color.r ? (rgbMax - color.r) * uSaturation : 0.00;\n    color.g += rgbMax != color.g ? (rgbMax - color.g) * uSaturation : 0.00;\n    color.b += rgbMax != color.b ? (rgbMax - color.b) * uSaturation : 0.00;\n    gl_FragColor = color;\n  }\n"}applyTo2d(t){let{imageData:{data:e}}=t;const s=-this.saturation;for(let i=0;i<e.length;i+=4){const t=e[i],n=e[i+1],r=e[i+2],o=Math.max(t,n,r);e[i]+=o!==t?(o-t)*s:0,e[i+1]+=o!==n?(o-n)*s:0,e[i+2]+=o!==r?(o-r)*s:0}}sendUniformData(t,e){t.uniform1f(e.uSaturation,-this.saturation)}isNeutralState(){return 0===this.saturation}}l(yl,"type","Saturation"),l(yl,"defaults",{saturation:0}),l(yl,"uniformLocations",["uSaturation"]),at.setClass(yl);class bl extends Wa{getFragmentSource(){return"\n  precision highp float;\n  uniform sampler2D uTexture;\n  uniform float uVibrance;\n  varying vec2 vTexCoord;\n  void main() {\n    vec4 color = texture2D(uTexture, vTexCoord);\n    float max = max(color.r, max(color.g, color.b));\n    float avg = (color.r + color.g + color.b) / 3.0;\n    float amt = (abs(max - avg) * 2.0) * uVibrance;\n    color.r += max != color.r ? (max - color.r) * amt : 0.00;\n    color.g += max != color.g ? (max - color.g) * amt : 0.00;\n    color.b += max != color.b ? (max - color.b) * amt : 0.00;\n    gl_FragColor = color;\n  }\n"}applyTo2d(t){let{imageData:{data:e}}=t;const s=-this.vibrance;for(let i=0;i<e.length;i+=4){const t=e[i],n=e[i+1],r=e[i+2],o=Math.max(t,n,r),a=(t+n+r)/3,l=2*Math.abs(o-a)/255*s;e[i]+=o!==t?(o-t)*l:0,e[i+1]+=o!==n?(o-n)*l:0,e[i+2]+=o!==r?(o-r)*l:0}}sendUniformData(t,e){t.uniform1f(e.uVibrance,-this.vibrance)}isNeutralState(){return 0===this.vibrance}}l(bl,"type","Vibrance"),l(bl,"defaults",{vibrance:0}),l(bl,"uniformLocations",["uVibrance"]),at.setClass(bl);Object.freeze({__proto__:null,BaseFilter:Wa,BlackWhite:il,BlendColor:Ya,BlendImage:za,Blur:Ga,Brightness:Ua,Brownie:Qa,ColorMatrix:Ka,Composed:nl,Contrast:rl,Convolute:al,Gamma:hl,Grayscale:ul,HueRotation:gl,Invert:pl,Kodachrome:Za,Noise:fl,Pixelate:ml,Polaroid:el,RemoveColor:_l,Resize:vl,Saturation:yl,Sepia:sl,Technicolor:tl,Vibrance:bl,Vintage:Ja}),s(1560),s(3713),s(3055);var Cl=s(4684),xl=s(8015),wl=s(795),Sl=s(9759),Tl=s(7608);s(4979);const kl=()=>{},Ol={NODE_CLIENT:!1,NODE_ADMIN:!1,SDK_VERSION:"${JSCORE_VERSION}"},El=function(t,e){if(!t)throw Dl(e)},Dl=function(t){return new Error("Firebase Database ("+Ol.SDK_VERSION+") INTERNAL ASSERT FAILED: "+t)},Il=function(t){const e=[];let s=0;for(let i=0;i<t.length;i++){let n=t.charCodeAt(i);n<128?e[s++]=n:n<2048?(e[s++]=n>>6|192,e[s++]=63&n|128):55296===(64512&n)&&i+1<t.length&&56320===(64512&t.charCodeAt(i+1))?(n=65536+((1023&n)<<10)+(1023&t.charCodeAt(++i)),e[s++]=n>>18|240,e[s++]=n>>12&63|128,e[s++]=n>>6&63|128,e[s++]=63&n|128):(e[s++]=n>>12|224,e[s++]=n>>6&63|128,e[s++]=63&n|128)}return e},Pl=function(t){const e=[];let s=0,i=0;while(s<t.length){const n=t[s++];if(n<128)e[i++]=String.fromCharCode(n);else if(n>191&&n<224){const r=t[s++];e[i++]=String.fromCharCode((31&n)<<6|63&r)}else if(n>239&&n<365){const r=t[s++],o=t[s++],a=t[s++],l=((7&n)<<18|(63&r)<<12|(63&o)<<6|63&a)-65536;e[i++]=String.fromCharCode(55296+(l>>10)),e[i++]=String.fromCharCode(56320+(1023&l))}else{const r=t[s++],o=t[s++];e[i++]=String.fromCharCode((15&n)<<12|(63&r)<<6|63&o)}}return e.join("")},Al={byteToCharMap_:null,charToByteMap_:null,byteToCharMapWebSafe_:null,charToByteMapWebSafe_:null,ENCODED_VALS_BASE:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",get ENCODED_VALS(){return this.ENCODED_VALS_BASE+"+/="},get ENCODED_VALS_WEBSAFE(){return this.ENCODED_VALS_BASE+"-_."},HAS_NATIVE_SUPPORT:"function"===typeof atob,encodeByteArray(t,e){if(!Array.isArray(t))throw Error("encodeByteArray takes an array as a parameter");this.init_();const s=e?this.byteToCharMapWebSafe_:this.byteToCharMap_,i=[];for(let n=0;n<t.length;n+=3){const e=t[n],r=n+1<t.length,o=r?t[n+1]:0,a=n+2<t.length,l=a?t[n+2]:0,h=e>>2,c=(3&e)<<4|o>>4;let u=(15&o)<<2|l>>6,d=63&l;a||(d=64,r||(u=64)),i.push(s[h],s[c],s[u],s[d])}return i.join("")},encodeString(t,e){return this.HAS_NATIVE_SUPPORT&&!e?btoa(t):this.encodeByteArray(Il(t),e)},decodeString(t,e){return this.HAS_NATIVE_SUPPORT&&!e?atob(t):Pl(this.decodeStringToByteArray(t,e))},decodeStringToByteArray(t,e){this.init_();const s=e?this.charToByteMapWebSafe_:this.charToByteMap_,i=[];for(let n=0;n<t.length;){const e=s[t.charAt(n++)],r=n<t.length,o=r?s[t.charAt(n)]:0;++n;const a=n<t.length,l=a?s[t.charAt(n)]:64;++n;const h=n<t.length,c=h?s[t.charAt(n)]:64;if(++n,null==e||null==o||null==l||null==c)throw new Ml;const u=e<<2|o>>4;if(i.push(u),64!==l){const t=o<<4&240|l>>2;if(i.push(t),64!==c){const t=l<<6&192|c;i.push(t)}}}return i},init_(){if(!this.byteToCharMap_){this.byteToCharMap_={},this.charToByteMap_={},this.byteToCharMapWebSafe_={},this.charToByteMapWebSafe_={};for(let t=0;t<this.ENCODED_VALS.length;t++)this.byteToCharMap_[t]=this.ENCODED_VALS.charAt(t),this.charToByteMap_[this.byteToCharMap_[t]]=t,this.byteToCharMapWebSafe_[t]=this.ENCODED_VALS_WEBSAFE.charAt(t),this.charToByteMapWebSafe_[this.byteToCharMapWebSafe_[t]]=t,t>=this.ENCODED_VALS_BASE.length&&(this.charToByteMap_[this.ENCODED_VALS_WEBSAFE.charAt(t)]=t,this.charToByteMapWebSafe_[this.ENCODED_VALS.charAt(t)]=t)}}};class Ml extends Error{constructor(){super(...arguments),this.name="DecodeBase64StringError"}}const Rl=function(t){const e=Il(t);return Al.encodeByteArray(e,!0)},Ll=function(t){return Rl(t).replace(/\./g,"")},Fl=function(t){try{return Al.decodeString(t,!0)}catch(h){console.error("base64Decode failed: ",h)}return null};
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
function jl(t){return Nl(void 0,t)}function Nl(t,e){if(!(e instanceof Object))return e;switch(e.constructor){case Date:const s=e;return new Date(s.getTime());case Object:void 0===t&&(t={});break;case Array:t=[];break;default:return e}for(const s in e)e.hasOwnProperty(s)&&Bl(s)&&(t[s]=Nl(t[s],e[s]));return t}function Bl(t){return"__proto__"!==t}
/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Wl(){if("undefined"!==typeof self)return self;if("undefined"!==typeof window)return window;if("undefined"!==typeof s.g)return s.g;throw new Error("Unable to locate global object.")}
/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Xl=()=>Wl().__FIREBASE_DEFAULTS__,Yl=()=>{if("undefined"===typeof process)return;const t={NODE_ENV:"production",BASE_URL:"/alien_mood/"}.__FIREBASE_DEFAULTS__;return t?JSON.parse(t):void 0},Vl=()=>{if("undefined"===typeof document)return;let t;try{t=document.cookie.match(/__FIREBASE_DEFAULTS__=([^;]+)/)}catch(h){return}const e=t&&Fl(t[1]);return e&&JSON.parse(e)},Hl=()=>{try{return kl()||Xl()||Yl()||Vl()}catch(h){return void console.info(`Unable to get __FIREBASE_DEFAULTS__ due to: ${h}`)}},zl=t=>{var e,s;return null===(s=null===(e=Hl())||void 0===e?void 0:e.emulatorHosts)||void 0===s?void 0:s[t]},Gl=t=>{const e=zl(t);if(!e)return;const s=e.lastIndexOf(":");if(s<=0||s+1===e.length)throw new Error(`Invalid host ${e} with no separate hostname and port!`);const i=parseInt(e.substring(s+1),10);return"["===e[0]?[e.substring(1,s-1),i]:[e.substring(0,s),i]},Ul=()=>{var t;return null===(t=Hl())||void 0===t?void 0:t.config};
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
class ql{constructor(){this.reject=()=>{},this.resolve=()=>{},this.promise=new Promise(((t,e)=>{this.resolve=t,this.reject=e}))}wrapCallback(t){return(e,s)=>{e?this.reject(e):this.resolve(s),"function"===typeof t&&(this.promise.catch((()=>{})),1===t.length?t(e):t(e,s))}}}
/**
 * @license
 * Copyright 2025 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Kl(t){return t.endsWith(".cloudworkstations.dev")}async function $l(t){const e=await fetch(t,{credentials:"include"});return e.ok}
/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Ql(t,e){if(t.uid)throw new Error('The "uid" field is no longer supported by mockUserToken. Please use "sub" instead for Firebase Auth User ID.');const s={alg:"none",type:"JWT"},i=e||"demo-project",n=t.iat||0,r=t.sub||t.user_id;if(!r)throw new Error("mockUserToken must contain 'sub' or 'user_id' field!");const o=Object.assign({iss:`https://securetoken.google.com/${i}`,aud:i,iat:n,exp:n+3600,auth_time:n,sub:r,user_id:r,firebase:{sign_in_provider:"custom",identities:{}}},t),a="";return[Ll(JSON.stringify(s)),Ll(JSON.stringify(o)),a].join(".")}const Jl={};function Zl(){const t={prod:[],emulator:[]};for(const e of Object.keys(Jl))Jl[e]?t.emulator.push(e):t.prod.push(e);return t}function th(t){let e=document.getElementById(t),s=!1;return e||(e=document.createElement("div"),e.setAttribute("id",t),s=!0),{created:s,element:e}}let eh=!1;function sh(t,e){if("undefined"===typeof window||"undefined"===typeof document||!Kl(window.location.host)||Jl[t]===e||Jl[t]||eh)return;function s(t){return`__firebase__banner__${t}`}Jl[t]=e;const i="__firebase__banner",n=Zl(),r=n.prod.length>0;function o(){const t=document.getElementById(i);t&&t.remove()}function a(t){t.style.display="flex",t.style.background="#7faaf0",t.style.position="fixed",t.style.bottom="5px",t.style.left="5px",t.style.padding=".5em",t.style.borderRadius="5px",t.style.alignItems="center"}function l(t,e){t.setAttribute("width","24"),t.setAttribute("id",e),t.setAttribute("height","24"),t.setAttribute("viewBox","0 0 24 24"),t.setAttribute("fill","none"),t.style.marginLeft="-6px"}function h(){const t=document.createElement("span");return t.style.cursor="pointer",t.style.marginLeft="16px",t.style.fontSize="24px",t.innerHTML=" &times;",t.onclick=()=>{eh=!0,o()},t}function c(t,e){t.setAttribute("id",e),t.innerText="Learn more",t.href="https://firebase.google.com/docs/studio/preview-apps#preview-backend",t.setAttribute("target","__blank"),t.style.paddingLeft="5px",t.style.textDecoration="underline"}function u(){const t=th(i),e=s("text"),n=document.getElementById(e)||document.createElement("span"),o=s("learnmore"),u=document.getElementById(o)||document.createElement("a"),d=s("preprendIcon"),g=document.getElementById(d)||document.createElementNS("http://www.w3.org/2000/svg","svg");if(t.created){const e=t.element;a(e),c(u,o);const s=h();l(g,d),e.append(g,n,u,s),document.body.appendChild(e)}r?(n.innerText="Preview backend disconnected.",g.innerHTML='<g clip-path="url(#clip0_6013_33858)">\n<path d="M4.8 17.6L12 5.6L19.2 17.6H4.8ZM6.91667 16.4H17.0833L12 7.93333L6.91667 16.4ZM12 15.6C12.1667 15.6 12.3056 15.5444 12.4167 15.4333C12.5389 15.3111 12.6 15.1667 12.6 15C12.6 14.8333 12.5389 14.6944 12.4167 14.5833C12.3056 14.4611 12.1667 14.4 12 14.4C11.8333 14.4 11.6889 14.4611 11.5667 14.5833C11.4556 14.6944 11.4 14.8333 11.4 15C11.4 15.1667 11.4556 15.3111 11.5667 15.4333C11.6889 15.5444 11.8333 15.6 12 15.6ZM11.4 13.6H12.6V10.4H11.4V13.6Z" fill="#212121"/>\n</g>\n<defs>\n<clipPath id="clip0_6013_33858">\n<rect width="24" height="24" fill="white"/>\n</clipPath>\n</defs>'):(g.innerHTML='<g clip-path="url(#clip0_6083_34804)">\n<path d="M11.4 15.2H12.6V11.2H11.4V15.2ZM12 10C12.1667 10 12.3056 9.94444 12.4167 9.83333C12.5389 9.71111 12.6 9.56667 12.6 9.4C12.6 9.23333 12.5389 9.09444 12.4167 8.98333C12.3056 8.86111 12.1667 8.8 12 8.8C11.8333 8.8 11.6889 8.86111 11.5667 8.98333C11.4556 9.09444 11.4 9.23333 11.4 9.4C11.4 9.56667 11.4556 9.71111 11.5667 9.83333C11.6889 9.94444 11.8333 10 12 10ZM12 18.4C11.1222 18.4 10.2944 18.2333 9.51667 17.9C8.73889 17.5667 8.05556 17.1111 7.46667 16.5333C6.88889 15.9444 6.43333 15.2611 6.1 14.4833C5.76667 13.7056 5.6 12.8778 5.6 12C5.6 11.1111 5.76667 10.2833 6.1 9.51667C6.43333 8.73889 6.88889 8.06111 7.46667 7.48333C8.05556 6.89444 8.73889 6.43333 9.51667 6.1C10.2944 5.76667 11.1222 5.6 12 5.6C12.8889 5.6 13.7167 5.76667 14.4833 6.1C15.2611 6.43333 15.9389 6.89444 16.5167 7.48333C17.1056 8.06111 17.5667 8.73889 17.9 9.51667C18.2333 10.2833 18.4 11.1111 18.4 12C18.4 12.8778 18.2333 13.7056 17.9 14.4833C17.5667 15.2611 17.1056 15.9444 16.5167 16.5333C15.9389 17.1111 15.2611 17.5667 14.4833 17.9C13.7167 18.2333 12.8889 18.4 12 18.4ZM12 17.2C13.4444 17.2 14.6722 16.6944 15.6833 15.6833C16.6944 14.6722 17.2 13.4444 17.2 12C17.2 10.5556 16.6944 9.32778 15.6833 8.31667C14.6722 7.30555 13.4444 6.8 12 6.8C10.5556 6.8 9.32778 7.30555 8.31667 8.31667C7.30556 9.32778 6.8 10.5556 6.8 12C6.8 13.4444 7.30556 14.6722 8.31667 15.6833C9.32778 16.6944 10.5556 17.2 12 17.2Z" fill="#212121"/>\n</g>\n<defs>\n<clipPath id="clip0_6083_34804">\n<rect width="24" height="24" fill="white"/>\n</clipPath>\n</defs>',n.innerText="Preview backend running in this workspace."),n.setAttribute("id",e)}"loading"===document.readyState?window.addEventListener("DOMContentLoaded",u):u()}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function ih(){return"undefined"!==typeof navigator&&"string"===typeof navigator["userAgent"]?navigator["userAgent"]:""}function nh(){return"undefined"!==typeof window&&!!(window["cordova"]||window["phonegap"]||window["PhoneGap"])&&/ios|iphone|ipod|ipad|android|blackberry|iemobile/i.test(ih())}function rh(){return"object"===typeof navigator&&"ReactNative"===navigator["product"]}function oh(){return!0===Ol.NODE_CLIENT||!0===Ol.NODE_ADMIN}function ah(){try{return"object"===typeof indexedDB}catch(h){return!1}}function lh(){return new Promise(((t,e)=>{try{let s=!0;const i="validate-browser-context-for-indexeddb-analytics-module",n=self.indexedDB.open(i);n.onsuccess=()=>{n.result.close(),s||self.indexedDB.deleteDatabase(i),t(!0)},n.onupgradeneeded=()=>{s=!1},n.onerror=()=>{var t;e((null===(t=n.error)||void 0===t?void 0:t.message)||"")}}catch(Hu){e(Hu)}}))}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
const hh="FirebaseError";class ch extends Error{constructor(t,e,s){super(e),this.code=t,this.customData=s,this.name=hh,Object.setPrototypeOf(this,ch.prototype),Error.captureStackTrace&&Error.captureStackTrace(this,uh.prototype.create)}}class uh{constructor(t,e,s){this.service=t,this.serviceName=e,this.errors=s}create(t,...e){const s=e[0]||{},i=`${this.service}/${t}`,n=this.errors[t],r=n?dh(n,s):"Error",o=`${this.serviceName}: ${r} (${i}).`,a=new ch(i,o,s);return a}}function dh(t,e){return t.replace(gh,((t,s)=>{const i=e[s];return null!=i?String(i):`<${s}?>`}))}const gh=/\{\$([^}]+)}/g;
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function ph(t){return JSON.parse(t)}function fh(t){return JSON.stringify(t)}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const mh=function(t){let e={},s={},i={},n="";try{const r=t.split(".");e=ph(Fl(r[0])||""),s=ph(Fl(r[1])||""),n=r[2],i=s["d"]||{},delete s["d"]}catch(h){}return{header:e,claims:s,data:i,signature:n}},_h=function(t){const e=mh(t),s=e.claims;return!!s&&"object"===typeof s&&s.hasOwnProperty("iat")},vh=function(t){const e=mh(t).claims;return"object"===typeof e&&!0===e["admin"]};
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
function yh(t,e){return Object.prototype.hasOwnProperty.call(t,e)}function bh(t,e){return Object.prototype.hasOwnProperty.call(t,e)?t[e]:void 0}function Ch(t){for(const e in t)if(Object.prototype.hasOwnProperty.call(t,e))return!1;return!0}function xh(t,e,s){const i={};for(const n in t)Object.prototype.hasOwnProperty.call(t,n)&&(i[n]=e.call(s,t[n],n,t));return i}function wh(t,e){if(t===e)return!0;const s=Object.keys(t),i=Object.keys(e);for(const n of s){if(!i.includes(n))return!1;const s=t[n],r=e[n];if(Sh(s)&&Sh(r)){if(!wh(s,r))return!1}else if(s!==r)return!1}for(const n of i)if(!s.includes(n))return!1;return!0}function Sh(t){return null!==t&&"object"===typeof t}
/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
function Th(t){const e=[];for(const[s,i]of Object.entries(t))Array.isArray(i)?i.forEach((t=>{e.push(encodeURIComponent(s)+"="+encodeURIComponent(t))})):e.push(encodeURIComponent(s)+"="+encodeURIComponent(i));return e.length?"&"+e.join("&"):""}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
class kh{constructor(){this.chain_=[],this.buf_=[],this.W_=[],this.pad_=[],this.inbuf_=0,this.total_=0,this.blockSize=64,this.pad_[0]=128;for(let t=1;t<this.blockSize;++t)this.pad_[t]=0;this.reset()}reset(){this.chain_[0]=1732584193,this.chain_[1]=4023233417,this.chain_[2]=2562383102,this.chain_[3]=271733878,this.chain_[4]=3285377520,this.inbuf_=0,this.total_=0}compress_(t,e){e||(e=0);const s=this.W_;if("string"===typeof t)for(let c=0;c<16;c++)s[c]=t.charCodeAt(e)<<24|t.charCodeAt(e+1)<<16|t.charCodeAt(e+2)<<8|t.charCodeAt(e+3),e+=4;else for(let c=0;c<16;c++)s[c]=t[e]<<24|t[e+1]<<16|t[e+2]<<8|t[e+3],e+=4;for(let c=16;c<80;c++){const t=s[c-3]^s[c-8]^s[c-14]^s[c-16];s[c]=4294967295&(t<<1|t>>>31)}let i,n,r=this.chain_[0],o=this.chain_[1],a=this.chain_[2],l=this.chain_[3],h=this.chain_[4];for(let c=0;c<80;c++){c<40?c<20?(i=l^o&(a^l),n=1518500249):(i=o^a^l,n=1859775393):c<60?(i=o&a|l&(o|a),n=2400959708):(i=o^a^l,n=3395469782);const t=(r<<5|r>>>27)+i+h+n+s[c]&4294967295;h=l,l=a,a=4294967295&(o<<30|o>>>2),o=r,r=t}this.chain_[0]=this.chain_[0]+r&4294967295,this.chain_[1]=this.chain_[1]+o&4294967295,this.chain_[2]=this.chain_[2]+a&4294967295,this.chain_[3]=this.chain_[3]+l&4294967295,this.chain_[4]=this.chain_[4]+h&4294967295}update(t,e){if(null==t)return;void 0===e&&(e=t.length);const s=e-this.blockSize;let i=0;const n=this.buf_;let r=this.inbuf_;while(i<e){if(0===r)while(i<=s)this.compress_(t,i),i+=this.blockSize;if("string"===typeof t){while(i<e)if(n[r]=t.charCodeAt(i),++r,++i,r===this.blockSize){this.compress_(n),r=0;break}}else while(i<e)if(n[r]=t[i],++r,++i,r===this.blockSize){this.compress_(n),r=0;break}}this.inbuf_=r,this.total_+=e}digest(){const t=[];let e=8*this.total_;this.inbuf_<56?this.update(this.pad_,56-this.inbuf_):this.update(this.pad_,this.blockSize-(this.inbuf_-56));for(let i=this.blockSize-1;i>=56;i--)this.buf_[i]=255&e,e/=256;this.compress_(this.buf_);let s=0;for(let i=0;i<5;i++)for(let e=24;e>=0;e-=8)t[s]=this.chain_[i]>>e&255,++s;return t}}function Oh(t,e){return`${t} failed: ${e} argument `}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
const Eh=function(t){const e=[];let s=0;for(let i=0;i<t.length;i++){let n=t.charCodeAt(i);if(n>=55296&&n<=56319){const e=n-55296;i++,El(i<t.length,"Surrogate pair missing trail surrogate.");const s=t.charCodeAt(i)-56320;n=65536+(e<<10)+s}n<128?e[s++]=n:n<2048?(e[s++]=n>>6|192,e[s++]=63&n|128):n<65536?(e[s++]=n>>12|224,e[s++]=n>>6&63|128,e[s++]=63&n|128):(e[s++]=n>>18|240,e[s++]=n>>12&63|128,e[s++]=n>>6&63|128,e[s++]=63&n|128)}return e},Dh=function(t){let e=0;for(let s=0;s<t.length;s++){const i=t.charCodeAt(s);i<128?e++:i<2048?e+=2:i>=55296&&i<=56319?(e+=4,s++):e+=3}return e};
/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
function Ih(t){return t&&t._delegate?t._delegate:t}class Ph{constructor(t,e,s){this.name=t,this.instanceFactory=e,this.type=s,this.multipleInstances=!1,this.serviceProps={},this.instantiationMode="LAZY",this.onInstanceCreated=null}setInstantiationMode(t){return this.instantiationMode=t,this}setMultipleInstances(t){return this.multipleInstances=t,this}setServiceProps(t){return this.serviceProps=t,this}setInstanceCreatedCallback(t){return this.onInstanceCreated=t,this}}
/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Ah="[DEFAULT]";
/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Mh{constructor(t,e){this.name=t,this.container=e,this.component=null,this.instances=new Map,this.instancesDeferred=new Map,this.instancesOptions=new Map,this.onInitCallbacks=new Map}get(t){const e=this.normalizeInstanceIdentifier(t);if(!this.instancesDeferred.has(e)){const t=new ql;if(this.instancesDeferred.set(e,t),this.isInitialized(e)||this.shouldAutoInitialize())try{const s=this.getOrInitializeService({instanceIdentifier:e});s&&t.resolve(s)}catch(h){}}return this.instancesDeferred.get(e).promise}getImmediate(t){var e;const s=this.normalizeInstanceIdentifier(null===t||void 0===t?void 0:t.identifier),i=null!==(e=null===t||void 0===t?void 0:t.optional)&&void 0!==e&&e;if(!this.isInitialized(s)&&!this.shouldAutoInitialize()){if(i)return null;throw Error(`Service ${this.name} is not available`)}try{return this.getOrInitializeService({instanceIdentifier:s})}catch(h){if(i)return null;throw h}}getComponent(){return this.component}setComponent(t){if(t.name!==this.name)throw Error(`Mismatching Component ${t.name} for Provider ${this.name}.`);if(this.component)throw Error(`Component for ${this.name} has already been provided`);if(this.component=t,this.shouldAutoInitialize()){if(Lh(t))try{this.getOrInitializeService({instanceIdentifier:Ah})}catch(h){}for(const[t,e]of this.instancesDeferred.entries()){const s=this.normalizeInstanceIdentifier(t);try{const t=this.getOrInitializeService({instanceIdentifier:s});e.resolve(t)}catch(h){}}}}clearInstance(t=Ah){this.instancesDeferred.delete(t),this.instancesOptions.delete(t),this.instances.delete(t)}async delete(){const t=Array.from(this.instances.values());await Promise.all([...t.filter((t=>"INTERNAL"in t)).map((t=>t.INTERNAL.delete())),...t.filter((t=>"_delete"in t)).map((t=>t._delete()))])}isComponentSet(){return null!=this.component}isInitialized(t=Ah){return this.instances.has(t)}getOptions(t=Ah){return this.instancesOptions.get(t)||{}}initialize(t={}){const{options:e={}}=t,s=this.normalizeInstanceIdentifier(t.instanceIdentifier);if(this.isInitialized(s))throw Error(`${this.name}(${s}) has already been initialized`);if(!this.isComponentSet())throw Error(`Component ${this.name} has not been registered yet`);const i=this.getOrInitializeService({instanceIdentifier:s,options:e});for(const[n,r]of this.instancesDeferred.entries()){const t=this.normalizeInstanceIdentifier(n);s===t&&r.resolve(i)}return i}onInit(t,e){var s;const i=this.normalizeInstanceIdentifier(e),n=null!==(s=this.onInitCallbacks.get(i))&&void 0!==s?s:new Set;n.add(t),this.onInitCallbacks.set(i,n);const r=this.instances.get(i);return r&&t(r,i),()=>{n.delete(t)}}invokeOnInitCallbacks(t,e){const s=this.onInitCallbacks.get(e);if(s)for(const i of s)try{i(t,e)}catch(ba){}}getOrInitializeService({instanceIdentifier:t,options:e={}}){let s=this.instances.get(t);if(!s&&this.component&&(s=this.component.instanceFactory(this.container,{instanceIdentifier:Rh(t),options:e}),this.instances.set(t,s),this.instancesOptions.set(t,e),this.invokeOnInitCallbacks(s,t),this.component.onInstanceCreated))try{this.component.onInstanceCreated(this.container,t,s)}catch(ba){}return s||null}normalizeInstanceIdentifier(t=Ah){return this.component?this.component.multipleInstances?t:Ah:t}shouldAutoInitialize(){return!!this.component&&"EXPLICIT"!==this.component.instantiationMode}}function Rh(t){return t===Ah?void 0:t}function Lh(t){return"EAGER"===t.instantiationMode}
/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Fh{constructor(t){this.name=t,this.providers=new Map}addComponent(t){const e=this.getProvider(t.name);if(e.isComponentSet())throw new Error(`Component ${t.name} has already been registered with ${this.name}`);e.setComponent(t)}addOrOverwriteComponent(t){const e=this.getProvider(t.name);e.isComponentSet()&&this.providers.delete(t.name),this.addComponent(t)}getProvider(t){if(this.providers.has(t))return this.providers.get(t);const e=new Mh(t,this);return this.providers.set(t,e),e}getProviders(){return Array.from(this.providers.values())}}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
const jh=[];var Nh;(function(t){t[t["DEBUG"]=0]="DEBUG",t[t["VERBOSE"]=1]="VERBOSE",t[t["INFO"]=2]="INFO",t[t["WARN"]=3]="WARN",t[t["ERROR"]=4]="ERROR",t[t["SILENT"]=5]="SILENT"})(Nh||(Nh={}));const Bh={debug:Nh.DEBUG,verbose:Nh.VERBOSE,info:Nh.INFO,warn:Nh.WARN,error:Nh.ERROR,silent:Nh.SILENT},Wh=Nh.INFO,Xh={[Nh.DEBUG]:"log",[Nh.VERBOSE]:"log",[Nh.INFO]:"info",[Nh.WARN]:"warn",[Nh.ERROR]:"error"},Yh=(t,e,...s)=>{if(e<t.logLevel)return;const i=(new Date).toISOString(),n=Xh[e];if(!n)throw new Error(`Attempted to log a message with an invalid logType (value: ${e})`);console[n](`[${i}]  ${t.name}:`,...s)};class Vh{constructor(t){this.name=t,this._logLevel=Wh,this._logHandler=Yh,this._userLogHandler=null,jh.push(this)}get logLevel(){return this._logLevel}set logLevel(t){if(!(t in Nh))throw new TypeError(`Invalid value "${t}" assigned to \`logLevel\``);this._logLevel=t}setLogLevel(t){this._logLevel="string"===typeof t?Bh[t]:t}get logHandler(){return this._logHandler}set logHandler(t){if("function"!==typeof t)throw new TypeError("Value assigned to `logHandler` must be a function");this._logHandler=t}get userLogHandler(){return this._userLogHandler}set userLogHandler(t){this._userLogHandler=t}debug(...t){this._userLogHandler&&this._userLogHandler(this,Nh.DEBUG,...t),this._logHandler(this,Nh.DEBUG,...t)}log(...t){this._userLogHandler&&this._userLogHandler(this,Nh.VERBOSE,...t),this._logHandler(this,Nh.VERBOSE,...t)}info(...t){this._userLogHandler&&this._userLogHandler(this,Nh.INFO,...t),this._logHandler(this,Nh.INFO,...t)}warn(...t){this._userLogHandler&&this._userLogHandler(this,Nh.WARN,...t),this._logHandler(this,Nh.WARN,...t)}error(...t){this._userLogHandler&&this._userLogHandler(this,Nh.ERROR,...t),this._logHandler(this,Nh.ERROR,...t)}}const Hh=(t,e)=>e.some((e=>t instanceof e));let zh,Gh;function Uh(){return zh||(zh=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction])}function qh(){return Gh||(Gh=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])}const Kh=new WeakMap,$h=new WeakMap,Qh=new WeakMap,Jh=new WeakMap,Zh=new WeakMap;function tc(t){const e=new Promise(((e,s)=>{const i=()=>{t.removeEventListener("success",n),t.removeEventListener("error",r)},n=()=>{e(oc(t.result)),i()},r=()=>{s(t.error),i()};t.addEventListener("success",n),t.addEventListener("error",r)}));return e.then((e=>{e instanceof IDBCursor&&Kh.set(e,t)})).catch((()=>{})),Zh.set(e,t),e}function ec(t){if($h.has(t))return;const e=new Promise(((e,s)=>{const i=()=>{t.removeEventListener("complete",n),t.removeEventListener("error",r),t.removeEventListener("abort",r)},n=()=>{e(),i()},r=()=>{s(t.error||new DOMException("AbortError","AbortError")),i()};t.addEventListener("complete",n),t.addEventListener("error",r),t.addEventListener("abort",r)}));$h.set(t,e)}let sc={get(t,e,s){if(t instanceof IDBTransaction){if("done"===e)return $h.get(t);if("objectStoreNames"===e)return t.objectStoreNames||Qh.get(t);if("store"===e)return s.objectStoreNames[1]?void 0:s.objectStore(s.objectStoreNames[0])}return oc(t[e])},set(t,e,s){return t[e]=s,!0},has(t,e){return t instanceof IDBTransaction&&("done"===e||"store"===e)||e in t}};function ic(t){sc=t(sc)}function nc(t){return t!==IDBDatabase.prototype.transaction||"objectStoreNames"in IDBTransaction.prototype?qh().includes(t)?function(...e){return t.apply(ac(this),e),oc(Kh.get(this))}:function(...e){return oc(t.apply(ac(this),e))}:function(e,...s){const i=t.call(ac(this),e,...s);return Qh.set(i,e.sort?e.sort():[e]),oc(i)}}function rc(t){return"function"===typeof t?nc(t):(t instanceof IDBTransaction&&ec(t),Hh(t,Uh())?new Proxy(t,sc):t)}function oc(t){if(t instanceof IDBRequest)return tc(t);if(Jh.has(t))return Jh.get(t);const e=rc(t);return e!==t&&(Jh.set(t,e),Zh.set(e,t)),e}const ac=t=>Zh.get(t);function lc(t,e,{blocked:s,upgrade:i,blocking:n,terminated:r}={}){const o=indexedDB.open(t,e),a=oc(o);return i&&o.addEventListener("upgradeneeded",(t=>{i(oc(o.result),t.oldVersion,t.newVersion,oc(o.transaction),t)})),s&&o.addEventListener("blocked",(t=>s(t.oldVersion,t.newVersion,t))),a.then((t=>{r&&t.addEventListener("close",(()=>r())),n&&t.addEventListener("versionchange",(t=>n(t.oldVersion,t.newVersion,t)))})).catch((()=>{})),a}const hc=["get","getKey","getAll","getAllKeys","count"],cc=["put","add","delete","clear"],uc=new Map;function dc(t,e){if(!(t instanceof IDBDatabase)||e in t||"string"!==typeof e)return;if(uc.get(e))return uc.get(e);const s=e.replace(/FromIndex$/,""),i=e!==s,n=cc.includes(s);if(!(s in(i?IDBIndex:IDBObjectStore).prototype)||!n&&!hc.includes(s))return;const r=async function(t,...e){const r=this.transaction(t,n?"readwrite":"readonly");let o=r.store;return i&&(o=o.index(e.shift())),(await Promise.all([o[s](...e),n&&r.done]))[0]};return uc.set(e,r),r}ic((t=>({...t,get:(e,s,i)=>dc(e,s)||t.get(e,s,i),has:(e,s)=>!!dc(e,s)||t.has(e,s)})));
/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
class gc{constructor(t){this.container=t}getPlatformInfoString(){const t=this.container.getProviders();return t.map((t=>{if(pc(t)){const e=t.getImmediate();return`${e.library}/${e.version}`}return null})).filter((t=>t)).join(" ")}}function pc(t){const e=t.getComponent();return"VERSION"===(null===e||void 0===e?void 0:e.type)}const fc="@firebase/app",mc="0.13.1",_c=new Vh("@firebase/app"),vc="@firebase/app-compat",yc="@firebase/analytics-compat",bc="@firebase/analytics",Cc="@firebase/app-check-compat",xc="@firebase/app-check",wc="@firebase/auth",Sc="@firebase/auth-compat",Tc="@firebase/database",kc="@firebase/data-connect",Oc="@firebase/database-compat",Ec="@firebase/functions",Dc="@firebase/functions-compat",Ic="@firebase/installations",Pc="@firebase/installations-compat",Ac="@firebase/messaging",Mc="@firebase/messaging-compat",Rc="@firebase/performance",Lc="@firebase/performance-compat",Fc="@firebase/remote-config",jc="@firebase/remote-config-compat",Nc="@firebase/storage",Bc="@firebase/storage-compat",Wc="@firebase/firestore",Xc="@firebase/ai",Yc="@firebase/firestore-compat",Vc="firebase",Hc="11.9.0",zc="[DEFAULT]",Gc={[fc]:"fire-core",[vc]:"fire-core-compat",[bc]:"fire-analytics",[yc]:"fire-analytics-compat",[xc]:"fire-app-check",[Cc]:"fire-app-check-compat",[wc]:"fire-auth",[Sc]:"fire-auth-compat",[Tc]:"fire-rtdb",[kc]:"fire-data-connect",[Oc]:"fire-rtdb-compat",[Ec]:"fire-fn",[Dc]:"fire-fn-compat",[Ic]:"fire-iid",[Pc]:"fire-iid-compat",[Ac]:"fire-fcm",[Mc]:"fire-fcm-compat",[Rc]:"fire-perf",[Lc]:"fire-perf-compat",[Fc]:"fire-rc",[jc]:"fire-rc-compat",[Nc]:"fire-gcs",[Bc]:"fire-gcs-compat",[Wc]:"fire-fst",[Yc]:"fire-fst-compat",[Xc]:"fire-vertex","fire-js":"fire-js",[Vc]:"fire-js-all"},Uc=new Map,qc=new Map,Kc=new Map;function $c(t,e){try{t.container.addComponent(e)}catch(h){_c.debug(`Component ${e.name} failed to register with FirebaseApp ${t.name}`,h)}}function Qc(t){const e=t.name;if(Kc.has(e))return _c.debug(`There were multiple attempts to register component ${e}.`),!1;Kc.set(e,t);for(const s of Uc.values())$c(s,t);for(const s of qc.values())$c(s,t);return!0}function Jc(t,e){const s=t.container.getProvider("heartbeat").getImmediate({optional:!0});return s&&s.triggerHeartbeat(),t.container.getProvider(e)}function Zc(t){return null!==t&&void 0!==t&&void 0!==t.settings}
/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
const tu={["no-app"]:"No Firebase App '{$appName}' has been created - call initializeApp() first",["bad-app-name"]:"Illegal App name: '{$appName}'",["duplicate-app"]:"Firebase App named '{$appName}' already exists with different options or config",["app-deleted"]:"Firebase App named '{$appName}' already deleted",["server-app-deleted"]:"Firebase Server App has been deleted",["no-options"]:"Need to provide options, when not being deployed to hosting via source.",["invalid-app-argument"]:"firebase.{$appName}() takes either no argument or a Firebase App instance.",["invalid-log-argument"]:"First argument to `onLog` must be null or a function.",["idb-open"]:"Error thrown when opening IndexedDB. Original error: {$originalErrorMessage}.",["idb-get"]:"Error thrown when reading from IndexedDB. Original error: {$originalErrorMessage}.",["idb-set"]:"Error thrown when writing to IndexedDB. Original error: {$originalErrorMessage}.",["idb-delete"]:"Error thrown when deleting from IndexedDB. Original error: {$originalErrorMessage}.",["finalization-registry-not-supported"]:"FirebaseServerApp deleteOnDeref field defined but the JS runtime does not support FinalizationRegistry.",["invalid-server-app-environment"]:"FirebaseServerApp is not for use in browser environments."},eu=new uh("app","Firebase",tu);
/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
class su{constructor(t,e,s){this._isDeleted=!1,this._options=Object.assign({},t),this._config=Object.assign({},e),this._name=e.name,this._automaticDataCollectionEnabled=e.automaticDataCollectionEnabled,this._container=s,this.container.addComponent(new Ph("app",(()=>this),"PUBLIC"))}get automaticDataCollectionEnabled(){return this.checkDestroyed(),this._automaticDataCollectionEnabled}set automaticDataCollectionEnabled(t){this.checkDestroyed(),this._automaticDataCollectionEnabled=t}get name(){return this.checkDestroyed(),this._name}get options(){return this.checkDestroyed(),this._options}get config(){return this.checkDestroyed(),this._config}get container(){return this._container}get isDeleted(){return this._isDeleted}set isDeleted(t){this._isDeleted=t}checkDestroyed(){if(this.isDeleted)throw eu.create("app-deleted",{appName:this._name})}}
/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
const iu=Hc;function nu(t,e={}){let s=t;if("object"!==typeof e){const t=e;e={name:t}}const i=Object.assign({name:zc,automaticDataCollectionEnabled:!0},e),n=i.name;if("string"!==typeof n||!n)throw eu.create("bad-app-name",{appName:String(n)});if(s||(s=Ul()),!s)throw eu.create("no-options");const r=Uc.get(n);if(r){if(wh(s,r.options)&&wh(i,r.config))return r;throw eu.create("duplicate-app",{appName:n})}const o=new Fh(n);for(const l of Kc.values())o.addComponent(l);const a=new su(s,i,o);return Uc.set(n,a),a}function ru(t=zc){const e=Uc.get(t);if(!e&&t===zc&&Ul())return nu();if(!e)throw eu.create("no-app",{appName:t});return e}function ou(t,e,s){var i;let n=null!==(i=Gc[t])&&void 0!==i?i:t;s&&(n+=`-${s}`);const r=n.match(/\s|\//),o=e.match(/\s|\//);if(r||o){const t=[`Unable to register library "${n}" with version "${e}":`];return r&&t.push(`library name "${n}" contains illegal characters (whitespace or "/")`),r&&o&&t.push("and"),o&&t.push(`version name "${e}" contains illegal characters (whitespace or "/")`),void _c.warn(t.join(" "))}Qc(new Ph(`${n}-version`,(()=>({library:n,version:e})),"VERSION"))}
/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
const au="firebase-heartbeat-database",lu=1,hu="firebase-heartbeat-store";let cu=null;function uu(){return cu||(cu=lc(au,lu,{upgrade:(t,e)=>{switch(e){case 0:try{t.createObjectStore(hu)}catch(h){console.warn(h)}}}}).catch((t=>{throw eu.create("idb-open",{originalErrorMessage:t.message})}))),cu}async function du(t){try{const e=await uu(),s=e.transaction(hu),i=await s.objectStore(hu).get(pu(t));return await s.done,i}catch(h){if(h instanceof ch)_c.warn(h.message);else{const e=eu.create("idb-get",{originalErrorMessage:null===h||void 0===h?void 0:h.message});_c.warn(e.message)}}}async function gu(t,e){try{const s=await uu(),i=s.transaction(hu,"readwrite"),n=i.objectStore(hu);await n.put(e,pu(t)),await i.done}catch(h){if(h instanceof ch)_c.warn(h.message);else{const e=eu.create("idb-set",{originalErrorMessage:null===h||void 0===h?void 0:h.message});_c.warn(e.message)}}}function pu(t){return`${t.name}!${t.options.appId}`}
/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const fu=1024,mu=30;class _u{constructor(t){this.container=t,this._heartbeatsCache=null;const e=this.container.getProvider("app").getImmediate();this._storage=new bu(e),this._heartbeatsCachePromise=this._storage.read().then((t=>(this._heartbeatsCache=t,t)))}async triggerHeartbeat(){var t,e;try{const s=this.container.getProvider("platform-logger").getImmediate(),i=s.getPlatformInfoString(),n=vu();if(null==(null===(t=this._heartbeatsCache)||void 0===t?void 0:t.heartbeats)&&(this._heartbeatsCache=await this._heartbeatsCachePromise,null==(null===(e=this._heartbeatsCache)||void 0===e?void 0:e.heartbeats)))return;if(this._heartbeatsCache.lastSentHeartbeatDate===n||this._heartbeatsCache.heartbeats.some((t=>t.date===n)))return;if(this._heartbeatsCache.heartbeats.push({date:n,agent:i}),this._heartbeatsCache.heartbeats.length>mu){const t=xu(this._heartbeatsCache.heartbeats);this._heartbeatsCache.heartbeats.splice(t,1)}return this._storage.overwrite(this._heartbeatsCache)}catch(h){_c.warn(h)}}async getHeartbeatsHeader(){var t;try{if(null===this._heartbeatsCache&&await this._heartbeatsCachePromise,null==(null===(t=this._heartbeatsCache)||void 0===t?void 0:t.heartbeats)||0===this._heartbeatsCache.heartbeats.length)return"";const e=vu(),{heartbeatsToSend:s,unsentEntries:i}=yu(this._heartbeatsCache.heartbeats),n=Ll(JSON.stringify({version:2,heartbeats:s}));return this._heartbeatsCache.lastSentHeartbeatDate=e,i.length>0?(this._heartbeatsCache.heartbeats=i,await this._storage.overwrite(this._heartbeatsCache)):(this._heartbeatsCache.heartbeats=[],this._storage.overwrite(this._heartbeatsCache)),n}catch(h){return _c.warn(h),""}}}function vu(){const t=new Date;return t.toISOString().substring(0,10)}function yu(t,e=fu){const s=[];let i=t.slice();for(const n of t){const t=s.find((t=>t.agent===n.agent));if(t){if(t.dates.push(n.date),Cu(s)>e){t.dates.pop();break}}else if(s.push({agent:n.agent,dates:[n.date]}),Cu(s)>e){s.pop();break}i=i.slice(1)}return{heartbeatsToSend:s,unsentEntries:i}}class bu{constructor(t){this.app=t,this._canUseIndexedDBPromise=this.runIndexedDBEnvironmentCheck()}async runIndexedDBEnvironmentCheck(){return!!ah()&&lh().then((()=>!0)).catch((()=>!1))}async read(){const t=await this._canUseIndexedDBPromise;if(t){const t=await du(this.app);return(null===t||void 0===t?void 0:t.heartbeats)?t:{heartbeats:[]}}return{heartbeats:[]}}async overwrite(t){var e;const s=await this._canUseIndexedDBPromise;if(s){const s=await this.read();return gu(this.app,{lastSentHeartbeatDate:null!==(e=t.lastSentHeartbeatDate)&&void 0!==e?e:s.lastSentHeartbeatDate,heartbeats:t.heartbeats})}}async add(t){var e;const s=await this._canUseIndexedDBPromise;if(s){const s=await this.read();return gu(this.app,{lastSentHeartbeatDate:null!==(e=t.lastSentHeartbeatDate)&&void 0!==e?e:s.lastSentHeartbeatDate,heartbeats:[...s.heartbeats,...t.heartbeats]})}}}function Cu(t){return Ll(JSON.stringify({version:2,heartbeats:t})).length}function xu(t){if(0===t.length)return-1;let e=0,s=t[0].date;for(let i=1;i<t.length;i++)t[i].date<s&&(s=t[i].date,e=i);return e}
/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function wu(t){Qc(new Ph("platform-logger",(t=>new gc(t)),"PRIVATE")),Qc(new Ph("heartbeat",(t=>new _u(t)),"PRIVATE")),ou(fc,mc,t),ou(fc,mc,"esm2017"),ou("fire-js","")}wu("");var Su="firebase",Tu="11.9.1";
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
ou(Su,Tu,"app");const ku="@firebase/database",Ou="1.0.19";
/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let Eu="";function Du(t){Eu=t}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Iu{constructor(t){this.domStorage_=t,this.prefix_="firebase:"}set(t,e){null==e?this.domStorage_.removeItem(this.prefixedName_(t)):this.domStorage_.setItem(this.prefixedName_(t),fh(e))}get(t){const e=this.domStorage_.getItem(this.prefixedName_(t));return null==e?null:ph(e)}remove(t){this.domStorage_.removeItem(this.prefixedName_(t))}prefixedName_(t){return this.prefix_+t}toString(){return this.domStorage_.toString()}}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Pu{constructor(){this.cache_={},this.isInMemoryStorage=!0}set(t,e){null==e?delete this.cache_[t]:this.cache_[t]=e}get(t){return yh(this.cache_,t)?this.cache_[t]:null}remove(t){delete this.cache_[t]}}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Au=function(t){try{if("undefined"!==typeof window&&"undefined"!==typeof window[t]){const e=window[t];return e.setItem("firebase:sentinel","cache"),e.removeItem("firebase:sentinel"),new Iu(e)}}catch(h){}return new Pu},Mu=Au("localStorage"),Ru=Au("sessionStorage"),Lu=new Vh("@firebase/database"),Fu=function(){let t=1;return function(){return t++}}(),ju=function(t){const e=Eh(t),s=new kh;s.update(e);const i=s.digest();return Al.encodeByteArray(i)},Nu=function(...t){let e="";for(let s=0;s<t.length;s++){const i=t[s];Array.isArray(i)||i&&"object"===typeof i&&"number"===typeof i.length?e+=Nu.apply(null,i):e+="object"===typeof i?fh(i):i,e+=" "}return e};let Bu=null,Wu=!0;const Xu=function(t,e){El(!e||!0===t||!1===t,"Can't turn on custom loggers persistently."),!0===t?(Lu.logLevel=Nh.VERBOSE,Bu=Lu.log.bind(Lu),e&&Ru.set("logging_enabled",!0)):"function"===typeof t?Bu=t:(Bu=null,Ru.remove("logging_enabled"))},Yu=function(...t){if(!0===Wu&&(Wu=!1,null===Bu&&!0===Ru.get("logging_enabled")&&Xu(!0)),Bu){const e=Nu.apply(null,t);Bu(e)}},Vu=function(t){return function(...e){Yu(t,...e)}},Hu=function(...t){const e="FIREBASE INTERNAL ERROR: "+Nu(...t);Lu.error(e)},zu=function(...t){const e=`FIREBASE FATAL ERROR: ${Nu(...t)}`;throw Lu.error(e),new Error(e)},Gu=function(...t){const e="FIREBASE WARNING: "+Nu(...t);Lu.warn(e)},Uu=function(){"undefined"!==typeof window&&window.location&&window.location.protocol&&-1!==window.location.protocol.indexOf("https:")&&Gu("Insecure Firebase access from a secure page. Please use https in calls to new Firebase().")},qu=function(t){return"number"===typeof t&&(t!==t||t===Number.POSITIVE_INFINITY||t===Number.NEGATIVE_INFINITY)},Ku=function(t){if(oh()||"complete"===document.readyState)t();else{let e=!1;const s=function(){document.body?e||(e=!0,t()):setTimeout(s,Math.floor(10))};document.addEventListener?(document.addEventListener("DOMContentLoaded",s,!1),window.addEventListener("load",s,!1)):document.attachEvent&&(document.attachEvent("onreadystatechange",(()=>{"complete"===document.readyState&&s()})),window.attachEvent("onload",s))}},$u="[MIN_NAME]",Qu="[MAX_NAME]",Ju=function(t,e){if(t===e)return 0;if(t===$u||e===Qu)return-1;if(e===$u||t===Qu)return 1;{const s=cd(t),i=cd(e);return null!==s?null!==i?s-i===0?t.length-e.length:s-i:-1:null!==i?1:t<e?-1:1}},Zu=function(t,e){return t===e?0:t<e?-1:1},td=function(t,e){if(e&&t in e)return e[t];throw new Error("Missing required key ("+t+") in object: "+fh(e))},ed=function(t){if("object"!==typeof t||null===t)return fh(t);const e=[];for(const i in t)e.push(i);e.sort();let s="{";for(let i=0;i<e.length;i++)0!==i&&(s+=","),s+=fh(e[i]),s+=":",s+=ed(t[e[i]]);return s+="}",s},sd=function(t,e){const s=t.length;if(s<=e)return[t];const i=[];for(let n=0;n<s;n+=e)n+e>s?i.push(t.substring(n,s)):i.push(t.substring(n,n+e));return i};function id(t,e){for(const s in t)t.hasOwnProperty(s)&&e(s,t[s])}const nd=function(t){El(!qu(t),"Invalid JSON number");const e=11,s=52,i=(1<<e-1)-1;let n,r,o,a,l;0===t?(r=0,o=0,n=1/t===-1/0?1:0):(n=t<0,t=Math.abs(t),t>=Math.pow(2,1-i)?(a=Math.min(Math.floor(Math.log(t)/Math.LN2),i),r=a+i,o=Math.round(t*Math.pow(2,s-a)-Math.pow(2,s))):(r=0,o=Math.round(t/Math.pow(2,1-i-s))));const h=[];for(l=s;l;l-=1)h.push(o%2?1:0),o=Math.floor(o/2);for(l=e;l;l-=1)h.push(r%2?1:0),r=Math.floor(r/2);h.push(n?1:0),h.reverse();const c=h.join("");let u="";for(l=0;l<64;l+=8){let t=parseInt(c.substr(l,8),2).toString(16);1===t.length&&(t="0"+t),u+=t}return u.toLowerCase()},rd=function(){return!("object"!==typeof window||!window["chrome"]||!window["chrome"]["extension"]||/^chrome/.test(window.location.href))},od=function(){return"object"===typeof Windows&&"object"===typeof Windows.UI};const ad=new RegExp("^-?(0*)\\d{1,10}$"),ld=-2147483648,hd=2147483647,cd=function(t){if(ad.test(t)){const e=Number(t);if(e>=ld&&e<=hd)return e}return null},ud=function(t){try{t()}catch(h){setTimeout((()=>{const e=h.stack||"";throw Gu("Exception was thrown by user callback.",e),h}),Math.floor(0))}},dd=function(){const t="object"===typeof window&&window["navigator"]&&window["navigator"]["userAgent"]||"";return t.search(/googlebot|google webmaster tools|bingbot|yahoo! slurp|baiduspider|yandexbot|duckduckbot/i)>=0},gd=function(t,e){const s=setTimeout(t,e);return"number"===typeof s&&"undefined"!==typeof Deno&&Deno["unrefTimer"]?Deno.unrefTimer(s):"object"===typeof s&&s["unref"]&&s["unref"](),s};
/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
class pd{constructor(t,e){this.appCheckProvider=e,this.appName=t.name,Zc(t)&&t.settings.appCheckToken&&(this.serverAppAppCheckToken=t.settings.appCheckToken),this.appCheck=null===e||void 0===e?void 0:e.getImmediate({optional:!0}),this.appCheck||null===e||void 0===e||e.get().then((t=>this.appCheck=t))}getToken(t){if(this.serverAppAppCheckToken){if(t)throw new Error("Attempted reuse of `FirebaseServerApp.appCheckToken` after previous usage failed.");return Promise.resolve({token:this.serverAppAppCheckToken})}return this.appCheck?this.appCheck.getToken(t):new Promise(((e,s)=>{setTimeout((()=>{this.appCheck?this.getToken(t).then(e,s):e(null)}),0)}))}addTokenChangeListener(t){var e;null===(e=this.appCheckProvider)||void 0===e||e.get().then((e=>e.addTokenListener(t)))}notifyForInvalidToken(){Gu(`Provided AppCheck credentials for the app named "${this.appName}" are invalid. This usually indicates your app was not initialized correctly.`)}}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class fd{constructor(t,e,s){this.appName_=t,this.firebaseOptions_=e,this.authProvider_=s,this.auth_=null,this.auth_=s.getImmediate({optional:!0}),this.auth_||s.onInit((t=>this.auth_=t))}getToken(t){return this.auth_?this.auth_.getToken(t).catch((t=>t&&"auth/token-not-initialized"===t.code?(Yu("Got auth/token-not-initialized error.  Treating as null token."),null):Promise.reject(t))):new Promise(((e,s)=>{setTimeout((()=>{this.auth_?this.getToken(t).then(e,s):e(null)}),0)}))}addTokenChangeListener(t){this.auth_?this.auth_.addAuthTokenListener(t):this.authProvider_.get().then((e=>e.addAuthTokenListener(t)))}removeTokenChangeListener(t){this.authProvider_.get().then((e=>e.removeAuthTokenListener(t)))}notifyForInvalidToken(){let t='Provided authentication credentials for the app named "'+this.appName_+'" are invalid. This usually indicates your app was not initialized correctly. ';"credential"in this.firebaseOptions_?t+='Make sure the "credential" property provided to initializeApp() is authorized to access the specified "databaseURL" and is from the correct project.':"serviceAccount"in this.firebaseOptions_?t+='Make sure the "serviceAccount" property provided to initializeApp() is authorized to access the specified "databaseURL" and is from the correct project.':t+='Make sure the "apiKey" and "databaseURL" properties provided to initializeApp() match the values provided for your app at https://console.firebase.google.com/.',Gu(t)}}class md{constructor(t){this.accessToken=t}getToken(t){return Promise.resolve({accessToken:this.accessToken})}addTokenChangeListener(t){t(this.accessToken)}removeTokenChangeListener(t){}notifyForInvalidToken(){}}md.OWNER="owner";
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
const _d="5",vd="v",yd="s",bd="r",Cd="f",xd=/(console\.firebase|firebase-console-\w+\.corp|firebase\.corp)\.google\.com/,wd="ls",Sd="p",Td="ac",kd="websocket",Od="long_polling";
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
class Ed{constructor(t,e,s,i,n=!1,r="",o=!1,a=!1,l=null){this.secure=e,this.namespace=s,this.webSocketOnly=i,this.nodeAdmin=n,this.persistenceKey=r,this.includeNamespaceInQueryParams=o,this.isUsingEmulator=a,this.emulatorOptions=l,this._host=t.toLowerCase(),this._domain=this._host.substr(this._host.indexOf(".")+1),this.internalHost=Mu.get("host:"+t)||this._host}isCacheableHost(){return"s-"===this.internalHost.substr(0,2)}isCustomHost(){return"firebaseio.com"!==this._domain&&"firebaseio-demo.com"!==this._domain}get host(){return this._host}set host(t){t!==this.internalHost&&(this.internalHost=t,this.isCacheableHost()&&Mu.set("host:"+this._host,this.internalHost))}toString(){let t=this.toURLString();return this.persistenceKey&&(t+="<"+this.persistenceKey+">"),t}toURLString(){const t=this.secure?"https://":"http://",e=this.includeNamespaceInQueryParams?`?ns=${this.namespace}`:"";return`${t}${this.host}/${e}`}}function Dd(t){return t.host!==t.internalHost||t.isCustomHost()||t.includeNamespaceInQueryParams}function Id(t,e,s){let i;if(El("string"===typeof e,"typeof type must == string"),El("object"===typeof s,"typeof params must == object"),e===kd)i=(t.secure?"wss://":"ws://")+t.internalHost+"/.ws?";else{if(e!==Od)throw new Error("Unknown connection type: "+e);i=(t.secure?"https://":"http://")+t.internalHost+"/.lp?"}Dd(t)&&(s["ns"]=t.namespace);const n=[];return id(s,((t,e)=>{n.push(t+"="+e)})),i+n.join("&")}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Pd{constructor(){this.counters_={}}incrementCounter(t,e=1){yh(this.counters_,t)||(this.counters_[t]=0),this.counters_[t]+=e}get(){return jl(this.counters_)}}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Ad={},Md={};function Rd(t){const e=t.toString();return Ad[e]||(Ad[e]=new Pd),Ad[e]}function Ld(t,e){const s=t.toString();return Md[s]||(Md[s]=e()),Md[s]}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Fd{constructor(t){this.onMessage_=t,this.pendingResponses=[],this.currentResponseNum=0,this.closeAfterResponse=-1,this.onClose=null}closeAfter(t,e){this.closeAfterResponse=t,this.onClose=e,this.closeAfterResponse<this.currentResponseNum&&(this.onClose(),this.onClose=null)}handleResponse(t,e){this.pendingResponses[t]=e;while(this.pendingResponses[this.currentResponseNum]){const t=this.pendingResponses[this.currentResponseNum];delete this.pendingResponses[this.currentResponseNum];for(let e=0;e<t.length;++e)t[e]&&ud((()=>{this.onMessage_(t[e])}));if(this.currentResponseNum===this.closeAfterResponse){this.onClose&&(this.onClose(),this.onClose=null);break}this.currentResponseNum++}}}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const jd="start",Nd="close",Bd="pLPCommand",Wd="pRTLPCB",Xd="id",Yd="pw",Vd="ser",Hd="cb",zd="seg",Gd="ts",Ud="d",qd="dframe",Kd=1870,$d=30,Qd=Kd-$d,Jd=25e3,Zd=3e4;class tg{constructor(t,e,s,i,n,r,o){this.connId=t,this.repoInfo=e,this.applicationId=s,this.appCheckToken=i,this.authToken=n,this.transportSessionId=r,this.lastSessionId=o,this.bytesSent=0,this.bytesReceived=0,this.everConnected_=!1,this.log_=Vu(t),this.stats_=Rd(e),this.urlFn=t=>(this.appCheckToken&&(t[Td]=this.appCheckToken),Id(e,Od,t))}open(t,e){this.curSegmentNum=0,this.onDisconnect_=e,this.myPacketOrderer=new Fd(t),this.isClosed_=!1,this.connectTimeoutTimer_=setTimeout((()=>{this.log_("Timed out trying to connect."),this.onClosed_(),this.connectTimeoutTimer_=null}),Math.floor(Zd)),Ku((()=>{if(this.isClosed_)return;this.scriptTagHolder=new eg(((...t)=>{const[e,s,i,n,r]=t;if(this.incrementIncomingBytes_(t),this.scriptTagHolder)if(this.connectTimeoutTimer_&&(clearTimeout(this.connectTimeoutTimer_),this.connectTimeoutTimer_=null),this.everConnected_=!0,e===jd)this.id=s,this.password=i;else{if(e!==Nd)throw new Error("Unrecognized command received: "+e);s?(this.scriptTagHolder.sendNewPolls=!1,this.myPacketOrderer.closeAfter(s,(()=>{this.onClosed_()}))):this.onClosed_()}}),((...t)=>{const[e,s]=t;this.incrementIncomingBytes_(t),this.myPacketOrderer.handleResponse(e,s)}),(()=>{this.onClosed_()}),this.urlFn);const t={};t[jd]="t",t[Vd]=Math.floor(1e8*Math.random()),this.scriptTagHolder.uniqueCallbackIdentifier&&(t[Hd]=this.scriptTagHolder.uniqueCallbackIdentifier),t[vd]=_d,this.transportSessionId&&(t[yd]=this.transportSessionId),this.lastSessionId&&(t[wd]=this.lastSessionId),this.applicationId&&(t[Sd]=this.applicationId),this.appCheckToken&&(t[Td]=this.appCheckToken),"undefined"!==typeof location&&location.hostname&&xd.test(location.hostname)&&(t[bd]=Cd);const e=this.urlFn(t);this.log_("Connecting via long-poll to "+e),this.scriptTagHolder.addTag(e,(()=>{}))}))}start(){this.scriptTagHolder.startLongPoll(this.id,this.password),this.addDisconnectPingFrame(this.id,this.password)}static forceAllow(){tg.forceAllow_=!0}static forceDisallow(){tg.forceDisallow_=!0}static isAvailable(){return!oh()&&(!!tg.forceAllow_||!tg.forceDisallow_&&"undefined"!==typeof document&&null!=document.createElement&&!rd()&&!od())}markConnectionHealthy(){}shutdown_(){this.isClosed_=!0,this.scriptTagHolder&&(this.scriptTagHolder.close(),this.scriptTagHolder=null),this.myDisconnFrame&&(document.body.removeChild(this.myDisconnFrame),this.myDisconnFrame=null),this.connectTimeoutTimer_&&(clearTimeout(this.connectTimeoutTimer_),this.connectTimeoutTimer_=null)}onClosed_(){this.isClosed_||(this.log_("Longpoll is closing itself"),this.shutdown_(),this.onDisconnect_&&(this.onDisconnect_(this.everConnected_),this.onDisconnect_=null))}close(){this.isClosed_||(this.log_("Longpoll is being closed."),this.shutdown_())}send(t){const e=fh(t);this.bytesSent+=e.length,this.stats_.incrementCounter("bytes_sent",e.length);const s=Rl(e),i=sd(s,Qd);for(let n=0;n<i.length;n++)this.scriptTagHolder.enqueueSegment(this.curSegmentNum,i.length,i[n]),this.curSegmentNum++}addDisconnectPingFrame(t,e){if(oh())return;this.myDisconnFrame=document.createElement("iframe");const s={};s[qd]="t",s[Xd]=t,s[Yd]=e,this.myDisconnFrame.src=this.urlFn(s),this.myDisconnFrame.style.display="none",document.body.appendChild(this.myDisconnFrame)}incrementIncomingBytes_(t){const e=fh(t).length;this.bytesReceived+=e,this.stats_.incrementCounter("bytes_received",e)}}class eg{constructor(t,e,s,i){if(this.onDisconnect=s,this.urlFn=i,this.outstandingRequests=new Set,this.pendingSegs=[],this.currentSerial=Math.floor(1e8*Math.random()),this.sendNewPolls=!0,oh())this.commandCB=t,this.onMessageCB=e;else{this.uniqueCallbackIdentifier=Fu(),window[Bd+this.uniqueCallbackIdentifier]=t,window[Wd+this.uniqueCallbackIdentifier]=e,this.myIFrame=eg.createIFrame_();let s="";if(this.myIFrame.src&&"javascript:"===this.myIFrame.src.substr(0,11)){const t=document.domain;s='<script>document.domain="'+t+'";<\/script>'}const i="<html><body>"+s+"</body></html>";try{this.myIFrame.doc.open(),this.myIFrame.doc.write(i),this.myIFrame.doc.close()}catch(h){Yu("frame writing exception"),h.stack&&Yu(h.stack),Yu(h)}}}static createIFrame_(){const t=document.createElement("iframe");if(t.style.display="none",!document.body)throw"Document body has not initialized. Wait to initialize Firebase until after the document is ready.";document.body.appendChild(t);try{const e=t.contentWindow.document;e||Yu("No IE domain setting required")}catch(h){const s=document.domain;t.src="javascript:void((function(){document.open();document.domain='"+s+"';document.close();})())"}return t.contentDocument?t.doc=t.contentDocument:t.contentWindow?t.doc=t.contentWindow.document:t.document&&(t.doc=t.document),t}close(){this.alive=!1,this.myIFrame&&(this.myIFrame.doc.body.textContent="",setTimeout((()=>{null!==this.myIFrame&&(document.body.removeChild(this.myIFrame),this.myIFrame=null)}),Math.floor(0)));const t=this.onDisconnect;t&&(this.onDisconnect=null,t())}startLongPoll(t,e){this.myID=t,this.myPW=e,this.alive=!0;while(this.newRequest_());}newRequest_(){if(this.alive&&this.sendNewPolls&&this.outstandingRequests.size<(this.pendingSegs.length>0?2:1)){this.currentSerial++;const t={};t[Xd]=this.myID,t[Yd]=this.myPW,t[Vd]=this.currentSerial;let e=this.urlFn(t),s="",i=0;while(this.pendingSegs.length>0){const t=this.pendingSegs[0];if(!(t.d.length+$d+s.length<=Kd))break;{const t=this.pendingSegs.shift();s=s+"&"+zd+i+"="+t.seg+"&"+Gd+i+"="+t.ts+"&"+Ud+i+"="+t.d,i++}}return e+=s,this.addLongPollTag_(e,this.currentSerial),!0}return!1}enqueueSegment(t,e,s){this.pendingSegs.push({seg:t,ts:e,d:s}),this.alive&&this.newRequest_()}addLongPollTag_(t,e){this.outstandingRequests.add(e);const s=()=>{this.outstandingRequests.delete(e),this.newRequest_()},i=setTimeout(s,Math.floor(Jd)),n=()=>{clearTimeout(i),s()};this.addTag(t,n)}addTag(t,e){oh()?this.doNodeLongPoll(t,e):setTimeout((()=>{try{if(!this.sendNewPolls)return;const s=this.myIFrame.doc.createElement("script");s.type="text/javascript",s.async=!0,s.src=t,s.onload=s.onreadystatechange=function(){const t=s.readyState;t&&"loaded"!==t&&"complete"!==t||(s.onload=s.onreadystatechange=null,s.parentNode&&s.parentNode.removeChild(s),e())},s.onerror=()=>{Yu("Long-poll script failed to load: "+t),this.sendNewPolls=!1,this.close()},this.myIFrame.doc.body.appendChild(s)}catch(h){}}),Math.floor(1))}}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const sg=16384,ig=45e3;let ng=null;"undefined"!==typeof MozWebSocket?ng=MozWebSocket:"undefined"!==typeof WebSocket&&(ng=WebSocket);class rg{constructor(t,e,s,i,n,r,o){this.connId=t,this.applicationId=s,this.appCheckToken=i,this.authToken=n,this.keepaliveTimer=null,this.frames=null,this.totalFrames=0,this.bytesSent=0,this.bytesReceived=0,this.log_=Vu(this.connId),this.stats_=Rd(e),this.connURL=rg.connectionURL_(e,r,o,i,s),this.nodeAdmin=e.nodeAdmin}static connectionURL_(t,e,s,i,n){const r={};return r[vd]=_d,!oh()&&"undefined"!==typeof location&&location.hostname&&xd.test(location.hostname)&&(r[bd]=Cd),e&&(r[yd]=e),s&&(r[wd]=s),i&&(r[Td]=i),n&&(r[Sd]=n),Id(t,kd,r)}open(t,e){this.onDisconnect=e,this.onMessage=t,this.log_("Websocket connecting to "+this.connURL),this.everConnected_=!1,Mu.set("previous_websocket_failure",!0);try{let t;if(oh()){const e=this.nodeAdmin?"AdminNode":"Node";t={headers:{"User-Agent":`Firebase/${_d}/${Eu}/${process.platform}/${e}`,"X-Firebase-GMPID":this.applicationId||""}},this.authToken&&(t.headers["Authorization"]=`Bearer ${this.authToken}`),this.appCheckToken&&(t.headers["X-Firebase-AppCheck"]=this.appCheckToken);const s={NODE_ENV:"production",BASE_URL:"/alien_mood/"},i=0===this.connURL.indexOf("wss://")?s["HTTPS_PROXY"]||s["https_proxy"]:s["HTTP_PROXY"]||s["http_proxy"];i&&(t["proxy"]={origin:i})}this.mySock=new ng(this.connURL,[],t)}catch(h){this.log_("Error instantiating WebSocket.");const e=h.message||h.data;return e&&this.log_(e),void this.onClosed_()}this.mySock.onopen=()=>{this.log_("Websocket connected."),this.everConnected_=!0},this.mySock.onclose=()=>{this.log_("Websocket connection was disconnected."),this.mySock=null,this.onClosed_()},this.mySock.onmessage=t=>{this.handleIncomingFrame(t)},this.mySock.onerror=t=>{this.log_("WebSocket error.  Closing connection.");const e=t.message||t.data;e&&this.log_(e),this.onClosed_()}}start(){}static forceDisallow(){rg.forceDisallow_=!0}static isAvailable(){let t=!1;if("undefined"!==typeof navigator&&navigator.userAgent){const e=/Android ([0-9]{0,}\.[0-9]{0,})/,s=navigator.userAgent.match(e);s&&s.length>1&&parseFloat(s[1])<4.4&&(t=!0)}return!t&&null!==ng&&!rg.forceDisallow_}static previouslyFailed(){return Mu.isInMemoryStorage||!0===Mu.get("previous_websocket_failure")}markConnectionHealthy(){Mu.remove("previous_websocket_failure")}appendFrame_(t){if(this.frames.push(t),this.frames.length===this.totalFrames){const t=this.frames.join("");this.frames=null;const e=ph(t);this.onMessage(e)}}handleNewFrameCount_(t){this.totalFrames=t,this.frames=[]}extractFrameCount_(t){if(El(null===this.frames,"We already have a frame buffer"),t.length<=6){const e=Number(t);if(!isNaN(e))return this.handleNewFrameCount_(e),null}return this.handleNewFrameCount_(1),t}handleIncomingFrame(t){if(null===this.mySock)return;const e=t["data"];if(this.bytesReceived+=e.length,this.stats_.incrementCounter("bytes_received",e.length),this.resetKeepAlive(),null!==this.frames)this.appendFrame_(e);else{const t=this.extractFrameCount_(e);null!==t&&this.appendFrame_(t)}}send(t){this.resetKeepAlive();const e=fh(t);this.bytesSent+=e.length,this.stats_.incrementCounter("bytes_sent",e.length);const s=sd(e,sg);s.length>1&&this.sendString_(String(s.length));for(let i=0;i<s.length;i++)this.sendString_(s[i])}shutdown_(){this.isClosed_=!0,this.keepaliveTimer&&(clearInterval(this.keepaliveTimer),this.keepaliveTimer=null),this.mySock&&(this.mySock.close(),this.mySock=null)}onClosed_(){this.isClosed_||(this.log_("WebSocket is closing itself"),this.shutdown_(),this.onDisconnect&&(this.onDisconnect(this.everConnected_),this.onDisconnect=null))}close(){this.isClosed_||(this.log_("WebSocket is being closed"),this.shutdown_())}resetKeepAlive(){clearInterval(this.keepaliveTimer),this.keepaliveTimer=setInterval((()=>{this.mySock&&this.sendString_("0"),this.resetKeepAlive()}),Math.floor(ig))}sendString_(t){try{this.mySock.send(t)}catch(h){this.log_("Exception thrown from WebSocket.send():",h.message||h.data,"Closing connection."),setTimeout(this.onClosed_.bind(this),0)}}}rg.responsesRequiredToBeHealthy=2,rg.healthyTimeout=3e4;
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
class og{static get ALL_TRANSPORTS(){return[tg,rg]}static get IS_TRANSPORT_INITIALIZED(){return this.globalTransportInitialized_}constructor(t){this.initTransports_(t)}initTransports_(t){const e=rg&&rg["isAvailable"]();let s=e&&!rg.previouslyFailed();if(t.webSocketOnly&&(e||Gu("wss:// URL used, but browser isn't known to support websockets.  Trying anyway."),s=!0),s)this.transports_=[rg];else{const t=this.transports_=[];for(const e of og.ALL_TRANSPORTS)e&&e["isAvailable"]()&&t.push(e);og.globalTransportInitialized_=!0}}initialTransport(){if(this.transports_.length>0)return this.transports_[0];throw new Error("No transports available")}upgradeTransport(){return this.transports_.length>1?this.transports_[1]:null}}og.globalTransportInitialized_=!1;
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
const ag=6e4,lg=5e3,hg=10240,cg=102400,ug="t",dg="d",gg="s",pg="r",fg="e",mg="o",_g="a",vg="n",yg="p",bg="h";class Cg{constructor(t,e,s,i,n,r,o,a,l,h){this.id=t,this.repoInfo_=e,this.applicationId_=s,this.appCheckToken_=i,this.authToken_=n,this.onMessage_=r,this.onReady_=o,this.onDisconnect_=a,this.onKill_=l,this.lastSessionId=h,this.connectionCount=0,this.pendingDataMessages=[],this.state_=0,this.log_=Vu("c:"+this.id+":"),this.transportManager_=new og(e),this.log_("Connection created"),this.start_()}start_(){const t=this.transportManager_.initialTransport();this.conn_=new t(this.nextTransportId_(),this.repoInfo_,this.applicationId_,this.appCheckToken_,this.authToken_,null,this.lastSessionId),this.primaryResponsesRequired_=t["responsesRequiredToBeHealthy"]||0;const e=this.connReceiver_(this.conn_),s=this.disconnReceiver_(this.conn_);this.tx_=this.conn_,this.rx_=this.conn_,this.secondaryConn_=null,this.isHealthy_=!1,setTimeout((()=>{this.conn_&&this.conn_.open(e,s)}),Math.floor(0));const i=t["healthyTimeout"]||0;i>0&&(this.healthyTimeout_=gd((()=>{this.healthyTimeout_=null,this.isHealthy_||(this.conn_&&this.conn_.bytesReceived>cg?(this.log_("Connection exceeded healthy timeout but has received "+this.conn_.bytesReceived+" bytes.  Marking connection healthy."),this.isHealthy_=!0,this.conn_.markConnectionHealthy()):this.conn_&&this.conn_.bytesSent>hg?this.log_("Connection exceeded healthy timeout but has sent "+this.conn_.bytesSent+" bytes.  Leaving connection alive."):(this.log_("Closing unhealthy connection after timeout."),this.close()))}),Math.floor(i)))}nextTransportId_(){return"c:"+this.id+":"+this.connectionCount++}disconnReceiver_(t){return e=>{t===this.conn_?this.onConnectionLost_(e):t===this.secondaryConn_?(this.log_("Secondary connection lost."),this.onSecondaryConnectionLost_()):this.log_("closing an old connection")}}connReceiver_(t){return e=>{2!==this.state_&&(t===this.rx_?this.onPrimaryMessageReceived_(e):t===this.secondaryConn_?this.onSecondaryMessageReceived_(e):this.log_("message on old connection"))}}sendRequest(t){const e={t:"d",d:t};this.sendData_(e)}tryCleanupConnection(){this.tx_===this.secondaryConn_&&this.rx_===this.secondaryConn_&&(this.log_("cleaning up and promoting a connection: "+this.secondaryConn_.connId),this.conn_=this.secondaryConn_,this.secondaryConn_=null)}onSecondaryControl_(t){if(ug in t){const e=t[ug];e===_g?this.upgradeIfSecondaryHealthy_():e===pg?(this.log_("Got a reset on secondary, closing it"),this.secondaryConn_.close(),this.tx_!==this.secondaryConn_&&this.rx_!==this.secondaryConn_||this.close()):e===mg&&(this.log_("got pong on secondary."),this.secondaryResponsesRequired_--,this.upgradeIfSecondaryHealthy_())}}onSecondaryMessageReceived_(t){const e=td("t",t),s=td("d",t);if("c"===e)this.onSecondaryControl_(s);else{if("d"!==e)throw new Error("Unknown protocol layer: "+e);this.pendingDataMessages.push(s)}}upgradeIfSecondaryHealthy_(){this.secondaryResponsesRequired_<=0?(this.log_("Secondary connection is healthy."),this.isHealthy_=!0,this.secondaryConn_.markConnectionHealthy(),this.proceedWithUpgrade_()):(this.log_("sending ping on secondary."),this.secondaryConn_.send({t:"c",d:{t:yg,d:{}}}))}proceedWithUpgrade_(){this.secondaryConn_.start(),this.log_("sending client ack on secondary"),this.secondaryConn_.send({t:"c",d:{t:_g,d:{}}}),this.log_("Ending transmission on primary"),this.conn_.send({t:"c",d:{t:vg,d:{}}}),this.tx_=this.secondaryConn_,this.tryCleanupConnection()}onPrimaryMessageReceived_(t){const e=td("t",t),s=td("d",t);"c"===e?this.onControl_(s):"d"===e&&this.onDataMessage_(s)}onDataMessage_(t){this.onPrimaryResponse_(),this.onMessage_(t)}onPrimaryResponse_(){this.isHealthy_||(this.primaryResponsesRequired_--,this.primaryResponsesRequired_<=0&&(this.log_("Primary connection is healthy."),this.isHealthy_=!0,this.conn_.markConnectionHealthy()))}onControl_(t){const e=td(ug,t);if(dg in t){const s=t[dg];if(e===bg){const t=Object.assign({},s);this.repoInfo_.isUsingEmulator&&(t.h=this.repoInfo_.host),this.onHandshake_(t)}else if(e===vg){this.log_("recvd end transmission on primary"),this.rx_=this.secondaryConn_;for(let t=0;t<this.pendingDataMessages.length;++t)this.onDataMessage_(this.pendingDataMessages[t]);this.pendingDataMessages=[],this.tryCleanupConnection()}else e===gg?this.onConnectionShutdown_(s):e===pg?this.onReset_(s):e===fg?Hu("Server Error: "+s):e===mg?(this.log_("got pong on primary."),this.onPrimaryResponse_(),this.sendPingOnPrimaryIfNecessary_()):Hu("Unknown control packet command: "+e)}}onHandshake_(t){const e=t.ts,s=t.v,i=t.h;this.sessionId=t.s,this.repoInfo_.host=i,0===this.state_&&(this.conn_.start(),this.onConnectionEstablished_(this.conn_,e),_d!==s&&Gu("Protocol version mismatch detected"),this.tryStartUpgrade_())}tryStartUpgrade_(){const t=this.transportManager_.upgradeTransport();t&&this.startUpgrade_(t)}startUpgrade_(t){this.secondaryConn_=new t(this.nextTransportId_(),this.repoInfo_,this.applicationId_,this.appCheckToken_,this.authToken_,this.sessionId),this.secondaryResponsesRequired_=t["responsesRequiredToBeHealthy"]||0;const e=this.connReceiver_(this.secondaryConn_),s=this.disconnReceiver_(this.secondaryConn_);this.secondaryConn_.open(e,s),gd((()=>{this.secondaryConn_&&(this.log_("Timed out trying to upgrade."),this.secondaryConn_.close())}),Math.floor(ag))}onReset_(t){this.log_("Reset packet received.  New host: "+t),this.repoInfo_.host=t,1===this.state_?this.close():(this.closeConnections_(),this.start_())}onConnectionEstablished_(t,e){this.log_("Realtime connection established."),this.conn_=t,this.state_=1,this.onReady_&&(this.onReady_(e,this.sessionId),this.onReady_=null),0===this.primaryResponsesRequired_?(this.log_("Primary connection is healthy."),this.isHealthy_=!0):gd((()=>{this.sendPingOnPrimaryIfNecessary_()}),Math.floor(lg))}sendPingOnPrimaryIfNecessary_(){this.isHealthy_||1!==this.state_||(this.log_("sending ping on primary."),this.sendData_({t:"c",d:{t:yg,d:{}}}))}onSecondaryConnectionLost_(){const t=this.secondaryConn_;this.secondaryConn_=null,this.tx_!==t&&this.rx_!==t||this.close()}onConnectionLost_(t){this.conn_=null,t||0!==this.state_?1===this.state_&&this.log_("Realtime connection lost."):(this.log_("Realtime connection failed."),this.repoInfo_.isCacheableHost()&&(Mu.remove("host:"+this.repoInfo_.host),this.repoInfo_.internalHost=this.repoInfo_.host)),this.close()}onConnectionShutdown_(t){this.log_("Connection shutdown command received. Shutting down..."),this.onKill_&&(this.onKill_(t),this.onKill_=null),this.onDisconnect_=null,this.close()}sendData_(t){if(1!==this.state_)throw"Connection is not connected";this.tx_.send(t)}close(){2!==this.state_&&(this.log_("Closing realtime connection."),this.state_=2,this.closeConnections_(),this.onDisconnect_&&(this.onDisconnect_(),this.onDisconnect_=null))}closeConnections_(){this.log_("Shutting down all connections"),this.conn_&&(this.conn_.close(),this.conn_=null),this.secondaryConn_&&(this.secondaryConn_.close(),this.secondaryConn_=null),this.healthyTimeout_&&(clearTimeout(this.healthyTimeout_),this.healthyTimeout_=null)}}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class xg{put(t,e,s,i){}merge(t,e,s,i){}refreshAuthToken(t){}refreshAppCheckToken(t){}onDisconnectPut(t,e,s){}onDisconnectMerge(t,e,s){}onDisconnectCancel(t,e){}reportStats(t){}}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class wg{constructor(t){this.allowedEvents_=t,this.listeners_={},El(Array.isArray(t)&&t.length>0,"Requires a non-empty array")}trigger(t,...e){if(Array.isArray(this.listeners_[t])){const s=[...this.listeners_[t]];for(let t=0;t<s.length;t++)s[t].callback.apply(s[t].context,e)}}on(t,e,s){this.validateEventType_(t),this.listeners_[t]=this.listeners_[t]||[],this.listeners_[t].push({callback:e,context:s});const i=this.getInitialEvent(t);i&&e.apply(s,i)}off(t,e,s){this.validateEventType_(t);const i=this.listeners_[t]||[];for(let n=0;n<i.length;n++)if(i[n].callback===e&&(!s||s===i[n].context))return void i.splice(n,1)}validateEventType_(t){El(this.allowedEvents_.find((e=>e===t)),"Unknown event: "+t)}}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Sg extends wg{static getInstance(){return new Sg}constructor(){super(["online"]),this.online_=!0,"undefined"===typeof window||"undefined"===typeof window.addEventListener||nh()||(window.addEventListener("online",(()=>{this.online_||(this.online_=!0,this.trigger("online",!0))}),!1),window.addEventListener("offline",(()=>{this.online_&&(this.online_=!1,this.trigger("online",!1))}),!1))}getInitialEvent(t){return El("online"===t,"Unknown event type: "+t),[this.online_]}currentlyOnline(){return this.online_}}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Tg=32,kg=768;class Og{constructor(t,e){if(void 0===e){this.pieces_=t.split("/");let e=0;for(let t=0;t<this.pieces_.length;t++)this.pieces_[t].length>0&&(this.pieces_[e]=this.pieces_[t],e++);this.pieces_.length=e,this.pieceNum_=0}else this.pieces_=t,this.pieceNum_=e}toString(){let t="";for(let e=this.pieceNum_;e<this.pieces_.length;e++)""!==this.pieces_[e]&&(t+="/"+this.pieces_[e]);return t||"/"}}function Eg(){return new Og("")}function Dg(t){return t.pieceNum_>=t.pieces_.length?null:t.pieces_[t.pieceNum_]}function Ig(t){return t.pieces_.length-t.pieceNum_}function Pg(t){let e=t.pieceNum_;return e<t.pieces_.length&&e++,new Og(t.pieces_,e)}function Ag(t){return t.pieceNum_<t.pieces_.length?t.pieces_[t.pieces_.length-1]:null}function Mg(t){let e="";for(let s=t.pieceNum_;s<t.pieces_.length;s++)""!==t.pieces_[s]&&(e+="/"+encodeURIComponent(String(t.pieces_[s])));return e||"/"}function Rg(t,e=0){return t.pieces_.slice(t.pieceNum_+e)}function Lg(t){if(t.pieceNum_>=t.pieces_.length)return null;const e=[];for(let s=t.pieceNum_;s<t.pieces_.length-1;s++)e.push(t.pieces_[s]);return new Og(e,0)}function Fg(t,e){const s=[];for(let i=t.pieceNum_;i<t.pieces_.length;i++)s.push(t.pieces_[i]);if(e instanceof Og)for(let i=e.pieceNum_;i<e.pieces_.length;i++)s.push(e.pieces_[i]);else{const t=e.split("/");for(let e=0;e<t.length;e++)t[e].length>0&&s.push(t[e])}return new Og(s,0)}function jg(t){return t.pieceNum_>=t.pieces_.length}function Ng(t,e){const s=Dg(t),i=Dg(e);if(null===s)return e;if(s===i)return Ng(Pg(t),Pg(e));throw new Error("INTERNAL ERROR: innerPath ("+e+") is not within outerPath ("+t+")")}function Bg(t,e){if(Ig(t)!==Ig(e))return!1;for(let s=t.pieceNum_,i=e.pieceNum_;s<=t.pieces_.length;s++,i++)if(t.pieces_[s]!==e.pieces_[i])return!1;return!0}function Wg(t,e){let s=t.pieceNum_,i=e.pieceNum_;if(Ig(t)>Ig(e))return!1;while(s<t.pieces_.length){if(t.pieces_[s]!==e.pieces_[i])return!1;++s,++i}return!0}class Xg{constructor(t,e){this.errorPrefix_=e,this.parts_=Rg(t,0),this.byteLength_=Math.max(1,this.parts_.length);for(let s=0;s<this.parts_.length;s++)this.byteLength_+=Dh(this.parts_[s]);Hg(this)}}function Yg(t,e){t.parts_.length>0&&(t.byteLength_+=1),t.parts_.push(e),t.byteLength_+=Dh(e),Hg(t)}function Vg(t){const e=t.parts_.pop();t.byteLength_-=Dh(e),t.parts_.length>0&&(t.byteLength_-=1)}function Hg(t){if(t.byteLength_>kg)throw new Error(t.errorPrefix_+"has a key path longer than "+kg+" bytes ("+t.byteLength_+").");if(t.parts_.length>Tg)throw new Error(t.errorPrefix_+"path specified exceeds the maximum depth that can be written ("+Tg+") or object contains a cycle "+zg(t))}function zg(t){return 0===t.parts_.length?"":"in property '"+t.parts_.join(".")+"'"}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Gg extends wg{static getInstance(){return new Gg}constructor(){let t,e;super(["visible"]),"undefined"!==typeof document&&"undefined"!==typeof document.addEventListener&&("undefined"!==typeof document["hidden"]?(e="visibilitychange",t="hidden"):"undefined"!==typeof document["mozHidden"]?(e="mozvisibilitychange",t="mozHidden"):"undefined"!==typeof document["msHidden"]?(e="msvisibilitychange",t="msHidden"):"undefined"!==typeof document["webkitHidden"]&&(e="webkitvisibilitychange",t="webkitHidden")),this.visible_=!0,e&&document.addEventListener(e,(()=>{const e=!document[t];e!==this.visible_&&(this.visible_=e,this.trigger("visible",e))}),!1)}getInitialEvent(t){return El("visible"===t,"Unknown event type: "+t),[this.visible_]}}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Ug=1e3,qg=3e5,Kg=3e4,$g=1.3,Qg=3e4,Jg="server_kill",Zg=3;class tp extends xg{constructor(t,e,s,i,n,r,o,a){if(super(),this.repoInfo_=t,this.applicationId_=e,this.onDataUpdate_=s,this.onConnectStatus_=i,this.onServerInfoUpdate_=n,this.authTokenProvider_=r,this.appCheckTokenProvider_=o,this.authOverride_=a,this.id=tp.nextPersistentConnectionId_++,this.log_=Vu("p:"+this.id+":"),this.interruptReasons_={},this.listens=new Map,this.outstandingPuts_=[],this.outstandingGets_=[],this.outstandingPutCount_=0,this.outstandingGetCount_=0,this.onDisconnectRequestQueue_=[],this.connected_=!1,this.reconnectDelay_=Ug,this.maxReconnectDelay_=qg,this.securityDebugCallback_=null,this.lastSessionId=null,this.establishConnectionTimer_=null,this.visible_=!1,this.requestCBHash_={},this.requestNumber_=0,this.realtime_=null,this.authToken_=null,this.appCheckToken_=null,this.forceTokenRefresh_=!1,this.invalidAuthTokenCount_=0,this.invalidAppCheckTokenCount_=0,this.firstConnection_=!0,this.lastConnectionAttemptTime_=null,this.lastConnectionEstablishedTime_=null,a&&!oh())throw new Error("Auth override specified in options, but not supported on non Node.js platforms");Gg.getInstance().on("visible",this.onVisible_,this),-1===t.host.indexOf("fblocal")&&Sg.getInstance().on("online",this.onOnline_,this)}sendRequest(t,e,s){const i=++this.requestNumber_,n={r:i,a:t,b:e};this.log_(fh(n)),El(this.connected_,"sendRequest call when we're not connected not allowed."),this.realtime_.sendRequest(n),s&&(this.requestCBHash_[i]=s)}get(t){this.initConnection_();const e=new ql,s={p:t._path.toString(),q:t._queryObject},i={action:"g",request:s,onComplete:t=>{const s=t["d"];"ok"===t["s"]?e.resolve(s):e.reject(s)}};this.outstandingGets_.push(i),this.outstandingGetCount_++;const n=this.outstandingGets_.length-1;return this.connected_&&this.sendGet_(n),e.promise}listen(t,e,s,i){this.initConnection_();const n=t._queryIdentifier,r=t._path.toString();this.log_("Listen called for "+r+" "+n),this.listens.has(r)||this.listens.set(r,new Map),El(t._queryParams.isDefault()||!t._queryParams.loadsAllData(),"listen() called for non-default but complete query"),El(!this.listens.get(r).has(n),"listen() called twice for same path/queryId.");const o={onComplete:i,hashFn:e,query:t,tag:s};this.listens.get(r).set(n,o),this.connected_&&this.sendListen_(o)}sendGet_(t){const e=this.outstandingGets_[t];this.sendRequest("g",e.request,(s=>{delete this.outstandingGets_[t],this.outstandingGetCount_--,0===this.outstandingGetCount_&&(this.outstandingGets_=[]),e.onComplete&&e.onComplete(s)}))}sendListen_(t){const e=t.query,s=e._path.toString(),i=e._queryIdentifier;this.log_("Listen on "+s+" for "+i);const n={p:s},r="q";t.tag&&(n["q"]=e._queryObject,n["t"]=t.tag),n["h"]=t.hashFn(),this.sendRequest(r,n,(n=>{const r=n["d"],o=n["s"];tp.warnOnListenWarnings_(r,e);const a=this.listens.get(s)&&this.listens.get(s).get(i);a===t&&(this.log_("listen response",n),"ok"!==o&&this.removeListen_(s,i),t.onComplete&&t.onComplete(o,r))}))}static warnOnListenWarnings_(t,e){if(t&&"object"===typeof t&&yh(t,"w")){const s=bh(t,"w");if(Array.isArray(s)&&~s.indexOf("no_index")){const t='".indexOn": "'+e._queryParams.getIndex().toString()+'"',s=e._path.toString();Gu(`Using an unspecified index. Your data will be downloaded and filtered on the client. Consider adding ${t} at ${s} to your security rules for better performance.`)}}}refreshAuthToken(t){this.authToken_=t,this.log_("Auth token refreshed"),this.authToken_?this.tryAuth():this.connected_&&this.sendRequest("unauth",{},(()=>{})),this.reduceReconnectDelayIfAdminCredential_(t)}reduceReconnectDelayIfAdminCredential_(t){const e=t&&40===t.length;(e||vh(t))&&(this.log_("Admin auth credential detected.  Reducing max reconnect time."),this.maxReconnectDelay_=Kg)}refreshAppCheckToken(t){this.appCheckToken_=t,this.log_("App check token refreshed"),this.appCheckToken_?this.tryAppCheck():this.connected_&&this.sendRequest("unappeck",{},(()=>{}))}tryAuth(){if(this.connected_&&this.authToken_){const t=this.authToken_,e=_h(t)?"auth":"gauth",s={cred:t};null===this.authOverride_?s["noauth"]=!0:"object"===typeof this.authOverride_&&(s["authvar"]=this.authOverride_),this.sendRequest(e,s,(e=>{const s=e["s"],i=e["d"]||"error";this.authToken_===t&&("ok"===s?this.invalidAuthTokenCount_=0:this.onAuthRevoked_(s,i))}))}}tryAppCheck(){this.connected_&&this.appCheckToken_&&this.sendRequest("appcheck",{token:this.appCheckToken_},(t=>{const e=t["s"],s=t["d"]||"error";"ok"===e?this.invalidAppCheckTokenCount_=0:this.onAppCheckRevoked_(e,s)}))}unlisten(t,e){const s=t._path.toString(),i=t._queryIdentifier;this.log_("Unlisten called for "+s+" "+i),El(t._queryParams.isDefault()||!t._queryParams.loadsAllData(),"unlisten() called for non-default but complete query");const n=this.removeListen_(s,i);n&&this.connected_&&this.sendUnlisten_(s,i,t._queryObject,e)}sendUnlisten_(t,e,s,i){this.log_("Unlisten on "+t+" for "+e);const n={p:t},r="n";i&&(n["q"]=s,n["t"]=i),this.sendRequest(r,n)}onDisconnectPut(t,e,s){this.initConnection_(),this.connected_?this.sendOnDisconnect_("o",t,e,s):this.onDisconnectRequestQueue_.push({pathString:t,action:"o",data:e,onComplete:s})}onDisconnectMerge(t,e,s){this.initConnection_(),this.connected_?this.sendOnDisconnect_("om",t,e,s):this.onDisconnectRequestQueue_.push({pathString:t,action:"om",data:e,onComplete:s})}onDisconnectCancel(t,e){this.initConnection_(),this.connected_?this.sendOnDisconnect_("oc",t,null,e):this.onDisconnectRequestQueue_.push({pathString:t,action:"oc",data:null,onComplete:e})}sendOnDisconnect_(t,e,s,i){const n={p:e,d:s};this.log_("onDisconnect "+t,n),this.sendRequest(t,n,(t=>{i&&setTimeout((()=>{i(t["s"],t["d"])}),Math.floor(0))}))}put(t,e,s,i){this.putInternal("p",t,e,s,i)}merge(t,e,s,i){this.putInternal("m",t,e,s,i)}putInternal(t,e,s,i,n){this.initConnection_();const r={p:e,d:s};void 0!==n&&(r["h"]=n),this.outstandingPuts_.push({action:t,request:r,onComplete:i}),this.outstandingPutCount_++;const o=this.outstandingPuts_.length-1;this.connected_?this.sendPut_(o):this.log_("Buffering put: "+e)}sendPut_(t){const e=this.outstandingPuts_[t].action,s=this.outstandingPuts_[t].request,i=this.outstandingPuts_[t].onComplete;this.outstandingPuts_[t].queued=this.connected_,this.sendRequest(e,s,(s=>{this.log_(e+" response",s),delete this.outstandingPuts_[t],this.outstandingPutCount_--,0===this.outstandingPutCount_&&(this.outstandingPuts_=[]),i&&i(s["s"],s["d"])}))}reportStats(t){if(this.connected_){const e={c:t};this.log_("reportStats",e),this.sendRequest("s",e,(t=>{const e=t["s"];if("ok"!==e){const e=t["d"];this.log_("reportStats","Error sending stats: "+e)}}))}}onDataMessage_(t){if("r"in t){this.log_("from server: "+fh(t));const e=t["r"],s=this.requestCBHash_[e];s&&(delete this.requestCBHash_[e],s(t["b"]))}else{if("error"in t)throw"A server-side error has occurred: "+t["error"];"a"in t&&this.onDataPush_(t["a"],t["b"])}}onDataPush_(t,e){this.log_("handleServerMessage",t,e),"d"===t?this.onDataUpdate_(e["p"],e["d"],!1,e["t"]):"m"===t?this.onDataUpdate_(e["p"],e["d"],!0,e["t"]):"c"===t?this.onListenRevoked_(e["p"],e["q"]):"ac"===t?this.onAuthRevoked_(e["s"],e["d"]):"apc"===t?this.onAppCheckRevoked_(e["s"],e["d"]):"sd"===t?this.onSecurityDebugPacket_(e):Hu("Unrecognized action received from server: "+fh(t)+"\nAre you using the latest client?")}onReady_(t,e){this.log_("connection ready"),this.connected_=!0,this.lastConnectionEstablishedTime_=(new Date).getTime(),this.handleTimestamp_(t),this.lastSessionId=e,this.firstConnection_&&this.sendConnectStats_(),this.restoreState_(),this.firstConnection_=!1,this.onConnectStatus_(!0)}scheduleConnect_(t){El(!this.realtime_,"Scheduling a connect when we're already connected/ing?"),this.establishConnectionTimer_&&clearTimeout(this.establishConnectionTimer_),this.establishConnectionTimer_=setTimeout((()=>{this.establishConnectionTimer_=null,this.establishConnection_()}),Math.floor(t))}initConnection_(){!this.realtime_&&this.firstConnection_&&this.scheduleConnect_(0)}onVisible_(t){t&&!this.visible_&&this.reconnectDelay_===this.maxReconnectDelay_&&(this.log_("Window became visible.  Reducing delay."),this.reconnectDelay_=Ug,this.realtime_||this.scheduleConnect_(0)),this.visible_=t}onOnline_(t){t?(this.log_("Browser went online."),this.reconnectDelay_=Ug,this.realtime_||this.scheduleConnect_(0)):(this.log_("Browser went offline.  Killing connection."),this.realtime_&&this.realtime_.close())}onRealtimeDisconnect_(){if(this.log_("data client disconnected"),this.connected_=!1,this.realtime_=null,this.cancelSentTransactions_(),this.requestCBHash_={},this.shouldReconnect_()){if(this.visible_){if(this.lastConnectionEstablishedTime_){const t=(new Date).getTime()-this.lastConnectionEstablishedTime_;t>Qg&&(this.reconnectDelay_=Ug),this.lastConnectionEstablishedTime_=null}}else this.log_("Window isn't visible.  Delaying reconnect."),this.reconnectDelay_=this.maxReconnectDelay_,this.lastConnectionAttemptTime_=(new Date).getTime();const t=Math.max(0,(new Date).getTime()-this.lastConnectionAttemptTime_);let e=Math.max(0,this.reconnectDelay_-t);e=Math.random()*e,this.log_("Trying to reconnect in "+e+"ms"),this.scheduleConnect_(e),this.reconnectDelay_=Math.min(this.maxReconnectDelay_,this.reconnectDelay_*$g)}this.onConnectStatus_(!1)}async establishConnection_(){if(this.shouldReconnect_()){this.log_("Making a connection attempt"),this.lastConnectionAttemptTime_=(new Date).getTime(),this.lastConnectionEstablishedTime_=null;const t=this.onDataMessage_.bind(this),e=this.onReady_.bind(this),s=this.onRealtimeDisconnect_.bind(this),i=this.id+":"+tp.nextConnectionId_++,n=this.lastSessionId;let r=!1,o=null;const a=function(){o?o.close():(r=!0,s())},l=function(t){El(o,"sendRequest call when we're not connected not allowed."),o.sendRequest(t)};this.realtime_={close:a,sendRequest:l};const h=this.forceTokenRefresh_;this.forceTokenRefresh_=!1;try{const[a,l]=await Promise.all([this.authTokenProvider_.getToken(h),this.appCheckTokenProvider_.getToken(h)]);r?Yu("getToken() completed but was canceled"):(Yu("getToken() completed. Creating connection."),this.authToken_=a&&a.accessToken,this.appCheckToken_=l&&l.token,o=new Cg(i,this.repoInfo_,this.applicationId_,this.appCheckToken_,this.authToken_,t,e,s,(t=>{Gu(t+" ("+this.repoInfo_.toString()+")"),this.interrupt(Jg)}),n))}catch(Hu){this.log_("Failed to get token: "+Hu),r||(this.repoInfo_.nodeAdmin&&Gu(Hu),a())}}}interrupt(t){Yu("Interrupting connection for reason: "+t),this.interruptReasons_[t]=!0,this.realtime_?this.realtime_.close():(this.establishConnectionTimer_&&(clearTimeout(this.establishConnectionTimer_),this.establishConnectionTimer_=null),this.connected_&&this.onRealtimeDisconnect_())}resume(t){Yu("Resuming connection for reason: "+t),delete this.interruptReasons_[t],Ch(this.interruptReasons_)&&(this.reconnectDelay_=Ug,this.realtime_||this.scheduleConnect_(0))}handleTimestamp_(t){const e=t-(new Date).getTime();this.onServerInfoUpdate_({serverTimeOffset:e})}cancelSentTransactions_(){for(let t=0;t<this.outstandingPuts_.length;t++){const e=this.outstandingPuts_[t];e&&"h"in e.request&&e.queued&&(e.onComplete&&e.onComplete("disconnect"),delete this.outstandingPuts_[t],this.outstandingPutCount_--)}0===this.outstandingPutCount_&&(this.outstandingPuts_=[])}onListenRevoked_(t,e){let s;s=e?e.map((t=>ed(t))).join("$"):"default";const i=this.removeListen_(t,s);i&&i.onComplete&&i.onComplete("permission_denied")}removeListen_(t,e){const s=new Og(t).toString();let i;if(this.listens.has(s)){const t=this.listens.get(s);i=t.get(e),t.delete(e),0===t.size&&this.listens.delete(s)}else i=void 0;return i}onAuthRevoked_(t,e){Yu("Auth token revoked: "+t+"/"+e),this.authToken_=null,this.forceTokenRefresh_=!0,this.realtime_.close(),"invalid_token"!==t&&"permission_denied"!==t||(this.invalidAuthTokenCount_++,this.invalidAuthTokenCount_>=Zg&&(this.reconnectDelay_=Kg,this.authTokenProvider_.notifyForInvalidToken()))}onAppCheckRevoked_(t,e){Yu("App check token revoked: "+t+"/"+e),this.appCheckToken_=null,this.forceTokenRefresh_=!0,"invalid_token"!==t&&"permission_denied"!==t||(this.invalidAppCheckTokenCount_++,this.invalidAppCheckTokenCount_>=Zg&&this.appCheckTokenProvider_.notifyForInvalidToken())}onSecurityDebugPacket_(t){this.securityDebugCallback_?this.securityDebugCallback_(t):"msg"in t&&console.log("FIREBASE: "+t["msg"].replace("\n","\nFIREBASE: "))}restoreState_(){this.tryAuth(),this.tryAppCheck();for(const t of this.listens.values())for(const e of t.values())this.sendListen_(e);for(let t=0;t<this.outstandingPuts_.length;t++)this.outstandingPuts_[t]&&this.sendPut_(t);while(this.onDisconnectRequestQueue_.length){const t=this.onDisconnectRequestQueue_.shift();this.sendOnDisconnect_(t.action,t.pathString,t.data,t.onComplete)}for(let t=0;t<this.outstandingGets_.length;t++)this.outstandingGets_[t]&&this.sendGet_(t)}sendConnectStats_(){const t={};let e="js";oh()&&(e=this.repoInfo_.nodeAdmin?"admin_node":"node"),t["sdk."+e+"."+Eu.replace(/\./g,"-")]=1,nh()?t["framework.cordova"]=1:rh()&&(t["framework.reactnative"]=1),this.reportStats(t)}shouldReconnect_(){const t=Sg.getInstance().currentlyOnline();return Ch(this.interruptReasons_)&&t}}tp.nextPersistentConnectionId_=0,tp.nextConnectionId_=0;
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
class ep{constructor(t,e){this.name=t,this.node=e}static Wrap(t,e){return new ep(t,e)}}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class sp{getCompare(){return this.compare.bind(this)}indexedValueChanged(t,e){const s=new ep($u,t),i=new ep($u,e);return 0!==this.compare(s,i)}minPost(){return ep.MIN}}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let ip;class np extends sp{static get __EMPTY_NODE(){return ip}static set __EMPTY_NODE(t){ip=t}compare(t,e){return Ju(t.name,e.name)}isDefinedOn(t){throw Dl("KeyIndex.isDefinedOn not expected to be called.")}indexedValueChanged(t,e){return!1}minPost(){return ep.MIN}maxPost(){return new ep(Qu,ip)}makePost(t,e){return El("string"===typeof t,"KeyIndex indexValue must always be a string."),new ep(t,ip)}toString(){return".key"}}const rp=new np;
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class op{constructor(t,e,s,i,n=null){this.isReverse_=i,this.resultGenerator_=n,this.nodeStack_=[];let r=1;while(!t.isEmpty())if(r=e?s(t.key,e):1,i&&(r*=-1),r<0)t=this.isReverse_?t.left:t.right;else{if(0===r){this.nodeStack_.push(t);break}this.nodeStack_.push(t),t=this.isReverse_?t.right:t.left}}getNext(){if(0===this.nodeStack_.length)return null;let t,e=this.nodeStack_.pop();if(t=this.resultGenerator_?this.resultGenerator_(e.key,e.value):{key:e.key,value:e.value},this.isReverse_){e=e.left;while(!e.isEmpty())this.nodeStack_.push(e),e=e.right}else{e=e.right;while(!e.isEmpty())this.nodeStack_.push(e),e=e.left}return t}hasNext(){return this.nodeStack_.length>0}peek(){if(0===this.nodeStack_.length)return null;const t=this.nodeStack_[this.nodeStack_.length-1];return this.resultGenerator_?this.resultGenerator_(t.key,t.value):{key:t.key,value:t.value}}}class ap{constructor(t,e,s,i,n){this.key=t,this.value=e,this.color=null!=s?s:ap.RED,this.left=null!=i?i:hp.EMPTY_NODE,this.right=null!=n?n:hp.EMPTY_NODE}copy(t,e,s,i,n){return new ap(null!=t?t:this.key,null!=e?e:this.value,null!=s?s:this.color,null!=i?i:this.left,null!=n?n:this.right)}count(){return this.left.count()+1+this.right.count()}isEmpty(){return!1}inorderTraversal(t){return this.left.inorderTraversal(t)||!!t(this.key,this.value)||this.right.inorderTraversal(t)}reverseTraversal(t){return this.right.reverseTraversal(t)||t(this.key,this.value)||this.left.reverseTraversal(t)}min_(){return this.left.isEmpty()?this:this.left.min_()}minKey(){return this.min_().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(t,e,s){let i=this;const n=s(t,i.key);return i=n<0?i.copy(null,null,null,i.left.insert(t,e,s),null):0===n?i.copy(null,e,null,null,null):i.copy(null,null,null,null,i.right.insert(t,e,s)),i.fixUp_()}removeMin_(){if(this.left.isEmpty())return hp.EMPTY_NODE;let t=this;return t.left.isRed_()||t.left.left.isRed_()||(t=t.moveRedLeft_()),t=t.copy(null,null,null,t.left.removeMin_(),null),t.fixUp_()}remove(t,e){let s,i;if(s=this,e(t,s.key)<0)s.left.isEmpty()||s.left.isRed_()||s.left.left.isRed_()||(s=s.moveRedLeft_()),s=s.copy(null,null,null,s.left.remove(t,e),null);else{if(s.left.isRed_()&&(s=s.rotateRight_()),s.right.isEmpty()||s.right.isRed_()||s.right.left.isRed_()||(s=s.moveRedRight_()),0===e(t,s.key)){if(s.right.isEmpty())return hp.EMPTY_NODE;i=s.right.min_(),s=s.copy(i.key,i.value,null,null,s.right.removeMin_())}s=s.copy(null,null,null,null,s.right.remove(t,e))}return s.fixUp_()}isRed_(){return this.color}fixUp_(){let t=this;return t.right.isRed_()&&!t.left.isRed_()&&(t=t.rotateLeft_()),t.left.isRed_()&&t.left.left.isRed_()&&(t=t.rotateRight_()),t.left.isRed_()&&t.right.isRed_()&&(t=t.colorFlip_()),t}moveRedLeft_(){let t=this.colorFlip_();return t.right.left.isRed_()&&(t=t.copy(null,null,null,null,t.right.rotateRight_()),t=t.rotateLeft_(),t=t.colorFlip_()),t}moveRedRight_(){let t=this.colorFlip_();return t.left.left.isRed_()&&(t=t.rotateRight_(),t=t.colorFlip_()),t}rotateLeft_(){const t=this.copy(null,null,ap.RED,null,this.right.left);return this.right.copy(null,null,this.color,t,null)}rotateRight_(){const t=this.copy(null,null,ap.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,t)}colorFlip_(){const t=this.left.copy(null,null,!this.left.color,null,null),e=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,t,e)}checkMaxDepth_(){const t=this.check_();return Math.pow(2,t)<=this.count()+1}check_(){if(this.isRed_()&&this.left.isRed_())throw new Error("Red node has red child("+this.key+","+this.value+")");if(this.right.isRed_())throw new Error("Right child of ("+this.key+","+this.value+") is red");const t=this.left.check_();if(t!==this.right.check_())throw new Error("Black depths differ");return t+(this.isRed_()?0:1)}}ap.RED=!0,ap.BLACK=!1;class lp{copy(t,e,s,i,n){return this}insert(t,e,s){return new ap(t,e,null)}remove(t,e){return this}count(){return 0}isEmpty(){return!0}inorderTraversal(t){return!1}reverseTraversal(t){return!1}minKey(){return null}maxKey(){return null}check_(){return 0}isRed_(){return!1}}class hp{constructor(t,e=hp.EMPTY_NODE){this.comparator_=t,this.root_=e}insert(t,e){return new hp(this.comparator_,this.root_.insert(t,e,this.comparator_).copy(null,null,ap.BLACK,null,null))}remove(t){return new hp(this.comparator_,this.root_.remove(t,this.comparator_).copy(null,null,ap.BLACK,null,null))}get(t){let e,s=this.root_;while(!s.isEmpty()){if(e=this.comparator_(t,s.key),0===e)return s.value;e<0?s=s.left:e>0&&(s=s.right)}return null}getPredecessorKey(t){let e,s=this.root_,i=null;while(!s.isEmpty()){if(e=this.comparator_(t,s.key),0===e){if(s.left.isEmpty())return i?i.key:null;s=s.left;while(!s.right.isEmpty())s=s.right;return s.key}e<0?s=s.left:e>0&&(i=s,s=s.right)}throw new Error("Attempted to find predecessor key for a nonexistent key.  What gives?")}isEmpty(){return this.root_.isEmpty()}count(){return this.root_.count()}minKey(){return this.root_.minKey()}maxKey(){return this.root_.maxKey()}inorderTraversal(t){return this.root_.inorderTraversal(t)}reverseTraversal(t){return this.root_.reverseTraversal(t)}getIterator(t){return new op(this.root_,null,this.comparator_,!1,t)}getIteratorFrom(t,e){return new op(this.root_,t,this.comparator_,!1,e)}getReverseIteratorFrom(t,e){return new op(this.root_,t,this.comparator_,!0,e)}getReverseIterator(t){return new op(this.root_,null,this.comparator_,!0,t)}}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
function cp(t,e){return Ju(t.name,e.name)}function up(t,e){return Ju(t,e)}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let dp;function gp(t){dp=t}hp.EMPTY_NODE=new lp;const pp=function(t){return"number"===typeof t?"number:"+nd(t):"string:"+t},fp=function(t){if(t.isLeafNode()){const e=t.val();El("string"===typeof e||"number"===typeof e||"object"===typeof e&&yh(e,".sv"),"Priority must be a string or number.")}else El(t===dp||t.isEmpty(),"priority of unexpected type.");El(t===dp||t.getPriority().isEmpty(),"Priority nodes can't have a priority of their own.")};
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
let mp,_p,vp;class yp{static set __childrenNodeConstructor(t){mp=t}static get __childrenNodeConstructor(){return mp}constructor(t,e=yp.__childrenNodeConstructor.EMPTY_NODE){this.value_=t,this.priorityNode_=e,this.lazyHash_=null,El(void 0!==this.value_&&null!==this.value_,"LeafNode shouldn't be created with null/undefined value."),fp(this.priorityNode_)}isLeafNode(){return!0}getPriority(){return this.priorityNode_}updatePriority(t){return new yp(this.value_,t)}getImmediateChild(t){return".priority"===t?this.priorityNode_:yp.__childrenNodeConstructor.EMPTY_NODE}getChild(t){return jg(t)?this:".priority"===Dg(t)?this.priorityNode_:yp.__childrenNodeConstructor.EMPTY_NODE}hasChild(){return!1}getPredecessorChildName(t,e){return null}updateImmediateChild(t,e){return".priority"===t?this.updatePriority(e):e.isEmpty()&&".priority"!==t?this:yp.__childrenNodeConstructor.EMPTY_NODE.updateImmediateChild(t,e).updatePriority(this.priorityNode_)}updateChild(t,e){const s=Dg(t);return null===s?e:e.isEmpty()&&".priority"!==s?this:(El(".priority"!==s||1===Ig(t),".priority must be the last token in a path"),this.updateImmediateChild(s,yp.__childrenNodeConstructor.EMPTY_NODE.updateChild(Pg(t),e)))}isEmpty(){return!1}numChildren(){return 0}forEachChild(t,e){return!1}val(t){return t&&!this.getPriority().isEmpty()?{".value":this.getValue(),".priority":this.getPriority().val()}:this.getValue()}hash(){if(null===this.lazyHash_){let t="";this.priorityNode_.isEmpty()||(t+="priority:"+pp(this.priorityNode_.val())+":");const e=typeof this.value_;t+=e+":",t+="number"===e?nd(this.value_):this.value_,this.lazyHash_=ju(t)}return this.lazyHash_}getValue(){return this.value_}compareTo(t){return t===yp.__childrenNodeConstructor.EMPTY_NODE?1:t instanceof yp.__childrenNodeConstructor?-1:(El(t.isLeafNode(),"Unknown node type"),this.compareToLeafNode_(t))}compareToLeafNode_(t){const e=typeof t.value_,s=typeof this.value_,i=yp.VALUE_TYPE_ORDER.indexOf(e),n=yp.VALUE_TYPE_ORDER.indexOf(s);return El(i>=0,"Unknown leaf type: "+e),El(n>=0,"Unknown leaf type: "+s),i===n?"object"===s?0:this.value_<t.value_?-1:this.value_===t.value_?0:1:n-i}withIndex(){return this}isIndexed(){return!0}equals(t){if(t===this)return!0;if(t.isLeafNode()){const e=t;return this.value_===e.value_&&this.priorityNode_.equals(e.priorityNode_)}return!1}}function bp(t){_p=t}function Cp(t){vp=t}yp.VALUE_TYPE_ORDER=["object","boolean","number","string"];class xp extends sp{compare(t,e){const s=t.node.getPriority(),i=e.node.getPriority(),n=s.compareTo(i);return 0===n?Ju(t.name,e.name):n}isDefinedOn(t){return!t.getPriority().isEmpty()}indexedValueChanged(t,e){return!t.getPriority().equals(e.getPriority())}minPost(){return ep.MIN}maxPost(){return new ep(Qu,new yp("[PRIORITY-POST]",vp))}makePost(t,e){const s=_p(t);return new ep(e,new yp("[PRIORITY-POST]",s))}toString(){return".priority"}}const wp=new xp,Sp=Math.log(2);
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Tp{constructor(t){const e=t=>parseInt(Math.log(t)/Sp,10),s=t=>parseInt(Array(t+1).join("1"),2);this.count=e(t+1),this.current_=this.count-1;const i=s(this.count);this.bits_=t+1&i}nextBitIsOne(){const t=!(this.bits_&1<<this.current_);return this.current_--,t}}const kp=function(t,e,s,i){t.sort(e);const n=function(e,i){const r=i-e;let o,a;if(0===r)return null;if(1===r)return o=t[e],a=s?s(o):o,new ap(a,o.node,ap.BLACK,null,null);{const l=parseInt(r/2,10)+e,h=n(e,l),c=n(l+1,i);return o=t[l],a=s?s(o):o,new ap(a,o.node,ap.BLACK,h,c)}},r=function(e){let i=null,r=null,o=t.length;const a=function(e,i){const r=o-e,a=o;o-=e;const h=n(r+1,a),c=t[r],u=s?s(c):c;l(new ap(u,c.node,i,null,h))},l=function(t){i?(i.left=t,i=t):(r=t,i=t)};for(let t=0;t<e.count;++t){const s=e.nextBitIsOne(),i=Math.pow(2,e.count-(t+1));s?a(i,ap.BLACK):(a(i,ap.BLACK),a(i,ap.RED))}return r},o=new Tp(t.length),a=r(o);return new hp(i||e,a)};
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let Op;const Ep={};class Dp{static get Default(){return El(Ep&&wp,"ChildrenNode.ts has not been loaded"),Op=Op||new Dp({".priority":Ep},{".priority":wp}),Op}constructor(t,e){this.indexes_=t,this.indexSet_=e}get(t){const e=bh(this.indexes_,t);if(!e)throw new Error("No index defined for "+t);return e instanceof hp?e:null}hasIndex(t){return yh(this.indexSet_,t.toString())}addIndex(t,e){El(t!==rp,"KeyIndex always exists and isn't meant to be added to the IndexMap.");const s=[];let i=!1;const n=e.getIterator(ep.Wrap);let r,o=n.getNext();while(o)i=i||t.isDefinedOn(o.node),s.push(o),o=n.getNext();r=i?kp(s,t.getCompare()):Ep;const a=t.toString(),l=Object.assign({},this.indexSet_);l[a]=t;const h=Object.assign({},this.indexes_);return h[a]=r,new Dp(h,l)}addToIndexes(t,e){const s=xh(this.indexes_,((s,i)=>{const n=bh(this.indexSet_,i);if(El(n,"Missing index implementation for "+i),s===Ep){if(n.isDefinedOn(t.node)){const s=[],i=e.getIterator(ep.Wrap);let r=i.getNext();while(r)r.name!==t.name&&s.push(r),r=i.getNext();return s.push(t),kp(s,n.getCompare())}return Ep}{const i=e.get(t.name);let n=s;return i&&(n=n.remove(new ep(t.name,i))),n.insert(t,t.node)}}));return new Dp(s,this.indexSet_)}removeFromIndexes(t,e){const s=xh(this.indexes_,(s=>{if(s===Ep)return s;{const i=e.get(t.name);return i?s.remove(new ep(t.name,i)):s}}));return new Dp(s,this.indexSet_)}}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let Ip;class Pp{static get EMPTY_NODE(){return Ip||(Ip=new Pp(new hp(up),null,Dp.Default))}constructor(t,e,s){this.children_=t,this.priorityNode_=e,this.indexMap_=s,this.lazyHash_=null,this.priorityNode_&&fp(this.priorityNode_),this.children_.isEmpty()&&El(!this.priorityNode_||this.priorityNode_.isEmpty(),"An empty node cannot have a priority")}isLeafNode(){return!1}getPriority(){return this.priorityNode_||Ip}updatePriority(t){return this.children_.isEmpty()?this:new Pp(this.children_,t,this.indexMap_)}getImmediateChild(t){if(".priority"===t)return this.getPriority();{const e=this.children_.get(t);return null===e?Ip:e}}getChild(t){const e=Dg(t);return null===e?this:this.getImmediateChild(e).getChild(Pg(t))}hasChild(t){return null!==this.children_.get(t)}updateImmediateChild(t,e){if(El(e,"We should always be passing snapshot nodes"),".priority"===t)return this.updatePriority(e);{const s=new ep(t,e);let i,n;e.isEmpty()?(i=this.children_.remove(t),n=this.indexMap_.removeFromIndexes(s,this.children_)):(i=this.children_.insert(t,e),n=this.indexMap_.addToIndexes(s,this.children_));const r=i.isEmpty()?Ip:this.priorityNode_;return new Pp(i,r,n)}}updateChild(t,e){const s=Dg(t);if(null===s)return e;{El(".priority"!==Dg(t)||1===Ig(t),".priority must be the last token in a path");const i=this.getImmediateChild(s).updateChild(Pg(t),e);return this.updateImmediateChild(s,i)}}isEmpty(){return this.children_.isEmpty()}numChildren(){return this.children_.count()}val(t){if(this.isEmpty())return null;const e={};let s=0,i=0,n=!0;if(this.forEachChild(wp,((r,o)=>{e[r]=o.val(t),s++,n&&Pp.INTEGER_REGEXP_.test(r)?i=Math.max(i,Number(r)):n=!1})),!t&&n&&i<2*s){const t=[];for(const s in e)t[s]=e[s];return t}return t&&!this.getPriority().isEmpty()&&(e[".priority"]=this.getPriority().val()),e}hash(){if(null===this.lazyHash_){let t="";this.getPriority().isEmpty()||(t+="priority:"+pp(this.getPriority().val())+":"),this.forEachChild(wp,((e,s)=>{const i=s.hash();""!==i&&(t+=":"+e+":"+i)})),this.lazyHash_=""===t?"":ju(t)}return this.lazyHash_}getPredecessorChildName(t,e,s){const i=this.resolveIndex_(s);if(i){const s=i.getPredecessorKey(new ep(t,e));return s?s.name:null}return this.children_.getPredecessorKey(t)}getFirstChildName(t){const e=this.resolveIndex_(t);if(e){const t=e.minKey();return t&&t.name}return this.children_.minKey()}getFirstChild(t){const e=this.getFirstChildName(t);return e?new ep(e,this.children_.get(e)):null}getLastChildName(t){const e=this.resolveIndex_(t);if(e){const t=e.maxKey();return t&&t.name}return this.children_.maxKey()}getLastChild(t){const e=this.getLastChildName(t);return e?new ep(e,this.children_.get(e)):null}forEachChild(t,e){const s=this.resolveIndex_(t);return s?s.inorderTraversal((t=>e(t.name,t.node))):this.children_.inorderTraversal(e)}getIterator(t){return this.getIteratorFrom(t.minPost(),t)}getIteratorFrom(t,e){const s=this.resolveIndex_(e);if(s)return s.getIteratorFrom(t,(t=>t));{const s=this.children_.getIteratorFrom(t.name,ep.Wrap);let i=s.peek();while(null!=i&&e.compare(i,t)<0)s.getNext(),i=s.peek();return s}}getReverseIterator(t){return this.getReverseIteratorFrom(t.maxPost(),t)}getReverseIteratorFrom(t,e){const s=this.resolveIndex_(e);if(s)return s.getReverseIteratorFrom(t,(t=>t));{const s=this.children_.getReverseIteratorFrom(t.name,ep.Wrap);let i=s.peek();while(null!=i&&e.compare(i,t)>0)s.getNext(),i=s.peek();return s}}compareTo(t){return this.isEmpty()?t.isEmpty()?0:-1:t.isLeafNode()||t.isEmpty()?1:t===Mp?-1:0}withIndex(t){if(t===rp||this.indexMap_.hasIndex(t))return this;{const e=this.indexMap_.addIndex(t,this.children_);return new Pp(this.children_,this.priorityNode_,e)}}isIndexed(t){return t===rp||this.indexMap_.hasIndex(t)}equals(t){if(t===this)return!0;if(t.isLeafNode())return!1;{const e=t;if(this.getPriority().equals(e.getPriority())){if(this.children_.count()===e.children_.count()){const t=this.getIterator(wp),s=e.getIterator(wp);let i=t.getNext(),n=s.getNext();while(i&&n){if(i.name!==n.name||!i.node.equals(n.node))return!1;i=t.getNext(),n=s.getNext()}return null===i&&null===n}return!1}return!1}}resolveIndex_(t){return t===rp?null:this.indexMap_.get(t.toString())}}Pp.INTEGER_REGEXP_=/^(0|[1-9]\d*)$/;class Ap extends Pp{constructor(){super(new hp(up),Pp.EMPTY_NODE,Dp.Default)}compareTo(t){return t===this?0:1}equals(t){return t===this}getPriority(){return this}getImmediateChild(t){return Pp.EMPTY_NODE}isEmpty(){return!1}}const Mp=new Ap;Object.defineProperties(ep,{MIN:{value:new ep($u,Pp.EMPTY_NODE)},MAX:{value:new ep(Qu,Mp)}}),np.__EMPTY_NODE=Pp.EMPTY_NODE,yp.__childrenNodeConstructor=Pp,gp(Mp),Cp(Mp);
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
const Rp=!0;function Lp(t,e=null){if(null===t)return Pp.EMPTY_NODE;if("object"===typeof t&&".priority"in t&&(e=t[".priority"]),El(null===e||"string"===typeof e||"number"===typeof e||"object"===typeof e&&".sv"in e,"Invalid priority type found: "+typeof e),"object"===typeof t&&".value"in t&&null!==t[".value"]&&(t=t[".value"]),"object"!==typeof t||".sv"in t){const s=t;return new yp(s,Lp(e))}if(t instanceof Array||!Rp){let s=Pp.EMPTY_NODE;return id(t,((e,i)=>{if(yh(t,e)&&"."!==e.substring(0,1)){const t=Lp(i);!t.isLeafNode()&&t.isEmpty()||(s=s.updateImmediateChild(e,t))}})),s.updatePriority(Lp(e))}{const s=[];let i=!1;const n=t;if(id(n,((t,e)=>{if("."!==t.substring(0,1)){const n=Lp(e);n.isEmpty()||(i=i||!n.getPriority().isEmpty(),s.push(new ep(t,n)))}})),0===s.length)return Pp.EMPTY_NODE;const r=kp(s,cp,(t=>t.name),up);if(i){const t=kp(s,wp.getCompare());return new Pp(r,Lp(e),new Dp({".priority":t},{".priority":wp}))}return new Pp(r,Lp(e),Dp.Default)}}bp(Lp);
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
class Fp extends sp{constructor(t){super(),this.indexPath_=t,El(!jg(t)&&".priority"!==Dg(t),"Can't create PathIndex with empty path or .priority key")}extractChild(t){return t.getChild(this.indexPath_)}isDefinedOn(t){return!t.getChild(this.indexPath_).isEmpty()}compare(t,e){const s=this.extractChild(t.node),i=this.extractChild(e.node),n=s.compareTo(i);return 0===n?Ju(t.name,e.name):n}makePost(t,e){const s=Lp(t),i=Pp.EMPTY_NODE.updateChild(this.indexPath_,s);return new ep(e,i)}maxPost(){const t=Pp.EMPTY_NODE.updateChild(this.indexPath_,Mp);return new ep(Qu,t)}toString(){return Rg(this.indexPath_,0).join("/")}}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class jp extends sp{compare(t,e){const s=t.node.compareTo(e.node);return 0===s?Ju(t.name,e.name):s}isDefinedOn(t){return!0}indexedValueChanged(t,e){return!t.equals(e)}minPost(){return ep.MIN}maxPost(){return ep.MAX}makePost(t,e){const s=Lp(t);return new ep(e,s)}toString(){return".value"}}const Np=new jp;
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Bp(t){return{type:"value",snapshotNode:t}}function Wp(t,e){return{type:"child_added",snapshotNode:e,childName:t}}function Xp(t,e){return{type:"child_removed",snapshotNode:e,childName:t}}function Yp(t,e,s){return{type:"child_changed",snapshotNode:e,childName:t,oldSnap:s}}function Vp(t,e){return{type:"child_moved",snapshotNode:e,childName:t}}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
class Hp{constructor(){this.limitSet_=!1,this.startSet_=!1,this.startNameSet_=!1,this.startAfterSet_=!1,this.endSet_=!1,this.endNameSet_=!1,this.endBeforeSet_=!1,this.limit_=0,this.viewFrom_="",this.indexStartValue_=null,this.indexStartName_="",this.indexEndValue_=null,this.indexEndName_="",this.index_=wp}hasStart(){return this.startSet_}isViewFromLeft(){return""===this.viewFrom_?this.startSet_:"l"===this.viewFrom_}getIndexStartValue(){return El(this.startSet_,"Only valid if start has been set"),this.indexStartValue_}getIndexStartName(){return El(this.startSet_,"Only valid if start has been set"),this.startNameSet_?this.indexStartName_:$u}hasEnd(){return this.endSet_}getIndexEndValue(){return El(this.endSet_,"Only valid if end has been set"),this.indexEndValue_}getIndexEndName(){return El(this.endSet_,"Only valid if end has been set"),this.endNameSet_?this.indexEndName_:Qu}hasLimit(){return this.limitSet_}hasAnchoredLimit(){return this.limitSet_&&""!==this.viewFrom_}getLimit(){return El(this.limitSet_,"Only valid if limit has been set"),this.limit_}getIndex(){return this.index_}loadsAllData(){return!(this.startSet_||this.endSet_||this.limitSet_)}isDefault(){return this.loadsAllData()&&this.index_===wp}copy(){const t=new Hp;return t.limitSet_=this.limitSet_,t.limit_=this.limit_,t.startSet_=this.startSet_,t.startAfterSet_=this.startAfterSet_,t.indexStartValue_=this.indexStartValue_,t.startNameSet_=this.startNameSet_,t.indexStartName_=this.indexStartName_,t.endSet_=this.endSet_,t.endBeforeSet_=this.endBeforeSet_,t.indexEndValue_=this.indexEndValue_,t.endNameSet_=this.endNameSet_,t.indexEndName_=this.indexEndName_,t.index_=this.index_,t.viewFrom_=this.viewFrom_,t}}function zp(t){const e={};if(t.isDefault())return e;let s;if(t.index_===wp?s="$priority":t.index_===Np?s="$value":t.index_===rp?s="$key":(El(t.index_ instanceof Fp,"Unrecognized index type!"),s=t.index_.toString()),e["orderBy"]=fh(s),t.startSet_){const s=t.startAfterSet_?"startAfter":"startAt";e[s]=fh(t.indexStartValue_),t.startNameSet_&&(e[s]+=","+fh(t.indexStartName_))}if(t.endSet_){const s=t.endBeforeSet_?"endBefore":"endAt";e[s]=fh(t.indexEndValue_),t.endNameSet_&&(e[s]+=","+fh(t.indexEndName_))}return t.limitSet_&&(t.isViewFromLeft()?e["limitToFirst"]=t.limit_:e["limitToLast"]=t.limit_),e}function Gp(t){const e={};if(t.startSet_&&(e["sp"]=t.indexStartValue_,t.startNameSet_&&(e["sn"]=t.indexStartName_),e["sin"]=!t.startAfterSet_),t.endSet_&&(e["ep"]=t.indexEndValue_,t.endNameSet_&&(e["en"]=t.indexEndName_),e["ein"]=!t.endBeforeSet_),t.limitSet_){e["l"]=t.limit_;let s=t.viewFrom_;""===s&&(s=t.isViewFromLeft()?"l":"r"),e["vf"]=s}return t.index_!==wp&&(e["i"]=t.index_.toString()),e}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Up extends xg{reportStats(t){throw new Error("Method not implemented.")}static getListenId_(t,e){return void 0!==e?"tag$"+e:(El(t._queryParams.isDefault(),"should have a tag if it's not a default query."),t._path.toString())}constructor(t,e,s,i){super(),this.repoInfo_=t,this.onDataUpdate_=e,this.authTokenProvider_=s,this.appCheckTokenProvider_=i,this.log_=Vu("p:rest:"),this.listens_={}}listen(t,e,s,i){const n=t._path.toString();this.log_("Listen called for "+n+" "+t._queryIdentifier);const r=Up.getListenId_(t,s),o={};this.listens_[r]=o;const a=zp(t._queryParams);this.restRequest_(n+".json",a,((t,e)=>{let a=e;if(404===t&&(a=null,t=null),null===t&&this.onDataUpdate_(n,a,!1,s),bh(this.listens_,r)===o){let e;e=t?401===t?"permission_denied":"rest_error:"+t:"ok",i(e,null)}}))}unlisten(t,e){const s=Up.getListenId_(t,e);delete this.listens_[s]}get(t){const e=zp(t._queryParams),s=t._path.toString(),i=new ql;return this.restRequest_(s+".json",e,((t,e)=>{let n=e;404===t&&(n=null,t=null),null===t?(this.onDataUpdate_(s,n,!1,null),i.resolve(n)):i.reject(new Error(n))})),i.promise}refreshAuthToken(t){}restRequest_(t,e={},s){return e["format"]="export",Promise.all([this.authTokenProvider_.getToken(!1),this.appCheckTokenProvider_.getToken(!1)]).then((([i,n])=>{i&&i.accessToken&&(e["auth"]=i.accessToken),n&&n.token&&(e["ac"]=n.token);const r=(this.repoInfo_.secure?"https://":"http://")+this.repoInfo_.host+t+"?ns="+this.repoInfo_.namespace+Th(e);this.log_("Sending REST request for "+r);const o=new XMLHttpRequest;o.onreadystatechange=()=>{if(s&&4===o.readyState){this.log_("REST Response for "+r+" received. status:",o.status,"response:",o.responseText);let t=null;if(o.status>=200&&o.status<300){try{t=ph(o.responseText)}catch(h){Gu("Failed to parse JSON response for "+r+": "+o.responseText)}s(null,t)}else 401!==o.status&&404!==o.status&&Gu("Got unsuccessful REST response for "+r+" Status: "+o.status),s(o.status);s=null}},o.open("GET",r,!0),o.send()}))}}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class qp{constructor(){this.rootNode_=Pp.EMPTY_NODE}getNode(t){return this.rootNode_.getChild(t)}updateSnapshot(t,e){this.rootNode_=this.rootNode_.updateChild(t,e)}}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Kp(){return{value:null,children:new Map}}function $p(t,e,s){if(jg(e))t.value=s,t.children.clear();else if(null!==t.value)t.value=t.value.updateChild(e,s);else{const i=Dg(e);t.children.has(i)||t.children.set(i,Kp());const n=t.children.get(i);e=Pg(e),$p(n,e,s)}}function Qp(t,e,s){null!==t.value?s(e,t.value):Jp(t,((t,i)=>{const n=new Og(e.toString()+"/"+t);Qp(i,n,s)}))}function Jp(t,e){t.children.forEach(((t,s)=>{e(s,t)}))}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Zp{constructor(t){this.collection_=t,this.last_=null}get(){const t=this.collection_.get(),e=Object.assign({},t);return this.last_&&id(this.last_,((t,s)=>{e[t]=e[t]-s})),this.last_=t,e}}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const tf=1e4,ef=3e4,sf=3e5;class nf{constructor(t,e){this.server_=e,this.statsToReport_={},this.statsListener_=new Zp(t);const s=tf+(ef-tf)*Math.random();gd(this.reportStats_.bind(this),Math.floor(s))}reportStats_(){const t=this.statsListener_.get(),e={};let s=!1;id(t,((t,i)=>{i>0&&yh(this.statsToReport_,t)&&(e[t]=i,s=!0)})),s&&this.server_.reportStats(e),gd(this.reportStats_.bind(this),Math.floor(2*Math.random()*sf))}}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var rf;function of(){return{fromUser:!0,fromServer:!1,queryId:null,tagged:!1}}function af(){return{fromUser:!1,fromServer:!0,queryId:null,tagged:!1}}function lf(t){return{fromUser:!1,fromServer:!0,queryId:t,tagged:!0}}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */(function(t){t[t["OVERWRITE"]=0]="OVERWRITE",t[t["MERGE"]=1]="MERGE",t[t["ACK_USER_WRITE"]=2]="ACK_USER_WRITE",t[t["LISTEN_COMPLETE"]=3]="LISTEN_COMPLETE"})(rf||(rf={}));class hf{constructor(t,e,s){this.path=t,this.affectedTree=e,this.revert=s,this.type=rf.ACK_USER_WRITE,this.source=of()}operationForChild(t){if(jg(this.path)){if(null!=this.affectedTree.value)return El(this.affectedTree.children.isEmpty(),"affectedTree should not have overlapping affected paths."),this;{const e=this.affectedTree.subtree(new Og(t));return new hf(Eg(),e,this.revert)}}return El(Dg(this.path)===t,"operationForChild called for unrelated child."),new hf(Pg(this.path),this.affectedTree,this.revert)}}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
class cf{constructor(t,e,s){this.source=t,this.path=e,this.snap=s,this.type=rf.OVERWRITE}operationForChild(t){return jg(this.path)?new cf(this.source,Eg(),this.snap.getImmediateChild(t)):new cf(this.source,Pg(this.path),this.snap)}}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class uf{constructor(t,e,s){this.source=t,this.path=e,this.children=s,this.type=rf.MERGE}operationForChild(t){if(jg(this.path)){const e=this.children.subtree(new Og(t));return e.isEmpty()?null:e.value?new cf(this.source,Eg(),e.value):new uf(this.source,Eg(),e)}return El(Dg(this.path)===t,"Can't get a merge for a child not on the path of the operation"),new uf(this.source,Pg(this.path),this.children)}toString(){return"Operation("+this.path+": "+this.source.toString()+" merge: "+this.children.toString()+")"}}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class df{constructor(t,e,s){this.node_=t,this.fullyInitialized_=e,this.filtered_=s}isFullyInitialized(){return this.fullyInitialized_}isFiltered(){return this.filtered_}isCompleteForPath(t){if(jg(t))return this.isFullyInitialized()&&!this.filtered_;const e=Dg(t);return this.isCompleteForChild(e)}isCompleteForChild(t){return this.isFullyInitialized()&&!this.filtered_||this.node_.hasChild(t)}getNode(){return this.node_}}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function gf(t,e,s,i){const n=[],r=[];return e.forEach((e=>{"child_changed"===e.type&&t.index_.indexedValueChanged(e.oldSnap,e.snapshotNode)&&r.push(Vp(e.childName,e.snapshotNode))})),pf(t,n,"child_removed",e,i,s),pf(t,n,"child_added",e,i,s),pf(t,n,"child_moved",r,i,s),pf(t,n,"child_changed",e,i,s),pf(t,n,"value",e,i,s),n}function pf(t,e,s,i,n,r){const o=i.filter((t=>t.type===s));o.sort(((e,s)=>mf(t,e,s))),o.forEach((s=>{const i=ff(t,s,r);n.forEach((n=>{n.respondsTo(s.type)&&e.push(n.createEvent(i,t.query_))}))}))}function ff(t,e,s){return"value"===e.type||"child_removed"===e.type||(e.prevName=s.getPredecessorChildName(e.childName,e.snapshotNode,t.index_)),e}function mf(t,e,s){if(null==e.childName||null==s.childName)throw Dl("Should only compare child_ events.");const i=new ep(e.childName,e.snapshotNode),n=new ep(s.childName,s.snapshotNode);return t.index_.compare(i,n)}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function _f(t,e){return{eventCache:t,serverCache:e}}function vf(t,e,s,i){return _f(new df(e,s,i),t.serverCache)}function yf(t,e,s,i){return _f(t.eventCache,new df(e,s,i))}function bf(t){return t.eventCache.isFullyInitialized()?t.eventCache.getNode():null}function Cf(t){return t.serverCache.isFullyInitialized()?t.serverCache.getNode():null}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let xf;const wf=()=>(xf||(xf=new hp(Zu)),xf);class Sf{static fromObject(t){let e=new Sf(null);return id(t,((t,s)=>{e=e.set(new Og(t),s)})),e}constructor(t,e=wf()){this.value=t,this.children=e}isEmpty(){return null===this.value&&this.children.isEmpty()}findRootMostMatchingPathAndValue(t,e){if(null!=this.value&&e(this.value))return{path:Eg(),value:this.value};if(jg(t))return null;{const s=Dg(t),i=this.children.get(s);if(null!==i){const n=i.findRootMostMatchingPathAndValue(Pg(t),e);if(null!=n){const t=Fg(new Og(s),n.path);return{path:t,value:n.value}}return null}return null}}findRootMostValueAndPath(t){return this.findRootMostMatchingPathAndValue(t,(()=>!0))}subtree(t){if(jg(t))return this;{const e=Dg(t),s=this.children.get(e);return null!==s?s.subtree(Pg(t)):new Sf(null)}}set(t,e){if(jg(t))return new Sf(e,this.children);{const s=Dg(t),i=this.children.get(s)||new Sf(null),n=i.set(Pg(t),e),r=this.children.insert(s,n);return new Sf(this.value,r)}}remove(t){if(jg(t))return this.children.isEmpty()?new Sf(null):new Sf(null,this.children);{const e=Dg(t),s=this.children.get(e);if(s){const i=s.remove(Pg(t));let n;return n=i.isEmpty()?this.children.remove(e):this.children.insert(e,i),null===this.value&&n.isEmpty()?new Sf(null):new Sf(this.value,n)}return this}}get(t){if(jg(t))return this.value;{const e=Dg(t),s=this.children.get(e);return s?s.get(Pg(t)):null}}setTree(t,e){if(jg(t))return e;{const s=Dg(t),i=this.children.get(s)||new Sf(null),n=i.setTree(Pg(t),e);let r;return r=n.isEmpty()?this.children.remove(s):this.children.insert(s,n),new Sf(this.value,r)}}fold(t){return this.fold_(Eg(),t)}fold_(t,e){const s={};return this.children.inorderTraversal(((i,n)=>{s[i]=n.fold_(Fg(t,i),e)})),e(t,this.value,s)}findOnPath(t,e){return this.findOnPath_(t,Eg(),e)}findOnPath_(t,e,s){const i=!!this.value&&s(e,this.value);if(i)return i;if(jg(t))return null;{const i=Dg(t),n=this.children.get(i);return n?n.findOnPath_(Pg(t),Fg(e,i),s):null}}foreachOnPath(t,e){return this.foreachOnPath_(t,Eg(),e)}foreachOnPath_(t,e,s){if(jg(t))return this;{this.value&&s(e,this.value);const i=Dg(t),n=this.children.get(i);return n?n.foreachOnPath_(Pg(t),Fg(e,i),s):new Sf(null)}}foreach(t){this.foreach_(Eg(),t)}foreach_(t,e){this.children.inorderTraversal(((s,i)=>{i.foreach_(Fg(t,s),e)})),this.value&&e(t,this.value)}foreachChild(t){this.children.inorderTraversal(((e,s)=>{s.value&&t(e,s.value)}))}}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Tf{constructor(t){this.writeTree_=t}static empty(){return new Tf(new Sf(null))}}function kf(t,e,s){if(jg(e))return new Tf(new Sf(s));{const i=t.writeTree_.findRootMostValueAndPath(e);if(null!=i){const n=i.path;let r=i.value;const o=Ng(n,e);return r=r.updateChild(o,s),new Tf(t.writeTree_.set(n,r))}{const i=new Sf(s),n=t.writeTree_.setTree(e,i);return new Tf(n)}}}function Of(t,e,s){let i=t;return id(s,((t,s)=>{i=kf(i,Fg(e,t),s)})),i}function Ef(t,e){if(jg(e))return Tf.empty();{const s=t.writeTree_.setTree(e,new Sf(null));return new Tf(s)}}function Df(t,e){return null!=If(t,e)}function If(t,e){const s=t.writeTree_.findRootMostValueAndPath(e);return null!=s?t.writeTree_.get(s.path).getChild(Ng(s.path,e)):null}function Pf(t){const e=[],s=t.writeTree_.value;return null!=s?s.isLeafNode()||s.forEachChild(wp,((t,s)=>{e.push(new ep(t,s))})):t.writeTree_.children.inorderTraversal(((t,s)=>{null!=s.value&&e.push(new ep(t,s.value))})),e}function Af(t,e){if(jg(e))return t;{const s=If(t,e);return new Tf(null!=s?new Sf(s):t.writeTree_.subtree(e))}}function Mf(t){return t.writeTree_.isEmpty()}function Rf(t,e){return Lf(Eg(),t.writeTree_,e)}function Lf(t,e,s){if(null!=e.value)return s.updateChild(t,e.value);{let i=null;return e.children.inorderTraversal(((e,n)=>{".priority"===e?(El(null!==n.value,"Priority writes must always be leaf nodes"),i=n.value):s=Lf(Fg(t,e),n,s)})),s.getChild(t).isEmpty()||null===i||(s=s.updateChild(Fg(t,".priority"),i)),s}}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Ff(t,e){return nm(e,t)}function jf(t,e,s,i,n){El(i>t.lastWriteId,"Stacking an older write on top of newer ones"),void 0===n&&(n=!0),t.allWrites.push({path:e,snap:s,writeId:i,visible:n}),n&&(t.visibleWrites=kf(t.visibleWrites,e,s)),t.lastWriteId=i}function Nf(t,e){for(let s=0;s<t.allWrites.length;s++){const i=t.allWrites[s];if(i.writeId===e)return i}return null}function Bf(t,e){const s=t.allWrites.findIndex((t=>t.writeId===e));El(s>=0,"removeWrite called with nonexistent writeId.");const i=t.allWrites[s];t.allWrites.splice(s,1);let n=i.visible,r=!1,o=t.allWrites.length-1;while(n&&o>=0){const e=t.allWrites[o];e.visible&&(o>=s&&Wf(e,i.path)?n=!1:Wg(i.path,e.path)&&(r=!0)),o--}if(n){if(r)return Xf(t),!0;if(i.snap)t.visibleWrites=Ef(t.visibleWrites,i.path);else{const e=i.children;id(e,(e=>{t.visibleWrites=Ef(t.visibleWrites,Fg(i.path,e))}))}return!0}return!1}function Wf(t,e){if(t.snap)return Wg(t.path,e);for(const s in t.children)if(t.children.hasOwnProperty(s)&&Wg(Fg(t.path,s),e))return!0;return!1}function Xf(t){t.visibleWrites=Vf(t.allWrites,Yf,Eg()),t.allWrites.length>0?t.lastWriteId=t.allWrites[t.allWrites.length-1].writeId:t.lastWriteId=-1}function Yf(t){return t.visible}function Vf(t,e,s){let i=Tf.empty();for(let n=0;n<t.length;++n){const r=t[n];if(e(r)){const t=r.path;let e;if(r.snap)Wg(s,t)?(e=Ng(s,t),i=kf(i,e,r.snap)):Wg(t,s)&&(e=Ng(t,s),i=kf(i,Eg(),r.snap.getChild(e)));else{if(!r.children)throw Dl("WriteRecord should have .snap or .children");if(Wg(s,t))e=Ng(s,t),i=Of(i,e,r.children);else if(Wg(t,s))if(e=Ng(t,s),jg(e))i=Of(i,Eg(),r.children);else{const t=bh(r.children,Dg(e));if(t){const s=t.getChild(Pg(e));i=kf(i,Eg(),s)}}}}}return i}function Hf(t,e,s,i,n){if(i||n){const r=Af(t.visibleWrites,e);if(!n&&Mf(r))return s;if(n||null!=s||Df(r,Eg())){const r=function(t){return(t.visible||n)&&(!i||!~i.indexOf(t.writeId))&&(Wg(t.path,e)||Wg(e,t.path))},o=Vf(t.allWrites,r,e),a=s||Pp.EMPTY_NODE;return Rf(o,a)}return null}{const i=If(t.visibleWrites,e);if(null!=i)return i;{const i=Af(t.visibleWrites,e);if(Mf(i))return s;if(null!=s||Df(i,Eg())){const t=s||Pp.EMPTY_NODE;return Rf(i,t)}return null}}}function zf(t,e,s){let i=Pp.EMPTY_NODE;const n=If(t.visibleWrites,e);if(n)return n.isLeafNode()||n.forEachChild(wp,((t,e)=>{i=i.updateImmediateChild(t,e)})),i;if(s){const n=Af(t.visibleWrites,e);return s.forEachChild(wp,((t,e)=>{const s=Rf(Af(n,new Og(t)),e);i=i.updateImmediateChild(t,s)})),Pf(n).forEach((t=>{i=i.updateImmediateChild(t.name,t.node)})),i}{const s=Af(t.visibleWrites,e);return Pf(s).forEach((t=>{i=i.updateImmediateChild(t.name,t.node)})),i}}function Gf(t,e,s,i,n){El(i||n,"Either existingEventSnap or existingServerSnap must exist");const r=Fg(e,s);if(Df(t.visibleWrites,r))return null;{const e=Af(t.visibleWrites,r);return Mf(e)?n.getChild(s):Rf(e,n.getChild(s))}}function Uf(t,e,s,i){const n=Fg(e,s),r=If(t.visibleWrites,n);if(null!=r)return r;if(i.isCompleteForChild(s)){const e=Af(t.visibleWrites,n);return Rf(e,i.getNode().getImmediateChild(s))}return null}function qf(t,e){return If(t.visibleWrites,e)}function Kf(t,e,s,i,n,r,o){let a;const l=Af(t.visibleWrites,e),h=If(l,Eg());if(null!=h)a=h;else{if(null==s)return[];a=Rf(l,s)}if(a=a.withIndex(o),a.isEmpty()||a.isLeafNode())return[];{const t=[],e=o.getCompare(),s=r?a.getReverseIteratorFrom(i,o):a.getIteratorFrom(i,o);let l=s.getNext();while(l&&t.length<n)0!==e(l,i)&&t.push(l),l=s.getNext();return t}}function $f(){return{visibleWrites:Tf.empty(),allWrites:[],lastWriteId:-1}}function Qf(t,e,s,i){return Hf(t.writeTree,t.treePath,e,s,i)}function Jf(t,e){return zf(t.writeTree,t.treePath,e)}function Zf(t,e,s,i){return Gf(t.writeTree,t.treePath,e,s,i)}function tm(t,e){return qf(t.writeTree,Fg(t.treePath,e))}function em(t,e,s,i,n,r){return Kf(t.writeTree,t.treePath,e,s,i,n,r)}function sm(t,e,s){return Uf(t.writeTree,t.treePath,e,s)}function im(t,e){return nm(Fg(t.treePath,e),t.writeTree)}function nm(t,e){return{treePath:t,writeTree:e}}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class rm{constructor(){this.changeMap=new Map}trackChildChange(t){const e=t.type,s=t.childName;El("child_added"===e||"child_changed"===e||"child_removed"===e,"Only child changes supported for tracking"),El(".priority"!==s,"Only non-priority child changes can be tracked.");const i=this.changeMap.get(s);if(i){const n=i.type;if("child_added"===e&&"child_removed"===n)this.changeMap.set(s,Yp(s,t.snapshotNode,i.snapshotNode));else if("child_removed"===e&&"child_added"===n)this.changeMap.delete(s);else if("child_removed"===e&&"child_changed"===n)this.changeMap.set(s,Xp(s,i.oldSnap));else if("child_changed"===e&&"child_added"===n)this.changeMap.set(s,Wp(s,t.snapshotNode));else{if("child_changed"!==e||"child_changed"!==n)throw Dl("Illegal combination of changes: "+t+" occurred after "+i);this.changeMap.set(s,Yp(s,t.snapshotNode,i.oldSnap))}}else this.changeMap.set(s,t)}getChanges(){return Array.from(this.changeMap.values())}}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class om{getCompleteChild(t){return null}getChildAfterChild(t,e,s){return null}}const am=new om;class lm{constructor(t,e,s=null){this.writes_=t,this.viewCache_=e,this.optCompleteServerCache_=s}getCompleteChild(t){const e=this.viewCache_.eventCache;if(e.isCompleteForChild(t))return e.getNode().getImmediateChild(t);{const e=null!=this.optCompleteServerCache_?new df(this.optCompleteServerCache_,!0,!1):this.viewCache_.serverCache;return sm(this.writes_,t,e)}}getChildAfterChild(t,e,s){const i=null!=this.optCompleteServerCache_?this.optCompleteServerCache_:Cf(this.viewCache_),n=em(this.writes_,i,e,1,s,t);return 0===n.length?null:n[0]}}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function hm(t,e){El(e.eventCache.getNode().isIndexed(t.filter.getIndex()),"Event snap not indexed"),El(e.serverCache.getNode().isIndexed(t.filter.getIndex()),"Server snap not indexed")}function cm(t,e,s,i,n){const r=new rm;let o,a;if(s.type===rf.OVERWRITE){const l=s;l.source.fromUser?o=pm(t,e,l.path,l.snap,i,n,r):(El(l.source.fromServer,"Unknown source."),a=l.source.tagged||e.serverCache.isFiltered()&&!jg(l.path),o=gm(t,e,l.path,l.snap,i,n,a,r))}else if(s.type===rf.MERGE){const l=s;l.source.fromUser?o=mm(t,e,l.path,l.children,i,n,r):(El(l.source.fromServer,"Unknown source."),a=l.source.tagged||e.serverCache.isFiltered(),o=vm(t,e,l.path,l.children,i,n,a,r))}else if(s.type===rf.ACK_USER_WRITE){const a=s;o=a.revert?Cm(t,e,a.path,i,n,r):ym(t,e,a.path,a.affectedTree,i,n,r)}else{if(s.type!==rf.LISTEN_COMPLETE)throw Dl("Unknown operation type: "+s.type);o=bm(t,e,s.path,i,r)}const l=r.getChanges();return um(e,o,l),{viewCache:o,changes:l}}function um(t,e,s){const i=e.eventCache;if(i.isFullyInitialized()){const n=i.getNode().isLeafNode()||i.getNode().isEmpty(),r=bf(t);(s.length>0||!t.eventCache.isFullyInitialized()||n&&!i.getNode().equals(r)||!i.getNode().getPriority().equals(r.getPriority()))&&s.push(Bp(bf(e)))}}function dm(t,e,s,i,n,r){const o=e.eventCache;if(null!=tm(i,s))return e;{let a,l;if(jg(s))if(El(e.serverCache.isFullyInitialized(),"If change path is empty, we must have complete server data"),e.serverCache.isFiltered()){const s=Cf(e),n=s instanceof Pp?s:Pp.EMPTY_NODE,o=Jf(i,n);a=t.filter.updateFullNode(e.eventCache.getNode(),o,r)}else{const s=Qf(i,Cf(e));a=t.filter.updateFullNode(e.eventCache.getNode(),s,r)}else{const h=Dg(s);if(".priority"===h){El(1===Ig(s),"Can't have a priority with additional path components");const n=o.getNode();l=e.serverCache.getNode();const r=Zf(i,s,n,l);a=null!=r?t.filter.updatePriority(n,r):o.getNode()}else{const c=Pg(s);let u;if(o.isCompleteForChild(h)){l=e.serverCache.getNode();const t=Zf(i,s,o.getNode(),l);u=null!=t?o.getNode().getImmediateChild(h).updateChild(c,t):o.getNode().getImmediateChild(h)}else u=sm(i,h,e.serverCache);a=null!=u?t.filter.updateChild(o.getNode(),h,u,c,n,r):o.getNode()}}return vf(e,a,o.isFullyInitialized()||jg(s),t.filter.filtersNodes())}}function gm(t,e,s,i,n,r,o,a){const l=e.serverCache;let h;const c=o?t.filter:t.filter.getIndexedFilter();if(jg(s))h=c.updateFullNode(l.getNode(),i,null);else if(c.filtersNodes()&&!l.isFiltered()){const t=l.getNode().updateChild(s,i);h=c.updateFullNode(l.getNode(),t,null)}else{const t=Dg(s);if(!l.isCompleteForPath(s)&&Ig(s)>1)return e;const n=Pg(s),r=l.getNode().getImmediateChild(t),o=r.updateChild(n,i);h=".priority"===t?c.updatePriority(l.getNode(),o):c.updateChild(l.getNode(),t,o,n,am,null)}const u=yf(e,h,l.isFullyInitialized()||jg(s),c.filtersNodes()),d=new lm(n,u,r);return dm(t,u,s,n,d,a)}function pm(t,e,s,i,n,r,o){const a=e.eventCache;let l,h;const c=new lm(n,e,r);if(jg(s))h=t.filter.updateFullNode(e.eventCache.getNode(),i,o),l=vf(e,h,!0,t.filter.filtersNodes());else{const n=Dg(s);if(".priority"===n)h=t.filter.updatePriority(e.eventCache.getNode(),i),l=vf(e,h,a.isFullyInitialized(),a.isFiltered());else{const r=Pg(s),h=a.getNode().getImmediateChild(n);let u;if(jg(r))u=i;else{const t=c.getCompleteChild(n);u=null!=t?".priority"===Ag(r)&&t.getChild(Lg(r)).isEmpty()?t:t.updateChild(r,i):Pp.EMPTY_NODE}if(h.equals(u))l=e;else{const s=t.filter.updateChild(a.getNode(),n,u,r,c,o);l=vf(e,s,a.isFullyInitialized(),t.filter.filtersNodes())}}}return l}function fm(t,e){return t.eventCache.isCompleteForChild(e)}function mm(t,e,s,i,n,r,o){let a=e;return i.foreach(((i,l)=>{const h=Fg(s,i);fm(e,Dg(h))&&(a=pm(t,a,h,l,n,r,o))})),i.foreach(((i,l)=>{const h=Fg(s,i);fm(e,Dg(h))||(a=pm(t,a,h,l,n,r,o))})),a}function _m(t,e,s){return s.foreach(((t,s)=>{e=e.updateChild(t,s)})),e}function vm(t,e,s,i,n,r,o,a){if(e.serverCache.getNode().isEmpty()&&!e.serverCache.isFullyInitialized())return e;let l,h=e;l=jg(s)?i:new Sf(null).setTree(s,i);const c=e.serverCache.getNode();return l.children.inorderTraversal(((s,i)=>{if(c.hasChild(s)){const l=e.serverCache.getNode().getImmediateChild(s),c=_m(t,l,i);h=gm(t,h,new Og(s),c,n,r,o,a)}})),l.children.inorderTraversal(((s,i)=>{const l=!e.serverCache.isCompleteForChild(s)&&null===i.value;if(!c.hasChild(s)&&!l){const l=e.serverCache.getNode().getImmediateChild(s),c=_m(t,l,i);h=gm(t,h,new Og(s),c,n,r,o,a)}})),h}function ym(t,e,s,i,n,r,o){if(null!=tm(n,s))return e;const a=e.serverCache.isFiltered(),l=e.serverCache;if(null!=i.value){if(jg(s)&&l.isFullyInitialized()||l.isCompleteForPath(s))return gm(t,e,s,l.getNode().getChild(s),n,r,a,o);if(jg(s)){let i=new Sf(null);return l.getNode().forEachChild(rp,((t,e)=>{i=i.set(new Og(t),e)})),vm(t,e,s,i,n,r,a,o)}return e}{let h=new Sf(null);return i.foreach(((t,e)=>{const i=Fg(s,t);l.isCompleteForPath(i)&&(h=h.set(t,l.getNode().getChild(i)))})),vm(t,e,s,h,n,r,a,o)}}function bm(t,e,s,i,n){const r=e.serverCache,o=yf(e,r.getNode(),r.isFullyInitialized()||jg(s),r.isFiltered());return dm(t,o,s,i,am,n)}function Cm(t,e,s,i,n,r){let o;if(null!=tm(i,s))return e;{const a=new lm(i,e,n),l=e.eventCache.getNode();let h;if(jg(s)||".priority"===Dg(s)){let s;if(e.serverCache.isFullyInitialized())s=Qf(i,Cf(e));else{const t=e.serverCache.getNode();El(t instanceof Pp,"serverChildren would be complete if leaf node"),s=Jf(i,t)}h=t.filter.updateFullNode(l,s,r)}else{const n=Dg(s);let c=sm(i,n,e.serverCache);null==c&&e.serverCache.isCompleteForChild(n)&&(c=l.getImmediateChild(n)),h=null!=c?t.filter.updateChild(l,n,c,Pg(s),a,r):e.eventCache.getNode().hasChild(n)?t.filter.updateChild(l,n,Pp.EMPTY_NODE,Pg(s),a,r):l,h.isEmpty()&&e.serverCache.isFullyInitialized()&&(o=Qf(i,Cf(e)),o.isLeafNode()&&(h=t.filter.updateFullNode(h,o,r)))}return o=e.serverCache.isFullyInitialized()||null!=tm(i,Eg()),vf(e,h,o,t.filter.filtersNodes())}}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function xm(t,e){const s=Cf(t.viewCache_);return s&&(t.query._queryParams.loadsAllData()||!jg(e)&&!s.getImmediateChild(Dg(e)).isEmpty())?s.getChild(e):null}function wm(t,e,s,i){e.type===rf.MERGE&&null!==e.source.queryId&&(El(Cf(t.viewCache_),"We should always have a full cache before handling merges"),El(bf(t.viewCache_),"Missing event cache, even though we have a server cache"));const n=t.viewCache_,r=cm(t.processor_,n,e,s,i);return hm(t.processor_,r.viewCache),El(r.viewCache.serverCache.isFullyInitialized()||!n.serverCache.isFullyInitialized(),"Once a server snap is complete, it should never go back"),t.viewCache_=r.viewCache,Sm(t,r.changes,r.viewCache.eventCache.getNode(),null)}function Sm(t,e,s,i){const n=i?[i]:t.eventRegistrations_;return gf(t.eventGenerator_,e,s,n)}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let Tm,km;function Om(t){El(!Tm,"__referenceConstructor has already been defined"),Tm=t}function Em(t,e,s,i){const n=e.source.queryId;if(null!==n){const r=t.views.get(n);return El(null!=r,"SyncTree gave us an op for an invalid query."),wm(r,e,s,i)}{let n=[];for(const r of t.views.values())n=n.concat(wm(r,e,s,i));return n}}function Dm(t,e){let s=null;for(const i of t.views.values())s=s||xm(i,e);return s}function Im(t){El(!km,"__referenceConstructor has already been defined"),km=t}class Pm{constructor(t){this.listenProvider_=t,this.syncPointTree_=new Sf(null),this.pendingWriteTree_=$f(),this.tagToQueryMap=new Map,this.queryToTagMap=new Map}}function Am(t,e,s,i,n){return jf(t.pendingWriteTree_,e,s,i,n),n?Bm(t,new cf(of(),e,s)):[]}function Mm(t,e,s=!1){const i=Nf(t.pendingWriteTree_,e),n=Bf(t.pendingWriteTree_,e);if(n){let e=new Sf(null);return null!=i.snap?e=e.set(Eg(),!0):id(i.children,(t=>{e=e.set(new Og(t),!0)})),Bm(t,new hf(i.path,e,s))}return[]}function Rm(t,e,s){return Bm(t,new cf(af(),e,s))}function Lm(t,e,s){const i=Sf.fromObject(s);return Bm(t,new uf(af(),e,i))}function Fm(t,e,s,i){const n=Ym(t,i);if(null!=n){const i=Vm(n),r=i.path,o=i.queryId,a=Ng(r,e),l=new cf(lf(o),a,s);return Hm(t,r,l)}return[]}function jm(t,e,s,i){const n=Ym(t,i);if(n){const i=Vm(n),r=i.path,o=i.queryId,a=Ng(r,e),l=Sf.fromObject(s),h=new uf(lf(o),a,l);return Hm(t,r,h)}return[]}function Nm(t,e,s){const i=!0,n=t.pendingWriteTree_,r=t.syncPointTree_.findOnPath(e,((t,s)=>{const i=Ng(t,e),n=Dm(s,i);if(n)return n}));return Hf(n,e,r,s,i)}function Bm(t,e){return Wm(e,t.syncPointTree_,null,Ff(t.pendingWriteTree_,Eg()))}function Wm(t,e,s,i){if(jg(t.path))return Xm(t,e,s,i);{const n=e.get(Eg());null==s&&null!=n&&(s=Dm(n,Eg()));let r=[];const o=Dg(t.path),a=t.operationForChild(o),l=e.children.get(o);if(l&&a){const t=s?s.getImmediateChild(o):null,e=im(i,o);r=r.concat(Wm(a,l,t,e))}return n&&(r=r.concat(Em(n,t,i,s))),r}}function Xm(t,e,s,i){const n=e.get(Eg());null==s&&null!=n&&(s=Dm(n,Eg()));let r=[];return e.children.inorderTraversal(((e,n)=>{const o=s?s.getImmediateChild(e):null,a=im(i,e),l=t.operationForChild(e);l&&(r=r.concat(Xm(l,n,o,a)))})),n&&(r=r.concat(Em(n,t,i,s))),r}function Ym(t,e){return t.tagToQueryMap.get(e)}function Vm(t){const e=t.indexOf("$");return El(-1!==e&&e<t.length-1,"Bad queryKey."),{queryId:t.substr(e+1),path:new Og(t.substr(0,e))}}function Hm(t,e,s){const i=t.syncPointTree_.get(e);El(i,"Missing sync point for query tag that we're tracking");const n=Ff(t.pendingWriteTree_,e);return Em(i,s,n,null)}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
class zm{constructor(t){this.node_=t}getImmediateChild(t){const e=this.node_.getImmediateChild(t);return new zm(e)}node(){return this.node_}}class Gm{constructor(t,e){this.syncTree_=t,this.path_=e}getImmediateChild(t){const e=Fg(this.path_,t);return new Gm(this.syncTree_,e)}node(){return Nm(this.syncTree_,this.path_)}}const Um=function(t){return t=t||{},t["timestamp"]=t["timestamp"]||(new Date).getTime(),t},qm=function(t,e,s){return t&&"object"===typeof t?(El(".sv"in t,"Unexpected leaf node or priority contents"),"string"===typeof t[".sv"]?Km(t[".sv"],e,s):"object"===typeof t[".sv"]?$m(t[".sv"],e):void El(!1,"Unexpected server value: "+JSON.stringify(t,null,2))):t},Km=function(t,e,s){switch(t){case"timestamp":return s["timestamp"];default:El(!1,"Unexpected server value: "+t)}},$m=function(t,e,s){t.hasOwnProperty("increment")||El(!1,"Unexpected server value: "+JSON.stringify(t,null,2));const i=t["increment"];"number"!==typeof i&&El(!1,"Unexpected increment value: "+i);const n=e.node();if(El(null!==n&&"undefined"!==typeof n,"Expected ChildrenNode.EMPTY_NODE for nulls"),!n.isLeafNode())return i;const r=n,o=r.getValue();return"number"!==typeof o?i:o+i},Qm=function(t,e,s,i){return Zm(e,new Gm(s,t),i)},Jm=function(t,e,s){return Zm(t,new zm(e),s)};function Zm(t,e,s){const i=t.getPriority().val(),n=qm(i,e.getImmediateChild(".priority"),s);let r;if(t.isLeafNode()){const i=t,r=qm(i.getValue(),e,s);return r!==i.getValue()||n!==i.getPriority().val()?new yp(r,Lp(n)):t}{const i=t;return r=i,n!==i.getPriority().val()&&(r=r.updatePriority(new yp(n))),i.forEachChild(wp,((t,i)=>{const n=Zm(i,e.getImmediateChild(t),s);n!==i&&(r=r.updateImmediateChild(t,n))})),r}}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class t_{constructor(t="",e=null,s={children:{},childCount:0}){this.name=t,this.parent=e,this.node=s}}function e_(t,e){let s=e instanceof Og?e:new Og(e),i=t,n=Dg(s);while(null!==n){const t=bh(i.node.children,n)||{children:{},childCount:0};i=new t_(n,i,t),s=Pg(s),n=Dg(s)}return i}function s_(t){return t.node.value}function i_(t,e){t.node.value=e,c_(t)}function n_(t){return t.node.childCount>0}function r_(t){return void 0===s_(t)&&!n_(t)}function o_(t,e){id(t.node.children,((s,i)=>{e(new t_(s,t,i))}))}function a_(t,e,s,i){s&&!i&&e(t),o_(t,(t=>{a_(t,e,!0,i)})),s&&i&&e(t)}function l_(t,e,s){let i=s?t:t.parent;while(null!==i){if(e(i))return!0;i=i.parent}return!1}function h_(t){return new Og(null===t.parent?t.name:h_(t.parent)+"/"+t.name)}function c_(t){null!==t.parent&&u_(t.parent,t.name,t)}function u_(t,e,s){const i=r_(s),n=yh(t.node.children,e);i&&n?(delete t.node.children[e],t.node.childCount--,c_(t)):i||n||(t.node.children[e]=s.node,t.node.childCount++,c_(t))}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const d_=/[\[\].#$\/\u0000-\u001F\u007F]/,g_=/[\[\].#$\u0000-\u001F\u007F]/,p_=10485760,f_=function(t){return"string"===typeof t&&0!==t.length&&!d_.test(t)},m_=function(t){return"string"===typeof t&&0!==t.length&&!g_.test(t)},__=function(t){return t&&(t=t.replace(/^\/*\.info(\/|$)/,"/")),m_(t)},v_=function(t,e,s){const i=s instanceof Og?new Xg(s,t):s;if(void 0===e)throw new Error(t+"contains undefined "+zg(i));if("function"===typeof e)throw new Error(t+"contains a function "+zg(i)+" with contents = "+e.toString());if(qu(e))throw new Error(t+"contains "+e.toString()+" "+zg(i));if("string"===typeof e&&e.length>p_/3&&Dh(e)>p_)throw new Error(t+"contains a string greater than "+p_+" utf8 bytes "+zg(i)+" ('"+e.substring(0,50)+"...')");if(e&&"object"===typeof e){let s=!1,n=!1;if(id(e,((e,r)=>{if(".value"===e)s=!0;else if(".priority"!==e&&".sv"!==e&&(n=!0,!f_(e)))throw new Error(t+" contains an invalid key ("+e+") "+zg(i)+'.  Keys must be non-empty strings and can\'t contain ".", "#", "$", "/", "[", or "]"');Yg(i,e),v_(t,r,i),Vg(i)})),s&&n)throw new Error(t+' contains ".value" child '+zg(i)+" in addition to actual children.")}},y_=function(t,e){const s=e.path.toString();if("string"!==typeof e.repoInfo.host||0===e.repoInfo.host.length||!f_(e.repoInfo.namespace)&&"localhost"!==e.repoInfo.host.split(":")[0]||0!==s.length&&!__(s))throw new Error(Oh(t,"url")+'must be a valid firebase URL and the path can\'t contain ".", "#", "$", "[", or "]".')};
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
class b_{constructor(){this.eventLists_=[],this.recursionDepth_=0}}function C_(t,e){let s=null;for(let i=0;i<e.length;i++){const n=e[i],r=n.getPath();null===s||Bg(r,s.path)||(t.eventLists_.push(s),s=null),null===s&&(s={events:[],path:r}),s.events.push(n)}s&&t.eventLists_.push(s)}function x_(t,e,s){C_(t,s),w_(t,(t=>Wg(t,e)||Wg(e,t)))}function w_(t,e){t.recursionDepth_++;let s=!0;for(let i=0;i<t.eventLists_.length;i++){const n=t.eventLists_[i];if(n){const r=n.path;e(r)?(S_(t.eventLists_[i]),t.eventLists_[i]=null):s=!1}}s&&(t.eventLists_=[]),t.recursionDepth_--}function S_(t){for(let e=0;e<t.events.length;e++){const s=t.events[e];if(null!==s){t.events[e]=null;const i=s.getEventRunner();Bu&&Yu("event: "+s.toString()),ud(i)}}}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const T_="repo_interrupt",k_=25;class O_{constructor(t,e,s,i){this.repoInfo_=t,this.forceRestClient_=e,this.authTokenProvider_=s,this.appCheckProvider_=i,this.dataUpdateCount=0,this.statsListener_=null,this.eventQueue_=new b_,this.nextWriteId_=1,this.interceptServerDataCallback_=null,this.onDisconnect_=Kp(),this.transactionQueueTree_=new t_,this.persistentConnection_=null,this.key=this.repoInfo_.toURLString()}toString(){return(this.repoInfo_.secure?"https://":"http://")+this.repoInfo_.host}}function E_(t,e,s){if(t.stats_=Rd(t.repoInfo_),t.forceRestClient_||dd())t.server_=new Up(t.repoInfo_,((e,s,i,n)=>{P_(t,e,s,i,n)}),t.authTokenProvider_,t.appCheckProvider_),setTimeout((()=>A_(t,!0)),0);else{if("undefined"!==typeof s&&null!==s){if("object"!==typeof s)throw new Error("Only objects are supported for option databaseAuthVariableOverride");try{fh(s)}catch(h){throw new Error("Invalid authOverride provided: "+h)}}t.persistentConnection_=new tp(t.repoInfo_,e,((e,s,i,n)=>{P_(t,e,s,i,n)}),(e=>{A_(t,e)}),(e=>{M_(t,e)}),t.authTokenProvider_,t.appCheckProvider_,s),t.server_=t.persistentConnection_}t.authTokenProvider_.addTokenChangeListener((e=>{t.server_.refreshAuthToken(e)})),t.appCheckProvider_.addTokenChangeListener((e=>{t.server_.refreshAppCheckToken(e.token)})),t.statsReporter_=Ld(t.repoInfo_,(()=>new nf(t.stats_,t.server_))),t.infoData_=new qp,t.infoSyncTree_=new Pm({startListening:(e,s,i,n)=>{let r=[];const o=t.infoData_.getNode(e._path);return o.isEmpty()||(r=Rm(t.infoSyncTree_,e._path,o),setTimeout((()=>{n("ok")}),0)),r},stopListening:()=>{}}),R_(t,"connected",!1),t.serverSyncTree_=new Pm({startListening:(e,s,i,n)=>(t.server_.listen(e,i,s,((s,i)=>{const r=n(s,i);x_(t.eventQueue_,e._path,r)})),[]),stopListening:(e,s)=>{t.server_.unlisten(e,s)}})}function D_(t){const e=t.infoData_.getNode(new Og(".info/serverTimeOffset")),s=e.val()||0;return(new Date).getTime()+s}function I_(t){return Um({timestamp:D_(t)})}function P_(t,e,s,i,n){t.dataUpdateCount++;const r=new Og(e);s=t.interceptServerDataCallback_?t.interceptServerDataCallback_(e,s):s;let o=[];if(n)if(i){const e=xh(s,(t=>Lp(t)));o=jm(t.serverSyncTree_,r,e,n)}else{const e=Lp(s);o=Fm(t.serverSyncTree_,r,e,n)}else if(i){const e=xh(s,(t=>Lp(t)));o=Lm(t.serverSyncTree_,r,e)}else{const e=Lp(s);o=Rm(t.serverSyncTree_,r,e)}let a=r;o.length>0&&(a=Y_(t,r)),x_(t.eventQueue_,a,o)}function A_(t,e){R_(t,"connected",e),!1===e&&F_(t)}function M_(t,e){id(e,((e,s)=>{R_(t,e,s)}))}function R_(t,e,s){const i=new Og("/.info/"+e),n=Lp(s);t.infoData_.updateSnapshot(i,n);const r=Rm(t.infoSyncTree_,i,n);x_(t.eventQueue_,i,r)}function L_(t){return t.nextWriteId_++}function F_(t){N_(t,"onDisconnectEvents");const e=I_(t),s=Kp();Qp(t.onDisconnect_,Eg(),((i,n)=>{const r=Qm(i,n,t.serverSyncTree_,e);$p(s,i,r)}));let i=[];Qp(s,Eg(),((e,s)=>{i=i.concat(Rm(t.serverSyncTree_,e,s));const n=q_(t,e);Y_(t,n)})),t.onDisconnect_=Kp(),x_(t.eventQueue_,Eg(),i)}function j_(t){t.persistentConnection_&&t.persistentConnection_.interrupt(T_)}function N_(t,...e){let s="";t.persistentConnection_&&(s=t.persistentConnection_.id+":"),Yu(s,...e)}function B_(t,e,s){return Nm(t.serverSyncTree_,e,s)||Pp.EMPTY_NODE}function W_(t,e=t.transactionQueueTree_){if(e||U_(t,e),s_(e)){const s=z_(t,e);El(s.length>0,"Sending zero length transaction queue");const i=s.every((t=>0===t.status));i&&X_(t,h_(e),s)}else n_(e)&&o_(e,(e=>{W_(t,e)}))}function X_(t,e,s){const i=s.map((t=>t.currentWriteId)),n=B_(t,e,i);let r=n;const o=n.hash();for(let h=0;h<s.length;h++){const t=s[h];El(0===t.status,"tryToSendTransactionQueue_: items in queue should all be run."),t.status=1,t.retryCount++;const i=Ng(e,t.path);r=r.updateChild(i,t.currentOutputSnapshotRaw)}const a=r.val(!0),l=e;t.server_.put(l.toString(),a,(i=>{N_(t,"transaction put response",{path:l.toString(),status:i});let n=[];if("ok"===i){const i=[];for(let e=0;e<s.length;e++)s[e].status=2,n=n.concat(Mm(t.serverSyncTree_,s[e].currentWriteId)),s[e].onComplete&&i.push((()=>s[e].onComplete(null,!0,s[e].currentOutputSnapshotResolved))),s[e].unwatcher();U_(t,e_(t.transactionQueueTree_,e)),W_(t,t.transactionQueueTree_),x_(t.eventQueue_,e,n);for(let t=0;t<i.length;t++)ud(i[t])}else{if("datastale"===i)for(let t=0;t<s.length;t++)3===s[t].status?s[t].status=4:s[t].status=0;else{Gu("transaction at "+l.toString()+" failed: "+i);for(let t=0;t<s.length;t++)s[t].status=4,s[t].abortReason=i}Y_(t,e)}}),o)}function Y_(t,e){const s=H_(t,e),i=h_(s),n=z_(t,s);return V_(t,n,i),i}function V_(t,e,s){if(0===e.length)return;const i=[];let n=[];const r=e.filter((t=>0===t.status)),o=r.map((t=>t.currentWriteId));for(let a=0;a<e.length;a++){const r=e[a],l=Ng(s,r.path);let h,c=!1;if(El(null!==l,"rerunTransactionsUnderNode_: relativePath should not be null."),4===r.status)c=!0,h=r.abortReason,n=n.concat(Mm(t.serverSyncTree_,r.currentWriteId,!0));else if(0===r.status)if(r.retryCount>=k_)c=!0,h="maxretry",n=n.concat(Mm(t.serverSyncTree_,r.currentWriteId,!0));else{const s=B_(t,r.path,o);r.currentInputSnapshot=s;const i=e[a].update(s.val());if(void 0!==i){v_("transaction failed: Data returned ",i,r.path);let e=Lp(i);const a="object"===typeof i&&null!=i&&yh(i,".priority");a||(e=e.updatePriority(s.getPriority()));const l=r.currentWriteId,h=I_(t),c=Jm(e,s,h);r.currentOutputSnapshotRaw=e,r.currentOutputSnapshotResolved=c,r.currentWriteId=L_(t),o.splice(o.indexOf(l),1),n=n.concat(Am(t.serverSyncTree_,r.path,c,r.currentWriteId,r.applyLocally)),n=n.concat(Mm(t.serverSyncTree_,l,!0))}else c=!0,h="nodata",n=n.concat(Mm(t.serverSyncTree_,r.currentWriteId,!0))}x_(t.eventQueue_,s,n),n=[],c&&(e[a].status=2,function(t){setTimeout(t,Math.floor(0))}(e[a].unwatcher),e[a].onComplete&&("nodata"===h?i.push((()=>e[a].onComplete(null,!1,e[a].currentInputSnapshot))):i.push((()=>e[a].onComplete(new Error(h),!1,null)))))}U_(t,t.transactionQueueTree_);for(let a=0;a<i.length;a++)ud(i[a]);W_(t,t.transactionQueueTree_)}function H_(t,e){let s,i=t.transactionQueueTree_;s=Dg(e);while(null!==s&&void 0===s_(i))i=e_(i,s),e=Pg(e),s=Dg(e);return i}function z_(t,e){const s=[];return G_(t,e,s),s.sort(((t,e)=>t.order-e.order)),s}function G_(t,e,s){const i=s_(e);if(i)for(let n=0;n<i.length;n++)s.push(i[n]);o_(e,(e=>{G_(t,e,s)}))}function U_(t,e){const s=s_(e);if(s){let t=0;for(let e=0;e<s.length;e++)2!==s[e].status&&(s[t]=s[e],t++);s.length=t,i_(e,s.length>0?s:void 0)}o_(e,(e=>{U_(t,e)}))}function q_(t,e){const s=h_(H_(t,e)),i=e_(t.transactionQueueTree_,e);return l_(i,(e=>{K_(t,e)})),K_(t,i),a_(i,(e=>{K_(t,e)})),s}function K_(t,e){const s=s_(e);if(s){const i=[];let n=[],r=-1;for(let e=0;e<s.length;e++)3===s[e].status||(1===s[e].status?(El(r===e-1,"All SENT items should be at beginning of queue."),r=e,s[e].status=3,s[e].abortReason="set"):(El(0===s[e].status,"Unexpected transaction status in abort"),s[e].unwatcher(),n=n.concat(Mm(t.serverSyncTree_,s[e].currentWriteId,!0)),s[e].onComplete&&i.push(s[e].onComplete.bind(null,new Error("set"),!1,null))));-1===r?i_(e,void 0):s.length=r+1,x_(t.eventQueue_,h_(e),n);for(let t=0;t<i.length;t++)ud(i[t])}}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function $_(t){let e="";const s=t.split("/");for(let i=0;i<s.length;i++)if(s[i].length>0){let t=s[i];try{t=decodeURIComponent(t.replace(/\+/g," "))}catch(h){}e+="/"+t}return e}function Q_(t){const e={};"?"===t.charAt(0)&&(t=t.substring(1));for(const s of t.split("&")){if(0===s.length)continue;const i=s.split("=");2===i.length?e[decodeURIComponent(i[0])]=decodeURIComponent(i[1]):Gu(`Invalid query segment '${s}' in query '${t}'`)}return e}const J_=function(t,e){const s=Z_(t),i=s.namespace;"firebase.com"===s.domain&&zu(s.host+" is no longer supported. Please use <YOUR FIREBASE>.firebaseio.com instead"),i&&"undefined"!==i||"localhost"===s.domain||zu("Cannot parse Firebase url. Please use https://<YOUR FIREBASE>.firebaseio.com"),s.secure||Uu();const n="ws"===s.scheme||"wss"===s.scheme;return{repoInfo:new Ed(s.host,s.secure,i,n,e,"",i!==s.subdomain),path:new Og(s.pathString)}},Z_=function(t){let e="",s="",i="",n="",r="",o=!0,a="https",l=443;if("string"===typeof t){let h=t.indexOf("//");h>=0&&(a=t.substring(0,h-1),t=t.substring(h+2));let c=t.indexOf("/");-1===c&&(c=t.length);let u=t.indexOf("?");-1===u&&(u=t.length),e=t.substring(0,Math.min(c,u)),c<u&&(n=$_(t.substring(c,u)));const d=Q_(t.substring(Math.min(t.length,u)));h=e.indexOf(":"),h>=0?(o="https"===a||"wss"===a,l=parseInt(e.substring(h+1),10)):h=e.length;const g=e.slice(0,h);if("localhost"===g.toLowerCase())s="localhost";else if(g.split(".").length<=2)s=g;else{const t=e.indexOf(".");i=e.substring(0,t).toLowerCase(),s=e.substring(t+1),r=i}"ns"in d&&(r=d["ns"])}return{host:e,port:l,domain:s,subdomain:i,secure:o,scheme:a,pathString:n,namespace:r}},tv="-0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ_abcdefghijklmnopqrstuvwxyz";(function(){let t=0;const e=[]})();
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
class ev{constructor(t,e,s,i){this._repo=t,this._path=e,this._queryParams=s,this._orderByCalled=i}get key(){return jg(this._path)?null:Ag(this._path)}get ref(){return new sv(this._repo,this._path)}get _queryIdentifier(){const t=Gp(this._queryParams),e=ed(t);return"{}"===e?"default":e}get _queryObject(){return Gp(this._queryParams)}isEqual(t){if(t=Ih(t),!(t instanceof ev))return!1;const e=this._repo===t._repo,s=Bg(this._path,t._path),i=this._queryIdentifier===t._queryIdentifier;return e&&s&&i}toJSON(){return this.toString()}toString(){return this._repo.toString()+Mg(this._path)}}class sv extends ev{constructor(t,e){super(t,e,new Hp,!1)}get parent(){const t=Lg(this._path);return null===t?null:new sv(this._repo,t)}get root(){let t=this;while(null!==t.parent)t=t.parent;return t}}Om(sv),Im(sv);
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
const iv="FIREBASE_DATABASE_EMULATOR_HOST",nv={};let rv=!1;function ov(t,e,s,i){const n=e.lastIndexOf(":"),r=e.substring(0,n),o=Kl(r);t.repoInfo_=new Ed(e,o,t.repoInfo_.namespace,t.repoInfo_.webSocketOnly,t.repoInfo_.nodeAdmin,t.repoInfo_.persistenceKey,t.repoInfo_.includeNamespaceInQueryParams,!0,s),i&&(t.authTokenProvider_=i)}function av(t,e,s,i,n){let r=i||t.options.databaseURL;void 0===r&&(t.options.projectId||zu("Can't determine Firebase Database URL. Be sure to include  a Project ID when calling firebase.initializeApp()."),Yu("Using default host for project ",t.options.projectId),r=`${t.options.projectId}-default-rtdb.firebaseio.com`);let o,a,l=J_(r,n),h=l.repoInfo;"undefined"!==typeof process&&(a={NODE_ENV:"production",BASE_URL:"/alien_mood/"}[iv]),a?(o=!0,r=`http://${a}?ns=${h.namespace}`,l=J_(r,n),h=l.repoInfo):o=!l.repoInfo.secure;const c=n&&o?new md(md.OWNER):new fd(t.name,t.options,e);y_("Invalid Firebase Database URL",l),jg(l.path)||zu("Database URL must point to the root of a Firebase Database (not including a child path).");const u=hv(h,t,c,new pd(t,s));return new cv(u,t)}function lv(t,e){const s=nv[e];s&&s[t.key]===t||zu(`Database ${e}(${t.repoInfo_}) has already been deleted.`),j_(t),delete s[t.key]}function hv(t,e,s,i){let n=nv[e.name];n||(n={},nv[e.name]=n);let r=n[t.toURLString()];return r&&zu("Database initialized multiple times. Please make sure the format of the database URL matches with each database() call."),r=new O_(t,rv,s,i),n[t.toURLString()]=r,r}class cv{constructor(t,e){this._repoInternal=t,this.app=e,this["type"]="database",this._instanceStarted=!1}get _repo(){return this._instanceStarted||(E_(this._repoInternal,this.app.options.appId,this.app.options["databaseAuthVariableOverride"]),this._instanceStarted=!0),this._repoInternal}get _root(){return this._rootInternal||(this._rootInternal=new sv(this._repo,Eg())),this._rootInternal}_delete(){return null!==this._rootInternal&&(lv(this._repo,this.app.name),this._repoInternal=null,this._rootInternal=null),Promise.resolve()}_checkNotDeleted(t){null===this._rootInternal&&zu("Cannot call "+t+" on a deleted database.")}}function uv(t=ru(),e){const s=Jc(t,"database").getImmediate({identifier:e});if(!s._instanceStarted){const t=Gl("database");t&&dv(s,...t)}return s}function dv(t,e,s,i={}){t=Ih(t),t._checkNotDeleted("useEmulator");const n=`${e}:${s}`,r=t._repoInternal;if(t._instanceStarted){if(n===t._repoInternal.repoInfo_.host&&wh(i,r.repoInfo_.emulatorOptions))return;zu("connectDatabaseEmulator() cannot initialize or alter the emulator configuration after the database instance has started.")}let o;if(r.repoInfo_.nodeAdmin)i.mockUserToken&&zu('mockUserToken is not supported by the Admin SDK. For client access with mock users, please use the "firebase" package instead of "firebase-admin".'),o=new md(md.OWNER);else if(i.mockUserToken){const e="string"===typeof i.mockUserToken?i.mockUserToken:Ql(i.mockUserToken,t.app.options.projectId);o=new md(e)}Kl(e)&&($l(e),sh("Database",!0)),ov(r,n,i,o)}
/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
function gv(t){Du(iu),Qc(new Ph("database",((t,{instanceIdentifier:e})=>{const s=t.getProvider("app").getImmediate(),i=t.getProvider("auth-internal"),n=t.getProvider("app-check-internal");return av(s,i,n,e)}),"PUBLIC").setMultipleInstances(!0)),ou(ku,Ou,t),ou(ku,Ou,"esm2017")}
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */tp.prototype.simpleListen=function(t,e){this.sendRequest("q",{p:t},e)},tp.prototype.echo=function(t,e){this.sendRequest("echo",{d:t},e)};gv();const pv={apiKey:"AIzaSyDdvQbWbBmkDWSJeivHI01mJTVSnnYctTs",authDomain:"alien-mood.firebaseapp.com",databaseURL:"https://alien-mood-default-rtdb.firebaseio.com",projectId:"alien-mood",storageBucket:"alien-mood.firebasestorage.app",messagingSenderId:"450783398597",appId:"1:450783398597:web:70b656cd69807231633eac",measurementId:"G-F6ZE81HPV7"},fv=nu(pv);uv(fv);var mv=s(1241);var _v=JSON.parse('[{"src":"backround/다가오는솔라스 (1).jpg","label":"배경1"},{"src":"backround/다가오는솔라스 (2).jpg","label":"배경2"},{"src":"backround/다가오는솔라스 (3).jpg","label":"배경3"},{"src":"backround/다가오는솔라스 (4).jpg","label":"배경4"}]'),vv=JSON.parse('[{"src":"sticker/01.svg","label":""},{"src":"sticker/02.svg","label":""},{"src":"sticker/03.svg","label":""},{"src":"sticker/04.svg","label":""},{"src":"sticker/05.svg","label":""},{"src":"sticker/06.svg","label":""},{"src":"sticker/07.svg","label":""},{"src":"sticker/08.svg","label":""},{"src":"sticker/09.svg","label":""},{"src":"sticker/10.svg","label":""},{"src":"sticker/11.svg","label":""}]'),yv=JSON.parse('{"clothesList":[{"name":"드레스","icon":"clothes/dress.svg","svgUrl":{"인간":"clothes/dress.svg","인간팔":"clothes/dress팔.svg"},"position":{"인간":{"left":0,"top":0},"인간팔":{"left":0,"top":0}},"colorButtons":[{"label":"핑크/파랑","mainColor":"#ff69b4","targets":[{"type":"id","value":"dress_body1","color":"#ff69b4"},{"type":"id","value":"dress_body2","color":"#ff69b4"},{"type":"id","value":"belt","color":"#00bfff"}]},{"label":"핑크/노랑","mainColor":"#ffe066","targets":[{"type":"id","value":"dress_body1","color":"#ff69b4"},{"type":"id","value":"dress_body2","color":"#ff69b4"},{"type":"id","value":"belt","color":"#ffe066"}]},{"label":"노랑/파랑","mainColor":"#00cc44","targets":[{"type":"id","value":"dress_body1","color":"#00cc44"},{"type":"id","value":"dress_body2","color":"#00cc44"},{"type":"id","value":"belt","color":"#00bfff"}]}]},{"name":"셔츠","icon":"clothes/shirt.svg","svgUrl":{"인간":"clothes/shirt.svg","인간팔":"clothes/shirt팔.svg"},"position":{"인간":{"left":0,"top":0},"인간팔":{"left":0,"top":0}},"colorButtons":[{"label":"검정/흰색","mainColor":"#3E3E3EFF","targets":[{"type":"id","value":"main","color":"#3E3E3EFF"},{"type":"id","value":"collar","color":"#DDDDDDFF"}]},{"label":"주황/초록","mainColor":"#FF6969FF","targets":[{"type":"id","value":"main","color":"#FF6969FF"},{"type":"id","value":"collar","color":"#66FF87FF"}]},{"label":"보라/노랑","mainColor":"#C2CC00FF","targets":[{"type":"id","value":"main","color":"#C2CC00FF"},{"type":"id","value":"collar","color":"#5900FFFF"}]}]}]}');const bv=s(8660),Cv=(bv.keys().map(((t,e)=>({src:bv(t),label:`emoji${e+1}`}))),s(5350));function xv(t){try{return Cv("./"+t)}catch{return""}}(_v.default||_v).map((t=>({...t,src:xv(t.src)}))),(vv.default||vv).map((t=>({...t,src:xv(t.src)})));const wv=yv.default||yv,Sv=wv.clothesList||[];Sv.map((t=>({...t,icon:xv(t.icon),svgUrl:Object.fromEntries(Object.entries(t.svgUrl).map((([t,e])=>[t,xv(e)])))})));var Tv=s(5130),kv=s(7222);const Ov={ref:"canvas",style:{border:"1px solid #ccc"}},Ev={class:"absolute bottom-[218px] left-1/2 transform -translate-x-1/2 text-white text-[18px]"},Dv={class:"absolute bottom-[130px] left-[30px] right-[0px]"},Iv={class:"flex gap-[16px] p-[8px] overflow-x-auto scrollbar-hide",style:{"justify-content":"flex-start"}},Pv=["onClick","title"],Av={class:"flex justify-center absolute bottom-[44px] left-1/2 transform -translate-x-1/2"},Mv={class:"flex gap-[16px] p-[8px] scrollbar-hide"},Rv=["onClick","title"],Lv={key:2},Fv={class:"panel-header relative w-[full] h-[28px] flex items-center justify-center"},jv={key:0,class:"h-full px-[30px]"},Nv={class:"flex flex-wrap gap-[15px] h-full pb-[56px] custom-scrollbar-hide",style:{"box-sizing":"border-box"}},Bv=["onClick"],Wv=["src","alt"],Xv={key:1},Yv={class:"avatar-panel"},Vv={class:"flex gap-[34px] h-[32px] leading-[18px] text-[18px] border-b-[1px] border-black-b200"},Hv=["onClick"],zv={class:"avatar-tab-content"},Gv={key:0},Uv={style:{display:"flex",gap:"8px"}},qv=["onClick"],Kv={key:1},$v={key:2},Qv={key:3},Jv={key:4},Zv={key:5},ty={style:{display:"flex",gap:"8px"}},ey=["onClick"],sy=["src","alt"],iy={key:0,style:{margin:"12px 0"}},ny=["onClick"],ry={key:2},oy={class:"imgBox w-full h-[32px] text-center flex items-center justify-center border-b text-black-b70 border-black-b600"},ay={class:"flex mt-[14px]",style:{gap:"15px"}},ly=["src"],hy=["onClick"],cy={key:0,class:"bg-black-b600 rounded-[2px] cursor-pointer p-0 flex items-center justify-center",style:{width:"calc((100% - 30px) / 3)",aspectRatio:"1 / 1",position:"relative"}},uy={key:3},dy={key:0,class:"flex flex-col gap-[14px] mb-[14px]"},gy=["value","onInput","onClick"],py=["onClick"],fy=["src"],my={key:4},_y={key:5},vy={class:"grid",style:{"grid-template-columns":"repeat(3, 1fr)",gap:"15px"}},yy=["onClick"],by=["src","alt"],Cy={class:"panel-nav z-100 text-[20px] fixed left-1/2 bottom-0 flex justify-around items-center h-[48px] bg-black-b900/90 w-full max-w-[430px] -translate-x-1/2"},xy=["onClick"];function wy(t,e,s,n,r,a){return(0,i.uX)(),(0,i.CE)("div",{class:"mobile-wrapper relative bg-white max-w-[430px] mx-auto min-h-screen select-none",onTouchstart:e[12]||(e[12]=(...t)=>a.onTouchStart&&a.onTouchStart(...t)),onTouchmove:e[13]||(e[13]=(...t)=>a.onTouchMove&&a.onTouchMove(...t)),onTouchend:e[14]||(e[14]=(...t)=>a.onTouchEnd&&a.onTouchEnd(...t))},[(0,i.Lk)("canvas",Ov,null,512),r.showTextOverlay?((0,i.uX)(),(0,i.CE)("div",{key:0,class:"fixed inset-0 z-50 flex items-start justify-center",style:{background:"rgba(0, 0, 0, 0.5)"},onClick:e[6]||(e[6]=(...t)=>a.closeTextOverlay&&a.closeTextOverlay(...t))},[(0,i.Lk)("div",{class:"relative mx-auto px-[20px]",onClick:e[5]||(e[5]=(0,Tv.D$)((()=>{}),["stop"])),style:{width:"100%",maxWidth:"430px",height:"calc(100vh - 282px)",display:"flex",flexDirection:"column",justifyContent:"center",alignItems:"center",marginTop:"0px"}},[(0,i.Lk)("button",{onClick:e[0]||(e[0]=(...t)=>a.closeTextOverlay&&a.closeTextOverlay(...t)),class:"absolute bg-white rounded-full flex items-center justify-center z-10 w-[30px] h-[30px] right-[20px] -top-[10px]",style:{border:"2px solid #e5e5e5"}}," × "),(0,i.Lk)("div",Ev,(0,o.v_)(r.overlayText.length)+" / 20 ",1),(0,i.Lk)("div",{class:"mx-auto absolute bottom-[170px] left-1/2 transform -translate-x-1/2",style:(0,o.Tr)({backgroundColor:r.textBackgroundColors[r.overlaySelectedColorIndex],borderRadius:"10px",width:"calc(100% - 60px)",height:"42px"})},[(0,i.bo)((0,i.Lk)("textarea",{ref:"overlayTextarea","onUpdate:modelValue":e[1]||(e[1]=t=>r.overlayText=t),maxlength:"20",class:"w-full bg-transparent resize-none outline-none text-overlay-input",style:(0,o.Tr)({fontFamily:"Pretendard, sans-serif",fontSize:"16px",textAlign:"center",height:"42px",lineHeight:"42px",color:a.getTextColor(r.textBackgroundColors[r.overlaySelectedColorIndex])}),placeholder:"여기에 입력해주세요",onKeydown:e[2]||(e[2]=(0,Tv.jR)((0,Tv.D$)(((...t)=>a.addTextFromOverlay&&a.addTextFromOverlay(...t)),["prevent"]),["enter"])),onInput:e[3]||(e[3]=(...t)=>a.updateOverlayText&&a.updateOverlayText(...t))},null,36),[[Tv.Jo,r.overlayText]])],4),(0,i.Lk)("div",Dv,[(0,i.Lk)("div",Iv,[((0,i.uX)(!0),(0,i.CE)(i.FK,null,(0,i.pI)(r.textBackgroundColors,((t,e)=>((0,i.uX)(),(0,i.CE)("button",{key:t,onClick:t=>r.overlaySelectedColorIndex=e,class:"w-[20px] h-[20px] rounded-full transition-all duration-200 relative flex-shrink-0",style:(0,o.Tr)({backgroundColor:r.overlaySelectedColorIndex===e?"#ffffff":t}),title:`배경색 ${e+1}`},[r.overlaySelectedColorIndex===e?((0,i.uX)(),(0,i.CE)("div",{key:0,class:"absolute inset-[3px] rounded-full border-2",style:(0,o.Tr)({backgroundColor:t,borderColor:"#202020"})},null,4)):(0,i.Q3)("",!0)],12,Pv)))),128))])]),(0,i.Lk)("div",Av,[(0,i.Lk)("button",{onClick:e[4]||(e[4]=(...t)=>a.addTextFromOverlay&&a.addTextFromOverlay(...t)),class:"bg-black-b900 text-white w-[110px] h-[38px] inline-block rounded-[500px]"}," 완료 ")])])])):(0,i.Q3)("",!0),r.editingTextbox?((0,i.uX)(),(0,i.CE)("div",{key:1,class:"fixed rounded-[20px] z-50 overflow-hidden",style:(0,o.Tr)({left:r.editingTextbox.colorPanelLeft+"px",top:r.editingTextbox.colorPanelTop+"px",transform:"translate(-50%, 0)",background:"transparent"})},[(0,i.Lk)("div",Mv,[((0,i.uX)(!0),(0,i.CE)(i.FK,null,(0,i.pI)(r.textBackgroundColors,((t,e)=>((0,i.uX)(),(0,i.CE)("button",{key:t,onClick:s=>a.changeTextBackgroundColor(t,e),class:"w-[20px] h-[20px] rounded-full transition-all duration-200 relative flex-shrink-0",style:(0,o.Tr)({backgroundColor:r.selectedColorIndex===e?"#ffffff":t}),title:`배경색 ${e+1}`},[r.selectedColorIndex===e?((0,i.uX)(),(0,i.CE)("div",{key:0,class:"absolute inset-[3px] rounded-full border-2",style:(0,o.Tr)({backgroundColor:t,borderColor:"#202020"})},null,4)):(0,i.Q3)("",!0)],12,Rv)))),128))])],4)):(0,i.Q3)("",!0),s.hideUi?(0,i.Q3)("",!0):((0,i.uX)(),(0,i.CE)("div",Lv,[r.panelOpen?((0,i.uX)(),(0,i.CE)("div",{key:0,class:"fixed left-0 right-0 top-0 bottom-[282px] z-10",style:{background:"transparent"},onClick:e[7]||(e[7]=(0,Tv.D$)((t=>r.panelOpen=!1),["stop"]))})):(0,i.Q3)("",!0),(0,i.Lk)("div",{class:"edit-panel z-0 fixed left-1/2 bottom-0 rounded-t-[28px] w-full max-w-[430px] -translate-x-1/2 bg-black-b700 flex flex-col transition-all duration-300",style:(0,o.Tr)({height:r.panelOpen?"282px":"0px",transform:r.panelOpen?"translate(-50%, 0)":"translate(-50%, 100%)",overflow:r.panelOpen?"visible":"hidden",pointerEvents:r.panelOpen?"auto":"none"}),onClick:e[11]||(e[11]=(0,Tv.D$)((()=>{}),["stop"]))},[(0,i.Lk)("div",Fv,[(0,i.Lk)("div",{class:"panel-handle w-[30px] h-[4px] rounded-full cursor-pointer bg-black-b200",onClick:e[8]||(e[8]=(...t)=>a.togglePanel&&a.togglePanel(...t))})]),(0,i.Lk)("div",{class:"panel-content w-full h-full px-[30px] pb-[12px] flex-1 min-h-0 overflow-y-auto",style:(0,o.Tr)({overflowY:r.panelOpen?"auto":"hidden"})},[0===r.activePanelTab?((0,i.uX)(),(0,i.CE)("div",jv,[(0,i.Lk)("div",Nv,[((0,i.uX)(!0),(0,i.CE)(i.FK,null,(0,i.pI)(r.backroundList,((t,e)=>((0,i.uX)(),(0,i.CE)("div",{key:"replace-img-"+e,class:"flex-shrink-0 bg-red-50",style:{width:"calc((100% - 30px) / 3)"}},[(0,i.Lk)("button",{onClick:e=>a.replaceDefaultImage(t.src),class:"w-full h-full aspect-square overflow-hidden",style:{padding:"0"}},[(0,i.Lk)("img",{src:t.src,alt:"배경 "+(e+1),class:"w-full h-full object-cover",draggable:"false"},null,8,Wv)],8,Bv)])))),128))])])):1===r.activePanelTab?((0,i.uX)(),(0,i.CE)("div",Xv,[(0,i.Lk)("div",Yv,[(0,i.Lk)("div",Vv,[((0,i.uX)(!0),(0,i.CE)(i.FK,null,(0,i.pI)(r.avatarTabs,((t,e)=>((0,i.uX)(),(0,i.CE)("button",{key:t,class:(0,o.C4)(["flex-1 py-2",r.activeAvatarTab===e?"text-blue-500 border-b-2 border-blue-500":"text-gray-500"]),onClick:t=>r.activeAvatarTab=e},(0,o.v_)(t),11,Hv)))),128))]),(0,i.Lk)("div",zv,[0===r.activeAvatarTab?((0,i.uX)(),(0,i.CE)("div",Gv,[e[15]||(e[15]=(0,i.Lk)("p",null,"자세(포즈) 선택 영역",-1)),(0,i.Lk)("div",Uv,[((0,i.uX)(),(0,i.CE)(i.FK,null,(0,i.pI)(["인간","인간팔"],(t=>(0,i.Lk)("button",{key:t,style:(0,o.Tr)({background:r.currentPose===t?"#00bfff":"#eee",color:r.currentPose===t?"#fff":"#333",border:"1px solid #ccc",borderRadius:"6px",padding:"6px 16px",cursor:"pointer"}),onClick:e=>a.changePose(t)},(0,o.v_)(t),13,qv))),64))])])):1===r.activeAvatarTab?((0,i.uX)(),(0,i.CE)("div",Kv,e[16]||(e[16]=[(0,i.Lk)("p",null,"얼굴형 선택 영역",-1)]))):2===r.activeAvatarTab?((0,i.uX)(),(0,i.CE)("div",$v,e[17]||(e[17]=[(0,i.Lk)("p",null,"머리 선택 영역",-1)]))):3===r.activeAvatarTab?((0,i.uX)(),(0,i.CE)("div",Qv,e[18]||(e[18]=[(0,i.Lk)("p",null,"눈 선택 영역",-1)]))):4===r.activeAvatarTab?((0,i.uX)(),(0,i.CE)("div",Jv,e[19]||(e[19]=[(0,i.Lk)("p",null,"입 선택 영역",-1)]))):5===r.activeAvatarTab?((0,i.uX)(),(0,i.CE)("div",Zv,[(0,i.Lk)("div",ty,[((0,i.uX)(!0),(0,i.CE)(i.FK,null,(0,i.pI)(r.clothesList,(t=>((0,i.uX)(),(0,i.CE)("button",{key:t.name,onClick:e=>a.selectClothes(t),style:{background:"none",border:"none",cursor:"pointer"}},[(0,i.Lk)("img",{src:t.icon,alt:t.name,width:"48",height:"48"},null,8,sy),(0,i.Lk)("div",null,(0,o.v_)(t.name),1)],8,ey)))),128))]),r.selectedClothes?((0,i.uX)(),(0,i.CE)("div",iy,[((0,i.uX)(!0),(0,i.CE)(i.FK,null,(0,i.pI)(r.selectedClothes.colorButtons,((t,e)=>((0,i.uX)(),(0,i.CE)("button",{key:t.label+e,onClick:s=>a.changeClothesColors(t.targets,r.selectedClothes.name,e),style:{display:"flex","align-items":"center",gap:"8px"}},[t.mainColor?((0,i.uX)(),(0,i.CE)("span",{key:0,style:(0,o.Tr)({display:"inline-block",width:"18px",height:"18px",borderRadius:"50%",background:t.mainColor,border:"1px solid #aaa"})},null,4)):(0,i.Q3)("",!0),(0,i.eW)(" "+(0,o.v_)(t.label),1)],8,ny)))),128))])):(0,i.Q3)("",!0)])):(0,i.Q3)("",!0)])])])):2===r.activePanelTab?((0,i.uX)(),(0,i.CE)("div",ry,[(0,i.Lk)("div",oy,[(0,i.Lk)("span",null,(0,o.v_)(r.imageCount)+"/3",1)]),(0,i.Lk)("div",ay,[((0,i.uX)(!0),(0,i.CE)(i.FK,null,(0,i.pI)(r.uploadedImages,((t,e)=>((0,i.uX)(),(0,i.CE)("div",{key:t.fabricObj.id||t.url,class:"bg-black-b600 rounded-[2px] flex items-center justify-center relative",style:{width:"calc((100% - 30px) / 3)",aspectRatio:"1 / 1",position:"relative"}},[(0,i.Lk)("img",{src:t.url,alt:"첨부 이미지",class:"object-cover w-full h-full rounded-[2px]"},null,8,ly),(0,i.Lk)("button",{onClick:t=>a.removePreviewImage(e),style:{position:"absolute",top:"4px",right:"4px",background:"rgba(0, 0, 0, 0.5)","border-radius":"50%",width:"24px",height:"24px",color:"#fff",border:"none","font-size":"18px",cursor:"pointer"},title:"삭제"}," × ",8,hy)])))),128)),r.uploadedImages.length<3?((0,i.uX)(),(0,i.CE)("label",cy,[e[20]||(e[20]=(0,i.Lk)("img",{src:kv,alt:"이미지 추가",width:"40",height:"40"},null,-1)),(0,i.Lk)("input",{type:"file",accept:"image/*",onChange:e[9]||(e[9]=(...t)=>a.onFileChange&&a.onFileChange(...t)),style:{display:"none"}},null,32)])):(0,i.Q3)("",!0)])])):3===r.activePanelTab?((0,i.uX)(),(0,i.CE)("div",uy,[r.textboxes.length>0?((0,i.uX)(),(0,i.CE)("div",dy,[((0,i.uX)(!0),(0,i.CE)(i.FK,null,(0,i.pI)(r.textboxes,((t,e)=>((0,i.uX)(),(0,i.CE)("div",{key:t.fabricObj.id||e,class:"rounded-[10px] p-[12px] relative mx-auto",style:(0,o.Tr)({backgroundColor:t.backgroundColor||"rgba(0, 0, 0, 0.8)",width:"fit-content"})},[(0,i.Lk)("input",{value:t.text,onInput:t=>a.updateTextContent(e,t.target.value),onClick:e=>a.selectTextOnCanvas(t.fabricObj),maxlength:"20",class:"bg-transparent outline-none w-full pr-[20px] text-center",style:(0,o.Tr)({color:a.getTextColor(t.backgroundColor||"rgba(0, 0, 0, 0.8)"),fontFamily:"Pretendard, sans-serif",fontSize:"32px",minWidth:"0"}),placeholder:"텍스트를 입력하세요"},null,44,gy),(0,i.Lk)("button",{onClick:t=>a.removeTextbox(e),class:"absolute right-[4px] top-[4px] w-[12px] h-[12px] flex items-center justify-center",title:"삭제"},[(0,i.Lk)("img",{src:r.closeTextIcon,alt:"삭제",class:"w-[12px] h-[12px]"},null,8,fy)],8,py)],4)))),128))])):(0,i.Q3)("",!0),(0,i.Lk)("button",{onClick:e[10]||(e[10]=(...t)=>a.addTextbox&&a.addTextbox(...t)),class:"w-[300px] h-[42px] bg-black-b600 rounded-[10px] cursor-pointer p-0 flex items-center justify-center",style:{margin:"0 auto"}},e[21]||(e[21]=[(0,i.Lk)("span",{style:{display:"flex","flex-direction":"column","align-items":"center",color:"#fff","font-size":"18px","font-weight":"bold",gap:"8px"}},[(0,i.Lk)("img",{src:kv,alt:"텍스트 추가",width:"40",height:"40"})],-1)]))])):4===r.activePanelTab?((0,i.uX)(),(0,i.CE)("div",my)):5===r.activePanelTab?((0,i.uX)(),(0,i.CE)("div",_y,[(0,i.Lk)("div",vy,[((0,i.uX)(!0),(0,i.CE)(i.FK,null,(0,i.pI)(r.StickerList,(t=>((0,i.uX)(),(0,i.CE)("div",{key:t.src,class:"flex items-center justify-center bg-black-b800 rounded-[2px]",style:{aspectRatio:"1 / 1",position:"relative",width:"100%",height:"auto"}},[(0,i.Lk)("button",{onClick:e=>a.addSticker(t.src),style:{background:"none",border:"none",cursor:"pointer",width:"100%",height:"100%",padding:"0",display:"flex","align-items":"center","justify-content":"center"}},[(0,i.Lk)("img",{src:t.src,alt:t.label,style:{width:"80%",height:"80%","object-fit":"contain",display:"block"}},null,8,by)],8,yy)])))),128))])])):(0,i.Q3)("",!0)],4)],4),(0,i.Lk)("div",Cy,[((0,i.uX)(),(0,i.CE)(i.FK,null,(0,i.pI)(["배경","아바타","사진","텍스트","질문","스티커"],((t,e)=>(0,i.Lk)("button",{key:t,class:(0,o.C4)(["flex-1 h-full",r.activePanelTab===e?"text-green-300 ":"text-black-b100"]),onClick:t=>a.openPanel(e)},(0,o.v_)(t),11,xy))),64))])]))],32)}var Sy=s(9434);const Ty=s(5350);function ky(t){try{return Ty("./"+t)}catch{return""}}const Oy=(_v.default||_v).map((t=>({...t,src:ky(t.src)}))),Ey=(vv.default||vv).map((t=>({...t,src:ky(t.src)}))),Dy=yv.default||yv,Iy=Dy.clothesList||[],Py=Iy.map((t=>({...t,icon:ky(t.icon),svgUrl:Object.fromEntries(Object.entries(t.svgUrl).map((([t,e])=>[t,ky(e)])))})));var Ay={props:{hideUi:{type:Boolean,default:!1}},data(){return{canvas:null,isRestoring:!1,backroundList:Oy,defaultImageObject:null,currentPose:"인간",StickerList:Ey,clothesList:Py,selectedClothes:null,selectedColorIndexes:{},avatarTabs:["얼굴형","자세","머리","눈","입","장식"],activeAvatarTab:0,imageCount:0,uploadedImages:[],textboxes:[],textBackgroundColors:["rgba(0, 0, 0, 0.8)","#ffffff","#0C0C0D","#00AA39","#DE9A1C","#E62929","#E65529","#00ACCA","#0047CA","#001946","#5E01FF","#A675FA","#DF1AE3","#EF1F8B","#EF1F3B"],editingTextbox:null,selectedColorIndex:0,showTextOverlay:!1,overlayText:"",overlaySelectedColorIndex:0,panelOpen:!0,touchStartY:0,touchMoveY:0,activePanelTab:3,closeTextIcon:Sy}},components:{},methods:{openPanel(t){this.activePanelTab=t,this.panelOpen=!0},togglePanel(){this.panelOpen=!this.panelOpen},onTouchStart(t){this.touchStartY=t.touches[0].clientY,this.touchMoveY=t.touches[0].clientY,this.touchStartTime=Date.now()},onTouchMove(t){this.touchMoveY=t.touches[0].clientY},onTouchEnd(){const t=this.touchStartY-this.touchMoveY,e=Date.now()-this.touchStartTime;this.panelOpen&&t<-30&&Math.abs(t)>30&&e<500?this.panelOpen=!1:!this.panelOpen&&t>80&&e<500&&(this.panelOpen=!0)},async addHumanControlLayer(){if(this.humanControlLayer&&(this.canvas.remove(this.humanControlLayer),this.humanControlLayer=null),!this.humanSvgGroup)return;const t=this.humanSvgGroup.getBoundingRect(),e=new Bn({left:this.humanSvgGroup.left,top:this.humanSvgGroup.top,width:t.width,height:t.height,originX:this.humanSvgGroup.originX,originY:this.humanSvgGroup.originY,fill:"rgba(0,0,0,0)",selectable:!0,evented:!0,hasControls:!1,hasBorders:!1,padding:12});this.addCharacterControls(e),this.canvas.add(e),this.humanControlLayer=e,e.on("moving",(()=>{if(this.humanSvgGroup.set({left:e.left,top:e.top}),this.clothesSvgGroup){const t=this.selectedClothes?.position?.[this.currentPose]||{left:0,top:0};this.clothesSvgGroup.set({left:e.left+t.left*e.scaleX,top:e.top+t.top*e.scaleY})}this.canvas.renderAll()})),e.on("scaling",(()=>{if(this.humanSvgGroup.set({scaleX:e.scaleX,scaleY:e.scaleY,left:e.left,top:e.top}),this.clothesSvgGroup){const t=this.selectedClothes?.position?.[this.currentPose]||{left:0,top:0};this.clothesSvgGroup.set({scaleX:e.scaleX,scaleY:e.scaleY,left:e.left+t.left*e.scaleX,top:e.top+t.top*e.scaleY})}this.canvas.renderAll()})),e.on("rotating",(()=>{this.humanSvgGroup.set({angle:e.angle}),this.clothesSvgGroup&&this.clothesSvgGroup.set({angle:e.angle}),this.canvas.renderAll()})),this.canvas.renderAll()},async addHumanSvg(){let t=100,e=this.canvas.height/2,s=1,i=1,n=0;this.humanSvgGroup&&(t=this.humanSvgGroup.left,e=this.humanSvgGroup.top,s=this.humanSvgGroup.scaleX,i=this.humanSvgGroup.scaleY,n=this.humanSvgGroup.angle,this.canvas.remove(this.humanSvgGroup),this.humanSvgGroup=null);const r="인간팔"===this.currentPose?Tl:Sl,o=await Ca(r);let a=Rr.groupSVGElements(o.objects);a.set({left:t,top:e,originX:"center",originY:"center",scaleX:s,scaleY:i,angle:n,selectable:!0,evented:!0,hasControls:!1,hasBorders:!1,lockMovementX:!1,lockMovementY:!1,lockScalingX:!1,lockScalingY:!1,lockRotation:!1}),this.addCharacterControls(a),this.canvas.add(a),this.humanSvgGroup=a,this.addHumanMoveListener(),await this.addHumanControlLayer(),this.canvas.renderAll()},async selectClothes(t){this.clothesSvgGroup&&this.canvas.remove(this.clothesSvgGroup);const e="object"===typeof t.svgUrl?t.svgUrl[this.currentPose]||t.svgUrl["인간"]:t.svgUrl,s=await Ca(e);let i=Rr.groupSVGElements(s.objects);const n=this.humanSvgGroup,r=t.position?.[this.currentPose]||{left:0,top:0};i.set({left:n.left,top:n.top,originX:n.originX,originY:n.originY,scaleX:n.scaleX,scaleY:n.scaleY,angle:n.angle,selectable:!1,evented:!1,hasControls:!1,hasBorders:!1,lockMovementX:!0,lockMovementY:!0,lockScalingX:!0,lockScalingY:!0,lockRotation:!0}),i.forEachObject((t=>{t.left+=r.left,t.top+=r.top})),i.setCoords(),this.canvas.add(i),this.clothesSvgGroup=i,this.selectedClothes=t,this.canvas.renderAll();const o=this.selectedColorIndexes[t.name]??0,a=t.colorButtons[o];a&&this.changeClothesColors(a.targets,t.name,o),await this.addHumanControlLayer()},addHumanMoveListener(){this.humanSvgGroup&&(this.humanSvgGroup.set({selectable:!0,evented:!0}),this.humanSvgGroup.on("moving",(()=>{if(this.clothesSvgGroup&&this.selectedClothes){const t=this.selectedClothes.position?.[this.currentPose]||{left:0,top:0};this.clothesSvgGroup.set({left:this.humanSvgGroup.left+t.left*this.humanSvgGroup.scaleX,top:this.humanSvgGroup.top+t.top*this.humanSvgGroup.scaleY}),this.canvas.renderAll()}})),this.humanSvgGroup.on("scaling",(()=>{if(this.clothesSvgGroup&&this.selectedClothes){this.clothesSvgGroup.set({scaleX:this.humanSvgGroup.scaleX,scaleY:this.humanSvgGroup.scaleY});const t=this.selectedClothes.position?.[this.currentPose]||{left:0,top:0};this.clothesSvgGroup.set({left:this.humanSvgGroup.left+t.left*this.humanSvgGroup.scaleX,top:this.humanSvgGroup.top+t.top*this.humanSvgGroup.scaleY}),this.canvas.renderAll()}})))},async changePose(t){this.currentPose=t,this.humanSvgGroup&&this.canvas.remove(this.humanSvgGroup),this.clothesSvgGroup&&this.canvas.remove(this.clothesSvgGroup),await this.addHumanSvg(),this.addCharacterControls(this.humanSvgGroup),this.selectedClothes&&await this.selectClothes(this.selectedClothes),await this.addHumanControlLayer()},changeClothesColors(t,e,s){function i(e){e._objects?e._objects.forEach((t=>i(t))):t.forEach((({type:t,value:s,color:i})=>{("id"===t&&(e.id===s||e.get&&e.get("id")===s)||"class"===t&&(e.className===s||e.get&&e.get("class")===s))&&e.set("fill",i)}))}this.clothesSvgGroup&&(i(this.clothesSvgGroup),this.canvas.requestRenderAll(),this.selectedColorIndexes={...this.selectedColorIndexes,[e]:s})},saveCanvasAsImage(){let t=prompt("저장할 파일 이름을 입력하세요.","오늘기분외계인");if(null===t)return;t&&""!==t.trim()||(t="오늘기분외계인"),t.endsWith(".jpg")||t.endsWith(".png")||(t+=".jpg");const e=this.canvas.toDataURL({format:"jpg",quality:1,multiplier:4}),s=document.createElement("a");s.href=e,s.download=t,document.body.appendChild(s),s.click(),document.body.removeChild(s)},changeSvgColorsByIds(t){this.svgGroup&&(this.svgGroup.forEachObject((e=>{t.forEach((({id:t,color:s})=>{e.id!==t&&e.get("id")!==t||e.set("fill",s)}))})),this.canvas.requestRenderAll())},renderDeleteIcon(t,e,s,i,n){const r=36,o=12,a=r+2*o,l=new window.Image;l.src=Cl,t.save(),t.translate(e,s),t.rotate(Rr.degreesToRadians(n.angle)),t.globalAlpha=1,t.drawImage(l,-r/2,-r/2,r,r),t.globalAlpha=.01,t.beginPath(),t.arc(0,0,a/2,0,2*Math.PI),t.fillStyle="#000",t.fill(),t.globalAlpha=1,t.restore()},renderRotateIcon(t,e,s,i,n){const r=36,o=12,a=r+2*o,l=new Image;l.src=xl,t.save(),t.translate(e,s),t.rotate(Rr.degreesToRadians(n.angle)),t.globalAlpha=1,t.drawImage(l,-r/2,-r/2,r,r),t.globalAlpha=.01,t.beginPath(),t.arc(0,0,a/2,0,2*Math.PI),t.fillStyle="#000",t.fill(),t.globalAlpha=1,t.restore()},renderResizeIcon(t,e,s,i,n){const r=36,o=12,a=r+2*o,l=new Image;l.src=wl,t.save(),t.translate(e,s),t.rotate(Rr.degreesToRadians(n.angle)),t.globalAlpha=1,t.drawImage(l,-r/2,-r/2,r,r),t.globalAlpha=.01,t.beginPath(),t.arc(0,0,a/2,0,2*Math.PI),t.fillStyle="#000",t.fill(),t.globalAlpha=1,t.restore()},deleteObject(t,e){const s=e.target.canvas;if("i-text"===e.target.type){const t=this.textboxes.findIndex((t=>t.fabricObj===e.target));-1!==t&&(this.textboxes.splice(t,1),this.textboxes=[...this.textboxes]),e.target._bgRect&&s.contains(e.target._bgRect)&&s.remove(e.target._bgRect)}if(e.target===this.humanControlLayer||e.target===this.humanSvgGroup)return this.humanSvgGroup&&s.contains(this.humanSvgGroup)&&(s.remove(this.humanSvgGroup),this.humanSvgGroup=null),this.clothesSvgGroup&&s.contains(this.clothesSvgGroup)&&(s.remove(this.clothesSvgGroup),this.clothesSvgGroup=null,this.selectedClothes=null),this.humanControlLayer&&s.contains(this.humanControlLayer)&&(s.remove(this.humanControlLayer),this.humanControlLayer=null),void s.requestRenderAll();s.remove(e.target),s.requestRenderAll()},addCharacterControls(t){t.setControlsVisibility({tl:!1,tr:!1,bl:!1,br:!1,mt:!1,mb:!1,ml:!1,mr:!1,mtr:!0,deleteControl:!0,rotateControl:!0,resizeControl:!0}),t.controls.deleteControl=new di({x:.5,y:-.5,cursorStyle:"pointer",mouseUpHandler:this.deleteObject,render:this.renderDeleteIcon,cornerSize:24,hitbox:{width:60,height:60}}),t.controls.rotateControl=new di({x:0,y:-.5,offsetY:-40,cursorStyle:"crosshair",render:this.renderRotateIcon,cornerSize:24,actionHandler:Ma.rotationWithSnapping,hitbox:{width:60,height:60}}),t.controls.resizeControl=new di({x:.5,y:.5,cursorStyle:"se-resize",render:this.renderResizeIcon,cornerSize:24,actionHandler:Ma.scalingEqually,hitbox:{width:60,height:60}}),t.set({cornerColor:"#00000000",cornerSize:24,cornerStyle:"circle",borderColor:"#ffffff",borderDashArray:[6,4],transparentCorners:!1,hasBorders:!1,hasControls:!1}),t.on("selected",(()=>{t.set({hasBorders:!0,hasControls:!0}),t.setControlsVisibility({tl:!1,tr:!1,bl:!1,br:!1,mt:!1,mb:!1,ml:!1,mr:!1,mtr:!0,deleteControl:!0,rotateControl:!0,resizeControl:!0}),t.canvas.requestRenderAll()})),t.on("deselected",(()=>{t.set({hasBorders:!1,hasControls:!1}),t.setControlsVisibility({tl:!1,tr:!1,bl:!1,br:!1,mt:!1,mb:!1,ml:!1,mr:!1,mtr:!0,deleteControl:!0,rotateControl:!0,resizeControl:!0}),t.canvas.requestRenderAll()}))},addCustomControls(t){t.setControlsVisibility({tl:!1,tr:!1,bl:!1,br:!1,mt:!1,mb:!1,ml:!1,mr:!1,mtr:!0,deleteControl:!0,rotateControl:!0,resizeControl:!0}),t.controls.deleteControl=new di({x:.5,y:-.5,cursorStyle:"pointer",mouseUpHandler:this.deleteObject,render:this.renderDeleteIcon,cornerSize:24,hitbox:{width:60,height:60}}),t.controls.rotateControl=new di({x:0,y:-.5,offsetY:-40,cursorStyle:"crosshair",render:this.renderRotateIcon,cornerSize:24,actionHandler:Ma.rotationWithSnapping,hitbox:{width:60,height:60}}),t.controls.resizeControl=new di({x:.5,y:.5,cursorStyle:"se-resize",render:this.renderResizeIcon,cornerSize:24,actionHandler:Ma.scalingEqually,hitbox:{width:60,height:60}}),t.set({cornerColor:"#00000000",cornerSize:24,cornerStyle:"circle",borderColor:"#ffffff",borderDashArray:[6,4],transparentCorners:!1,hasBorders:!1,hasControls:!1}),t.on("selected",(()=>{t.set({hasBorders:!0,hasControls:!0}),t.setControlsVisibility({tl:!1,tr:!1,bl:!1,br:!1,mt:!1,mb:!1,ml:!1,mr:!1,mtr:!0,deleteControl:!0,rotateControl:!0,resizeControl:!0}),t.canvas.requestRenderAll()})),t.on("deselected",(()=>{t.set({hasBorders:!1,hasControls:!1}),t.setControlsVisibility({tl:!1,tr:!1,bl:!1,br:!1,mt:!1,mb:!1,ml:!1,mr:!1,mtr:!0,deleteControl:!0,rotateControl:!0,resizeControl:!0}),t.canvas.requestRenderAll()}))},addRectangle(){const t=new Bn({left:this.canvas.width/2,top:this.canvas.height/2,fill:"#ffe066",width:200,height:200,objectCaching:!1,originX:"center",originY:"center",centeredRotation:!0,padding:12,selectable:!0,evented:!0,hasControls:!1,hasBorders:!1});this.addCustomControls(t),this.canvas.add(t),this.canvas.setActiveObject(t),this.canvas.renderAll()},addTextbox(){this.overlayText="",this.overlaySelectedColorIndex=0,this.showTextOverlay=!0,this.$nextTick((()=>{this.$refs.overlayTextarea&&this.$refs.overlayTextarea.focus()}))},addTextFromOverlay(){if(!this.overlayText.trim())return void this.closeTextOverlay();const t=this.overlayText.trim(),e=12,s=this.textBackgroundColors[this.overlaySelectedColorIndex],i=this.getTextColor(s),n=new Uo(t,{left:this.canvas.width/2,top:this.canvas.height/2,originX:"center",originY:"center",fontSize:32,fill:i,fontFamily:"Pretendard, sans-serif",editable:!0,selectable:!0,evented:!0,hasControls:!1,hasBorders:!1,backgroundColor:"transparent",textAlign:"center"}),r=new Bn({left:n.left,top:n.top,originX:"center",originY:"center",width:n.width+2*e,height:n.height+2*e,rx:10,ry:10,fill:s,selectable:!1,evented:!1,hasBorders:!1,hasControls:!1});n._bgRect=r,this.canvas.add(r),this.canvas.add(n);const o=()=>{const t=this.canvas.getObjects(),e=t.indexOf(r),s=t.indexOf(n);e>-1&&s>-1&&e!==s-1&&(t.splice(e,1),t.splice(s,0,r),this.canvas._objects=t)},l=()=>{n.setCoords(),r.set({width:n.width*n.scaleX+2*e,height:n.height*n.scaleY+2*e,left:n.left,top:n.top,scaleX:1,scaleY:1,angle:n.angle}),o(),this.canvas.requestRenderAll()},h=()=>{const t=this.textboxes.findIndex((t=>t.fabricObj===n));-1!==t&&(this.textboxes[t].text=n.text,this.textboxes=[...this.textboxes]),l()};n.on("changed",h),n.on("scaling",l),n.on("moving",l),n.on("rotating",l),n.on("editing:entered",(()=>{this.showColorPanel(n)})),n.on("editing:exited",(()=>{this.hideColorPanel()})),o(),this.addCustomControls(n),this.canvas.setActiveObject(n),this.canvas.renderAll(),this.textboxes.push({text:t,fabricObj:(0,a.IG)(n),backgroundColor:s}),this.closeTextOverlay()},updateOverlayText(t){this.overlayText=t.target.value},closeTextOverlay(){this.showTextOverlay=!1,this.overlayText="",this.overlaySelectedColorIndex=0},updateTextContent(t,e){if(t>=0&&t<this.textboxes.length){const s=e.slice(0,20),i=this.textboxes[t];if(i.text=s,i.fabricObj.set({text:s}),i.fabricObj._bgRect){const t=12;i.fabricObj._bgRect.set({width:i.fabricObj.width*i.fabricObj.scaleX+2*t,height:i.fabricObj.height*i.fabricObj.scaleY+2*t})}this.canvas.requestRenderAll(),this.textboxes=[...this.textboxes]}},removeTextbox(t){if(t>=0&&t<this.textboxes.length){const e=this.textboxes[t];e.fabricObj._bgRect&&this.canvas.contains(e.fabricObj._bgRect)&&this.canvas.remove(e.fabricObj._bgRect),this.canvas.contains(e.fabricObj)&&this.canvas.remove(e.fabricObj),this.textboxes.splice(t,1),this.textboxes=[...this.textboxes],this.canvas.requestRenderAll()}},showColorPanel(t){const e=t.getBoundingRect(),s=this.$refs.canvas,i=s.getBoundingClientRect();if(t._bgRect){const e=t._bgRect.fill,s=this.textBackgroundColors.findIndex((t=>t===e));this.selectedColorIndex=-1!==s?s:0;const i=this.textboxes.findIndex((e=>e.fabricObj===t));-1===i||this.textboxes[i].backgroundColor||(this.textboxes[i].backgroundColor=e,this.textboxes=[...this.textboxes])}else this.selectedColorIndex=0;this.editingTextbox={fabricObj:t,colorPanelLeft:i.left+e.left+e.width/2,colorPanelTop:i.top+e.top+e.height+10}},hideColorPanel(){this.editingTextbox=null,this.selectedColorIndex=0},changeTextBackgroundColor(t,e){if(!this.editingTextbox)return;const s=this.editingTextbox.fabricObj;if(s._bgRect){s._bgRect.set({fill:t}),this.selectedColorIndex=e;const i=this.getTextColor(t);s.set({fill:i}),this.canvas.requestRenderAll();const n=this.textboxes.findIndex((t=>t.fabricObj===s));-1!==n&&(this.textboxes[n].backgroundColor=t,this.textboxes=[...this.textboxes])}},getTextColor(t){return"#ffffff"===t||t.includes("255, 255, 255")?"#000000":"#ffffff"},selectTextOnCanvas(t){this.canvas.setActiveObject(t),this.canvas.renderAll(),this.$nextTick((()=>{t.enterEditing(),t.selectAll(),this.canvas.renderAll()}))},addImage(t){const e=new window.Image;e.src=t,e.onload=()=>{let s=e.width,i=e.height;const n=12,r=new oa(e,{left:0,top:0,originX:"center",originY:"center",width:s,height:i,selectable:!1,evented:!1,hasControls:!1,hasBorders:!1}),o=new Bn({left:0,top:0,originX:"center",originY:"center",width:s+2*n,height:i+2*n,fill:"rgba(0,0,0,0)",selectable:!1,evented:!1,hasControls:!1,hasBorders:!1}),l=new Zn([o,r],{left:this.canvas.width/2,top:this.canvas.height/2,originX:"center",originY:"center",selectable:!0,evented:!0,hasControls:!1,hasBorders:!1});this.addCustomControls(l),this.canvas.add(l),this.canvas.setActiveObject(l),this.canvas.renderAll(),this.uploadedImages.push({url:t,fabricObj:(0,a.IG)(l)}),this.updateImageCount()}},onFileChange(t){const e=t.target.files;if(!e||0===e.length)return;let s=this.uploadedImages.length;if(s>=3)return void alert("이미지는 최대 3개까지만 추가할 수 있습니다.");const i=e[0];if(!i)return;const n=new FileReader;n.onload=t=>{const e=new window.Image;e.src=t.target.result,e.onload=()=>{let s=e.width,i=e.height,n=1;s>400&&(n=400/s);const r=12,o=new oa(e,{left:0,top:0,originX:"center",originY:"center",width:s,height:i,scaleX:n,scaleY:n,selectable:!1,evented:!1,hasControls:!1,hasBorders:!1}),l=new Bn({left:0,top:0,originX:"center",originY:"center",width:s*n+2*r,height:i*n+2*r,fill:"rgba(0,0,0,0)",selectable:!1,evented:!1,hasControls:!1,hasBorders:!1}),h=new Zn([l,o],{left:this.canvas.width/2,top:this.canvas.height/2,originX:"center",originY:"center",selectable:!0,evented:!0,hasControls:!1,hasBorders:!1});this.addCustomControls(h),this.canvas.add(h),this.canvas.setActiveObject(h),this.canvas.renderAll(),this.uploadedImages.push({url:t.target.result,fabricObj:(0,a.IG)(h)}),this.updateImageCount()}},n.readAsDataURL(i),t.target.value=""},removePreviewImage(t){const e=this.uploadedImages[t];e&&e.fabricObj&&this.canvas.contains(e.fabricObj)&&this.canvas.remove(e.fabricObj)},removeImageObject(t){this.canvas.remove(t),this.canvas.renderAll(),this.updateImageCount()},updateImageCount(){this.imageCount=this.uploadedImages.length},replaceDefaultImage(t){if(!this.defaultImageObject)return;const e=new window.Image;e.src=t,e.onload=()=>{const t=this.canvas.width,s=this.canvas.height,i=e.width,n=e.height,r=Math.max(t/i,s/n);this.defaultImageObject.setElement(e),this.defaultImageObject.set({scaleX:r,scaleY:r,left:(t-i*r)/2,top:(s-n*r)/2,originX:"left",originY:"top",width:i,height:n}),this.canvas.renderAll()}},async initializeCanvas(){const t=414,e=736;this.canvas=(0,a.IG)(new Hr(this.$refs.canvas,{width:t,height:e,selection:!1,backgroundColor:"#ffffff"})),this.$refs.canvas.style.width=t+"px",this.$refs.canvas.style.height=e+"px";const s=new window.Image;s.src=this.backroundList[0].src,s.onload=async()=>{const t=this.canvas.width,e=this.canvas.height,i=s.width,n=s.height,r=Math.max(t/i,e/n),o=new oa(s,{left:(t-i*r)/2,top:(e-n*r)/2,originX:"left",originY:"top",scaleX:r,scaleY:r,width:i,height:n,selectable:!1,evented:!1,hasControls:!1,hasBorders:!1,lockMovementX:!0,lockMovementY:!0,lockScalingX:!0,lockScalingY:!0,lockRotation:!0});this.canvas.add(o),this.defaultImageObject=o,this.canvas.renderAll(),await this.addHumanSvg(),await this.addHumanControlLayer()}},addSticker(t){const e=new window.Image;e.src=t,e.onload=()=>{let t=e.width,s=e.height;const i=12,n=new oa(e,{left:0,top:0,originX:"center",originY:"center",width:t,height:s,selectable:!1,evented:!1,hasControls:!1,hasBorders:!1}),r=new Bn({left:0,top:0,originX:"center",originY:"center",width:t+2*i,height:s+2*i,fill:"rgba(0,0,0,0)",selectable:!1,evented:!1,hasControls:!1,hasBorders:!1}),o=new Zn([r,n],{left:this.canvas.width/2,top:this.canvas.height/2,originX:"center",originY:"center",selectable:!0,evented:!0,hasControls:!1,hasBorders:!1});this.addCustomControls(o),this.canvas.add(o),this.canvas.setActiveObject(o),this.canvas.renderAll()}},syncTextboxBackgroundColors(){let t=!1;this.textboxes.forEach(((e,s)=>{!e.backgroundColor&&e.fabricObj._bgRect&&(this.textboxes[s].backgroundColor=e.fabricObj._bgRect.fill,t=!0)})),t&&(this.textboxes=[...this.textboxes])}},mounted:async function(){this.$nextTick((async()=>{await this.initializeCanvas(),this.canvas&&(this.canvas.on("object:removed",(t=>{const e=this.uploadedImages.findIndex((e=>e.fabricObj===t.target));-1!==e&&(this.uploadedImages.splice(e,1),this.uploadedImages=this.uploadedImages.slice());const s=this.textboxes.findIndex((e=>e.fabricObj===t.target));-1!==s&&(this.textboxes.splice(s,1),this.textboxes=[...this.textboxes]),this.updateImageCount()})),this.canvas.on("text:editing:entered",(t=>{"i-text"===t.target.type&&this.showColorPanel(t.target)})),this.canvas.on("text:editing:exited",(()=>{this.hideColorPanel()})),this.canvas.on("mouse:down",(t=>{t.target&&"i-text"===t.target.type||this.hideColorPanel()}))),this.syncTextboxBackgroundColors();const t=this.$el.querySelector(".mobile-wrapper");t&&t.addEventListener("touchmove",(t=>{this.panelOpen&&t.preventDefault()}),{passive:!1})}))}};const My=(0,mv.A)(Ay,[["render",wy],["__scopeId","data-v-3f23a953"]]);var Ry=My,Ly=s(8713);const Fy={class:"relative"},jy={class:"TopBar h-[34px] flex items-center bg-gray-900 relative select-none"};function Ny(t,e,s,n,r,o){const a=(0,i.g2)("MainCanvas");return(0,i.uX)(),(0,i.CE)("div",Fy,[(0,i.Lk)("div",jy,[e[4]||(e[4]=(0,i.Lk)("span",{class:"absolute inset-0 flex items-center justify-center pointer-events-none text-[16px] text-[#9A9A9E]"}," 2025. 06. 08 ",-1)),r.showPopup?((0,i.uX)(),(0,i.CE)(i.FK,{key:1},[(0,i.Lk)("button",{class:"text-red-400 flex absolute left-[20px] z-10",onClick:e[1]||(e[1]=(...t)=>o.closePopup&&o.closePopup(...t))}," 취소 "),(0,i.Lk)("button",{class:"text-blue-400 flex absolute right-[20px] z-10",onClick:e[2]||(e[2]=(...t)=>o.save&&o.save(...t))}," 저장 ")],64)):((0,i.uX)(),(0,i.CE)("button",{key:0,class:"text-green-300 flex absolute right-[20px] z-10",onClick:e[0]||(e[0]=(...t)=>o.openPopup&&o.openPopup(...t))},e[3]||(e[3]=[(0,i.Lk)("img",{src:Ly,alt:""},null,-1),(0,i.eW)(),(0,i.Lk)("span",null,"완료",-1)])))]),(0,i.Lk)("div",null,[(0,i.bF)(a,{ref:"mainCanvas",hideUi:r.showPopup},null,8,["hideUi"])])])}var By={components:{MainCanvas:Ry},data(){return{showPopup:!1}},methods:{openPopup(){this.showPopup=!0},closePopup(){this.showPopup=!1},save(){this.$refs.mainCanvas&&this.$refs.mainCanvas.saveCanvasAsImage&&this.$refs.mainCanvas.saveCanvasAsImage(),this.showPopup=!1}}};const Wy=(0,mv.A)(By,[["render",Ny]]);var Xy=Wy,Yy={components:{CanvasUI:Xy},data(){return{activeTab:0,tabs:[],vhRaf:null,lastVh:0}},mounted(){this.setRealViewportHeight(),window.addEventListener("resize",this.setRealViewportHeight),window.addEventListener("orientationchange",this.setRealViewportHeight),window.addEventListener("scroll",this.setRealViewportHeight,{passive:!0}),this.startVhPolling()},beforeUnmount(){window.removeEventListener("resize",this.setRealViewportHeight),window.removeEventListener("orientationchange",this.setRealViewportHeight),window.removeEventListener("scroll",this.setRealViewportHeight),cancelAnimationFrame(this.vhRaf)},methods:{setRealViewportHeight(){const t=.01*window.innerHeight;document.documentElement.style.setProperty("--vh",`${t}px`);const e=this.$refs.contentArea;e&&(e.style.height="calc(var(--vh, 1vh) * 100)"),this.lastVh=t},startVhPolling(){const t=()=>{const e=.01*window.innerHeight;e!==this.lastVh&&this.setRealViewportHeight(),this.vhRaf=requestAnimationFrame(t)};this.vhRaf=requestAnimationFrame(t)}}};const Vy=(0,mv.A)(Yy,[["render",r]]);var Hy=Vy},1129:function(t,e,s){"use strict";t.exports=s.p+"img/shirt.06e570ae.svg"},1560:function(t,e,s){"use strict";t.exports=s.p+"img/다가오는솔라스 (1).ab67dde6.jpg"},2603:function(t,e,s){"use strict";var i=s(655);t.exports=function(t,e){return void 0===t?arguments.length<2?"":e:i(t)}},2697:function(t,e,s){"use strict";t.exports=s.p+"img/green.7795255f.svg"},2760:function(t,e,s){"use strict";t.exports=s.p+"img/08.14ec09da.svg"},2904:function(t,e,s){"use strict";t.exports=s.p+"img/dress.3251499f.svg"},3055:function(t,e,s){"use strict";t.exports=s.p+"img/다가오는솔라스 (4).f3685030.jpg"},3167:function(t,e,s){"use strict";var i=s(4901),n=s(34),r=s(2967);t.exports=function(t,e,s){var o,a;return r&&i(o=e.constructor)&&o!==s&&n(a=o.prototype)&&a!==s.prototype&&r(t,a),t}},3427:function(t,e,s){"use strict";t.exports=s.p+"img/10.e6df4c17.svg"},3713:function(t,e,s){"use strict";t.exports=s.p+"img/다가오는솔라스 (2).8d50a0bc.jpg"},4684:function(t,e,s){"use strict";t.exports=s.p+"img/delete.11980f64.svg"},4979:function(t,e,s){"use strict";var i=s(6518),n=s(4576),r=s(7751),o=s(6980),a=s(4913).f,l=s(9297),h=s(679),c=s(3167),u=s(2603),d=s(5002),g=s(6193),p=s(3724),f=s(6395),m="DOMException",_=r("Error"),v=r(m),y=function(){h(this,b);var t=arguments.length,e=u(t<1?void 0:arguments[0]),s=u(t<2?void 0:arguments[1],"Error"),i=new v(e,s),n=new _(e);return n.name=m,a(i,"stack",o(1,g(n.stack,1))),c(i,this,y),i},b=y.prototype=v.prototype,C="stack"in new _(m),x="stack"in new v(1,2),w=v&&p&&Object.getOwnPropertyDescriptor(n,m),S=!!w&&!(w.writable&&w.configurable),T=C&&!S&&!x;i({global:!0,constructor:!0,forced:f||T},{DOMException:T?y:v});var k=r(m),O=k.prototype;if(O.constructor!==k)for(var E in f||a(O,"constructor",o(1,k)),d)if(l(d,E)){var D=d[E],I=D.s;l(k,I)||a(k,I,o(6,D.c))}},5002:function(t){"use strict";t.exports={IndexSizeError:{s:"INDEX_SIZE_ERR",c:1,m:1},DOMStringSizeError:{s:"DOMSTRING_SIZE_ERR",c:2,m:0},HierarchyRequestError:{s:"HIERARCHY_REQUEST_ERR",c:3,m:1},WrongDocumentError:{s:"WRONG_DOCUMENT_ERR",c:4,m:1},InvalidCharacterError:{s:"INVALID_CHARACTER_ERR",c:5,m:1},NoDataAllowedError:{s:"NO_DATA_ALLOWED_ERR",c:6,m:0},NoModificationAllowedError:{s:"NO_MODIFICATION_ALLOWED_ERR",c:7,m:1},NotFoundError:{s:"NOT_FOUND_ERR",c:8,m:1},NotSupportedError:{s:"NOT_SUPPORTED_ERR",c:9,m:1},InUseAttributeError:{s:"INUSE_ATTRIBUTE_ERR",c:10,m:1},InvalidStateError:{s:"INVALID_STATE_ERR",c:11,m:1},SyntaxError:{s:"SYNTAX_ERR",c:12,m:1},InvalidModificationError:{s:"INVALID_MODIFICATION_ERR",c:13,m:1},NamespaceError:{s:"NAMESPACE_ERR",c:14,m:1},InvalidAccessError:{s:"INVALID_ACCESS_ERR",c:15,m:1},ValidationError:{s:"VALIDATION_ERR",c:16,m:0},TypeMismatchError:{s:"TYPE_MISMATCH_ERR",c:17,m:1},SecurityError:{s:"SECURITY_ERR",c:18,m:1},NetworkError:{s:"NETWORK_ERR",c:19,m:1},AbortError:{s:"ABORT_ERR",c:20,m:1},URLMismatchError:{s:"URL_MISMATCH_ERR",c:21,m:1},QuotaExceededError:{s:"QUOTA_EXCEEDED_ERR",c:22,m:1},TimeoutError:{s:"TIMEOUT_ERR",c:23,m:1},InvalidNodeTypeError:{s:"INVALID_NODE_TYPE_ERR",c:24,m:1},DataCloneError:{s:"DATA_CLONE_ERR",c:25,m:1}}},5350:function(t,e,s){var i={"./backround/다가오는솔라스 (1).jpg":1560,"./backround/다가오는솔라스 (2).jpg":3713,"./backround/다가오는솔라스 (3).jpg":6502,"./backround/다가오는솔라스 (4).jpg":3055,"./clothes/dress.svg":2904,"./clothes/dress팔.svg":5892,"./clothes/shirt.svg":1129,"./clothes/shirt팔.svg":8199,"./green.svg":2697,"./sticker/01.svg":9009,"./sticker/02.svg":5874,"./sticker/03.svg":515,"./sticker/04.svg":7951,"./sticker/05.svg":9805,"./sticker/06.svg":5630,"./sticker/07.svg":9359,"./sticker/08.svg":2760,"./sticker/09.svg":8153,"./sticker/10.svg":3427,"./sticker/11.svg":8258,"./ui/add.svg":7222,"./ui/cached.svg":8015,"./ui/close.svg":8655,"./ui/closeText.svg":9434,"./ui/delete.svg":4684,"./ui/download.svg":8713,"./ui/open_in_full.svg":795,"./인간.svg":9759,"./인간팔.svg":7608};function n(t){var e=r(t);return s(e)}function r(t){if(!s.o(i,t)){var e=new Error("Cannot find module '"+t+"'");throw e.code="MODULE_NOT_FOUND",e}return i[t]}n.keys=function(){return Object.keys(i)},n.resolve=r,t.exports=n,n.id=5350},5630:function(t,e,s){"use strict";t.exports=s.p+"img/06.b6b63cd3.svg"},5874:function(t,e,s){"use strict";t.exports=s.p+"img/02.27447975.svg"},5892:function(t,e,s){"use strict";t.exports=s.p+"img/dress팔.4f5f98d8.svg"},6193:function(t,e,s){"use strict";var i=s(9504),n=Error,r=i("".replace),o=function(t){return String(new n(t).stack)}("zxcasd"),a=/\n\s*at [^:]*:[^\n]*/,l=a.test(o);t.exports=function(t,e){if(l&&"string"==typeof t&&!n.prepareStackTrace)while(e--)t=r(t,a,"");return t}},6502:function(t,e,s){"use strict";t.exports=s.p+"img/다가오는솔라스 (3).84a0f5cc.jpg"},7222:function(t,e,s){"use strict";t.exports=s.p+"img/add.7dfab8a5.svg"},7608:function(t,e,s){"use strict";t.exports=s.p+"img/인간팔.fbad4d85.svg"},7951:function(t,e,s){"use strict";t.exports=s.p+"img/04.b9047e4c.svg"},8015:function(t,e,s){"use strict";t.exports=s.p+"img/cached.f9dec18a.svg"},8153:function(t,e,s){"use strict";t.exports=s.p+"img/09.57fda9f1.svg"},8199:function(t,e,s){"use strict";t.exports=s.p+"img/shirt팔.250fb48a.svg"},8258:function(t,e,s){"use strict";t.exports=s.p+"img/11.c0d666a5.svg"},8655:function(t,e,s){"use strict";t.exports=s.p+"img/close.3c53a8b4.svg"},8660:function(t){function e(t){var e=new Error("Cannot find module '"+t+"'");throw e.code="MODULE_NOT_FOUND",e}e.keys=function(){return[]},e.resolve=e,e.id=8660,t.exports=e},8713:function(t,e,s){"use strict";t.exports=s.p+"img/download.f2d1c768.svg"},9009:function(t,e,s){"use strict";t.exports=s.p+"img/01.f4c195f1.svg"},9359:function(t,e,s){"use strict";t.exports=s.p+"img/07.decdf6d4.svg"},9434:function(t,e,s){"use strict";t.exports=s.p+"img/closeText.e7647758.svg"},9759:function(t,e,s){"use strict";t.exports=s.p+"img/인간.db6c9b9b.svg"},9805:function(t,e,s){"use strict";t.exports=s.p+"img/05.5982cb36.svg"}}]);
//# sourceMappingURL=81.e77878a7.js.map