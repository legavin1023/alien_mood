(self["webpackChunkalien_mood"]=self["webpackChunkalien_mood"]||[]).push([[934],{4:function(t){"use strict";t.exports="data:image/png;base64,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"},655:function(t,e,n){"use strict";var i=n(6955),s=String;t.exports=function(t){if("Symbol"===i(t))throw new TypeError("Cannot convert a Symbol value to a string");return s(t)}},1168:function(t,e,n){"use strict";t.exports=n.p+"img/다가오는솔라스 (3).84a0f5cc.jpg"},1321:function(t){"use strict";t.exports="data:image/png;base64,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"},1585:function(t){"use strict";t.exports="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAEgAAABICAYAAABV7bNHAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAtkSURBVHgB7VxrcFxlGX6+s7ek2Wy22dxI0nRbUmgGkDRyUaSQMuOIYGkFLziI8KMgReUy4KgzSmkddNCxUH/gDCNQHEScqoCIOsj04qW0Fm1oCVYKzaZNmjaXZrNJdrOXc47Pd87mspe0u5vGJM0+mdM93XN2zznPeb/nfd73212BTOFtdkMLruFaM5dGQPcCwo05Ad3Pc/VxpYXLTlhdr+DImwOZvFKccQ/vx7zQ1Pu5dufcISQDCPEcl03w7fGddrdJtxgRM7yBuzyAcxlCewIDsU3wt/jTbk77IiNqtB1yDfMDPliszWjb3Z68QUnZ1Xt54zwjR8ILNbYTNVdcmrwhMYLmX+QkwwdFWTVRl8YJMrPUfsxfckbhQyCyYlSTxoeYNvwo8uRIeOGybRj9jxlB5tBqQx7jUJQlcqiZEaRpG5BHIlTD+zGCvI3UHns/8kgC3XcgukSBaluLPNKAVYPLvkah3b4WeUyGZqlBjchjEuiNilmV5zEJvMo5VaGfdQi3gjxOCytyhaDHjEWA/uMwDbluPq/ppv3U9fhT8h9hPgruZ7EABUVAYTHXbeZ+sxi5ExSNwF5Wi/Nu+wG0kSEIewEUqwPCaodi42K1GetCmEGqayrU0BAi/i4EOw5h6PBehD/YZ5JWtggGibOQrNwJioVRWHU+Ft96PUIyiPT49elJ66MQZtApDBpLAdf5ONI9iJM7XkfXtk0sBQMQ5XUGkbMJU9AgesxoGBF68NgQl2G68yCXEJcRjrQwl8iEJWw+Hx0kMT0wSNVjTtTedCuu3PYeKtY+BP3oQQaUBbMJMyzSwiA41Kli2foHceHju6Afa51VJM2KLCYJCR5VsbCpCcs2/ZmR9O6sIWlaCNLUKGwuJqrzuFSNPzo8pv6YSBJkEhI+qaJy1cfhvn499IFuzAbkLtKngWOhDcf/tA3+g9spyg5DeAX/bAurULL8KpR94hoju4VPxRgpE06BJA23c7jd/Sj27XgecJVlntkmywpTxLQQZHEAQ0f2Y2jfq4CzFGOd3cgI+l77CY5sscN771ZUX/8pBLvUxOFE4uyeQriu/iICB7aT7QWpBxi98MFTPFAfLUYRBMlUHPRXQofO5KEN+6GHmTm4bniuknLTUmRpJaaFIHkjFQdZKuCJyZMehbzY4lKepwLfj1Yz1b+B8quaEQ1MfLEp3J7L1yLwt18BFUsS3lqSqfd3kQcVnk9/HWVXrkZRnReWBfRgFsW0U6oOLaoiNjCI0MkTjOQd6N3+HFQtyhPL7pKnh6AzQNc0iEVNaH/6XlQ2tyJ5ckVagqKlDUiWSGGxGgJe+pn7sexrj3D4WhHuIxmqgJZEsrw0YV8Ip9eN0qYG1K65A//6Uh1QWY9sMCMESRiK4T9JR32MjpwGcYI/JH+wu0sA6tcoDHKOvYvFD76ARbesxnCbGudPnPYgWkwg3EufFhoxXWqWmME0b9ZmseBw6jXKTRbZyxvfoPceQ9lnv4NaSc4R1RD0bA+XC2Ysgkyh1WEtLkk9ed42bSRMPdXGd2d9V//VbxuRIyzj5Mjhqtgp7K64BksNismI4WPE1KNMPqMxGWaOICnkJZVwnl+NcE/iJoXXE+ofYNYLmU8wI5WuusMImoSMx4xkcykIdnbg2MvbEAv0cBQVwuauxILaBr73cjjrylkSScJyI+n/T9DosGnfh6WP7THqt2QoheSk7eD4MBrqh6thJSKBpP1sAqGuDrTew0znqqVmFciQMtswI4NGOFmrl6GSol7atFLOdSFbTA9BMszZDkF0xGiLjJX3bItgqJeRU4H6H7+N0hUrEO5O0hPuZ18o0PPWb+ldKuPvR5NJP6WnK/T1OOGucpOAUZ/DY0jE1Bg6tz6Mzmc5NCuX8j2iyAbTQpA8B0flEjjqLoYocJoHolkrrFkO90eug+eKFYZGhLu1FLEVis5+kR/BvS8D1ReYF0ydUWXPKSkAtKjOoVSD5ZsP4PDjX4B6qgMoZzSxDzVGlIzY0mpjNVtyjPPGNCDSG0XdLeuw9MvrMKqz8uLUiGyN6Ey78buuJOqCzrtdvMyKt++7D3BXjV9kUQkC/30LFddcZbRMxsCLj/pVak0Drvz1QZx4cyc6X92M8H/+bhpSRpUU8algWtK8YDcxSo0NnZBNMXOR65FTsjeUXiwlOUVeKz547pcI/vt1YEHJ+EaXB31v/tzMUskNNUag1LHQcQ2llzfjo0/9Hpc+ewiea78C/cRhQ7+m0hmY8XaHbkSJiuJ6K9pffAnHn14PUdMATEjxhuEbGcahLRvhXMpSQ4ulvhHZM4jq0Jn2y3HhA4/gspfaUdx0g+G+cxFoiRklSFipITXMNEVR7H9oHTokOXWXGNGUsi/71qdeewJtz79gkGkQmLbwFIZwh7pkB7MQl37/STbi/gqwD54iYhlgWgjSVRVW1qU2jhKrM76wbrVxBq6g3OwN2d0qL+JDHNq8Afs+X4ehQ9QNing6csz3ZGtk0UXofOYbaPnWvcx0fI8ykabNkXh5w20a3I2NaNi8myS1jk0iZIppEWlrsQW9e7dTe3xMzx6ePv/Y5I8ND1CHOtlifR9h30Fo/k7qC9Nx5flmRJxBUA3yqhsw+M4b2Pu5WlTf9kPUrr2dN0NBiBlRZ90lkntAHFqRHurTZQ3wrHkYfTt/wRaMB5lCoO6K3KqUkSCcF63Exd99KsUJF9K+HNy4HoP/eJG3uWjsUMY8GKeHYC80U/EUIFsmenc738cK97W3o+aGu1ByidewDmoYKZEi7UMs2IcDd10InJd5RT8tESSDweLkGCih/1jgwpQho0KLG8q47hjpW86ncZt/92/g/8NP4WC3sv7+n8G5eCnn37QEzdE1wdavB0qll3Obesbdxrkx9UzGrTL6ug7L/kXixcmLLaK41V2ECPvYrfdcAP97rVAKUi9N2AWfL0Y2mBsEUcwvfuxVLNv4FzhcHL9d7wPUN4RYnMWiJmnUJ10SJ6wY+rAFlnQjWOq/rNOywMxV89mA7Y2Rk/0obWxC+dV/ZGbqRv87exCgYx45cQSq7D/LKKO5LL3xPtSuvo1tWy3J++gcdsOI9VC3PLUZH3puEAQpJywr2FuLDNAIOirYqr0JNTfeZMpT3BkojJoYzWKkP7WhZi8R6Nq+C+kr3skxZwgahzBsj5zqlktaJJcWMrqcCo6xqhdli7NqLs6dzwflMsdlZCuNBbCC/d+83WjBZOtppkCQbhSBsg8uLImLjEuzQDxLH2dhilcciuGvhGXCR0gmPTWeG+fHCqoEh1YM/1x3M4Kc+oG7Atki9yFmVNF+iifdcd9Q4ja9iO3PXtMYngWIqnq0fu9GlH/yblSsvBlFixdxHkyRc4SG+Za+S8aXcYNkP5vTQMGjPeh45kV0/+5xCNkZkJ4ph9ZH7k5aZogwFZGzDSlEyNTrqTYnDvWp9WPGIIfYAC37MNsX7DTa6YZlU87GdQsnJGUWiwUDvFkdCLF616Rnkv5IdiWncA65EzTTMDrxUdPXGGlMljIcEFaHWc6cJczBLBaHjFq5pJu7P4vIf8r1DMgTdAbkCToDFPNL93mkh+5X4r9IkEd6GN84bEEe6aGjhX1LfRfySA8hdsa/kmlry3/rJw0CkYUKfMb3w7cij0To+lb53XkzzUeiW5BHIqLRjfLBJOhEi4+MPYk8TEguJCeYaBQtBmM+5OHDoBk9EuMESS2KRFZhfpPk49BqnvhbQomlhgwrBWsxP0nysYWyFl372yc+mb7RW9Xohd3OHuW8+bGTNkbOqmRyJNIXq0YkRVbQST6BcxvycxWb6Xea0pEjkeGPvGkb6CrvjM+LT+2DxzOL0XOXv4q3FYrYkvuPvCWjtN4Fp2cN+7vXkay5/DOBOzAkXsGpvYFMXvk/LO1Ui2F+UUgAAAAASUVORK5CYII="},1897:function(t){"use strict";t.exports="data:image/png;base64,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"},2603:function(t,e,n){"use strict";var i=n(655);t.exports=function(t,e){return void 0===t?arguments.length<2?"":e:i(t)}},2697:function(t,e,n){"use strict";t.exports=n.p+"img/green.06270ed8.svg"},2967:function(t,e,n){"use strict";var i=n(6706),s=n(34),r=n(7750),o=n(3506);t.exports=Object.setPrototypeOf||("__proto__"in{}?function(){var t,e=!1,n={};try{t=i(Object.prototype,"__proto__","set"),t(n,[]),e=n instanceof Array}catch(a){}return function(n,i){return r(n),o(i),s(n)?(e?t(n,i):n.__proto__=i,n):n}}():void 0)},3167:function(t,e,n){"use strict";var i=n(4901),s=n(34),r=n(2967);t.exports=function(t,e,n){var o,a;return r&&i(o=e.constructor)&&o!==n&&s(a=o.prototype)&&a!==n.prototype&&r(t,a),t}},3471:function(t,e,n){"use strict";t.exports=n.p+"img/dress팔.4f5f98d8.svg"},3506:function(t,e,n){"use strict";var i=n(3925),s=String,r=TypeError;t.exports=function(t){if(i(t))return t;throw new r("Can't set "+s(t)+" as a prototype")}},3731:function(t,e,n){"use strict";t.exports=n.p+"img/다가오는솔라스 (2).8d50a0bc.jpg"},3757:function(t,e,n){"use strict";t.exports=n.p+"img/다가오는솔라스 (4).f3685030.jpg"},3925:function(t,e,n){"use strict";var i=n(34);t.exports=function(t){return i(t)||null===t}},4904:function(t,e,n){"use strict";t.exports=n.p+"img/shirt.06e570ae.svg"},4979:function(t,e,n){"use strict";var i=n(6518),s=n(4576),r=n(7751),o=n(6980),a=n(4913).f,h=n(9297),c=n(679),l=n(3167),u=n(2603),d=n(5002),g=n(6193),p=n(3724),f=n(6395),m="DOMException",_=r("Error"),v=r(m),y=function(){c(this,C);var t=arguments.length,e=u(t<1?void 0:arguments[0]),n=u(t<2?void 0:arguments[1],"Error"),i=new v(e,n),s=new _(e);return s.name=m,a(i,"stack",o(1,g(s.stack,1))),l(i,this,y),i},C=y.prototype=v.prototype,b="stack"in new _(m),w="stack"in new v(1,2),x=v&&p&&Object.getOwnPropertyDescriptor(s,m),S=!!x&&!(x.writable&&x.configurable),T=b&&!S&&!w;i({global:!0,constructor:!0,forced:f||T},{DOMException:T?y:v});var E=r(m),k=E.prototype;if(k.constructor!==E)for(var A in f||a(k,"constructor",o(1,E)),d)if(h(d,A)){var O=d[A],D=O.s;h(E,D)||a(E,D,o(6,O.c))}},5002:function(t){"use strict";t.exports={IndexSizeError:{s:"INDEX_SIZE_ERR",c:1,m:1},DOMStringSizeError:{s:"DOMSTRING_SIZE_ERR",c:2,m:0},HierarchyRequestError:{s:"HIERARCHY_REQUEST_ERR",c:3,m:1},WrongDocumentError:{s:"WRONG_DOCUMENT_ERR",c:4,m:1},InvalidCharacterError:{s:"INVALID_CHARACTER_ERR",c:5,m:1},NoDataAllowedError:{s:"NO_DATA_ALLOWED_ERR",c:6,m:0},NoModificationAllowedError:{s:"NO_MODIFICATION_ALLOWED_ERR",c:7,m:1},NotFoundError:{s:"NOT_FOUND_ERR",c:8,m:1},NotSupportedError:{s:"NOT_SUPPORTED_ERR",c:9,m:1},InUseAttributeError:{s:"INUSE_ATTRIBUTE_ERR",c:10,m:1},InvalidStateError:{s:"INVALID_STATE_ERR",c:11,m:1},SyntaxError:{s:"SYNTAX_ERR",c:12,m:1},InvalidModificationError:{s:"INVALID_MODIFICATION_ERR",c:13,m:1},NamespaceError:{s:"NAMESPACE_ERR",c:14,m:1},InvalidAccessError:{s:"INVALID_ACCESS_ERR",c:15,m:1},ValidationError:{s:"VALIDATION_ERR",c:16,m:0},TypeMismatchError:{s:"TYPE_MISMATCH_ERR",c:17,m:1},SecurityError:{s:"SECURITY_ERR",c:18,m:1},NetworkError:{s:"NETWORK_ERR",c:19,m:1},AbortError:{s:"ABORT_ERR",c:20,m:1},URLMismatchError:{s:"URL_MISMATCH_ERR",c:21,m:1},QuotaExceededError:{s:"QUOTA_EXCEEDED_ERR",c:22,m:1},TimeoutError:{s:"TIMEOUT_ERR",c:23,m:1},InvalidNodeTypeError:{s:"INVALID_NODE_TYPE_ERR",c:24,m:1},DataCloneError:{s:"DATA_CLONE_ERR",c:25,m:1}}},5233:function(t,e,n){"use strict";t.exports=n.p+"img/dress.3251499f.svg"},5636:function(t,e,n){"use strict";t.exports=n.p+"img/shirt팔.250fb48a.svg"},5835:function(t){"use strict";t.exports="data:image/png;base64,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"},6193:function(t,e,n){"use strict";var i=n(9504),s=Error,r=i("".replace),o=function(t){return String(new s(t).stack)}("zxcasd"),a=/\n\s*at [^:]*:[^\n]*/,h=a.test(o);t.exports=function(t,e){if(h&&"string"==typeof t&&!s.prepareStackTrace)while(e--)t=r(t,a,"");return t}},6272:function(t,e,n){"use strict";t.exports=n.p+"img/custom-handle.8fe57529.png"},7089:function(t,e,n){var i={"./Ae.png":5835,"./Ai.png":4,"./Figma.png":9308,"./Ps.png":1585,"./css.png":1897,"./custom-handle.png":6272,"./deleteIcon.png":7800,"./dress.svg":5233,"./dress팔.svg":3471,"./green.svg":2697,"./html.png":1321,"./shirt.svg":4904,"./shirt팔.svg":5636,"./vsCode.png":9e3,"./다가오는솔라스 (1).jpg":9790,"./다가오는솔라스 (2).jpg":3731,"./다가오는솔라스 (3).jpg":1168,"./다가오는솔라스 (4).jpg":3757,"./인간.svg":9759,"./인간팔.svg":7608};function s(t){var e=r(t);return n(e)}function r(t){if(!n.o(i,t)){var e=new Error("Cannot find module '"+t+"'");throw e.code="MODULE_NOT_FOUND",e}return i[t]}s.keys=function(){return Object.keys(i)},s.resolve=r,t.exports=s,s.id=7089},7608:function(t,e,n){"use strict";t.exports=n.p+"img/인간팔.fbad4d85.svg"},7800:function(t,e,n){"use strict";t.exports=n.p+"img/deleteIcon.3e9c3b8f.png"},8660:function(t,e,n){var i={"./Ae.png":5835,"./Ai.png":4,"./Figma.png":9308,"./Ps.png":1585,"./css.png":1897,"./custom-handle.png":6272,"./deleteIcon.png":7800,"./html.png":1321,"./vsCode.png":9e3};function s(t){var e=r(t);return n(e)}function r(t){if(!n.o(i,t)){var e=new Error("Cannot find module '"+t+"'");throw e.code="MODULE_NOT_FOUND",e}return i[t]}s.keys=function(){return Object.keys(i)},s.resolve=r,t.exports=s,s.id=8660},9e3:function(t){"use strict";t.exports="data:image/png;base64,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"},9308:function(t){"use strict";t.exports="data:image/png;base64,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"},9759:function(t,e,n){"use strict";t.exports=n.p+"img/인간.9e69ff0c.svg"},9790:function(t,e,n){"use strict";t.exports=n.p+"img/다가오는솔라스 (1).ab67dde6.jpg"},9934:function(t,e,n){"use strict";n.r(e),n.d(e,{default:function(){return lC}});var i=n(6768),s=n(4232);const r={style:{display:"flex",gap:"10px","margin-bottom":"20px"}},o=["onClick"],a={key:0},h={key:1};function c(t,e,n,c,l,u){const d=(0,i.g2)("VisitorCounter"),g=(0,i.g2)("TestFinal"),p=(0,i.g2)("MainCanvas");return(0,i.uX)(),(0,i.CE)("div",null,[(0,i.Lk)("div",r,[((0,i.uX)(!0),(0,i.CE)(i.FK,null,(0,i.pI)(l.tabs,((t,e)=>((0,i.uX)(),(0,i.CE)("button",{key:e,onClick:t=>l.activeTab=e,style:(0,s.Tr)({padding:"10px 20px",backgroundColor:l.activeTab===e?"#007BFF":"#E0E0E0",color:l.activeTab===e?"white":"black",border:"none",borderRadius:"5px",cursor:"pointer"})},(0,s.v_)(t.name),13,o)))),128))]),(0,i.Lk)("div",null,[(0,i.Lk)("div",null,[e[0]||(e[0]=(0,i.Lk)("h2",null,"방문자 수",-1)),(0,i.bF)(d)]),0===l.activeTab?((0,i.uX)(),(0,i.CE)("div",a,[e[1]||(e[1]=(0,i.Lk)("h2",null,"최종 테스트",-1)),(0,i.bF)(g)])):(0,i.Q3)("",!0),1===l.activeTab?((0,i.uX)(),(0,i.CE)("div",h,[e[2]||(e[2]=(0,i.Lk)("h2",null,"메인",-1)),(0,i.bF)(p)])):(0,i.Q3)("",!0)])])}const l={style:{position:"relative",width:"100%",height:"100%"}},u={ref:"canvas",style:{border:"1px solid #ccc",width:"100%",height:"100%"}},d={class:"panel-content"},g=["onClick"],p=["src","alt"],f=["onClick"],m=["onClick"],_={style:{display:"flex",gap:"8px"}},v=["onClick"],y=["src","alt"],C={key:0,style:{margin:"12px 0"}},b=["onClick"],w={style:{display:"flex",gap:"8px","margin-bottom":"12px"}},x=["onClick"];function S(t,e,n,r,o,a){return(0,i.uX)(),(0,i.CE)("div",l,[(0,i.Lk)("canvas",u,null,512),(0,i.Lk)("div",{class:(0,s.C4)(["edit-panel",{open:o.panelOpen}]),onTouchstart:e[6]||(e[6]=(...t)=>a.onTouchStart&&a.onTouchStart(...t)),onTouchmove:e[7]||(e[7]=(...t)=>a.onTouchMove&&a.onTouchMove(...t)),onTouchend:e[8]||(e[8]=(...t)=>a.onTouchEnd&&a.onTouchEnd(...t))},[(0,i.Lk)("div",{class:"panel-handle",onClick:e[0]||(e[0]=(...t)=>a.togglePanel&&a.togglePanel(...t))}),(0,i.Lk)("div",d,[((0,i.uX)(!0),(0,i.CE)(i.FK,null,(0,i.pI)(o.additionalImages,(t=>((0,i.uX)(),(0,i.CE)("button",{key:t.src,onClick:e=>a.addImage(t.src),style:{background:"none",border:"none",cursor:"pointer"}},[(0,i.Lk)("img",{src:t.src,alt:t.label,width:"32",height:"32"},null,8,p)],8,g)))),128)),(0,i.Lk)("button",{onClick:e[1]||(e[1]=(...t)=>a.addRectangle&&a.addRectangle(...t))},"도형 추가"),(0,i.Lk)("button",{onClick:e[2]||(e[2]=(...t)=>a.addTextbox&&a.addTextbox(...t))},"텍스트 추가"),((0,i.uX)(!0),(0,i.CE)(i.FK,null,(0,i.pI)(o.predefinedImages,((t,e)=>((0,i.uX)(),(0,i.CE)("button",{key:"replace-img-"+e,onClick:e=>a.replaceDefaultImage(t)}," 기본 이미지 변경 "+(0,s.v_)(e+1),9,f)))),128)),(0,i.Lk)("button",{onClick:e[3]||(e[3]=(...t)=>a.triggerFileInput&&a.triggerFileInput(...t))},"이미지 첨부"),(0,i.Lk)("input",{ref:"fileInput",type:"file",accept:"image/*",style:{display:"none"},onChange:e[4]||(e[4]=(...t)=>a.onFileChange&&a.onFileChange(...t))},null,544),(0,i.Lk)("div",null,[((0,i.uX)(!0),(0,i.CE)(i.FK,null,(0,i.pI)(o.colorButtonList,((t,e)=>((0,i.uX)(),(0,i.CE)("button",{key:t.label+e,onClick:e=>a.changeSvgColorsByIds(t.colors)},(0,s.v_)(t.label),9,m)))),128))]),(0,i.Lk)("div",_,[((0,i.uX)(!0),(0,i.CE)(i.FK,null,(0,i.pI)(o.clothesList,(t=>((0,i.uX)(),(0,i.CE)("button",{key:t.name,onClick:e=>a.selectClothes(t),style:{background:"none",border:"none",cursor:"pointer"}},[(0,i.Lk)("img",{src:t.icon,alt:t.name,width:"48",height:"48"},null,8,y),(0,i.Lk)("div",null,(0,s.v_)(t.name),1)],8,v)))),128))]),o.selectedClothes?((0,i.uX)(),(0,i.CE)("div",C,[((0,i.uX)(!0),(0,i.CE)(i.FK,null,(0,i.pI)(o.selectedClothes.colorButtons,((t,e)=>((0,i.uX)(),(0,i.CE)("button",{key:t.label+e,onClick:n=>a.changeClothesColors(t.targets,o.selectedClothes.name,e),style:{display:"flex","align-items":"center",gap:"8px"}},[t.mainColor?((0,i.uX)(),(0,i.CE)("span",{key:0,style:(0,s.Tr)({display:"inline-block",width:"18px",height:"18px",borderRadius:"50%",background:t.mainColor,border:"1px solid #aaa"})},null,4)):(0,i.Q3)("",!0),(0,i.eW)(" "+(0,s.v_)(t.label),1)],8,b)))),128))])):(0,i.Q3)("",!0),(0,i.Lk)("div",w,[((0,i.uX)(),(0,i.CE)(i.FK,null,(0,i.pI)(["인간","인간팔"],(t=>(0,i.Lk)("button",{key:t,style:(0,s.Tr)({background:o.currentPose===t?"#00bfff":"#eee",color:o.currentPose===t?"#fff":"#333",border:"1px solid #ccc",borderRadius:"6px",padding:"6px 16px",cursor:"pointer"}),onClick:e=>a.changePose(t)},(0,s.v_)(t),13,x))),64))]),(0,i.Lk)("button",{onClick:e[5]||(e[5]=(...t)=>a.saveCanvasAsImage&&a.saveCanvasAsImage(...t))},"이미지로 저장")])],34)])}n(4114),n(8111),n(2489),n(7588),n(1701);var T=n(144);n(1148),n(116),n(8237),n(3579),n(7642),n(8004),n(3853),n(5876),n(2475),n(5024),n(1698);function E(t,e,n){return(e=function(t){var e=function(t,e){if("object"!=typeof t||!t)return t;var n=t[Symbol.toPrimitive];if(void 0!==n){var i=n.call(t,e||"default");if("object"!=typeof i)return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}(t,"string");return"symbol"==typeof e?e:e+""}(e))in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function k(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(t);e&&(i=i.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,i)}return n}function A(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?k(Object(n),!0).forEach((function(e){E(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):k(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}function O(t,e){if(null==t)return{};var n,i,s=function(t,e){if(null==t)return{};var n={};for(var i in t)if({}.hasOwnProperty.call(t,i)){if(e.indexOf(i)>=0)continue;n[i]=t[i]}return n}(t,e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);for(i=0;i<r.length;i++)n=r[i],e.indexOf(n)>=0||{}.propertyIsEnumerable.call(t,n)&&(s[n]=t[n])}return s}function D(t,e){return e||(e=t.slice(0)),Object.freeze(Object.defineProperties(t,{raw:{value:Object.freeze(e)}}))}class I{constructor(){E(this,"browserShadowBlurConstant",1),E(this,"DPI",96),E(this,"devicePixelRatio","undefined"!=typeof window?window.devicePixelRatio:1),E(this,"perfLimitSizeTotal",2097152),E(this,"maxCacheSideLimit",4096),E(this,"minCacheSideLimit",256),E(this,"disableStyleCopyPaste",!1),E(this,"enableGLFiltering",!0),E(this,"textureSize",4096),E(this,"forceGLPutImageData",!1),E(this,"cachesBoundsOfCurve",!1),E(this,"fontPaths",{}),E(this,"NUM_FRACTION_DIGITS",4)}}const P=new class extends I{constructor(t){super(),this.configure(t)}configure(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};Object.assign(this,t)}addFonts(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};this.fontPaths=A(A({},this.fontPaths),t)}removeFonts(){(arguments.length>0&&void 0!==arguments[0]?arguments[0]:[]).forEach((t=>{delete this.fontPaths[t]}))}clearFonts(){this.fontPaths={}}restoreDefaults(t){const e=new I,n=(null==t?void 0:t.reduce(((t,n)=>(t[n]=e[n],t)),{}))||e;this.configure(n)}},M=function(t){for(var e=arguments.length,n=new Array(e>1?e-1:0),i=1;i<e;i++)n[i-1]=arguments[i];return console[t]("fabric",...n)};class R extends Error{constructor(t,e){super("fabric: ".concat(t),e)}}class F extends R{constructor(t){super("".concat(t," 'options.signal' is in 'aborted' state"))}}class L{}class j extends L{testPrecision(t,e){const n="precision ".concat(e," float;\nvoid main(){}"),i=t.createShader(t.FRAGMENT_SHADER);return!!i&&(t.shaderSource(i,n),t.compileShader(i),!!t.getShaderParameter(i,t.COMPILE_STATUS))}queryWebGL(t){const e=t.getContext("webgl");e&&(this.maxTextureSize=e.getParameter(e.MAX_TEXTURE_SIZE),this.GLPrecision=["highp","mediump","lowp"].find((t=>this.testPrecision(e,t))),e.getExtension("WEBGL_lose_context").loseContext(),M("log","WebGL: max texture size ".concat(this.maxTextureSize)))}isSupported(t){return!!this.maxTextureSize&&this.maxTextureSize>=t}}const N={};let B;const W=()=>B||(B={document:document,window:window,isTouchSupported:"ontouchstart"in window||"ontouchstart"in document||window&&window.navigator&&window.navigator.maxTouchPoints>0,WebGLProbe:new j,dispose(){},copyPasteData:N}),Y=()=>W().document,U=()=>W().window,X=()=>{var t;return Math.max(null!==(t=P.devicePixelRatio)&&void 0!==t?t:U().devicePixelRatio,1)},G=new class{constructor(){E(this,"charWidthsCache",{}),E(this,"boundsOfCurveCache",{})}getFontCache(t){let{fontFamily:e,fontStyle:n,fontWeight:i}=t;e=e.toLowerCase(),this.charWidthsCache[e]||(this.charWidthsCache[e]={});const s=this.charWidthsCache[e],r="".concat(n.toLowerCase(),"_").concat((i+"").toLowerCase());return s[r]||(s[r]={}),s[r]}clearFontCache(t){(t=(t||"").toLowerCase())?this.charWidthsCache[t]&&delete this.charWidthsCache[t]:this.charWidthsCache={}}limitDimsByArea(t){const{perfLimitSizeTotal:e}=P,n=Math.sqrt(e*t);return[Math.floor(n),Math.floor(e/n)]}},V="6.6.5";function H(){}const z=Math.PI/2,q=2*Math.PI,K=Math.PI/180,Q=Object.freeze([1,0,0,1,0,0]),J=16,Z=.4477152502,$="center",tt="left",et="top",nt="bottom",it="right",st="none",rt=/\r?\n/,ot="moving",at="scaling",ht="rotating",ct="rotate",lt="skewing",ut="resizing",dt="modifyPoly",gt="modifyPath",pt="changed",ft="scale",mt="scaleX",_t="scaleY",vt="skewX",yt="skewY",Ct="fill",bt="stroke",wt="modified",xt="json",St="svg",Tt=new class{constructor(){this[xt]=new Map,this[St]=new Map}has(t){return this[xt].has(t)}getClass(t){const e=this[xt].get(t);if(!e)throw new R("No class registered for ".concat(t));return e}setClass(t,e){e?this[xt].set(e,t):(this[xt].set(t.type,t),this[xt].set(t.type.toLowerCase(),t))}getSVGClass(t){return this[St].get(t)}setSVGClass(t,e){this[St].set(null!=e?e:t.type.toLowerCase(),t)}},Et=new class extends Array{remove(t){const e=this.indexOf(t);e>-1&&this.splice(e,1)}cancelAll(){const t=this.splice(0);return t.forEach((t=>t.abort())),t}cancelByCanvas(t){if(!t)return[];const e=this.filter((e=>{var n;return e.target===t||"object"==typeof e.target&&(null===(n=e.target)||void 0===n?void 0:n.canvas)===t}));return e.forEach((t=>t.abort())),e}cancelByTarget(t){if(!t)return[];const e=this.filter((e=>e.target===t));return e.forEach((t=>t.abort())),e}};class kt{constructor(){E(this,"__eventListeners",{})}on(t,e){if(this.__eventListeners||(this.__eventListeners={}),"object"==typeof t)return Object.entries(t).forEach((t=>{let[e,n]=t;this.on(e,n)})),()=>this.off(t);if(e){const n=t;return this.__eventListeners[n]||(this.__eventListeners[n]=[]),this.__eventListeners[n].push(e),()=>this.off(n,e)}return()=>!1}once(t,e){if("object"==typeof t){const e=[];return Object.entries(t).forEach((t=>{let[n,i]=t;e.push(this.once(n,i))})),()=>e.forEach((t=>t()))}if(e){const n=this.on(t,(function(){for(var t=arguments.length,i=new Array(t),s=0;s<t;s++)i[s]=arguments[s];e.call(this,...i),n()}));return n}return()=>!1}_removeEventListener(t,e){if(this.__eventListeners[t])if(e){const n=this.__eventListeners[t],i=n.indexOf(e);i>-1&&n.splice(i,1)}else this.__eventListeners[t]=[]}off(t,e){if(this.__eventListeners)if(void 0===t)for(const n in this.__eventListeners)this._removeEventListener(n);else"object"==typeof t?Object.entries(t).forEach((t=>{let[e,n]=t;this._removeEventListener(e,n)})):this._removeEventListener(t,e)}fire(t,e){var n;if(!this.__eventListeners)return;const i=null===(n=this.__eventListeners[t])||void 0===n?void 0:n.concat();if(i)for(let s=0;s<i.length;s++)i[s].call(this,e||{})}}const At=(t,e)=>{const n=t.indexOf(e);return-1!==n&&t.splice(n,1),t},Ot=t=>{if(0===t)return 1;switch(Math.abs(t)/z){case 1:case 3:return 0;case 2:return-1}return Math.cos(t)},Dt=t=>{if(0===t)return 0;const e=t/z,n=Math.sign(t);switch(e){case 1:return n;case 2:return 0;case 3:return-n}return Math.sin(t)};class It{constructor(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;"object"==typeof t?(this.x=t.x,this.y=t.y):(this.x=t,this.y=e)}add(t){return new It(this.x+t.x,this.y+t.y)}addEquals(t){return this.x+=t.x,this.y+=t.y,this}scalarAdd(t){return new It(this.x+t,this.y+t)}scalarAddEquals(t){return this.x+=t,this.y+=t,this}subtract(t){return new It(this.x-t.x,this.y-t.y)}subtractEquals(t){return this.x-=t.x,this.y-=t.y,this}scalarSubtract(t){return new It(this.x-t,this.y-t)}scalarSubtractEquals(t){return this.x-=t,this.y-=t,this}multiply(t){return new It(this.x*t.x,this.y*t.y)}scalarMultiply(t){return new It(this.x*t,this.y*t)}scalarMultiplyEquals(t){return this.x*=t,this.y*=t,this}divide(t){return new It(this.x/t.x,this.y/t.y)}scalarDivide(t){return new It(this.x/t,this.y/t)}scalarDivideEquals(t){return this.x/=t,this.y/=t,this}eq(t){return this.x===t.x&&this.y===t.y}lt(t){return this.x<t.x&&this.y<t.y}lte(t){return this.x<=t.x&&this.y<=t.y}gt(t){return this.x>t.x&&this.y>t.y}gte(t){return this.x>=t.x&&this.y>=t.y}lerp(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:.5;return e=Math.max(Math.min(1,e),0),new It(this.x+(t.x-this.x)*e,this.y+(t.y-this.y)*e)}distanceFrom(t){const e=this.x-t.x,n=this.y-t.y;return Math.sqrt(e*e+n*n)}midPointFrom(t){return this.lerp(t)}min(t){return new It(Math.min(this.x,t.x),Math.min(this.y,t.y))}max(t){return new It(Math.max(this.x,t.x),Math.max(this.y,t.y))}toString(){return"".concat(this.x,",").concat(this.y)}setXY(t,e){return this.x=t,this.y=e,this}setX(t){return this.x=t,this}setY(t){return this.y=t,this}setFromPoint(t){return this.x=t.x,this.y=t.y,this}swap(t){const e=this.x,n=this.y;this.x=t.x,this.y=t.y,t.x=e,t.y=n}clone(){return new It(this.x,this.y)}rotate(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Pt;const n=Dt(t),i=Ot(t),s=this.subtract(e);return new It(s.x*i-s.y*n,s.x*n+s.y*i).add(e)}transform(t){let e=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return new It(t[0]*this.x+t[2]*this.y+(e?0:t[4]),t[1]*this.x+t[3]*this.y+(e?0:t[5]))}}const Pt=new It(0,0),Mt=t=>!!t&&Array.isArray(t._objects);function Rt(t){class e extends t{constructor(){super(...arguments),E(this,"_objects",[])}_onObjectAdded(t){}_onObjectRemoved(t){}_onStackOrderChanged(t){}add(){for(var t=arguments.length,e=new Array(t),n=0;n<t;n++)e[n]=arguments[n];const i=this._objects.push(...e);return e.forEach((t=>this._onObjectAdded(t))),i}insertAt(t){for(var e=arguments.length,n=new Array(e>1?e-1:0),i=1;i<e;i++)n[i-1]=arguments[i];return this._objects.splice(t,0,...n),n.forEach((t=>this._onObjectAdded(t))),this._objects.length}remove(){const t=this._objects,e=[];for(var n=arguments.length,i=new Array(n),s=0;s<n;s++)i[s]=arguments[s];return i.forEach((n=>{const i=t.indexOf(n);-1!==i&&(t.splice(i,1),e.push(n),this._onObjectRemoved(n))})),e}forEachObject(t){this.getObjects().forEach(((e,n,i)=>t(e,n,i)))}getObjects(){for(var t=arguments.length,e=new Array(t),n=0;n<t;n++)e[n]=arguments[n];return 0===e.length?[...this._objects]:this._objects.filter((t=>t.isType(...e)))}item(t){return this._objects[t]}isEmpty(){return 0===this._objects.length}size(){return this._objects.length}contains(t,n){return!!this._objects.includes(t)||!!n&&this._objects.some((n=>n instanceof e&&n.contains(t,!0)))}complexity(){return this._objects.reduce(((t,e)=>t+(e.complexity?e.complexity():0)),0)}sendObjectToBack(t){return!(!t||t===this._objects[0])&&(At(this._objects,t),this._objects.unshift(t),this._onStackOrderChanged(t),!0)}bringObjectToFront(t){return!(!t||t===this._objects[this._objects.length-1])&&(At(this._objects,t),this._objects.push(t),this._onStackOrderChanged(t),!0)}sendObjectBackwards(t,e){if(!t)return!1;const n=this._objects.indexOf(t);if(0!==n){const i=this.findNewLowerIndex(t,n,e);return At(this._objects,t),this._objects.splice(i,0,t),this._onStackOrderChanged(t),!0}return!1}bringObjectForward(t,e){if(!t)return!1;const n=this._objects.indexOf(t);if(n!==this._objects.length-1){const i=this.findNewUpperIndex(t,n,e);return At(this._objects,t),this._objects.splice(i,0,t),this._onStackOrderChanged(t),!0}return!1}moveObjectTo(t,e){return t!==this._objects[e]&&(At(this._objects,t),this._objects.splice(e,0,t),this._onStackOrderChanged(t),!0)}findNewLowerIndex(t,e,n){let i;if(n){i=e;for(let n=e-1;n>=0;--n)if(t.isOverlapping(this._objects[n])){i=n;break}}else i=e-1;return i}findNewUpperIndex(t,e,n){let i;if(n){i=e;for(let n=e+1;n<this._objects.length;++n)if(t.isOverlapping(this._objects[n])){i=n;break}}else i=e+1;return i}collectObjects(t){let{left:e,top:n,width:i,height:s}=t,{includeIntersecting:r=!0}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const o=[],a=new It(e,n),h=a.add(new It(i,s));for(let c=this._objects.length-1;c>=0;c--){const t=this._objects[c];t.selectable&&t.visible&&(r&&t.intersectsWithRect(a,h)||t.isContainedWithinRect(a,h)||r&&t.containsPoint(a)||r&&t.containsPoint(h))&&o.push(t)}return o}}return e}class Ft extends kt{_setOptions(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};for(const e in t)this.set(e,t[e])}_setObject(t){for(const e in t)this._set(e,t[e])}set(t,e){return"object"==typeof t?this._setObject(t):this._set(t,e),this}_set(t,e){this[t]=e}toggle(t){const e=this.get(t);return"boolean"==typeof e&&this.set(t,!e),this}get(t){return this[t]}}function Lt(t){return U().requestAnimationFrame(t)}function jt(t){return U().cancelAnimationFrame(t)}let Nt=0;const Bt=()=>Nt++,Wt=()=>{const t=Y().createElement("canvas");if(!t||void 0===t.getContext)throw new R("Failed to create `canvas` element");return t},Yt=()=>Y().createElement("img"),Ut=t=>{const e=Wt();return e.width=t.width,e.height=t.height,e},Xt=(t,e,n)=>t.toDataURL("image/".concat(e),n),Gt=(t,e,n)=>new Promise(((i,s)=>{t.toBlob(i,"image/".concat(e),n)})),Vt=t=>t*K,Ht=t=>t/K,zt=t=>t.every(((t,e)=>t===Q[e])),qt=(t,e,n)=>new It(t).transform(e,n),Kt=t=>{const e=1/(t[0]*t[3]-t[1]*t[2]),n=[e*t[3],-e*t[1],-e*t[2],e*t[0],0,0],{x:i,y:s}=new It(t[4],t[5]).transform(n,!0);return n[4]=-i,n[5]=-s,n},Qt=(t,e,n)=>[t[0]*e[0]+t[2]*e[1],t[1]*e[0]+t[3]*e[1],t[0]*e[2]+t[2]*e[3],t[1]*e[2]+t[3]*e[3],n?0:t[0]*e[4]+t[2]*e[5]+t[4],n?0:t[1]*e[4]+t[3]*e[5]+t[5]],Jt=(t,e)=>t.reduceRight(((t,n)=>n&&t?Qt(n,t,e):n||t),void 0)||Q.concat(),Zt=t=>{let[e,n]=t;return Math.atan2(n,e)},$t=t=>{const e=Zt(t),n=Math.pow(t[0],2)+Math.pow(t[1],2),i=Math.sqrt(n),s=(t[0]*t[3]-t[2]*t[1])/i,r=Math.atan2(t[0]*t[2]+t[1]*t[3],n);return{angle:Ht(e),scaleX:i,scaleY:s,skewX:Ht(r),skewY:0,translateX:t[4]||0,translateY:t[5]||0}},te=function(t){return[1,0,0,1,t,arguments.length>1&&void 0!==arguments[1]?arguments[1]:0]};function ee(){let{angle:t=0}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},{x:e=0,y:n=0}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const i=Vt(t),s=Ot(i),r=Dt(i);return[s,r,-r,s,e?e-(s*e-r*n):0,n?n-(r*e+s*n):0]}const ne=function(t){return[t,0,0,arguments.length>1&&void 0!==arguments[1]?arguments[1]:t,0,0]},ie=t=>Math.tan(Vt(t)),se=t=>[1,0,ie(t),1,0,0],re=t=>[1,ie(t),0,1,0,0],oe=t=>{let{scaleX:e=1,scaleY:n=1,flipX:i=!1,flipY:s=!1,skewX:r=0,skewY:o=0}=t,a=ne(i?-e:e,s?-n:n);return r&&(a=Qt(a,se(r),!0)),o&&(a=Qt(a,re(o),!0)),a},ae=t=>{const{translateX:e=0,translateY:n=0,angle:i=0}=t;let s=te(e,n);i&&(s=Qt(s,ee({angle:i})));const r=oe(t);return zt(r)||(s=Qt(s,r)),s},he=function(t){let{signal:e,crossOrigin:n=null}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return new Promise((function(i,s){if(e&&e.aborted)return s(new F("loadImage"));const r=Yt();let o;e&&(o=function(t){r.src="",s(t)},e.addEventListener("abort",o,{once:!0}));const a=function(){r.onload=r.onerror=null,o&&(null==e||e.removeEventListener("abort",o)),i(r)};t?(r.onload=a,r.onerror=function(){o&&(null==e||e.removeEventListener("abort",o)),s(new R("Error loading ".concat(r.src)))},n&&(r.crossOrigin=n),r.src=t):a()}))},ce=function(t){let{signal:e,reviver:n=H}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return new Promise(((i,s)=>{const r=[];e&&e.addEventListener("abort",s,{once:!0}),Promise.all(t.map((t=>Tt.getClass(t.type).fromObject(t,{signal:e}).then((e=>(n(t,e),r.push(e),e)))))).then(i).catch((t=>{r.forEach((t=>{t.dispose&&t.dispose()})),s(t)})).finally((()=>{e&&e.removeEventListener("abort",s)}))}))},le=function(t){let{signal:e}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return new Promise(((n,i)=>{const s=[];e&&e.addEventListener("abort",i,{once:!0});const r=Object.values(t).map((t=>t&&t.type&&Tt.has(t.type)?ce([t],{signal:e}).then((t=>{let[e]=t;return s.push(e),e})):t)),o=Object.keys(t);Promise.all(r).then((t=>t.reduce(((t,e,n)=>(t[o[n]]=e,t)),{}))).then(n).catch((t=>{s.forEach((t=>{t.dispose&&t.dispose()})),i(t)})).finally((()=>{e&&e.removeEventListener("abort",i)}))}))},ue=function(t){return(arguments.length>1&&void 0!==arguments[1]?arguments[1]:[]).reduce(((e,n)=>(n in t&&(e[n]=t[n]),e)),{})},de=(t,e)=>Object.keys(t).reduce(((n,i)=>(e(t[i],i,t)&&(n[i]=t[i]),n)),{}),ge=(t,e)=>parseFloat(Number(t).toFixed(e)),pe=t=>"matrix("+t.map((t=>ge(t,P.NUM_FRACTION_DIGITS))).join(" ")+")",fe=t=>!!t&&void 0!==t.toLive,me=t=>!!t&&"function"==typeof t.toObject,_e=t=>!!t&&void 0!==t.offsetX&&"source"in t,ve=t=>!!t&&"multiSelectionStacking"in t;function ye(t){const e=t&&Ce(t);let n=0,i=0;if(!t||!e)return{left:n,top:i};let s=t;const r=e.documentElement,o=e.body||{scrollLeft:0,scrollTop:0};for(;s&&(s.parentNode||s.host)&&(s=s.parentNode||s.host,s===e?(n=o.scrollLeft||r.scrollLeft||0,i=o.scrollTop||r.scrollTop||0):(n+=s.scrollLeft||0,i+=s.scrollTop||0),1!==s.nodeType||"fixed"!==s.style.position););return{left:n,top:i}}const Ce=t=>t.ownerDocument||null,be=t=>{var e;return(null===(e=t.ownerDocument)||void 0===e?void 0:e.defaultView)||null},we=function(t,e,n){let{width:i,height:s}=n,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1;t.width=i,t.height=s,r>1&&(t.setAttribute("width",(i*r).toString()),t.setAttribute("height",(s*r).toString()),e.scale(r,r))},xe=(t,e)=>{let{width:n,height:i}=e;n&&(t.style.width="number"==typeof n?"".concat(n,"px"):n),i&&(t.style.height="number"==typeof i?"".concat(i,"px"):i)};function Se(t){return void 0!==t.onselectstart&&(t.onselectstart=()=>!1),t.style.userSelect=st,t}class Te{constructor(t){E(this,"_originalCanvasStyle",void 0),E(this,"lower",void 0);const e=this.createLowerCanvas(t);this.lower={el:e,ctx:e.getContext("2d")}}createLowerCanvas(t){const e=(n=t)&&void 0!==n.getContext?t:t&&Y().getElementById(t)||Wt();var n;if(e.hasAttribute("data-fabric"))throw new R("Trying to initialize a canvas that has already been initialized. Did you forget to dispose the canvas?");return this._originalCanvasStyle=e.style.cssText,e.setAttribute("data-fabric","main"),e.classList.add("lower-canvas"),e}cleanupDOM(t){let{width:e,height:n}=t;const{el:i}=this.lower;i.classList.remove("lower-canvas"),i.removeAttribute("data-fabric"),i.setAttribute("width","".concat(e)),i.setAttribute("height","".concat(n)),i.style.cssText=this._originalCanvasStyle||"",this._originalCanvasStyle=void 0}setDimensions(t,e){const{el:n,ctx:i}=this.lower;we(n,i,t,e)}setCSSDimensions(t){xe(this.lower.el,t)}calcOffset(){return function(t){var e;const n=t&&Ce(t),i={left:0,top:0};if(!n)return i;const s=(null===(e=be(t))||void 0===e?void 0:e.getComputedStyle(t,null))||{};i.left+=parseInt(s.borderLeftWidth,10)||0,i.top+=parseInt(s.borderTopWidth,10)||0,i.left+=parseInt(s.paddingLeft,10)||0,i.top+=parseInt(s.paddingTop,10)||0;let r={left:0,top:0};const o=n.documentElement;void 0!==t.getBoundingClientRect&&(r=t.getBoundingClientRect());const a=ye(t);return{left:r.left+a.left-(o.clientLeft||0)+i.left,top:r.top+a.top-(o.clientTop||0)+i.top}}(this.lower.el)}dispose(){W().dispose(this.lower.el),delete this.lower}}const Ee={backgroundVpt:!0,backgroundColor:"",overlayVpt:!0,overlayColor:"",includeDefaultValues:!0,svgViewportTransformation:!0,renderOnAddRemove:!0,skipOffscreen:!0,enableRetinaScaling:!0,imageSmoothingEnabled:!0,controlsAboveOverlay:!1,allowTouchScrolling:!1,viewportTransform:[...Q]};class ke extends(Rt(Ft)){get lowerCanvasEl(){var t;return null===(t=this.elements.lower)||void 0===t?void 0:t.el}get contextContainer(){var t;return null===(t=this.elements.lower)||void 0===t?void 0:t.ctx}static getDefaults(){return ke.ownDefaults}constructor(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};super(),Object.assign(this,this.constructor.getDefaults()),this.set(e),this.initElements(t),this._setDimensionsImpl({width:this.width||this.elements.lower.el.width||0,height:this.height||this.elements.lower.el.height||0}),this.skipControlsDrawing=!1,this.viewportTransform=[...this.viewportTransform],this.calcViewportBoundaries()}initElements(t){this.elements=new Te(t)}add(){const t=super.add(...arguments);return arguments.length>0&&this.renderOnAddRemove&&this.requestRenderAll(),t}insertAt(t){for(var e=arguments.length,n=new Array(e>1?e-1:0),i=1;i<e;i++)n[i-1]=arguments[i];const s=super.insertAt(t,...n);return n.length>0&&this.renderOnAddRemove&&this.requestRenderAll(),s}remove(){const t=super.remove(...arguments);return t.length>0&&this.renderOnAddRemove&&this.requestRenderAll(),t}_onObjectAdded(t){t.canvas&&t.canvas!==this&&(M("warn","Canvas is trying to add an object that belongs to a different canvas.\nResulting to default behavior: removing object from previous canvas and adding to new canvas"),t.canvas.remove(t)),t._set("canvas",this),t.setCoords(),this.fire("object:added",{target:t}),t.fire("added",{target:this})}_onObjectRemoved(t){t._set("canvas",void 0),this.fire("object:removed",{target:t}),t.fire("removed",{target:this})}_onStackOrderChanged(){this.renderOnAddRemove&&this.requestRenderAll()}getRetinaScaling(){return this.enableRetinaScaling?X():1}calcOffset(){return this._offset=this.elements.calcOffset()}getWidth(){return this.width}getHeight(){return this.height}setWidth(t,e){return this.setDimensions({width:t},e)}setHeight(t,e){return this.setDimensions({height:t},e)}_setDimensionsImpl(t){let{cssOnly:e=!1,backstoreOnly:n=!1}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(!e){const e=A({width:this.width,height:this.height},t);this.elements.setDimensions(e,this.getRetinaScaling()),this.hasLostContext=!0,this.width=e.width,this.height=e.height}n||this.elements.setCSSDimensions(t),this.calcOffset()}setDimensions(t,e){this._setDimensionsImpl(t,e),e&&e.cssOnly||this.requestRenderAll()}getZoom(){return this.viewportTransform[0]}setViewportTransform(t){this.viewportTransform=t,this.calcViewportBoundaries(),this.renderOnAddRemove&&this.requestRenderAll()}zoomToPoint(t,e){const n=t,i=[...this.viewportTransform],s=qt(t,Kt(i));i[0]=e,i[3]=e;const r=qt(s,i);i[4]+=n.x-r.x,i[5]+=n.y-r.y,this.setViewportTransform(i)}setZoom(t){this.zoomToPoint(new It(0,0),t)}absolutePan(t){const e=[...this.viewportTransform];return e[4]=-t.x,e[5]=-t.y,this.setViewportTransform(e)}relativePan(t){return this.absolutePan(new It(-t.x-this.viewportTransform[4],-t.y-this.viewportTransform[5]))}getElement(){return this.elements.lower.el}clearContext(t){t.clearRect(0,0,this.width,this.height)}getContext(){return this.elements.lower.ctx}clear(){this.remove(...this.getObjects()),this.backgroundImage=void 0,this.overlayImage=void 0,this.backgroundColor="",this.overlayColor="",this.clearContext(this.getContext()),this.fire("canvas:cleared"),this.renderOnAddRemove&&this.requestRenderAll()}renderAll(){this.cancelRequestedRender(),this.destroyed||this.renderCanvas(this.getContext(),this._objects)}renderAndReset(){this.nextRenderHandle=0,this.renderAll()}requestRenderAll(){this.nextRenderHandle||this.disposed||this.destroyed||(this.nextRenderHandle=Lt((()=>this.renderAndReset())))}calcViewportBoundaries(){const t=this.width,e=this.height,n=Kt(this.viewportTransform),i=qt({x:0,y:0},n),s=qt({x:t,y:e},n),r=i.min(s),o=i.max(s);return this.vptCoords={tl:r,tr:new It(o.x,r.y),bl:new It(r.x,o.y),br:o}}cancelRequestedRender(){this.nextRenderHandle&&(jt(this.nextRenderHandle),this.nextRenderHandle=0)}drawControls(t){}renderCanvas(t,e){if(this.destroyed)return;const n=this.viewportTransform,i=this.clipPath;this.calcViewportBoundaries(),this.clearContext(t),t.imageSmoothingEnabled=this.imageSmoothingEnabled,t.patternQuality="best",this.fire("before:render",{ctx:t}),this._renderBackground(t),t.save(),t.transform(n[0],n[1],n[2],n[3],n[4],n[5]),this._renderObjects(t,e),t.restore(),this.controlsAboveOverlay||this.skipControlsDrawing||this.drawControls(t),i&&(i._set("canvas",this),i.shouldCache(),i._transformDone=!0,i.renderCache({forClipping:!0}),this.drawClipPathOnCanvas(t,i)),this._renderOverlay(t),this.controlsAboveOverlay&&!this.skipControlsDrawing&&this.drawControls(t),this.fire("after:render",{ctx:t}),this.__cleanupTask&&(this.__cleanupTask(),this.__cleanupTask=void 0)}drawClipPathOnCanvas(t,e){const n=this.viewportTransform;t.save(),t.transform(...n),t.globalCompositeOperation="destination-in",e.transform(t),t.scale(1/e.zoomX,1/e.zoomY),t.drawImage(e._cacheCanvas,-e.cacheTranslationX,-e.cacheTranslationY),t.restore()}_renderObjects(t,e){for(let n=0,i=e.length;n<i;++n)e[n]&&e[n].render(t)}_renderBackgroundOrOverlay(t,e){const n=this["".concat(e,"Color")],i=this["".concat(e,"Image")],s=this.viewportTransform,r=this["".concat(e,"Vpt")];if(!n&&!i)return;const o=fe(n);if(n){if(t.save(),t.beginPath(),t.moveTo(0,0),t.lineTo(this.width,0),t.lineTo(this.width,this.height),t.lineTo(0,this.height),t.closePath(),t.fillStyle=o?n.toLive(t):n,r&&t.transform(...s),o){t.transform(1,0,0,1,n.offsetX||0,n.offsetY||0);const e=n.gradientTransform||n.patternTransform;e&&t.transform(...e)}t.fill(),t.restore()}if(i){t.save();const{skipOffscreen:e}=this;this.skipOffscreen=r,r&&t.transform(...s),i.render(t),this.skipOffscreen=e,t.restore()}}_renderBackground(t){this._renderBackgroundOrOverlay(t,"background")}_renderOverlay(t){this._renderBackgroundOrOverlay(t,"overlay")}getCenter(){return{top:this.height/2,left:this.width/2}}getCenterPoint(){return new It(this.width/2,this.height/2)}centerObjectH(t){return this._centerObject(t,new It(this.getCenterPoint().x,t.getCenterPoint().y))}centerObjectV(t){return this._centerObject(t,new It(t.getCenterPoint().x,this.getCenterPoint().y))}centerObject(t){return this._centerObject(t,this.getCenterPoint())}viewportCenterObject(t){return this._centerObject(t,this.getVpCenter())}viewportCenterObjectH(t){return this._centerObject(t,new It(this.getVpCenter().x,t.getCenterPoint().y))}viewportCenterObjectV(t){return this._centerObject(t,new It(t.getCenterPoint().x,this.getVpCenter().y))}getVpCenter(){return qt(this.getCenterPoint(),Kt(this.viewportTransform))}_centerObject(t,e){t.setXY(e,$,$),t.setCoords(),this.renderOnAddRemove&&this.requestRenderAll()}toDatalessJSON(t){return this.toDatalessObject(t)}toObject(t){return this._toObjectMethod("toObject",t)}toJSON(){return this.toObject()}toDatalessObject(t){return this._toObjectMethod("toDatalessObject",t)}_toObjectMethod(t,e){const n=this.clipPath,i=n&&!n.excludeFromExport?this._toObject(n,t,e):null;return A(A(A({version:V},ue(this,e)),{},{objects:this._objects.filter((t=>!t.excludeFromExport)).map((n=>this._toObject(n,t,e)))},this.__serializeBgOverlay(t,e)),i?{clipPath:i}:null)}_toObject(t,e,n){let i;this.includeDefaultValues||(i=t.includeDefaultValues,t.includeDefaultValues=!1);const s=t[e](n);return this.includeDefaultValues||(t.includeDefaultValues=!!i),s}__serializeBgOverlay(t,e){const n={},i=this.backgroundImage,s=this.overlayImage,r=this.backgroundColor,o=this.overlayColor;return fe(r)?r.excludeFromExport||(n.background=r.toObject(e)):r&&(n.background=r),fe(o)?o.excludeFromExport||(n.overlay=o.toObject(e)):o&&(n.overlay=o),i&&!i.excludeFromExport&&(n.backgroundImage=this._toObject(i,t,e)),s&&!s.excludeFromExport&&(n.overlayImage=this._toObject(s,t,e)),n}toSVG(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},e=arguments.length>1?arguments[1]:void 0;t.reviver=e;const n=[];return this._setSVGPreamble(n,t),this._setSVGHeader(n,t),this.clipPath&&n.push('<g clip-path="url(#'.concat(this.clipPath.clipPathId,')" >\n')),this._setSVGBgOverlayColor(n,"background"),this._setSVGBgOverlayImage(n,"backgroundImage",e),this._setSVGObjects(n,e),this.clipPath&&n.push("</g>\n"),this._setSVGBgOverlayColor(n,"overlay"),this._setSVGBgOverlayImage(n,"overlayImage",e),n.push("</svg>"),n.join("")}_setSVGPreamble(t,e){e.suppressPreamble||t.push('<?xml version="1.0" encoding="',e.encoding||"UTF-8",'" standalone="no" ?>\n','<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN" ','"http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">\n')}_setSVGHeader(t,e){const n=e.width||"".concat(this.width),i=e.height||"".concat(this.height),s=P.NUM_FRACTION_DIGITS,r=e.viewBox;let o;if(r)o='viewBox="'.concat(r.x," ").concat(r.y," ").concat(r.width," ").concat(r.height,'" ');else if(this.svgViewportTransformation){const t=this.viewportTransform;o='viewBox="'.concat(ge(-t[4]/t[0],s)," ").concat(ge(-t[5]/t[3],s)," ").concat(ge(this.width/t[0],s)," ").concat(ge(this.height/t[3],s),'" ')}else o='viewBox="0 0 '.concat(this.width," ").concat(this.height,'" ');t.push("<svg ",'xmlns="http://www.w3.org/2000/svg" ','xmlns:xlink="http://www.w3.org/1999/xlink" ','version="1.1" ','width="',n,'" ','height="',i,'" ',o,'xml:space="preserve">\n',"<desc>Created with Fabric.js ",V,"</desc>\n","<defs>\n",this.createSVGFontFacesMarkup(),this.createSVGRefElementsMarkup(),this.createSVGClipPathMarkup(e),"</defs>\n")}createSVGClipPathMarkup(t){const e=this.clipPath;return e?(e.clipPathId="CLIPPATH_".concat(Bt()),'<clipPath id="'.concat(e.clipPathId,'" >\n').concat(e.toClipPathSVG(t.reviver),"</clipPath>\n")):""}createSVGRefElementsMarkup(){return["background","overlay"].map((t=>{const e=this["".concat(t,"Color")];if(fe(e)){const n=this["".concat(t,"Vpt")],i=this.viewportTransform,s={isType:()=>!1,width:this.width/(n?i[0]:1),height:this.height/(n?i[3]:1)};return e.toSVG(s,{additionalTransform:n?pe(i):""})}})).join("")}createSVGFontFacesMarkup(){const t=[],e={},n=P.fontPaths;this._objects.forEach((function e(n){t.push(n),Mt(n)&&n._objects.forEach(e)})),t.forEach((t=>{if(!(i=t)||"function"!=typeof i._renderText)return;var i;const{styles:s,fontFamily:r}=t;!e[r]&&n[r]&&(e[r]=!0,s&&Object.values(s).forEach((t=>{Object.values(t).forEach((t=>{let{fontFamily:i=""}=t;!e[i]&&n[i]&&(e[i]=!0)}))})))}));const i=Object.keys(e).map((t=>"\t\t@font-face {\n\t\t\tfont-family: '".concat(t,"';\n\t\t\tsrc: url('").concat(n[t],"');\n\t\t}\n"))).join("");return i?'\t<style type="text/css"><![CDATA[\n'.concat(i,"]]></style>\n"):""}_setSVGObjects(t,e){this.forEachObject((n=>{n.excludeFromExport||this._setSVGObject(t,n,e)}))}_setSVGObject(t,e,n){t.push(e.toSVG(n))}_setSVGBgOverlayImage(t,e,n){const i=this[e];i&&!i.excludeFromExport&&i.toSVG&&t.push(i.toSVG(n))}_setSVGBgOverlayColor(t,e){const n=this["".concat(e,"Color")];if(n)if(fe(n)){const i=n.repeat||"",s=this.width,r=this.height,o=this["".concat(e,"Vpt")]?pe(Kt(this.viewportTransform)):"";t.push('<rect transform="'.concat(o," translate(").concat(s/2,",").concat(r/2,')" x="').concat(n.offsetX-s/2,'" y="').concat(n.offsetY-r/2,'" width="').concat("repeat-y"!==i&&"no-repeat"!==i||!_e(n)?s:n.source.width,'" height="').concat("repeat-x"!==i&&"no-repeat"!==i||!_e(n)?r:n.source.height,'" fill="url(#SVGID_').concat(n.id,')"></rect>\n'))}else t.push('<rect x="0" y="0" width="100%" height="100%" ','fill="',n,'"',"></rect>\n")}loadFromJSON(t,e){let{signal:n}=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};if(!t)return Promise.reject(new R("`json` is undefined"));const i="string"==typeof t?JSON.parse(t):t,{objects:s=[],backgroundImage:r,background:o,overlayImage:a,overlay:h,clipPath:c}=i,l=this.renderOnAddRemove;return this.renderOnAddRemove=!1,Promise.all([ce(s,{reviver:e,signal:n}),le({backgroundImage:r,backgroundColor:o,overlayImage:a,overlayColor:h,clipPath:c},{signal:n})]).then((t=>{let[e,n]=t;return this.clear(),this.add(...e),this.set(i),this.set(n),this.renderOnAddRemove=l,this}))}clone(t){const e=this.toObject(t);return this.cloneWithoutData().loadFromJSON(e)}cloneWithoutData(){const t=Ut(this);return new this.constructor(t)}toDataURL(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};const{format:e="png",quality:n=1,multiplier:i=1,enableRetinaScaling:s=!1}=t,r=i*(s?this.getRetinaScaling():1);return Xt(this.toCanvasElement(r,t),e,n)}toBlob(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};const{format:e="png",quality:n=1,multiplier:i=1,enableRetinaScaling:s=!1}=t,r=i*(s?this.getRetinaScaling():1);return Gt(this.toCanvasElement(r,t),e,n)}toCanvasElement(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,{width:e,height:n,left:i,top:s,filter:r}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const o=(e||this.width)*t,a=(n||this.height)*t,h=this.getZoom(),c=this.width,l=this.height,u=this.skipControlsDrawing,d=h*t,g=this.viewportTransform,p=[d,0,0,d,(g[4]-(i||0))*t,(g[5]-(s||0))*t],f=this.enableRetinaScaling,m=Ut({width:o,height:a}),_=r?this._objects.filter((t=>r(t))):this._objects;return this.enableRetinaScaling=!1,this.viewportTransform=p,this.width=o,this.height=a,this.skipControlsDrawing=!0,this.calcViewportBoundaries(),this.renderCanvas(m.getContext("2d"),_),this.viewportTransform=g,this.width=c,this.height=l,this.calcViewportBoundaries(),this.enableRetinaScaling=f,this.skipControlsDrawing=u,m}dispose(){return!this.disposed&&this.elements.cleanupDOM({width:this.width,height:this.height}),Et.cancelByCanvas(this),this.disposed=!0,new Promise(((t,e)=>{const n=()=>{this.destroy(),t(!0)};n.kill=e,this.__cleanupTask&&this.__cleanupTask.kill("aborted"),this.destroyed?t(!1):this.nextRenderHandle?this.__cleanupTask=n:n()}))}destroy(){this.destroyed=!0,this.cancelRequestedRender(),this.forEachObject((t=>t.dispose())),this._objects=[],this.backgroundImage&&this.backgroundImage.dispose(),this.backgroundImage=void 0,this.overlayImage&&this.overlayImage.dispose(),this.overlayImage=void 0,this.elements.dispose()}toString(){return"#<Canvas (".concat(this.complexity(),"): { objects: ").concat(this._objects.length," }>")}}E(ke,"ownDefaults",Ee);const Ae=["touchstart","touchmove","touchend"],Oe=t=>{const e=ye(t.target),n=function(t){const e=t.changedTouches;return e&&e[0]?e[0]:t}(t);return new It(n.clientX+e.left,n.clientY+e.top)},De=t=>Ae.includes(t.type)||"touch"===t.pointerType,Ie=t=>{t.preventDefault(),t.stopPropagation()},Pe=t=>{let e=0,n=0,i=0,s=0;for(let r=0,o=t.length;r<o;r++){const{x:o,y:a}=t[r];(o>i||!r)&&(i=o),(o<e||!r)&&(e=o),(a>s||!r)&&(s=a),(a<n||!r)&&(n=a)}return{left:e,top:n,width:i-e,height:s-n}},Me=["translateX","translateY","scaleX","scaleY"],Re=(t,e)=>Fe(t,Qt(e,t.calcOwnMatrix())),Fe=(t,e)=>{const n=$t(e),{translateX:i,translateY:s,scaleX:r,scaleY:o}=n,a=O(n,Me),h=new It(i,s);t.flipX=!1,t.flipY=!1,Object.assign(t,a),t.set({scaleX:r,scaleY:o}),t.setPositionByOrigin(h,$,$)},Le=t=>{t.scaleX=1,t.scaleY=1,t.skewX=0,t.skewY=0,t.flipX=!1,t.flipY=!1,t.rotate(0)},je=t=>({scaleX:t.scaleX,scaleY:t.scaleY,skewX:t.skewX,skewY:t.skewY,angle:t.angle,left:t.left,flipX:t.flipX,flipY:t.flipY,top:t.top}),Ne=(t,e,n)=>{const i=t/2,s=e/2,r=[new It(-i,-s),new It(i,-s),new It(-i,s),new It(i,s)].map((t=>t.transform(n))),o=Pe(r);return new It(o.width,o.height)},Be=function(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Q;return Qt(Kt(arguments.length>1&&void 0!==arguments[1]?arguments[1]:Q),t)},We=function(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Q,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:Q;return t.transform(Be(e,n))},Ye=function(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Q,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:Q;return t.transform(Be(e,n),!0)},Ue=(t,e,n)=>{const i=Be(e,n);return Fe(t,Qt(i,t.calcOwnMatrix())),i},Xe=(t,e)=>{var n;const{transform:{target:i}}=e;null===(n=i.canvas)||void 0===n||n.fire("object:".concat(t),A(A({},e),{},{target:i})),i.fire(t,e)},Ge={left:-.5,top:-.5,center:0,bottom:.5,right:.5},Ve=t=>"string"==typeof t?Ge[t]:t-.5,He="not-allowed";function ze(t){return Ve(t.originX)===Ve($)&&Ve(t.originY)===Ve($)}function qe(t){return.5-Ve(t)}const Ke=(t,e)=>t[e],Qe=(t,e,n,i)=>({e:t,transform:e,pointer:new It(n,i)});function Je(t,e){const n=t.getTotalAngle()+Ht(Math.atan2(e.y,e.x))+360;return Math.round(n%360/45)}function Ze(t,e,n,i,s){var r;let{target:o,corner:a}=t;const h=o.controls[a],c=(null===(r=o.canvas)||void 0===r?void 0:r.getZoom())||1,l=o.padding/c,u=function(t,e,n,i){const s=t.getRelativeCenterPoint(),r=void 0!==n&&void 0!==i?t.translateToGivenOrigin(s,$,$,n,i):new It(t.left,t.top);return(t.angle?e.rotate(-Vt(t.angle),s):e).subtract(r)}(o,new It(i,s),e,n);return u.x>=l&&(u.x-=l),u.x<=-l&&(u.x+=l),u.y>=l&&(u.y-=l),u.y<=l&&(u.y+=l),u.x-=h.offsetX,u.y-=h.offsetY,u}const $e=(t,e,n,i)=>{const{target:s,offsetX:r,offsetY:o}=e,a=n-r,h=i-o,c=!Ke(s,"lockMovementX")&&s.left!==a,l=!Ke(s,"lockMovementY")&&s.top!==h;return c&&s.set(tt,a),l&&s.set(et,h),(c||l)&&Xe(ot,Qe(t,e,n,i)),c||l},tn={aliceblue:"#F0F8FF",antiquewhite:"#FAEBD7",aqua:"#0FF",aquamarine:"#7FFFD4",azure:"#F0FFFF",beige:"#F5F5DC",bisque:"#FFE4C4",black:"#000",blanchedalmond:"#FFEBCD",blue:"#00F",blueviolet:"#8A2BE2",brown:"#A52A2A",burlywood:"#DEB887",cadetblue:"#5F9EA0",chartreuse:"#7FFF00",chocolate:"#D2691E",coral:"#FF7F50",cornflowerblue:"#6495ED",cornsilk:"#FFF8DC",crimson:"#DC143C",cyan:"#0FF",darkblue:"#00008B",darkcyan:"#008B8B",darkgoldenrod:"#B8860B",darkgray:"#A9A9A9",darkgrey:"#A9A9A9",darkgreen:"#006400",darkkhaki:"#BDB76B",darkmagenta:"#8B008B",darkolivegreen:"#556B2F",darkorange:"#FF8C00",darkorchid:"#9932CC",darkred:"#8B0000",darksalmon:"#E9967A",darkseagreen:"#8FBC8F",darkslateblue:"#483D8B",darkslategray:"#2F4F4F",darkslategrey:"#2F4F4F",darkturquoise:"#00CED1",darkviolet:"#9400D3",deeppink:"#FF1493",deepskyblue:"#00BFFF",dimgray:"#696969",dimgrey:"#696969",dodgerblue:"#1E90FF",firebrick:"#B22222",floralwhite:"#FFFAF0",forestgreen:"#228B22",fuchsia:"#F0F",gainsboro:"#DCDCDC",ghostwhite:"#F8F8FF",gold:"#FFD700",goldenrod:"#DAA520",gray:"#808080",grey:"#808080",green:"#008000",greenyellow:"#ADFF2F",honeydew:"#F0FFF0",hotpink:"#FF69B4",indianred:"#CD5C5C",indigo:"#4B0082",ivory:"#FFFFF0",khaki:"#F0E68C",lavender:"#E6E6FA",lavenderblush:"#FFF0F5",lawngreen:"#7CFC00",lemonchiffon:"#FFFACD",lightblue:"#ADD8E6",lightcoral:"#F08080",lightcyan:"#E0FFFF",lightgoldenrodyellow:"#FAFAD2",lightgray:"#D3D3D3",lightgrey:"#D3D3D3",lightgreen:"#90EE90",lightpink:"#FFB6C1",lightsalmon:"#FFA07A",lightseagreen:"#20B2AA",lightskyblue:"#87CEFA",lightslategray:"#789",lightslategrey:"#789",lightsteelblue:"#B0C4DE",lightyellow:"#FFFFE0",lime:"#0F0",limegreen:"#32CD32",linen:"#FAF0E6",magenta:"#F0F",maroon:"#800000",mediumaquamarine:"#66CDAA",mediumblue:"#0000CD",mediumorchid:"#BA55D3",mediumpurple:"#9370DB",mediumseagreen:"#3CB371",mediumslateblue:"#7B68EE",mediumspringgreen:"#00FA9A",mediumturquoise:"#48D1CC",mediumvioletred:"#C71585",midnightblue:"#191970",mintcream:"#F5FFFA",mistyrose:"#FFE4E1",moccasin:"#FFE4B5",navajowhite:"#FFDEAD",navy:"#000080",oldlace:"#FDF5E6",olive:"#808000",olivedrab:"#6B8E23",orange:"#FFA500",orangered:"#FF4500",orchid:"#DA70D6",palegoldenrod:"#EEE8AA",palegreen:"#98FB98",paleturquoise:"#AFEEEE",palevioletred:"#DB7093",papayawhip:"#FFEFD5",peachpuff:"#FFDAB9",peru:"#CD853F",pink:"#FFC0CB",plum:"#DDA0DD",powderblue:"#B0E0E6",purple:"#800080",rebeccapurple:"#639",red:"#F00",rosybrown:"#BC8F8F",royalblue:"#4169E1",saddlebrown:"#8B4513",salmon:"#FA8072",sandybrown:"#F4A460",seagreen:"#2E8B57",seashell:"#FFF5EE",sienna:"#A0522D",silver:"#C0C0C0",skyblue:"#87CEEB",slateblue:"#6A5ACD",slategray:"#708090",slategrey:"#708090",snow:"#FFFAFA",springgreen:"#00FF7F",steelblue:"#4682B4",tan:"#D2B48C",teal:"#008080",thistle:"#D8BFD8",tomato:"#FF6347",turquoise:"#40E0D0",violet:"#EE82EE",wheat:"#F5DEB3",white:"#FFF",whitesmoke:"#F5F5F5",yellow:"#FF0",yellowgreen:"#9ACD32"},en=(t,e,n)=>(n<0&&(n+=1),n>1&&(n-=1),n<1/6?t+6*(e-t)*n:n<.5?e:n<2/3?t+(e-t)*(2/3-n)*6:t),nn=(t,e,n,i)=>{t/=255,e/=255,n/=255;const s=Math.max(t,e,n),r=Math.min(t,e,n);let o,a;const h=(s+r)/2;if(s===r)o=a=0;else{const i=s-r;switch(a=h>.5?i/(2-s-r):i/(s+r),s){case t:o=(e-n)/i+(e<n?6:0);break;case e:o=(n-t)/i+2;break;case n:o=(t-e)/i+4}o/=6}return[Math.round(360*o),Math.round(100*a),Math.round(100*h),i]},sn=function(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"1";return parseFloat(t)/(t.endsWith("%")?100:1)},rn=t=>Math.min(Math.round(t),255).toString(16).toUpperCase().padStart(2,"0"),on=t=>{let[e,n,i,s=1]=t;const r=Math.round(.3*e+.59*n+.11*i);return[r,r,r,s]};class an{constructor(t){if(E(this,"isUnrecognised",!1),t)if(t instanceof an)this.setSource([...t._source]);else if(Array.isArray(t)){const[e,n,i,s=1]=t;this.setSource([e,n,i,s])}else this.setSource(this._tryParsingColor(t));else this.setSource([0,0,0,1])}_tryParsingColor(t){return(t=t.toLowerCase())in tn&&(t=tn[t]),"transparent"===t?[255,255,255,0]:an.sourceFromHex(t)||an.sourceFromRgb(t)||an.sourceFromHsl(t)||(this.isUnrecognised=!0)&&[0,0,0,1]}getSource(){return this._source}setSource(t){this._source=t}toRgb(){const[t,e,n]=this.getSource();return"rgb(".concat(t,",").concat(e,",").concat(n,")")}toRgba(){return"rgba(".concat(this.getSource().join(","),")")}toHsl(){const[t,e,n]=nn(...this.getSource());return"hsl(".concat(t,",").concat(e,"%,").concat(n,"%)")}toHsla(){const[t,e,n,i]=nn(...this.getSource());return"hsla(".concat(t,",").concat(e,"%,").concat(n,"%,").concat(i,")")}toHex(){return this.toHexa().slice(0,6)}toHexa(){const[t,e,n,i]=this.getSource();return"".concat(rn(t)).concat(rn(e)).concat(rn(n)).concat(rn(Math.round(255*i)))}getAlpha(){return this.getSource()[3]}setAlpha(t){return this._source[3]=t,this}toGrayscale(){return this.setSource(on(this.getSource())),this}toBlackWhite(t){const[e,,,n]=on(this.getSource()),i=e<(t||127)?0:255;return this.setSource([i,i,i,n]),this}overlayWith(t){t instanceof an||(t=new an(t));const e=this.getSource(),n=t.getSource(),[i,s,r]=e.map(((t,e)=>Math.round(.5*t+.5*n[e])));return this.setSource([i,s,r,e[3]]),this}static fromRgb(t){return an.fromRgba(t)}static fromRgba(t){return new an(an.sourceFromRgb(t))}static sourceFromRgb(t){const e=t.match(/^rgba?\(\s*(\d{0,3}(?:\.\d+)?%?)\s*[\s|,]\s*(\d{0,3}(?:\.\d+)?%?)\s*[\s|,]\s*(\d{0,3}(?:\.\d+)?%?)\s*(?:\s*[,/]\s*(\d{0,3}(?:\.\d+)?%?)\s*)?\)$/i);if(e){const[t,n,i]=e.slice(1,4).map((t=>{const e=parseFloat(t);return t.endsWith("%")?Math.round(2.55*e):e}));return[t,n,i,sn(e[4])]}}static fromHsl(t){return an.fromHsla(t)}static fromHsla(t){return new an(an.sourceFromHsl(t))}static sourceFromHsl(t){const e=t.match(/^hsla?\(\s*([+-]?\d{0,3}(?:\.\d+)?(?:deg|turn|rad)?)\s*[\s|,]\s*(\d{0,3}(?:\.\d+)?%?)\s*[\s|,]\s*(\d{0,3}(?:\.\d+)?%?)\s*(?:\s*[,/]\s*(\d*(?:\.\d+)?%?)\s*)?\)$/i);if(!e)return;const n=(an.parseAngletoDegrees(e[1])%360+360)%360/360,i=parseFloat(e[2])/100,s=parseFloat(e[3])/100;let r,o,a;if(0===i)r=o=a=s;else{const t=s<=.5?s*(i+1):s+i-s*i,e=2*s-t;r=en(e,t,n+1/3),o=en(e,t,n),a=en(e,t,n-1/3)}return[Math.round(255*r),Math.round(255*o),Math.round(255*a),sn(e[4])]}static fromHex(t){return new an(an.sourceFromHex(t))}static sourceFromHex(t){if(t.match(/^#?(([0-9a-f]){3,4}|([0-9a-f]{2}){3,4})$/i)){const e=t.slice(t.indexOf("#")+1);let n;n=e.length<=4?e.split("").map((t=>t+t)):e.match(/.{2}/g);const[i,s,r,o=255]=n.map((t=>parseInt(t,16)));return[i,s,r,o/255]}}static parseAngletoDegrees(t){const e=t.toLowerCase(),n=parseFloat(e);return e.includes("rad")?Ht(n):e.includes("turn")?360*n:n}}const hn=function(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:J;const n=/\D{0,2}$/.exec(t),i=parseFloat(t),s=P.DPI;switch(null==n?void 0:n[0]){case"mm":return i*s/25.4;case"cm":return i*s/2.54;case"in":return i*s;case"pt":return i*s/72;case"pc":return i*s/72*12;case"em":return i*e;default:return i}},cn=t=>{const[e,n]=t.trim().split(" "),[i,s]=(r=e)&&r!==st?[r.slice(1,4),r.slice(5,8)]:r===st?[r,r]:["Mid","Mid"];var r;return{meetOrSlice:n||"meet",alignX:i,alignY:s}},ln=function(t,e){let n,i,s=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];if(e)if(e.toLive)n="url(#SVGID_".concat(e.id,")");else{const t=new an(e),s=t.getAlpha();n=t.toRgb(),1!==s&&(i=s.toString())}else n="none";return s?"".concat(t,": ").concat(n,"; ").concat(i?"".concat(t,"-opacity: ").concat(i,"; "):""):"".concat(t,'="').concat(n,'" ').concat(i?"".concat(t,'-opacity="').concat(i,'" '):"")};class un{getSvgStyles(t){const e=this.fillRule?this.fillRule:"nonzero",n=this.strokeWidth?this.strokeWidth:"0",i=this.strokeDashArray?this.strokeDashArray.join(" "):st,s=this.strokeDashOffset?this.strokeDashOffset:"0",r=this.strokeLineCap?this.strokeLineCap:"butt",o=this.strokeLineJoin?this.strokeLineJoin:"miter",a=this.strokeMiterLimit?this.strokeMiterLimit:"4",h=void 0!==this.opacity?this.opacity:"1",c=this.visible?"":" visibility: hidden;",l=t?"":this.getSvgFilter(),u=ln(Ct,this.fill);return[ln(bt,this.stroke),"stroke-width: ",n,"; ","stroke-dasharray: ",i,"; ","stroke-linecap: ",r,"; ","stroke-dashoffset: ",s,"; ","stroke-linejoin: ",o,"; ","stroke-miterlimit: ",a,"; ",u,"fill-rule: ",e,"; ","opacity: ",h,";",l,c].join("")}getSvgFilter(){return this.shadow?"filter: url(#SVGID_".concat(this.shadow.id,");"):""}getSvgCommons(){return[this.id?'id="'.concat(this.id,'" '):"",this.clipPath?'clip-path="url(#'.concat(this.clipPath.clipPathId,')" '):""].join("")}getSvgTransform(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";const n=t?this.calcTransformMatrix():this.calcOwnMatrix(),i='transform="'.concat(pe(n));return"".concat(i).concat(e,'" ')}_toSVG(t){return[""]}toSVG(t){return this._createBaseSVGMarkup(this._toSVG(t),{reviver:t})}toClipPathSVG(t){return"\t"+this._createBaseClipPathSVGMarkup(this._toSVG(t),{reviver:t})}_createBaseClipPathSVGMarkup(t){let{reviver:e,additionalTransform:n=""}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const i=[this.getSvgTransform(!0,n),this.getSvgCommons()].join(""),s=t.indexOf("COMMON_PARTS");return t[s]=i,e?e(t.join("")):t.join("")}_createBaseSVGMarkup(t){let{noStyle:e,reviver:n,withShadow:i,additionalTransform:s}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const r=e?"":'style="'.concat(this.getSvgStyles(),'" '),o=i?'style="'.concat(this.getSvgFilter(),'" '):"",a=this.clipPath,h=this.strokeUniform?'vector-effect="non-scaling-stroke" ':"",c=a&&a.absolutePositioned,l=this.stroke,u=this.fill,d=this.shadow,g=[],p=t.indexOf("COMMON_PARTS");let f;a&&(a.clipPathId="CLIPPATH_".concat(Bt()),f='<clipPath id="'.concat(a.clipPathId,'" >\n').concat(a.toClipPathSVG(n),"</clipPath>\n")),c&&g.push("<g ",o,this.getSvgCommons()," >\n"),g.push("<g ",this.getSvgTransform(!1),c?"":o+this.getSvgCommons()," >\n");const m=[r,h,e?"":this.addPaintOrder()," ",s?'transform="'.concat(s,'" '):""].join("");return t[p]=m,fe(u)&&g.push(u.toSVG(this)),fe(l)&&g.push(l.toSVG(this)),d&&g.push(d.toSVG(this)),a&&g.push(f),g.push(t.join("")),g.push("</g>\n"),c&&g.push("</g>\n"),n?n(g.join("")):g.join("")}addPaintOrder(){return this.paintFirst!==Ct?' paint-order="'.concat(this.paintFirst,'" '):""}}function dn(t){return new RegExp("^("+t.join("|")+")\\b","i")}var gn;const pn=String.raw(gn||(gn=D(["(?:[-+]?(?:d*.d+|d+.?)(?:[eE][-+]?d+)?)"],["(?:[-+]?(?:\\d*\\.\\d+|\\d+\\.?)(?:[eE][-+]?\\d+)?)"]))),fn="http://www.w3.org/2000/svg",mn=new RegExp("(normal|italic)?\\s*(normal|small-caps)?\\s*(normal|bold|bolder|lighter|100|200|300|400|500|600|700|800|900)?\\s*("+pn+"(?:px|cm|mm|em|pt|pc|in)*)(?:\\/(normal|"+pn+"))?\\s+(.*)"),_n={cx:tt,x:tt,r:"radius",cy:et,y:et,display:"visible",visibility:"visible",transform:"transformMatrix","fill-opacity":"fillOpacity","fill-rule":"fillRule","font-family":"fontFamily","font-size":"fontSize","font-style":"fontStyle","font-weight":"fontWeight","letter-spacing":"charSpacing","paint-order":"paintFirst","stroke-dasharray":"strokeDashArray","stroke-dashoffset":"strokeDashOffset","stroke-linecap":"strokeLineCap","stroke-linejoin":"strokeLineJoin","stroke-miterlimit":"strokeMiterLimit","stroke-opacity":"strokeOpacity","stroke-width":"strokeWidth","text-decoration":"textDecoration","text-anchor":"textAnchor",opacity:"opacity","clip-path":"clipPath","clip-rule":"clipRule","vector-effect":"strokeUniform","image-rendering":"imageSmoothing"},vn="font-size",yn="clip-path",Cn=dn(["path","circle","polygon","polyline","ellipse","rect","line","image","text"]),bn=dn(["symbol","image","marker","pattern","view","svg"]),wn=dn(["symbol","g","a","svg","clipPath","defs"]),xn=new RegExp("^\\s*("+pn+"+)\\s*,?\\s*("+pn+"+)\\s*,?\\s*("+pn+"+)\\s*,?\\s*("+pn+"+)\\s*$"),Sn=new It(1,0),Tn=new It,En=(t,e)=>t.rotate(e),kn=(t,e)=>new It(e).subtract(t),An=t=>t.distanceFrom(Tn),On=(t,e)=>Math.atan2(Mn(t,e),Rn(t,e)),Dn=t=>On(Sn,t),In=t=>t.eq(Tn)?t:t.scalarDivide(An(t)),Pn=function(t){let e=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];return In(new It(-t.y,t.x).scalarMultiply(e?1:-1))},Mn=(t,e)=>t.x*e.y-t.y*e.x,Rn=(t,e)=>t.x*e.x+t.y*e.y,Fn=(t,e,n)=>{if(t.eq(e)||t.eq(n))return!0;const i=Mn(e,n),s=Mn(e,t),r=Mn(n,t);return i>=0?s>=0&&r<=0:!(s<=0&&r>=0)},Ln="(-?\\d+(?:\\.\\d*)?(?:px)?(?:\\s?|$))?",jn=new RegExp("(?:\\s|^)"+Ln+Ln+"("+pn+"?(?:px)?)?(?:\\s?|$)(?:$|\\s)");class Nn{constructor(t){const e="string"==typeof t?Nn.parseShadow(t):t;Object.assign(this,Nn.ownDefaults,e),this.id=Bt()}static parseShadow(t){const e=t.trim(),[,n=0,i=0,s=0]=(jn.exec(e)||[]).map((t=>parseFloat(t)||0));return{color:(e.replace(jn,"")||"rgb(0,0,0)").trim(),offsetX:n,offsetY:i,blur:s}}toString(){return[this.offsetX,this.offsetY,this.blur,this.color].join("px ")}toSVG(t){const e=En(new It(this.offsetX,this.offsetY),Vt(-t.angle)),n=new an(this.color);let i=40,s=40;return t.width&&t.height&&(i=100*ge((Math.abs(e.x)+this.blur)/t.width,P.NUM_FRACTION_DIGITS)+20,s=100*ge((Math.abs(e.y)+this.blur)/t.height,P.NUM_FRACTION_DIGITS)+20),t.flipX&&(e.x*=-1),t.flipY&&(e.y*=-1),'<filter id="SVGID_'.concat(this.id,'" y="-').concat(s,'%" height="').concat(100+2*s,'%" x="-').concat(i,'%" width="').concat(100+2*i,'%" >\n\t<feGaussianBlur in="SourceAlpha" stdDeviation="').concat(ge(this.blur?this.blur/2:0,P.NUM_FRACTION_DIGITS),'"></feGaussianBlur>\n\t<feOffset dx="').concat(ge(e.x,P.NUM_FRACTION_DIGITS),'" dy="').concat(ge(e.y,P.NUM_FRACTION_DIGITS),'" result="oBlur" ></feOffset>\n\t<feFlood flood-color="').concat(n.toRgb(),'" flood-opacity="').concat(n.getAlpha(),'"/>\n\t<feComposite in2="oBlur" operator="in" />\n\t<feMerge>\n\t\t<feMergeNode></feMergeNode>\n\t\t<feMergeNode in="SourceGraphic"></feMergeNode>\n\t</feMerge>\n</filter>\n')}toObject(){const t={color:this.color,blur:this.blur,offsetX:this.offsetX,offsetY:this.offsetY,affectStroke:this.affectStroke,nonScaling:this.nonScaling,type:this.constructor.type},e=Nn.ownDefaults;return this.includeDefaultValues?t:de(t,((t,n)=>t!==e[n]))}static async fromObject(t){return new this(t)}}E(Nn,"ownDefaults",{color:"rgb(0,0,0)",blur:0,offsetX:0,offsetY:0,affectStroke:!1,includeDefaultValues:!0,nonScaling:!1}),E(Nn,"type","shadow"),Tt.setClass(Nn,"shadow");const Bn=(t,e,n)=>Math.max(t,Math.min(e,n)),Wn=[et,tt,mt,_t,"flipX","flipY","originX","originY","angle","opacity","globalCompositeOperation","shadow","visible",vt,yt],Yn=[Ct,bt,"strokeWidth","strokeDashArray","width","height","paintFirst","strokeUniform","strokeLineCap","strokeDashOffset","strokeLineJoin","strokeMiterLimit","backgroundColor","clipPath"],Un={top:0,left:0,width:0,height:0,angle:0,flipX:!1,flipY:!1,scaleX:1,scaleY:1,minScaleLimit:0,skewX:0,skewY:0,originX:tt,originY:et,strokeWidth:1,strokeUniform:!1,padding:0,opacity:1,paintFirst:Ct,fill:"rgb(0,0,0)",fillRule:"nonzero",stroke:null,strokeDashArray:null,strokeDashOffset:0,strokeLineCap:"butt",strokeLineJoin:"miter",strokeMiterLimit:4,globalCompositeOperation:"source-over",backgroundColor:"",shadow:null,visible:!0,includeDefaultValues:!0,excludeFromExport:!1,objectCaching:!0,clipPath:void 0,inverted:!1,absolutePositioned:!1,centeredRotation:!0,centeredScaling:!1,dirty:!0},Xn=(t,e,n,i)=>(t<Math.abs(e)?(t=e,i=n/4):i=0===e&&0===t?n/q*Math.asin(1):n/q*Math.asin(e/t),{a:t,c:e,p:n,s:i}),Gn=(t,e,n,i,s)=>t*Math.pow(2,10*(i-=1))*Math.sin((i*s-e)*q/n),Vn=(t,e,n,i)=>-n*Math.cos(t/i*z)+n+e,Hn=(t,e,n,i)=>(t/=i)<1/2.75?n*(7.5625*t*t)+e:t<2/2.75?n*(7.5625*(t-=1.5/2.75)*t+.75)+e:t<2.5/2.75?n*(7.5625*(t-=2.25/2.75)*t+.9375)+e:n*(7.5625*(t-=2.625/2.75)*t+.984375)+e,zn=(t,e,n,i)=>n-Hn(i-t,0,n,i)+e;var qn=Object.freeze({__proto__:null,defaultEasing:Vn,easeInBack:function(t,e,n,i){let s=arguments.length>4&&void 0!==arguments[4]?arguments[4]:1.70158;return n*(t/=i)*t*((s+1)*t-s)+e},easeInBounce:zn,easeInCirc:(t,e,n,i)=>-n*(Math.sqrt(1-(t/=i)*t)-1)+e,easeInCubic:(t,e,n,i)=>n*(t/i)**3+e,easeInElastic:(t,e,n,i)=>{const s=n;let r=0;if(0===t)return e;if(1===(t/=i))return e+n;r||(r=.3*i);const{a:o,s:a,p:h}=Xn(s,n,r,1.70158);return-Gn(o,a,h,t,i)+e},easeInExpo:(t,e,n,i)=>0===t?e:n*2**(10*(t/i-1))+e,easeInOutBack:function(t,e,n,i){let s=arguments.length>4&&void 0!==arguments[4]?arguments[4]:1.70158;return(t/=i/2)<1?n/2*(t*t*((1+(s*=1.525))*t-s))+e:n/2*((t-=2)*t*((1+(s*=1.525))*t+s)+2)+e},easeInOutBounce:(t,e,n,i)=>t<i/2?.5*zn(2*t,0,n,i)+e:.5*Hn(2*t-i,0,n,i)+.5*n+e,easeInOutCirc:(t,e,n,i)=>(t/=i/2)<1?-n/2*(Math.sqrt(1-t**2)-1)+e:n/2*(Math.sqrt(1-(t-=2)*t)+1)+e,easeInOutCubic:(t,e,n,i)=>(t/=i/2)<1?n/2*t**3+e:n/2*((t-2)**3+2)+e,easeInOutElastic:(t,e,n,i)=>{const s=n;let r=0;if(0===t)return e;if(2===(t/=i/2))return e+n;r||(r=i*(.3*1.5));const{a:o,s:a,p:h,c:c}=Xn(s,n,r,1.70158);return t<1?-.5*Gn(o,a,h,t,i)+e:o*Math.pow(2,-10*(t-=1))*Math.sin((t*i-a)*q/h)*.5+c+e},easeInOutExpo:(t,e,n,i)=>0===t?e:t===i?e+n:(t/=i/2)<1?n/2*2**(10*(t-1))+e:n/2*-(2**(-10*--t)+2)+e,easeInOutQuad:(t,e,n,i)=>(t/=i/2)<1?n/2*t**2+e:-n/2*(--t*(t-2)-1)+e,easeInOutQuart:(t,e,n,i)=>(t/=i/2)<1?n/2*t**4+e:-n/2*((t-=2)*t**3-2)+e,easeInOutQuint:(t,e,n,i)=>(t/=i/2)<1?n/2*t**5+e:n/2*((t-2)**5+2)+e,easeInOutSine:(t,e,n,i)=>-n/2*(Math.cos(Math.PI*t/i)-1)+e,easeInQuad:(t,e,n,i)=>n*(t/=i)*t+e,easeInQuart:(t,e,n,i)=>n*(t/=i)*t**3+e,easeInQuint:(t,e,n,i)=>n*(t/i)**5+e,easeInSine:(t,e,n,i)=>-n*Math.cos(t/i*z)+n+e,easeOutBack:function(t,e,n,i){let s=arguments.length>4&&void 0!==arguments[4]?arguments[4]:1.70158;return n*((t=t/i-1)*t*((s+1)*t+s)+1)+e},easeOutBounce:Hn,easeOutCirc:(t,e,n,i)=>n*Math.sqrt(1-(t=t/i-1)*t)+e,easeOutCubic:(t,e,n,i)=>n*((t/i-1)**3+1)+e,easeOutElastic:(t,e,n,i)=>{const s=n;let r=0;if(0===t)return e;if(1===(t/=i))return e+n;r||(r=.3*i);const{a:o,s:a,p:h,c:c}=Xn(s,n,r,1.70158);return o*2**(-10*t)*Math.sin((t*i-a)*q/h)+c+e},easeOutExpo:(t,e,n,i)=>t===i?e+n:n*-(2**(-10*t/i)+1)+e,easeOutQuad:(t,e,n,i)=>-n*(t/=i)*(t-2)+e,easeOutQuart:(t,e,n,i)=>-n*((t=t/i-1)*t**3-1)+e,easeOutQuint:(t,e,n,i)=>n*((t/i-1)**5+1)+e,easeOutSine:(t,e,n,i)=>n*Math.sin(t/i*z)+e});const Kn=()=>!1;class Qn{constructor(t){let{startValue:e,byValue:n,duration:i=500,delay:s=0,easing:r=Vn,onStart:o=H,onChange:a=H,onComplete:h=H,abort:c=Kn,target:l}=t;E(this,"_state","pending"),E(this,"durationProgress",0),E(this,"valueProgress",0),this.tick=this.tick.bind(this),this.duration=i,this.delay=s,this.easing=r,this._onStart=o,this._onChange=a,this._onComplete=h,this._abort=c,this.target=l,this.startValue=e,this.byValue=n,this.value=this.startValue,this.endValue=Object.freeze(this.calculate(this.duration).value)}get state(){return this._state}isDone(){return"aborted"===this._state||"completed"===this._state}start(){const t=t=>{"pending"===this._state&&(this.startTime=t||+new Date,this._state="running",this._onStart(),this.tick(this.startTime))};this.register(),this.delay>0?setTimeout((()=>Lt(t)),this.delay):Lt(t)}tick(t){const e=(t||+new Date)-this.startTime,n=Math.min(e,this.duration);this.durationProgress=n/this.duration;const{value:i,valueProgress:s}=this.calculate(n);this.value=Object.freeze(i),this.valueProgress=s,"aborted"!==this._state&&(this._abort(this.value,this.valueProgress,this.durationProgress)?(this._state="aborted",this.unregister()):e>=this.duration?(this.durationProgress=this.valueProgress=1,this._onChange(this.endValue,this.valueProgress,this.durationProgress),this._state="completed",this._onComplete(this.endValue,this.valueProgress,this.durationProgress),this.unregister()):(this._onChange(this.value,this.valueProgress,this.durationProgress),Lt(this.tick)))}register(){Et.push(this)}unregister(){Et.remove(this)}abort(){this._state="aborted",this.unregister()}}const Jn=["startValue","endValue"];class Zn extends Qn{constructor(t){let{startValue:e=0,endValue:n=100}=t;super(A(A({},O(t,Jn)),{},{startValue:e,byValue:n-e}))}calculate(t){const e=this.easing(t,this.startValue,this.byValue,this.duration);return{value:e,valueProgress:Math.abs((e-this.startValue)/this.byValue)}}}const $n=["startValue","endValue"];class ti extends Qn{constructor(t){let{startValue:e=[0],endValue:n=[100]}=t;super(A(A({},O(t,$n)),{},{startValue:e,byValue:n.map(((t,n)=>t-e[n]))}))}calculate(t){const e=this.startValue.map(((e,n)=>this.easing(t,e,this.byValue[n],this.duration,n)));return{value:e,valueProgress:Math.abs((e[0]-this.startValue[0])/this.byValue[0])}}}const ei=["startValue","endValue","easing","onChange","onComplete","abort"],ni=(t,e,n,i)=>e+n*(1-Math.cos(t/i*z)),ii=t=>t&&((e,n,i)=>t(new an(e).toRgba(),n,i));class si extends Qn{constructor(t){let{startValue:e,endValue:n,easing:i=ni,onChange:s,onComplete:r,abort:o}=t,a=O(t,ei);const h=new an(e).getSource(),c=new an(n).getSource();super(A(A({},a),{},{startValue:h,byValue:c.map(((t,e)=>t-h[e])),easing:i,onChange:ii(s),onComplete:ii(r),abort:ii(o)}))}calculate(t){const[e,n,i,s]=this.startValue.map(((e,n)=>this.easing(t,e,this.byValue[n],this.duration,n))),r=[...[e,n,i].map(Math.round),Bn(0,s,1)];return{value:r,valueProgress:r.map(((t,e)=>0!==this.byValue[e]?Math.abs((t-this.startValue[e])/this.byValue[e]):0)).find((t=>0!==t))||0}}}function ri(t){const e=(t=>Array.isArray(t.startValue)||Array.isArray(t.endValue))(t)?new ti(t):new Zn(t);return e.start(),e}function oi(t){const e=new si(t);return e.start(),e}class ai{constructor(t){this.status=t,this.points=[]}includes(t){return this.points.some((e=>e.eq(t)))}append(){for(var t=arguments.length,e=new Array(t),n=0;n<t;n++)e[n]=arguments[n];return this.points=this.points.concat(e.filter((t=>!this.includes(t)))),this}static isPointContained(t,e,n){let i=arguments.length>3&&void 0!==arguments[3]&&arguments[3];if(e.eq(n))return t.eq(e);if(e.x===n.x)return t.x===e.x&&(i||t.y>=Math.min(e.y,n.y)&&t.y<=Math.max(e.y,n.y));if(e.y===n.y)return t.y===e.y&&(i||t.x>=Math.min(e.x,n.x)&&t.x<=Math.max(e.x,n.x));{const s=kn(e,n),r=kn(e,t).divide(s);return i?Math.abs(r.x)===Math.abs(r.y):r.x===r.y&&r.x>=0&&r.x<=1}}static isPointInPolygon(t,e){const n=new It(t).setX(Math.min(t.x-1,...e.map((t=>t.x))));let i=0;for(let s=0;s<e.length;s++){const r=this.intersectSegmentSegment(e[s],e[(s+1)%e.length],t,n);if(r.includes(t))return!0;i+=Number("Intersection"===r.status)}return i%2==1}static intersectLineLine(t,e,n,i){let s=!(arguments.length>4&&void 0!==arguments[4])||arguments[4],r=!(arguments.length>5&&void 0!==arguments[5])||arguments[5];const o=e.x-t.x,a=e.y-t.y,h=i.x-n.x,c=i.y-n.y,l=t.x-n.x,u=t.y-n.y,d=h*u-c*l,g=o*u-a*l,p=c*o-h*a;if(0!==p){const e=d/p,n=g/p;return(s||0<=e&&e<=1)&&(r||0<=n&&n<=1)?new ai("Intersection").append(new It(t.x+e*o,t.y+e*a)):new ai}if(0===d||0===g){const o=s||r||ai.isPointContained(t,n,i)||ai.isPointContained(e,n,i)||ai.isPointContained(n,t,e)||ai.isPointContained(i,t,e);return new ai(o?"Coincident":void 0)}return new ai("Parallel")}static intersectSegmentLine(t,e,n,i){return ai.intersectLineLine(t,e,n,i,!1,!0)}static intersectSegmentSegment(t,e,n,i){return ai.intersectLineLine(t,e,n,i,!1,!1)}static intersectLinePolygon(t,e,n){let i=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];const s=new ai,r=n.length;for(let o,a,h,c=0;c<r;c++){if(o=n[c],a=n[(c+1)%r],h=ai.intersectLineLine(t,e,o,a,i,!1),"Coincident"===h.status)return h;s.append(...h.points)}return s.points.length>0&&(s.status="Intersection"),s}static intersectSegmentPolygon(t,e,n){return ai.intersectLinePolygon(t,e,n,!1)}static intersectPolygonPolygon(t,e){const n=new ai,i=t.length,s=[];for(let r=0;r<i;r++){const o=t[r],a=t[(r+1)%i],h=ai.intersectSegmentPolygon(o,a,e);"Coincident"===h.status?(s.push(h),n.append(o,a)):n.append(...h.points)}return s.length>0&&s.length===t.length?new ai("Coincident"):(n.points.length>0&&(n.status="Intersection"),n)}static intersectPolygonRectangle(t,e,n){const i=e.min(n),s=e.max(n),r=new It(s.x,i.y),o=new It(i.x,s.y);return ai.intersectPolygonPolygon(t,[i,r,s,o])}}class hi extends Ft{getX(){return this.getXY().x}setX(t){this.setXY(this.getXY().setX(t))}getY(){return this.getXY().y}setY(t){this.setXY(this.getXY().setY(t))}getRelativeX(){return this.left}setRelativeX(t){this.left=t}getRelativeY(){return this.top}setRelativeY(t){this.top=t}getXY(){const t=this.getRelativeXY();return this.group?qt(t,this.group.calcTransformMatrix()):t}setXY(t,e,n){this.group&&(t=qt(t,Kt(this.group.calcTransformMatrix()))),this.setRelativeXY(t,e,n)}getRelativeXY(){return new It(this.left,this.top)}setRelativeXY(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.originX,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:this.originY;this.setPositionByOrigin(t,e,n)}isStrokeAccountedForInDimensions(){return!1}getCoords(){const{tl:t,tr:e,br:n,bl:i}=this.aCoords||(this.aCoords=this.calcACoords()),s=[t,e,n,i];if(this.group){const t=this.group.calcTransformMatrix();return s.map((e=>qt(e,t)))}return s}intersectsWithRect(t,e){return"Intersection"===ai.intersectPolygonRectangle(this.getCoords(),t,e).status}intersectsWithObject(t){const e=ai.intersectPolygonPolygon(this.getCoords(),t.getCoords());return"Intersection"===e.status||"Coincident"===e.status||t.isContainedWithinObject(this)||this.isContainedWithinObject(t)}isContainedWithinObject(t){return this.getCoords().every((e=>t.containsPoint(e)))}isContainedWithinRect(t,e){const{left:n,top:i,width:s,height:r}=this.getBoundingRect();return n>=t.x&&n+s<=e.x&&i>=t.y&&i+r<=e.y}isOverlapping(t){return this.intersectsWithObject(t)||this.isContainedWithinObject(t)||t.isContainedWithinObject(this)}containsPoint(t){return ai.isPointInPolygon(t,this.getCoords())}isOnScreen(){if(!this.canvas)return!1;const{tl:t,br:e}=this.canvas.vptCoords;return!!this.getCoords().some((n=>n.x<=e.x&&n.x>=t.x&&n.y<=e.y&&n.y>=t.y))||!!this.intersectsWithRect(t,e)||this.containsPoint(t.midPointFrom(e))}isPartiallyOnScreen(){if(!this.canvas)return!1;const{tl:t,br:e}=this.canvas.vptCoords;return!!this.intersectsWithRect(t,e)||this.getCoords().every((n=>(n.x>=e.x||n.x<=t.x)&&(n.y>=e.y||n.y<=t.y)))&&this.containsPoint(t.midPointFrom(e))}getBoundingRect(){return Pe(this.getCoords())}getScaledWidth(){return this._getTransformedDimensions().x}getScaledHeight(){return this._getTransformedDimensions().y}scale(t){this._set(mt,t),this._set(_t,t),this.setCoords()}scaleToWidth(t){const e=this.getBoundingRect().width/this.getScaledWidth();return this.scale(t/this.width/e)}scaleToHeight(t){const e=this.getBoundingRect().height/this.getScaledHeight();return this.scale(t/this.height/e)}getCanvasRetinaScaling(){var t;return(null===(t=this.canvas)||void 0===t?void 0:t.getRetinaScaling())||1}getTotalAngle(){return this.group?Ht(Zt(this.calcTransformMatrix())):this.angle}getViewportTransform(){var t;return(null===(t=this.canvas)||void 0===t?void 0:t.viewportTransform)||Q.concat()}calcACoords(){const t=ee({angle:this.angle}),{x:e,y:n}=this.getRelativeCenterPoint(),i=te(e,n),s=Qt(i,t),r=this._getTransformedDimensions(),o=r.x/2,a=r.y/2;return{tl:qt({x:-o,y:-a},s),tr:qt({x:o,y:-a},s),bl:qt({x:-o,y:a},s),br:qt({x:o,y:a},s)}}setCoords(){this.aCoords=this.calcACoords()}transformMatrixKey(){let t=arguments.length>0&&void 0!==arguments[0]&&arguments[0],e=[];return!t&&this.group&&(e=this.group.transformMatrixKey(t)),e.push(this.top,this.left,this.width,this.height,this.scaleX,this.scaleY,this.angle,this.strokeWidth,this.skewX,this.skewY,+this.flipX,+this.flipY,Ve(this.originX),Ve(this.originY)),e}calcTransformMatrix(){let t=arguments.length>0&&void 0!==arguments[0]&&arguments[0],e=this.calcOwnMatrix();if(t||!this.group)return e;const n=this.transformMatrixKey(t),i=this.matrixCache;return i&&i.key.every(((t,e)=>t===n[e]))?i.value:(this.group&&(e=Qt(this.group.calcTransformMatrix(!1),e)),this.matrixCache={key:n,value:e},e)}calcOwnMatrix(){const t=this.transformMatrixKey(!0),e=this.ownMatrixCache;if(e&&e.key===t)return e.value;const n=this.getRelativeCenterPoint(),i={angle:this.angle,translateX:n.x,translateY:n.y,scaleX:this.scaleX,scaleY:this.scaleY,skewX:this.skewX,skewY:this.skewY,flipX:this.flipX,flipY:this.flipY},s=ae(i);return this.ownMatrixCache={key:t,value:s},s}_getNonTransformedDimensions(){return new It(this.width,this.height).scalarAdd(this.strokeWidth)}_calculateCurrentDimensions(t){return this._getTransformedDimensions(t).transform(this.getViewportTransform(),!0).scalarAdd(2*this.padding)}_getTransformedDimensions(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};const e=A({scaleX:this.scaleX,scaleY:this.scaleY,skewX:this.skewX,skewY:this.skewY,width:this.width,height:this.height,strokeWidth:this.strokeWidth},t),n=e.strokeWidth;let i=n,s=0;this.strokeUniform&&(i=0,s=n);const r=e.width+i,o=e.height+i;let a;return a=0===e.skewX&&0===e.skewY?new It(r*e.scaleX,o*e.scaleY):Ne(r,o,oe(e)),a.scalarAdd(s)}translateToGivenOrigin(t,e,n,i,s){let r=t.x,o=t.y;const a=Ve(i)-Ve(e),h=Ve(s)-Ve(n);if(a||h){const t=this._getTransformedDimensions();r+=a*t.x,o+=h*t.y}return new It(r,o)}translateToCenterPoint(t,e,n){if(e===$&&n===$)return t;const i=this.translateToGivenOrigin(t,e,n,$,$);return this.angle?i.rotate(Vt(this.angle),t):i}translateToOriginPoint(t,e,n){const i=this.translateToGivenOrigin(t,$,$,e,n);return this.angle?i.rotate(Vt(this.angle),t):i}getCenterPoint(){const t=this.getRelativeCenterPoint();return this.group?qt(t,this.group.calcTransformMatrix()):t}getRelativeCenterPoint(){return this.translateToCenterPoint(new It(this.left,this.top),this.originX,this.originY)}getPointByOrigin(t,e){return this.translateToOriginPoint(this.getRelativeCenterPoint(),t,e)}setPositionByOrigin(t,e,n){const i=this.translateToCenterPoint(t,e,n),s=this.translateToOriginPoint(i,this.originX,this.originY);this.set({left:s.x,top:s.y})}_getLeftTopCoords(){return this.translateToOriginPoint(this.getRelativeCenterPoint(),tt,et)}}const ci=["type"],li=["extraParam"];let ui=class t extends hi{static getDefaults(){return t.ownDefaults}get type(){const t=this.constructor.type;return"FabricObject"===t?"object":t.toLowerCase()}set type(t){M("warn","Setting type has no effect",t)}constructor(e){super(),E(this,"_cacheContext",null),Object.assign(this,t.ownDefaults),this.setOptions(e)}_createCacheCanvas(){this._cacheCanvas=Wt(),this._cacheContext=this._cacheCanvas.getContext("2d"),this._updateCacheCanvas(),this.dirty=!0}_limitCacheSize(t){const e=t.width,n=t.height,i=P.maxCacheSideLimit,s=P.minCacheSideLimit;if(e<=i&&n<=i&&e*n<=P.perfLimitSizeTotal)return e<s&&(t.width=s),n<s&&(t.height=s),t;const r=e/n,[o,a]=G.limitDimsByArea(r),h=Bn(s,o,i),c=Bn(s,a,i);return e>h&&(t.zoomX/=e/h,t.width=h,t.capped=!0),n>c&&(t.zoomY/=n/c,t.height=c,t.capped=!0),t}_getCacheCanvasDimensions(){const t=this.getTotalObjectScaling(),e=this._getTransformedDimensions({skewX:0,skewY:0}),n=e.x*t.x/this.scaleX,i=e.y*t.y/this.scaleY;return{width:Math.ceil(n+2),height:Math.ceil(i+2),zoomX:t.x,zoomY:t.y,x:n,y:i}}_updateCacheCanvas(){const t=this._cacheCanvas,e=this._cacheContext,{width:n,height:i,zoomX:s,zoomY:r,x:o,y:a}=this._limitCacheSize(this._getCacheCanvasDimensions()),h=n!==t.width||i!==t.height,c=this.zoomX!==s||this.zoomY!==r;if(!t||!e)return!1;if(h||c){n!==t.width||i!==t.height?(t.width=n,t.height=i):(e.setTransform(1,0,0,1,0,0),e.clearRect(0,0,t.width,t.height));const h=o/2,c=a/2;return this.cacheTranslationX=Math.round(t.width/2-h)+h,this.cacheTranslationY=Math.round(t.height/2-c)+c,e.translate(this.cacheTranslationX,this.cacheTranslationY),e.scale(s,r),this.zoomX=s,this.zoomY=r,!0}return!1}setOptions(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};this._setOptions(t)}transform(t){const e=this.group&&!this.group._transformDone||this.group&&this.canvas&&t===this.canvas.contextTop,n=this.calcTransformMatrix(!e);t.transform(n[0],n[1],n[2],n[3],n[4],n[5])}getObjectScaling(){if(!this.group)return new It(Math.abs(this.scaleX),Math.abs(this.scaleY));const t=$t(this.calcTransformMatrix());return new It(Math.abs(t.scaleX),Math.abs(t.scaleY))}getTotalObjectScaling(){const t=this.getObjectScaling();if(this.canvas){const e=this.canvas.getZoom(),n=this.getCanvasRetinaScaling();return t.scalarMultiply(e*n)}return t}getObjectOpacity(){let t=this.opacity;return this.group&&(t*=this.group.getObjectOpacity()),t}_constrainScale(t){return Math.abs(t)<this.minScaleLimit?t<0?-this.minScaleLimit:this.minScaleLimit:0===t?1e-4:t}_set(t,e){t!==mt&&t!==_t||(e=this._constrainScale(e)),t===mt&&e<0?(this.flipX=!this.flipX,e*=-1):"scaleY"===t&&e<0?(this.flipY=!this.flipY,e*=-1):"shadow"!==t||!e||e instanceof Nn||(e=new Nn(e));const n=this[t]!==e;return this[t]=e,n&&this.constructor.cacheProperties.includes(t)&&(this.dirty=!0),this.parent&&(this.dirty||n&&this.constructor.stateProperties.includes(t))&&this.parent._set("dirty",!0),this}isNotVisible(){return 0===this.opacity||!this.width&&!this.height&&0===this.strokeWidth||!this.visible}render(t){this.isNotVisible()||this.canvas&&this.canvas.skipOffscreen&&!this.group&&!this.isOnScreen()||(t.save(),this._setupCompositeOperation(t),this.drawSelectionBackground(t),this.transform(t),this._setOpacity(t),this._setShadow(t),this.shouldCache()?(this.renderCache(),this.drawCacheOnCanvas(t)):(this._removeCacheCanvas(),this.drawObject(t,!1,{}),this.dirty=!1),t.restore())}drawSelectionBackground(t){}renderCache(t){if(t=t||{},this._cacheCanvas&&this._cacheContext||this._createCacheCanvas(),this.isCacheDirty()&&this._cacheContext){const{zoomX:e,zoomY:n,cacheTranslationX:i,cacheTranslationY:s}=this,{width:r,height:o}=this._cacheCanvas;this.drawObject(this._cacheContext,t.forClipping,{zoomX:e,zoomY:n,cacheTranslationX:i,cacheTranslationY:s,width:r,height:o,parentClipPaths:[]}),this.dirty=!1}}_removeCacheCanvas(){this._cacheCanvas=void 0,this._cacheContext=null}hasStroke(){return this.stroke&&"transparent"!==this.stroke&&0!==this.strokeWidth}hasFill(){return this.fill&&"transparent"!==this.fill}needsItsOwnCache(){return!!(this.paintFirst===bt&&this.hasFill()&&this.hasStroke()&&this.shadow)||!!this.clipPath}shouldCache(){return this.ownCaching=this.objectCaching&&(!this.parent||!this.parent.isOnACache())||this.needsItsOwnCache(),this.ownCaching}willDrawShadow(){return!!this.shadow&&(0!==this.shadow.offsetX||0!==this.shadow.offsetY)}drawClipPathOnCache(t,e,n){t.save(),e.inverted?t.globalCompositeOperation="destination-out":t.globalCompositeOperation="destination-in",t.setTransform(1,0,0,1,0,0),t.drawImage(n,0,0),t.restore()}drawObject(t,e,n){const i=this.fill,s=this.stroke;e?(this.fill="black",this.stroke="",this._setClippingProperties(t)):this._renderBackground(t),this._render(t),this._drawClipPath(t,this.clipPath,n),this.fill=i,this.stroke=s}createClipPathLayer(t,e){const n=Ut(e),i=n.getContext("2d");if(i.translate(e.cacheTranslationX,e.cacheTranslationY),i.scale(e.zoomX,e.zoomY),t._cacheCanvas=n,e.parentClipPaths.forEach((t=>{t.transform(i)})),e.parentClipPaths.push(t),t.absolutePositioned){const t=Kt(this.calcTransformMatrix());i.transform(t[0],t[1],t[2],t[3],t[4],t[5])}return t.transform(i),t.drawObject(i,!0,e),n}_drawClipPath(t,e,n){if(!e)return;e._transformDone=!0;const i=this.createClipPathLayer(e,n);this.drawClipPathOnCache(t,e,i)}drawCacheOnCanvas(t){t.scale(1/this.zoomX,1/this.zoomY),t.drawImage(this._cacheCanvas,-this.cacheTranslationX,-this.cacheTranslationY)}isCacheDirty(){let t=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(this.isNotVisible())return!1;const e=this._cacheCanvas,n=this._cacheContext;return!(!e||!n||t||!this._updateCacheCanvas())||!!(this.dirty||this.clipPath&&this.clipPath.absolutePositioned)&&(e&&n&&!t&&(n.save(),n.setTransform(1,0,0,1,0,0),n.clearRect(0,0,e.width,e.height),n.restore()),!0)}_renderBackground(t){if(!this.backgroundColor)return;const e=this._getNonTransformedDimensions();t.fillStyle=this.backgroundColor,t.fillRect(-e.x/2,-e.y/2,e.x,e.y),this._removeShadow(t)}_setOpacity(t){this.group&&!this.group._transformDone?t.globalAlpha=this.getObjectOpacity():t.globalAlpha*=this.opacity}_setStrokeStyles(t,e){const n=e.stroke;n&&(t.lineWidth=e.strokeWidth,t.lineCap=e.strokeLineCap,t.lineDashOffset=e.strokeDashOffset,t.lineJoin=e.strokeLineJoin,t.miterLimit=e.strokeMiterLimit,fe(n)?"percentage"===n.gradientUnits||n.gradientTransform||n.patternTransform?this._applyPatternForTransformedGradient(t,n):(t.strokeStyle=n.toLive(t),this._applyPatternGradientTransform(t,n)):t.strokeStyle=e.stroke)}_setFillStyles(t,e){let{fill:n}=e;n&&(fe(n)?(t.fillStyle=n.toLive(t),this._applyPatternGradientTransform(t,n)):t.fillStyle=n)}_setClippingProperties(t){t.globalAlpha=1,t.strokeStyle="transparent",t.fillStyle="#000000"}_setLineDash(t,e){e&&0!==e.length&&t.setLineDash(e)}_setShadow(t){if(!this.shadow)return;const e=this.shadow,n=this.canvas,i=this.getCanvasRetinaScaling(),[s,,,r]=(null==n?void 0:n.viewportTransform)||Q,o=s*i,a=r*i,h=e.nonScaling?new It(1,1):this.getObjectScaling();t.shadowColor=e.color,t.shadowBlur=e.blur*P.browserShadowBlurConstant*(o+a)*(h.x+h.y)/4,t.shadowOffsetX=e.offsetX*o*h.x,t.shadowOffsetY=e.offsetY*a*h.y}_removeShadow(t){this.shadow&&(t.shadowColor="",t.shadowBlur=t.shadowOffsetX=t.shadowOffsetY=0)}_applyPatternGradientTransform(t,e){if(!fe(e))return{offsetX:0,offsetY:0};const n=e.gradientTransform||e.patternTransform,i=-this.width/2+e.offsetX||0,s=-this.height/2+e.offsetY||0;return"percentage"===e.gradientUnits?t.transform(this.width,0,0,this.height,i,s):t.transform(1,0,0,1,i,s),n&&t.transform(n[0],n[1],n[2],n[3],n[4],n[5]),{offsetX:i,offsetY:s}}_renderPaintInOrder(t){this.paintFirst===bt?(this._renderStroke(t),this._renderFill(t)):(this._renderFill(t),this._renderStroke(t))}_render(t){}_renderFill(t){this.fill&&(t.save(),this._setFillStyles(t,this),"evenodd"===this.fillRule?t.fill("evenodd"):t.fill(),t.restore())}_renderStroke(t){if(this.stroke&&0!==this.strokeWidth){if(this.shadow&&!this.shadow.affectStroke&&this._removeShadow(t),t.save(),this.strokeUniform){const e=this.getObjectScaling();t.scale(1/e.x,1/e.y)}this._setLineDash(t,this.strokeDashArray),this._setStrokeStyles(t,this),t.stroke(),t.restore()}}_applyPatternForTransformedGradient(t,e){var n;const i=this._limitCacheSize(this._getCacheCanvasDimensions()),s=this.getCanvasRetinaScaling(),r=i.x/this.scaleX/s,o=i.y/this.scaleY/s,a=Ut({width:Math.ceil(r),height:Math.ceil(o)}),h=a.getContext("2d");h&&(h.beginPath(),h.moveTo(0,0),h.lineTo(r,0),h.lineTo(r,o),h.lineTo(0,o),h.closePath(),h.translate(r/2,o/2),h.scale(i.zoomX/this.scaleX/s,i.zoomY/this.scaleY/s),this._applyPatternGradientTransform(h,e),h.fillStyle=e.toLive(t),h.fill(),t.translate(-this.width/2-this.strokeWidth/2,-this.height/2-this.strokeWidth/2),t.scale(s*this.scaleX/i.zoomX,s*this.scaleY/i.zoomY),t.strokeStyle=null!==(n=h.createPattern(a,"no-repeat"))&&void 0!==n?n:"")}_findCenterFromElement(){return new It(this.left+this.width/2,this.top+this.height/2)}clone(t){const e=this.toObject(t);return this.constructor.fromObject(e)}cloneAsImage(t){const e=this.toCanvasElement(t);return new(Tt.getClass("image"))(e)}toCanvasElement(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};const e=je(this),n=this.group,i=this.shadow,s=Math.abs,r=t.enableRetinaScaling?X():1,o=(t.multiplier||1)*r,a=t.canvasProvider||(t=>new ke(t,{enableRetinaScaling:!1,renderOnAddRemove:!1,skipOffscreen:!1}));delete this.group,t.withoutTransform&&Le(this),t.withoutShadow&&(this.shadow=null),t.viewportTransform&&Ue(this,this.getViewportTransform()),this.setCoords();const h=Wt(),c=this.getBoundingRect(),l=this.shadow,u=new It;if(l){const t=l.blur,e=l.nonScaling?new It(1,1):this.getObjectScaling();u.x=2*Math.round(s(l.offsetX)+t)*s(e.x),u.y=2*Math.round(s(l.offsetY)+t)*s(e.y)}const d=c.width+u.x,g=c.height+u.y;h.width=Math.ceil(d),h.height=Math.ceil(g);const p=a(h);"jpeg"===t.format&&(p.backgroundColor="#fff"),this.setPositionByOrigin(new It(p.width/2,p.height/2),$,$);const f=this.canvas;p._objects=[this],this.set("canvas",p),this.setCoords();const m=p.toCanvasElement(o||1,t);return this.set("canvas",f),this.shadow=i,n&&(this.group=n),this.set(e),this.setCoords(),p._objects=[],p.destroy(),m}toDataURL(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return Xt(this.toCanvasElement(t),t.format||"png",t.quality||1)}toBlob(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return Gt(this.toCanvasElement(t),t.format||"png",t.quality||1)}isType(){for(var t=arguments.length,e=new Array(t),n=0;n<t;n++)e[n]=arguments[n];return e.includes(this.constructor.type)||e.includes(this.type)}complexity(){return 1}toJSON(){return this.toObject()}rotate(t){const{centeredRotation:e,originX:n,originY:i}=this;if(e){const{x:t,y:e}=this.getRelativeCenterPoint();this.originX=$,this.originY=$,this.left=t,this.top=e}if(this.set("angle",t),e){const{x:t,y:e}=this.translateToOriginPoint(this.getRelativeCenterPoint(),n,i);this.left=t,this.top=e,this.originX=n,this.originY=i}}setOnGroup(){}_setupCompositeOperation(t){this.globalCompositeOperation&&(t.globalCompositeOperation=this.globalCompositeOperation)}dispose(){Et.cancelByTarget(this),this.off(),this._set("canvas",void 0),this._cacheCanvas&&W().dispose(this._cacheCanvas),this._cacheCanvas=void 0,this._cacheContext=null}animate(t,e){return Object.entries(t).reduce(((t,n)=>{let[i,s]=n;return t[i]=this._animate(i,s,e),t}),{})}_animate(t,e){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};const i=t.split("."),s=this.constructor.colorProperties.includes(i[i.length-1]),{abort:r,startValue:o,onChange:a,onComplete:h}=n,c=A(A({},n),{},{target:this,startValue:null!=o?o:i.reduce(((t,e)=>t[e]),this),endValue:e,abort:null==r?void 0:r.bind(this),onChange:(t,e,n)=>{i.reduce(((e,n,s)=>(s===i.length-1&&(e[n]=t),e[n])),this),a&&a(t,e,n)},onComplete:(t,e,n)=>{this.setCoords(),h&&h(t,e,n)}});return s?oi(c):ri(c)}isDescendantOf(t){const{parent:e,group:n}=this;return e===t||n===t||!!e&&e.isDescendantOf(t)||!!n&&n!==e&&n.isDescendantOf(t)}getAncestors(){const t=[];let e=this;do{e=e.parent,e&&t.push(e)}while(e);return t}findCommonAncestors(t){if(this===t)return{fork:[],otherFork:[],common:[this,...this.getAncestors()]};const e=this.getAncestors(),n=t.getAncestors();if(0===e.length&&n.length>0&&this===n[n.length-1])return{fork:[],otherFork:[t,...n.slice(0,n.length-1)],common:[this]};for(let i,s=0;s<e.length;s++){if(i=e[s],i===t)return{fork:[this,...e.slice(0,s)],otherFork:[],common:e.slice(s)};for(let r=0;r<n.length;r++){if(this===n[r])return{fork:[],otherFork:[t,...n.slice(0,r)],common:[this,...e]};if(i===n[r])return{fork:[this,...e.slice(0,s)],otherFork:[t,...n.slice(0,r)],common:e.slice(s)}}}return{fork:[this,...e],otherFork:[t,...n],common:[]}}hasCommonAncestors(t){const e=this.findCommonAncestors(t);return e&&!!e.common.length}isInFrontOf(t){if(this===t)return;const e=this.findCommonAncestors(t);if(e.fork.includes(t))return!0;if(e.otherFork.includes(this))return!1;const n=e.common[0]||this.canvas;if(!n)return;const i=e.fork.pop(),s=e.otherFork.pop(),r=n._objects.indexOf(i),o=n._objects.indexOf(s);return r>-1&&r>o}toObject(){const e=(arguments.length>0&&void 0!==arguments[0]?arguments[0]:[]).concat(t.customProperties,this.constructor.customProperties||[]);let n;const i=P.NUM_FRACTION_DIGITS,{clipPath:s,fill:r,stroke:o,shadow:a,strokeDashArray:h,left:c,top:l,originX:u,originY:d,width:g,height:p,strokeWidth:f,strokeLineCap:m,strokeDashOffset:_,strokeLineJoin:v,strokeUniform:y,strokeMiterLimit:C,scaleX:b,scaleY:w,angle:x,flipX:S,flipY:T,opacity:E,visible:k,backgroundColor:O,fillRule:D,paintFirst:I,globalCompositeOperation:M,skewX:R,skewY:F}=this;s&&!s.excludeFromExport&&(n=s.toObject(e.concat("inverted","absolutePositioned")));const L=t=>ge(t,i),j=A(A({},ue(this,e)),{},{type:this.constructor.type,version:V,originX:u,originY:d,left:L(c),top:L(l),width:L(g),height:L(p),fill:me(r)?r.toObject():r,stroke:me(o)?o.toObject():o,strokeWidth:L(f),strokeDashArray:h?h.concat():h,strokeLineCap:m,strokeDashOffset:_,strokeLineJoin:v,strokeUniform:y,strokeMiterLimit:L(C),scaleX:L(b),scaleY:L(w),angle:L(x),flipX:S,flipY:T,opacity:L(E),shadow:a?a.toObject():a,visible:k,backgroundColor:O,fillRule:D,paintFirst:I,globalCompositeOperation:M,skewX:L(R),skewY:L(F)},n?{clipPath:n}:null);return this.includeDefaultValues?j:this._removeDefaultValues(j)}toDatalessObject(t){return this.toObject(t)}_removeDefaultValues(t){const e=this.constructor.getDefaults(),n=Object.keys(e).length>0?e:Object.getPrototypeOf(this);return de(t,((t,e)=>{if(e===tt||e===et||"type"===e)return!0;const i=n[e];return t!==i&&!(Array.isArray(t)&&Array.isArray(i)&&0===t.length&&0===i.length)}))}toString(){return"#<".concat(this.constructor.type,">")}static _fromObject(t){let e=O(t,ci),n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},{extraParam:i}=n,s=O(n,li);return le(e,s).then((t=>i?(delete t[i],new this(e[i],t)):new this(t)))}static fromObject(t,e){return this._fromObject(t,e)}};E(ui,"stateProperties",Wn),E(ui,"cacheProperties",Yn),E(ui,"ownDefaults",Un),E(ui,"type","FabricObject"),E(ui,"colorProperties",[Ct,bt,"backgroundColor"]),E(ui,"customProperties",[]),Tt.setClass(ui),Tt.setClass(ui,"object");const di=(t,e,n)=>(i,s,r,o)=>{const a=e(i,s,r,o);return a&&Xe(t,A(A({},Qe(i,s,r,o)),n)),a};function gi(t){return(e,n,i,s)=>{const{target:r,originX:o,originY:a}=n,h=r.getRelativeCenterPoint(),c=r.translateToOriginPoint(h,o,a),l=t(e,n,i,s);return r.setPositionByOrigin(c,n.originX,n.originY),l}}const pi=di(ut,gi(((t,e,n,i)=>{const s=Ze(e,e.originX,e.originY,n,i);if(Ve(e.originX)===Ve($)||Ve(e.originX)===Ve(it)&&s.x<0||Ve(e.originX)===Ve(tt)&&s.x>0){const{target:t}=e,n=t.strokeWidth/(t.strokeUniform?t.scaleX:1),i=ze(e)?2:1,r=t.width,o=Math.abs(s.x*i/t.scaleX)-n;return t.set("width",Math.max(o,1)),r!==t.width}return!1})));function fi(t,e,n,i,s){i=i||{};const r=this.sizeX||i.cornerSize||s.cornerSize,o=this.sizeY||i.cornerSize||s.cornerSize,a=void 0!==i.transparentCorners?i.transparentCorners:s.transparentCorners,h=a?bt:Ct,c=!a&&(i.cornerStrokeColor||s.cornerStrokeColor);let l,u=e,d=n;t.save(),t.fillStyle=i.cornerColor||s.cornerColor||"",t.strokeStyle=i.cornerStrokeColor||s.cornerStrokeColor||"",r>o?(l=r,t.scale(1,o/r),d=n*r/o):o>r?(l=o,t.scale(r/o,1),u=e*o/r):l=r,t.beginPath(),t.arc(u,d,l/2,0,q,!1),t[h](),c&&t.stroke(),t.restore()}function mi(t,e,n,i,s){i=i||{};const r=this.sizeX||i.cornerSize||s.cornerSize,o=this.sizeY||i.cornerSize||s.cornerSize,a=void 0!==i.transparentCorners?i.transparentCorners:s.transparentCorners,h=a?bt:Ct,c=!a&&(i.cornerStrokeColor||s.cornerStrokeColor),l=r/2,u=o/2;t.save(),t.fillStyle=i.cornerColor||s.cornerColor||"",t.strokeStyle=i.cornerStrokeColor||s.cornerStrokeColor||"",t.translate(e,n);const d=s.getTotalAngle();t.rotate(Vt(d)),t["".concat(h,"Rect")](-l,-u,r,o),c&&t.strokeRect(-l,-u,r,o),t.restore()}class _i{constructor(t){E(this,"visible",!0),E(this,"actionName",ft),E(this,"angle",0),E(this,"x",0),E(this,"y",0),E(this,"offsetX",0),E(this,"offsetY",0),E(this,"sizeX",0),E(this,"sizeY",0),E(this,"touchSizeX",0),E(this,"touchSizeY",0),E(this,"cursorStyle","crosshair"),E(this,"withConnection",!1),Object.assign(this,t)}shouldActivate(t,e,n,i){var s;let{tl:r,tr:o,br:a,bl:h}=i;return(null===(s=e.canvas)||void 0===s?void 0:s.getActiveObject())===e&&e.isControlVisible(t)&&ai.isPointInPolygon(n,[r,o,a,h])}getActionHandler(t,e,n){return this.actionHandler}getMouseDownHandler(t,e,n){return this.mouseDownHandler}getMouseUpHandler(t,e,n){return this.mouseUpHandler}cursorStyleHandler(t,e,n){return e.cursorStyle}getActionName(t,e,n){return e.actionName}getVisibility(t,e){var n,i;return null!==(n=null===(i=t._controlsVisibility)||void 0===i?void 0:i[e])&&void 0!==n?n:this.visible}setVisibility(t,e,n){this.visible=t}positionHandler(t,e,n,i){return new It(this.x*t.x+this.offsetX,this.y*t.y+this.offsetY).transform(e)}calcCornerCoords(t,e,n,i,s,r){const o=Jt([te(n,i),ee({angle:t}),ne((s?this.touchSizeX:this.sizeX)||e,(s?this.touchSizeY:this.sizeY)||e)]);return{tl:new It(-.5,-.5).transform(o),tr:new It(.5,-.5).transform(o),br:new It(.5,.5).transform(o),bl:new It(-.5,.5).transform(o)}}render(t,e,n,i,s){"circle"===((i=i||{}).cornerStyle||s.cornerStyle)?fi.call(this,t,e,n,i,s):mi.call(this,t,e,n,i,s)}}const vi=(t,e,n)=>n.lockRotation?He:e.cursorStyle,yi=di(ht,gi(((t,e,n,i)=>{let{target:s,ex:r,ey:o,theta:a,originX:h,originY:c}=e;const l=s.translateToOriginPoint(s.getRelativeCenterPoint(),h,c);if(Ke(s,"lockRotation"))return!1;const u=Math.atan2(o-l.y,r-l.x),d=Math.atan2(i-l.y,n-l.x);let g=Ht(d-u+a);if(s.snapAngle&&s.snapAngle>0){const t=s.snapAngle,e=s.snapThreshold||t,n=Math.ceil(g/t)*t,i=Math.floor(g/t)*t;Math.abs(g-i)<e?g=i:Math.abs(g-n)<e&&(g=n)}g<0&&(g=360+g),g%=360;const p=s.angle!==g;return s.angle=g,p})));function Ci(t,e){const n=e.canvas,i=t[n.uniScaleKey];return n.uniformScaling&&!i||!n.uniformScaling&&i}function bi(t,e,n){const i=Ke(t,"lockScalingX"),s=Ke(t,"lockScalingY");if(i&&s)return!0;if(!e&&(i||s)&&n)return!0;if(i&&"x"===e)return!0;if(s&&"y"===e)return!0;const{width:r,height:o,strokeWidth:a}=t;return 0===r&&0===a&&"y"!==e||0===o&&0===a&&"x"!==e}const wi=["e","se","s","sw","w","nw","n","ne","e"],xi=(t,e,n)=>{const i=Ci(t,n);if(bi(n,0!==e.x&&0===e.y?"x":0===e.x&&0!==e.y?"y":"",i))return He;const s=Je(n,e);return"".concat(wi[s],"-resize")};function Si(t,e,n,i){let s=arguments.length>4&&void 0!==arguments[4]?arguments[4]:{};const r=e.target,o=s.by,a=Ci(t,r);let h,c,l,u,d,g;if(bi(r,o,a))return!1;if(e.gestureScale)c=e.scaleX*e.gestureScale,l=e.scaleY*e.gestureScale;else{if(h=Ze(e,e.originX,e.originY,n,i),d="y"!==o?Math.sign(h.x||e.signX||1):1,g="x"!==o?Math.sign(h.y||e.signY||1):1,e.signX||(e.signX=d),e.signY||(e.signY=g),Ke(r,"lockScalingFlip")&&(e.signX!==d||e.signY!==g))return!1;if(u=r._getTransformedDimensions(),a&&!o){const t=Math.abs(h.x)+Math.abs(h.y),{original:n}=e,i=t/(Math.abs(u.x*n.scaleX/r.scaleX)+Math.abs(u.y*n.scaleY/r.scaleY));c=n.scaleX*i,l=n.scaleY*i}else c=Math.abs(h.x*r.scaleX/u.x),l=Math.abs(h.y*r.scaleY/u.y);ze(e)&&(c*=2,l*=2),e.signX!==d&&"y"!==o&&(e.originX=qe(e.originX),c*=-1,e.signX=d),e.signY!==g&&"x"!==o&&(e.originY=qe(e.originY),l*=-1,e.signY=g)}const p=r.scaleX,f=r.scaleY;return o?("x"===o&&r.set(mt,c),"y"===o&&r.set(_t,l)):(!Ke(r,"lockScalingX")&&r.set(mt,c),!Ke(r,"lockScalingY")&&r.set(_t,l)),p!==r.scaleX||f!==r.scaleY}const Ti=di(at,gi(((t,e,n,i)=>Si(t,e,n,i)))),Ei=di(at,gi(((t,e,n,i)=>Si(t,e,n,i,{by:"x"})))),ki=di(at,gi(((t,e,n,i)=>Si(t,e,n,i,{by:"y"})))),Ai=["target","ex","ey","skewingSide"],Oi={x:{counterAxis:"y",scale:mt,skew:vt,lockSkewing:"lockSkewingX",origin:"originX",flip:"flipX"},y:{counterAxis:"x",scale:_t,skew:yt,lockSkewing:"lockSkewingY",origin:"originY",flip:"flipY"}},Di=["ns","nesw","ew","nwse"],Ii=(t,e,n)=>{if(0!==e.x&&Ke(n,"lockSkewingY"))return He;if(0!==e.y&&Ke(n,"lockSkewingX"))return He;const i=Je(n,e)%4;return"".concat(Di[i],"-resize")};function Pi(t,e,n,i,s){const{target:r}=n,{counterAxis:o,origin:a,lockSkewing:h,skew:c,flip:l}=Oi[t];if(Ke(r,h))return!1;const{origin:u,flip:d}=Oi[o],g=Ve(n[u])*(r[d]?-1:1),p=-Math.sign(g)*(r[l]?-1:1),f=-(0===r[c]&&Ze(n,$,$,i,s)[t]>0||r[c]>0?1:-1)*p*.5+.5,m=di(lt,gi(((e,n,i,s)=>function(t,e,n){let{target:i,ex:s,ey:r,skewingSide:o}=e,a=O(e,Ai);const{skew:h}=Oi[t],c=n.subtract(new It(s,r)).divide(new It(i.scaleX,i.scaleY))[t],l=i[h],u=a[h],d=Math.tan(Vt(u)),g="y"===t?i._getTransformedDimensions({scaleX:1,scaleY:1,skewX:0}).x:i._getTransformedDimensions({scaleX:1,scaleY:1}).y,p=2*c*o/Math.max(g,1)+d,f=Ht(Math.atan(p));i.set(h,f);const m=l!==i[h];if(m&&"y"===t){const{skewX:t,scaleX:e}=i,n=i._getTransformedDimensions({skewY:l}),s=i._getTransformedDimensions(),r=0!==t?n.x/s.x:1;1!==r&&i.set(mt,r*e)}return m}(t,n,new It(i,s)))));return m(e,A(A({},n),{},{[a]:f,skewingSide:p}),i,s)}const Mi=(t,e,n,i)=>Pi("x",t,e,n,i),Ri=(t,e,n,i)=>Pi("y",t,e,n,i);function Fi(t,e){return t[e.canvas.altActionKey]}const Li=(t,e,n)=>{const i=Fi(t,n);return 0===e.x?i?vt:_t:0===e.y?i?yt:mt:""},ji=(t,e,n)=>Fi(t,n)?Ii(0,e,n):xi(t,e,n),Ni=(t,e,n,i)=>Fi(t,e.target)?Ri(t,e,n,i):Ei(t,e,n,i),Bi=(t,e,n,i)=>Fi(t,e.target)?Mi(t,e,n,i):ki(t,e,n,i),Wi=()=>({ml:new _i({x:-.5,y:0,cursorStyleHandler:ji,actionHandler:Ni,getActionName:Li}),mr:new _i({x:.5,y:0,cursorStyleHandler:ji,actionHandler:Ni,getActionName:Li}),mb:new _i({x:0,y:.5,cursorStyleHandler:ji,actionHandler:Bi,getActionName:Li}),mt:new _i({x:0,y:-.5,cursorStyleHandler:ji,actionHandler:Bi,getActionName:Li}),tl:new _i({x:-.5,y:-.5,cursorStyleHandler:xi,actionHandler:Ti}),tr:new _i({x:.5,y:-.5,cursorStyleHandler:xi,actionHandler:Ti}),bl:new _i({x:-.5,y:.5,cursorStyleHandler:xi,actionHandler:Ti}),br:new _i({x:.5,y:.5,cursorStyleHandler:xi,actionHandler:Ti}),mtr:new _i({x:0,y:-.5,actionHandler:yi,cursorStyleHandler:vi,offsetY:-40,withConnection:!0,actionName:ct})}),Yi=()=>({mr:new _i({x:.5,y:0,actionHandler:pi,cursorStyleHandler:ji,actionName:ut}),ml:new _i({x:-.5,y:0,actionHandler:pi,cursorStyleHandler:ji,actionName:ut})}),Ui=()=>A(A({},Wi()),Yi());class Xi extends ui{static getDefaults(){return A(A({},super.getDefaults()),Xi.ownDefaults)}constructor(t){super(),Object.assign(this,this.constructor.createControls(),Xi.ownDefaults),this.setOptions(t)}static createControls(){return{controls:Wi()}}_updateCacheCanvas(){const t=this.canvas;if(this.noScaleCache&&t&&t._currentTransform){const e=t._currentTransform,n=e.target,i=e.action;if(this===n&&i&&i.startsWith(ft))return!1}return super._updateCacheCanvas()}getActiveControl(){const t=this.__corner;return t?{key:t,control:this.controls[t],coord:this.oCoords[t]}:void 0}findControl(t){let e=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(!this.hasControls||!this.canvas)return;this.__corner=void 0;const n=Object.entries(this.oCoords);for(let i=n.length-1;i>=0;i--){const[s,r]=n[i],o=this.controls[s];if(o.shouldActivate(s,this,t,e?r.touchCorner:r.corner))return this.__corner=s,{key:s,control:o,coord:this.oCoords[s]}}}calcOCoords(){const t=this.getViewportTransform(),e=this.getCenterPoint(),n=te(e.x,e.y),i=ee({angle:this.getTotalAngle()-(this.group&&this.flipX?180:0)}),s=Qt(n,i),r=Qt(t,s),o=Qt(r,[1/t[0],0,0,1/t[3],0,0]),a=this.group?$t(this.calcTransformMatrix()):void 0;a&&(a.scaleX=Math.abs(a.scaleX),a.scaleY=Math.abs(a.scaleY));const h=this._calculateCurrentDimensions(a),c={};return this.forEachControl(((t,e)=>{const n=t.positionHandler(h,o,this,t);c[e]=Object.assign(n,this._calcCornerCoords(t,n))})),c}_calcCornerCoords(t,e){const n=this.getTotalAngle();return{corner:t.calcCornerCoords(n,this.cornerSize,e.x,e.y,!1,this),touchCorner:t.calcCornerCoords(n,this.touchCornerSize,e.x,e.y,!0,this)}}setCoords(){super.setCoords(),this.canvas&&(this.oCoords=this.calcOCoords())}forEachControl(t){for(const e in this.controls)t(this.controls[e],e,this)}drawSelectionBackground(t){if(!this.selectionBackgroundColor||this.canvas&&this.canvas._activeObject!==this)return;t.save();const e=this.getRelativeCenterPoint(),n=this._calculateCurrentDimensions(),i=this.getViewportTransform();t.translate(e.x,e.y),t.scale(1/i[0],1/i[3]),t.rotate(Vt(this.angle)),t.fillStyle=this.selectionBackgroundColor,t.fillRect(-n.x/2,-n.y/2,n.x,n.y),t.restore()}strokeBorders(t,e){t.strokeRect(-e.x/2,-e.y/2,e.x,e.y)}_drawBorders(t,e){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};const i=A({hasControls:this.hasControls,borderColor:this.borderColor,borderDashArray:this.borderDashArray},n);t.save(),t.strokeStyle=i.borderColor,this._setLineDash(t,i.borderDashArray),this.strokeBorders(t,e),i.hasControls&&this.drawControlsConnectingLines(t,e),t.restore()}_renderControls(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const{hasBorders:n,hasControls:i}=this,s=A({hasBorders:n,hasControls:i},e),r=this.getViewportTransform(),o=s.hasBorders,a=s.hasControls,h=Qt(r,this.calcTransformMatrix()),c=$t(h);t.save(),t.translate(c.translateX,c.translateY),t.lineWidth=this.borderScaleFactor,this.group===this.parent&&(t.globalAlpha=this.isMoving?this.borderOpacityWhenMoving:1),this.flipX&&(c.angle-=180),t.rotate(Vt(this.group?c.angle:this.angle)),o&&this.drawBorders(t,c,e),a&&this.drawControls(t,e),t.restore()}drawBorders(t,e,n){let i;if(n&&n.forActiveSelection||this.group){const t=Ne(this.width,this.height,oe(e)),n=this.isStrokeAccountedForInDimensions()?Pt:(this.strokeUniform?(new It).scalarAdd(this.canvas?this.canvas.getZoom():1):new It(e.scaleX,e.scaleY)).scalarMultiply(this.strokeWidth);i=t.add(n).scalarAdd(this.borderScaleFactor).scalarAdd(2*this.padding)}else i=this._calculateCurrentDimensions().scalarAdd(this.borderScaleFactor);this._drawBorders(t,i,n)}drawControlsConnectingLines(t,e){let n=!1;t.beginPath(),this.forEachControl(((i,s)=>{i.withConnection&&i.getVisibility(this,s)&&(n=!0,t.moveTo(i.x*e.x,i.y*e.y),t.lineTo(i.x*e.x+i.offsetX,i.y*e.y+i.offsetY))})),n&&t.stroke()}drawControls(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};t.save();const n=this.getCanvasRetinaScaling(),{cornerStrokeColor:i,cornerDashArray:s,cornerColor:r}=this,o=A({cornerStrokeColor:i,cornerDashArray:s,cornerColor:r},e);t.setTransform(n,0,0,n,0,0),t.strokeStyle=t.fillStyle=o.cornerColor,this.transparentCorners||(t.strokeStyle=o.cornerStrokeColor),this._setLineDash(t,o.cornerDashArray),this.forEachControl(((e,n)=>{if(e.getVisibility(this,n)){const i=this.oCoords[n];e.render(t,i.x,i.y,o,this)}})),t.restore()}isControlVisible(t){return this.controls[t]&&this.controls[t].getVisibility(this,t)}setControlVisible(t,e){this._controlsVisibility||(this._controlsVisibility={}),this._controlsVisibility[t]=e}setControlsVisibility(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};Object.entries(t).forEach((t=>{let[e,n]=t;return this.setControlVisible(e,n)}))}clearContextTop(t){if(!this.canvas)return;const e=this.canvas.contextTop;if(!e)return;const n=this.canvas.viewportTransform;e.save(),e.transform(n[0],n[1],n[2],n[3],n[4],n[5]),this.transform(e);const i=this.width+4,s=this.height+4;return e.clearRect(-i/2,-s/2,i,s),t||e.restore(),e}onDeselect(t){return!1}onSelect(t){return!1}shouldStartDragging(t){return!1}onDragStart(t){return!1}canDrop(t){return!1}renderDragSourceEffect(t){}renderDropTargetEffect(t){}}function Gi(t,e){return e.forEach((e=>{Object.getOwnPropertyNames(e.prototype).forEach((n=>{"constructor"!==n&&Object.defineProperty(t.prototype,n,Object.getOwnPropertyDescriptor(e.prototype,n)||Object.create(null))}))})),t}E(Xi,"ownDefaults",{noScaleCache:!0,lockMovementX:!1,lockMovementY:!1,lockRotation:!1,lockScalingX:!1,lockScalingY:!1,lockSkewingX:!1,lockSkewingY:!1,lockScalingFlip:!1,cornerSize:13,touchCornerSize:24,transparentCorners:!0,cornerColor:"rgb(178,204,255)",cornerStrokeColor:"",cornerStyle:"rect",cornerDashArray:null,hasControls:!0,borderColor:"rgb(178,204,255)",borderDashArray:null,borderOpacityWhenMoving:.4,borderScaleFactor:1,hasBorders:!0,selectionBackgroundColor:"",selectable:!0,evented:!0,perPixelTargetFind:!1,activeOn:"down",hoverCursor:null,moveCursor:null});class Vi extends Xi{}Gi(Vi,[un]),Tt.setClass(Vi),Tt.setClass(Vi,"object");const Hi=(t,e,n,i)=>{const s=2*(i=Math.round(i))+1,{data:r}=t.getImageData(e-i,n-i,s,s);for(let o=3;o<r.length;o+=4)if(r[o]>0)return!1;return!0};class zi{constructor(t){this.options=t,this.strokeProjectionMagnitude=this.options.strokeWidth/2,this.scale=new It(this.options.scaleX,this.options.scaleY),this.strokeUniformScalar=this.options.strokeUniform?new It(1/this.options.scaleX,1/this.options.scaleY):new It(1,1)}createSideVector(t,e){const n=kn(t,e);return this.options.strokeUniform?n.multiply(this.scale):n}projectOrthogonally(t,e,n){return this.applySkew(t.add(this.calcOrthogonalProjection(t,e,n)))}isSkewed(){return 0!==this.options.skewX||0!==this.options.skewY}applySkew(t){const e=new It(t);return e.y+=e.x*Math.tan(Vt(this.options.skewY)),e.x+=e.y*Math.tan(Vt(this.options.skewX)),e}scaleUnitVector(t,e){return t.multiply(this.strokeUniformScalar).scalarMultiply(e)}}const qi=new It;class Ki extends zi{static getOrthogonalRotationFactor(t,e){const n=e?On(t,e):Dn(t);return Math.abs(n)<z?-1:1}constructor(t,e,n,i){super(i),E(this,"AB",void 0),E(this,"AC",void 0),E(this,"alpha",void 0),E(this,"bisector",void 0),this.A=new It(t),this.B=new It(e),this.C=new It(n),this.AB=this.createSideVector(this.A,this.B),this.AC=this.createSideVector(this.A,this.C),this.alpha=On(this.AB,this.AC),this.bisector=In(En(this.AB.eq(qi)?this.AC:this.AB,this.alpha/2))}calcOrthogonalProjection(t,e){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:this.strokeProjectionMagnitude;const i=this.createSideVector(t,e),s=Pn(i),r=Ki.getOrthogonalRotationFactor(s,this.bisector);return this.scaleUnitVector(s,n*r)}projectBevel(){const t=[];return(this.alpha%q==0?[this.B]:[this.B,this.C]).forEach((e=>{t.push(this.projectOrthogonally(this.A,e)),t.push(this.projectOrthogonally(this.A,e,-this.strokeProjectionMagnitude))})),t}projectMiter(){const t=[],e=Math.abs(this.alpha),n=1/Math.sin(e/2),i=this.scaleUnitVector(this.bisector,-this.strokeProjectionMagnitude*n),s=this.options.strokeUniform?An(this.scaleUnitVector(this.bisector,this.options.strokeMiterLimit)):this.options.strokeMiterLimit;return An(i)/this.strokeProjectionMagnitude<=s&&t.push(this.applySkew(this.A.add(i))),t.push(...this.projectBevel()),t}projectRoundNoSkew(t,e){const n=[],i=new It(Ki.getOrthogonalRotationFactor(this.bisector),Ki.getOrthogonalRotationFactor(new It(this.bisector.y,this.bisector.x)));return[new It(1,0).scalarMultiply(this.strokeProjectionMagnitude).multiply(this.strokeUniformScalar).multiply(i),new It(0,1).scalarMultiply(this.strokeProjectionMagnitude).multiply(this.strokeUniformScalar).multiply(i)].forEach((i=>{Fn(i,t,e)&&n.push(this.A.add(i))})),n}projectRoundWithSkew(t,e){const n=[],{skewX:i,skewY:s,scaleX:r,scaleY:o,strokeUniform:a}=this.options,h=new It(Math.tan(Vt(i)),Math.tan(Vt(s))),c=this.strokeProjectionMagnitude,l=a?c/o/Math.sqrt(1/o**2+1/r**2*h.y**2):c/Math.sqrt(1+h.y**2),u=new It(Math.sqrt(Math.max(c**2-l**2,0)),l),d=a?c/Math.sqrt(1+h.x**2*(1/o)**2/(1/r+1/r*h.x*h.y)**2):c/Math.sqrt(1+h.x**2/(1+h.x*h.y)**2),g=new It(d,Math.sqrt(Math.max(c**2-d**2,0)));return[g,g.scalarMultiply(-1),u,u.scalarMultiply(-1)].map((t=>this.applySkew(a?t.multiply(this.strokeUniformScalar):t))).forEach((i=>{Fn(i,t,e)&&n.push(this.applySkew(this.A).add(i))})),n}projectRound(){const t=[];t.push(...this.projectBevel());const e=this.alpha%q==0,n=this.applySkew(this.A),i=t[e?0:2].subtract(n),s=t[e?1:0].subtract(n),r=e?this.applySkew(this.AB.scalarMultiply(-1)):this.applySkew(this.bisector.multiply(this.strokeUniformScalar).scalarMultiply(-1)),o=Mn(i,r)>0,a=o?i:s,h=o?s:i;return this.isSkewed()?t.push(...this.projectRoundWithSkew(a,h)):t.push(...this.projectRoundNoSkew(a,h)),t}projectPoints(){switch(this.options.strokeLineJoin){case"miter":return this.projectMiter();case"round":return this.projectRound();default:return this.projectBevel()}}project(){return this.projectPoints().map((t=>({originPoint:this.A,projectedPoint:t,angle:this.alpha,bisector:this.bisector})))}}class Qi extends zi{constructor(t,e,n){super(n),this.A=new It(t),this.T=new It(e)}calcOrthogonalProjection(t,e){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:this.strokeProjectionMagnitude;const i=this.createSideVector(t,e);return this.scaleUnitVector(Pn(i),n)}projectButt(){return[this.projectOrthogonally(this.A,this.T,this.strokeProjectionMagnitude),this.projectOrthogonally(this.A,this.T,-this.strokeProjectionMagnitude)]}projectRound(){const t=[];if(!this.isSkewed()&&this.A.eq(this.T)){const e=new It(1,1).scalarMultiply(this.strokeProjectionMagnitude).multiply(this.strokeUniformScalar);t.push(this.applySkew(this.A.add(e)),this.applySkew(this.A.subtract(e)))}else t.push(...new Ki(this.A,this.T,this.T,this.options).projectRound());return t}projectSquare(){const t=[];if(this.A.eq(this.T)){const e=new It(1,1).scalarMultiply(this.strokeProjectionMagnitude).multiply(this.strokeUniformScalar);t.push(this.A.add(e),this.A.subtract(e))}else{const e=this.calcOrthogonalProjection(this.A,this.T,this.strokeProjectionMagnitude),n=this.scaleUnitVector(In(this.createSideVector(this.A,this.T)),-this.strokeProjectionMagnitude),i=this.A.add(n);t.push(i.add(e),i.subtract(e))}return t.map((t=>this.applySkew(t)))}projectPoints(){switch(this.options.strokeLineCap){case"round":return this.projectRound();case"square":return this.projectSquare();default:return this.projectButt()}}project(){return this.projectPoints().map((t=>({originPoint:this.A,projectedPoint:t})))}}const Ji=function(t,e){let n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const i=[];if(0===t.length)return i;const s=t.reduce(((t,e)=>(t[t.length-1].eq(e)||t.push(new It(e)),t)),[new It(t[0])]);if(1===s.length)n=!0;else if(!n){const t=s[0],e=((t,e)=>{for(let n=t.length-1;n>=0;n--)if(e(t[n],n,t))return n;return-1})(s,(e=>!e.eq(t)));s.splice(e+1)}return s.forEach(((t,s,r)=>{let o,a;0===s?(a=r[1],o=n?t:r[r.length-1]):s===r.length-1?(o=r[s-1],a=n?t:r[0]):(o=r[s-1],a=r[s+1]),n&&1===r.length?i.push(...new Qi(t,t,e).project()):!n||0!==s&&s!==r.length-1?i.push(...new Ki(t,o,a,e).project()):i.push(...new Qi(t,0===s?a:o,e).project())})),i},Zi=t=>{const e={};return Object.keys(t).forEach((n=>{e[n]={},Object.keys(t[n]).forEach((i=>{e[n][i]=A({},t[n][i])}))})),e},$i=t=>t.replace(/&/g,"&amp;").replace(/"/g,"&quot;").replace(/'/g,"&apos;").replace(/</g,"&lt;").replace(/>/g,"&gt;");let ts;const es=t=>{if(ts||ts||(ts="Intl"in U()&&"Segmenter"in Intl&&new Intl.Segmenter(void 0,{granularity:"grapheme"})),ts){const e=ts.segment(t);return Array.from(e).map((t=>{let{segment:e}=t;return e}))}return ns(t)},ns=t=>{const e=[];for(let n,i=0;i<t.length;i++)!1!==(n=is(t,i))&&e.push(n);return e},is=(t,e)=>{const n=t.charCodeAt(e);if(isNaN(n))return"";if(n<55296||n>57343)return t.charAt(e);if(55296<=n&&n<=56319){if(t.length<=e+1)throw"High surrogate without following low surrogate";const n=t.charCodeAt(e+1);if(56320>n||n>57343)throw"High surrogate without following low surrogate";return t.charAt(e)+t.charAt(e+1)}if(0===e)throw"Low surrogate without preceding high surrogate";const i=t.charCodeAt(e-1);if(55296>i||i>56319)throw"Low surrogate without preceding high surrogate";return!1};var ss=Object.freeze({__proto__:null,capitalize:function(t){let e=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return"".concat(t.charAt(0).toUpperCase()).concat(e?t.slice(1):t.slice(1).toLowerCase())},escapeXml:$i,graphemeSplit:es});const rs=function(t,e){let n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];return t.fill!==e.fill||t.stroke!==e.stroke||t.strokeWidth!==e.strokeWidth||t.fontSize!==e.fontSize||t.fontFamily!==e.fontFamily||t.fontWeight!==e.fontWeight||t.fontStyle!==e.fontStyle||t.textBackgroundColor!==e.textBackgroundColor||t.deltaY!==e.deltaY||n&&(t.overline!==e.overline||t.underline!==e.underline||t.linethrough!==e.linethrough)},os=(t,e)=>{const n=e.split("\n"),i=[];let s=-1,r={};t=Zi(t);for(let o=0;o<n.length;o++){const e=es(n[o]);if(t[o])for(let n=0;n<e.length;n++){s++;const e=t[o][n];e&&Object.keys(e).length>0&&(rs(r,e,!0)?i.push({start:s,end:s+1,style:e}):i[i.length-1].end++),r=e||{}}else s+=e.length,r={}}return i},as=(t,e)=>{if(!Array.isArray(t))return Zi(t);const n=e.split(rt),i={};let s=-1,r=0;for(let o=0;o<n.length;o++){const e=es(n[o]);for(let n=0;n<e.length;n++)s++,t[r]&&t[r].start<=s&&s<t[r].end&&(i[o]=i[o]||{},i[o][n]=A({},t[r].style),s===t[r].end-1&&r++)}return i},hs=["display","transform",Ct,"fill-opacity","fill-rule","opacity",bt,"stroke-dasharray","stroke-linecap","stroke-dashoffset","stroke-linejoin","stroke-miterlimit","stroke-opacity","stroke-width","id","paint-order","vector-effect","instantiated_by_use","clip-path"];function cs(t,e){const n=t.nodeName,i=t.getAttribute("class"),s=t.getAttribute("id"),r="(?![a-zA-Z\\-]+)";let o;if(o=new RegExp("^"+n,"i"),e=e.replace(o,""),s&&e.length&&(o=new RegExp("#"+s+r,"i"),e=e.replace(o,"")),i&&e.length){const t=i.split(" ");for(let n=t.length;n--;)o=new RegExp("\\."+t[n]+r,"i"),e=e.replace(o,"")}return 0===e.length}function ls(t,e){let n=!0;const i=cs(t,e.pop());return i&&e.length&&(n=function(t,e){let n,i=!0;for(;t.parentElement&&1===t.parentElement.nodeType&&e.length;)i&&(n=e.pop()),i=cs(t=t.parentElement,n);return 0===e.length}(t,e)),i&&n&&0===e.length}const us=t=>{var e;return null!==(e=_n[t])&&void 0!==e?e:t},ds=new RegExp("(".concat(pn,")"),"gi"),gs=t=>t.replace(ds," $1 ").replace(/,/gi," ").replace(/\s+/gi," ");var ps,fs,ms,_s,vs,ys,Cs;const bs="(".concat(pn,")"),ws=String.raw(ps||(ps=D(["(skewX)(",")"],["(skewX)\\(","\\)"])),bs),xs=String.raw(fs||(fs=D(["(skewY)(",")"],["(skewY)\\(","\\)"])),bs),Ss=String.raw(ms||(ms=D(["(rotate)(","(?: "," ",")?)"],["(rotate)\\(","(?: "," ",")?\\)"])),bs,bs,bs),Ts=String.raw(_s||(_s=D(["(scale)(","(?: ",")?)"],["(scale)\\(","(?: ",")?\\)"])),bs,bs),Es=String.raw(vs||(vs=D(["(translate)(","(?: ",")?)"],["(translate)\\(","(?: ",")?\\)"])),bs,bs),ks=String.raw(ys||(ys=D(["(matrix)("," "," "," "," "," ",")"],["(matrix)\\("," "," "," "," "," ","\\)"])),bs,bs,bs,bs,bs,bs),As="(?:".concat(ks,"|").concat(Es,"|").concat(Ss,"|").concat(Ts,"|").concat(ws,"|").concat(xs,")"),Os="(?:".concat(As,"*)"),Ds=String.raw(Cs||(Cs=D(["^s*(?:","?)s*$"],["^\\s*(?:","?)\\s*$"])),Os),Is=new RegExp(Ds),Ps=new RegExp(As),Ms=new RegExp(As,"g");function Rs(t){const e=[];if(!(t=gs(t).replace(/\s*([()])\s*/gi,"$1"))||t&&!Is.test(t))return[...Q];for(const n of t.matchAll(Ms)){const t=Ps.exec(n[0]);if(!t)continue;let i=Q;const s=t.filter((t=>!!t)),[,r,...o]=s,[a,h,c,l,u,d]=o.map((t=>parseFloat(t)));switch(r){case"translate":i=te(a,h);break;case ct:i=ee({angle:a},{x:h,y:c});break;case ft:i=ne(a,h);break;case vt:i=se(a);break;case yt:i=re(a);break;case"matrix":i=[a,h,c,l,u,d]}e.push(i)}return Jt(e)}function Fs(t,e,n,i){const s=Array.isArray(e);let r,o=e;if(t!==Ct&&t!==bt||e!==st){if("strokeUniform"===t)return"non-scaling-stroke"===e;if("strokeDashArray"===t)o=e===st?null:e.replace(/,/g," ").split(/\s+/).map(parseFloat);else if("transformMatrix"===t)o=n&&n.transformMatrix?Qt(n.transformMatrix,Rs(e)):Rs(e);else if("visible"===t)o=e!==st&&"hidden"!==e,n&&!1===n.visible&&(o=!1);else if("opacity"===t)o=parseFloat(e),n&&void 0!==n.opacity&&(o*=n.opacity);else if("textAnchor"===t)o="start"===e?tt:"end"===e?it:$;else if("charSpacing"===t)r=hn(e,i)/i*1e3;else if("paintFirst"===t){const t=e.indexOf(Ct),n=e.indexOf(bt);o=Ct,(t>-1&&n>-1&&n<t||-1===t&&n>-1)&&(o=bt)}else{if("href"===t||"xlink:href"===t||"font"===t||"id"===t)return e;if("imageSmoothing"===t)return"optimizeQuality"===e;r=s?e.map(hn):hn(e,i)}}else o="";return!s&&isNaN(r)?o:r}function Ls(t,e){const n=t.match(mn);if(!n)return;const i=n[1],s=n[3],r=n[4],o=n[5],a=n[6];i&&(e.fontStyle=i),s&&(e.fontWeight=isNaN(parseFloat(s))?s:parseFloat(s)),r&&(e.fontSize=hn(r)),a&&(e.fontFamily=a),o&&(e.lineHeight="normal"===o?1:o)}function js(t,e){t.replace(/;\s*$/,"").split(";").forEach((t=>{if(!t)return;const[n,i]=t.split(":");e[n.trim().toLowerCase()]=i.trim()}))}function Ns(t){const e={},n=t.getAttribute("style");return n?("string"==typeof n?js(n,e):function(t,e){Object.entries(t).forEach((t=>{let[n,i]=t;void 0!==i&&(e[n.toLowerCase()]=i)}))}(n,e),e):e}const Bs={stroke:"strokeOpacity",fill:"fillOpacity"};function Ws(t,e,n){if(!t)return{};let i,s={},r=J;t.parentNode&&wn.test(t.parentNode.nodeName)&&(s=Ws(t.parentElement,e,n),s.fontSize&&(i=r=hn(s.fontSize)));const o=A(A(A({},e.reduce(((e,n)=>{const i=t.getAttribute(n);return i&&(e[n]=i),e}),{})),function(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n={};for(const i in e)ls(t,i.split(" "))&&(n=A(A({},n),e[i]));return n}(t,n)),Ns(t));o[yn]&&t.setAttribute(yn,o[yn]),o[vn]&&(i=hn(o[vn],r),o[vn]="".concat(i));const a={};for(const c in o){const t=us(c),e=Fs(t,o[c],s,i);a[t]=e}a&&a.font&&Ls(a.font,a);const h=A(A({},s),a);return wn.test(t.nodeName)?h:function(t){const e=Vi.getDefaults();return Object.entries(Bs).forEach((n=>{let[i,s]=n;if(void 0===t[s]||""===t[i])return;if(void 0===t[i]){if(!e[i])return;t[i]=e[i]}if(0===t[i].indexOf("url("))return;const r=new an(t[i]);t[i]=r.setAlpha(ge(r.getAlpha()*t[s],2)).toRgba()})),t}(h)}const Ys=["left","top","width","height","visible"],Us=["rx","ry"];class Xs extends Vi{static getDefaults(){return A(A({},super.getDefaults()),Xs.ownDefaults)}constructor(t){super(),Object.assign(this,Xs.ownDefaults),this.setOptions(t),this._initRxRy()}_initRxRy(){const{rx:t,ry:e}=this;t&&!e?this.ry=t:e&&!t&&(this.rx=e)}_render(t){const{width:e,height:n}=this,i=-e/2,s=-n/2,r=this.rx?Math.min(this.rx,e/2):0,o=this.ry?Math.min(this.ry,n/2):0,a=0!==r||0!==o;t.beginPath(),t.moveTo(i+r,s),t.lineTo(i+e-r,s),a&&t.bezierCurveTo(i+e-Z*r,s,i+e,s+Z*o,i+e,s+o),t.lineTo(i+e,s+n-o),a&&t.bezierCurveTo(i+e,s+n-Z*o,i+e-Z*r,s+n,i+e-r,s+n),t.lineTo(i+r,s+n),a&&t.bezierCurveTo(i+Z*r,s+n,i,s+n-Z*o,i,s+n-o),t.lineTo(i,s+o),a&&t.bezierCurveTo(i,s+Z*o,i+Z*r,s,i+r,s),t.closePath(),this._renderPaintInOrder(t)}toObject(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];return super.toObject([...Us,...t])}_toSVG(){const{width:t,height:e,rx:n,ry:i}=this;return["<rect ","COMMON_PARTS",'x="'.concat(-t/2,'" y="').concat(-e/2,'" rx="').concat(n,'" ry="').concat(i,'" width="').concat(t,'" height="').concat(e,'" />\n')]}static async fromElement(t,e,n){const i=Ws(t,this.ATTRIBUTE_NAMES,n),{left:s=0,top:r=0,width:o=0,height:a=0,visible:h=!0}=i,c=O(i,Ys);return new this(A(A(A({},e),c),{},{left:s,top:r,width:o,height:a,visible:Boolean(h&&o&&a)}))}}E(Xs,"type","Rect"),E(Xs,"cacheProperties",[...Yn,...Us]),E(Xs,"ownDefaults",{rx:0,ry:0}),E(Xs,"ATTRIBUTE_NAMES",[...hs,"x","y","rx","ry","width","height"]),Tt.setClass(Xs),Tt.setSVGClass(Xs);const Gs="initialization",Vs="added",Hs="removed",zs="imperative",qs=(t,e)=>{const{strokeUniform:n,strokeWidth:i,width:s,height:r,group:o}=e,a=o&&o!==t?Be(o.calcTransformMatrix(),t.calcTransformMatrix()):null,h=a?e.getRelativeCenterPoint().transform(a):e.getRelativeCenterPoint(),c=!e.isStrokeAccountedForInDimensions(),l=n&&c?Ye(new It(i,i),void 0,t.calcTransformMatrix()):Pt,u=!n&&c?i:0,d=Ne(s+u,r+u,Jt([a,e.calcOwnMatrix()],!0)).add(l).scalarDivide(2);return[h.subtract(d),h.add(d)]};class Ks{calcLayoutResult(t,e){if(this.shouldPerformLayout(t))return this.calcBoundingBox(e,t)}shouldPerformLayout(t){let{type:e,prevStrategy:n,strategy:i}=t;return e===Gs||e===zs||!!n&&i!==n}shouldLayoutClipPath(t){let{type:e,target:{clipPath:n}}=t;return e!==Gs&&n&&!n.absolutePositioned}getInitialSize(t,e){return e.size}calcBoundingBox(t,e){const{type:n,target:i}=e;if(n===zs&&e.overrides)return e.overrides;if(0===t.length)return;const{left:s,top:r,width:o,height:a}=Pe(t.map((t=>qs(i,t))).reduce(((t,e)=>t.concat(e)),[])),h=new It(o,a),c=new It(s,r).add(h.scalarDivide(2));if(n===Gs){const t=this.getInitialSize(e,{size:h,center:c});return{center:c,relativeCorrection:new It(0,0),size:t}}return{center:c.transform(i.calcOwnMatrix()),size:h}}}E(Ks,"type","strategy");class Qs extends Ks{shouldPerformLayout(t){return!0}}E(Qs,"type","fit-content"),Tt.setClass(Qs);const Js=["strategy"],Zs=["target","strategy","bubbles","prevStrategy"],$s="layoutManager";class tr{constructor(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new Qs;E(this,"strategy",void 0),this.strategy=t,this._subscriptions=new Map}performLayout(t){const e=A(A({bubbles:!0,strategy:this.strategy},t),{},{prevStrategy:this._prevLayoutStrategy,stopPropagation(){this.bubbles=!1}});this.onBeforeLayout(e);const n=this.getLayoutResult(e);n&&this.commitLayout(e,n),this.onAfterLayout(e,n),this._prevLayoutStrategy=e.strategy}attachHandlers(t,e){const{target:n}=e;return[wt,ot,ut,ht,at,lt,pt,dt,gt].map((e=>t.on(e,(t=>this.performLayout(e===wt?{type:"object_modified",trigger:e,e:t,target:n}:{type:"object_modifying",trigger:e,e:t,target:n})))))}subscribe(t,e){this.unsubscribe(t,e);const n=this.attachHandlers(t,e);this._subscriptions.set(t,n)}unsubscribe(t,e){(this._subscriptions.get(t)||[]).forEach((t=>t())),this._subscriptions.delete(t)}unsubscribeTargets(t){t.targets.forEach((e=>this.unsubscribe(e,t)))}subscribeTargets(t){t.targets.forEach((e=>this.subscribe(e,t)))}onBeforeLayout(t){const{target:e,type:n}=t,{canvas:i}=e;if(n===Gs||n===Vs?this.subscribeTargets(t):n===Hs&&this.unsubscribeTargets(t),e.fire("layout:before",{context:t}),i&&i.fire("object:layout:before",{target:e,context:t}),n===zs&&t.deep){const n=O(t,Js);e.forEachObject((t=>t.layoutManager&&t.layoutManager.performLayout(A(A({},n),{},{bubbles:!1,target:t}))))}}getLayoutResult(t){const{target:e,strategy:n,type:i}=t,s=n.calcLayoutResult(t,e.getObjects());if(!s)return;const r=i===Gs?new It:e.getRelativeCenterPoint(),{center:o,correction:a=new It,relativeCorrection:h=new It}=s,c=r.subtract(o).add(a).transform(i===Gs?Q:Kt(e.calcOwnMatrix()),!0).add(h);return{result:s,prevCenter:r,nextCenter:o,offset:c}}commitLayout(t,e){const{target:n}=t,{result:{size:i},nextCenter:s}=e;var r,o;n.set({width:i.x,height:i.y}),this.layoutObjects(t,e),t.type===Gs?n.set({left:null!==(r=t.x)&&void 0!==r?r:s.x+i.x*Ve(n.originX),top:null!==(o=t.y)&&void 0!==o?o:s.y+i.y*Ve(n.originY)}):(n.setPositionByOrigin(s,$,$),n.setCoords(),n.set("dirty",!0))}layoutObjects(t,e){const{target:n}=t;n.forEachObject((i=>{i.group===n&&this.layoutObject(t,e,i)})),t.strategy.shouldLayoutClipPath(t)&&this.layoutObject(t,e,n.clipPath)}layoutObject(t,e,n){let{offset:i}=e;n.set({left:n.left+i.x,top:n.top+i.y})}onAfterLayout(t,e){const{target:n,strategy:i,bubbles:s,prevStrategy:r}=t,o=O(t,Zs),{canvas:a}=n;n.fire("layout:after",{context:t,result:e}),a&&a.fire("object:layout:after",{context:t,result:e,target:n});const h=n.parent;s&&null!=h&&h.layoutManager&&((o.path||(o.path=[])).push(n),h.layoutManager.performLayout(A(A({},o),{},{target:h}))),n.set("dirty",!0)}dispose(){const{_subscriptions:t}=this;t.forEach((t=>t.forEach((t=>t())))),t.clear()}toObject(){return{type:$s,strategy:this.strategy.constructor.type}}toJSON(){return this.toObject()}}Tt.setClass(tr,$s);const er=["type","objects","layoutManager"];class nr extends tr{performLayout(){}}class ir extends(Rt(Vi)){static getDefaults(){return A(A({},super.getDefaults()),ir.ownDefaults)}constructor(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};super(),E(this,"_activeObjects",[]),E(this,"__objectSelectionTracker",void 0),E(this,"__objectSelectionDisposer",void 0),Object.assign(this,ir.ownDefaults),this.setOptions(e),this.groupInit(t,e)}groupInit(t,e){var n;this._objects=[...t],this.__objectSelectionTracker=this.__objectSelectionMonitor.bind(this,!0),this.__objectSelectionDisposer=this.__objectSelectionMonitor.bind(this,!1),this.forEachObject((t=>{this.enterGroup(t,!1)})),this.layoutManager=null!==(n=e.layoutManager)&&void 0!==n?n:new tr,this.layoutManager.performLayout({type:Gs,target:this,targets:[...t],x:e.left,y:e.top})}canEnterGroup(t){return t===this||this.isDescendantOf(t)?(M("error","Group: circular object trees are not supported, this call has no effect"),!1):-1===this._objects.indexOf(t)||(M("error","Group: duplicate objects are not supported inside group, this call has no effect"),!1)}_filterObjectsBeforeEnteringGroup(t){return t.filter(((t,e,n)=>this.canEnterGroup(t)&&n.indexOf(t)===e))}add(){for(var t=arguments.length,e=new Array(t),n=0;n<t;n++)e[n]=arguments[n];const i=this._filterObjectsBeforeEnteringGroup(e),s=super.add(...i);return this._onAfterObjectsChange(Vs,i),s}insertAt(t){for(var e=arguments.length,n=new Array(e>1?e-1:0),i=1;i<e;i++)n[i-1]=arguments[i];const s=this._filterObjectsBeforeEnteringGroup(n),r=super.insertAt(t,...s);return this._onAfterObjectsChange(Vs,s),r}remove(){const t=super.remove(...arguments);return this._onAfterObjectsChange(Hs,t),t}_onObjectAdded(t){this.enterGroup(t,!0),this.fire("object:added",{target:t}),t.fire("added",{target:this})}_onObjectRemoved(t,e){this.exitGroup(t,e),this.fire("object:removed",{target:t}),t.fire("removed",{target:this})}_onAfterObjectsChange(t,e){this.layoutManager.performLayout({type:t,targets:e,target:this})}_onStackOrderChanged(){this._set("dirty",!0)}_set(t,e){const n=this[t];return super._set(t,e),"canvas"===t&&n!==e&&(this._objects||[]).forEach((n=>{n._set(t,e)})),this}_shouldSetNestedCoords(){return this.subTargetCheck}removeAll(){return this._activeObjects=[],this.remove(...this._objects)}__objectSelectionMonitor(t,e){let{target:n}=e;const i=this._activeObjects;if(t)i.push(n),this._set("dirty",!0);else if(i.length>0){const t=i.indexOf(n);t>-1&&(i.splice(t,1),this._set("dirty",!0))}}_watchObject(t,e){t&&this._watchObject(!1,e),t?(e.on("selected",this.__objectSelectionTracker),e.on("deselected",this.__objectSelectionDisposer)):(e.off("selected",this.__objectSelectionTracker),e.off("deselected",this.__objectSelectionDisposer))}enterGroup(t,e){t.group&&t.group.remove(t),t._set("parent",this),this._enterGroup(t,e)}_enterGroup(t,e){e&&Fe(t,Qt(Kt(this.calcTransformMatrix()),t.calcTransformMatrix())),this._shouldSetNestedCoords()&&t.setCoords(),t._set("group",this),t._set("canvas",this.canvas),this._watchObject(!0,t);const n=this.canvas&&this.canvas.getActiveObject&&this.canvas.getActiveObject();n&&(n===t||t.isDescendantOf(n))&&this._activeObjects.push(t)}exitGroup(t,e){this._exitGroup(t,e),t._set("parent",void 0),t._set("canvas",void 0)}_exitGroup(t,e){t._set("group",void 0),e||(Fe(t,Qt(this.calcTransformMatrix(),t.calcTransformMatrix())),t.setCoords()),this._watchObject(!1,t);const n=this._activeObjects.length>0?this._activeObjects.indexOf(t):-1;n>-1&&this._activeObjects.splice(n,1)}shouldCache(){const t=Vi.prototype.shouldCache.call(this);if(t)for(let e=0;e<this._objects.length;e++)if(this._objects[e].willDrawShadow())return this.ownCaching=!1,!1;return t}willDrawShadow(){if(super.willDrawShadow())return!0;for(let t=0;t<this._objects.length;t++)if(this._objects[t].willDrawShadow())return!0;return!1}isOnACache(){return this.ownCaching||!!this.parent&&this.parent.isOnACache()}drawObject(t,e,n){this._renderBackground(t);for(let s=0;s<this._objects.length;s++){var i;const e=this._objects[s];null!==(i=this.canvas)&&void 0!==i&&i.preserveObjectStacking&&e.group!==this?(t.save(),t.transform(...Kt(this.calcTransformMatrix())),e.render(t),t.restore()):e.group===this&&e.render(t)}this._drawClipPath(t,this.clipPath,n)}setCoords(){super.setCoords(),this._shouldSetNestedCoords()&&this.forEachObject((t=>t.setCoords()))}triggerLayout(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};this.layoutManager.performLayout(A({target:this,type:zs},t))}render(t){this._transformDone=!0,super.render(t),this._transformDone=!1}__serializeObjects(t,e){const n=this.includeDefaultValues;return this._objects.filter((function(t){return!t.excludeFromExport})).map((function(i){const s=i.includeDefaultValues;i.includeDefaultValues=n;const r=i[t||"toObject"](e);return i.includeDefaultValues=s,r}))}toObject(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];const e=this.layoutManager.toObject();return A(A(A({},super.toObject(["subTargetCheck","interactive",...t])),"fit-content"!==e.strategy||this.includeDefaultValues?{layoutManager:e}:{}),{},{objects:this.__serializeObjects("toObject",t)})}toString(){return"#<Group: (".concat(this.complexity(),")>")}dispose(){this.layoutManager.unsubscribeTargets({targets:this.getObjects(),target:this}),this._activeObjects=[],this.forEachObject((t=>{this._watchObject(!1,t),t.dispose()})),super.dispose()}_createSVGBgRect(t){if(!this.backgroundColor)return"";const e=Xs.prototype._toSVG.call(this),n=e.indexOf("COMMON_PARTS");e[n]='for="group" ';const i=e.join("");return t?t(i):i}_toSVG(t){const e=["<g ","COMMON_PARTS"," >\n"],n=this._createSVGBgRect(t);n&&e.push("\t\t",n);for(let i=0;i<this._objects.length;i++)e.push("\t\t",this._objects[i].toSVG(t));return e.push("</g>\n"),e}getSvgStyles(){const t=void 0!==this.opacity&&1!==this.opacity?"opacity: ".concat(this.opacity,";"):"",e=this.visible?"":" visibility: hidden;";return[t,this.getSvgFilter(),e].join("")}toClipPathSVG(t){const e=[],n=this._createSVGBgRect(t);n&&e.push("\t",n);for(let i=0;i<this._objects.length;i++)e.push("\t",this._objects[i].toClipPathSVG(t));return this._createBaseClipPathSVGMarkup(e,{reviver:t})}static fromObject(t,e){let{type:n,objects:i=[],layoutManager:s}=t,r=O(t,er);return Promise.all([ce(i,e),le(r,e)]).then((t=>{let[e,n]=t;const i=new this(e,A(A(A({},r),n),{},{layoutManager:new nr}));if(s){const t=Tt.getClass(s.type),e=Tt.getClass(s.strategy);i.layoutManager=new t(new e)}else i.layoutManager=new tr;return i.layoutManager.subscribeTargets({type:Gs,target:i,targets:i.getObjects()}),i.setCoords(),i}))}}E(ir,"type","Group"),E(ir,"ownDefaults",{strokeWidth:0,subTargetCheck:!1,interactive:!1}),Tt.setClass(ir);const sr=(t,e)=>Math.min(e.width/t.width,e.height/t.height),rr=(t,e)=>Math.max(e.width/t.width,e.height/t.height),or="\\s*,?\\s*",ar="".concat(or,"(").concat(pn,")"),hr="".concat(ar).concat(ar).concat(ar).concat(or,"([01])").concat(or,"([01])").concat(ar).concat(ar),cr={m:"l",M:"L"},lr=(t,e,n,i,s,r,o,a,h,c,l)=>{const u=Ot(t),d=Dt(t),g=Ot(e),p=Dt(e),f=n*s*g-i*r*p+o,m=i*s*g+n*r*p+a;return["C",c+h*(-n*s*d-i*r*u),l+h*(-i*s*d+n*r*u),f+h*(n*s*p+i*r*g),m+h*(i*s*p-n*r*g),f,m]},ur=(t,e,n,i)=>{const s=Math.atan2(e,t),r=Math.atan2(i,n);return r>=s?r-s:2*Math.PI-(s-r)};function dr(t,e,n,i,s,r,o,a){let h;if(P.cachesBoundsOfCurve&&(h=[...arguments].join(),G.boundsOfCurveCache[h]))return G.boundsOfCurveCache[h];const c=Math.sqrt,l=Math.abs,u=[],d=[[0,0],[0,0]];let g=6*t-12*n+6*s,p=-3*t+9*n-9*s+3*o,f=3*n-3*t;for(let C=0;C<2;++C){if(C>0&&(g=6*e-12*i+6*r,p=-3*e+9*i-9*r+3*a,f=3*i-3*e),l(p)<1e-12){if(l(g)<1e-12)continue;const t=-f/g;0<t&&t<1&&u.push(t);continue}const t=g*g-4*f*p;if(t<0)continue;const n=c(t),s=(-g+n)/(2*p);0<s&&s<1&&u.push(s);const o=(-g-n)/(2*p);0<o&&o<1&&u.push(o)}let m=u.length;const _=m,v=mr(t,e,n,i,s,r,o,a);for(;m--;){const{x:t,y:e}=v(u[m]);d[0][m]=t,d[1][m]=e}d[0][_]=t,d[1][_]=e,d[0][_+1]=o,d[1][_+1]=a;const y=[new It(Math.min(...d[0]),Math.min(...d[1])),new It(Math.max(...d[0]),Math.max(...d[1]))];return P.cachesBoundsOfCurve&&(G.boundsOfCurveCache[h]=y),y}const gr=(t,e,n)=>{let[i,s,r,o,a,h,c,l]=n;const u=((t,e,n,i,s,r,o)=>{if(0===n||0===i)return[];let a=0,h=0,c=0;const l=Math.PI,u=o*K,d=Dt(u),g=Ot(u),p=.5*(-g*t-d*e),f=.5*(-g*e+d*t),m=n**2,_=i**2,v=f**2,y=p**2,C=m*_-m*v-_*y;let b=Math.abs(n),w=Math.abs(i);if(C<0){const t=Math.sqrt(1-C/(m*_));b*=t,w*=t}else c=(s===r?-1:1)*Math.sqrt(C/(m*v+_*y));const x=c*b*f/w,S=-c*w*p/b,T=g*x-d*S+.5*t,E=d*x+g*S+.5*e;let k=ur(1,0,(p-x)/b,(f-S)/w),A=ur((p-x)/b,(f-S)/w,(-p-x)/b,(-f-S)/w);0===r&&A>0?A-=2*l:1===r&&A<0&&(A+=2*l);const O=Math.ceil(Math.abs(A/l*2)),D=[],I=A/O,P=8/3*Math.sin(I/4)*Math.sin(I/4)/Math.sin(I/2);let M=k+I;for(let R=0;R<O;R++)D[R]=lr(k,M,g,d,b,w,T,E,P,a,h),a=D[R][5],h=D[R][6],k=M,M+=I;return D})(c-t,l-e,s,r,a,h,o);for(let d=0,g=u.length;d<g;d++)u[d][1]+=t,u[d][2]+=e,u[d][3]+=t,u[d][4]+=e,u[d][5]+=t,u[d][6]+=e;return u},pr=t=>{let e=0,n=0,i=0,s=0;const r=[];let o,a=0,h=0;for(const c of t){const t=[...c];let l;switch(t[0]){case"l":t[1]+=e,t[2]+=n;case"L":e=t[1],n=t[2],l=["L",e,n];break;case"h":t[1]+=e;case"H":e=t[1],l=["L",e,n];break;case"v":t[1]+=n;case"V":n=t[1],l=["L",e,n];break;case"m":t[1]+=e,t[2]+=n;case"M":e=t[1],n=t[2],i=t[1],s=t[2],l=["M",e,n];break;case"c":t[1]+=e,t[2]+=n,t[3]+=e,t[4]+=n,t[5]+=e,t[6]+=n;case"C":a=t[3],h=t[4],e=t[5],n=t[6],l=["C",t[1],t[2],a,h,e,n];break;case"s":t[1]+=e,t[2]+=n,t[3]+=e,t[4]+=n;case"S":"C"===o?(a=2*e-a,h=2*n-h):(a=e,h=n),e=t[3],n=t[4],l=["C",a,h,t[1],t[2],e,n],a=l[3],h=l[4];break;case"q":t[1]+=e,t[2]+=n,t[3]+=e,t[4]+=n;case"Q":a=t[1],h=t[2],e=t[3],n=t[4],l=["Q",a,h,e,n];break;case"t":t[1]+=e,t[2]+=n;case"T":"Q"===o?(a=2*e-a,h=2*n-h):(a=e,h=n),e=t[1],n=t[2],l=["Q",a,h,e,n];break;case"a":t[6]+=e,t[7]+=n;case"A":gr(e,n,t).forEach((t=>r.push(t))),e=t[6],n=t[7];break;case"z":case"Z":e=i,n=s,l=["Z"]}l?(r.push(l),o=l[0]):o=""}return r},fr=(t,e,n,i)=>Math.sqrt((n-t)**2+(i-e)**2),mr=(t,e,n,i,s,r,o,a)=>h=>{const c=h**3,l=(t=>3*t**2*(1-t))(h),u=(t=>3*t*(1-t)**2)(h),d=(t=>(1-t)**3)(h);return new It(o*c+s*l+n*u+t*d,a*c+r*l+i*u+e*d)},_r=t=>t**2,vr=t=>2*t*(1-t),yr=t=>(1-t)**2,Cr=(t,e,n,i,s,r,o,a)=>h=>{const c=_r(h),l=vr(h),u=yr(h),d=3*(u*(n-t)+l*(s-n)+c*(o-s)),g=3*(u*(i-e)+l*(r-i)+c*(a-r));return Math.atan2(g,d)},br=(t,e,n,i,s,r)=>o=>{const a=_r(o),h=vr(o),c=yr(o);return new It(s*a+n*h+t*c,r*a+i*h+e*c)},wr=(t,e,n,i,s,r)=>o=>{const a=1-o,h=2*(a*(n-t)+o*(s-n)),c=2*(a*(i-e)+o*(r-i));return Math.atan2(c,h)},xr=(t,e,n)=>{let i=new It(e,n),s=0;for(let r=1;r<=100;r+=1){const e=t(r/100);s+=fr(i.x,i.y,e.x,e.y),i=e}return s},Sr=(t,e)=>{let n,i=0,s=0,r={x:t.x,y:t.y},o=A({},r),a=.01,h=0;const c=t.iterator,l=t.angleFinder;for(;s<e&&a>1e-4;)o=c(i),h=i,n=fr(r.x,r.y,o.x,o.y),n+s>e?(i-=a,a/=2):(r=o,i+=a,s+=n);return A(A({},o),{},{angle:l(h)})},Tr=t=>{let e,n,i=0,s=0,r=0,o=0,a=0;const h=[];for(const c of t){const t={x:s,y:r,command:c[0],length:0};switch(c[0]){case"M":n=t,n.x=o=s=c[1],n.y=a=r=c[2];break;case"L":n=t,n.length=fr(s,r,c[1],c[2]),s=c[1],r=c[2];break;case"C":e=mr(s,r,c[1],c[2],c[3],c[4],c[5],c[6]),n=t,n.iterator=e,n.angleFinder=Cr(s,r,c[1],c[2],c[3],c[4],c[5],c[6]),n.length=xr(e,s,r),s=c[5],r=c[6];break;case"Q":e=br(s,r,c[1],c[2],c[3],c[4]),n=t,n.iterator=e,n.angleFinder=wr(s,r,c[1],c[2],c[3],c[4]),n.length=xr(e,s,r),s=c[3],r=c[4];break;case"Z":n=t,n.destX=o,n.destY=a,n.length=fr(s,r,o,a),s=o,r=a}i+=n.length,h.push(n)}return h.push({length:i,x:s,y:r}),h},Er=function(t,e){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:Tr(t),i=0;for(;e-n[i].length>0&&i<n.length-2;)e-=n[i].length,i++;const s=n[i],r=e/s.length,o=t[i];switch(s.command){case"M":return{x:s.x,y:s.y,angle:0};case"Z":return A(A({},new It(s.x,s.y).lerp(new It(s.destX,s.destY),r)),{},{angle:Math.atan2(s.destY-s.y,s.destX-s.x)});case"L":return A(A({},new It(s.x,s.y).lerp(new It(o[1],o[2]),r)),{},{angle:Math.atan2(o[2]-s.y,o[1]-s.x)});case"C":case"Q":return Sr(s,e)}},kr=new RegExp("[mzlhvcsqta][^mzlhvcsqta]*","gi"),Ar=new RegExp(hr,"g"),Or=new RegExp(pn,"gi"),Dr={m:2,l:2,h:1,v:1,c:6,s:4,q:4,t:2,a:7},Ir=t=>{var e;const n=[],i=null!==(e=t.match(kr))&&void 0!==e?e:[];for(const s of i){const t=s[0];if("z"===t||"Z"===t){n.push([t]);continue}const e=Dr[t.toLowerCase()];let i=[];if("a"===t||"A"===t){Ar.lastIndex=0;for(let t=null;t=Ar.exec(s);)i.push(...t.slice(1))}else i=s.match(Or)||[];for(let s=0;s<i.length;s+=e){const r=new Array(e),o=cr[t];r[0]=s>0&&o?o:t;for(let t=0;t<e;t++)r[t+1]=parseFloat(i[s+t]);n.push(r)}}return n},Pr=function(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=new It(t[0]),i=new It(t[1]),s=1,r=0;const o=[],a=t.length,h=a>2;let c;for(h&&(s=t[2].x<i.x?-1:t[2].x===i.x?0:1,r=t[2].y<i.y?-1:t[2].y===i.y?0:1),o.push(["M",n.x-s*e,n.y-r*e]),c=1;c<a;c++){if(!n.eq(i)){const t=n.midPointFrom(i);o.push(["Q",n.x,n.y,t.x,t.y])}n=t[c],c+1<t.length&&(i=t[c+1])}return h&&(s=n.x>t[c-2].x?1:n.x===t[c-2].x?0:-1,r=n.y>t[c-2].y?1:n.y===t[c-2].y?0:-1),o.push(["L",n.x+s*e,n.y+r*e]),o},Mr=(t,e)=>t.map((t=>t.map(((t,n)=>0===n||void 0===e?t:ge(t,e))).join(" "))).join(" ");function Rr(t,e){const n=t.style;n&&e&&("string"==typeof e?n.cssText+=";"+e:Object.entries(e).forEach((t=>{let[e,i]=t;return n.setProperty(e,i)})))}const Fr=(t,e)=>Math.floor(Math.random()*(e-t+1))+t;function Lr(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const n=e.onComplete||H,i=new(U().XMLHttpRequest),s=e.signal,r=function(){i.abort()},o=function(){s&&s.removeEventListener("abort",r),i.onerror=i.ontimeout=H};if(s&&s.aborted)throw new F("request");return s&&s.addEventListener("abort",r,{once:!0}),i.onreadystatechange=function(){4===i.readyState&&(o(),n(i),i.onreadystatechange=H)},i.onerror=i.ontimeout=o,i.open("get",t,!0),i.send(),i}const jr=(t,e)=>{let n=t._findCenterFromElement();t.transformMatrix&&((t=>{if(t.transformMatrix){const{scaleX:e,scaleY:n,angle:i,skewX:s}=$t(t.transformMatrix);t.flipX=!1,t.flipY=!1,t.set(mt,e),t.set(_t,n),t.angle=i,t.skewX=s,t.skewY=0}})(t),n=n.transform(t.transformMatrix)),delete t.transformMatrix,e&&(t.scaleX*=e.scaleX,t.scaleY*=e.scaleY,t.cropX=e.cropX,t.cropY=e.cropY,n.x+=e.offsetLeft,n.y+=e.offsetTop,t.width=e.width,t.height=e.height),t.setPositionByOrigin(n,$,$)};var Nr=Object.freeze({__proto__:null,addTransformToObject:Re,animate:ri,animateColor:oi,applyTransformToObject:Fe,calcAngleBetweenVectors:On,calcDimensionsMatrix:oe,calcPlaneChangeMatrix:Be,calcVectorRotation:Dn,cancelAnimFrame:jt,capValue:Bn,composeMatrix:ae,copyCanvasElement:t=>{var e;const n=Ut(t);return null===(e=n.getContext("2d"))||void 0===e||e.drawImage(t,0,0),n},cos:Ot,createCanvasElement:Wt,createImage:Yt,createRotateMatrix:ee,createScaleMatrix:ne,createSkewXMatrix:se,createSkewYMatrix:re,createTranslateMatrix:te,createVector:kn,crossProduct:Mn,degreesToRadians:Vt,dotProduct:Rn,ease:qn,enlivenObjectEnlivables:le,enlivenObjects:ce,findScaleToCover:rr,findScaleToFit:sr,getBoundsOfCurve:dr,getOrthonormalVector:Pn,getPathSegmentsInfo:Tr,getPointOnPath:Er,getPointer:Oe,getRandomInt:Fr,getRegularPolygonPath:(t,e)=>{const n=2*Math.PI/t;let i=-z;t%2==0&&(i+=n/2);const s=new Array(t+1);for(let r=0;r<t;r++){const t=r*n+i,{x:o,y:a}=new It(Ot(t),Dt(t)).scalarMultiply(e);s[r]=[0===r?"M":"L",o,a]}return s[t]=["Z"],s},getSmoothPathFromPoints:Pr,getSvgAttributes:t=>{const e=["instantiated_by_use","style","id","class"];switch(t){case"linearGradient":return e.concat(["x1","y1","x2","y2","gradientUnits","gradientTransform"]);case"radialGradient":return e.concat(["gradientUnits","gradientTransform","cx","cy","r","fx","fy","fr"]);case"stop":return e.concat(["offset","stop-color","stop-opacity"])}return e},getUnitVector:In,groupSVGElements:(t,e)=>t&&1===t.length?t[0]:new ir(t,e),hasStyleChanged:rs,invertTransform:Kt,isBetweenVectors:Fn,isIdentityMatrix:zt,isTouchEvent:De,isTransparent:Hi,joinPath:Mr,loadImage:he,magnitude:An,makeBoundingBoxFromPoints:Pe,makePathSimpler:pr,matrixToSVG:pe,mergeClipPaths:(t,e)=>{var n;let i=t,s=e;i.inverted&&!s.inverted&&(i=e,s=t),Ue(s,null===(n=s.group)||void 0===n?void 0:n.calcTransformMatrix(),i.calcTransformMatrix());const r=i.inverted&&s.inverted;return r&&(i.inverted=s.inverted=!1),new ir([i],{clipPath:s,inverted:r})},multiplyTransformMatrices:Qt,multiplyTransformMatrixArray:Jt,parsePath:Ir,parsePreserveAspectRatioAttribute:cn,parseUnit:hn,pick:ue,projectStrokeOnPoints:Ji,qrDecompose:$t,radiansToDegrees:Ht,removeFromArray:At,removeTransformFromObject:(t,e)=>{const n=Kt(e),i=Qt(n,t.calcOwnMatrix());Fe(t,i)},removeTransformMatrixForSvgParsing:jr,request:Lr,requestAnimFrame:Lt,resetObjectTransform:Le,rotatePoint:(t,e,n)=>t.rotate(n,e),rotateVector:En,saveObjectTransform:je,sendObjectToPlane:Ue,sendPointToPlane:We,sendVectorToPlane:Ye,setStyle:Rr,sin:Dt,sizeAfterTransform:Ne,string:ss,stylesFromArray:as,stylesToArray:os,toBlob:Gt,toDataURL:Xt,toFixed:ge,transformPath:(t,e,n)=>(n&&(e=Qt(e,[1,0,0,1,-n.x,-n.y])),t.map((t=>{const n=[...t];for(let i=1;i<t.length-1;i+=2){const{x:s,y:r}=qt({x:t[i],y:t[i+1]},e);n[i]=s,n[i+1]=r}return n}))),transformPoint:qt});class Br extends Te{constructor(t){let{allowTouchScrolling:e=!1,containerClass:n=""}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};super(t),E(this,"upper",void 0),E(this,"container",void 0);const{el:i}=this.lower,s=this.createUpperCanvas();this.upper={el:s,ctx:s.getContext("2d")},this.applyCanvasStyle(i,{allowTouchScrolling:e}),this.applyCanvasStyle(s,{allowTouchScrolling:e,styles:{position:"absolute",left:"0",top:"0"}});const r=this.createContainerElement();r.classList.add(n),i.parentNode&&i.parentNode.replaceChild(r,i),r.append(i,s),this.container=r}createUpperCanvas(){const{el:t}=this.lower,e=Wt();return e.className=t.className,e.classList.remove("lower-canvas"),e.classList.add("upper-canvas"),e.setAttribute("data-fabric","top"),e.style.cssText=t.style.cssText,e.setAttribute("draggable","true"),e}createContainerElement(){const t=Y().createElement("div");return t.setAttribute("data-fabric","wrapper"),Rr(t,{position:"relative"}),Se(t),t}applyCanvasStyle(t,e){const{styles:n,allowTouchScrolling:i}=e;Rr(t,A(A({},n),{},{"touch-action":i?"manipulation":st})),Se(t)}setDimensions(t,e){super.setDimensions(t,e);const{el:n,ctx:i}=this.upper;we(n,i,t,e)}setCSSDimensions(t){super.setCSSDimensions(t),xe(this.upper.el,t),xe(this.container,t)}cleanupDOM(t){const e=this.container,{el:n}=this.lower,{el:i}=this.upper;super.cleanupDOM(t),e.removeChild(i),e.removeChild(n),e.parentNode&&e.parentNode.replaceChild(n,e)}dispose(){super.dispose(),W().dispose(this.upper.el),delete this.upper,delete this.container}}class Wr extends ke{constructor(){super(...arguments),E(this,"targets",[]),E(this,"_hoveredTargets",[]),E(this,"_objectsToRender",void 0),E(this,"_currentTransform",null),E(this,"_groupSelector",null),E(this,"contextTopDirty",!1)}static getDefaults(){return A(A({},super.getDefaults()),Wr.ownDefaults)}get upperCanvasEl(){var t;return null===(t=this.elements.upper)||void 0===t?void 0:t.el}get contextTop(){var t;return null===(t=this.elements.upper)||void 0===t?void 0:t.ctx}get wrapperEl(){return this.elements.container}initElements(t){this.elements=new Br(t,{allowTouchScrolling:this.allowTouchScrolling,containerClass:this.containerClass}),this._createCacheCanvas()}_onObjectAdded(t){this._objectsToRender=void 0,super._onObjectAdded(t)}_onObjectRemoved(t){this._objectsToRender=void 0,t===this._activeObject&&(this.fire("before:selection:cleared",{deselected:[t]}),this._discardActiveObject(),this.fire("selection:cleared",{deselected:[t]}),t.fire("deselected",{target:t})),t===this._hoveredTarget&&(this._hoveredTarget=void 0,this._hoveredTargets=[]),super._onObjectRemoved(t)}_onStackOrderChanged(){this._objectsToRender=void 0,super._onStackOrderChanged()}_chooseObjectsToRender(){const t=this._activeObject;return!this.preserveObjectStacking&&t?this._objects.filter((e=>!e.group&&e!==t)).concat(t):this._objects}renderAll(){this.cancelRequestedRender(),this.destroyed||(!this.contextTopDirty||this._groupSelector||this.isDrawingMode||(this.clearContext(this.contextTop),this.contextTopDirty=!1),this.hasLostContext&&(this.renderTopLayer(this.contextTop),this.hasLostContext=!1),!this._objectsToRender&&(this._objectsToRender=this._chooseObjectsToRender()),this.renderCanvas(this.getContext(),this._objectsToRender))}renderTopLayer(t){t.save(),this.isDrawingMode&&this._isCurrentlyDrawing&&(this.freeDrawingBrush&&this.freeDrawingBrush._render(),this.contextTopDirty=!0),this.selection&&this._groupSelector&&(this._drawSelection(t),this.contextTopDirty=!0),t.restore()}renderTop(){const t=this.contextTop;this.clearContext(t),this.renderTopLayer(t),this.fire("after:render",{ctx:t})}setTargetFindTolerance(t){t=Math.round(t),this.targetFindTolerance=t;const e=this.getRetinaScaling(),n=Math.ceil((2*t+1)*e);this.pixelFindCanvasEl.width=this.pixelFindCanvasEl.height=n,this.pixelFindContext.scale(e,e)}isTargetTransparent(t,e,n){const i=this.targetFindTolerance,s=this.pixelFindContext;this.clearContext(s),s.save(),s.translate(-e+i,-n+i),s.transform(...this.viewportTransform);const r=t.selectionBackgroundColor;t.selectionBackgroundColor="",t.render(s),t.selectionBackgroundColor=r,s.restore();const o=Math.round(i*this.getRetinaScaling());return Hi(s,o,o,o)}_isSelectionKeyPressed(t){const e=this.selectionKey;return!!e&&(Array.isArray(e)?!!e.find((e=>!!e&&!0===t[e])):t[e])}_shouldClearSelection(t,e){const n=this.getActiveObjects(),i=this._activeObject;return!!(!e||e&&i&&n.length>1&&-1===n.indexOf(e)&&i!==e&&!this._isSelectionKeyPressed(t)||e&&!e.evented||e&&!e.selectable&&i&&i!==e)}_shouldCenterTransform(t,e,n){if(!t)return;let i;return e===ft||e===mt||e===_t||e===ut?i=this.centeredScaling||t.centeredScaling:e===ct&&(i=this.centeredRotation||t.centeredRotation),i?!n:n}_getOriginFromCorner(t,e){const n={x:t.originX,y:t.originY};return e?(["ml","tl","bl"].includes(e)?n.x=it:["mr","tr","br"].includes(e)&&(n.x=tt),["tl","mt","tr"].includes(e)?n.y=nt:["bl","mb","br"].includes(e)&&(n.y=et),n):n}_setupCurrentTransform(t,e,n){var i;const s=e.group?We(this.getScenePoint(t),void 0,e.group.calcTransformMatrix()):this.getScenePoint(t),{key:r="",control:o}=e.getActiveControl()||{},a=n&&o?null===(i=o.getActionHandler(t,e,o))||void 0===i?void 0:i.bind(o):$e,h=((t,e,n,i)=>{if(!e||!t)return"drag";const s=i.controls[e];return s.getActionName(n,s,i)})(n,r,t,e),c=t[this.centeredKey],l=this._shouldCenterTransform(e,h,c)?{x:$,y:$}:this._getOriginFromCorner(e,r),u={target:e,action:h,actionHandler:a,actionPerformed:!1,corner:r,scaleX:e.scaleX,scaleY:e.scaleY,skewX:e.skewX,skewY:e.skewY,offsetX:s.x-e.left,offsetY:s.y-e.top,originX:l.x,originY:l.y,ex:s.x,ey:s.y,lastX:s.x,lastY:s.y,theta:Vt(e.angle),width:e.width,height:e.height,shiftKey:t.shiftKey,altKey:c,original:A(A({},je(e)),{},{originX:l.x,originY:l.y})};this._currentTransform=u,this.fire("before:transform",{e:t,transform:u})}setCursor(t){this.upperCanvasEl.style.cursor=t}_drawSelection(t){const{x:e,y:n,deltaX:i,deltaY:s}=this._groupSelector,r=new It(e,n).transform(this.viewportTransform),o=new It(e+i,n+s).transform(this.viewportTransform),a=this.selectionLineWidth/2;let h=Math.min(r.x,o.x),c=Math.min(r.y,o.y),l=Math.max(r.x,o.x),u=Math.max(r.y,o.y);this.selectionColor&&(t.fillStyle=this.selectionColor,t.fillRect(h,c,l-h,u-c)),this.selectionLineWidth&&this.selectionBorderColor&&(t.lineWidth=this.selectionLineWidth,t.strokeStyle=this.selectionBorderColor,h+=a,c+=a,l-=a,u-=a,Vi.prototype._setLineDash.call(this,t,this.selectionDashArray),t.strokeRect(h,c,l-h,u-c))}findTarget(t){if(this.skipTargetFind)return;const e=this.getViewportPoint(t),n=this._activeObject,i=this.getActiveObjects();if(this.targets=[],n&&i.length>=1){if(n.findControl(e,De(t)))return n;if(i.length>1&&this.searchPossibleTargets([n],e))return n;if(n===this.searchPossibleTargets([n],e)){if(this.preserveObjectStacking){const i=this.targets;this.targets=[];const s=this.searchPossibleTargets(this._objects,e);return t[this.altSelectionKey]&&s&&s!==n?(this.targets=i,n):s}return n}}return this.searchPossibleTargets(this._objects,e)}_pointIsInObjectSelectionArea(t,e){let n=t.getCoords();const i=this.getZoom(),s=t.padding/i;if(s){const[t,e,i,r]=n,o=Math.atan2(e.y-t.y,e.x-t.x),a=Ot(o)*s,h=Dt(o)*s,c=a+h,l=a-h;n=[new It(t.x-l,t.y-c),new It(e.x+c,e.y-l),new It(i.x+l,i.y+c),new It(r.x-c,r.y+l)]}return ai.isPointInPolygon(e,n)}_checkTarget(t,e){if(t&&t.visible&&t.evented&&this._pointIsInObjectSelectionArea(t,We(e,void 0,this.viewportTransform))){if(!this.perPixelTargetFind&&!t.perPixelTargetFind||t.isEditing)return!0;if(!this.isTargetTransparent(t,e.x,e.y))return!0}return!1}_searchPossibleTargets(t,e){let n=t.length;for(;n--;){const i=t[n];if(this._checkTarget(i,e)){if(Mt(i)&&i.subTargetCheck){const t=this._searchPossibleTargets(i._objects,e);t&&this.targets.push(t)}return i}}}searchPossibleTargets(t,e){const n=this._searchPossibleTargets(t,e);if(n&&Mt(n)&&n.interactive&&this.targets[0]){const t=this.targets;for(let e=t.length-1;e>0;e--){const n=t[e];if(!Mt(n)||!n.interactive)return n}return t[0]}return n}getViewportPoint(t){return this._pointer?this._pointer:this.getPointer(t,!0)}getScenePoint(t){return this._absolutePointer?this._absolutePointer:this.getPointer(t)}getPointer(t){let e=arguments.length>1&&void 0!==arguments[1]&&arguments[1];const n=this.upperCanvasEl,i=n.getBoundingClientRect();let s=Oe(t),r=i.width||0,o=i.height||0;r&&o||(et in i&&nt in i&&(o=Math.abs(i.top-i.bottom)),it in i&&tt in i&&(r=Math.abs(i.right-i.left))),this.calcOffset(),s.x=s.x-this._offset.left,s.y=s.y-this._offset.top,e||(s=We(s,void 0,this.viewportTransform));const a=this.getRetinaScaling();1!==a&&(s.x/=a,s.y/=a);const h=0===r||0===o?new It(1,1):new It(n.width/r,n.height/o);return s.multiply(h)}_setDimensionsImpl(t,e){this._resetTransformEventData(),super._setDimensionsImpl(t,e),this._isCurrentlyDrawing&&this.freeDrawingBrush&&this.freeDrawingBrush._setBrushStyles(this.contextTop)}_createCacheCanvas(){this.pixelFindCanvasEl=Wt(),this.pixelFindContext=this.pixelFindCanvasEl.getContext("2d",{willReadFrequently:!0}),this.setTargetFindTolerance(this.targetFindTolerance)}getTopContext(){return this.elements.upper.ctx}getSelectionContext(){return this.elements.upper.ctx}getSelectionElement(){return this.elements.upper.el}getActiveObject(){return this._activeObject}getActiveObjects(){const t=this._activeObject;return ve(t)?t.getObjects():t?[t]:[]}_fireSelectionEvents(t,e){let n=!1,i=!1;const s=this.getActiveObjects(),r=[],o=[];t.forEach((t=>{s.includes(t)||(n=!0,t.fire("deselected",{e:e,target:t}),o.push(t))})),s.forEach((i=>{t.includes(i)||(n=!0,i.fire("selected",{e:e,target:i}),r.push(i))})),t.length>0&&s.length>0?(i=!0,n&&this.fire("selection:updated",{e:e,selected:r,deselected:o})):s.length>0?(i=!0,this.fire("selection:created",{e:e,selected:r})):t.length>0&&(i=!0,this.fire("selection:cleared",{e:e,deselected:o})),i&&(this._objectsToRender=void 0)}setActiveObject(t,e){const n=this.getActiveObjects(),i=this._setActiveObject(t,e);return this._fireSelectionEvents(n,e),i}_setActiveObject(t,e){const n=this._activeObject;return n!==t&&!(!this._discardActiveObject(e,t)&&this._activeObject)&&!t.onSelect({e:e})&&(this._activeObject=t,ve(t)&&n!==t&&t.set("canvas",this),t.setCoords(),!0)}_discardActiveObject(t,e){const n=this._activeObject;return!!n&&!n.onDeselect({e:t,object:e})&&(this._currentTransform&&this._currentTransform.target===n&&this.endCurrentTransform(t),ve(n)&&n===this._hoveredTarget&&(this._hoveredTarget=void 0),this._activeObject=void 0,!0)}discardActiveObject(t){const e=this.getActiveObjects(),n=this.getActiveObject();e.length&&this.fire("before:selection:cleared",{e:t,deselected:[n]});const i=this._discardActiveObject(t);return this._fireSelectionEvents(e,t),i}endCurrentTransform(t){const e=this._currentTransform;this._finalizeCurrentTransform(t),e&&e.target&&(e.target.isMoving=!1),this._currentTransform=null}_finalizeCurrentTransform(t){const e=this._currentTransform,n=e.target,i={e:t,target:n,transform:e,action:e.action};n._scaling&&(n._scaling=!1),n.setCoords(),e.actionPerformed&&(this.fire("object:modified",i),n.fire(wt,i))}setViewportTransform(t){super.setViewportTransform(t);const e=this._activeObject;e&&e.setCoords()}destroy(){const t=this._activeObject;ve(t)&&(t.removeAll(),t.dispose()),delete this._activeObject,super.destroy(),this.pixelFindContext=null,this.pixelFindCanvasEl=void 0}clear(){this.discardActiveObject(),this._activeObject=void 0,this.clearContext(this.contextTop),super.clear()}drawControls(t){const e=this._activeObject;e&&e._renderControls(t)}_toObject(t,e,n){const i=this._realizeGroupTransformOnObject(t),s=super._toObject(t,e,n);return t.set(i),s}_realizeGroupTransformOnObject(t){const{group:e}=t;if(e&&ve(e)&&this._activeObject===e){const n=ue(t,["angle","flipX","flipY",tt,mt,_t,vt,yt,et]);return Re(t,e.calcOwnMatrix()),n}return{}}_setSVGObject(t,e,n){const i=this._realizeGroupTransformOnObject(e);super._setSVGObject(t,e,n),e.set(i)}}E(Wr,"ownDefaults",{uniformScaling:!0,uniScaleKey:"shiftKey",centeredScaling:!1,centeredRotation:!1,centeredKey:"altKey",altActionKey:"shiftKey",selection:!0,selectionKey:"shiftKey",selectionColor:"rgba(100, 100, 255, 0.3)",selectionDashArray:[],selectionBorderColor:"rgba(255, 255, 255, 0.3)",selectionLineWidth:1,selectionFullyContained:!1,hoverCursor:"move",moveCursor:"move",defaultCursor:"default",freeDrawingCursor:"crosshair",notAllowedCursor:"not-allowed",perPixelTargetFind:!1,targetFindTolerance:0,skipTargetFind:!1,stopContextMenu:!1,fireRightClick:!1,fireMiddleClick:!1,enablePointerEvents:!1,containerClass:"canvas-container",preserveObjectStacking:!1});class Yr{constructor(t){E(this,"targets",[]),E(this,"__disposer",void 0);const e=()=>{const{hiddenTextarea:e}=t.getActiveObject()||{};e&&e.focus()},n=t.upperCanvasEl;n.addEventListener("click",e),this.__disposer=()=>n.removeEventListener("click",e)}exitTextEditing(){this.target=void 0,this.targets.forEach((t=>{t.isEditing&&t.exitEditing()}))}add(t){this.targets.push(t)}remove(t){this.unregister(t),At(this.targets,t)}register(t){this.target=t}unregister(t){t===this.target&&(this.target=void 0)}onMouseMove(t){var e;(null===(e=this.target)||void 0===e?void 0:e.isEditing)&&this.target.updateSelectionOnMouseMove(t)}clear(){this.targets=[],this.target=void 0}dispose(){this.clear(),this.__disposer(),delete this.__disposer}}const Ur=["target","oldTarget","fireCanvas","e"],Xr={passive:!1},Gr=(t,e)=>{const n=t.getViewportPoint(e),i=t.getScenePoint(e);return{viewportPoint:n,scenePoint:i,pointer:n,absolutePointer:i}},Vr=function(t){for(var e=arguments.length,n=new Array(e>1?e-1:0),i=1;i<e;i++)n[i-1]=arguments[i];return t.addEventListener(...n)},Hr=function(t){for(var e=arguments.length,n=new Array(e>1?e-1:0),i=1;i<e;i++)n[i-1]=arguments[i];return t.removeEventListener(...n)},zr={mouse:{in:"over",out:"out",targetIn:"mouseover",targetOut:"mouseout",canvasIn:"mouse:over",canvasOut:"mouse:out"},drag:{in:"enter",out:"leave",targetIn:"dragenter",targetOut:"dragleave",canvasIn:"drag:enter",canvasOut:"drag:leave"}};class qr extends Wr{constructor(t){super(t,arguments.length>1&&void 0!==arguments[1]?arguments[1]:{}),E(this,"_isClick",void 0),E(this,"textEditingManager",new Yr(this)),["_onMouseDown","_onTouchStart","_onMouseMove","_onMouseUp","_onTouchEnd","_onResize","_onMouseWheel","_onMouseOut","_onMouseEnter","_onContextMenu","_onClick","_onDragStart","_onDragEnd","_onDragProgress","_onDragOver","_onDragEnter","_onDragLeave","_onDrop"].forEach((t=>{this[t]=this[t].bind(this)})),this.addOrRemove(Vr,"add")}_getEventPrefix(){return this.enablePointerEvents?"pointer":"mouse"}addOrRemove(t,e){const n=this.upperCanvasEl,i=this._getEventPrefix();t(be(n),"resize",this._onResize),t(n,i+"down",this._onMouseDown),t(n,"".concat(i,"move"),this._onMouseMove,Xr),t(n,"".concat(i,"out"),this._onMouseOut),t(n,"".concat(i,"enter"),this._onMouseEnter),t(n,"wheel",this._onMouseWheel),t(n,"contextmenu",this._onContextMenu),t(n,"click",this._onClick),t(n,"dblclick",this._onClick),t(n,"dragstart",this._onDragStart),t(n,"dragend",this._onDragEnd),t(n,"dragover",this._onDragOver),t(n,"dragenter",this._onDragEnter),t(n,"dragleave",this._onDragLeave),t(n,"drop",this._onDrop),this.enablePointerEvents||t(n,"touchstart",this._onTouchStart,Xr)}removeListeners(){this.addOrRemove(Hr,"remove");const t=this._getEventPrefix(),e=Ce(this.upperCanvasEl);Hr(e,"".concat(t,"up"),this._onMouseUp),Hr(e,"touchend",this._onTouchEnd,Xr),Hr(e,"".concat(t,"move"),this._onMouseMove,Xr),Hr(e,"touchmove",this._onMouseMove,Xr),clearTimeout(this._willAddMouseDown)}_onMouseWheel(t){this.__onMouseWheel(t)}_onMouseOut(t){const e=this._hoveredTarget,n=A({e:t},Gr(this,t));this.fire("mouse:out",A(A({},n),{},{target:e})),this._hoveredTarget=void 0,e&&e.fire("mouseout",A({},n)),this._hoveredTargets.forEach((t=>{this.fire("mouse:out",A(A({},n),{},{target:t})),t&&t.fire("mouseout",A({},n))})),this._hoveredTargets=[]}_onMouseEnter(t){this._currentTransform||this.findTarget(t)||(this.fire("mouse:over",A({e:t},Gr(this,t))),this._hoveredTarget=void 0,this._hoveredTargets=[])}_onDragStart(t){this._isClick=!1;const e=this.getActiveObject();if(e&&e.onDragStart(t)){this._dragSource=e;const n={e:t,target:e};return this.fire("dragstart",n),e.fire("dragstart",n),void Vr(this.upperCanvasEl,"drag",this._onDragProgress)}Ie(t)}_renderDragEffects(t,e,n){let i=!1;const s=this._dropTarget;s&&s!==e&&s!==n&&(s.clearContextTop(),i=!0),null==e||e.clearContextTop(),n!==e&&(null==n||n.clearContextTop());const r=this.contextTop;r.save(),r.transform(...this.viewportTransform),e&&(r.save(),e.transform(r),e.renderDragSourceEffect(t),r.restore(),i=!0),n&&(r.save(),n.transform(r),n.renderDropTargetEffect(t),r.restore(),i=!0),r.restore(),i&&(this.contextTopDirty=!0)}_onDragEnd(t){const e=!!t.dataTransfer&&t.dataTransfer.dropEffect!==st,n=e?this._activeObject:void 0,i={e:t,target:this._dragSource,subTargets:this.targets,dragSource:this._dragSource,didDrop:e,dropTarget:n};Hr(this.upperCanvasEl,"drag",this._onDragProgress),this.fire("dragend",i),this._dragSource&&this._dragSource.fire("dragend",i),delete this._dragSource,this._onMouseUp(t)}_onDragProgress(t){const e={e:t,target:this._dragSource,dragSource:this._dragSource,dropTarget:this._draggedoverTarget};this.fire("drag",e),this._dragSource&&this._dragSource.fire("drag",e)}findDragTargets(t){return this.targets=[],{target:this._searchPossibleTargets(this._objects,this.getViewportPoint(t)),targets:[...this.targets]}}_onDragOver(t){const e="dragover",{target:n,targets:i}=this.findDragTargets(t),s=this._dragSource,r={e:t,target:n,subTargets:i,dragSource:s,canDrop:!1,dropTarget:void 0};let o;this.fire(e,r),this._fireEnterLeaveEvents(n,r),n&&(n.canDrop(t)&&(o=n),n.fire(e,r));for(let a=0;a<i.length;a++){const n=i[a];n.canDrop(t)&&(o=n),n.fire(e,r)}this._renderDragEffects(t,s,o),this._dropTarget=o}_onDragEnter(t){const{target:e,targets:n}=this.findDragTargets(t),i={e:t,target:e,subTargets:n,dragSource:this._dragSource};this.fire("dragenter",i),this._fireEnterLeaveEvents(e,i)}_onDragLeave(t){const e={e:t,target:this._draggedoverTarget,subTargets:this.targets,dragSource:this._dragSource};this.fire("dragleave",e),this._fireEnterLeaveEvents(void 0,e),this._renderDragEffects(t,this._dragSource),this._dropTarget=void 0,this.targets=[],this._hoveredTargets=[]}_onDrop(t){const{target:e,targets:n}=this.findDragTargets(t),i=this._basicEventHandler("drop:before",A({e:t,target:e,subTargets:n,dragSource:this._dragSource},Gr(this,t)));i.didDrop=!1,i.dropTarget=void 0,this._basicEventHandler("drop",i),this.fire("drop:after",i)}_onContextMenu(t){const e=this.findTarget(t),n=this.targets||[],i=this._basicEventHandler("contextmenu:before",{e:t,target:e,subTargets:n});return this.stopContextMenu&&Ie(t),this._basicEventHandler("contextmenu",i),!1}_onClick(t){const e=t.detail;e>3||e<2||(this._cacheTransformEventData(t),2==e&&"dblclick"===t.type&&this._handleEvent(t,"dblclick"),3==e&&this._handleEvent(t,"tripleclick"),this._resetTransformEventData())}getPointerId(t){const e=t.changedTouches;return e?e[0]&&e[0].identifier:this.enablePointerEvents?t.pointerId:-1}_isMainEvent(t){return!0===t.isPrimary||!1!==t.isPrimary&&("touchend"===t.type&&0===t.touches.length||!t.changedTouches||t.changedTouches[0].identifier===this.mainTouchId)}_onTouchStart(t){let e=!this.allowTouchScrolling;const n=this._activeObject;void 0===this.mainTouchId&&(this.mainTouchId=this.getPointerId(t)),this.__onMouseDown(t),(this.isDrawingMode||n&&this._target===n)&&(e=!0),e&&t.preventDefault(),this._resetTransformEventData();const i=this.upperCanvasEl,s=this._getEventPrefix(),r=Ce(i);Vr(r,"touchend",this._onTouchEnd,Xr),e&&Vr(r,"touchmove",this._onMouseMove,Xr),Hr(i,"".concat(s,"down"),this._onMouseDown)}_onMouseDown(t){this.__onMouseDown(t),this._resetTransformEventData();const e=this.upperCanvasEl,n=this._getEventPrefix();Hr(e,"".concat(n,"move"),this._onMouseMove,Xr);const i=Ce(e);Vr(i,"".concat(n,"up"),this._onMouseUp),Vr(i,"".concat(n,"move"),this._onMouseMove,Xr)}_onTouchEnd(t){if(t.touches.length>0)return;this.__onMouseUp(t),this._resetTransformEventData(),delete this.mainTouchId;const e=this._getEventPrefix(),n=Ce(this.upperCanvasEl);Hr(n,"touchend",this._onTouchEnd,Xr),Hr(n,"touchmove",this._onMouseMove,Xr),this._willAddMouseDown&&clearTimeout(this._willAddMouseDown),this._willAddMouseDown=setTimeout((()=>{Vr(this.upperCanvasEl,"".concat(e,"down"),this._onMouseDown),this._willAddMouseDown=0}),400)}_onMouseUp(t){this.__onMouseUp(t),this._resetTransformEventData();const e=this.upperCanvasEl,n=this._getEventPrefix();if(this._isMainEvent(t)){const t=Ce(this.upperCanvasEl);Hr(t,"".concat(n,"up"),this._onMouseUp),Hr(t,"".concat(n,"move"),this._onMouseMove,Xr),Vr(e,"".concat(n,"move"),this._onMouseMove,Xr)}}_onMouseMove(t){const e=this.getActiveObject();!this.allowTouchScrolling&&(!e||!e.shouldStartDragging(t))&&t.preventDefault&&t.preventDefault(),this.__onMouseMove(t)}_onResize(){this.calcOffset(),this._resetTransformEventData()}_shouldRender(t){const e=this.getActiveObject();return!!e!=!!t||e&&t&&e!==t}__onMouseUp(t){var e;this._cacheTransformEventData(t),this._handleEvent(t,"up:before");const n=this._currentTransform,i=this._isClick,s=this._target,{button:r}=t;if(r)return(this.fireMiddleClick&&1===r||this.fireRightClick&&2===r)&&this._handleEvent(t,"up"),void this._resetTransformEventData();if(this.isDrawingMode&&this._isCurrentlyDrawing)return void this._onMouseUpInDrawingMode(t);if(!this._isMainEvent(t))return;let o,a,h=!1;if(n&&(this._finalizeCurrentTransform(t),h=n.actionPerformed),!i){const e=s===this._activeObject;this.handleSelection(t),h||(h=this._shouldRender(s)||!e&&s===this._activeObject)}if(s){const e=s.findControl(this.getViewportPoint(t),De(t)),{key:i,control:r}=e||{};if(a=i,s.selectable&&s!==this._activeObject&&"up"===s.activeOn)this.setActiveObject(s,t),h=!0;else if(r){const e=r.getMouseUpHandler(t,s,r);e&&(o=this.getScenePoint(t),e.call(r,t,n,o.x,o.y))}s.isMoving=!1}if(n&&(n.target!==s||n.corner!==a)){const e=n.target&&n.target.controls[n.corner],i=e&&e.getMouseUpHandler(t,n.target,e);o=o||this.getScenePoint(t),i&&i.call(e,t,n,o.x,o.y)}this._setCursorFromEvent(t,s),this._handleEvent(t,"up"),this._groupSelector=null,this._currentTransform=null,s&&(s.__corner=void 0),h?this.requestRenderAll():i||null!==(e=this._activeObject)&&void 0!==e&&e.isEditing||this.renderTop()}_basicEventHandler(t,e){const{target:n,subTargets:i=[]}=e;this.fire(t,e),n&&n.fire(t,e);for(let s=0;s<i.length;s++)i[s]!==n&&i[s].fire(t,e);return e}_handleEvent(t,e,n){const i=this._target,s=this.targets||[],r=A(A(A({e:t,target:i,subTargets:s},Gr(this,t)),{},{transform:this._currentTransform},"up:before"===e||"up"===e?{isClick:this._isClick,currentTarget:this.findTarget(t),currentSubTargets:this.targets}:{}),"down:before"===e||"down"===e?n:{});this.fire("mouse:".concat(e),r),i&&i.fire("mouse".concat(e),r);for(let o=0;o<s.length;o++)s[o]!==i&&s[o].fire("mouse".concat(e),r)}_onMouseDownInDrawingMode(t){this._isCurrentlyDrawing=!0,this.getActiveObject()&&(this.discardActiveObject(t),this.requestRenderAll());const e=this.getScenePoint(t);this.freeDrawingBrush&&this.freeDrawingBrush.onMouseDown(e,{e:t,pointer:e}),this._handleEvent(t,"down",{alreadySelected:!1})}_onMouseMoveInDrawingMode(t){if(this._isCurrentlyDrawing){const e=this.getScenePoint(t);this.freeDrawingBrush&&this.freeDrawingBrush.onMouseMove(e,{e:t,pointer:e})}this.setCursor(this.freeDrawingCursor),this._handleEvent(t,"move")}_onMouseUpInDrawingMode(t){const e=this.getScenePoint(t);this.freeDrawingBrush?this._isCurrentlyDrawing=!!this.freeDrawingBrush.onMouseUp({e:t,pointer:e}):this._isCurrentlyDrawing=!1,this._handleEvent(t,"up")}__onMouseDown(t){this._isClick=!0,this._cacheTransformEventData(t),this._handleEvent(t,"down:before");let e=this._target,n=!!e&&e===this._activeObject;const{button:i}=t;if(i)return(this.fireMiddleClick&&1===i||this.fireRightClick&&2===i)&&this._handleEvent(t,"down",{alreadySelected:n}),void this._resetTransformEventData();if(this.isDrawingMode)return void this._onMouseDownInDrawingMode(t);if(!this._isMainEvent(t))return;if(this._currentTransform)return;let s=this._shouldRender(e),r=!1;if(this.handleMultiSelection(t,e)?(e=this._activeObject,r=!0,s=!0):this._shouldClearSelection(t,e)&&this.discardActiveObject(t),this.selection&&(!e||!e.selectable&&!e.isEditing&&e!==this._activeObject)){const e=this.getScenePoint(t);this._groupSelector={x:e.x,y:e.y,deltaY:0,deltaX:0}}if(n=!!e&&e===this._activeObject,e){e.selectable&&"down"===e.activeOn&&this.setActiveObject(e,t);const i=e.findControl(this.getViewportPoint(t),De(t));if(e===this._activeObject&&(i||!r)){this._setupCurrentTransform(t,e,n);const s=i?i.control:void 0,r=this.getScenePoint(t),o=s&&s.getMouseDownHandler(t,e,s);o&&o.call(s,t,this._currentTransform,r.x,r.y)}}s&&(this._objectsToRender=void 0),this._handleEvent(t,"down",{alreadySelected:n}),s&&this.requestRenderAll()}_resetTransformEventData(){this._target=this._pointer=this._absolutePointer=void 0}_cacheTransformEventData(t){this._resetTransformEventData(),this._pointer=this.getViewportPoint(t),this._absolutePointer=We(this._pointer,void 0,this.viewportTransform),this._target=this._currentTransform?this._currentTransform.target:this.findTarget(t)}__onMouseMove(t){if(this._isClick=!1,this._cacheTransformEventData(t),this._handleEvent(t,"move:before"),this.isDrawingMode)return void this._onMouseMoveInDrawingMode(t);if(!this._isMainEvent(t))return;const e=this._groupSelector;if(e){const n=this.getScenePoint(t);e.deltaX=n.x-e.x,e.deltaY=n.y-e.y,this.renderTop()}else if(this._currentTransform)this._transformObject(t);else{const e=this.findTarget(t);this._setCursorFromEvent(t,e),this._fireOverOutEvents(t,e)}this.textEditingManager.onMouseMove(t),this._handleEvent(t,"move"),this._resetTransformEventData()}_fireOverOutEvents(t,e){const n=this._hoveredTarget,i=this._hoveredTargets,s=this.targets,r=Math.max(i.length,s.length);this.fireSyntheticInOutEvents("mouse",{e:t,target:e,oldTarget:n,fireCanvas:!0});for(let o=0;o<r;o++)this.fireSyntheticInOutEvents("mouse",{e:t,target:s[o],oldTarget:i[o]});this._hoveredTarget=e,this._hoveredTargets=this.targets.concat()}_fireEnterLeaveEvents(t,e){const n=this._draggedoverTarget,i=this._hoveredTargets,s=this.targets,r=Math.max(i.length,s.length);this.fireSyntheticInOutEvents("drag",A(A({},e),{},{target:t,oldTarget:n,fireCanvas:!0}));for(let o=0;o<r;o++)this.fireSyntheticInOutEvents("drag",A(A({},e),{},{target:s[o],oldTarget:i[o]}));this._draggedoverTarget=t}fireSyntheticInOutEvents(t,e){let{target:n,oldTarget:i,fireCanvas:s,e:r}=e,o=O(e,Ur);const{targetIn:a,targetOut:h,canvasIn:c,canvasOut:l}=zr[t],u=i!==n;if(i&&u){const t=A(A({},o),{},{e:r,target:i,nextTarget:n},Gr(this,r));s&&this.fire(l,t),i.fire(h,t)}if(n&&u){const t=A(A({},o),{},{e:r,target:n,previousTarget:i},Gr(this,r));s&&this.fire(c,t),n.fire(a,t)}}__onMouseWheel(t){this._cacheTransformEventData(t),this._handleEvent(t,"wheel"),this._resetTransformEventData()}_transformObject(t){const e=this.getScenePoint(t),n=this._currentTransform,i=n.target,s=i.group?We(e,void 0,i.group.calcTransformMatrix()):e;n.shiftKey=t.shiftKey,n.altKey=!!this.centeredKey&&t[this.centeredKey],this._performTransformAction(t,n,s),n.actionPerformed&&this.requestRenderAll()}_performTransformAction(t,e,n){const{action:i,actionHandler:s,target:r}=e,o=!!s&&s(t,e,n.x,n.y);o&&r.setCoords(),"drag"===i&&o&&(e.target.isMoving=!0,this.setCursor(e.target.moveCursor||this.moveCursor)),e.actionPerformed=e.actionPerformed||o}_setCursorFromEvent(t,e){if(!e)return void this.setCursor(this.defaultCursor);let n=e.hoverCursor||this.hoverCursor;const i=ve(this._activeObject)?this._activeObject:null,s=(!i||e.group!==i)&&e.findControl(this.getViewportPoint(t));if(s){const n=s.control;this.setCursor(n.cursorStyleHandler(t,n,e))}else e.subTargetCheck&&this.targets.concat().reverse().map((t=>{n=t.hoverCursor||n})),this.setCursor(n)}handleMultiSelection(t,e){const n=this._activeObject,i=ve(n);if(n&&this._isSelectionKeyPressed(t)&&this.selection&&e&&e.selectable&&(n!==e||i)&&(i||!e.isDescendantOf(n)&&!n.isDescendantOf(e))&&!e.onSelect({e:t})&&!n.getActiveControl()){if(i){const i=n.getObjects();if(e===n){const n=this.getViewportPoint(t);if(!(e=this.searchPossibleTargets(i,n)||this.searchPossibleTargets(this._objects,n))||!e.selectable)return!1}e.group===n?(n.remove(e),this._hoveredTarget=e,this._hoveredTargets=[...this.targets],1===n.size()&&this._setActiveObject(n.item(0),t)):(n.multiSelectAdd(e),this._hoveredTarget=n,this._hoveredTargets=[...this.targets]),this._fireSelectionEvents(i,t)}else{n.isEditing&&n.exitEditing();const i=new(Tt.getClass("ActiveSelection"))([],{canvas:this});i.multiSelectAdd(n,e),this._hoveredTarget=i,this._setActiveObject(i,t),this._fireSelectionEvents([n],t)}return!0}return!1}handleSelection(t){if(!this.selection||!this._groupSelector)return!1;const{x:e,y:n,deltaX:i,deltaY:s}=this._groupSelector,r=new It(e,n),o=r.add(new It(i,s)),a=r.min(o),h=r.max(o).subtract(a),c=this.collectObjects({left:a.x,top:a.y,width:h.x,height:h.y},{includeIntersecting:!this.selectionFullyContained}),l=r.eq(o)?c[0]?[c[0]]:[]:c.length>1?c.filter((e=>!e.onSelect({e:t}))).reverse():c;if(1===l.length)this.setActiveObject(l[0],t);else if(l.length>1){const e=Tt.getClass("ActiveSelection");this.setActiveObject(new e(l,{canvas:this}),t)}return this._groupSelector=null,!0}clear(){this.textEditingManager.clear(),super.clear()}destroy(){this.removeListeners(),this.textEditingManager.dispose(),super.destroy()}}const Kr={x1:0,y1:0,x2:0,y2:0},Qr=A(A({},Kr),{},{r1:0,r2:0}),Jr=(t,e)=>isNaN(t)&&"number"==typeof e?e:t,Zr=/^(\d+\.\d+)%|(\d+)%$/;function $r(t){return t&&Zr.test(t)}function to(t,e){const n="number"==typeof t?t:"string"==typeof t?parseFloat(t)/($r(t)?100:1):NaN;return Bn(0,Jr(n,e),1)}const eo=/\s*;\s*/,no=/\s*:\s*/;function io(t,e){let n,i;const s=t.getAttribute("style");if(s){const t=s.split(eo);""===t[t.length-1]&&t.pop();for(let e=t.length;e--;){const[s,r]=t[e].split(no).map((t=>t.trim()));"stop-color"===s?n=r:"stop-opacity"===s&&(i=r)}}const r=new an(n||t.getAttribute("stop-color")||"rgb(0,0,0)");return{offset:to(t.getAttribute("offset"),0),color:r.toRgb(),opacity:Jr(parseFloat(i||t.getAttribute("stop-opacity")||""),1)*r.getAlpha()*e}}function so(t,e){const n=[],i=t.getElementsByTagName("stop"),s=to(e,1);for(let r=i.length;r--;)n.push(io(i[r],s));return n}function ro(t){return"linearGradient"===t.nodeName||"LINEARGRADIENT"===t.nodeName?"linear":"radial"}function oo(t){return"userSpaceOnUse"===t.getAttribute("gradientUnits")?"pixels":"percentage"}function ao(t,e){return t.getAttribute(e)}function ho(t,e){return function(t,e){let n,{width:i,height:s,gradientUnits:r}=e;return Object.keys(t).reduce(((e,o)=>{const a=t[o];return"Infinity"===a?n=1:"-Infinity"===a?n=0:(n="string"==typeof a?parseFloat(a):a,"string"==typeof a&&$r(a)&&(n*=.01,"pixels"===r&&("x1"!==o&&"x2"!==o&&"r2"!==o||(n*=i),"y1"!==o&&"y2"!==o||(n*=s)))),e[o]=n,e}),{})}("linear"===ro(t)?function(t){return{x1:ao(t,"x1")||0,y1:ao(t,"y1")||0,x2:ao(t,"x2")||"100%",y2:ao(t,"y2")||0}}(t):function(t){return{x1:ao(t,"fx")||ao(t,"cx")||"50%",y1:ao(t,"fy")||ao(t,"cy")||"50%",r1:0,x2:ao(t,"cx")||"50%",y2:ao(t,"cy")||"50%",r2:ao(t,"r")||"50%"}}(t),A(A({},e),{},{gradientUnits:oo(t)}))}class co{constructor(t){const{type:e="linear",gradientUnits:n="pixels",coords:i={},colorStops:s=[],offsetX:r=0,offsetY:o=0,gradientTransform:a,id:h}=t||{};Object.assign(this,{type:e,gradientUnits:n,coords:A(A({},"radial"===e?Qr:Kr),i),colorStops:s,offsetX:r,offsetY:o,gradientTransform:a,id:h?"".concat(h,"_").concat(Bt()):Bt()})}addColorStop(t){for(const e in t){const n=new an(t[e]);this.colorStops.push({offset:parseFloat(e),color:n.toRgb(),opacity:n.getAlpha()})}return this}toObject(t){return A(A({},ue(this,t)),{},{type:this.type,coords:A({},this.coords),colorStops:this.colorStops.map((t=>A({},t))),offsetX:this.offsetX,offsetY:this.offsetY,gradientUnits:this.gradientUnits,gradientTransform:this.gradientTransform?[...this.gradientTransform]:void 0})}toSVG(t){let{additionalTransform:e}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const n=[],i=this.gradientTransform?this.gradientTransform.concat():Q.concat(),s="pixels"===this.gradientUnits?"userSpaceOnUse":"objectBoundingBox",r=this.colorStops.map((t=>A({},t))).sort(((t,e)=>t.offset-e.offset));let o=-this.offsetX,a=-this.offsetY;var h;"objectBoundingBox"===s?(o/=t.width,a/=t.height):(o+=t.width/2,a+=t.height/2),(h=t)&&"function"==typeof h._renderPathCommands&&"percentage"!==this.gradientUnits&&(o-=t.pathOffset.x,a-=t.pathOffset.y),i[4]-=o,i[5]-=a;const c=['id="SVGID_'.concat(this.id,'"'),'gradientUnits="'.concat(s,'"'),'gradientTransform="'.concat(e?e+" ":"").concat(pe(i),'"'),""].join(" ");if("linear"===this.type){const{x1:t,y1:e,x2:i,y2:s}=this.coords;n.push("<linearGradient ",c,' x1="',t,'" y1="',e,'" x2="',i,'" y2="',s,'">\n')}else if("radial"===this.type){const{x1:t,y1:e,x2:i,y2:s,r1:o,r2:a}=this.coords,h=o>a;n.push("<radialGradient ",c,' cx="',h?t:i,'" cy="',h?e:s,'" r="',h?o:a,'" fx="',h?i:t,'" fy="',h?s:e,'">\n'),h&&(r.reverse(),r.forEach((t=>{t.offset=1-t.offset})));const l=Math.min(o,a);if(l>0){const t=l/Math.max(o,a);r.forEach((e=>{e.offset+=t*(1-e.offset)}))}}return r.forEach((t=>{let{color:e,offset:i,opacity:s}=t;n.push("<stop ",'offset="',100*i+"%",'" style="stop-color:',e,void 0!==s?";stop-opacity: "+s:";",'"/>\n')})),n.push("linear"===this.type?"</linearGradient>":"</radialGradient>","\n"),n.join("")}toLive(t){const{x1:e,y1:n,x2:i,y2:s,r1:r,r2:o}=this.coords,a="linear"===this.type?t.createLinearGradient(e,n,i,s):t.createRadialGradient(e,n,r,i,s,o);return this.colorStops.forEach((t=>{let{color:e,opacity:n,offset:i}=t;a.addColorStop(i,void 0!==n?new an(e).setAlpha(n).toRgba():e)})),a}static async fromObject(t){const{colorStops:e,gradientTransform:n}=t;return new this(A(A({},t),{},{colorStops:e?e.map((t=>A({},t))):void 0,gradientTransform:n?[...n]:void 0}))}static fromElement(t,e,n){const i=oo(t),s=e._findCenterFromElement();return new this(A({id:t.getAttribute("id")||void 0,type:ro(t),coords:ho(t,{width:n.viewBoxWidth||n.width,height:n.viewBoxHeight||n.height}),colorStops:so(t,n.opacity),gradientUnits:i,gradientTransform:Rs(t.getAttribute("gradientTransform")||"")},"pixels"===i?{offsetX:e.width/2-s.x,offsetY:e.height/2-s.y}:{offsetX:0,offsetY:0}))}}E(co,"type","Gradient"),Tt.setClass(co,"gradient"),Tt.setClass(co,"linear"),Tt.setClass(co,"radial");const lo=["type","source","patternTransform"];class uo{get type(){return"pattern"}set type(t){M("warn","Setting type has no effect",t)}constructor(t){E(this,"repeat","repeat"),E(this,"offsetX",0),E(this,"offsetY",0),E(this,"crossOrigin",""),this.id=Bt(),Object.assign(this,t)}isImageSource(){return!!this.source&&"string"==typeof this.source.src}isCanvasSource(){return!!this.source&&!!this.source.toDataURL}sourceToString(){return this.isImageSource()?this.source.src:this.isCanvasSource()?this.source.toDataURL():""}toLive(t){return this.source&&(!this.isImageSource()||this.source.complete&&0!==this.source.naturalWidth&&0!==this.source.naturalHeight)?t.createPattern(this.source,this.repeat):null}toObject(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];const{repeat:e,crossOrigin:n}=this;return A(A({},ue(this,t)),{},{type:"pattern",source:this.sourceToString(),repeat:e,crossOrigin:n,offsetX:ge(this.offsetX,P.NUM_FRACTION_DIGITS),offsetY:ge(this.offsetY,P.NUM_FRACTION_DIGITS),patternTransform:this.patternTransform?[...this.patternTransform]:null})}toSVG(t){let{width:e,height:n}=t;const{source:i,repeat:s,id:r}=this,o=Jr(this.offsetX/e,0),a=Jr(this.offsetY/n,0),h="repeat-y"===s||"no-repeat"===s?1+Math.abs(o||0):Jr(i.width/e,0),c="repeat-x"===s||"no-repeat"===s?1+Math.abs(a||0):Jr(i.height/n,0);return['<pattern id="SVGID_'.concat(r,'" x="').concat(o,'" y="').concat(a,'" width="').concat(h,'" height="').concat(c,'">'),'<image x="0" y="0" width="'.concat(i.width,'" height="').concat(i.height,'" xlink:href="').concat(this.sourceToString(),'"></image>'),"</pattern>",""].join("\n")}static async fromObject(t,e){let{type:n,source:i,patternTransform:s}=t,r=O(t,lo);const o=await he(i,A(A({},e),{},{crossOrigin:r.crossOrigin}));return new this(A(A({},r),{},{patternTransform:s&&s.slice(0),source:o}))}}E(uo,"type","Pattern"),Tt.setClass(uo),Tt.setClass(uo,"pattern");const go=["path","left","top"],po=["d"];class fo extends Vi{constructor(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},{path:n,left:i,top:s}=e,r=O(e,go);super(),Object.assign(this,fo.ownDefaults),this.setOptions(r),this._setPath(t||[],!0),"number"==typeof i&&this.set(tt,i),"number"==typeof s&&this.set(et,s)}_setPath(t,e){this.path=pr(Array.isArray(t)?t:Ir(t)),this.setBoundingBox(e)}_findCenterFromElement(){const t=this._calcBoundsFromPath();return new It(t.left+t.width/2,t.top+t.height/2)}_renderPathCommands(t){const e=-this.pathOffset.x,n=-this.pathOffset.y;t.beginPath();for(const i of this.path)switch(i[0]){case"L":t.lineTo(i[1]+e,i[2]+n);break;case"M":t.moveTo(i[1]+e,i[2]+n);break;case"C":t.bezierCurveTo(i[1]+e,i[2]+n,i[3]+e,i[4]+n,i[5]+e,i[6]+n);break;case"Q":t.quadraticCurveTo(i[1]+e,i[2]+n,i[3]+e,i[4]+n);break;case"Z":t.closePath()}}_render(t){this._renderPathCommands(t),this._renderPaintInOrder(t)}toString(){return"#<Path (".concat(this.complexity(),'): { "top": ').concat(this.top,', "left": ').concat(this.left," }>")}toObject(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];return A(A({},super.toObject(t)),{},{path:this.path.map((t=>t.slice()))})}toDatalessObject(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];const e=this.toObject(t);return this.sourcePath&&(delete e.path,e.sourcePath=this.sourcePath),e}_toSVG(){const t=Mr(this.path,P.NUM_FRACTION_DIGITS);return["<path ","COMMON_PARTS",'d="'.concat(t,'" stroke-linecap="round" />\n')]}_getOffsetTransform(){const t=P.NUM_FRACTION_DIGITS;return" translate(".concat(ge(-this.pathOffset.x,t),", ").concat(ge(-this.pathOffset.y,t),")")}toClipPathSVG(t){const e=this._getOffsetTransform();return"\t"+this._createBaseClipPathSVGMarkup(this._toSVG(),{reviver:t,additionalTransform:e})}toSVG(t){const e=this._getOffsetTransform();return this._createBaseSVGMarkup(this._toSVG(),{reviver:t,additionalTransform:e})}complexity(){return this.path.length}setDimensions(){this.setBoundingBox()}setBoundingBox(t){const{width:e,height:n,pathOffset:i}=this._calcDimensions();this.set({width:e,height:n,pathOffset:i}),t&&this.setPositionByOrigin(i,$,$)}_calcBoundsFromPath(){const t=[];let e=0,n=0,i=0,s=0;for(const r of this.path)switch(r[0]){case"L":i=r[1],s=r[2],t.push({x:e,y:n},{x:i,y:s});break;case"M":i=r[1],s=r[2],e=i,n=s;break;case"C":t.push(...dr(i,s,r[1],r[2],r[3],r[4],r[5],r[6])),i=r[5],s=r[6];break;case"Q":t.push(...dr(i,s,r[1],r[2],r[1],r[2],r[3],r[4])),i=r[3],s=r[4];break;case"Z":i=e,s=n}return Pe(t)}_calcDimensions(){const t=this._calcBoundsFromPath();return A(A({},t),{},{pathOffset:new It(t.left+t.width/2,t.top+t.height/2)})}static fromObject(t){return this._fromObject(t,{extraParam:"path"})}static async fromElement(t,e,n){const i=Ws(t,this.ATTRIBUTE_NAMES,n),{d:s}=i;return new this(s,A(A(A({},O(i,po)),e),{},{left:void 0,top:void 0}))}}E(fo,"type","Path"),E(fo,"cacheProperties",[...Yn,"path","fillRule"]),E(fo,"ATTRIBUTE_NAMES",[...hs,"d"]),Tt.setClass(fo),Tt.setSVGClass(fo);const mo=["left","top","radius"],_o=["radius","startAngle","endAngle","counterClockwise"];class vo extends Vi{static getDefaults(){return A(A({},super.getDefaults()),vo.ownDefaults)}constructor(t){super(),Object.assign(this,vo.ownDefaults),this.setOptions(t)}_set(t,e){return super._set(t,e),"radius"===t&&this.setRadius(e),this}_render(t){t.beginPath(),t.arc(0,0,this.radius,Vt(this.startAngle),Vt(this.endAngle),this.counterClockwise),this._renderPaintInOrder(t)}getRadiusX(){return this.get("radius")*this.get(mt)}getRadiusY(){return this.get("radius")*this.get(_t)}setRadius(t){this.radius=t,this.set({width:2*t,height:2*t})}toObject(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];return super.toObject([..._o,...t])}_toSVG(){const t=(this.endAngle-this.startAngle)%360;if(0===t)return["<circle ","COMMON_PARTS",'cx="0" cy="0" ','r="',"".concat(this.radius),'" />\n'];{const{radius:e}=this,n=Vt(this.startAngle),i=Vt(this.endAngle),s=Ot(n)*e,r=Dt(n)*e,o=Ot(i)*e,a=Dt(i)*e,h=t>180?1:0,c=this.counterClockwise?0:1;return['<path d="M '.concat(s," ").concat(r," A ").concat(e," ").concat(e," 0 ").concat(h," ").concat(c," ").concat(o," ").concat(a,'" '),"COMMON_PARTS"," />\n"]}}static async fromElement(t,e,n){const i=Ws(t,this.ATTRIBUTE_NAMES,n),{left:s=0,top:r=0,radius:o=0}=i;return new this(A(A({},O(i,mo)),{},{radius:o,left:s-o,top:r-o}))}static fromObject(t){return super._fromObject(t)}}E(vo,"type","Circle"),E(vo,"cacheProperties",[...Yn,..._o]),E(vo,"ownDefaults",{radius:0,startAngle:0,endAngle:360,counterClockwise:!1}),E(vo,"ATTRIBUTE_NAMES",["cx","cy","r",...hs]),Tt.setClass(vo),Tt.setSVGClass(vo);const yo=["x1","y1","x2","y2"],Co=["x1","y1","x2","y2"],bo=["x1","x2","y1","y2"];class wo extends Vi{constructor(){let[t,e,n,i]=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[0,0,0,0],s=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};super(),Object.assign(this,wo.ownDefaults),this.setOptions(s),this.x1=t,this.x2=n,this.y1=e,this.y2=i,this._setWidthHeight();const{left:r,top:o}=s;"number"==typeof r&&this.set(tt,r),"number"==typeof o&&this.set(et,o)}_setWidthHeight(){const{x1:t,y1:e,x2:n,y2:i}=this;this.width=Math.abs(n-t),this.height=Math.abs(i-e);const{left:s,top:r,width:o,height:a}=Pe([{x:t,y:e},{x:n,y:i}]),h=new It(s+o/2,r+a/2);this.setPositionByOrigin(h,$,$)}_set(t,e){return super._set(t,e),bo.includes(t)&&this._setWidthHeight(),this}_render(t){t.beginPath();const e=this.calcLinePoints();t.moveTo(e.x1,e.y1),t.lineTo(e.x2,e.y2),t.lineWidth=this.strokeWidth;const n=t.strokeStyle;var i;fe(this.stroke)?t.strokeStyle=this.stroke.toLive(t):t.strokeStyle=null!==(i=this.stroke)&&void 0!==i?i:t.fillStyle,this.stroke&&this._renderStroke(t),t.strokeStyle=n}_findCenterFromElement(){return new It((this.x1+this.x2)/2,(this.y1+this.y2)/2)}toObject(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];return A(A({},super.toObject(t)),this.calcLinePoints())}_getNonTransformedDimensions(){const t=super._getNonTransformedDimensions();return"butt"===this.strokeLineCap&&(0===this.width&&(t.y-=this.strokeWidth),0===this.height&&(t.x-=this.strokeWidth)),t}calcLinePoints(){const{x1:t,x2:e,y1:n,y2:i,width:s,height:r}=this,o=t<=e?-1:1,a=n<=i?-1:1;return{x1:o*s/2,x2:o*-s/2,y1:a*r/2,y2:a*-r/2}}_toSVG(){const{x1:t,x2:e,y1:n,y2:i}=this.calcLinePoints();return["<line ","COMMON_PARTS",'x1="'.concat(t,'" y1="').concat(n,'" x2="').concat(e,'" y2="').concat(i,'" />\n')]}static async fromElement(t,e,n){const i=Ws(t,this.ATTRIBUTE_NAMES,n),{x1:s=0,y1:r=0,x2:o=0,y2:a=0}=i;return new this([s,r,o,a],O(i,yo))}static fromObject(t){let{x1:e,y1:n,x2:i,y2:s}=t,r=O(t,Co);return this._fromObject(A(A({},r),{},{points:[e,n,i,s]}),{extraParam:"points"})}}E(wo,"type","Line"),E(wo,"cacheProperties",[...Yn,...bo]),E(wo,"ATTRIBUTE_NAMES",hs.concat(bo)),Tt.setClass(wo),Tt.setSVGClass(wo);class xo extends Vi{static getDefaults(){return A(A({},super.getDefaults()),xo.ownDefaults)}constructor(t){super(),Object.assign(this,xo.ownDefaults),this.setOptions(t)}_render(t){const e=this.width/2,n=this.height/2;t.beginPath(),t.moveTo(-e,n),t.lineTo(0,-n),t.lineTo(e,n),t.closePath(),this._renderPaintInOrder(t)}_toSVG(){const t=this.width/2,e=this.height/2;return["<polygon ","COMMON_PARTS",'points="',"".concat(-t," ").concat(e,",0 ").concat(-e,",").concat(t," ").concat(e),'" />']}}E(xo,"type","Triangle"),E(xo,"ownDefaults",{width:100,height:100}),Tt.setClass(xo),Tt.setSVGClass(xo);const So=["rx","ry"];class To extends Vi{static getDefaults(){return A(A({},super.getDefaults()),To.ownDefaults)}constructor(t){super(),Object.assign(this,To.ownDefaults),this.setOptions(t)}_set(t,e){switch(super._set(t,e),t){case"rx":this.rx=e,this.set("width",2*e);break;case"ry":this.ry=e,this.set("height",2*e)}return this}getRx(){return this.get("rx")*this.get(mt)}getRy(){return this.get("ry")*this.get(_t)}toObject(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];return super.toObject([...So,...t])}_toSVG(){return["<ellipse ","COMMON_PARTS",'cx="0" cy="0" rx="'.concat(this.rx,'" ry="').concat(this.ry,'" />\n')]}_render(t){t.beginPath(),t.save(),t.transform(1,0,0,this.ry/this.rx,0,0),t.arc(0,0,this.rx,0,q,!1),t.restore(),this._renderPaintInOrder(t)}static async fromElement(t,e,n){const i=Ws(t,this.ATTRIBUTE_NAMES,n);return i.left=(i.left||0)-i.rx,i.top=(i.top||0)-i.ry,new this(i)}}function Eo(t){if(!t)return[];const e=t.replace(/,/g," ").trim().split(/\s+/),n=[];for(let i=0;i<e.length;i+=2)n.push({x:parseFloat(e[i]),y:parseFloat(e[i+1])});return n}E(To,"type","Ellipse"),E(To,"cacheProperties",[...Yn,...So]),E(To,"ownDefaults",{rx:0,ry:0}),E(To,"ATTRIBUTE_NAMES",[...hs,"cx","cy","rx","ry"]),Tt.setClass(To),Tt.setSVGClass(To);const ko=["left","top"],Ao={exactBoundingBox:!1};class Oo extends Vi{static getDefaults(){return A(A({},super.getDefaults()),Oo.ownDefaults)}constructor(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};super(),E(this,"strokeDiff",void 0),Object.assign(this,Oo.ownDefaults),this.setOptions(e),this.points=t;const{left:n,top:i}=e;this.initialized=!0,this.setBoundingBox(!0),"number"==typeof n&&this.set(tt,n),"number"==typeof i&&this.set(et,i)}isOpen(){return!0}_projectStrokeOnPoints(t){return Ji(this.points,t,this.isOpen())}_calcDimensions(t){t=A({scaleX:this.scaleX,scaleY:this.scaleY,skewX:this.skewX,skewY:this.skewY,strokeLineCap:this.strokeLineCap,strokeLineJoin:this.strokeLineJoin,strokeMiterLimit:this.strokeMiterLimit,strokeUniform:this.strokeUniform,strokeWidth:this.strokeWidth},t||{});const e=this.exactBoundingBox?this._projectStrokeOnPoints(t).map((t=>t.projectedPoint)):this.points;if(0===e.length)return{left:0,top:0,width:0,height:0,pathOffset:new It,strokeOffset:new It,strokeDiff:new It};const n=Pe(e),i=oe(A(A({},t),{},{scaleX:1,scaleY:1})),s=Pe(this.points.map((t=>qt(t,i,!0)))),r=new It(this.scaleX,this.scaleY);let o=n.left+n.width/2,a=n.top+n.height/2;return this.exactBoundingBox&&(o-=a*Math.tan(Vt(this.skewX)),a-=o*Math.tan(Vt(this.skewY))),A(A({},n),{},{pathOffset:new It(o,a),strokeOffset:new It(s.left,s.top).subtract(new It(n.left,n.top)).multiply(r),strokeDiff:new It(n.width,n.height).subtract(new It(s.width,s.height)).multiply(r)})}_findCenterFromElement(){const t=Pe(this.points);return new It(t.left+t.width/2,t.top+t.height/2)}setDimensions(){this.setBoundingBox()}setBoundingBox(t){const{left:e,top:n,width:i,height:s,pathOffset:r,strokeOffset:o,strokeDiff:a}=this._calcDimensions();this.set({width:i,height:s,pathOffset:r,strokeOffset:o,strokeDiff:a}),t&&this.setPositionByOrigin(new It(e+i/2,n+s/2),$,$)}isStrokeAccountedForInDimensions(){return this.exactBoundingBox}_getNonTransformedDimensions(){return this.exactBoundingBox?new It(this.width,this.height):super._getNonTransformedDimensions()}_getTransformedDimensions(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};if(this.exactBoundingBox){let r;if(Object.keys(t).some((t=>this.strokeUniform||this.constructor.layoutProperties.includes(t)))){var e,n;const{width:i,height:s}=this._calcDimensions(t);r=new It(null!==(e=t.width)&&void 0!==e?e:i,null!==(n=t.height)&&void 0!==n?n:s)}else{var i,s;r=new It(null!==(i=t.width)&&void 0!==i?i:this.width,null!==(s=t.height)&&void 0!==s?s:this.height)}return r.multiply(new It(t.scaleX||this.scaleX,t.scaleY||this.scaleY))}return super._getTransformedDimensions(t)}_set(t,e){const n=this.initialized&&this[t]!==e,i=super._set(t,e);return this.exactBoundingBox&&n&&((t===mt||t===_t)&&this.strokeUniform&&this.constructor.layoutProperties.includes("strokeUniform")||this.constructor.layoutProperties.includes(t))&&this.setDimensions(),i}toObject(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];return A(A({},super.toObject(t)),{},{points:this.points.map((t=>{let{x:e,y:n}=t;return{x:e,y:n}}))})}_toSVG(){const t=[],e=this.pathOffset.x,n=this.pathOffset.y,i=P.NUM_FRACTION_DIGITS;for(let s=0,r=this.points.length;s<r;s++)t.push(ge(this.points[s].x-e,i),",",ge(this.points[s].y-n,i)," ");return["<".concat(this.constructor.type.toLowerCase()," "),"COMMON_PARTS",'points="'.concat(t.join(""),'" />\n')]}_render(t){const e=this.points.length,n=this.pathOffset.x,i=this.pathOffset.y;if(e&&!isNaN(this.points[e-1].y)){t.beginPath(),t.moveTo(this.points[0].x-n,this.points[0].y-i);for(let s=0;s<e;s++){const e=this.points[s];t.lineTo(e.x-n,e.y-i)}!this.isOpen()&&t.closePath(),this._renderPaintInOrder(t)}}complexity(){return this.points.length}static async fromElement(t,e,n){return new this(Eo(t.getAttribute("points")),A(A({},O(Ws(t,this.ATTRIBUTE_NAMES,n),ko)),e))}static fromObject(t){return this._fromObject(t,{extraParam:"points"})}}E(Oo,"ownDefaults",Ao),E(Oo,"type","Polyline"),E(Oo,"layoutProperties",[vt,yt,"strokeLineCap","strokeLineJoin","strokeMiterLimit","strokeWidth","strokeUniform","points"]),E(Oo,"cacheProperties",[...Yn,"points"]),E(Oo,"ATTRIBUTE_NAMES",[...hs]),Tt.setClass(Oo),Tt.setSVGClass(Oo);class Do extends Oo{isOpen(){return!1}}E(Do,"ownDefaults",Ao),E(Do,"type","Polygon"),Tt.setClass(Do),Tt.setSVGClass(Do);const Io=["fontSize","fontWeight","fontFamily","fontStyle"],Po=["underline","overline","linethrough"],Mo=[...Io,"lineHeight","text","charSpacing","textAlign","styles","path","pathStartOffset","pathSide","pathAlign"],Ro=[...Mo,...Po,"textBackgroundColor","direction"],Fo=[...Io,...Po,bt,"strokeWidth",Ct,"deltaY","textBackgroundColor"],Lo={_reNewline:rt,_reSpacesAndTabs:/[ \t\r]/g,_reSpaceAndTab:/[ \t\r]/,_reWords:/\S+/g,fontSize:40,fontWeight:"normal",fontFamily:"Times New Roman",underline:!1,overline:!1,linethrough:!1,textAlign:tt,fontStyle:"normal",lineHeight:1.16,superscript:{size:.6,baseline:-.35},subscript:{size:.6,baseline:.11},textBackgroundColor:"",stroke:null,shadow:null,path:void 0,pathStartOffset:0,pathSide:tt,pathAlign:"baseline",_fontSizeFraction:.222,offsets:{underline:.1,linethrough:-.315,overline:-.88},_fontSizeMult:1.13,charSpacing:0,deltaY:0,direction:"ltr",CACHE_FONT_SIZE:400,MIN_TEXT_WIDTH:2},jo="justify",No="justify-left",Bo="justify-right",Wo="justify-center";class Yo extends Vi{isEmptyStyles(t){if(!this.styles)return!0;if(void 0!==t&&!this.styles[t])return!0;const e=void 0===t?this.styles:{line:this.styles[t]};for(const n in e)for(const t in e[n])for(const i in e[n][t])return!1;return!0}styleHas(t,e){if(!this.styles)return!1;if(void 0!==e&&!this.styles[e])return!1;const n=void 0===e?this.styles:{0:this.styles[e]};for(const i in n)for(const e in n[i])if(void 0!==n[i][e][t])return!0;return!1}cleanStyle(t){if(!this.styles)return!1;const e=this.styles;let n,i,s=0,r=!0,o=0;for(const a in e){n=0;for(const o in e[a]){const h=e[a][o]||{};s++,void 0!==h[t]?(i?h[t]!==i&&(r=!1):i=h[t],h[t]===this[t]&&delete h[t]):r=!1,0!==Object.keys(h).length?n++:delete e[a][o]}0===n&&delete e[a]}for(let a=0;a<this._textLines.length;a++)o+=this._textLines[a].length;r&&s===o&&(this[t]=i,this.removeStyle(t))}removeStyle(t){if(!this.styles)return;const e=this.styles;let n,i,s;for(i in e){for(s in n=e[i],n)delete n[s][t],0===Object.keys(n[s]).length&&delete n[s];0===Object.keys(n).length&&delete e[i]}}_extendStyles(t,e){const{lineIndex:n,charIndex:i}=this.get2DCursorLocation(t);this._getLineStyle(n)||this._setLineStyle(n);const s=de(A(A({},this._getStyleDeclaration(n,i)),e),(t=>void 0!==t));this._setStyleDeclaration(n,i,s)}getSelectionStyles(t,e,n){const i=[];for(let s=t;s<(e||t);s++)i.push(this.getStyleAtPosition(s,n));return i}getStyleAtPosition(t,e){const{lineIndex:n,charIndex:i}=this.get2DCursorLocation(t);return e?this.getCompleteStyleDeclaration(n,i):this._getStyleDeclaration(n,i)}setSelectionStyles(t,e,n){for(let i=e;i<(n||e);i++)this._extendStyles(i,t);this._forceClearCache=!0}_getStyleDeclaration(t,e){var n;const i=this.styles&&this.styles[t];return i&&null!==(n=i[e])&&void 0!==n?n:{}}getCompleteStyleDeclaration(t,e){return A(A({},ue(this,this.constructor._styleProperties)),this._getStyleDeclaration(t,e))}_setStyleDeclaration(t,e,n){this.styles[t][e]=n}_deleteStyleDeclaration(t,e){delete this.styles[t][e]}_getLineStyle(t){return!!this.styles[t]}_setLineStyle(t){this.styles[t]={}}_deleteLineStyle(t){delete this.styles[t]}}E(Yo,"_styleProperties",Fo);const Uo=/  +/g,Xo=/"/g;function Go(t,e,n,i,s){return"\t\t".concat(function(t,e){let{left:n,top:i,width:s,height:r}=e,o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:P.NUM_FRACTION_DIGITS;const a=ln(Ct,t,!1),[h,c,l,u]=[n,i,s,r].map((t=>ge(t,o)));return"<rect ".concat(a,' x="').concat(h,'" y="').concat(c,'" width="').concat(l,'" height="').concat(u,'"></rect>')}(t,{left:e,top:n,width:i,height:s}),"\n")}const Vo=["textAnchor","textDecoration","dx","dy","top","left","fontSize","strokeWidth"];let Ho;class zo extends Yo{static getDefaults(){return A(A({},super.getDefaults()),zo.ownDefaults)}constructor(t,e){super(),E(this,"__charBounds",[]),Object.assign(this,zo.ownDefaults),this.setOptions(e),this.styles||(this.styles={}),this.text=t,this.initialized=!0,this.path&&this.setPathInfo(),this.initDimensions(),this.setCoords()}setPathInfo(){const t=this.path;t&&(t.segmentsInfo=Tr(t.path))}_splitText(){const t=this._splitTextIntoLines(this.text);return this.textLines=t.lines,this._textLines=t.graphemeLines,this._unwrappedTextLines=t._unwrappedLines,this._text=t.graphemeText,t}initDimensions(){this._splitText(),this._clearCache(),this.dirty=!0,this.path?(this.width=this.path.width,this.height=this.path.height):(this.width=this.calcTextWidth()||this.cursorWidth||this.MIN_TEXT_WIDTH,this.height=this.calcTextHeight()),this.textAlign.includes(jo)&&this.enlargeSpaces()}enlargeSpaces(){let t,e,n,i,s,r,o;for(let a=0,h=this._textLines.length;a<h;a++)if((this.textAlign===jo||a!==h-1&&!this.isEndOfWrapping(a))&&(i=0,s=this._textLines[a],e=this.getLineWidth(a),e<this.width&&(o=this.textLines[a].match(this._reSpacesAndTabs)))){n=o.length,t=(this.width-e)/n;for(let e=0;e<=s.length;e++)r=this.__charBounds[a][e],this._reSpaceAndTab.test(s[e])?(r.width+=t,r.kernedWidth+=t,r.left+=i,i+=t):r.left+=i}}isEndOfWrapping(t){return t===this._textLines.length-1}missingNewlineOffset(t){return 1}get2DCursorLocation(t,e){const n=e?this._unwrappedTextLines:this._textLines;let i;for(i=0;i<n.length;i++){if(t<=n[i].length)return{lineIndex:i,charIndex:t};t-=n[i].length+this.missingNewlineOffset(i,e)}return{lineIndex:i-1,charIndex:n[i-1].length<t?n[i-1].length:t}}toString(){return"#<Text (".concat(this.complexity(),'): { "text": "').concat(this.text,'", "fontFamily": "').concat(this.fontFamily,'" }>')}_getCacheCanvasDimensions(){const t=super._getCacheCanvasDimensions(),e=this.fontSize;return t.width+=e*t.zoomX,t.height+=e*t.zoomY,t}_render(t){const e=this.path;e&&!e.isNotVisible()&&e._render(t),this._setTextStyles(t),this._renderTextLinesBackground(t),this._renderTextDecoration(t,"underline"),this._renderText(t),this._renderTextDecoration(t,"overline"),this._renderTextDecoration(t,"linethrough")}_renderText(t){this.paintFirst===bt?(this._renderTextStroke(t),this._renderTextFill(t)):(this._renderTextFill(t),this._renderTextStroke(t))}_setTextStyles(t,e,n){if(t.textBaseline="alphabetic",this.path)switch(this.pathAlign){case $:t.textBaseline="middle";break;case"ascender":t.textBaseline=et;break;case"descender":t.textBaseline=nt}t.font=this._getFontDeclaration(e,n)}calcTextWidth(){let t=this.getLineWidth(0);for(let e=1,n=this._textLines.length;e<n;e++){const n=this.getLineWidth(e);n>t&&(t=n)}return t}_renderTextLine(t,e,n,i,s,r){this._renderChars(t,e,n,i,s,r)}_renderTextLinesBackground(t){if(!this.textBackgroundColor&&!this.styleHas("textBackgroundColor"))return;const e=t.fillStyle,n=this._getLeftOffset();let i=this._getTopOffset();for(let s=0,r=this._textLines.length;s<r;s++){const e=this.getHeightOfLine(s);if(!this.textBackgroundColor&&!this.styleHas("textBackgroundColor",s)){i+=e;continue}const r=this._textLines[s].length,o=this._getLineLeftOffset(s);let a,h,c=0,l=0,u=this.getValueOfPropertyAt(s,0,"textBackgroundColor");for(let d=0;d<r;d++){const r=this.__charBounds[s][d];h=this.getValueOfPropertyAt(s,d,"textBackgroundColor"),this.path?(t.save(),t.translate(r.renderLeft,r.renderTop),t.rotate(r.angle),t.fillStyle=h,h&&t.fillRect(-r.width/2,-e/this.lineHeight*(1-this._fontSizeFraction),r.width,e/this.lineHeight),t.restore()):h!==u?(a=n+o+l,"rtl"===this.direction&&(a=this.width-a-c),t.fillStyle=u,u&&t.fillRect(a,i,c,e/this.lineHeight),l=r.left,c=r.width,u=h):c+=r.kernedWidth}h&&!this.path&&(a=n+o+l,"rtl"===this.direction&&(a=this.width-a-c),t.fillStyle=h,t.fillRect(a,i,c,e/this.lineHeight)),i+=e}t.fillStyle=e,this._removeShadow(t)}_measureChar(t,e,n,i){const s=G.getFontCache(e),r=this._getFontDeclaration(e),o=n+t,a=n&&r===this._getFontDeclaration(i),h=e.fontSize/this.CACHE_FONT_SIZE;let c,l,u,d;if(n&&void 0!==s[n]&&(u=s[n]),void 0!==s[t]&&(d=c=s[t]),a&&void 0!==s[o]&&(l=s[o],d=l-u),void 0===c||void 0===u||void 0===l){const i=function(){if(!Ho){const t=Ut({width:0,height:0});Ho=t.getContext("2d")}return Ho}();this._setTextStyles(i,e,!0),void 0===c&&(d=c=i.measureText(t).width,s[t]=c),void 0===u&&a&&n&&(u=i.measureText(n).width,s[n]=u),a&&void 0===l&&(l=i.measureText(o).width,s[o]=l,d=l-u)}return{width:c*h,kernedWidth:d*h}}getHeightOfChar(t,e){return this.getValueOfPropertyAt(t,e,"fontSize")}measureLine(t){const e=this._measureLine(t);return 0!==this.charSpacing&&(e.width-=this._getWidthOfCharSpacing()),e.width<0&&(e.width=0),e}_measureLine(t){let e,n,i=0;const s=this.pathSide===it,r=this.path,o=this._textLines[t],a=o.length,h=new Array(a);this.__charBounds[t]=h;for(let c=0;c<a;c++){const s=o[c];n=this._getGraphemeBox(s,t,c,e),h[c]=n,i+=n.kernedWidth,e=s}if(h[a]={left:n?n.left+n.width:0,width:0,kernedWidth:0,height:this.fontSize,deltaY:0},r&&r.segmentsInfo){let t=0;const e=r.segmentsInfo[r.segmentsInfo.length-1].length;switch(this.textAlign){case tt:t=s?e-i:0;break;case $:t=(e-i)/2;break;case it:t=s?0:e-i}t+=this.pathStartOffset*(s?-1:1);for(let i=s?a-1:0;s?i>=0:i<a;s?i--:i++)n=h[i],t>e?t%=e:t<0&&(t+=e),this._setGraphemeOnPath(t,n),t+=n.kernedWidth}return{width:i,numOfSpaces:0}}_setGraphemeOnPath(t,e){const n=t+e.kernedWidth/2,i=this.path,s=Er(i.path,n,i.segmentsInfo);e.renderLeft=s.x-i.pathOffset.x,e.renderTop=s.y-i.pathOffset.y,e.angle=s.angle+(this.pathSide===it?Math.PI:0)}_getGraphemeBox(t,e,n,i,s){const r=this.getCompleteStyleDeclaration(e,n),o=i?this.getCompleteStyleDeclaration(e,n-1):{},a=this._measureChar(t,r,i,o);let h,c=a.kernedWidth,l=a.width;0!==this.charSpacing&&(h=this._getWidthOfCharSpacing(),l+=h,c+=h);const u={width:l,left:0,height:r.fontSize,kernedWidth:c,deltaY:r.deltaY};if(n>0&&!s){const t=this.__charBounds[e][n-1];u.left=t.left+t.width+a.kernedWidth-a.width}return u}getHeightOfLine(t){if(this.__lineHeights[t])return this.__lineHeights[t];let e=this.getHeightOfChar(t,0);for(let n=1,i=this._textLines[t].length;n<i;n++)e=Math.max(this.getHeightOfChar(t,n),e);return this.__lineHeights[t]=e*this.lineHeight*this._fontSizeMult}calcTextHeight(){let t,e=0;for(let n=0,i=this._textLines.length;n<i;n++)t=this.getHeightOfLine(n),e+=n===i-1?t/this.lineHeight:t;return e}_getLeftOffset(){return"ltr"===this.direction?-this.width/2:this.width/2}_getTopOffset(){return-this.height/2}_renderTextCommon(t,e){t.save();let n=0;const i=this._getLeftOffset(),s=this._getTopOffset();for(let r=0,o=this._textLines.length;r<o;r++){const o=this.getHeightOfLine(r),a=o/this.lineHeight,h=this._getLineLeftOffset(r);this._renderTextLine(e,t,this._textLines[r],i+h,s+n+a,r),n+=o}t.restore()}_renderTextFill(t){(this.fill||this.styleHas(Ct))&&this._renderTextCommon(t,"fillText")}_renderTextStroke(t){(this.stroke&&0!==this.strokeWidth||!this.isEmptyStyles())&&(this.shadow&&!this.shadow.affectStroke&&this._removeShadow(t),t.save(),this._setLineDash(t,this.strokeDashArray),t.beginPath(),this._renderTextCommon(t,"strokeText"),t.closePath(),t.restore())}_renderChars(t,e,n,i,s,r){const o=this.getHeightOfLine(r),a=this.textAlign.includes(jo),h=this.path,c=!a&&0===this.charSpacing&&this.isEmptyStyles(r)&&!h,l="ltr"===this.direction,u="ltr"===this.direction?1:-1,d=e.direction;let g,p,f,m,_,v="",y=0;if(e.save(),d!==this.direction&&(e.canvas.setAttribute("dir",l?"ltr":"rtl"),e.direction=l?"ltr":"rtl",e.textAlign=l?tt:it),s-=o*this._fontSizeFraction/this.lineHeight,c)return this._renderChar(t,e,r,0,n.join(""),i,s),void e.restore();for(let C=0,b=n.length-1;C<=b;C++)m=C===b||this.charSpacing||h,v+=n[C],f=this.__charBounds[r][C],0===y?(i+=u*(f.kernedWidth-f.width),y+=f.width):y+=f.kernedWidth,a&&!m&&this._reSpaceAndTab.test(n[C])&&(m=!0),m||(g=g||this.getCompleteStyleDeclaration(r,C),p=this.getCompleteStyleDeclaration(r,C+1),m=rs(g,p,!1)),m&&(h?(e.save(),e.translate(f.renderLeft,f.renderTop),e.rotate(f.angle),this._renderChar(t,e,r,C,v,-y/2,0),e.restore()):(_=i,this._renderChar(t,e,r,C,v,_,s)),v="",g=p,i+=u*y,y=0);e.restore()}_applyPatternGradientTransformText(t){const e=this.width+this.strokeWidth,n=this.height+this.strokeWidth,i=Ut({width:e,height:n}),s=i.getContext("2d");return i.width=e,i.height=n,s.beginPath(),s.moveTo(0,0),s.lineTo(e,0),s.lineTo(e,n),s.lineTo(0,n),s.closePath(),s.translate(e/2,n/2),s.fillStyle=t.toLive(s),this._applyPatternGradientTransform(s,t),s.fill(),s.createPattern(i,"no-repeat")}handleFiller(t,e,n){let i,s;return fe(n)?"percentage"===n.gradientUnits||n.gradientTransform||n.patternTransform?(i=-this.width/2,s=-this.height/2,t.translate(i,s),t[e]=this._applyPatternGradientTransformText(n),{offsetX:i,offsetY:s}):(t[e]=n.toLive(t),this._applyPatternGradientTransform(t,n)):(t[e]=n,{offsetX:0,offsetY:0})}_setStrokeStyles(t,e){let{stroke:n,strokeWidth:i}=e;return t.lineWidth=i,t.lineCap=this.strokeLineCap,t.lineDashOffset=this.strokeDashOffset,t.lineJoin=this.strokeLineJoin,t.miterLimit=this.strokeMiterLimit,this.handleFiller(t,"strokeStyle",n)}_setFillStyles(t,e){let{fill:n}=e;return this.handleFiller(t,"fillStyle",n)}_renderChar(t,e,n,i,s,r,o){const a=this._getStyleDeclaration(n,i),h=this.getCompleteStyleDeclaration(n,i),c="fillText"===t&&h.fill,l="strokeText"===t&&h.stroke&&h.strokeWidth;if(l||c){if(e.save(),e.font=this._getFontDeclaration(h),a.textBackgroundColor&&this._removeShadow(e),a.deltaY&&(o+=a.deltaY),c){const t=this._setFillStyles(e,h);e.fillText(s,r-t.offsetX,o-t.offsetY)}if(l){const t=this._setStrokeStyles(e,h);e.strokeText(s,r-t.offsetX,o-t.offsetY)}e.restore()}}setSuperscript(t,e){this._setScript(t,e,this.superscript)}setSubscript(t,e){this._setScript(t,e,this.subscript)}_setScript(t,e,n){const i=this.get2DCursorLocation(t,!0),s=this.getValueOfPropertyAt(i.lineIndex,i.charIndex,"fontSize"),r=this.getValueOfPropertyAt(i.lineIndex,i.charIndex,"deltaY"),o={fontSize:s*n.size,deltaY:r+s*n.baseline};this.setSelectionStyles(o,t,e)}_getLineLeftOffset(t){const e=this.getLineWidth(t),n=this.width-e,i=this.textAlign,s=this.direction,r=this.isEndOfWrapping(t);let o=0;return i===jo||i===Wo&&!r||i===Bo&&!r||i===No&&!r?0:(i===$&&(o=n/2),i===it&&(o=n),i===Wo&&(o=n/2),i===Bo&&(o=n),"rtl"===s&&(i===it||i===jo||i===Bo?o=0:i===tt||i===No?o=-n:i!==$&&i!==Wo||(o=-n/2)),o)}_clearCache(){this._forceClearCache=!1,this.__lineWidths=[],this.__lineHeights=[],this.__charBounds=[]}getLineWidth(t){if(void 0!==this.__lineWidths[t])return this.__lineWidths[t];const{width:e}=this.measureLine(t);return this.__lineWidths[t]=e,e}_getWidthOfCharSpacing(){return 0!==this.charSpacing?this.fontSize*this.charSpacing/1e3:0}getValueOfPropertyAt(t,e,n){var i;return null!==(i=this._getStyleDeclaration(t,e)[n])&&void 0!==i?i:this[n]}_renderTextDecoration(t,e){if(!this[e]&&!this.styleHas(e))return;let n=this._getTopOffset();const i=this._getLeftOffset(),s=this.path,r=this._getWidthOfCharSpacing(),o=this.offsets[e];for(let a=0,h=this._textLines.length;a<h;a++){const h=this.getHeightOfLine(a);if(!this[e]&&!this.styleHas(e,a)){n+=h;continue}const c=this._textLines[a],l=h/this.lineHeight,u=this._getLineLeftOffset(a);let d,g,p=0,f=0,m=this.getValueOfPropertyAt(a,0,e),_=this.getValueOfPropertyAt(a,0,Ct);const v=n+l*(1-this._fontSizeFraction);let y=this.getHeightOfChar(a,0),C=this.getValueOfPropertyAt(a,0,"deltaY");for(let n=0,r=c.length;n<r;n++){const r=this.__charBounds[a][n];d=this.getValueOfPropertyAt(a,n,e),g=this.getValueOfPropertyAt(a,n,Ct);const h=this.getHeightOfChar(a,n),c=this.getValueOfPropertyAt(a,n,"deltaY");if(s&&d&&g)t.save(),t.fillStyle=_,t.translate(r.renderLeft,r.renderTop),t.rotate(r.angle),t.fillRect(-r.kernedWidth/2,o*h+c,r.kernedWidth,this.fontSize/15),t.restore();else if((d!==m||g!==_||h!==y||c!==C)&&f>0){let e=i+u+p;"rtl"===this.direction&&(e=this.width-e-f),m&&_&&(t.fillStyle=_,t.fillRect(e,v+o*y+C,f,this.fontSize/15)),p=r.left,f=r.width,m=d,_=g,y=h,C=c}else f+=r.kernedWidth}let b=i+u+p;"rtl"===this.direction&&(b=this.width-b-f),t.fillStyle=g,d&&g&&t.fillRect(b,v+o*y+C,f-r,this.fontSize/15),n+=h}this._removeShadow(t)}_getFontDeclaration(){let{fontFamily:t=this.fontFamily,fontStyle:e=this.fontStyle,fontWeight:n=this.fontWeight,fontSize:i=this.fontSize}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},s=arguments.length>1?arguments[1]:void 0;const r=t.includes("'")||t.includes('"')||t.includes(",")||zo.genericFonts.includes(t.toLowerCase())?t:'"'.concat(t,'"');return[e,n,"".concat(s?this.CACHE_FONT_SIZE:i,"px"),r].join(" ")}render(t){this.visible&&(this.canvas&&this.canvas.skipOffscreen&&!this.group&&!this.isOnScreen()||(this._forceClearCache&&this.initDimensions(),super.render(t)))}graphemeSplit(t){return es(t)}_splitTextIntoLines(t){const e=t.split(this._reNewline),n=new Array(e.length),i=["\n"];let s=[];for(let r=0;r<e.length;r++)n[r]=this.graphemeSplit(e[r]),s=s.concat(n[r],i);return s.pop(),{_unwrappedLines:n,lines:e,graphemeText:s,graphemeLines:n}}toObject(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];return A(A({},super.toObject([...Ro,...t])),{},{styles:os(this.styles,this.text)},this.path?{path:this.path.toObject()}:{})}set(t,e){const{textLayoutProperties:n}=this.constructor;super.set(t,e);let i=!1,s=!1;if("object"==typeof t)for(const r in t)"path"===r&&this.setPathInfo(),i=i||n.includes(r),s=s||"path"===r;else i=n.includes(t),s="path"===t;return s&&this.setPathInfo(),i&&this.initialized&&(this.initDimensions(),this.setCoords()),this}complexity(){return 1}static async fromElement(t,e,n){const i=Ws(t,zo.ATTRIBUTE_NAMES,n),s=A(A({},e),i),{textAnchor:r=tt,textDecoration:o="",dx:a=0,dy:h=0,top:c=0,left:l=0,fontSize:u=J,strokeWidth:d=1}=s,g=O(s,Vo),p=new this((t.textContent||"").replace(/^\s+|\s+$|\n+/g,"").replace(/\s+/g," "),A({left:l+a,top:c+h,underline:o.includes("underline"),overline:o.includes("overline"),linethrough:o.includes("line-through"),strokeWidth:0,fontSize:u},g)),f=p.getScaledHeight()/p.height,m=((p.height+p.strokeWidth)*p.lineHeight-p.height)*f,_=p.getScaledHeight()+m;let v=0;return r===$&&(v=p.getScaledWidth()/2),r===it&&(v=p.getScaledWidth()),p.set({left:p.left-v,top:p.top-(_-p.fontSize*(.07+p._fontSizeFraction))/p.lineHeight,strokeWidth:d}),p}static fromObject(t){return this._fromObject(A(A({},t),{},{styles:as(t.styles||{},t.text)}),{extraParam:"text"})}}E(zo,"textLayoutProperties",Mo),E(zo,"cacheProperties",[...Yn,...Ro]),E(zo,"ownDefaults",Lo),E(zo,"type","Text"),E(zo,"genericFonts",["serif","sans-serif","monospace","cursive","fantasy","system-ui","ui-serif","ui-sans-serif","ui-monospace","ui-rounded","math","emoji","fangsong"]),E(zo,"ATTRIBUTE_NAMES",hs.concat("x","y","dx","dy","font-family","font-style","font-weight","font-size","letter-spacing","text-decoration","text-anchor")),Gi(zo,[class extends un{_toSVG(){const t=this._getSVGLeftTopOffsets(),e=this._getSVGTextAndBg(t.textTop,t.textLeft);return this._wrapSVGTextAndBg(e)}toSVG(t){const e=this._createBaseSVGMarkup(this._toSVG(),{reviver:t,noStyle:!0,withShadow:!0}),n=this.path;return n?e+n._createBaseSVGMarkup(n._toSVG(),{reviver:t,withShadow:!0,additionalTransform:pe(this.calcOwnMatrix())}):e}_getSVGLeftTopOffsets(){return{textLeft:-this.width/2,textTop:-this.height/2,lineTop:this.getHeightOfLine(0)}}_wrapSVGTextAndBg(t){let{textBgRects:e,textSpans:n}=t;const i=this.getSvgTextDecoration(this);return[e.join(""),'\t\t<text xml:space="preserve" ',this.fontFamily?'font-family="'.concat(this.fontFamily.replace(Xo,"'"),'" '):"",this.fontSize?'font-size="'.concat(this.fontSize,'" '):"",this.fontStyle?'font-style="'.concat(this.fontStyle,'" '):"",this.fontWeight?'font-weight="'.concat(this.fontWeight,'" '):"",i?'text-decoration="'.concat(i,'" '):"","rtl"===this.direction?'direction="'.concat(this.direction,'" '):"",'style="',this.getSvgStyles(!0),'"',this.addPaintOrder()," >",n.join(""),"</text>\n"]}_getSVGTextAndBg(t,e){const n=[],i=[];let s,r=t;this.backgroundColor&&i.push(...Go(this.backgroundColor,-this.width/2,-this.height/2,this.width,this.height));for(let o=0,a=this._textLines.length;o<a;o++)s=this._getLineLeftOffset(o),"rtl"===this.direction&&(s+=this.width),(this.textBackgroundColor||this.styleHas("textBackgroundColor",o))&&this._setSVGTextLineBg(i,o,e+s,r),this._setSVGTextLineText(n,o,e+s,r),r+=this.getHeightOfLine(o);return{textSpans:n,textBgRects:i}}_createTextCharSpan(t,e,n,i,s){const r=P.NUM_FRACTION_DIGITS,o=this.getSvgSpanStyles(e,t!==t.trim()||!!t.match(Uo)),a=o?'style="'.concat(o,'"'):"",h=e.deltaY,c=h?' dy="'.concat(ge(h,r),'" '):"",{angle:l,renderLeft:u,renderTop:d,width:g}=s;let p="";if(void 0!==u){const t=g/2;l&&(p=' rotate="'.concat(ge(Ht(l),r),'"'));const e=ee({angle:Ht(l)});e[4]=u,e[5]=d;const s=new It(-t,0).transform(e);n=s.x,i=s.y}return'<tspan x="'.concat(ge(n,r),'" y="').concat(ge(i,r),'" ').concat(c).concat(p).concat(a,">").concat($i(t),"</tspan>")}_setSVGTextLineText(t,e,n,i){const s=this.getHeightOfLine(e),r=this.textAlign.includes(jo),o=this._textLines[e];let a,h,c,l,u,d="",g=0;i+=s*(1-this._fontSizeFraction)/this.lineHeight;for(let p=0,f=o.length-1;p<=f;p++)u=p===f||this.charSpacing||this.path,d+=o[p],c=this.__charBounds[e][p],0===g?(n+=c.kernedWidth-c.width,g+=c.width):g+=c.kernedWidth,r&&!u&&this._reSpaceAndTab.test(o[p])&&(u=!0),u||(a=a||this.getCompleteStyleDeclaration(e,p),h=this.getCompleteStyleDeclaration(e,p+1),u=rs(a,h,!0)),u&&(l=this._getStyleDeclaration(e,p),t.push(this._createTextCharSpan(d,l,n,i,c)),d="",a=h,"rtl"===this.direction?n-=g:n+=g,g=0)}_setSVGTextLineBg(t,e,n,i){const s=this._textLines[e],r=this.getHeightOfLine(e)/this.lineHeight;let o,a=0,h=0,c=this.getValueOfPropertyAt(e,0,"textBackgroundColor");for(let l=0;l<s.length;l++){const{left:s,width:u,kernedWidth:d}=this.__charBounds[e][l];o=this.getValueOfPropertyAt(e,l,"textBackgroundColor"),o!==c?(c&&t.push(...Go(c,n+h,i,a,r)),h=s,a=u,c=o):a+=d}o&&t.push(...Go(c,n+h,i,a,r))}_getSVGLineTopOffset(t){let e,n=0;for(e=0;e<t;e++)n+=this.getHeightOfLine(e);const i=this.getHeightOfLine(e);return{lineTop:n,offset:(this._fontSizeMult-this._fontSizeFraction)*i/(this.lineHeight*this._fontSizeMult)}}getSvgStyles(t){return"".concat(super.getSvgStyles(t)," white-space: pre;")}getSvgSpanStyles(t,e){const{fontFamily:n,strokeWidth:i,stroke:s,fill:r,fontSize:o,fontStyle:a,fontWeight:h,deltaY:c}=t,l=this.getSvgTextDecoration(t);return[s?ln(bt,s):"",i?"stroke-width: ".concat(i,"; "):"",n?"font-family: ".concat(n.includes("'")||n.includes('"')?n:"'".concat(n,"'"),"; "):"",o?"font-size: ".concat(o,"px; "):"",a?"font-style: ".concat(a,"; "):"",h?"font-weight: ".concat(h,"; "):"",l?"text-decoration: ".concat(l,"; "):l,r?ln(Ct,r):"",c?"baseline-shift: ".concat(-c,"; "):"",e?"white-space: pre; ":""].join("")}getSvgTextDecoration(t){return["overline","underline","line-through"].filter((e=>t[e.replace("-","")])).join(" ")}}]),Tt.setClass(zo),Tt.setSVGClass(zo);class qo{constructor(t){E(this,"target",void 0),E(this,"__mouseDownInPlace",!1),E(this,"__dragStartFired",!1),E(this,"__isDraggingOver",!1),E(this,"__dragStartSelection",void 0),E(this,"__dragImageDisposer",void 0),E(this,"_dispose",void 0),this.target=t;const e=[this.target.on("dragenter",this.dragEnterHandler.bind(this)),this.target.on("dragover",this.dragOverHandler.bind(this)),this.target.on("dragleave",this.dragLeaveHandler.bind(this)),this.target.on("dragend",this.dragEndHandler.bind(this)),this.target.on("drop",this.dropHandler.bind(this))];this._dispose=()=>{e.forEach((t=>t())),this._dispose=void 0}}isPointerOverSelection(t){const e=this.target,n=e.getSelectionStartFromPointer(t);return e.isEditing&&n>=e.selectionStart&&n<=e.selectionEnd&&e.selectionStart<e.selectionEnd}start(t){return this.__mouseDownInPlace=this.isPointerOverSelection(t)}isActive(){return this.__mouseDownInPlace}end(t){const e=this.isActive();return e&&!this.__dragStartFired&&(this.target.setCursorByClick(t),this.target.initDelayedCursor(!0)),this.__mouseDownInPlace=!1,this.__dragStartFired=!1,this.__isDraggingOver=!1,e}getDragStartSelection(){return this.__dragStartSelection}setDragImage(t,e){var n;let{selectionStart:i,selectionEnd:s}=e;const r=this.target,o=r.canvas,a=new It(r.flipX?-1:1,r.flipY?-1:1),h=r._getCursorBoundaries(i),c=new It(h.left+h.leftOffset,h.top+h.topOffset).multiply(a).transform(r.calcTransformMatrix()),l=o.getScenePoint(t).subtract(c),u=r.getCanvasRetinaScaling(),d=r.getBoundingRect(),g=c.subtract(new It(d.left,d.top)),p=o.viewportTransform,f=g.add(l).transform(p,!0),m=r.backgroundColor,_=Zi(r.styles);r.backgroundColor="";const v={stroke:"transparent",fill:"transparent",textBackgroundColor:"transparent"};r.setSelectionStyles(v,0,i),r.setSelectionStyles(v,s,r.text.length),r.dirty=!0;const y=r.toCanvasElement({enableRetinaScaling:o.enableRetinaScaling,viewportTransform:!0});r.backgroundColor=m,r.styles=_,r.dirty=!0,Rr(y,{position:"fixed",left:"".concat(-y.width,"px"),border:st,width:"".concat(y.width/u,"px"),height:"".concat(y.height/u,"px")}),this.__dragImageDisposer&&this.__dragImageDisposer(),this.__dragImageDisposer=()=>{y.remove()},Ce(t.target||this.target.hiddenTextarea).body.appendChild(y),null===(n=t.dataTransfer)||void 0===n||n.setDragImage(y,f.x,f.y)}onDragStart(t){this.__dragStartFired=!0;const e=this.target,n=this.isActive();if(n&&t.dataTransfer){const n=this.__dragStartSelection={selectionStart:e.selectionStart,selectionEnd:e.selectionEnd},i=e._text.slice(n.selectionStart,n.selectionEnd).join(""),s=A({text:e.text,value:i},n);t.dataTransfer.setData("text/plain",i),t.dataTransfer.setData("application/fabric",JSON.stringify({value:i,styles:e.getSelectionStyles(n.selectionStart,n.selectionEnd,!0)})),t.dataTransfer.effectAllowed="copyMove",this.setDragImage(t,s)}return e.abortCursorAnimation(),n}canDrop(t){if(this.target.editable&&!this.target.getActiveControl()&&!t.defaultPrevented){if(this.isActive()&&this.__dragStartSelection){const e=this.target.getSelectionStartFromPointer(t),n=this.__dragStartSelection;return e<n.selectionStart||e>n.selectionEnd}return!0}return!1}targetCanDrop(t){return this.target.canDrop(t)}dragEnterHandler(t){let{e:e}=t;const n=this.targetCanDrop(e);!this.__isDraggingOver&&n&&(this.__isDraggingOver=!0)}dragOverHandler(t){const{e:e}=t,n=this.targetCanDrop(e);!this.__isDraggingOver&&n?this.__isDraggingOver=!0:this.__isDraggingOver&&!n&&(this.__isDraggingOver=!1),this.__isDraggingOver&&(e.preventDefault(),t.canDrop=!0,t.dropTarget=this.target)}dragLeaveHandler(){(this.__isDraggingOver||this.isActive())&&(this.__isDraggingOver=!1)}dropHandler(t){var e;const{e:n}=t,i=n.defaultPrevented;this.__isDraggingOver=!1,n.preventDefault();let s=null===(e=n.dataTransfer)||void 0===e?void 0:e.getData("text/plain");if(s&&!i){const e=this.target,i=e.canvas;let r=e.getSelectionStartFromPointer(n);const{styles:o}=n.dataTransfer.types.includes("application/fabric")?JSON.parse(n.dataTransfer.getData("application/fabric")):{},a=s[Math.max(0,s.length-1)],h=0;if(this.__dragStartSelection){const t=this.__dragStartSelection.selectionStart,n=this.__dragStartSelection.selectionEnd;r>t&&r<=n?r=t:r>n&&(r-=n-t),e.removeChars(t,n),delete this.__dragStartSelection}e._reNewline.test(a)&&(e._reNewline.test(e._text[r])||r===e._text.length)&&(s=s.trimEnd()),t.didDrop=!0,t.dropTarget=e,e.insertChars(s,o,r),i.setActiveObject(e),e.enterEditing(n),e.selectionStart=Math.min(r+h,e._text.length),e.selectionEnd=Math.min(e.selectionStart+s.length,e._text.length),e.hiddenTextarea.value=e.text,e._updateTextarea(),e.hiddenTextarea.focus(),e.fire(pt,{index:r+h,action:"drop"}),i.fire("text:changed",{target:e}),i.contextTopDirty=!0,i.requestRenderAll()}}dragEndHandler(t){let{e:e}=t;if(this.isActive()&&this.__dragStartFired&&this.__dragStartSelection){var n;const t=this.target,i=this.target.canvas,{selectionStart:s,selectionEnd:r}=this.__dragStartSelection,o=(null===(n=e.dataTransfer)||void 0===n?void 0:n.dropEffect)||st;o===st?(t.selectionStart=s,t.selectionEnd=r,t._updateTextarea(),t.hiddenTextarea.focus()):(t.clearContextTop(),"move"===o&&(t.removeChars(s,r),t.selectionStart=t.selectionEnd=s,t.hiddenTextarea&&(t.hiddenTextarea.value=t.text),t._updateTextarea(),t.fire(pt,{index:s,action:"dragend"}),i.fire("text:changed",{target:t}),i.requestRenderAll()),t.exitEditing())}this.__dragImageDisposer&&this.__dragImageDisposer(),delete this.__dragImageDisposer,delete this.__dragStartSelection,this.__isDraggingOver=!1}dispose(){this._dispose&&this._dispose()}}const Ko=/[ \n\.,;!\?\-]/;class Qo extends zo{constructor(){super(...arguments),E(this,"_currentCursorOpacity",1)}initBehavior(){this._tick=this._tick.bind(this),this._onTickComplete=this._onTickComplete.bind(this),this.updateSelectionOnMouseMove=this.updateSelectionOnMouseMove.bind(this)}onDeselect(t){return this.isEditing&&this.exitEditing(),this.selected=!1,super.onDeselect(t)}_animateCursor(t){let{toValue:e,duration:n,delay:i,onComplete:s}=t;return ri({startValue:this._currentCursorOpacity,endValue:e,duration:n,delay:i,onComplete:s,abort:()=>!this.canvas||this.selectionStart!==this.selectionEnd,onChange:t=>{this._currentCursorOpacity=t,this.renderCursorOrSelection()}})}_tick(t){this._currentTickState=this._animateCursor({toValue:0,duration:this.cursorDuration/2,delay:Math.max(t||0,100),onComplete:this._onTickComplete})}_onTickComplete(){var t;null===(t=this._currentTickCompleteState)||void 0===t||t.abort(),this._currentTickCompleteState=this._animateCursor({toValue:1,duration:this.cursorDuration,onComplete:this._tick})}initDelayedCursor(t){this.abortCursorAnimation(),this._tick(t?0:this.cursorDelay)}abortCursorAnimation(){let t=!1;[this._currentTickState,this._currentTickCompleteState].forEach((e=>{e&&!e.isDone()&&(t=!0,e.abort())})),this._currentCursorOpacity=1,t&&this.clearContextTop()}restartCursorIfNeeded(){[this._currentTickState,this._currentTickCompleteState].some((t=>!t||t.isDone()))&&this.initDelayedCursor()}selectAll(){return this.selectionStart=0,this.selectionEnd=this._text.length,this._fireSelectionChanged(),this._updateTextarea(),this}cmdAll(){this.selectAll(),this.renderCursorOrSelection()}getSelectedText(){return this._text.slice(this.selectionStart,this.selectionEnd).join("")}findWordBoundaryLeft(t){let e=0,n=t-1;if(this._reSpace.test(this._text[n]))for(;this._reSpace.test(this._text[n]);)e++,n--;for(;/\S/.test(this._text[n])&&n>-1;)e++,n--;return t-e}findWordBoundaryRight(t){let e=0,n=t;if(this._reSpace.test(this._text[n]))for(;this._reSpace.test(this._text[n]);)e++,n++;for(;/\S/.test(this._text[n])&&n<this._text.length;)e++,n++;return t+e}findLineBoundaryLeft(t){let e=0,n=t-1;for(;!/\n/.test(this._text[n])&&n>-1;)e++,n--;return t-e}findLineBoundaryRight(t){let e=0,n=t;for(;!/\n/.test(this._text[n])&&n<this._text.length;)e++,n++;return t+e}searchWordBoundary(t,e){const n=this._text;let i=t>0&&this._reSpace.test(n[t])&&(-1===e||!rt.test(n[t-1]))?t-1:t,s=n[i];for(;i>0&&i<n.length&&!Ko.test(s);)i+=e,s=n[i];return-1===e&&Ko.test(s)&&i++,i}selectWord(t){var e;t=null!==(e=t)&&void 0!==e?e:this.selectionStart;const n=this.searchWordBoundary(t,-1),i=Math.max(n,this.searchWordBoundary(t,1));this.selectionStart=n,this.selectionEnd=i,this._fireSelectionChanged(),this._updateTextarea(),this.renderCursorOrSelection()}selectLine(t){var e;t=null!==(e=t)&&void 0!==e?e:this.selectionStart;const n=this.findLineBoundaryLeft(t),i=this.findLineBoundaryRight(t);this.selectionStart=n,this.selectionEnd=i,this._fireSelectionChanged(),this._updateTextarea()}enterEditing(t){!this.isEditing&&this.editable&&(this.enterEditingImpl(),this.fire("editing:entered",t?{e:t}:void 0),this._fireSelectionChanged(),this.canvas&&(this.canvas.fire("text:editing:entered",{target:this,e:t}),this.canvas.requestRenderAll()))}enterEditingImpl(){this.canvas&&(this.canvas.calcOffset(),this.canvas.textEditingManager.exitTextEditing()),this.isEditing=!0,this.initHiddenTextarea(),this.hiddenTextarea.focus(),this.hiddenTextarea.value=this.text,this._updateTextarea(),this._saveEditingProps(),this._setEditingProps(),this._textBeforeEdit=this.text,this._tick()}updateSelectionOnMouseMove(t){if(this.getActiveControl())return;const e=this.hiddenTextarea;Ce(e).activeElement!==e&&e.focus();const n=this.getSelectionStartFromPointer(t),i=this.selectionStart,s=this.selectionEnd;(n===this.__selectionStartOnMouseDown&&i!==s||i!==n&&s!==n)&&(n>this.__selectionStartOnMouseDown?(this.selectionStart=this.__selectionStartOnMouseDown,this.selectionEnd=n):(this.selectionStart=n,this.selectionEnd=this.__selectionStartOnMouseDown),this.selectionStart===i&&this.selectionEnd===s||(this._fireSelectionChanged(),this._updateTextarea(),this.renderCursorOrSelection()))}_setEditingProps(){this.hoverCursor="text",this.canvas&&(this.canvas.defaultCursor=this.canvas.moveCursor="text"),this.borderColor=this.editingBorderColor,this.hasControls=this.selectable=!1,this.lockMovementX=this.lockMovementY=!0}fromStringToGraphemeSelection(t,e,n){const i=n.slice(0,t),s=this.graphemeSplit(i).length;if(t===e)return{selectionStart:s,selectionEnd:s};const r=n.slice(t,e);return{selectionStart:s,selectionEnd:s+this.graphemeSplit(r).length}}fromGraphemeToStringSelection(t,e,n){const i=n.slice(0,t).join("").length;return t===e?{selectionStart:i,selectionEnd:i}:{selectionStart:i,selectionEnd:i+n.slice(t,e).join("").length}}_updateTextarea(){if(this.cursorOffsetCache={},this.hiddenTextarea){if(!this.inCompositionMode){const t=this.fromGraphemeToStringSelection(this.selectionStart,this.selectionEnd,this._text);this.hiddenTextarea.selectionStart=t.selectionStart,this.hiddenTextarea.selectionEnd=t.selectionEnd}this.updateTextareaPosition()}}updateFromTextArea(){if(!this.hiddenTextarea)return;this.cursorOffsetCache={};const t=this.hiddenTextarea;this.text=t.value,this.set("dirty",!0),this.initDimensions(),this.setCoords();const e=this.fromStringToGraphemeSelection(t.selectionStart,t.selectionEnd,t.value);this.selectionEnd=this.selectionStart=e.selectionEnd,this.inCompositionMode||(this.selectionStart=e.selectionStart),this.updateTextareaPosition()}updateTextareaPosition(){if(this.selectionStart===this.selectionEnd){const t=this._calcTextareaPosition();this.hiddenTextarea.style.left=t.left,this.hiddenTextarea.style.top=t.top}}_calcTextareaPosition(){if(!this.canvas)return{left:"1px",top:"1px"};const t=this.inCompositionMode?this.compositionStart:this.selectionStart,e=this._getCursorBoundaries(t),n=this.get2DCursorLocation(t),i=n.lineIndex,s=n.charIndex,r=this.getValueOfPropertyAt(i,s,"fontSize")*this.lineHeight,o=e.leftOffset,a=this.getCanvasRetinaScaling(),h=this.canvas.upperCanvasEl,c=h.width/a,l=h.height/a,u=c-r,d=l-r,g=new It(e.left+o,e.top+e.topOffset+r).transform(this.calcTransformMatrix()).transform(this.canvas.viewportTransform).multiply(new It(h.clientWidth/c,h.clientHeight/l));return g.x<0&&(g.x=0),g.x>u&&(g.x=u),g.y<0&&(g.y=0),g.y>d&&(g.y=d),g.x+=this.canvas._offset.left,g.y+=this.canvas._offset.top,{left:"".concat(g.x,"px"),top:"".concat(g.y,"px"),fontSize:"".concat(r,"px"),charHeight:r}}_saveEditingProps(){this._savedProps={hasControls:this.hasControls,borderColor:this.borderColor,lockMovementX:this.lockMovementX,lockMovementY:this.lockMovementY,hoverCursor:this.hoverCursor,selectable:this.selectable,defaultCursor:this.canvas&&this.canvas.defaultCursor,moveCursor:this.canvas&&this.canvas.moveCursor}}_restoreEditingProps(){this._savedProps&&(this.hoverCursor=this._savedProps.hoverCursor,this.hasControls=this._savedProps.hasControls,this.borderColor=this._savedProps.borderColor,this.selectable=this._savedProps.selectable,this.lockMovementX=this._savedProps.lockMovementX,this.lockMovementY=this._savedProps.lockMovementY,this.canvas&&(this.canvas.defaultCursor=this._savedProps.defaultCursor||this.canvas.defaultCursor,this.canvas.moveCursor=this._savedProps.moveCursor||this.canvas.moveCursor),delete this._savedProps)}_exitEditing(){const t=this.hiddenTextarea;this.selected=!1,this.isEditing=!1,t&&(t.blur&&t.blur(),t.parentNode&&t.parentNode.removeChild(t)),this.hiddenTextarea=null,this.abortCursorAnimation(),this.selectionStart!==this.selectionEnd&&this.clearContextTop()}exitEditingImpl(){this._exitEditing(),this.selectionEnd=this.selectionStart,this._restoreEditingProps(),this._forceClearCache&&(this.initDimensions(),this.setCoords())}exitEditing(){const t=this._textBeforeEdit!==this.text;return this.exitEditingImpl(),this.fire("editing:exited"),t&&this.fire(wt),this.canvas&&(this.canvas.fire("text:editing:exited",{target:this}),t&&this.canvas.fire("object:modified",{target:this})),this}_removeExtraneousStyles(){for(const t in this.styles)this._textLines[t]||delete this.styles[t]}removeStyleFromTo(t,e){const{lineIndex:n,charIndex:i}=this.get2DCursorLocation(t,!0),{lineIndex:s,charIndex:r}=this.get2DCursorLocation(e,!0);if(n!==s){if(this.styles[n])for(let t=i;t<this._unwrappedTextLines[n].length;t++)delete this.styles[n][t];if(this.styles[s])for(let t=r;t<this._unwrappedTextLines[s].length;t++){const e=this.styles[s][t];e&&(this.styles[n]||(this.styles[n]={}),this.styles[n][i+t-r]=e)}for(let t=n+1;t<=s;t++)delete this.styles[t];this.shiftLineStyles(s,n-s)}else if(this.styles[n]){const t=this.styles[n],e=r-i;for(let n=i;n<r;n++)delete t[n];for(const i in this.styles[n]){const n=parseInt(i,10);n>=r&&(t[n-e]=t[i],delete t[i])}}}shiftLineStyles(t,e){const n=Object.assign({},this.styles);for(const i in this.styles){const s=parseInt(i,10);s>t&&(this.styles[s+e]=n[s],n[s-e]||delete this.styles[s])}}insertNewlineStyleObject(t,e,n,i){const s={},r=this._unwrappedTextLines[t].length,o=r===e;let a=!1;n||(n=1),this.shiftLineStyles(t,n);const h=this.styles[t]?this.styles[t][0===e?e:e-1]:void 0;for(const l in this.styles[t]){const n=parseInt(l,10);n>=e&&(a=!0,s[n-e]=this.styles[t][l],o&&0===e||delete this.styles[t][l])}let c=!1;for(a&&!o&&(this.styles[t+n]=s,c=!0),(c||r>e)&&n--;n>0;)i&&i[n-1]?this.styles[t+n]={0:A({},i[n-1])}:h?this.styles[t+n]={0:A({},h)}:delete this.styles[t+n],n--;this._forceClearCache=!0}insertCharStyleObject(t,e,n,i){this.styles||(this.styles={});const s=this.styles[t],r=s?A({},s):{};n||(n=1);for(const a in r){const t=parseInt(a,10);t>=e&&(s[t+n]=r[t],r[t-n]||delete s[t])}if(this._forceClearCache=!0,i){for(;n--;)Object.keys(i[n]).length&&(this.styles[t]||(this.styles[t]={}),this.styles[t][e+n]=A({},i[n]));return}if(!s)return;const o=s[e?e-1:1];for(;o&&n--;)this.styles[t][e+n]=A({},o)}insertNewStyleBlock(t,e,n){const i=this.get2DCursorLocation(e,!0),s=[0];let r,o=0;for(let a=0;a<t.length;a++)"\n"===t[a]?(o++,s[o]=0):s[o]++;for(s[0]>0&&(this.insertCharStyleObject(i.lineIndex,i.charIndex,s[0],n),n=n&&n.slice(s[0]+1)),o&&this.insertNewlineStyleObject(i.lineIndex,i.charIndex+s[0],o),r=1;r<o;r++)s[r]>0?this.insertCharStyleObject(i.lineIndex+r,0,s[r],n):n&&this.styles[i.lineIndex+r]&&n[0]&&(this.styles[i.lineIndex+r][0]=n[0]),n=n&&n.slice(s[r]+1);s[r]>0&&this.insertCharStyleObject(i.lineIndex+r,0,s[r],n)}removeChars(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:t+1;this.removeStyleFromTo(t,e),this._text.splice(t,e-t),this.text=this._text.join(""),this.set("dirty",!0),this.initDimensions(),this.setCoords(),this._removeExtraneousStyles()}insertChars(t,e,n){let i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:n;i>n&&this.removeStyleFromTo(n,i);const s=this.graphemeSplit(t);this.insertNewStyleBlock(s,n,e),this._text=[...this._text.slice(0,n),...s,...this._text.slice(i)],this.text=this._text.join(""),this.set("dirty",!0),this.initDimensions(),this.setCoords(),this._removeExtraneousStyles()}setSelectionStartEndWithShift(t,e,n){n<=t?(e===t?this._selectionDirection=tt:this._selectionDirection===it&&(this._selectionDirection=tt,this.selectionEnd=t),this.selectionStart=n):n>t&&n<e?this._selectionDirection===it?this.selectionEnd=n:this.selectionStart=n:(e===t?this._selectionDirection=it:this._selectionDirection===tt&&(this._selectionDirection=it,this.selectionStart=e),this.selectionEnd=n)}}class Jo extends Qo{initHiddenTextarea(){const t=this.canvas&&Ce(this.canvas.getElement())||Y(),e=t.createElement("textarea");Object.entries({autocapitalize:"off",autocorrect:"off",autocomplete:"off",spellcheck:"false","data-fabric":"textarea",wrap:"off"}).map((t=>{let[n,i]=t;return e.setAttribute(n,i)}));const{top:n,left:i,fontSize:s}=this._calcTextareaPosition();e.style.cssText="position: absolute; top: ".concat(n,"; left: ").concat(i,"; z-index: -999; opacity: 0; width: 1px; height: 1px; font-size: 1px; padding-top: ").concat(s,";"),(this.hiddenTextareaContainer||t.body).appendChild(e),Object.entries({blur:"blur",keydown:"onKeyDown",keyup:"onKeyUp",input:"onInput",copy:"copy",cut:"copy",paste:"paste",compositionstart:"onCompositionStart",compositionupdate:"onCompositionUpdate",compositionend:"onCompositionEnd"}).map((t=>{let[n,i]=t;return e.addEventListener(n,this[i].bind(this))})),this.hiddenTextarea=e}blur(){this.abortCursorAnimation()}onKeyDown(t){if(!this.isEditing)return;const e="rtl"===this.direction?this.keysMapRtl:this.keysMap;if(t.keyCode in e)this[e[t.keyCode]](t);else{if(!(t.keyCode in this.ctrlKeysMapDown)||!t.ctrlKey&&!t.metaKey)return;this[this.ctrlKeysMapDown[t.keyCode]](t)}t.stopImmediatePropagation(),t.preventDefault(),t.keyCode>=33&&t.keyCode<=40?(this.inCompositionMode=!1,this.clearContextTop(),this.renderCursorOrSelection()):this.canvas&&this.canvas.requestRenderAll()}onKeyUp(t){!this.isEditing||this._copyDone||this.inCompositionMode?this._copyDone=!1:t.keyCode in this.ctrlKeysMapUp&&(t.ctrlKey||t.metaKey)&&(this[this.ctrlKeysMapUp[t.keyCode]](t),t.stopImmediatePropagation(),t.preventDefault(),this.canvas&&this.canvas.requestRenderAll())}onInput(t){const e=this.fromPaste,{value:n,selectionStart:i,selectionEnd:s}=this.hiddenTextarea;if(this.fromPaste=!1,t&&t.stopPropagation(),!this.isEditing)return;const r=()=>{this.updateFromTextArea(),this.fire(pt),this.canvas&&(this.canvas.fire("text:changed",{target:this}),this.canvas.requestRenderAll())};if(""===this.hiddenTextarea.value)return this.styles={},void r();const o=this._splitTextIntoLines(n).graphemeText,a=this._text.length,h=o.length,c=this.selectionStart,l=this.selectionEnd,u=c!==l;let d,g,p,f,m=h-a;const _=this.fromStringToGraphemeSelection(i,s,n),v=c>_.selectionStart;u?(g=this._text.slice(c,l),m+=l-c):h<a&&(g=v?this._text.slice(l+m,l):this._text.slice(c,c-m));const y=o.slice(_.selectionEnd-m,_.selectionEnd);if(g&&g.length&&(y.length&&(d=this.getSelectionStyles(c,c+1,!1),d=y.map((()=>d[0]))),u?(p=c,f=l):v?(p=l-g.length,f=l):(p=l,f=l+g.length),this.removeStyleFromTo(p,f)),y.length){const{copyPasteData:t}=W();e&&y.join("")===t.copiedText&&!P.disableStyleCopyPaste&&(d=t.copiedTextStyle),this.insertNewStyleBlock(y,c,d)}r()}onCompositionStart(){this.inCompositionMode=!0}onCompositionEnd(){this.inCompositionMode=!1}onCompositionUpdate(t){let{target:e}=t;const{selectionStart:n,selectionEnd:i}=e;this.compositionStart=n,this.compositionEnd=i,this.updateTextareaPosition()}copy(){if(this.selectionStart===this.selectionEnd)return;const{copyPasteData:t}=W();t.copiedText=this.getSelectedText(),P.disableStyleCopyPaste?t.copiedTextStyle=void 0:t.copiedTextStyle=this.getSelectionStyles(this.selectionStart,this.selectionEnd,!0),this._copyDone=!0}paste(){this.fromPaste=!0}_getWidthBeforeCursor(t,e){let n,i=this._getLineLeftOffset(t);return e>0&&(n=this.__charBounds[t][e-1],i+=n.left+n.width),i}getDownCursorOffset(t,e){const n=this._getSelectionForOffset(t,e),i=this.get2DCursorLocation(n),s=i.lineIndex;if(s===this._textLines.length-1||t.metaKey||34===t.keyCode)return this._text.length-n;const r=i.charIndex,o=this._getWidthBeforeCursor(s,r),a=this._getIndexOnLine(s+1,o);return this._textLines[s].slice(r).length+a+1+this.missingNewlineOffset(s)}_getSelectionForOffset(t,e){return t.shiftKey&&this.selectionStart!==this.selectionEnd&&e?this.selectionEnd:this.selectionStart}getUpCursorOffset(t,e){const n=this._getSelectionForOffset(t,e),i=this.get2DCursorLocation(n),s=i.lineIndex;if(0===s||t.metaKey||33===t.keyCode)return-n;const r=i.charIndex,o=this._getWidthBeforeCursor(s,r),a=this._getIndexOnLine(s-1,o),h=this._textLines[s].slice(0,r),c=this.missingNewlineOffset(s-1);return-this._textLines[s-1].length+a-h.length+(1-c)}_getIndexOnLine(t,e){const n=this._textLines[t];let i,s,r=this._getLineLeftOffset(t),o=0;for(let a=0,h=n.length;a<h;a++)if(i=this.__charBounds[t][a].width,r+=i,r>e){s=!0;const t=r-i,n=r,h=Math.abs(t-e);o=Math.abs(n-e)<h?a:a-1;break}return s||(o=n.length-1),o}moveCursorDown(t){this.selectionStart>=this._text.length&&this.selectionEnd>=this._text.length||this._moveCursorUpOrDown("Down",t)}moveCursorUp(t){0===this.selectionStart&&0===this.selectionEnd||this._moveCursorUpOrDown("Up",t)}_moveCursorUpOrDown(t,e){const n=this["get".concat(t,"CursorOffset")](e,this._selectionDirection===it);if(e.shiftKey?this.moveCursorWithShift(n):this.moveCursorWithoutShift(n),0!==n){const t=this.text.length;this.selectionStart=Bn(0,this.selectionStart,t),this.selectionEnd=Bn(0,this.selectionEnd,t),this.abortCursorAnimation(),this.initDelayedCursor(),this._fireSelectionChanged(),this._updateTextarea()}}moveCursorWithShift(t){const e=this._selectionDirection===tt?this.selectionStart+t:this.selectionEnd+t;return this.setSelectionStartEndWithShift(this.selectionStart,this.selectionEnd,e),0!==t}moveCursorWithoutShift(t){return t<0?(this.selectionStart+=t,this.selectionEnd=this.selectionStart):(this.selectionEnd+=t,this.selectionStart=this.selectionEnd),0!==t}moveCursorLeft(t){0===this.selectionStart&&0===this.selectionEnd||this._moveCursorLeftOrRight("Left",t)}_move(t,e,n){let i;if(t.altKey)i=this["findWordBoundary".concat(n)](this[e]);else{if(!t.metaKey&&35!==t.keyCode&&36!==t.keyCode)return this[e]+="Left"===n?-1:1,!0;i=this["findLineBoundary".concat(n)](this[e])}return void 0!==i&&this[e]!==i&&(this[e]=i,!0)}_moveLeft(t,e){return this._move(t,e,"Left")}_moveRight(t,e){return this._move(t,e,"Right")}moveCursorLeftWithoutShift(t){let e=!0;return this._selectionDirection=tt,this.selectionEnd===this.selectionStart&&0!==this.selectionStart&&(e=this._moveLeft(t,"selectionStart")),this.selectionEnd=this.selectionStart,e}moveCursorLeftWithShift(t){return this._selectionDirection===it&&this.selectionStart!==this.selectionEnd?this._moveLeft(t,"selectionEnd"):0!==this.selectionStart?(this._selectionDirection=tt,this._moveLeft(t,"selectionStart")):void 0}moveCursorRight(t){this.selectionStart>=this._text.length&&this.selectionEnd>=this._text.length||this._moveCursorLeftOrRight("Right",t)}_moveCursorLeftOrRight(t,e){const n="moveCursor".concat(t).concat(e.shiftKey?"WithShift":"WithoutShift");this._currentCursorOpacity=1,this[n](e)&&(this.abortCursorAnimation(),this.initDelayedCursor(),this._fireSelectionChanged(),this._updateTextarea())}moveCursorRightWithShift(t){return this._selectionDirection===tt&&this.selectionStart!==this.selectionEnd?this._moveRight(t,"selectionStart"):this.selectionEnd!==this._text.length?(this._selectionDirection=it,this._moveRight(t,"selectionEnd")):void 0}moveCursorRightWithoutShift(t){let e=!0;return this._selectionDirection=it,this.selectionStart===this.selectionEnd?(e=this._moveRight(t,"selectionStart"),this.selectionEnd=this.selectionStart):this.selectionStart=this.selectionEnd,e}}const Zo=t=>!!t.button;class $o extends Jo{constructor(){super(...arguments),E(this,"draggableTextDelegate",void 0)}initBehavior(){this.on("mousedown",this._mouseDownHandler),this.on("mouseup",this.mouseUpHandler),this.on("mousedblclick",this.doubleClickHandler),this.on("mousetripleclick",this.tripleClickHandler),this.draggableTextDelegate=new qo(this),super.initBehavior()}shouldStartDragging(){return this.draggableTextDelegate.isActive()}onDragStart(t){return this.draggableTextDelegate.onDragStart(t)}canDrop(t){return this.draggableTextDelegate.canDrop(t)}doubleClickHandler(t){this.isEditing&&(this.selectWord(this.getSelectionStartFromPointer(t.e)),this.renderCursorOrSelection())}tripleClickHandler(t){this.isEditing&&(this.selectLine(this.getSelectionStartFromPointer(t.e)),this.renderCursorOrSelection())}_mouseDownHandler(t){let{e:e,alreadySelected:n}=t;this.canvas&&this.editable&&!Zo(e)&&!this.getActiveControl()&&(this.draggableTextDelegate.start(e)||(this.canvas.textEditingManager.register(this),n&&(this.inCompositionMode=!1,this.setCursorByClick(e)),this.isEditing&&(this.__selectionStartOnMouseDown=this.selectionStart,this.selectionStart===this.selectionEnd&&this.abortCursorAnimation(),this.renderCursorOrSelection()),this.selected||(this.selected=n||this.isEditing)))}mouseUpHandler(t){let{e:e,transform:n}=t;const i=this.draggableTextDelegate.end(e);if(this.canvas){this.canvas.textEditingManager.unregister(this);const t=this.canvas._activeObject;if(t&&t!==this)return}!this.editable||this.group&&!this.group.interactive||n&&n.actionPerformed||Zo(e)||i||this.selected&&!this.getActiveControl()&&(this.enterEditing(e),this.selectionStart===this.selectionEnd?this.initDelayedCursor(!0):this.renderCursorOrSelection())}setCursorByClick(t){const e=this.getSelectionStartFromPointer(t),n=this.selectionStart,i=this.selectionEnd;t.shiftKey?this.setSelectionStartEndWithShift(n,i,e):(this.selectionStart=e,this.selectionEnd=e),this.isEditing&&(this._fireSelectionChanged(),this._updateTextarea())}getSelectionStartFromPointer(t){const e=this.canvas.getScenePoint(t).transform(Kt(this.calcTransformMatrix())).add(new It(-this._getLeftOffset(),-this._getTopOffset()));let n=0,i=0,s=0;for(let h=0;h<this._textLines.length&&n<=e.y;h++)n+=this.getHeightOfLine(h),s=h,h>0&&(i+=this._textLines[h-1].length+this.missingNewlineOffset(h-1));let r=Math.abs(this._getLineLeftOffset(s));const o=this._textLines[s].length,a=this.__charBounds[s];for(let h=0;h<o;h++){const t=r+a[h].kernedWidth;if(e.x<=t){Math.abs(e.x-t)<=Math.abs(e.x-r)&&i++;break}r=t,i++}return Math.min(this.flipX?o-i:i,this._text.length)}}const ta="moveCursorUp",ea="moveCursorDown",na="moveCursorLeft",ia="moveCursorRight",sa="exitEditing",ra=(t,e)=>{const n=e.getRetinaScaling();t.setTransform(n,0,0,n,0,0);const i=e.viewportTransform;t.transform(i[0],i[1],i[2],i[3],i[4],i[5])},oa=A({selectionStart:0,selectionEnd:0,selectionColor:"rgba(17,119,255,0.3)",isEditing:!1,editable:!0,editingBorderColor:"rgba(102,153,255,0.25)",cursorWidth:2,cursorColor:"",cursorDelay:1e3,cursorDuration:600,caching:!0,hiddenTextareaContainer:null,keysMap:{9:sa,27:sa,33:ta,34:ea,35:ia,36:na,37:na,38:ta,39:ia,40:ea},keysMapRtl:{9:sa,27:sa,33:ta,34:ea,35:na,36:ia,37:ia,38:ta,39:na,40:ea},ctrlKeysMapDown:{65:"cmdAll"},ctrlKeysMapUp:{67:"copy",88:"cut"}},{_selectionDirection:null,_reSpace:/\s|\r?\n/,inCompositionMode:!1});class aa extends $o{static getDefaults(){return A(A({},super.getDefaults()),aa.ownDefaults)}get type(){const t=super.type;return"itext"===t?"i-text":t}constructor(t,e){super(t,A(A({},aa.ownDefaults),e)),this.initBehavior()}_set(t,e){return this.isEditing&&this._savedProps&&t in this._savedProps?(this._savedProps[t]=e,this):("canvas"===t&&(this.canvas instanceof qr&&this.canvas.textEditingManager.remove(this),e instanceof qr&&e.textEditingManager.add(this)),super._set(t,e))}setSelectionStart(t){t=Math.max(t,0),this._updateAndFire("selectionStart",t)}setSelectionEnd(t){t=Math.min(t,this.text.length),this._updateAndFire("selectionEnd",t)}_updateAndFire(t,e){this[t]!==e&&(this._fireSelectionChanged(),this[t]=e),this._updateTextarea()}_fireSelectionChanged(){this.fire("selection:changed"),this.canvas&&this.canvas.fire("text:selection:changed",{target:this})}initDimensions(){this.isEditing&&this.initDelayedCursor(),super.initDimensions()}getSelectionStyles(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.selectionStart||0,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.selectionEnd,n=arguments.length>2?arguments[2]:void 0;return super.getSelectionStyles(t,e,n)}setSelectionStyles(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.selectionStart||0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:this.selectionEnd;return super.setSelectionStyles(t,e,n)}get2DCursorLocation(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.selectionStart,e=arguments.length>1?arguments[1]:void 0;return super.get2DCursorLocation(t,e)}render(t){super.render(t),this.cursorOffsetCache={},this.renderCursorOrSelection()}toCanvasElement(t){const e=this.isEditing;this.isEditing=!1;const n=super.toCanvasElement(t);return this.isEditing=e,n}renderCursorOrSelection(){if(!this.isEditing||!this.canvas)return;const t=this.clearContextTop(!0);if(!t)return;const e=this._getCursorBoundaries(),n=this.findAncestorsWithClipPath(),i=n.length>0;let s,r=t;if(i){s=Ut(t.canvas),r=s.getContext("2d"),ra(r,this.canvas);const e=this.calcTransformMatrix();r.transform(e[0],e[1],e[2],e[3],e[4],e[5])}if(this.selectionStart!==this.selectionEnd||this.inCompositionMode?this.renderSelection(r,e):this.renderCursor(r,e),i)for(const o of n){const e=o.clipPath,n=Ut(t.canvas),i=n.getContext("2d");if(ra(i,this.canvas),!e.absolutePositioned){const t=o.calcTransformMatrix();i.transform(t[0],t[1],t[2],t[3],t[4],t[5])}e.transform(i),e.drawObject(i,!0,{}),this.drawClipPathOnCache(r,e,n)}i&&(t.setTransform(1,0,0,1,0,0),t.drawImage(s,0,0)),this.canvas.contextTopDirty=!0,t.restore()}findAncestorsWithClipPath(){const t=[];let e=this;for(;e;)e.clipPath&&t.push(e),e=e.parent;return t}_getCursorBoundaries(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.selectionStart,e=arguments.length>1?arguments[1]:void 0;const n=this._getLeftOffset(),i=this._getTopOffset(),s=this._getCursorBoundariesOffsets(t,e);return{left:n,top:i,leftOffset:s.left,topOffset:s.top}}_getCursorBoundariesOffsets(t,e){return e?this.__getCursorBoundariesOffsets(t):this.cursorOffsetCache&&"top"in this.cursorOffsetCache?this.cursorOffsetCache:this.cursorOffsetCache=this.__getCursorBoundariesOffsets(t)}__getCursorBoundariesOffsets(t){let e=0,n=0;const{charIndex:i,lineIndex:s}=this.get2DCursorLocation(t);for(let h=0;h<s;h++)e+=this.getHeightOfLine(h);const r=this._getLineLeftOffset(s),o=this.__charBounds[s][i];o&&(n=o.left),0!==this.charSpacing&&i===this._textLines[s].length&&(n-=this._getWidthOfCharSpacing());const a={top:e,left:r+(n>0?n:0)};return"rtl"===this.direction&&(this.textAlign===it||this.textAlign===jo||this.textAlign===Bo?a.left*=-1:this.textAlign===tt||this.textAlign===No?a.left=r-(n>0?n:0):this.textAlign!==$&&this.textAlign!==Wo||(a.left=r-(n>0?n:0))),a}renderCursorAt(t){this._renderCursor(this.canvas.contextTop,this._getCursorBoundaries(t,!0),t)}renderCursor(t,e){this._renderCursor(t,e,this.selectionStart)}getCursorRenderingData(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.selectionStart,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this._getCursorBoundaries(t);const n=this.get2DCursorLocation(t),i=n.lineIndex,s=n.charIndex>0?n.charIndex-1:0,r=this.getValueOfPropertyAt(i,s,"fontSize"),o=this.getObjectScaling().x*this.canvas.getZoom(),a=this.cursorWidth/o,h=this.getValueOfPropertyAt(i,s,"deltaY"),c=e.topOffset+(1-this._fontSizeFraction)*this.getHeightOfLine(i)/this.lineHeight-r*(1-this._fontSizeFraction);return{color:this.cursorColor||this.getValueOfPropertyAt(i,s,"fill"),opacity:this._currentCursorOpacity,left:e.left+e.leftOffset-a/2,top:c+e.top+h,width:a,height:r}}_renderCursor(t,e,n){const{color:i,opacity:s,left:r,top:o,width:a,height:h}=this.getCursorRenderingData(n,e);t.fillStyle=i,t.globalAlpha=s,t.fillRect(r,o,a,h)}renderSelection(t,e){const n={selectionStart:this.inCompositionMode?this.hiddenTextarea.selectionStart:this.selectionStart,selectionEnd:this.inCompositionMode?this.hiddenTextarea.selectionEnd:this.selectionEnd};this._renderSelection(t,n,e)}renderDragSourceEffect(){const t=this.draggableTextDelegate.getDragStartSelection();this._renderSelection(this.canvas.contextTop,t,this._getCursorBoundaries(t.selectionStart,!0))}renderDropTargetEffect(t){const e=this.getSelectionStartFromPointer(t);this.renderCursorAt(e)}_renderSelection(t,e,n){const i=e.selectionStart,s=e.selectionEnd,r=this.textAlign.includes(jo),o=this.get2DCursorLocation(i),a=this.get2DCursorLocation(s),h=o.lineIndex,c=a.lineIndex,l=o.charIndex<0?0:o.charIndex,u=a.charIndex<0?0:a.charIndex;for(let d=h;d<=c;d++){const e=this._getLineLeftOffset(d)||0;let i=this.getHeightOfLine(d),s=0,o=0,a=0;if(d===h&&(o=this.__charBounds[h][l].left),d>=h&&d<c)a=r&&!this.isEndOfWrapping(d)?this.width:this.getLineWidth(d)||5;else if(d===c)if(0===u)a=this.__charBounds[c][u].left;else{const t=this._getWidthOfCharSpacing();a=this.__charBounds[c][u-1].left+this.__charBounds[c][u-1].width-t}s=i,(this.lineHeight<1||d===c&&this.lineHeight>1)&&(i/=this.lineHeight);let g=n.left+e+o,p=i,f=0;const m=a-o;this.inCompositionMode?(t.fillStyle=this.compositionColor||"black",p=1,f=i):t.fillStyle=this.selectionColor,"rtl"===this.direction&&(this.textAlign===it||this.textAlign===jo||this.textAlign===Bo?g=this.width-g-m:this.textAlign===tt||this.textAlign===No?g=n.left+e-a:this.textAlign!==$&&this.textAlign!==Wo||(g=n.left+e-a)),t.fillRect(g,n.top+n.topOffset+f,m,p),n.topOffset+=s}}getCurrentCharFontSize(){const t=this._getCurrentCharIndex();return this.getValueOfPropertyAt(t.l,t.c,"fontSize")}getCurrentCharColor(){const t=this._getCurrentCharIndex();return this.getValueOfPropertyAt(t.l,t.c,Ct)}_getCurrentCharIndex(){const t=this.get2DCursorLocation(this.selectionStart,!0),e=t.charIndex>0?t.charIndex-1:0;return{l:t.lineIndex,c:e}}dispose(){this.exitEditingImpl(),this.draggableTextDelegate.dispose(),super.dispose()}}E(aa,"ownDefaults",oa),E(aa,"type","IText"),Tt.setClass(aa),Tt.setClass(aa,"i-text");class ha extends aa{static getDefaults(){return A(A({},super.getDefaults()),ha.ownDefaults)}constructor(t,e){super(t,A(A({},ha.ownDefaults),e))}static createControls(){return{controls:Ui()}}initDimensions(){this.initialized&&(this.isEditing&&this.initDelayedCursor(),this._clearCache(),this.dynamicMinWidth=0,this._styleMap=this._generateStyleMap(this._splitText()),this.dynamicMinWidth>this.width&&this._set("width",this.dynamicMinWidth),this.textAlign.includes(jo)&&this.enlargeSpaces(),this.height=this.calcTextHeight())}_generateStyleMap(t){let e=0,n=0,i=0;const s={};for(let r=0;r<t.graphemeLines.length;r++)"\n"===t.graphemeText[i]&&r>0?(n=0,i++,e++):!this.splitByGrapheme&&this._reSpaceAndTab.test(t.graphemeText[i])&&r>0&&(n++,i++),s[r]={line:e,offset:n},i+=t.graphemeLines[r].length,n+=t.graphemeLines[r].length;return s}styleHas(t,e){if(this._styleMap&&!this.isWrapping){const t=this._styleMap[e];t&&(e=t.line)}return super.styleHas(t,e)}isEmptyStyles(t){if(!this.styles)return!0;let e,n=0,i=t+1,s=!1;const r=this._styleMap[t],o=this._styleMap[t+1];r&&(t=r.line,n=r.offset),o&&(i=o.line,s=i===t,e=o.offset);const a=void 0===t?this.styles:{line:this.styles[t]};for(const h in a)for(const t in a[h]){const i=parseInt(t,10);if(i>=n&&(!s||i<e))for(const e in a[h][t])return!1}return!0}_getStyleDeclaration(t,e){if(this._styleMap&&!this.isWrapping){const n=this._styleMap[t];if(!n)return{};t=n.line,e=n.offset+e}return super._getStyleDeclaration(t,e)}_setStyleDeclaration(t,e,n){const i=this._styleMap[t];super._setStyleDeclaration(i.line,i.offset+e,n)}_deleteStyleDeclaration(t,e){const n=this._styleMap[t];super._deleteStyleDeclaration(n.line,n.offset+e)}_getLineStyle(t){const e=this._styleMap[t];return!!this.styles[e.line]}_setLineStyle(t){const e=this._styleMap[t];super._setLineStyle(e.line)}_wrapText(t,e){this.isWrapping=!0;const n=this.getGraphemeDataForRender(t),i=[];for(let s=0;s<n.wordsData.length;s++)i.push(...this._wrapLine(s,e,n));return this.isWrapping=!1,i}getGraphemeDataForRender(t){const e=this.splitByGrapheme,n=e?"":" ";let i=0;return{wordsData:t.map(((t,s)=>{let r=0;const o=e?this.graphemeSplit(t):this.wordSplit(t);return 0===o.length?[{word:[],width:0}]:o.map((t=>{const o=e?[t]:this.graphemeSplit(t),a=this._measureWord(o,s,r);return i=Math.max(a,i),r+=o.length+n.length,{word:o,width:a}}))})),largestWordWidth:i}}_measureWord(t,e){let n,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,s=0;for(let r=0,o=t.length;r<o;r++)s+=this._getGraphemeBox(t[r],e,r+i,n,!0).kernedWidth,n=t[r];return s}wordSplit(t){return t.split(this._wordJoiners)}_wrapLine(t,e,n){let{largestWordWidth:i,wordsData:s}=n,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;const o=this._getWidthOfCharSpacing(),a=this.splitByGrapheme,h=[],c=a?"":" ";let l=0,u=[],d=0,g=0,p=!0;e-=r;const f=Math.max(e,i,this.dynamicMinWidth),m=s[t];let _;for(d=0,_=0;_<m.length;_++){const{word:e,width:n}=m[_];d+=e.length,l+=g+n-o,l>f&&!p?(h.push(u),u=[],l=n,p=!0):l+=o,p||a||u.push(c),u=u.concat(e),g=a?0:this._measureWord([c],t,d),d++,p=!1}return _&&h.push(u),i+r>this.dynamicMinWidth&&(this.dynamicMinWidth=i-o+r),h}isEndOfWrapping(t){return!this._styleMap[t+1]||this._styleMap[t+1].line!==this._styleMap[t].line}missingNewlineOffset(t,e){return this.splitByGrapheme&&!e?this.isEndOfWrapping(t)?1:0:1}_splitTextIntoLines(t){const e=super._splitTextIntoLines(t),n=this._wrapText(e.lines,this.width),i=new Array(n.length);for(let s=0;s<n.length;s++)i[s]=n[s].join("");return e.lines=i,e.graphemeLines=n,e}getMinWidth(){return Math.max(this.minWidth,this.dynamicMinWidth)}_removeExtraneousStyles(){const t=new Map;for(const e in this._styleMap){const n=parseInt(e,10);if(this._textLines[n]){const n=this._styleMap[e].line;t.set("".concat(n),!0)}}for(const e in this.styles)t.has(e)||delete this.styles[e]}toObject(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];return super.toObject(["minWidth","splitByGrapheme",...t])}}E(ha,"type","Textbox"),E(ha,"textLayoutProperties",[...aa.textLayoutProperties,"width"]),E(ha,"ownDefaults",{minWidth:20,dynamicMinWidth:2,lockScalingFlip:!0,noScaleCache:!1,_wordJoiners:/[ \t\r]/,splitByGrapheme:!1}),Tt.setClass(ha);class ca extends Ks{shouldPerformLayout(t){return!!t.target.clipPath&&super.shouldPerformLayout(t)}shouldLayoutClipPath(){return!1}calcLayoutResult(t,e){const{target:n}=t,{clipPath:i,group:s}=n;if(!i||!this.shouldPerformLayout(t))return;const{width:r,height:o}=Pe(qs(n,i)),a=new It(r,o);if(i.absolutePositioned)return{center:We(i.getRelativeCenterPoint(),void 0,s?s.calcTransformMatrix():void 0),size:a};{const s=i.getRelativeCenterPoint().transform(n.calcOwnMatrix(),!0);if(this.shouldPerformLayout(t)){const{center:n=new It,correction:i=new It}=this.calcBoundingBox(e,t)||{};return{center:n.add(s),correction:i.subtract(s),size:a}}return{center:n.getRelativeCenterPoint().add(s),size:a}}}}E(ca,"type","clip-path"),Tt.setClass(ca);class la extends Ks{getInitialSize(t,e){let{target:n}=t,{size:i}=e;return new It(n.width||i.x,n.height||i.y)}}E(la,"type","fixed"),Tt.setClass(la);class ua extends tr{subscribeTargets(t){const e=t.target;t.targets.reduce(((t,e)=>(e.parent&&t.add(e.parent),t)),new Set).forEach((t=>{t.layoutManager.subscribeTargets({target:t,targets:[e]})}))}unsubscribeTargets(t){const e=t.target,n=e.getObjects();t.targets.reduce(((t,e)=>(e.parent&&t.add(e.parent),t)),new Set).forEach((t=>{!n.some((e=>e.parent===t))&&t.layoutManager.unsubscribeTargets({target:t,targets:[e]})}))}}class da extends ir{static getDefaults(){return A(A({},super.getDefaults()),da.ownDefaults)}constructor(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};super(),Object.assign(this,da.ownDefaults),this.setOptions(e);const{left:n,top:i,layoutManager:s}=e;this.groupInit(t,{left:n,top:i,layoutManager:null!=s?s:new ua})}_shouldSetNestedCoords(){return!0}__objectSelectionMonitor(){}multiSelectAdd(){for(var t=arguments.length,e=new Array(t),n=0;n<t;n++)e[n]=arguments[n];"selection-order"===this.multiSelectionStacking?this.add(...e):e.forEach((t=>{const e=this._objects.findIndex((e=>e.isInFrontOf(t))),n=-1===e?this.size():e;this.insertAt(n,t)}))}canEnterGroup(t){return this.getObjects().some((e=>e.isDescendantOf(t)||t.isDescendantOf(e)))?(M("error","ActiveSelection: circular object trees are not supported, this call has no effect"),!1):super.canEnterGroup(t)}enterGroup(t,e){t.parent&&t.parent===t.group?t.parent._exitGroup(t):t.group&&t.parent!==t.group&&t.group.remove(t),this._enterGroup(t,e)}exitGroup(t,e){this._exitGroup(t,e),t.parent&&t.parent._enterGroup(t,!0)}_onAfterObjectsChange(t,e){super._onAfterObjectsChange(t,e);const n=new Set;e.forEach((t=>{const{parent:e}=t;e&&n.add(e)})),t===Hs?n.forEach((t=>{t._onAfterObjectsChange(Vs,e)})):n.forEach((t=>{t._set("dirty",!0)}))}onDeselect(){return this.removeAll(),!1}toString(){return"#<ActiveSelection: (".concat(this.complexity(),")>")}shouldCache(){return!1}isOnACache(){return!1}_renderControls(t,e,n){t.save(),t.globalAlpha=this.isMoving?this.borderOpacityWhenMoving:1;const i=A(A({hasControls:!1},n),{},{forActiveSelection:!0});for(let s=0;s<this._objects.length;s++)this._objects[s]._renderControls(t,i);super._renderControls(t,e),t.restore()}}E(da,"type","ActiveSelection"),E(da,"ownDefaults",{multiSelectionStacking:"canvas-stacking"}),Tt.setClass(da),Tt.setClass(da,"activeSelection");class ga{constructor(){E(this,"resources",{})}applyFilters(t,e,n,i,s){const r=s.getContext("2d");if(!r)return;r.drawImage(e,0,0,n,i);const o={sourceWidth:n,sourceHeight:i,imageData:r.getImageData(0,0,n,i),originalEl:e,originalImageData:r.getImageData(0,0,n,i),canvasEl:s,ctx:r,filterBackend:this};t.forEach((t=>{t.applyTo(o)}));const{imageData:a}=o;return a.width===n&&a.height===i||(s.width=a.width,s.height=a.height),r.putImageData(a,0,0),o}}class pa{constructor(){let{tileSize:t=P.textureSize}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};E(this,"aPosition",new Float32Array([0,0,0,1,1,0,1,1])),E(this,"resources",{}),this.tileSize=t,this.setupGLContext(t,t),this.captureGPUInfo()}setupGLContext(t,e){this.dispose(),this.createWebGLCanvas(t,e)}createWebGLCanvas(t,e){const n=Ut({width:t,height:e}),i=n.getContext("webgl",{alpha:!0,premultipliedAlpha:!1,depth:!1,stencil:!1,antialias:!1});i&&(i.clearColor(0,0,0,0),this.canvas=n,this.gl=i)}applyFilters(t,e,n,i,s,r){const o=this.gl,a=s.getContext("2d");if(!o||!a)return;let h;r&&(h=this.getCachedTexture(r,e));const c={originalWidth:e.width||e.naturalWidth||0,originalHeight:e.height||e.naturalHeight||0,sourceWidth:n,sourceHeight:i,destinationWidth:n,destinationHeight:i,context:o,sourceTexture:this.createTexture(o,n,i,h?void 0:e),targetTexture:this.createTexture(o,n,i),originalTexture:h||this.createTexture(o,n,i,h?void 0:e),passes:t.length,webgl:!0,aPosition:this.aPosition,programCache:this.programCache,pass:0,filterBackend:this,targetCanvas:s},l=o.createFramebuffer();return o.bindFramebuffer(o.FRAMEBUFFER,l),t.forEach((t=>{t&&t.applyTo(c)})),function(t){const e=t.targetCanvas,n=e.width,i=e.height,s=t.destinationWidth,r=t.destinationHeight;n===s&&i===r||(e.width=s,e.height=r)}(c),this.copyGLTo2D(o,c),o.bindTexture(o.TEXTURE_2D,null),o.deleteTexture(c.sourceTexture),o.deleteTexture(c.targetTexture),o.deleteFramebuffer(l),a.setTransform(1,0,0,1,0,0),c}dispose(){this.canvas&&(this.canvas=null,this.gl=null),this.clearWebGLCaches()}clearWebGLCaches(){this.programCache={},this.textureCache={}}createTexture(t,e,n,i,s){const{NEAREST:r,TEXTURE_2D:o,RGBA:a,UNSIGNED_BYTE:h,CLAMP_TO_EDGE:c,TEXTURE_MAG_FILTER:l,TEXTURE_MIN_FILTER:u,TEXTURE_WRAP_S:d,TEXTURE_WRAP_T:g}=t,p=t.createTexture();return t.bindTexture(o,p),t.texParameteri(o,l,s||r),t.texParameteri(o,u,s||r),t.texParameteri(o,d,c),t.texParameteri(o,g,c),i?t.texImage2D(o,0,a,a,h,i):t.texImage2D(o,0,a,e,n,0,a,h,null),p}getCachedTexture(t,e,n){const{textureCache:i}=this;if(i[t])return i[t];{const s=this.createTexture(this.gl,e.width,e.height,e,n);return s&&(i[t]=s),s}}evictCachesForKey(t){this.textureCache[t]&&(this.gl.deleteTexture(this.textureCache[t]),delete this.textureCache[t])}copyGLTo2D(t,e){const n=t.canvas,i=e.targetCanvas,s=i.getContext("2d");if(!s)return;s.translate(0,i.height),s.scale(1,-1);const r=n.height-i.height;s.drawImage(n,0,r,i.width,i.height,0,0,i.width,i.height)}copyGLTo2DPutImageData(t,e){const n=e.targetCanvas.getContext("2d"),i=e.destinationWidth,s=e.destinationHeight,r=i*s*4;if(!n)return;const o=new Uint8Array(this.imageBuffer,0,r),a=new Uint8ClampedArray(this.imageBuffer,0,r);t.readPixels(0,0,i,s,t.RGBA,t.UNSIGNED_BYTE,o);const h=new ImageData(a,i,s);n.putImageData(h,0,0)}captureGPUInfo(){if(this.gpuInfo)return this.gpuInfo;const t=this.gl,e={renderer:"",vendor:""};if(!t)return e;const n=t.getExtension("WEBGL_debug_renderer_info");if(n){const i=t.getParameter(n.UNMASKED_RENDERER_WEBGL),s=t.getParameter(n.UNMASKED_VENDOR_WEBGL);i&&(e.renderer=i.toLowerCase()),s&&(e.vendor=s.toLowerCase())}return this.gpuInfo=e,e}}let fa;function ma(){const{WebGLProbe:t}=W();return t.queryWebGL(Wt()),P.enableGLFiltering&&t.isSupported(P.textureSize)?new pa({tileSize:P.textureSize}):new ga}function _a(){return!fa&&(!(arguments.length>0&&void 0!==arguments[0])||arguments[0])&&(fa=ma()),fa}const va=["filters","resizeFilter","src","crossOrigin","type"],ya=["cropX","cropY"];class Ca extends Vi{static getDefaults(){return A(A({},super.getDefaults()),Ca.ownDefaults)}constructor(t,e){super(),E(this,"_lastScaleX",1),E(this,"_lastScaleY",1),E(this,"_filterScalingX",1),E(this,"_filterScalingY",1),this.filters=[],Object.assign(this,Ca.ownDefaults),this.setOptions(e),this.cacheKey="texture".concat(Bt()),this.setElement("string"==typeof t?(this.canvas&&Ce(this.canvas.getElement())||Y()).getElementById(t):t,e)}getElement(){return this._element}setElement(t){var e;let n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};this.removeTexture(this.cacheKey),this.removeTexture("".concat(this.cacheKey,"_filtered")),this._element=t,this._originalElement=t,this._setWidthHeight(n),null===(e=t.classList)||void 0===e||e.add(Ca.CSS_CANVAS),0!==this.filters.length&&this.applyFilters(),this.resizeFilter&&this.applyResizeFilters()}removeTexture(t){const e=_a(!1);e instanceof pa&&e.evictCachesForKey(t)}dispose(){super.dispose(),this.removeTexture(this.cacheKey),this.removeTexture("".concat(this.cacheKey,"_filtered")),this._cacheContext=null,["_originalElement","_element","_filteredEl","_cacheCanvas"].forEach((t=>{const e=this[t];e&&W().dispose(e),this[t]=void 0}))}getCrossOrigin(){return this._originalElement&&(this._originalElement.crossOrigin||null)}getOriginalSize(){const t=this.getElement();return t?{width:t.naturalWidth||t.width,height:t.naturalHeight||t.height}:{width:0,height:0}}_stroke(t){if(!this.stroke||0===this.strokeWidth)return;const e=this.width/2,n=this.height/2;t.beginPath(),t.moveTo(-e,-n),t.lineTo(e,-n),t.lineTo(e,n),t.lineTo(-e,n),t.lineTo(-e,-n),t.closePath()}toObject(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];const e=[];return this.filters.forEach((t=>{t&&e.push(t.toObject())})),A(A({},super.toObject([...ya,...t])),{},{src:this.getSrc(),crossOrigin:this.getCrossOrigin(),filters:e},this.resizeFilter?{resizeFilter:this.resizeFilter.toObject()}:{})}hasCrop(){return!!this.cropX||!!this.cropY||this.width<this._element.width||this.height<this._element.height}_toSVG(){const t=[],e=this._element,n=-this.width/2,i=-this.height/2;let s=[],r=[],o="",a="";if(!e)return[];if(this.hasCrop()){const t=Bt();s.push('<clipPath id="imageCrop_'+t+'">\n','\t<rect x="'+n+'" y="'+i+'" width="'+this.width+'" height="'+this.height+'" />\n',"</clipPath>\n"),o=' clip-path="url(#imageCrop_'+t+')" '}if(this.imageSmoothing||(a=' image-rendering="optimizeSpeed"'),t.push("\t<image ","COMMON_PARTS",'xlink:href="'.concat(this.getSvgSrc(!0),'" x="').concat(n-this.cropX,'" y="').concat(i-this.cropY,'" width="').concat(e.width||e.naturalWidth,'" height="').concat(e.height||e.naturalHeight,'"').concat(a).concat(o,"></image>\n")),this.stroke||this.strokeDashArray){const t=this.fill;this.fill=null,r=['\t<rect x="'.concat(n,'" y="').concat(i,'" width="').concat(this.width,'" height="').concat(this.height,'" style="').concat(this.getSvgStyles(),'" />\n')],this.fill=t}return s=this.paintFirst!==Ct?s.concat(r,t):s.concat(t,r),s}getSrc(t){const e=t?this._element:this._originalElement;return e?e.toDataURL?e.toDataURL():this.srcFromAttribute?e.getAttribute("src")||"":e.src:this.src||""}getSvgSrc(t){return this.getSrc(t)}setSrc(t){let{crossOrigin:e,signal:n}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return he(t,{crossOrigin:e,signal:n}).then((t=>{void 0!==e&&this.set({crossOrigin:e}),this.setElement(t)}))}toString(){return'#<Image: { src: "'.concat(this.getSrc(),'" }>')}applyResizeFilters(){const t=this.resizeFilter,e=this.minimumScaleTrigger,n=this.getTotalObjectScaling(),i=n.x,s=n.y,r=this._filteredEl||this._originalElement;if(this.group&&this.set("dirty",!0),!t||i>e&&s>e)return this._element=r,this._filterScalingX=1,this._filterScalingY=1,this._lastScaleX=i,void(this._lastScaleY=s);const o=Ut(r),{width:a,height:h}=r;this._element=o,this._lastScaleX=t.scaleX=i,this._lastScaleY=t.scaleY=s,_a().applyFilters([t],r,a,h,this._element),this._filterScalingX=o.width/this._originalElement.width,this._filterScalingY=o.height/this._originalElement.height}applyFilters(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.filters||[];if(t=t.filter((t=>t&&!t.isNeutralState())),this.set("dirty",!0),this.removeTexture("".concat(this.cacheKey,"_filtered")),0===t.length)return this._element=this._originalElement,this._filteredEl=void 0,this._filterScalingX=1,void(this._filterScalingY=1);const e=this._originalElement,n=e.naturalWidth||e.width,i=e.naturalHeight||e.height;if(this._element===this._originalElement){const t=Ut({width:n,height:i});this._element=t,this._filteredEl=t}else this._filteredEl&&(this._element=this._filteredEl,this._filteredEl.getContext("2d").clearRect(0,0,n,i),this._lastScaleX=1,this._lastScaleY=1);_a().applyFilters(t,this._originalElement,n,i,this._element,this.cacheKey),this._originalElement.width===this._element.width&&this._originalElement.height===this._element.height||(this._filterScalingX=this._element.width/this._originalElement.width,this._filterScalingY=this._element.height/this._originalElement.height)}_render(t){t.imageSmoothingEnabled=this.imageSmoothing,!0!==this.isMoving&&this.resizeFilter&&this._needsResize()&&this.applyResizeFilters(),this._stroke(t),this._renderPaintInOrder(t)}drawCacheOnCanvas(t){t.imageSmoothingEnabled=this.imageSmoothing,super.drawCacheOnCanvas(t)}shouldCache(){return this.needsItsOwnCache()}_renderFill(t){const e=this._element;if(!e)return;const n=this._filterScalingX,i=this._filterScalingY,s=this.width,r=this.height,o=Math.max(this.cropX,0),a=Math.max(this.cropY,0),h=e.naturalWidth||e.width,c=e.naturalHeight||e.height,l=o*n,u=a*i,d=Math.min(s*n,h-l),g=Math.min(r*i,c-u),p=-s/2,f=-r/2,m=Math.min(s,h/n-o),_=Math.min(r,c/i-a);e&&t.drawImage(e,l,u,d,g,p,f,m,_)}_needsResize(){const t=this.getTotalObjectScaling();return t.x!==this._lastScaleX||t.y!==this._lastScaleY}_resetWidthHeight(){this.set(this.getOriginalSize())}_setWidthHeight(){let{width:t,height:e}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};const n=this.getOriginalSize();this.width=t||n.width,this.height=e||n.height}parsePreserveAspectRatioAttribute(){const t=cn(this.preserveAspectRatio||""),e=this.width,n=this.height,i={width:e,height:n};let s,r=this._element.width,o=this._element.height,a=1,h=1,c=0,l=0,u=0,d=0;return!t||t.alignX===st&&t.alignY===st?(a=e/r,h=n/o):("meet"===t.meetOrSlice&&(a=h=sr(this._element,i),s=(e-r*a)/2,"Min"===t.alignX&&(c=-s),"Max"===t.alignX&&(c=s),s=(n-o*h)/2,"Min"===t.alignY&&(l=-s),"Max"===t.alignY&&(l=s)),"slice"===t.meetOrSlice&&(a=h=rr(this._element,i),s=r-e/a,"Mid"===t.alignX&&(u=s/2),"Max"===t.alignX&&(u=s),s=o-n/h,"Mid"===t.alignY&&(d=s/2),"Max"===t.alignY&&(d=s),r=e/a,o=n/h)),{width:r,height:o,scaleX:a,scaleY:h,offsetLeft:c,offsetTop:l,cropX:u,cropY:d}}static fromObject(t,e){let{filters:n,resizeFilter:i,src:s,crossOrigin:r,type:o}=t,a=O(t,va);return Promise.all([he(s,A(A({},e),{},{crossOrigin:r})),n&&ce(n,e),i&&ce([i],e),le(a,e)]).then((t=>{let[e,n=[],[i]=[],r={}]=t;return new this(e,A(A({},a),{},{src:s,filters:n,resizeFilter:i},r))}))}static fromURL(t){let{crossOrigin:e=null,signal:n}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},i=arguments.length>2?arguments[2]:void 0;return he(t,{crossOrigin:e,signal:n}).then((t=>new this(t,i)))}static async fromElement(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=arguments.length>2?arguments[2]:void 0;const i=Ws(t,this.ATTRIBUTE_NAMES,n);return this.fromURL(i["xlink:href"]||i.href,e,i).catch((t=>(M("log","Unable to parse Image",t),null)))}}function ba(t){if(!bn.test(t.nodeName))return{};const e=t.getAttribute("viewBox");let n,i,s=1,r=1,o=0,a=0;const h=t.getAttribute("width"),c=t.getAttribute("height"),l=t.getAttribute("x")||0,u=t.getAttribute("y")||0,d=!(e&&xn.test(e)),g=!h||!c||"100%"===h||"100%"===c;let p="",f=0,m=0;if(d&&(l||u)&&t.parentNode&&"#document"!==t.parentNode.nodeName&&(p=" translate("+hn(l||"0")+" "+hn(u||"0")+") ",n=(t.getAttribute("transform")||"")+p,t.setAttribute("transform",n),t.removeAttribute("x"),t.removeAttribute("y")),d&&g)return{width:0,height:0};const _={width:0,height:0};if(d)return _.width=hn(h),_.height=hn(c),_;const v=e.match(xn);o=-parseFloat(v[1]),a=-parseFloat(v[2]);const y=parseFloat(v[3]),C=parseFloat(v[4]);_.minX=o,_.minY=a,_.viewBoxWidth=y,_.viewBoxHeight=C,g?(_.width=y,_.height=C):(_.width=hn(h),_.height=hn(c),s=_.width/y,r=_.height/C);const b=cn(t.getAttribute("preserveAspectRatio")||"");if(b.alignX!==st&&("meet"===b.meetOrSlice&&(r=s=s>r?r:s),"slice"===b.meetOrSlice&&(r=s=s>r?s:r),f=_.width-y*s,m=_.height-C*s,"Mid"===b.alignX&&(f/=2),"Mid"===b.alignY&&(m/=2),"Min"===b.alignX&&(f=0),"Min"===b.alignY&&(m=0)),1===s&&1===r&&0===o&&0===a&&0===l&&0===u)return _;if((l||u)&&"#document"!==t.parentNode.nodeName&&(p=" translate("+hn(l||"0")+" "+hn(u||"0")+") "),n=p+" matrix("+s+" 0 0 "+r+" "+(o*s+f)+" "+(a*r+m)+") ","svg"===t.nodeName){for(i=t.ownerDocument.createElementNS(fn,"g");t.firstChild;)i.appendChild(t.firstChild);t.appendChild(i)}else i=t,i.removeAttribute("x"),i.removeAttribute("y"),n=i.getAttribute("transform")+n;return i.setAttribute("transform",n),_}E(Ca,"type","Image"),E(Ca,"cacheProperties",[...Yn,...ya]),E(Ca,"ownDefaults",{strokeWidth:0,srcFromAttribute:!1,minimumScaleTrigger:.5,cropX:0,cropY:0,imageSmoothing:!0}),E(Ca,"CSS_CANVAS","canvas-img"),E(Ca,"ATTRIBUTE_NAMES",[...hs,"x","y","width","height","preserveAspectRatio","xlink:href","href","crossOrigin","image-rendering"]),Tt.setClass(Ca),Tt.setSVGClass(Ca);const wa=t=>t.tagName.replace("svg:",""),xa=dn(["pattern","defs","symbol","metadata","clipPath","mask","desc"]);function Sa(t,e){let n,i,s,r,o=[];for(s=0,r=e.length;s<r;s++)n=e[s],i=t.getElementsByTagNameNS("http://www.w3.org/2000/svg",n),o=o.concat(Array.from(i));return o}const Ta=["gradientTransform","x1","x2","y1","y2","gradientUnits","cx","cy","r","fx","fy"],Ea="xlink:href";function ka(t,e){var n;const i=(null===(n=e.getAttribute(Ea))||void 0===n?void 0:n.slice(1))||"",s=t.getElementById(i);if(s&&s.getAttribute(Ea)&&ka(t,s),s&&(Ta.forEach((t=>{const n=s.getAttribute(t);!e.hasAttribute(t)&&n&&e.setAttribute(t,n)})),!e.children.length)){const t=s.cloneNode(!0);for(;t.firstChild;)e.appendChild(t.firstChild)}e.removeAttribute(Ea)}const Aa=["linearGradient","radialGradient","svg:linearGradient","svg:radialGradient"];function Oa(t){const e=t.getElementsByTagName("style");let n,i;const s={};for(n=0,i=e.length;n<i;n++){const t=(e[n].textContent||"").replace(/\/\*[\s\S]*?\*\//g,"");""!==t.trim()&&t.split("}").filter(((t,e,n)=>n.length>1&&t.trim())).forEach((t=>{if((t.match(/{/g)||[]).length>1&&t.trim().startsWith("@"))return;const e=t.split("{"),r={},o=e[1].trim().split(";").filter((function(t){return t.trim()}));for(n=0,i=o.length;n<i;n++){const t=o[n].split(":"),e=t[0].trim(),i=t[1].trim();r[e]=i}(t=e[0].trim()).split(",").forEach((t=>{""!==(t=t.replace(/^svg/i,"").trim())&&(s[t]=A(A({},s[t]||{}),r))}))}))}return s}const Da=t=>Tt.getSVGClass(wa(t).toLowerCase());class Ia{constructor(t,e,n,i,s){this.elements=t,this.options=e,this.reviver=n,this.regexUrl=/^url\(['"]?#([^'"]+)['"]?\)/g,this.doc=i,this.clipPaths=s,this.gradientDefs=function(t){const e=Sa(t,Aa),n={};let i=e.length;for(;i--;){const s=e[i];s.getAttribute("xlink:href")&&ka(t,s);const r=s.getAttribute("id");r&&(n[r]=s)}return n}(i),this.cssRules=Oa(i)}parse(){return Promise.all(this.elements.map((t=>this.createObject(t))))}async createObject(t){const e=Da(t);if(e){const n=await e.fromElement(t,this.options,this.cssRules);return this.resolveGradient(n,t,Ct),this.resolveGradient(n,t,bt),n instanceof Ca&&n._originalElement?jr(n,n.parsePreserveAspectRatioAttribute()):jr(n),await this.resolveClipPath(n,t),this.reviver&&this.reviver(t,n),n}return null}extractPropertyDefinition(t,e,n){const i=t[e],s=this.regexUrl;if(!s.test(i))return;s.lastIndex=0;const r=s.exec(i)[1];return s.lastIndex=0,n[r]}resolveGradient(t,e,n){const i=this.extractPropertyDefinition(t,n,this.gradientDefs);if(i){const s=e.getAttribute(n+"-opacity"),r=co.fromElement(i,t,A(A({},this.options),{},{opacity:s}));t.set(n,r)}}async resolveClipPath(t,e,n){const i=this.extractPropertyDefinition(t,"clipPath",this.clipPaths);if(i){const s=Kt(t.calcTransformMatrix()),r=i[0].parentElement;let o=e;for(;!n&&o.parentElement&&o.getAttribute("clip-path")!==t.clipPath;)o=o.parentElement;o.parentElement.appendChild(r);const a=Rs("".concat(o.getAttribute("transform")||""," ").concat(r.getAttribute("originalTransform")||""));r.setAttribute("transform","matrix(".concat(a.join(","),")"));const h=await Promise.all(i.map((t=>Da(t).fromElement(t,this.options,this.cssRules).then((t=>(jr(t),t.fillRule=t.clipRule,delete t.clipRule,t)))))),c=1===h.length?h[0]:new ir(h),l=Qt(s,c.calcTransformMatrix());c.clipPath&&await this.resolveClipPath(c,o,r.getAttribute("clip-path")?o:void 0);const{scaleX:u,scaleY:d,angle:g,skewX:p,translateX:f,translateY:m}=$t(l);c.set({flipX:!1,flipY:!1}),c.set({scaleX:u,scaleY:d,angle:g,skewX:p,skewY:0}),c.setPositionByOrigin(new It(f,m),$,$),t.clipPath=c}else delete t.clipPath}}const Pa=t=>Cn.test(wa(t)),Ma=()=>({objects:[],elements:[],options:{},allElements:[]});async function Ra(t,e){let{crossOrigin:n,signal:i}=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};if(i&&i.aborted)return M("log",new F("parseSVGDocument")),Ma();const s=t.documentElement;!function(t){const e=Sa(t,["use","svg:use"]),n=["x","y","xlink:href","href","transform"];for(const i of e){const e=i.attributes,s={};for(const t of e)t.value&&(s[t.name]=t.value);const r=(s["xlink:href"]||s.href||"").slice(1);if(""===r)return;const o=t.getElementById(r);if(null===o)return;let a=o.cloneNode(!0);const h=a.attributes,c={};for(const t of h)t.value&&(c[t.name]=t.value);const{x:l=0,y:u=0,transform:d=""}=s,g="".concat(d," ").concat(c.transform||""," translate(").concat(l,", ").concat(u,")");if(ba(a),/^svg$/i.test(a.nodeName)){const t=a.ownerDocument.createElementNS(fn,"g");Object.entries(c).forEach((e=>{let[n,i]=e;return t.setAttributeNS(fn,n,i)})),t.append(...a.childNodes),a=t}for(const t of e){if(!t)continue;const{name:e,value:i}=t;if(!n.includes(e))if("style"===e){const t={};js(i,t),Object.entries(c).forEach((e=>{let[n,i]=e;t[n]=i})),js(c.style||"",t);const n=Object.entries(t).map((t=>t.join(":"))).join(";");a.setAttribute(e,n)}else!c[e]&&a.setAttribute(e,i)}a.setAttribute("transform",g),a.setAttribute("instantiated_by_use","1"),a.removeAttribute("id"),i.parentNode.replaceChild(a,i)}}(t);const r=Array.from(s.getElementsByTagName("*")),o=A(A({},ba(s)),{},{crossOrigin:n,signal:i}),a=r.filter((t=>(ba(t),Pa(t)&&!function(t){let e=t;for(;e&&(e=e.parentElement);)if(e&&e.nodeName&&xa.test(wa(e))&&!e.getAttribute("instantiated_by_use"))return!0;return!1}(t))));if(!a||a&&!a.length)return A(A({},Ma()),{},{options:o,allElements:r});const h={};r.filter((t=>"clipPath"===wa(t))).forEach((t=>{t.setAttribute("originalTransform",t.getAttribute("transform")||"");const e=t.getAttribute("id");h[e]=Array.from(t.getElementsByTagName("*")).filter((t=>Pa(t)))}));const c=new Ia(a,o,e,t,h);return{objects:await c.parse(),elements:a,options:o,allElements:r}}function Fa(t,e){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return new Promise(((e,i)=>{Lr(t.replace(/^\n\s*/,"").trim(),{onComplete:t=>{const n=t.responseXML;n&&e(n),i()},signal:n.signal})})).then((t=>Ra(t,e,n))).catch((()=>Ma()))}const La=dt,ja=t=>function(e,n,i){const{points:s,pathOffset:r}=i;return new It(s[t]).subtract(r).transform(Qt(i.getViewportTransform(),i.calcTransformMatrix()))},Na=(t,e,n,i)=>{const{target:s,pointIndex:r}=e,o=s,a=We(new It(n,i),void 0,o.calcOwnMatrix());return o.points[r]=a.add(o.pathOffset),o.setDimensions(),!0},Ba=(t,e)=>function(n,i,s,r){const o=i.target,a=new It(o.points[(t>0?t:o.points.length)-1]),h=a.subtract(o.pathOffset).transform(o.calcOwnMatrix()),c=e(n,A(A({},i),{},{pointIndex:t}),s,r),l=a.subtract(o.pathOffset).transform(o.calcOwnMatrix()).subtract(h);return o.left-=l.x,o.top-=l.y,c},Wa=t=>di(La,Ba(t,Na)),Ya=(t,e,n)=>{const{path:i,pathOffset:s}=t,r=i[e];return new It(r[n]-s.x,r[n+1]-s.y).transform(Qt(t.getViewportTransform(),t.calcTransformMatrix()))};function Ua(t,e,n){const{commandIndex:i,pointIndex:s}=this;return Ya(n,i,s)}function Xa(t,e,n,i){const{target:s}=e,{commandIndex:r,pointIndex:o}=this,a=((t,e,n,i,s)=>{const{path:r,pathOffset:o}=t,a=r[(i>0?i:r.length)-1],h=new It(a[s],a[s+1]),c=h.subtract(o).transform(t.calcOwnMatrix()),l=We(new It(e,n),void 0,t.calcOwnMatrix());r[i][s]=l.x+o.x,r[i][s+1]=l.y+o.y,t.setDimensions();const u=h.subtract(t.pathOffset).transform(t.calcOwnMatrix()).subtract(c);return t.left-=u.x,t.top-=u.y,t.set("dirty",!0),!0})(s,n,i,r,o);return Xe(this.actionName,A(A({},Qe(t,e,n,i)),{},{commandIndex:r,pointIndex:o})),a}class Ga extends _i{constructor(t){super(t)}render(t,e,n,i,s){const r=A(A({},i),{},{cornerColor:this.controlFill,cornerStrokeColor:this.controlStroke,transparentCorners:!this.controlFill});super.render(t,e,n,r,s)}}class Va extends Ga{constructor(t){super(t)}render(t,e,n,i,s){const{path:r}=s,{commandIndex:o,pointIndex:a,connectToCommandIndex:h,connectToPointIndex:c}=this;t.save(),t.strokeStyle=this.controlStroke,this.connectionDashArray&&t.setLineDash(this.connectionDashArray);const[l]=r[o],u=Ya(s,h,c);if("Q"===l){const i=Ya(s,o,a+2);t.moveTo(i.x,i.y),t.lineTo(e,n)}else t.moveTo(e,n);t.lineTo(u.x,u.y),t.stroke(),t.restore(),super.render(t,e,n,i,s)}}const Ha=(t,e,n,i,s,r)=>new(n?Va:Ga)(A(A({commandIndex:t,pointIndex:e,actionName:"modifyPath",positionHandler:Ua,actionHandler:Xa,connectToCommandIndex:s,connectToPointIndex:r},i),n?i.controlPointStyle:i.pointStyle));var za=Object.freeze({__proto__:null,changeWidth:pi,createObjectDefaultControls:Wi,createPathControls:function(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const n={};let i="M";return t.path.forEach(((t,s)=>{const r=t[0];switch("Z"!==r&&(n["c_".concat(s,"_").concat(r)]=Ha(s,t.length-2,!1,e)),r){case"C":n["c_".concat(s,"_C_CP_1")]=Ha(s,1,!0,e,s-1,(t=>"C"===t?5:"Q"===t?3:1)(i)),n["c_".concat(s,"_C_CP_2")]=Ha(s,3,!0,e,s,5);break;case"Q":n["c_".concat(s,"_Q_CP_1")]=Ha(s,1,!0,e,s,3)}i=r})),n},createPolyActionHandler:Wa,createPolyControls:function(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const n={};for(let i=0;i<("number"==typeof t?t:t.points.length);i++)n["p".concat(i)]=new _i(A({actionName:La,positionHandler:ja(i),actionHandler:Wa(i)},e));return n},createPolyPositionHandler:ja,createResizeControls:Yi,createTextboxDefaultControls:Ui,dragHandler:$e,factoryPolyActionHandler:Ba,getLocalPoint:Ze,polyActionHandler:Na,renderCircleControl:fi,renderSquareControl:mi,rotationStyleHandler:vi,rotationWithSnapping:yi,scaleCursorStyleHandler:xi,scaleOrSkewActionName:Li,scaleSkewCursorStyleHandler:ji,scalingEqually:Ti,scalingX:Ei,scalingXOrSkewingY:Ni,scalingY:ki,scalingYOrSkewingX:Bi,skewCursorStyleHandler:Ii,skewHandlerX:Mi,skewHandlerY:Ri,wrapWithFireEvent:di,wrapWithFixedAnchor:gi});const qa=t=>void 0!==t.webgl,Ka="precision highp float",Qa="\n    ".concat(Ka,";\n    varying vec2 vTexCoord;\n    uniform sampler2D uTexture;\n    void main() {\n      gl_FragColor = texture2D(uTexture, vTexCoord);\n    }"),Ja=["type"],Za=["type"],$a=new RegExp(Ka,"g");class th{get type(){return this.constructor.type}constructor(){let t=O(arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},Ja);Object.assign(this,this.constructor.defaults,t)}getFragmentSource(){return Qa}getVertexSource(){return"\n    attribute vec2 aPosition;\n    varying vec2 vTexCoord;\n    void main() {\n      vTexCoord = aPosition;\n      gl_Position = vec4(aPosition * 2.0 - 1.0, 0.0, 1.0);\n    }"}createProgram(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.getFragmentSource(),n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:this.getVertexSource();const{WebGLProbe:{GLPrecision:i="highp"}}=W();"highp"!==i&&(e=e.replace($a,Ka.replace("highp",i)));const s=t.createShader(t.VERTEX_SHADER),r=t.createShader(t.FRAGMENT_SHADER),o=t.createProgram();if(!s||!r||!o)throw new R("Vertex, fragment shader or program creation error");if(t.shaderSource(s,n),t.compileShader(s),!t.getShaderParameter(s,t.COMPILE_STATUS))throw new R("Vertex shader compile error for ".concat(this.type,": ").concat(t.getShaderInfoLog(s)));if(t.shaderSource(r,e),t.compileShader(r),!t.getShaderParameter(r,t.COMPILE_STATUS))throw new R("Fragment shader compile error for ".concat(this.type,": ").concat(t.getShaderInfoLog(r)));if(t.attachShader(o,s),t.attachShader(o,r),t.linkProgram(o),!t.getProgramParameter(o,t.LINK_STATUS))throw new R('Shader link error for "'.concat(this.type,'" ').concat(t.getProgramInfoLog(o)));const a=this.getUniformLocations(t,o)||{};return a.uStepW=t.getUniformLocation(o,"uStepW"),a.uStepH=t.getUniformLocation(o,"uStepH"),{program:o,attributeLocations:this.getAttributeLocations(t,o),uniformLocations:a}}getAttributeLocations(t,e){return{aPosition:t.getAttribLocation(e,"aPosition")}}getUniformLocations(t,e){const n=this.constructor.uniformLocations,i={};for(let s=0;s<n.length;s++)i[n[s]]=t.getUniformLocation(e,n[s]);return i}sendAttributeData(t,e,n){const i=e.aPosition,s=t.createBuffer();t.bindBuffer(t.ARRAY_BUFFER,s),t.enableVertexAttribArray(i),t.vertexAttribPointer(i,2,t.FLOAT,!1,0,0),t.bufferData(t.ARRAY_BUFFER,n,t.STATIC_DRAW)}_setupFrameBuffer(t){const e=t.context;if(t.passes>1){const n=t.destinationWidth,i=t.destinationHeight;t.sourceWidth===n&&t.sourceHeight===i||(e.deleteTexture(t.targetTexture),t.targetTexture=t.filterBackend.createTexture(e,n,i)),e.framebufferTexture2D(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0,e.TEXTURE_2D,t.targetTexture,0)}else e.bindFramebuffer(e.FRAMEBUFFER,null),e.finish()}_swapTextures(t){t.passes--,t.pass++;const e=t.targetTexture;t.targetTexture=t.sourceTexture,t.sourceTexture=e}isNeutralState(t){return!1}applyTo(t){qa(t)?(this._setupFrameBuffer(t),this.applyToWebGL(t),this._swapTextures(t)):this.applyTo2d(t)}applyTo2d(t){}getCacheKey(){return this.type}retrieveShader(t){const e=this.getCacheKey();return t.programCache[e]||(t.programCache[e]=this.createProgram(t.context)),t.programCache[e]}applyToWebGL(t){const e=t.context,n=this.retrieveShader(t);0===t.pass&&t.originalTexture?e.bindTexture(e.TEXTURE_2D,t.originalTexture):e.bindTexture(e.TEXTURE_2D,t.sourceTexture),e.useProgram(n.program),this.sendAttributeData(e,n.attributeLocations,t.aPosition),e.uniform1f(n.uniformLocations.uStepW,1/t.sourceWidth),e.uniform1f(n.uniformLocations.uStepH,1/t.sourceHeight),this.sendUniformData(e,n.uniformLocations),e.viewport(0,0,t.destinationWidth,t.destinationHeight),e.drawArrays(e.TRIANGLE_STRIP,0,4)}bindAdditionalTexture(t,e,n){t.activeTexture(n),t.bindTexture(t.TEXTURE_2D,e),t.activeTexture(t.TEXTURE0)}unbindAdditionalTexture(t,e){t.activeTexture(e),t.bindTexture(t.TEXTURE_2D,null),t.activeTexture(t.TEXTURE0)}sendUniformData(t,e){}createHelpLayer(t){if(!t.helpLayer){const{sourceWidth:e,sourceHeight:n}=t,i=Ut({width:e,height:n});t.helpLayer=i}}toObject(){const t=Object.keys(this.constructor.defaults||{});return A({type:this.type},t.reduce(((t,e)=>(t[e]=this[e],t)),{}))}toJSON(){return this.toObject()}static async fromObject(t,e){return new this(O(t,Za))}}E(th,"type","BaseFilter"),E(th,"uniformLocations",[]);const eh={multiply:"gl_FragColor.rgb *= uColor.rgb;\n",screen:"gl_FragColor.rgb = 1.0 - (1.0 - gl_FragColor.rgb) * (1.0 - uColor.rgb);\n",add:"gl_FragColor.rgb += uColor.rgb;\n",difference:"gl_FragColor.rgb = abs(gl_FragColor.rgb - uColor.rgb);\n",subtract:"gl_FragColor.rgb -= uColor.rgb;\n",lighten:"gl_FragColor.rgb = max(gl_FragColor.rgb, uColor.rgb);\n",darken:"gl_FragColor.rgb = min(gl_FragColor.rgb, uColor.rgb);\n",exclusion:"gl_FragColor.rgb += uColor.rgb - 2.0 * (uColor.rgb * gl_FragColor.rgb);\n",overlay:"\n    if (uColor.r < 0.5) {\n      gl_FragColor.r *= 2.0 * uColor.r;\n    } else {\n      gl_FragColor.r = 1.0 - 2.0 * (1.0 - gl_FragColor.r) * (1.0 - uColor.r);\n    }\n    if (uColor.g < 0.5) {\n      gl_FragColor.g *= 2.0 * uColor.g;\n    } else {\n      gl_FragColor.g = 1.0 - 2.0 * (1.0 - gl_FragColor.g) * (1.0 - uColor.g);\n    }\n    if (uColor.b < 0.5) {\n      gl_FragColor.b *= 2.0 * uColor.b;\n    } else {\n      gl_FragColor.b = 1.0 - 2.0 * (1.0 - gl_FragColor.b) * (1.0 - uColor.b);\n    }\n    ",tint:"\n    gl_FragColor.rgb *= (1.0 - uColor.a);\n    gl_FragColor.rgb += uColor.rgb;\n    "};class nh extends th{getCacheKey(){return"".concat(this.type,"_").concat(this.mode)}getFragmentSource(){return"\n      precision highp float;\n      uniform sampler2D uTexture;\n      uniform vec4 uColor;\n      varying vec2 vTexCoord;\n      void main() {\n        vec4 color = texture2D(uTexture, vTexCoord);\n        gl_FragColor = color;\n        if (color.a > 0.0) {\n          ".concat(eh[this.mode],"\n        }\n      }\n      ")}applyTo2d(t){let{imageData:{data:e}}=t;const n=new an(this.color).getSource(),i=this.alpha,s=n[0]*i,r=n[1]*i,o=n[2]*i,a=1-i;for(let h=0;h<e.length;h+=4){const t=e[h],n=e[h+1],i=e[h+2];let c,l,u;switch(this.mode){case"multiply":c=t*s/255,l=n*r/255,u=i*o/255;break;case"screen":c=255-(255-t)*(255-s)/255,l=255-(255-n)*(255-r)/255,u=255-(255-i)*(255-o)/255;break;case"add":c=t+s,l=n+r,u=i+o;break;case"difference":c=Math.abs(t-s),l=Math.abs(n-r),u=Math.abs(i-o);break;case"subtract":c=t-s,l=n-r,u=i-o;break;case"darken":c=Math.min(t,s),l=Math.min(n,r),u=Math.min(i,o);break;case"lighten":c=Math.max(t,s),l=Math.max(n,r),u=Math.max(i,o);break;case"overlay":c=s<128?2*t*s/255:255-2*(255-t)*(255-s)/255,l=r<128?2*n*r/255:255-2*(255-n)*(255-r)/255,u=o<128?2*i*o/255:255-2*(255-i)*(255-o)/255;break;case"exclusion":c=s+t-2*s*t/255,l=r+n-2*r*n/255,u=o+i-2*o*i/255;break;case"tint":c=s+t*a,l=r+n*a,u=o+i*a}e[h]=c,e[h+1]=l,e[h+2]=u}}sendUniformData(t,e){const n=new an(this.color).getSource();n[0]=this.alpha*n[0]/255,n[1]=this.alpha*n[1]/255,n[2]=this.alpha*n[2]/255,n[3]=this.alpha,t.uniform4fv(e.uColor,n)}}E(nh,"defaults",{color:"#F95C63",mode:"multiply",alpha:1}),E(nh,"type","BlendColor"),E(nh,"uniformLocations",["uColor"]),Tt.setClass(nh);const ih={multiply:"\n    precision highp float;\n    uniform sampler2D uTexture;\n    uniform sampler2D uImage;\n    uniform vec4 uColor;\n    varying vec2 vTexCoord;\n    varying vec2 vTexCoord2;\n    void main() {\n      vec4 color = texture2D(uTexture, vTexCoord);\n      vec4 color2 = texture2D(uImage, vTexCoord2);\n      color.rgba *= color2.rgba;\n      gl_FragColor = color;\n    }\n    ",mask:"\n    precision highp float;\n    uniform sampler2D uTexture;\n    uniform sampler2D uImage;\n    uniform vec4 uColor;\n    varying vec2 vTexCoord;\n    varying vec2 vTexCoord2;\n    void main() {\n      vec4 color = texture2D(uTexture, vTexCoord);\n      vec4 color2 = texture2D(uImage, vTexCoord2);\n      color.a = color2.a;\n      gl_FragColor = color;\n    }\n    "},sh=["type","image"];class rh extends th{getCacheKey(){return"".concat(this.type,"_").concat(this.mode)}getFragmentSource(){return ih[this.mode]}getVertexSource(){return"\n    attribute vec2 aPosition;\n    varying vec2 vTexCoord;\n    varying vec2 vTexCoord2;\n    uniform mat3 uTransformMatrix;\n    void main() {\n      vTexCoord = aPosition;\n      vTexCoord2 = (uTransformMatrix * vec3(aPosition, 1.0)).xy;\n      gl_Position = vec4(aPosition * 2.0 - 1.0, 0.0, 1.0);\n    }\n    "}applyToWebGL(t){const e=t.context,n=this.createTexture(t.filterBackend,this.image);this.bindAdditionalTexture(e,n,e.TEXTURE1),super.applyToWebGL(t),this.unbindAdditionalTexture(e,e.TEXTURE1)}createTexture(t,e){return t.getCachedTexture(e.cacheKey,e.getElement())}calculateMatrix(){const t=this.image,{width:e,height:n}=t.getElement();return[1/t.scaleX,0,0,0,1/t.scaleY,0,-t.left/e,-t.top/n,1]}applyTo2d(t){let{imageData:{data:e,width:n,height:i},filterBackend:{resources:s}}=t;const r=this.image;s.blendImage||(s.blendImage=Wt());const o=s.blendImage,a=o.getContext("2d");o.width!==n||o.height!==i?(o.width=n,o.height=i):a.clearRect(0,0,n,i),a.setTransform(r.scaleX,0,0,r.scaleY,r.left,r.top),a.drawImage(r.getElement(),0,0,n,i);const h=a.getImageData(0,0,n,i).data;for(let c=0;c<e.length;c+=4){const t=e[c],n=e[c+1],i=e[c+2],s=e[c+3],r=h[c],o=h[c+1],a=h[c+2],l=h[c+3];switch(this.mode){case"multiply":e[c]=t*r/255,e[c+1]=n*o/255,e[c+2]=i*a/255,e[c+3]=s*l/255;break;case"mask":e[c+3]=l}}}sendUniformData(t,e){const n=this.calculateMatrix();t.uniform1i(e.uImage,1),t.uniformMatrix3fv(e.uTransformMatrix,!1,n)}toObject(){return A(A({},super.toObject()),{},{image:this.image&&this.image.toObject()})}static async fromObject(t,e){let{type:n,image:i}=t,s=O(t,sh);return Ca.fromObject(i,e).then((t=>new this(A(A({},s),{},{image:t}))))}}E(rh,"type","BlendImage"),E(rh,"defaults",{mode:"multiply",alpha:1}),E(rh,"uniformLocations",["uTransformMatrix","uImage"]),Tt.setClass(rh);class oh extends th{getFragmentSource(){return"\n    precision highp float;\n    uniform sampler2D uTexture;\n    uniform vec2 uDelta;\n    varying vec2 vTexCoord;\n    const float nSamples = 15.0;\n    vec3 v3offset = vec3(12.9898, 78.233, 151.7182);\n    float random(vec3 scale) {\n      /* use the fragment position for a different seed per-pixel */\n      return fract(sin(dot(gl_FragCoord.xyz, scale)) * 43758.5453);\n    }\n    void main() {\n      vec4 color = vec4(0.0);\n      float total = 0.0;\n      float offset = random(v3offset);\n      for (float t = -nSamples; t <= nSamples; t++) {\n        float percent = (t + offset - 0.5) / nSamples;\n        float weight = 1.0 - abs(percent);\n        color += texture2D(uTexture, vTexCoord + uDelta * percent) * weight;\n        total += weight;\n      }\n      gl_FragColor = color / total;\n    }\n  "}applyTo(t){qa(t)?(this.aspectRatio=t.sourceWidth/t.sourceHeight,t.passes++,this._setupFrameBuffer(t),this.horizontal=!0,this.applyToWebGL(t),this._swapTextures(t),this._setupFrameBuffer(t),this.horizontal=!1,this.applyToWebGL(t),this._swapTextures(t)):this.applyTo2d(t)}applyTo2d(t){t.imageData=this.simpleBlur(t)}simpleBlur(t){let{ctx:e,imageData:n,filterBackend:{resources:i}}=t;const{width:s,height:r}=n;i.blurLayer1||(i.blurLayer1=Wt(),i.blurLayer2=Wt());const o=i.blurLayer1,a=i.blurLayer2;o.width===s&&o.height===r||(a.width=o.width=s,a.height=o.height=r);const h=o.getContext("2d"),c=a.getContext("2d"),l=15,u=.06*this.blur*.5;let d,g,p,f;for(h.putImageData(n,0,0),c.clearRect(0,0,s,r),f=-15;f<=l;f++)d=(Math.random()-.5)/4,g=f/l,p=u*g*s+d,c.globalAlpha=1-Math.abs(g),c.drawImage(o,p,d),h.drawImage(a,0,0),c.globalAlpha=1,c.clearRect(0,0,a.width,a.height);for(f=-15;f<=l;f++)d=(Math.random()-.5)/4,g=f/l,p=u*g*r+d,c.globalAlpha=1-Math.abs(g),c.drawImage(o,d,p),h.drawImage(a,0,0),c.globalAlpha=1,c.clearRect(0,0,a.width,a.height);e.drawImage(o,0,0);const m=e.getImageData(0,0,o.width,o.height);return h.globalAlpha=1,h.clearRect(0,0,o.width,o.height),m}sendUniformData(t,e){const n=this.chooseRightDelta();t.uniform2fv(e.uDelta,n)}isNeutralState(){return 0===this.blur}chooseRightDelta(){let t=1;const e=[0,0];this.horizontal?this.aspectRatio>1&&(t=1/this.aspectRatio):this.aspectRatio<1&&(t=this.aspectRatio);const n=t*this.blur*.12;return this.horizontal?e[0]=n:e[1]=n,e}}E(oh,"type","Blur"),E(oh,"defaults",{blur:0}),E(oh,"uniformLocations",["uDelta"]),Tt.setClass(oh);class ah extends th{getFragmentSource(){return"\n  precision highp float;\n  uniform sampler2D uTexture;\n  uniform float uBrightness;\n  varying vec2 vTexCoord;\n  void main() {\n    vec4 color = texture2D(uTexture, vTexCoord);\n    color.rgb += uBrightness;\n    gl_FragColor = color;\n  }\n"}applyTo2d(t){let{imageData:{data:e}}=t;const n=Math.round(255*this.brightness);for(let i=0;i<e.length;i+=4)e[i]+=n,e[i+1]+=n,e[i+2]+=n}isNeutralState(){return 0===this.brightness}sendUniformData(t,e){t.uniform1f(e.uBrightness,this.brightness)}}E(ah,"type","Brightness"),E(ah,"defaults",{brightness:0}),E(ah,"uniformLocations",["uBrightness"]),Tt.setClass(ah);const hh={matrix:[1,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,1,0],colorsOnly:!0};class ch extends th{getFragmentSource(){return"\n  precision highp float;\n  uniform sampler2D uTexture;\n  varying vec2 vTexCoord;\n  uniform mat4 uColorMatrix;\n  uniform vec4 uConstants;\n  void main() {\n    vec4 color = texture2D(uTexture, vTexCoord);\n    color *= uColorMatrix;\n    color += uConstants;\n    gl_FragColor = color;\n  }"}applyTo2d(t){const e=t.imageData.data,n=this.matrix,i=this.colorsOnly;for(let s=0;s<e.length;s+=4){const t=e[s],r=e[s+1],o=e[s+2];if(e[s]=t*n[0]+r*n[1]+o*n[2]+255*n[4],e[s+1]=t*n[5]+r*n[6]+o*n[7]+255*n[9],e[s+2]=t*n[10]+r*n[11]+o*n[12]+255*n[14],!i){const i=e[s+3];e[s]+=i*n[3],e[s+1]+=i*n[8],e[s+2]+=i*n[13],e[s+3]=t*n[15]+r*n[16]+o*n[17]+i*n[18]+255*n[19]}}}sendUniformData(t,e){const n=this.matrix,i=[n[0],n[1],n[2],n[3],n[5],n[6],n[7],n[8],n[10],n[11],n[12],n[13],n[15],n[16],n[17],n[18]],s=[n[4],n[9],n[14],n[19]];t.uniformMatrix4fv(e.uColorMatrix,!1,i),t.uniform4fv(e.uConstants,s)}toObject(){return A(A({},super.toObject()),{},{matrix:[...this.matrix]})}}function lh(t,e){var n;const i=(E(n=class extends ch{toObject(){return{type:this.type,colorsOnly:this.colorsOnly}}},"type",t),E(n,"defaults",{colorsOnly:!1,matrix:e}),n);return Tt.setClass(i,t),i}E(ch,"type","ColorMatrix"),E(ch,"defaults",hh),E(ch,"uniformLocations",["uColorMatrix","uConstants"]),Tt.setClass(ch);const uh=lh("Brownie",[.5997,.34553,-.27082,0,.186,-.0377,.86095,.15059,0,-.1449,.24113,-.07441,.44972,0,-.02965,0,0,0,1,0]),dh=lh("Vintage",[.62793,.32021,-.03965,0,.03784,.02578,.64411,.03259,0,.02926,.0466,-.08512,.52416,0,.02023,0,0,0,1,0]),gh=lh("Kodachrome",[1.12855,-.39673,-.03992,0,.24991,-.16404,1.08352,-.05498,0,.09698,-.16786,-.56034,1.60148,0,.13972,0,0,0,1,0]),ph=lh("Technicolor",[1.91252,-.85453,-.09155,0,.04624,-.30878,1.76589,-.10601,0,-.27589,-.2311,-.75018,1.84759,0,.12137,0,0,0,1,0]),fh=lh("Polaroid",[1.438,-.062,-.062,0,0,-.122,1.378,-.122,0,0,-.016,-.016,1.483,0,0,0,0,0,1,0]),mh=lh("Sepia",[.393,.769,.189,0,0,.349,.686,.168,0,0,.272,.534,.131,0,0,0,0,0,1,0]),_h=lh("BlackWhite",[1.5,1.5,1.5,0,-1,1.5,1.5,1.5,0,-1,1.5,1.5,1.5,0,-1,0,0,0,1,0]);class vh extends th{constructor(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};super(t),this.subFilters=t.subFilters||[]}applyTo(t){qa(t)&&(t.passes+=this.subFilters.length-1),this.subFilters.forEach((e=>{e.applyTo(t)}))}toObject(){return{type:this.type,subFilters:this.subFilters.map((t=>t.toObject()))}}isNeutralState(){return!this.subFilters.some((t=>!t.isNeutralState()))}static fromObject(t,e){return Promise.all((t.subFilters||[]).map((t=>Tt.getClass(t.type).fromObject(t,e)))).then((t=>new this({subFilters:t})))}}E(vh,"type","Composed"),Tt.setClass(vh);class yh extends th{getFragmentSource(){return"\n  precision highp float;\n  uniform sampler2D uTexture;\n  uniform float uContrast;\n  varying vec2 vTexCoord;\n  void main() {\n    vec4 color = texture2D(uTexture, vTexCoord);\n    float contrastF = 1.015 * (uContrast + 1.0) / (1.0 * (1.015 - uContrast));\n    color.rgb = contrastF * (color.rgb - 0.5) + 0.5;\n    gl_FragColor = color;\n  }"}isNeutralState(){return 0===this.contrast}applyTo2d(t){let{imageData:{data:e}}=t;const n=Math.floor(255*this.contrast),i=259*(n+255)/(255*(259-n));for(let s=0;s<e.length;s+=4)e[s]=i*(e[s]-128)+128,e[s+1]=i*(e[s+1]-128)+128,e[s+2]=i*(e[s+2]-128)+128}sendUniformData(t,e){t.uniform1f(e.uContrast,this.contrast)}}E(yh,"type","Contrast"),E(yh,"defaults",{contrast:0}),E(yh,"uniformLocations",["uContrast"]),Tt.setClass(yh);const Ch={Convolute_3_1:"\n    precision highp float;\n    uniform sampler2D uTexture;\n    uniform float uMatrix[9];\n    uniform float uStepW;\n    uniform float uStepH;\n    varying vec2 vTexCoord;\n    void main() {\n      vec4 color = vec4(0, 0, 0, 0);\n      for (float h = 0.0; h < 3.0; h+=1.0) {\n        for (float w = 0.0; w < 3.0; w+=1.0) {\n          vec2 matrixPos = vec2(uStepW * (w - 1), uStepH * (h - 1));\n          color += texture2D(uTexture, vTexCoord + matrixPos) * uMatrix[int(h * 3.0 + w)];\n        }\n      }\n      gl_FragColor = color;\n    }\n    ",Convolute_3_0:"\n    precision highp float;\n    uniform sampler2D uTexture;\n    uniform float uMatrix[9];\n    uniform float uStepW;\n    uniform float uStepH;\n    varying vec2 vTexCoord;\n    void main() {\n      vec4 color = vec4(0, 0, 0, 1);\n      for (float h = 0.0; h < 3.0; h+=1.0) {\n        for (float w = 0.0; w < 3.0; w+=1.0) {\n          vec2 matrixPos = vec2(uStepW * (w - 1.0), uStepH * (h - 1.0));\n          color.rgb += texture2D(uTexture, vTexCoord + matrixPos).rgb * uMatrix[int(h * 3.0 + w)];\n        }\n      }\n      float alpha = texture2D(uTexture, vTexCoord).a;\n      gl_FragColor = color;\n      gl_FragColor.a = alpha;\n    }\n    ",Convolute_5_1:"\n    precision highp float;\n    uniform sampler2D uTexture;\n    uniform float uMatrix[25];\n    uniform float uStepW;\n    uniform float uStepH;\n    varying vec2 vTexCoord;\n    void main() {\n      vec4 color = vec4(0, 0, 0, 0);\n      for (float h = 0.0; h < 5.0; h+=1.0) {\n        for (float w = 0.0; w < 5.0; w+=1.0) {\n          vec2 matrixPos = vec2(uStepW * (w - 2.0), uStepH * (h - 2.0));\n          color += texture2D(uTexture, vTexCoord + matrixPos) * uMatrix[int(h * 5.0 + w)];\n        }\n      }\n      gl_FragColor = color;\n    }\n    ",Convolute_5_0:"\n    precision highp float;\n    uniform sampler2D uTexture;\n    uniform float uMatrix[25];\n    uniform float uStepW;\n    uniform float uStepH;\n    varying vec2 vTexCoord;\n    void main() {\n      vec4 color = vec4(0, 0, 0, 1);\n      for (float h = 0.0; h < 5.0; h+=1.0) {\n        for (float w = 0.0; w < 5.0; w+=1.0) {\n          vec2 matrixPos = vec2(uStepW * (w - 2.0), uStepH * (h - 2.0));\n          color.rgb += texture2D(uTexture, vTexCoord + matrixPos).rgb * uMatrix[int(h * 5.0 + w)];\n        }\n      }\n      float alpha = texture2D(uTexture, vTexCoord).a;\n      gl_FragColor = color;\n      gl_FragColor.a = alpha;\n    }\n    ",Convolute_7_1:"\n    precision highp float;\n    uniform sampler2D uTexture;\n    uniform float uMatrix[49];\n    uniform float uStepW;\n    uniform float uStepH;\n    varying vec2 vTexCoord;\n    void main() {\n      vec4 color = vec4(0, 0, 0, 0);\n      for (float h = 0.0; h < 7.0; h+=1.0) {\n        for (float w = 0.0; w < 7.0; w+=1.0) {\n          vec2 matrixPos = vec2(uStepW * (w - 3.0), uStepH * (h - 3.0));\n          color += texture2D(uTexture, vTexCoord + matrixPos) * uMatrix[int(h * 7.0 + w)];\n        }\n      }\n      gl_FragColor = color;\n    }\n    ",Convolute_7_0:"\n    precision highp float;\n    uniform sampler2D uTexture;\n    uniform float uMatrix[49];\n    uniform float uStepW;\n    uniform float uStepH;\n    varying vec2 vTexCoord;\n    void main() {\n      vec4 color = vec4(0, 0, 0, 1);\n      for (float h = 0.0; h < 7.0; h+=1.0) {\n        for (float w = 0.0; w < 7.0; w+=1.0) {\n          vec2 matrixPos = vec2(uStepW * (w - 3.0), uStepH * (h - 3.0));\n          color.rgb += texture2D(uTexture, vTexCoord + matrixPos).rgb * uMatrix[int(h * 7.0 + w)];\n        }\n      }\n      float alpha = texture2D(uTexture, vTexCoord).a;\n      gl_FragColor = color;\n      gl_FragColor.a = alpha;\n    }\n    ",Convolute_9_1:"\n    precision highp float;\n    uniform sampler2D uTexture;\n    uniform float uMatrix[81];\n    uniform float uStepW;\n    uniform float uStepH;\n    varying vec2 vTexCoord;\n    void main() {\n      vec4 color = vec4(0, 0, 0, 0);\n      for (float h = 0.0; h < 9.0; h+=1.0) {\n        for (float w = 0.0; w < 9.0; w+=1.0) {\n          vec2 matrixPos = vec2(uStepW * (w - 4.0), uStepH * (h - 4.0));\n          color += texture2D(uTexture, vTexCoord + matrixPos) * uMatrix[int(h * 9.0 + w)];\n        }\n      }\n      gl_FragColor = color;\n    }\n    ",Convolute_9_0:"\n    precision highp float;\n    uniform sampler2D uTexture;\n    uniform float uMatrix[81];\n    uniform float uStepW;\n    uniform float uStepH;\n    varying vec2 vTexCoord;\n    void main() {\n      vec4 color = vec4(0, 0, 0, 1);\n      for (float h = 0.0; h < 9.0; h+=1.0) {\n        for (float w = 0.0; w < 9.0; w+=1.0) {\n          vec2 matrixPos = vec2(uStepW * (w - 4.0), uStepH * (h - 4.0));\n          color.rgb += texture2D(uTexture, vTexCoord + matrixPos).rgb * uMatrix[int(h * 9.0 + w)];\n        }\n      }\n      float alpha = texture2D(uTexture, vTexCoord).a;\n      gl_FragColor = color;\n      gl_FragColor.a = alpha;\n    }\n    "};class bh extends th{getCacheKey(){return"".concat(this.type,"_").concat(Math.sqrt(this.matrix.length),"_").concat(this.opaque?1:0)}getFragmentSource(){return Ch[this.getCacheKey()]}applyTo2d(t){const e=t.imageData,n=e.data,i=this.matrix,s=Math.round(Math.sqrt(i.length)),r=Math.floor(s/2),o=e.width,a=e.height,h=t.ctx.createImageData(o,a),c=h.data,l=this.opaque?1:0;let u,d,g,p,f,m,_,v,y,C,b,w,x;for(b=0;b<a;b++)for(C=0;C<o;C++){for(f=4*(b*o+C),u=0,d=0,g=0,p=0,x=0;x<s;x++)for(w=0;w<s;w++)_=b+x-r,m=C+w-r,_<0||_>=a||m<0||m>=o||(v=4*(_*o+m),y=i[x*s+w],u+=n[v]*y,d+=n[v+1]*y,g+=n[v+2]*y,l||(p+=n[v+3]*y));c[f]=u,c[f+1]=d,c[f+2]=g,c[f+3]=l?n[f+3]:p}t.imageData=h}sendUniformData(t,e){t.uniform1fv(e.uMatrix,this.matrix)}toObject(){return A(A({},super.toObject()),{},{opaque:this.opaque,matrix:[...this.matrix]})}}E(bh,"type","Convolute"),E(bh,"defaults",{opaque:!1,matrix:[0,0,0,0,1,0,0,0,0]}),E(bh,"uniformLocations",["uMatrix","uOpaque","uHalfSize","uSize"]),Tt.setClass(bh);const wh="Gamma";class xh extends th{getFragmentSource(){return"\n  precision highp float;\n  uniform sampler2D uTexture;\n  uniform vec3 uGamma;\n  varying vec2 vTexCoord;\n  void main() {\n    vec4 color = texture2D(uTexture, vTexCoord);\n    vec3 correction = (1.0 / uGamma);\n    color.r = pow(color.r, correction.r);\n    color.g = pow(color.g, correction.g);\n    color.b = pow(color.b, correction.b);\n    gl_FragColor = color;\n    gl_FragColor.rgb *= color.a;\n  }\n"}constructor(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};super(t),this.gamma=t.gamma||this.constructor.defaults.gamma.concat()}applyTo2d(t){let{imageData:{data:e}}=t;const n=this.gamma,i=1/n[0],s=1/n[1],r=1/n[2];this.rgbValues||(this.rgbValues={r:new Uint8Array(256),g:new Uint8Array(256),b:new Uint8Array(256)});const o=this.rgbValues;for(let a=0;a<256;a++)o.r[a]=255*Math.pow(a/255,i),o.g[a]=255*Math.pow(a/255,s),o.b[a]=255*Math.pow(a/255,r);for(let a=0;a<e.length;a+=4)e[a]=o.r[e[a]],e[a+1]=o.g[e[a+1]],e[a+2]=o.b[e[a+2]]}sendUniformData(t,e){t.uniform3fv(e.uGamma,this.gamma)}isNeutralState(){const{gamma:t}=this;return 1===t[0]&&1===t[1]&&1===t[2]}toObject(){return{type:wh,gamma:this.gamma.concat()}}}E(xh,"type",wh),E(xh,"defaults",{gamma:[1,1,1]}),E(xh,"uniformLocations",["uGamma"]),Tt.setClass(xh);const Sh={average:"\n    precision highp float;\n    uniform sampler2D uTexture;\n    varying vec2 vTexCoord;\n    void main() {\n      vec4 color = texture2D(uTexture, vTexCoord);\n      float average = (color.r + color.b + color.g) / 3.0;\n      gl_FragColor = vec4(average, average, average, color.a);\n    }\n    ",lightness:"\n    precision highp float;\n    uniform sampler2D uTexture;\n    uniform int uMode;\n    varying vec2 vTexCoord;\n    void main() {\n      vec4 col = texture2D(uTexture, vTexCoord);\n      float average = (max(max(col.r, col.g),col.b) + min(min(col.r, col.g),col.b)) / 2.0;\n      gl_FragColor = vec4(average, average, average, col.a);\n    }\n    ",luminosity:"\n    precision highp float;\n    uniform sampler2D uTexture;\n    uniform int uMode;\n    varying vec2 vTexCoord;\n    void main() {\n      vec4 col = texture2D(uTexture, vTexCoord);\n      float average = 0.21 * col.r + 0.72 * col.g + 0.07 * col.b;\n      gl_FragColor = vec4(average, average, average, col.a);\n    }\n    "};class Th extends th{applyTo2d(t){let{imageData:{data:e}}=t;for(let n,i=0;i<e.length;i+=4){const t=e[i],s=e[i+1],r=e[i+2];switch(this.mode){case"average":n=(t+s+r)/3;break;case"lightness":n=(Math.min(t,s,r)+Math.max(t,s,r))/2;break;case"luminosity":n=.21*t+.72*s+.07*r}e[i+2]=e[i+1]=e[i]=n}}getCacheKey(){return"".concat(this.type,"_").concat(this.mode)}getFragmentSource(){return Sh[this.mode]}sendUniformData(t,e){t.uniform1i(e.uMode,1)}isNeutralState(){return!1}}E(Th,"type","Grayscale"),E(Th,"defaults",{mode:"average"}),E(Th,"uniformLocations",["uMode"]),Tt.setClass(Th);const Eh=A(A({},hh),{},{rotation:0});class kh extends ch{calculateMatrix(){const t=this.rotation*Math.PI,e=Ot(t),n=Dt(t),i=1/3,s=Math.sqrt(i)*n,r=1-e;this.matrix=[e+r/3,i*r-s,i*r+s,0,0,i*r+s,e+i*r,i*r-s,0,0,i*r-s,i*r+s,e+i*r,0,0,0,0,0,1,0]}isNeutralState(){return 0===this.rotation}applyTo(t){this.calculateMatrix(),super.applyTo(t)}toObject(){return{type:this.type,rotation:this.rotation}}}E(kh,"type","HueRotation"),E(kh,"defaults",Eh),Tt.setClass(kh);class Ah extends th{applyTo2d(t){let{imageData:{data:e}}=t;for(let n=0;n<e.length;n+=4)e[n]=255-e[n],e[n+1]=255-e[n+1],e[n+2]=255-e[n+2],this.alpha&&(e[n+3]=255-e[n+3])}getFragmentSource(){return"\n  precision highp float;\n  uniform sampler2D uTexture;\n  uniform int uInvert;\n  uniform int uAlpha;\n  varying vec2 vTexCoord;\n  void main() {\n    vec4 color = texture2D(uTexture, vTexCoord);\n    if (uInvert == 1) {\n      if (uAlpha == 1) {\n        gl_FragColor = vec4(1.0 - color.r,1.0 -color.g,1.0 -color.b,1.0 -color.a);\n      } else {\n        gl_FragColor = vec4(1.0 - color.r,1.0 -color.g,1.0 -color.b,color.a);\n      }\n    } else {\n      gl_FragColor = color;\n    }\n  }\n"}isNeutralState(){return!this.invert}sendUniformData(t,e){t.uniform1i(e.uInvert,Number(this.invert)),t.uniform1i(e.uAlpha,Number(this.alpha))}}E(Ah,"type","Invert"),E(Ah,"defaults",{alpha:!1,invert:!0}),E(Ah,"uniformLocations",["uInvert","uAlpha"]),Tt.setClass(Ah);class Oh extends th{getFragmentSource(){return"\n  precision highp float;\n  uniform sampler2D uTexture;\n  uniform float uStepH;\n  uniform float uNoise;\n  uniform float uSeed;\n  varying vec2 vTexCoord;\n  float rand(vec2 co, float seed, float vScale) {\n    return fract(sin(dot(co.xy * vScale ,vec2(12.9898 , 78.233))) * 43758.5453 * (seed + 0.01) / 2.0);\n  }\n  void main() {\n    vec4 color = texture2D(uTexture, vTexCoord);\n    color.rgb += (0.5 - rand(vTexCoord, uSeed, 0.1 / uStepH)) * uNoise;\n    gl_FragColor = color;\n  }\n"}applyTo2d(t){let{imageData:{data:e}}=t;const n=this.noise;for(let i=0;i<e.length;i+=4){const t=(.5-Math.random())*n;e[i]+=t,e[i+1]+=t,e[i+2]+=t}}sendUniformData(t,e){t.uniform1f(e.uNoise,this.noise/255),t.uniform1f(e.uSeed,Math.random())}isNeutralState(){return 0===this.noise}}E(Oh,"type","Noise"),E(Oh,"defaults",{noise:0}),E(Oh,"uniformLocations",["uNoise","uSeed"]),Tt.setClass(Oh);class Dh extends th{applyTo2d(t){let{imageData:{data:e,width:n,height:i}}=t;for(let s=0;s<i;s+=this.blocksize)for(let t=0;t<n;t+=this.blocksize){const r=4*s*n+4*t,o=e[r],a=e[r+1],h=e[r+2],c=e[r+3];for(let l=s;l<Math.min(s+this.blocksize,i);l++)for(let i=t;i<Math.min(t+this.blocksize,n);i++){const t=4*l*n+4*i;e[t]=o,e[t+1]=a,e[t+2]=h,e[t+3]=c}}}isNeutralState(){return 1===this.blocksize}getFragmentSource(){return"\n  precision highp float;\n  uniform sampler2D uTexture;\n  uniform float uBlocksize;\n  uniform float uStepW;\n  uniform float uStepH;\n  varying vec2 vTexCoord;\n  void main() {\n    float blockW = uBlocksize * uStepW;\n    float blockH = uBlocksize * uStepH;\n    int posX = int(vTexCoord.x / blockW);\n    int posY = int(vTexCoord.y / blockH);\n    float fposX = float(posX);\n    float fposY = float(posY);\n    vec2 squareCoords = vec2(fposX * blockW, fposY * blockH);\n    vec4 color = texture2D(uTexture, squareCoords);\n    gl_FragColor = color;\n  }\n"}sendUniformData(t,e){t.uniform1f(e.uBlocksize,this.blocksize)}}E(Dh,"type","Pixelate"),E(Dh,"defaults",{blocksize:4}),E(Dh,"uniformLocations",["uBlocksize"]),Tt.setClass(Dh);class Ih extends th{getFragmentSource(){return"\nprecision highp float;\nuniform sampler2D uTexture;\nuniform vec4 uLow;\nuniform vec4 uHigh;\nvarying vec2 vTexCoord;\nvoid main() {\n  gl_FragColor = texture2D(uTexture, vTexCoord);\n  if(all(greaterThan(gl_FragColor.rgb,uLow.rgb)) && all(greaterThan(uHigh.rgb,gl_FragColor.rgb))) {\n    gl_FragColor.a = 0.0;\n  }\n}\n"}applyTo2d(t){let{imageData:{data:e}}=t;const n=255*this.distance,i=new an(this.color).getSource(),s=[i[0]-n,i[1]-n,i[2]-n],r=[i[0]+n,i[1]+n,i[2]+n];for(let o=0;o<e.length;o+=4){const t=e[o],n=e[o+1],i=e[o+2];t>s[0]&&n>s[1]&&i>s[2]&&t<r[0]&&n<r[1]&&i<r[2]&&(e[o+3]=0)}}sendUniformData(t,e){const n=new an(this.color).getSource(),i=this.distance,s=[0+n[0]/255-i,0+n[1]/255-i,0+n[2]/255-i,1],r=[n[0]/255+i,n[1]/255+i,n[2]/255+i,1];t.uniform4fv(e.uLow,s),t.uniform4fv(e.uHigh,r)}}E(Ih,"type","RemoveColor"),E(Ih,"defaults",{color:"#FFFFFF",distance:.02,useAlpha:!1}),E(Ih,"uniformLocations",["uLow","uHigh"]),Tt.setClass(Ih);class Ph extends th{sendUniformData(t,e){t.uniform2fv(e.uDelta,this.horizontal?[1/this.width,0]:[0,1/this.height]),t.uniform1fv(e.uTaps,this.taps)}getFilterWindow(){const t=this.tempScale;return Math.ceil(this.lanczosLobes/t)}getCacheKey(){const t=this.getFilterWindow();return"".concat(this.type,"_").concat(t)}getFragmentSource(){const t=this.getFilterWindow();return this.generateShader(t)}getTaps(){const t=this.lanczosCreate(this.lanczosLobes),e=this.tempScale,n=this.getFilterWindow(),i=new Array(n);for(let s=1;s<=n;s++)i[s-1]=t(s*e);return i}generateShader(t){const e=new Array(t);for(let n=1;n<=t;n++)e[n-1]="".concat(n,".0 * uDelta");return"\n      precision highp float;\n      uniform sampler2D uTexture;\n      uniform vec2 uDelta;\n      varying vec2 vTexCoord;\n      uniform float uTaps[".concat(t,"];\n      void main() {\n        vec4 color = texture2D(uTexture, vTexCoord);\n        float sum = 1.0;\n        ").concat(e.map(((t,e)=>"\n              color += texture2D(uTexture, vTexCoord + ".concat(t,") * uTaps[").concat(e,"] + texture2D(uTexture, vTexCoord - ").concat(t,") * uTaps[").concat(e,"];\n              sum += 2.0 * uTaps[").concat(e,"];\n            "))).join("\n"),"\n        gl_FragColor = color / sum;\n      }\n    ")}applyToForWebgl(t){t.passes++,this.width=t.sourceWidth,this.horizontal=!0,this.dW=Math.round(this.width*this.scaleX),this.dH=t.sourceHeight,this.tempScale=this.dW/this.width,this.taps=this.getTaps(),t.destinationWidth=this.dW,super.applyTo(t),t.sourceWidth=t.destinationWidth,this.height=t.sourceHeight,this.horizontal=!1,this.dH=Math.round(this.height*this.scaleY),this.tempScale=this.dH/this.height,this.taps=this.getTaps(),t.destinationHeight=this.dH,super.applyTo(t),t.sourceHeight=t.destinationHeight}applyTo(t){qa(t)?this.applyToForWebgl(t):this.applyTo2d(t)}isNeutralState(){return 1===this.scaleX&&1===this.scaleY}lanczosCreate(t){return e=>{if(e>=t||e<=-t)return 0;if(e<1.1920929e-7&&e>-1.1920929e-7)return 1;const n=(e*=Math.PI)/t;return Math.sin(e)/e*Math.sin(n)/n}}applyTo2d(t){const e=t.imageData,n=this.scaleX,i=this.scaleY;this.rcpScaleX=1/n,this.rcpScaleY=1/i;const s=e.width,r=e.height,o=Math.round(s*n),a=Math.round(r*i);let h;h="sliceHack"===this.resizeType?this.sliceByTwo(t,s,r,o,a):"hermite"===this.resizeType?this.hermiteFastResize(t,s,r,o,a):"bilinear"===this.resizeType?this.bilinearFiltering(t,s,r,o,a):"lanczos"===this.resizeType?this.lanczosResize(t,s,r,o,a):new ImageData(o,a),t.imageData=h}sliceByTwo(t,e,n,i,s){const r=t.imageData,o=.5;let a=!1,h=!1,c=e*o,l=n*o;const u=t.filterBackend.resources;let d=0,g=0;const p=e;let f=0;u.sliceByTwo||(u.sliceByTwo=Wt());const m=u.sliceByTwo;(m.width<1.5*e||m.height<n)&&(m.width=1.5*e,m.height=n);const _=m.getContext("2d");for(_.clearRect(0,0,1.5*e,n),_.putImageData(r,0,0),i=Math.floor(i),s=Math.floor(s);!a||!h;)e=c,n=l,i<Math.floor(c*o)?c=Math.floor(c*o):(c=i,a=!0),s<Math.floor(l*o)?l=Math.floor(l*o):(l=s,h=!0),_.drawImage(m,d,g,e,n,p,f,c,l),d=p,g=f,f+=l;return _.getImageData(d,g,i,s)}lanczosResize(t,e,n,i,s){const r=t.imageData.data,o=t.ctx.createImageData(i,s),a=o.data,h=this.lanczosCreate(this.lanczosLobes),c=this.rcpScaleX,l=this.rcpScaleY,u=2/this.rcpScaleX,d=2/this.rcpScaleY,g=Math.ceil(c*this.lanczosLobes/2),p=Math.ceil(l*this.lanczosLobes/2),f={},m={x:0,y:0},_={x:0,y:0};return function t(v){let y,C,b,w,x,S,T,E,k,A,O;for(m.x=(v+.5)*c,_.x=Math.floor(m.x),y=0;y<s;y++){for(m.y=(y+.5)*l,_.y=Math.floor(m.y),x=0,S=0,T=0,E=0,k=0,C=_.x-g;C<=_.x+g;C++)if(!(C<0||C>=e)){A=Math.floor(1e3*Math.abs(C-m.x)),f[A]||(f[A]={});for(let t=_.y-p;t<=_.y+p;t++)t<0||t>=n||(O=Math.floor(1e3*Math.abs(t-m.y)),f[A][O]||(f[A][O]=h(Math.sqrt(Math.pow(A*u,2)+Math.pow(O*d,2))/1e3)),b=f[A][O],b>0&&(w=4*(t*e+C),x+=b,S+=b*r[w],T+=b*r[w+1],E+=b*r[w+2],k+=b*r[w+3]))}w=4*(y*i+v),a[w]=S/x,a[w+1]=T/x,a[w+2]=E/x,a[w+3]=k/x}return++v<i?t(v):o}(0)}bilinearFiltering(t,e,n,i,s){let r,o,a,h,c,l,u,d,g,p,f,m,_,v=0;const y=this.rcpScaleX,C=this.rcpScaleY,b=4*(e-1),w=t.imageData.data,x=t.ctx.createImageData(i,s),S=x.data;for(u=0;u<s;u++)for(d=0;d<i;d++)for(c=Math.floor(y*d),l=Math.floor(C*u),g=y*d-c,p=C*u-l,_=4*(l*e+c),f=0;f<4;f++)r=w[_+f],o=w[_+4+f],a=w[_+b+f],h=w[_+b+4+f],m=r*(1-g)*(1-p)+o*g*(1-p)+a*p*(1-g)+h*g*p,S[v++]=m;return x}hermiteFastResize(t,e,n,i,s){const r=this.rcpScaleX,o=this.rcpScaleY,a=Math.ceil(r/2),h=Math.ceil(o/2),c=t.imageData.data,l=t.ctx.createImageData(i,s),u=l.data;for(let d=0;d<s;d++)for(let t=0;t<i;t++){const n=4*(t+d*i);let s=0,l=0,g=0,p=0,f=0,m=0,_=0;const v=(d+.5)*o;for(let i=Math.floor(d*o);i<(d+1)*o;i++){const n=Math.abs(v-(i+.5))/h,o=(t+.5)*r,u=n*n;for(let h=Math.floor(t*r);h<(t+1)*r;h++){let t=Math.abs(o-(h+.5))/a;const n=Math.sqrt(u+t*t);n>1&&n<-1||(s=2*n*n*n-3*n*n+1,s>0&&(t=4*(h+i*e),_+=s*c[t+3],g+=s,c[t+3]<255&&(s=s*c[t+3]/250),p+=s*c[t],f+=s*c[t+1],m+=s*c[t+2],l+=s))}}u[n]=p/l,u[n+1]=f/l,u[n+2]=m/l,u[n+3]=_/g}return l}}E(Ph,"type","Resize"),E(Ph,"defaults",{resizeType:"hermite",scaleX:1,scaleY:1,lanczosLobes:3}),E(Ph,"uniformLocations",["uDelta","uTaps"]),Tt.setClass(Ph);class Mh extends th{getFragmentSource(){return"\n  precision highp float;\n  uniform sampler2D uTexture;\n  uniform float uSaturation;\n  varying vec2 vTexCoord;\n  void main() {\n    vec4 color = texture2D(uTexture, vTexCoord);\n    float rgMax = max(color.r, color.g);\n    float rgbMax = max(rgMax, color.b);\n    color.r += rgbMax != color.r ? (rgbMax - color.r) * uSaturation : 0.00;\n    color.g += rgbMax != color.g ? (rgbMax - color.g) * uSaturation : 0.00;\n    color.b += rgbMax != color.b ? (rgbMax - color.b) * uSaturation : 0.00;\n    gl_FragColor = color;\n  }\n"}applyTo2d(t){let{imageData:{data:e}}=t;const n=-this.saturation;for(let i=0;i<e.length;i+=4){const t=e[i],s=e[i+1],r=e[i+2],o=Math.max(t,s,r);e[i]+=o!==t?(o-t)*n:0,e[i+1]+=o!==s?(o-s)*n:0,e[i+2]+=o!==r?(o-r)*n:0}}sendUniformData(t,e){t.uniform1f(e.uSaturation,-this.saturation)}isNeutralState(){return 0===this.saturation}}E(Mh,"type","Saturation"),E(Mh,"defaults",{saturation:0}),E(Mh,"uniformLocations",["uSaturation"]),Tt.setClass(Mh);class Rh extends th{getFragmentSource(){return"\n  precision highp float;\n  uniform sampler2D uTexture;\n  uniform float uVibrance;\n  varying vec2 vTexCoord;\n  void main() {\n    vec4 color = texture2D(uTexture, vTexCoord);\n    float max = max(color.r, max(color.g, color.b));\n    float avg = (color.r + color.g + color.b) / 3.0;\n    float amt = (abs(max - avg) * 2.0) * uVibrance;\n    color.r += max != color.r ? (max - color.r) * amt : 0.00;\n    color.g += max != color.g ? (max - color.g) * amt : 0.00;\n    color.b += max != color.b ? (max - color.b) * amt : 0.00;\n    gl_FragColor = color;\n  }\n"}applyTo2d(t){let{imageData:{data:e}}=t;const n=-this.vibrance;for(let i=0;i<e.length;i+=4){const t=e[i],s=e[i+1],r=e[i+2],o=Math.max(t,s,r),a=(t+s+r)/3,h=2*Math.abs(o-a)/255*n;e[i]+=o!==t?(o-t)*h:0,e[i+1]+=o!==s?(o-s)*h:0,e[i+2]+=o!==r?(o-r)*h:0}}sendUniformData(t,e){t.uniform1f(e.uVibrance,-this.vibrance)}isNeutralState(){return 0===this.vibrance}}E(Rh,"type","Vibrance"),E(Rh,"defaults",{vibrance:0}),E(Rh,"uniformLocations",["uVibrance"]),Tt.setClass(Rh);Object.freeze({__proto__:null,BaseFilter:th,BlackWhite:_h,BlendColor:nh,BlendImage:rh,Blur:oh,Brightness:ah,Brownie:uh,ColorMatrix:ch,Composed:vh,Contrast:yh,Convolute:bh,Gamma:xh,Grayscale:Th,HueRotation:kh,Invert:Ah,Kodachrome:gh,Noise:Oh,Pixelate:Dh,Polaroid:fh,RemoveColor:Ih,Resize:Ph,Saturation:Mh,Sepia:mh,Technicolor:ph,Vibrance:Rh,Vintage:dh});var Fh=n(5835),Lh=n(4),jh=n(1897),Nh=n(9790),Bh=n(3731),Wh=n(3757),Yh=n(7800),Uh=n(6272),Xh=n(1321),Gh=n(2697),Vh=n(9759),Hh=n(7608),zh=JSON.parse('{"clothesList":[{"name":"드레스","icon":"dress.svg","svgUrl":{"인간":"dress.svg","인간팔":"dress팔.svg"},"position":{"인간":{"left":0,"top":0},"인간팔":{"left":0,"top":0}},"colorButtons":[{"label":"핑크/파랑","mainColor":"#ff69b4","targets":[{"type":"id","value":"dress_body1","color":"#ff69b4"},{"type":"id","value":"dress_body2","color":"#ff69b4"},{"type":"id","value":"belt","color":"#00bfff"}]},{"label":"핑크/노랑","mainColor":"#ffe066","targets":[{"type":"id","value":"dress_body1","color":"#ff69b4"},{"type":"id","value":"dress_body2","color":"#ff69b4"},{"type":"id","value":"belt","color":"#ffe066"}]},{"label":"노랑/파랑","mainColor":"#00cc44","targets":[{"type":"id","value":"dress_body1","color":"#00cc44"},{"type":"id","value":"dress_body2","color":"#00cc44"},{"type":"id","value":"belt","color":"#00bfff"}]}]},{"name":"셔츠","icon":"shirt.svg","svgUrl":{"인간":"shirt.svg","인간팔":"shirt팔.svg"},"position":{"인간":{"left":0,"top":0},"인간팔":{"left":0,"top":0}},"colorButtons":[{"label":"검정/흰색","mainColor":"#3E3E3EFF","targets":[{"type":"id","value":"main","color":"#3E3E3EFF"},{"type":"id","value":"collar","color":"#DDDDDDFF"}]},{"label":"주황/초록","mainColor":"#FF6969FF","targets":[{"type":"id","value":"main","color":"#FF6969FF"},{"type":"id","value":"collar","color":"#66FF87FF"}]},{"label":"보라/노랑","mainColor":"#C2CC00FF","targets":[{"type":"id","value":"main","color":"#C2CC00FF"},{"type":"id","value":"collar","color":"#5900FFFF"}]}]}]}');const qh=n(8660),Kh=(qh.keys().map(((t,e)=>({src:qh(t),label:`emoji${e+1}`}))),n(7089));function Qh(t){try{return Kh("./"+t)}catch{return""}}const Jh=zh.default||zh,Zh=Jh.clothesList||[],$h=Zh.map((t=>({...t,icon:Qh(t.icon),svgUrl:Object.fromEntries(Object.entries(t.svgUrl).map((([t,e])=>[t,Qh(e)])))})));var tc={data(){return{canvas:null,isRestoring:!1,predefinedImages:[Nh,Bh,Wh],additionalImages:[{src:Fh,label:"에펙"},{src:Lh,label:"일러"},{src:jh,label:"html"}],defaultImageObject:null,currentPose:"인간",colorButtonList:[{label:"핑크색",colors:[{id:"green_1",color:"#ff0055"},{id:"green_2",color:"#00bfff"}]},{label:"초록색",colors:[{id:"green_1",color:"#00cc44"},{id:"green_2",color:"#ffe066"}]}],clothesList:$h,selectedClothes:null,selectedColorIndexes:{},panelOpen:!1,touchStartY:0,touchMoveY:0}},methods:{togglePanel(){this.panelOpen=!this.panelOpen},onTouchStart(t){this.touchStartY=t.touches[0].clientY},onTouchMove(t){this.touchMoveY=t.touches[0].clientY},onTouchEnd(){const t=this.touchStartY-this.touchMoveY;t>30?this.panelOpen=!0:t<-30&&(this.panelOpen=!1)},async addHumanControlLayer(){if(this.humanControlLayer&&(this.canvas.remove(this.humanControlLayer),this.humanControlLayer=null),!this.humanSvgGroup)return;const t=this.humanSvgGroup.getBoundingRect(),e=new Xs({left:this.humanSvgGroup.left,top:this.humanSvgGroup.top,width:t.width,height:t.height,originX:this.humanSvgGroup.originX,originY:this.humanSvgGroup.originY,fill:"rgba(0,0,0,0)",selectable:!0,evented:!0,hasControls:!1,hasBorders:!1,padding:20});this.addCharacterControls(e),this.canvas.add(e),this.humanControlLayer=e,e.on("moving",(()=>{if(this.humanSvgGroup.set({left:e.left,top:e.top}),this.clothesSvgGroup){const t=this.selectedClothes?.position?.[this.currentPose]||{left:0,top:0};this.clothesSvgGroup.set({left:e.left+t.left*e.scaleX,top:e.top+t.top*e.scaleY})}this.canvas.renderAll()})),e.on("scaling",(()=>{if(this.humanSvgGroup.set({scaleX:e.scaleX,scaleY:e.scaleY,left:e.left,top:e.top}),this.clothesSvgGroup){const t=this.selectedClothes?.position?.[this.currentPose]||{left:0,top:0};this.clothesSvgGroup.set({scaleX:e.scaleX,scaleY:e.scaleY,left:e.left+t.left*e.scaleX,top:e.top+t.top*e.scaleY})}this.canvas.renderAll()})),e.on("rotating",(()=>{this.humanSvgGroup.set({angle:e.angle}),this.clothesSvgGroup&&this.clothesSvgGroup.set({angle:e.angle}),this.canvas.renderAll()})),this.canvas.renderAll()},async addHumanSvg(){let t=100,e=this.canvas.height/2,n=1,i=1,s=0;this.humanSvgGroup&&(t=this.humanSvgGroup.left,e=this.humanSvgGroup.top,n=this.humanSvgGroup.scaleX,i=this.humanSvgGroup.scaleY,s=this.humanSvgGroup.angle,this.canvas.remove(this.humanSvgGroup),this.humanSvgGroup=null);const r="인간팔"===this.currentPose?Hh:Vh,o=await Fa(r);let a=Nr.groupSVGElements(o.objects);a.set({left:t,top:e,originX:"center",originY:"center",scaleX:n,scaleY:i,angle:s,selectable:!0,evented:!0,hasControls:!1,hasBorders:!1,lockMovementX:!1,lockMovementY:!1,lockScalingX:!1,lockScalingY:!1,lockRotation:!1}),this.addCharacterControls(a),this.canvas.add(a),this.humanSvgGroup=a,this.addHumanMoveListener(),await this.addHumanControlLayer(),this.canvas.renderAll()},async selectClothes(t){this.clothesSvgGroup&&this.canvas.remove(this.clothesSvgGroup);const e="object"===typeof t.svgUrl?t.svgUrl[this.currentPose]||t.svgUrl["인간"]:t.svgUrl,n=await Fa(e);let i=Nr.groupSVGElements(n.objects);const s=this.humanSvgGroup,r=t.position?.[this.currentPose]||{left:0,top:0};i.set({left:s.left,top:s.top,originX:s.originX,originY:s.originY,scaleX:s.scaleX,scaleY:s.scaleY,angle:s.angle,selectable:!1,evented:!1,hasControls:!1,hasBorders:!1,lockMovementX:!0,lockMovementY:!0,lockScalingX:!0,lockScalingY:!0,lockRotation:!0}),i.forEachObject((t=>{t.left+=r.left,t.top+=r.top})),i.setCoords(),this.canvas.add(i),this.clothesSvgGroup=i,this.selectedClothes=t,this.canvas.renderAll();const o=this.selectedColorIndexes[t.name]??0,a=t.colorButtons[o];a&&this.changeClothesColors(a.targets,t.name,o),await this.addHumanControlLayer()},addHumanMoveListener(){this.humanSvgGroup&&(this.humanSvgGroup.set({selectable:!0,evented:!0}),this.humanSvgGroup.on("moving",(()=>{if(this.clothesSvgGroup&&this.selectedClothes){const t=this.selectedClothes.position?.[this.currentPose]||{left:0,top:0};this.clothesSvgGroup.set({left:this.humanSvgGroup.left+t.left*this.humanSvgGroup.scaleX,top:this.humanSvgGroup.top+t.top*this.humanSvgGroup.scaleY}),this.canvas.renderAll()}})),this.humanSvgGroup.on("scaling",(()=>{if(this.clothesSvgGroup&&this.selectedClothes){this.clothesSvgGroup.set({scaleX:this.humanSvgGroup.scaleX,scaleY:this.humanSvgGroup.scaleY});const t=this.selectedClothes.position?.[this.currentPose]||{left:0,top:0};this.clothesSvgGroup.set({left:this.humanSvgGroup.left+t.left*this.humanSvgGroup.scaleX,top:this.humanSvgGroup.top+t.top*this.humanSvgGroup.scaleY}),this.canvas.renderAll()}})))},async changePose(t){this.currentPose=t,this.humanSvgGroup&&this.canvas.remove(this.humanSvgGroup),this.clothesSvgGroup&&this.canvas.remove(this.clothesSvgGroup),await this.addHumanSvg(),this.addCharacterControls(this.humanSvgGroup),this.selectedClothes&&await this.selectClothes(this.selectedClothes),await this.addHumanControlLayer()},changeClothesColors(t,e,n){function i(e){e._objects?e._objects.forEach((t=>i(t))):t.forEach((({type:t,value:n,color:i})=>{("id"===t&&(e.id===n||e.get&&e.get("id")===n)||"class"===t&&(e.className===n||e.get&&e.get("class")===n))&&e.set("fill",i)}))}this.clothesSvgGroup&&(i(this.clothesSvgGroup),this.canvas.requestRenderAll(),this.selectedColorIndexes={...this.selectedColorIndexes,[e]:n})},saveCanvasAsImage(){let t=prompt("저장할 파일 이름을 입력하세요.","오늘기분외계인");if(null===t)return;t&&""!==t.trim()||(t="오늘기분외계인"),t.endsWith(".jpg")||t.endsWith(".png")||(t+=".jpg");const e=this.canvas.toDataURL({format:"jpg",quality:1}),n=document.createElement("a");n.href=e,n.download=t,document.body.appendChild(n),n.click(),document.body.removeChild(n)},changeSvgColorsByIds(t){this.svgGroup&&(this.svgGroup.forEachObject((e=>{t.forEach((({id:t,color:n})=>{e.id!==t&&e.get("id")!==t||e.set("fill",n)}))})),this.canvas.requestRenderAll())},async addSvgToCanvas(){const t=await Fa(Gh);let e=Nr.groupSVGElements(t.objects),n=e.getBoundingRect(),i=n.width,s=n.height;i&&s||(i=t.options.width||200,s=t.options.height||200);const r=this.canvas.width,o=this.canvas.height,a=Math.min(.5*r/i,.5*o/s,1);e.set({left:100,top:100,originX:"center",originY:"center",scaleX:a,scaleY:a,selectable:!0,evented:!0}),this.addCustomControls(e),this.canvas.add(e),this.canvas.setActiveObject(e),this.svgGroup=e,this.canvas.renderAll()},changeSvgColor(t){this.svgGroup&&(this.svgGroup.forEachObject((e=>{e.set&&e.set("fill",t)})),this.canvas.requestRenderAll())},renderDeleteIcon(t,e,n,i,s){const r=28,o=16,a=r+2*o,h=new Image;h.src=Yh,t.save(),t.translate(e,n),t.rotate(Nr.degreesToRadians(s.angle)),t.globalAlpha=.01,t.beginPath(),t.arc(0,0,a/2,0,2*Math.PI),t.fillStyle="#000",t.fill(),t.globalAlpha=1,t.drawImage(h,-r/2,-r/2,r,r),t.restore()},renderRotateIcon(t,e,n,i,s){const r=28,o=16,a=r+2*o,h=new Image;h.src=Uh,t.save(),t.translate(e,n),t.rotate(Nr.degreesToRadians(s.angle)),t.globalAlpha=.01,t.beginPath(),t.arc(0,0,a/2,0,2*Math.PI),t.fillStyle="#000",t.fill(),t.globalAlpha=1,t.drawImage(h,-r/2,-r/2,r,r),t.restore()},renderResizeIcon(t,e,n,i,s){const r=24,o=16,a=r+2*o,h=new Image;h.src=Xh,t.save(),t.translate(e,n),t.rotate(Nr.degreesToRadians(s.angle)),t.globalAlpha=.01,t.beginPath(),t.arc(0,0,a/2,0,2*Math.PI),t.fillStyle="#000",t.fill(),t.globalAlpha=1,t.drawImage(h,-r/2,-r/2,r,r),t.restore()},deleteObject(t,e){const n=e.target.canvas;"i-text"===e.target.type&&e.target._bgRect&&n.contains(e.target._bgRect)&&n.remove(e.target._bgRect),n.remove(e.target),n.requestRenderAll()},addCharacterControls(t){t.controls.deleteControl&&delete t.controls.deleteControl,t.setControlsVisibility({tl:!1,tr:!1,bl:!1,br:!1,mt:!1,mb:!1,ml:!1,mr:!1,mtr:!0,deleteControl:!1,rotateControl:!0,resizeControl:!0}),t.controls.rotateControl=new _i({x:0,y:-.5,offsetY:-40,cursorStyle:"crosshair",render:this.renderRotateIcon,cornerSize:28,actionHandler:za.rotationWithSnapping,hitbox:{width:60,height:60}}),t.controls.resizeControl=new _i({x:.5,y:.5,cursorStyle:"se-resize",render:this.renderResizeIcon,cornerSize:28,actionHandler:za.scalingEqually,hitbox:{width:60,height:60}}),t.set({cornerColor:"#00000000",cornerSize:18,cornerStyle:"circle",borderColor:"#00bfff",borderDashArray:[6,4],transparentCorners:!1,hasBorders:!1,hasControls:!1}),t.on("selected",(()=>{t.set({hasBorders:!0,hasControls:!0}),t.setControlsVisibility({tl:!1,tr:!1,bl:!1,br:!1,mt:!1,mb:!1,ml:!1,mr:!1,mtr:!0,deleteControl:!1,rotateControl:!0,resizeControl:!0}),t.canvas.requestRenderAll()})),t.on("deselected",(()=>{t.set({hasBorders:!1,hasControls:!1}),t.setControlsVisibility({tl:!1,tr:!1,bl:!1,br:!1,mt:!1,mb:!1,ml:!1,mr:!1,mtr:!0,deleteControl:!1,rotateControl:!0,resizeControl:!0}),t.canvas.requestRenderAll()}))},addCustomControls(t){t.setControlsVisibility({tl:!1,tr:!1,bl:!1,br:!1,mt:!1,mb:!1,ml:!1,mr:!1,mtr:!0,deleteControl:!0,rotateControl:!0,resizeControl:!0}),t.controls.deleteControl=new _i({x:.5,y:-.5,cursorStyle:"pointer",mouseUpHandler:this.deleteObject,render:this.renderDeleteIcon,cornerSize:28,hitbox:{width:60,height:60}}),t.controls.rotateControl=new _i({x:0,y:-.5,offsetY:-40,cursorStyle:"crosshair",render:this.renderRotateIcon,cornerSize:28,actionHandler:za.rotationWithSnapping,hitbox:{width:60,height:60}}),t.controls.resizeControl=new _i({x:.5,y:.5,cursorStyle:"se-resize",render:this.renderResizeIcon,cornerSize:28,actionHandler:za.scalingEqually,hitbox:{width:60,height:60}}),t.set({cornerColor:"#00000000",cornerSize:18,cornerStyle:"circle",borderColor:"#00bfff",borderDashArray:[6,4],transparentCorners:!1,hasBorders:!1,hasControls:!1}),t.on("selected",(()=>{t.set({hasBorders:!0,hasControls:!0}),t.setControlsVisibility({tl:!1,tr:!1,bl:!1,br:!1,mt:!1,mb:!1,ml:!1,mr:!1,mtr:!0,deleteControl:!0,rotateControl:!0,resizeControl:!0}),t.canvas.requestRenderAll()})),t.on("deselected",(()=>{t.set({hasBorders:!1,hasControls:!1}),t.setControlsVisibility({tl:!1,tr:!1,bl:!1,br:!1,mt:!1,mb:!1,ml:!1,mr:!1,mtr:!0,deleteControl:!0,rotateControl:!0,resizeControl:!0}),t.canvas.requestRenderAll()}))},addRectangle(){const t=new Xs({left:this.canvas.width/2,top:this.canvas.height/2,fill:"#ffe066",width:200,height:200,objectCaching:!1,originX:"center",originY:"center",centeredRotation:!0,padding:16,selectable:!0,evented:!0,hasControls:!1,hasBorders:!1});this.addCustomControls(t),this.canvas.add(t),this.canvas.setActiveObject(t),this.canvas.renderAll()},addTextbox(){const t="1.방문자 카운팅 ",e=24,n=new aa(t,{left:this.canvas.width/2,top:this.canvas.height/2,originX:"center",originY:"center",fontSize:32,fill:"#222",fontFamily:"sans-serif",editable:!0,selectable:!0,evented:!0,hasControls:!1,hasBorders:!1,backgroundColor:"transparent",textAlign:"center"}),i=new Xs({left:n.left,top:n.top,originX:"center",originY:"center",width:n.width+2*e,height:n.height+2*e,rx:18,ry:18,fill:"#fffbe6",selectable:!1,evented:!1,hasBorders:!1,hasControls:!1});n._bgRect=i,this.canvas.add(i),this.canvas.add(n);const s=()=>{const t=this.canvas.getObjects(),e=t.indexOf(i),s=t.indexOf(n);e>-1&&s>-1&&e!==s-1&&(t.splice(e,1),t.splice(s,0,i),this.canvas._objects=t)},r=()=>{n.setCoords(),i.set({width:n.width*n.scaleX+2*e,height:n.height*n.scaleY+2*e,left:n.left,top:n.top,scaleX:1,scaleY:1,angle:n.angle}),s(),this.canvas.requestRenderAll()};n.on("changed",r),n.on("scaling",r),n.on("moving",r),n.on("rotating",r),s(),this.addCustomControls(n),this.canvas.setActiveObject(n),this.canvas.renderAll()},addImage(t){const e=new window.Image;e.src=t,e.onload=()=>{let t=e.width,n=e.height;if(t>400){const e=400/t;t=400,n*=e}const i=new Ca(e,{left:this.canvas.width/2,top:this.canvas.height/2,originX:"center",originY:"center",width:t,height:n,selectable:!0,evented:!0,hasControls:!1,hasBorders:!1});this.addCustomControls(i),this.canvas.add(i),this.canvas.setActiveObject(i),this.canvas.renderAll()}},onFileChange(t){const e=t.target.files;if(!e||0===e.length)return;let n=this.canvas.getObjects().filter((t=>"image"===t.type&&!1!==t.selectable)).length;if(n>=3)return void alert("이미지는 최대 3개까지만 추가할 수 있습니다.");const i=e[0];if(!i)return;const s=new FileReader;s.onload=t=>{const e=new window.Image;e.src=t.target.result,e.onload=()=>{let t=e.width,n=e.height,i=1;t>400&&(i=400/t);const s=new Ca(e,{left:this.canvas.width/2,top:this.canvas.height/2,originX:"center",originY:"center",width:t,height:n,scaleX:i,scaleY:i,selectable:!0,evented:!0,hasControls:!1,hasBorders:!1});this.addCustomControls(s),this.canvas.add(s),this.canvas.setActiveObject(s),this.canvas.renderAll()}},s.readAsDataURL(i)},replaceDefaultImage(t){if(!this.defaultImageObject)return;const e=new window.Image;e.src=t,e.onload=()=>{this.defaultImageObject.setElement(e),this.defaultImageObject.set({width:200,height:200,scaleX:1,scaleY:1}),this.canvas.renderAll()}},triggerFileInput(){this.$refs.fileInput.click()},async initializeCanvas(){this.canvas=(0,T.IG)(new qr(this.$refs.canvas,{width:window.innerWidth,height:window.innerHeight,selection:!0,backgroundColor:"#ffffff"})),this.canvas.on("after:render",(()=>{const t=this.canvas.getContext(),e=this.canvas.getObjects();e.forEach(((e,n)=>{const i=e.getPointByOrigin?e.getPointByOrigin("left","top"):{x:e.left,y:e.top};t.save(),t.font="bold 18px sans-serif",t.fillStyle="red",t.strokeStyle="white",t.lineWidth=3,t.strokeText(n+"",i.x+8,i.y+24),t.fillText(n+"",i.x+8,i.y+24),t.restore()}))}));const t=new window.Image;t.src=this.predefinedImages[0],t.onload=async()=>{const e=new Ca(t,{left:this.canvas.width/2,top:this.canvas.height/2,originX:"center",originY:"center",width:200,height:200,selectable:!1,evented:!1,hasControls:!1,hasBorders:!1,lockMovementX:!0,lockMovementY:!0,lockScalingX:!0,lockScalingY:!0,lockRotation:!0});this.canvas.add(e),this.defaultImageObject=e,this.canvas.renderAll(),await this.addHumanSvg(),await this.addHumanControlLayer(),this.addSvgToCanvas()},this.canvas.on("mouse:down",(t=>{const e=this.canvas.getActiveObject(),n=this.canvas.getObjects();if(this.defaultImageObject){const t=n.indexOf(this.defaultImageObject);t>-1&&(n.splice(t,1),n.unshift(this.defaultImageObject))}if(e===this.humanSvgGroup)return[this.humanSvgGroup,this.humanControlLayer,this.clothesSvgGroup].forEach((t=>{const e=n.indexOf(t);e>-1&&n.splice(e,1)})),this.humanSvgGroup&&n.push(this.humanSvgGroup),this.humanControlLayer&&n.push(this.humanControlLayer),this.clothesSvgGroup&&n.push(this.clothesSvgGroup),this.canvas._objects=n,void this.canvas.renderAll();if(e&&"i-text"===e.type&&e._bgRect)return[e._bgRect,e].forEach((t=>{const e=n.indexOf(t);e>-1&&n.splice(e,1)})),n.push(e._bgRect),n.push(e),this.canvas._objects=n,void this.canvas.renderAll();const i=[this.humanControlLayer,this.humanSvgGroup,this.clothesSvgGroup].includes(e);if(i)[this.humanSvgGroup,this.humanControlLayer,this.clothesSvgGroup].forEach((t=>{const e=n.indexOf(t);e>-1&&n.splice(e,1)})),this.humanSvgGroup&&n.push(this.humanSvgGroup),this.humanControlLayer&&n.push(this.humanControlLayer),this.clothesSvgGroup&&n.push(this.clothesSvgGroup);else if(e&&![this.humanControlLayer,this.humanSvgGroup,this.clothesSvgGroup,this.defaultImageObject].includes(e)){const t=n.indexOf(e);t>-1&&(n.splice(t,1),n.push(e))}this.canvas._objects=n,this.canvas.renderAll()}))}},mounted:async function(){await this.initializeCanvas()}},ec=n(1241);const nc=(0,ec.A)(tc,[["render",S],["__scopeId","data-v-efe0fba4"]]);var ic=nc;function sc(t,e,n,s,r,o){return(0,i.uX)(),(0,i.CE)("div")}var rc={};const oc=(0,ec.A)(rc,[["render",sc]]);var ac=oc;function hc(t,e,n,r,o,a){return(0,i.uX)(),(0,i.CE)("div",null,[((0,i.uX)(!0),(0,i.CE)(i.FK,null,(0,i.pI)(o.dailyCounts,((t,e)=>((0,i.uX)(),(0,i.CE)("div",{key:e},(0,s.v_)(e)+": "+(0,s.v_)(t)+"명 ",1)))),128)),e[0]||(e[0]=(0,i.eW)(" 방문자 수: ")),(0,i.Lk)("b",null,(0,s.v_)(o.visitorCount),1)])}n(4979);const cc=()=>{},lc={NODE_CLIENT:!1,NODE_ADMIN:!1,SDK_VERSION:"${JSCORE_VERSION}"},uc=function(t,e){if(!t)throw dc(e)},dc=function(t){return new Error("Firebase Database ("+lc.SDK_VERSION+") INTERNAL ASSERT FAILED: "+t)},gc=function(t){const e=[];let n=0;for(let i=0;i<t.length;i++){let s=t.charCodeAt(i);s<128?e[n++]=s:s<2048?(e[n++]=s>>6|192,e[n++]=63&s|128):55296===(64512&s)&&i+1<t.length&&56320===(64512&t.charCodeAt(i+1))?(s=65536+((1023&s)<<10)+(1023&t.charCodeAt(++i)),e[n++]=s>>18|240,e[n++]=s>>12&63|128,e[n++]=s>>6&63|128,e[n++]=63&s|128):(e[n++]=s>>12|224,e[n++]=s>>6&63|128,e[n++]=63&s|128)}return e},pc=function(t){const e=[];let n=0,i=0;while(n<t.length){const s=t[n++];if(s<128)e[i++]=String.fromCharCode(s);else if(s>191&&s<224){const r=t[n++];e[i++]=String.fromCharCode((31&s)<<6|63&r)}else if(s>239&&s<365){const r=t[n++],o=t[n++],a=t[n++],h=((7&s)<<18|(63&r)<<12|(63&o)<<6|63&a)-65536;e[i++]=String.fromCharCode(55296+(h>>10)),e[i++]=String.fromCharCode(56320+(1023&h))}else{const r=t[n++],o=t[n++];e[i++]=String.fromCharCode((15&s)<<12|(63&r)<<6|63&o)}}return e.join("")},fc={byteToCharMap_:null,charToByteMap_:null,byteToCharMapWebSafe_:null,charToByteMapWebSafe_:null,ENCODED_VALS_BASE:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",get ENCODED_VALS(){return this.ENCODED_VALS_BASE+"+/="},get ENCODED_VALS_WEBSAFE(){return this.ENCODED_VALS_BASE+"-_."},HAS_NATIVE_SUPPORT:"function"===typeof atob,encodeByteArray(t,e){if(!Array.isArray(t))throw Error("encodeByteArray takes an array as a parameter");this.init_();const n=e?this.byteToCharMapWebSafe_:this.byteToCharMap_,i=[];for(let s=0;s<t.length;s+=3){const e=t[s],r=s+1<t.length,o=r?t[s+1]:0,a=s+2<t.length,h=a?t[s+2]:0,c=e>>2,l=(3&e)<<4|o>>4;let u=(15&o)<<2|h>>6,d=63&h;a||(d=64,r||(u=64)),i.push(n[c],n[l],n[u],n[d])}return i.join("")},encodeString(t,e){return this.HAS_NATIVE_SUPPORT&&!e?btoa(t):this.encodeByteArray(gc(t),e)},decodeString(t,e){return this.HAS_NATIVE_SUPPORT&&!e?atob(t):pc(this.decodeStringToByteArray(t,e))},decodeStringToByteArray(t,e){this.init_();const n=e?this.charToByteMapWebSafe_:this.charToByteMap_,i=[];for(let s=0;s<t.length;){const e=n[t.charAt(s++)],r=s<t.length,o=r?n[t.charAt(s)]:0;++s;const a=s<t.length,h=a?n[t.charAt(s)]:64;++s;const c=s<t.length,l=c?n[t.charAt(s)]:64;if(++s,null==e||null==o||null==h||null==l)throw new mc;const u=e<<2|o>>4;if(i.push(u),64!==h){const t=o<<4&240|h>>2;if(i.push(t),64!==l){const t=h<<6&192|l;i.push(t)}}}return i},init_(){if(!this.byteToCharMap_){this.byteToCharMap_={},this.charToByteMap_={},this.byteToCharMapWebSafe_={},this.charToByteMapWebSafe_={};for(let t=0;t<this.ENCODED_VALS.length;t++)this.byteToCharMap_[t]=this.ENCODED_VALS.charAt(t),this.charToByteMap_[this.byteToCharMap_[t]]=t,this.byteToCharMapWebSafe_[t]=this.ENCODED_VALS_WEBSAFE.charAt(t),this.charToByteMapWebSafe_[this.byteToCharMapWebSafe_[t]]=t,t>=this.ENCODED_VALS_BASE.length&&(this.charToByteMap_[this.ENCODED_VALS_WEBSAFE.charAt(t)]=t,this.charToByteMapWebSafe_[this.ENCODED_VALS.charAt(t)]=t)}}};class mc extends Error{constructor(){super(...arguments),this.name="DecodeBase64StringError"}}const _c=function(t){const e=gc(t);return fc.encodeByteArray(e,!0)},vc=function(t){return _c(t).replace(/\./g,"")},yc=function(t){try{return fc.decodeString(t,!0)}catch(k){console.error("base64Decode failed: ",k)}return null};
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
function Cc(t){return bc(void 0,t)}function bc(t,e){if(!(e instanceof Object))return e;switch(e.constructor){case Date:const n=e;return new Date(n.getTime());case Object:void 0===t&&(t={});break;case Array:t=[];break;default:return e}for(const n in e)e.hasOwnProperty(n)&&wc(n)&&(t[n]=bc(t[n],e[n]));return t}function wc(t){return"__proto__"!==t}
/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function xc(){if("undefined"!==typeof self)return self;if("undefined"!==typeof window)return window;if("undefined"!==typeof n.g)return n.g;throw new Error("Unable to locate global object.")}
/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Sc=()=>xc().__FIREBASE_DEFAULTS__,Tc=()=>{if("undefined"===typeof process)return;const t={NODE_ENV:"production",BASE_URL:"/alien_mood/"}.__FIREBASE_DEFAULTS__;return t?JSON.parse(t):void 0},Ec=()=>{if("undefined"===typeof document)return;let t;try{t=document.cookie.match(/__FIREBASE_DEFAULTS__=([^;]+)/)}catch(k){return}const e=t&&yc(t[1]);return e&&JSON.parse(e)},kc=()=>{try{return cc()||Sc()||Tc()||Ec()}catch(k){return void console.info(`Unable to get __FIREBASE_DEFAULTS__ due to: ${k}`)}},Ac=t=>{var e,n;return null===(n=null===(e=kc())||void 0===e?void 0:e.emulatorHosts)||void 0===n?void 0:n[t]},Oc=t=>{const e=Ac(t);if(!e)return;const n=e.lastIndexOf(":");if(n<=0||n+1===e.length)throw new Error(`Invalid host ${e} with no separate hostname and port!`);const i=parseInt(e.substring(n+1),10);return"["===e[0]?[e.substring(1,n-1),i]:[e.substring(0,n),i]},Dc=()=>{var t;return null===(t=kc())||void 0===t?void 0:t.config};
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
class Ic{constructor(){this.reject=()=>{},this.resolve=()=>{},this.promise=new Promise(((t,e)=>{this.resolve=t,this.reject=e}))}wrapCallback(t){return(e,n)=>{e?this.reject(e):this.resolve(n),"function"===typeof t&&(this.promise.catch((()=>{})),1===t.length?t(e):t(e,n))}}}
/**
 * @license
 * Copyright 2025 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Pc(t){return t.endsWith(".cloudworkstations.dev")}async function Mc(t){const e=await fetch(t,{credentials:"include"});return e.ok}
/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Rc(t,e){if(t.uid)throw new Error('The "uid" field is no longer supported by mockUserToken. Please use "sub" instead for Firebase Auth User ID.');const n={alg:"none",type:"JWT"},i=e||"demo-project",s=t.iat||0,r=t.sub||t.user_id;if(!r)throw new Error("mockUserToken must contain 'sub' or 'user_id' field!");const o=Object.assign({iss:`https://securetoken.google.com/${i}`,aud:i,iat:s,exp:s+3600,auth_time:s,sub:r,user_id:r,firebase:{sign_in_provider:"custom",identities:{}}},t),a="";return[vc(JSON.stringify(n)),vc(JSON.stringify(o)),a].join(".")}const Fc={};function Lc(){const t={prod:[],emulator:[]};for(const e of Object.keys(Fc))Fc[e]?t.emulator.push(e):t.prod.push(e);return t}function jc(t){let e=document.getElementById(t),n=!1;return e||(e=document.createElement("div"),e.setAttribute("id",t),n=!0),{created:n,element:e}}let Nc=!1;function Bc(t,e){if("undefined"===typeof window||"undefined"===typeof document||!Pc(window.location.host)||Fc[t]===e||Fc[t]||Nc)return;function n(t){return`__firebase__banner__${t}`}Fc[t]=e;const i="__firebase__banner",s=Lc(),r=s.prod.length>0;function o(){const t=document.getElementById(i);t&&t.remove()}function a(t){t.style.display="flex",t.style.background="#7faaf0",t.style.position="fixed",t.style.bottom="5px",t.style.left="5px",t.style.padding=".5em",t.style.borderRadius="5px",t.style.alignItems="center"}function h(t,e){t.setAttribute("width","24"),t.setAttribute("id",e),t.setAttribute("height","24"),t.setAttribute("viewBox","0 0 24 24"),t.setAttribute("fill","none"),t.style.marginLeft="-6px"}function c(){const t=document.createElement("span");return t.style.cursor="pointer",t.style.marginLeft="16px",t.style.fontSize="24px",t.innerHTML=" &times;",t.onclick=()=>{Nc=!0,o()},t}function l(t,e){t.setAttribute("id",e),t.innerText="Learn more",t.href="https://firebase.google.com/docs/studio/preview-apps#preview-backend",t.setAttribute("target","__blank"),t.style.paddingLeft="5px",t.style.textDecoration="underline"}function u(){const t=jc(i),e=n("text"),s=document.getElementById(e)||document.createElement("span"),o=n("learnmore"),u=document.getElementById(o)||document.createElement("a"),d=n("preprendIcon"),g=document.getElementById(d)||document.createElementNS("http://www.w3.org/2000/svg","svg");if(t.created){const e=t.element;a(e),l(u,o);const n=c();h(g,d),e.append(g,s,u,n),document.body.appendChild(e)}r?(s.innerText="Preview backend disconnected.",g.innerHTML='<g clip-path="url(#clip0_6013_33858)">\n<path d="M4.8 17.6L12 5.6L19.2 17.6H4.8ZM6.91667 16.4H17.0833L12 7.93333L6.91667 16.4ZM12 15.6C12.1667 15.6 12.3056 15.5444 12.4167 15.4333C12.5389 15.3111 12.6 15.1667 12.6 15C12.6 14.8333 12.5389 14.6944 12.4167 14.5833C12.3056 14.4611 12.1667 14.4 12 14.4C11.8333 14.4 11.6889 14.4611 11.5667 14.5833C11.4556 14.6944 11.4 14.8333 11.4 15C11.4 15.1667 11.4556 15.3111 11.5667 15.4333C11.6889 15.5444 11.8333 15.6 12 15.6ZM11.4 13.6H12.6V10.4H11.4V13.6Z" fill="#212121"/>\n</g>\n<defs>\n<clipPath id="clip0_6013_33858">\n<rect width="24" height="24" fill="white"/>\n</clipPath>\n</defs>'):(g.innerHTML='<g clip-path="url(#clip0_6083_34804)">\n<path d="M11.4 15.2H12.6V11.2H11.4V15.2ZM12 10C12.1667 10 12.3056 9.94444 12.4167 9.83333C12.5389 9.71111 12.6 9.56667 12.6 9.4C12.6 9.23333 12.5389 9.09444 12.4167 8.98333C12.3056 8.86111 12.1667 8.8 12 8.8C11.8333 8.8 11.6889 8.86111 11.5667 8.98333C11.4556 9.09444 11.4 9.23333 11.4 9.4C11.4 9.56667 11.4556 9.71111 11.5667 9.83333C11.6889 9.94444 11.8333 10 12 10ZM12 18.4C11.1222 18.4 10.2944 18.2333 9.51667 17.9C8.73889 17.5667 8.05556 17.1111 7.46667 16.5333C6.88889 15.9444 6.43333 15.2611 6.1 14.4833C5.76667 13.7056 5.6 12.8778 5.6 12C5.6 11.1111 5.76667 10.2833 6.1 9.51667C6.43333 8.73889 6.88889 8.06111 7.46667 7.48333C8.05556 6.89444 8.73889 6.43333 9.51667 6.1C10.2944 5.76667 11.1222 5.6 12 5.6C12.8889 5.6 13.7167 5.76667 14.4833 6.1C15.2611 6.43333 15.9389 6.89444 16.5167 7.48333C17.1056 8.06111 17.5667 8.73889 17.9 9.51667C18.2333 10.2833 18.4 11.1111 18.4 12C18.4 12.8778 18.2333 13.7056 17.9 14.4833C17.5667 15.2611 17.1056 15.9444 16.5167 16.5333C15.9389 17.1111 15.2611 17.5667 14.4833 17.9C13.7167 18.2333 12.8889 18.4 12 18.4ZM12 17.2C13.4444 17.2 14.6722 16.6944 15.6833 15.6833C16.6944 14.6722 17.2 13.4444 17.2 12C17.2 10.5556 16.6944 9.32778 15.6833 8.31667C14.6722 7.30555 13.4444 6.8 12 6.8C10.5556 6.8 9.32778 7.30555 8.31667 8.31667C7.30556 9.32778 6.8 10.5556 6.8 12C6.8 13.4444 7.30556 14.6722 8.31667 15.6833C9.32778 16.6944 10.5556 17.2 12 17.2Z" fill="#212121"/>\n</g>\n<defs>\n<clipPath id="clip0_6083_34804">\n<rect width="24" height="24" fill="white"/>\n</clipPath>\n</defs>',s.innerText="Preview backend running in this workspace."),s.setAttribute("id",e)}"loading"===document.readyState?window.addEventListener("DOMContentLoaded",u):u()}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Wc(){return"undefined"!==typeof navigator&&"string"===typeof navigator["userAgent"]?navigator["userAgent"]:""}function Yc(){return"undefined"!==typeof window&&!!(window["cordova"]||window["phonegap"]||window["PhoneGap"])&&/ios|iphone|ipod|ipad|android|blackberry|iemobile/i.test(Wc())}function Uc(){return"object"===typeof navigator&&"ReactNative"===navigator["product"]}function Xc(){return!0===lc.NODE_CLIENT||!0===lc.NODE_ADMIN}function Gc(){try{return"object"===typeof indexedDB}catch(k){return!1}}function Vc(){return new Promise(((t,e)=>{try{let n=!0;const i="validate-browser-context-for-indexeddb-analytics-module",s=self.indexedDB.open(i);s.onsuccess=()=>{s.result.close(),n||self.indexedDB.deleteDatabase(i),t(!0)},s.onupgradeneeded=()=>{n=!1},s.onerror=()=>{var t;e((null===(t=s.error)||void 0===t?void 0:t.message)||"")}}catch(kd){e(kd)}}))}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
const Hc="FirebaseError";class zc extends Error{constructor(t,e,n){super(e),this.code=t,this.customData=n,this.name=Hc,Object.setPrototypeOf(this,zc.prototype),Error.captureStackTrace&&Error.captureStackTrace(this,qc.prototype.create)}}class qc{constructor(t,e,n){this.service=t,this.serviceName=e,this.errors=n}create(t,...e){const n=e[0]||{},i=`${this.service}/${t}`,s=this.errors[t],r=s?Kc(s,n):"Error",o=`${this.serviceName}: ${r} (${i}).`,a=new zc(i,o,n);return a}}function Kc(t,e){return t.replace(Qc,((t,n)=>{const i=e[n];return null!=i?String(i):`<${n}?>`}))}const Qc=/\{\$([^}]+)}/g;
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Jc(t){return JSON.parse(t)}function Zc(t){return JSON.stringify(t)}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const $c=function(t){let e={},n={},i={},s="";try{const r=t.split(".");e=Jc(yc(r[0])||""),n=Jc(yc(r[1])||""),s=r[2],i=n["d"]||{},delete n["d"]}catch(k){}return{header:e,claims:n,data:i,signature:s}},tl=function(t){const e=$c(t),n=e.claims;return!!n&&"object"===typeof n&&n.hasOwnProperty("iat")},el=function(t){const e=$c(t).claims;return"object"===typeof e&&!0===e["admin"]};
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
function nl(t,e){return Object.prototype.hasOwnProperty.call(t,e)}function il(t,e){return Object.prototype.hasOwnProperty.call(t,e)?t[e]:void 0}function sl(t){for(const e in t)if(Object.prototype.hasOwnProperty.call(t,e))return!1;return!0}function rl(t,e,n){const i={};for(const s in t)Object.prototype.hasOwnProperty.call(t,s)&&(i[s]=e.call(n,t[s],s,t));return i}function ol(t,e){if(t===e)return!0;const n=Object.keys(t),i=Object.keys(e);for(const s of n){if(!i.includes(s))return!1;const n=t[s],r=e[s];if(al(n)&&al(r)){if(!ol(n,r))return!1}else if(n!==r)return!1}for(const s of i)if(!n.includes(s))return!1;return!0}function al(t){return null!==t&&"object"===typeof t}
/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
function hl(t){const e=[];for(const[n,i]of Object.entries(t))Array.isArray(i)?i.forEach((t=>{e.push(encodeURIComponent(n)+"="+encodeURIComponent(t))})):e.push(encodeURIComponent(n)+"="+encodeURIComponent(i));return e.length?"&"+e.join("&"):""}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
class cl{constructor(){this.chain_=[],this.buf_=[],this.W_=[],this.pad_=[],this.inbuf_=0,this.total_=0,this.blockSize=64,this.pad_[0]=128;for(let t=1;t<this.blockSize;++t)this.pad_[t]=0;this.reset()}reset(){this.chain_[0]=1732584193,this.chain_[1]=4023233417,this.chain_[2]=2562383102,this.chain_[3]=271733878,this.chain_[4]=3285377520,this.inbuf_=0,this.total_=0}compress_(t,e){e||(e=0);const n=this.W_;if("string"===typeof t)for(let l=0;l<16;l++)n[l]=t.charCodeAt(e)<<24|t.charCodeAt(e+1)<<16|t.charCodeAt(e+2)<<8|t.charCodeAt(e+3),e+=4;else for(let l=0;l<16;l++)n[l]=t[e]<<24|t[e+1]<<16|t[e+2]<<8|t[e+3],e+=4;for(let l=16;l<80;l++){const t=n[l-3]^n[l-8]^n[l-14]^n[l-16];n[l]=4294967295&(t<<1|t>>>31)}let i,s,r=this.chain_[0],o=this.chain_[1],a=this.chain_[2],h=this.chain_[3],c=this.chain_[4];for(let l=0;l<80;l++){l<40?l<20?(i=h^o&(a^h),s=1518500249):(i=o^a^h,s=1859775393):l<60?(i=o&a|h&(o|a),s=2400959708):(i=o^a^h,s=3395469782);const t=(r<<5|r>>>27)+i+c+s+n[l]&4294967295;c=h,h=a,a=4294967295&(o<<30|o>>>2),o=r,r=t}this.chain_[0]=this.chain_[0]+r&4294967295,this.chain_[1]=this.chain_[1]+o&4294967295,this.chain_[2]=this.chain_[2]+a&4294967295,this.chain_[3]=this.chain_[3]+h&4294967295,this.chain_[4]=this.chain_[4]+c&4294967295}update(t,e){if(null==t)return;void 0===e&&(e=t.length);const n=e-this.blockSize;let i=0;const s=this.buf_;let r=this.inbuf_;while(i<e){if(0===r)while(i<=n)this.compress_(t,i),i+=this.blockSize;if("string"===typeof t){while(i<e)if(s[r]=t.charCodeAt(i),++r,++i,r===this.blockSize){this.compress_(s),r=0;break}}else while(i<e)if(s[r]=t[i],++r,++i,r===this.blockSize){this.compress_(s),r=0;break}}this.inbuf_=r,this.total_+=e}digest(){const t=[];let e=8*this.total_;this.inbuf_<56?this.update(this.pad_,56-this.inbuf_):this.update(this.pad_,this.blockSize-(this.inbuf_-56));for(let i=this.blockSize-1;i>=56;i--)this.buf_[i]=255&e,e/=256;this.compress_(this.buf_);let n=0;for(let i=0;i<5;i++)for(let e=24;e>=0;e-=8)t[n]=this.chain_[i]>>e&255,++n;return t}}function ll(t,e){return`${t} failed: ${e} argument `}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
const ul=function(t){const e=[];let n=0;for(let i=0;i<t.length;i++){let s=t.charCodeAt(i);if(s>=55296&&s<=56319){const e=s-55296;i++,uc(i<t.length,"Surrogate pair missing trail surrogate.");const n=t.charCodeAt(i)-56320;s=65536+(e<<10)+n}s<128?e[n++]=s:s<2048?(e[n++]=s>>6|192,e[n++]=63&s|128):s<65536?(e[n++]=s>>12|224,e[n++]=s>>6&63|128,e[n++]=63&s|128):(e[n++]=s>>18|240,e[n++]=s>>12&63|128,e[n++]=s>>6&63|128,e[n++]=63&s|128)}return e},dl=function(t){let e=0;for(let n=0;n<t.length;n++){const i=t.charCodeAt(n);i<128?e++:i<2048?e+=2:i>=55296&&i<=56319?(e+=4,n++):e+=3}return e};
/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
function gl(t){return t&&t._delegate?t._delegate:t}class pl{constructor(t,e,n){this.name=t,this.instanceFactory=e,this.type=n,this.multipleInstances=!1,this.serviceProps={},this.instantiationMode="LAZY",this.onInstanceCreated=null}setInstantiationMode(t){return this.instantiationMode=t,this}setMultipleInstances(t){return this.multipleInstances=t,this}setServiceProps(t){return this.serviceProps=t,this}setInstanceCreatedCallback(t){return this.onInstanceCreated=t,this}}
/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const fl="[DEFAULT]";
/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ml{constructor(t,e){this.name=t,this.container=e,this.component=null,this.instances=new Map,this.instancesDeferred=new Map,this.instancesOptions=new Map,this.onInitCallbacks=new Map}get(t){const e=this.normalizeInstanceIdentifier(t);if(!this.instancesDeferred.has(e)){const t=new Ic;if(this.instancesDeferred.set(e,t),this.isInitialized(e)||this.shouldAutoInitialize())try{const n=this.getOrInitializeService({instanceIdentifier:e});n&&t.resolve(n)}catch(k){}}return this.instancesDeferred.get(e).promise}getImmediate(t){var e;const n=this.normalizeInstanceIdentifier(null===t||void 0===t?void 0:t.identifier),i=null!==(e=null===t||void 0===t?void 0:t.optional)&&void 0!==e&&e;if(!this.isInitialized(n)&&!this.shouldAutoInitialize()){if(i)return null;throw Error(`Service ${this.name} is not available`)}try{return this.getOrInitializeService({instanceIdentifier:n})}catch(k){if(i)return null;throw k}}getComponent(){return this.component}setComponent(t){if(t.name!==this.name)throw Error(`Mismatching Component ${t.name} for Provider ${this.name}.`);if(this.component)throw Error(`Component for ${this.name} has already been provided`);if(this.component=t,this.shouldAutoInitialize()){if(vl(t))try{this.getOrInitializeService({instanceIdentifier:fl})}catch(k){}for(const[t,e]of this.instancesDeferred.entries()){const n=this.normalizeInstanceIdentifier(t);try{const t=this.getOrInitializeService({instanceIdentifier:n});e.resolve(t)}catch(k){}}}}clearInstance(t=fl){this.instancesDeferred.delete(t),this.instancesOptions.delete(t),this.instances.delete(t)}async delete(){const t=Array.from(this.instances.values());await Promise.all([...t.filter((t=>"INTERNAL"in t)).map((t=>t.INTERNAL.delete())),...t.filter((t=>"_delete"in t)).map((t=>t._delete()))])}isComponentSet(){return null!=this.component}isInitialized(t=fl){return this.instances.has(t)}getOptions(t=fl){return this.instancesOptions.get(t)||{}}initialize(t={}){const{options:e={}}=t,n=this.normalizeInstanceIdentifier(t.instanceIdentifier);if(this.isInitialized(n))throw Error(`${this.name}(${n}) has already been initialized`);if(!this.isComponentSet())throw Error(`Component ${this.name} has not been registered yet`);const i=this.getOrInitializeService({instanceIdentifier:n,options:e});for(const[s,r]of this.instancesDeferred.entries()){const t=this.normalizeInstanceIdentifier(s);n===t&&r.resolve(i)}return i}onInit(t,e){var n;const i=this.normalizeInstanceIdentifier(e),s=null!==(n=this.onInitCallbacks.get(i))&&void 0!==n?n:new Set;s.add(t),this.onInitCallbacks.set(i,s);const r=this.instances.get(i);return r&&t(r,i),()=>{s.delete(t)}}invokeOnInitCallbacks(t,e){const n=this.onInitCallbacks.get(e);if(n)for(const i of n)try{i(t,e)}catch(ja){}}getOrInitializeService({instanceIdentifier:t,options:e={}}){let n=this.instances.get(t);if(!n&&this.component&&(n=this.component.instanceFactory(this.container,{instanceIdentifier:_l(t),options:e}),this.instances.set(t,n),this.instancesOptions.set(t,e),this.invokeOnInitCallbacks(n,t),this.component.onInstanceCreated))try{this.component.onInstanceCreated(this.container,t,n)}catch(ja){}return n||null}normalizeInstanceIdentifier(t=fl){return this.component?this.component.multipleInstances?t:fl:t}shouldAutoInitialize(){return!!this.component&&"EXPLICIT"!==this.component.instantiationMode}}function _l(t){return t===fl?void 0:t}function vl(t){return"EAGER"===t.instantiationMode}
/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class yl{constructor(t){this.name=t,this.providers=new Map}addComponent(t){const e=this.getProvider(t.name);if(e.isComponentSet())throw new Error(`Component ${t.name} has already been registered with ${this.name}`);e.setComponent(t)}addOrOverwriteComponent(t){const e=this.getProvider(t.name);e.isComponentSet()&&this.providers.delete(t.name),this.addComponent(t)}getProvider(t){if(this.providers.has(t))return this.providers.get(t);const e=new ml(t,this);return this.providers.set(t,e),e}getProviders(){return Array.from(this.providers.values())}}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
const Cl=[];var bl;(function(t){t[t["DEBUG"]=0]="DEBUG",t[t["VERBOSE"]=1]="VERBOSE",t[t["INFO"]=2]="INFO",t[t["WARN"]=3]="WARN",t[t["ERROR"]=4]="ERROR",t[t["SILENT"]=5]="SILENT"})(bl||(bl={}));const wl={debug:bl.DEBUG,verbose:bl.VERBOSE,info:bl.INFO,warn:bl.WARN,error:bl.ERROR,silent:bl.SILENT},xl=bl.INFO,Sl={[bl.DEBUG]:"log",[bl.VERBOSE]:"log",[bl.INFO]:"info",[bl.WARN]:"warn",[bl.ERROR]:"error"},Tl=(t,e,...n)=>{if(e<t.logLevel)return;const i=(new Date).toISOString(),s=Sl[e];if(!s)throw new Error(`Attempted to log a message with an invalid logType (value: ${e})`);console[s](`[${i}]  ${t.name}:`,...n)};class El{constructor(t){this.name=t,this._logLevel=xl,this._logHandler=Tl,this._userLogHandler=null,Cl.push(this)}get logLevel(){return this._logLevel}set logLevel(t){if(!(t in bl))throw new TypeError(`Invalid value "${t}" assigned to \`logLevel\``);this._logLevel=t}setLogLevel(t){this._logLevel="string"===typeof t?wl[t]:t}get logHandler(){return this._logHandler}set logHandler(t){if("function"!==typeof t)throw new TypeError("Value assigned to `logHandler` must be a function");this._logHandler=t}get userLogHandler(){return this._userLogHandler}set userLogHandler(t){this._userLogHandler=t}debug(...t){this._userLogHandler&&this._userLogHandler(this,bl.DEBUG,...t),this._logHandler(this,bl.DEBUG,...t)}log(...t){this._userLogHandler&&this._userLogHandler(this,bl.VERBOSE,...t),this._logHandler(this,bl.VERBOSE,...t)}info(...t){this._userLogHandler&&this._userLogHandler(this,bl.INFO,...t),this._logHandler(this,bl.INFO,...t)}warn(...t){this._userLogHandler&&this._userLogHandler(this,bl.WARN,...t),this._logHandler(this,bl.WARN,...t)}error(...t){this._userLogHandler&&this._userLogHandler(this,bl.ERROR,...t),this._logHandler(this,bl.ERROR,...t)}}const kl=(t,e)=>e.some((e=>t instanceof e));let Al,Ol;function Dl(){return Al||(Al=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction])}function Il(){return Ol||(Ol=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])}const Pl=new WeakMap,Ml=new WeakMap,Rl=new WeakMap,Fl=new WeakMap,Ll=new WeakMap;function jl(t){const e=new Promise(((e,n)=>{const i=()=>{t.removeEventListener("success",s),t.removeEventListener("error",r)},s=()=>{e(Xl(t.result)),i()},r=()=>{n(t.error),i()};t.addEventListener("success",s),t.addEventListener("error",r)}));return e.then((e=>{e instanceof IDBCursor&&Pl.set(e,t)})).catch((()=>{})),Ll.set(e,t),e}function Nl(t){if(Ml.has(t))return;const e=new Promise(((e,n)=>{const i=()=>{t.removeEventListener("complete",s),t.removeEventListener("error",r),t.removeEventListener("abort",r)},s=()=>{e(),i()},r=()=>{n(t.error||new DOMException("AbortError","AbortError")),i()};t.addEventListener("complete",s),t.addEventListener("error",r),t.addEventListener("abort",r)}));Ml.set(t,e)}let Bl={get(t,e,n){if(t instanceof IDBTransaction){if("done"===e)return Ml.get(t);if("objectStoreNames"===e)return t.objectStoreNames||Rl.get(t);if("store"===e)return n.objectStoreNames[1]?void 0:n.objectStore(n.objectStoreNames[0])}return Xl(t[e])},set(t,e,n){return t[e]=n,!0},has(t,e){return t instanceof IDBTransaction&&("done"===e||"store"===e)||e in t}};function Wl(t){Bl=t(Bl)}function Yl(t){return t!==IDBDatabase.prototype.transaction||"objectStoreNames"in IDBTransaction.prototype?Il().includes(t)?function(...e){return t.apply(Gl(this),e),Xl(Pl.get(this))}:function(...e){return Xl(t.apply(Gl(this),e))}:function(e,...n){const i=t.call(Gl(this),e,...n);return Rl.set(i,e.sort?e.sort():[e]),Xl(i)}}function Ul(t){return"function"===typeof t?Yl(t):(t instanceof IDBTransaction&&Nl(t),kl(t,Dl())?new Proxy(t,Bl):t)}function Xl(t){if(t instanceof IDBRequest)return jl(t);if(Fl.has(t))return Fl.get(t);const e=Ul(t);return e!==t&&(Fl.set(t,e),Ll.set(e,t)),e}const Gl=t=>Ll.get(t);function Vl(t,e,{blocked:n,upgrade:i,blocking:s,terminated:r}={}){const o=indexedDB.open(t,e),a=Xl(o);return i&&o.addEventListener("upgradeneeded",(t=>{i(Xl(o.result),t.oldVersion,t.newVersion,Xl(o.transaction),t)})),n&&o.addEventListener("blocked",(t=>n(t.oldVersion,t.newVersion,t))),a.then((t=>{r&&t.addEventListener("close",(()=>r())),s&&t.addEventListener("versionchange",(t=>s(t.oldVersion,t.newVersion,t)))})).catch((()=>{})),a}const Hl=["get","getKey","getAll","getAllKeys","count"],zl=["put","add","delete","clear"],ql=new Map;function Kl(t,e){if(!(t instanceof IDBDatabase)||e in t||"string"!==typeof e)return;if(ql.get(e))return ql.get(e);const n=e.replace(/FromIndex$/,""),i=e!==n,s=zl.includes(n);if(!(n in(i?IDBIndex:IDBObjectStore).prototype)||!s&&!Hl.includes(n))return;const r=async function(t,...e){const r=this.transaction(t,s?"readwrite":"readonly");let o=r.store;return i&&(o=o.index(e.shift())),(await Promise.all([o[n](...e),s&&r.done]))[0]};return ql.set(e,r),r}Wl((t=>({...t,get:(e,n,i)=>Kl(e,n)||t.get(e,n,i),has:(e,n)=>!!Kl(e,n)||t.has(e,n)})));
/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
class Ql{constructor(t){this.container=t}getPlatformInfoString(){const t=this.container.getProviders();return t.map((t=>{if(Jl(t)){const e=t.getImmediate();return`${e.library}/${e.version}`}return null})).filter((t=>t)).join(" ")}}function Jl(t){const e=t.getComponent();return"VERSION"===(null===e||void 0===e?void 0:e.type)}const Zl="@firebase/app",$l="0.13.0",tu=new El("@firebase/app"),eu="@firebase/app-compat",nu="@firebase/analytics-compat",iu="@firebase/analytics",su="@firebase/app-check-compat",ru="@firebase/app-check",ou="@firebase/auth",au="@firebase/auth-compat",hu="@firebase/database",cu="@firebase/data-connect",lu="@firebase/database-compat",uu="@firebase/functions",du="@firebase/functions-compat",gu="@firebase/installations",pu="@firebase/installations-compat",fu="@firebase/messaging",mu="@firebase/messaging-compat",_u="@firebase/performance",vu="@firebase/performance-compat",yu="@firebase/remote-config",Cu="@firebase/remote-config-compat",bu="@firebase/storage",wu="@firebase/storage-compat",xu="@firebase/firestore",Su="@firebase/ai",Tu="@firebase/firestore-compat",Eu="firebase",ku="11.8.0",Au="[DEFAULT]",Ou={[Zl]:"fire-core",[eu]:"fire-core-compat",[iu]:"fire-analytics",[nu]:"fire-analytics-compat",[ru]:"fire-app-check",[su]:"fire-app-check-compat",[ou]:"fire-auth",[au]:"fire-auth-compat",[hu]:"fire-rtdb",[cu]:"fire-data-connect",[lu]:"fire-rtdb-compat",[uu]:"fire-fn",[du]:"fire-fn-compat",[gu]:"fire-iid",[pu]:"fire-iid-compat",[fu]:"fire-fcm",[mu]:"fire-fcm-compat",[_u]:"fire-perf",[vu]:"fire-perf-compat",[yu]:"fire-rc",[Cu]:"fire-rc-compat",[bu]:"fire-gcs",[wu]:"fire-gcs-compat",[xu]:"fire-fst",[Tu]:"fire-fst-compat",[Su]:"fire-vertex","fire-js":"fire-js",[Eu]:"fire-js-all"},Du=new Map,Iu=new Map,Pu=new Map;function Mu(t,e){try{t.container.addComponent(e)}catch(k){tu.debug(`Component ${e.name} failed to register with FirebaseApp ${t.name}`,k)}}function Ru(t){const e=t.name;if(Pu.has(e))return tu.debug(`There were multiple attempts to register component ${e}.`),!1;Pu.set(e,t);for(const n of Du.values())Mu(n,t);for(const n of Iu.values())Mu(n,t);return!0}function Fu(t,e){const n=t.container.getProvider("heartbeat").getImmediate({optional:!0});return n&&n.triggerHeartbeat(),t.container.getProvider(e)}function Lu(t){return null!==t&&void 0!==t&&void 0!==t.settings}
/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
const ju={["no-app"]:"No Firebase App '{$appName}' has been created - call initializeApp() first",["bad-app-name"]:"Illegal App name: '{$appName}'",["duplicate-app"]:"Firebase App named '{$appName}' already exists with different options or config",["app-deleted"]:"Firebase App named '{$appName}' already deleted",["server-app-deleted"]:"Firebase Server App has been deleted",["no-options"]:"Need to provide options, when not being deployed to hosting via source.",["invalid-app-argument"]:"firebase.{$appName}() takes either no argument or a Firebase App instance.",["invalid-log-argument"]:"First argument to `onLog` must be null or a function.",["idb-open"]:"Error thrown when opening IndexedDB. Original error: {$originalErrorMessage}.",["idb-get"]:"Error thrown when reading from IndexedDB. Original error: {$originalErrorMessage}.",["idb-set"]:"Error thrown when writing to IndexedDB. Original error: {$originalErrorMessage}.",["idb-delete"]:"Error thrown when deleting from IndexedDB. Original error: {$originalErrorMessage}.",["finalization-registry-not-supported"]:"FirebaseServerApp deleteOnDeref field defined but the JS runtime does not support FinalizationRegistry.",["invalid-server-app-environment"]:"FirebaseServerApp is not for use in browser environments."},Nu=new qc("app","Firebase",ju);
/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
class Bu{constructor(t,e,n){this._isDeleted=!1,this._options=Object.assign({},t),this._config=Object.assign({},e),this._name=e.name,this._automaticDataCollectionEnabled=e.automaticDataCollectionEnabled,this._container=n,this.container.addComponent(new pl("app",(()=>this),"PUBLIC"))}get automaticDataCollectionEnabled(){return this.checkDestroyed(),this._automaticDataCollectionEnabled}set automaticDataCollectionEnabled(t){this.checkDestroyed(),this._automaticDataCollectionEnabled=t}get name(){return this.checkDestroyed(),this._name}get options(){return this.checkDestroyed(),this._options}get config(){return this.checkDestroyed(),this._config}get container(){return this._container}get isDeleted(){return this._isDeleted}set isDeleted(t){this._isDeleted=t}checkDestroyed(){if(this.isDeleted)throw Nu.create("app-deleted",{appName:this._name})}}
/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
const Wu=ku;function Yu(t,e={}){let n=t;if("object"!==typeof e){const t=e;e={name:t}}const i=Object.assign({name:Au,automaticDataCollectionEnabled:!0},e),s=i.name;if("string"!==typeof s||!s)throw Nu.create("bad-app-name",{appName:String(s)});if(n||(n=Dc()),!n)throw Nu.create("no-options");const r=Du.get(s);if(r){if(ol(n,r.options)&&ol(i,r.config))return r;throw Nu.create("duplicate-app",{appName:s})}const o=new yl(s);for(const h of Pu.values())o.addComponent(h);const a=new Bu(n,i,o);return Du.set(s,a),a}function Uu(t=Au){const e=Du.get(t);if(!e&&t===Au&&Dc())return Yu();if(!e)throw Nu.create("no-app",{appName:t});return e}function Xu(t,e,n){var i;let s=null!==(i=Ou[t])&&void 0!==i?i:t;n&&(s+=`-${n}`);const r=s.match(/\s|\//),o=e.match(/\s|\//);if(r||o){const t=[`Unable to register library "${s}" with version "${e}":`];return r&&t.push(`library name "${s}" contains illegal characters (whitespace or "/")`),r&&o&&t.push("and"),o&&t.push(`version name "${e}" contains illegal characters (whitespace or "/")`),void tu.warn(t.join(" "))}Ru(new pl(`${s}-version`,(()=>({library:s,version:e})),"VERSION"))}
/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
const Gu="firebase-heartbeat-database",Vu=1,Hu="firebase-heartbeat-store";let zu=null;function qu(){return zu||(zu=Vl(Gu,Vu,{upgrade:(t,e)=>{switch(e){case 0:try{t.createObjectStore(Hu)}catch(k){console.warn(k)}}}}).catch((t=>{throw Nu.create("idb-open",{originalErrorMessage:t.message})}))),zu}async function Ku(t){try{const e=await qu(),n=e.transaction(Hu),i=await n.objectStore(Hu).get(Ju(t));return await n.done,i}catch(k){if(k instanceof zc)tu.warn(k.message);else{const e=Nu.create("idb-get",{originalErrorMessage:null===k||void 0===k?void 0:k.message});tu.warn(e.message)}}}async function Qu(t,e){try{const n=await qu(),i=n.transaction(Hu,"readwrite"),s=i.objectStore(Hu);await s.put(e,Ju(t)),await i.done}catch(k){if(k instanceof zc)tu.warn(k.message);else{const e=Nu.create("idb-set",{originalErrorMessage:null===k||void 0===k?void 0:k.message});tu.warn(e.message)}}}function Ju(t){return`${t.name}!${t.options.appId}`}
/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Zu=1024,$u=30;class td{constructor(t){this.container=t,this._heartbeatsCache=null;const e=this.container.getProvider("app").getImmediate();this._storage=new id(e),this._heartbeatsCachePromise=this._storage.read().then((t=>(this._heartbeatsCache=t,t)))}async triggerHeartbeat(){var t,e;try{const n=this.container.getProvider("platform-logger").getImmediate(),i=n.getPlatformInfoString(),s=ed();if(null==(null===(t=this._heartbeatsCache)||void 0===t?void 0:t.heartbeats)&&(this._heartbeatsCache=await this._heartbeatsCachePromise,null==(null===(e=this._heartbeatsCache)||void 0===e?void 0:e.heartbeats)))return;if(this._heartbeatsCache.lastSentHeartbeatDate===s||this._heartbeatsCache.heartbeats.some((t=>t.date===s)))return;if(this._heartbeatsCache.heartbeats.push({date:s,agent:i}),this._heartbeatsCache.heartbeats.length>$u){const t=rd(this._heartbeatsCache.heartbeats);this._heartbeatsCache.heartbeats.splice(t,1)}return this._storage.overwrite(this._heartbeatsCache)}catch(k){tu.warn(k)}}async getHeartbeatsHeader(){var t;try{if(null===this._heartbeatsCache&&await this._heartbeatsCachePromise,null==(null===(t=this._heartbeatsCache)||void 0===t?void 0:t.heartbeats)||0===this._heartbeatsCache.heartbeats.length)return"";const e=ed(),{heartbeatsToSend:n,unsentEntries:i}=nd(this._heartbeatsCache.heartbeats),s=vc(JSON.stringify({version:2,heartbeats:n}));return this._heartbeatsCache.lastSentHeartbeatDate=e,i.length>0?(this._heartbeatsCache.heartbeats=i,await this._storage.overwrite(this._heartbeatsCache)):(this._heartbeatsCache.heartbeats=[],this._storage.overwrite(this._heartbeatsCache)),s}catch(k){return tu.warn(k),""}}}function ed(){const t=new Date;return t.toISOString().substring(0,10)}function nd(t,e=Zu){const n=[];let i=t.slice();for(const s of t){const t=n.find((t=>t.agent===s.agent));if(t){if(t.dates.push(s.date),sd(n)>e){t.dates.pop();break}}else if(n.push({agent:s.agent,dates:[s.date]}),sd(n)>e){n.pop();break}i=i.slice(1)}return{heartbeatsToSend:n,unsentEntries:i}}class id{constructor(t){this.app=t,this._canUseIndexedDBPromise=this.runIndexedDBEnvironmentCheck()}async runIndexedDBEnvironmentCheck(){return!!Gc()&&Vc().then((()=>!0)).catch((()=>!1))}async read(){const t=await this._canUseIndexedDBPromise;if(t){const t=await Ku(this.app);return(null===t||void 0===t?void 0:t.heartbeats)?t:{heartbeats:[]}}return{heartbeats:[]}}async overwrite(t){var e;const n=await this._canUseIndexedDBPromise;if(n){const n=await this.read();return Qu(this.app,{lastSentHeartbeatDate:null!==(e=t.lastSentHeartbeatDate)&&void 0!==e?e:n.lastSentHeartbeatDate,heartbeats:t.heartbeats})}}async add(t){var e;const n=await this._canUseIndexedDBPromise;if(n){const n=await this.read();return Qu(this.app,{lastSentHeartbeatDate:null!==(e=t.lastSentHeartbeatDate)&&void 0!==e?e:n.lastSentHeartbeatDate,heartbeats:[...n.heartbeats,...t.heartbeats]})}}}function sd(t){return vc(JSON.stringify({version:2,heartbeats:t})).length}function rd(t){if(0===t.length)return-1;let e=0,n=t[0].date;for(let i=1;i<t.length;i++)t[i].date<n&&(n=t[i].date,e=i);return e}
/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function od(t){Ru(new pl("platform-logger",(t=>new Ql(t)),"PRIVATE")),Ru(new pl("heartbeat",(t=>new td(t)),"PRIVATE")),Xu(Zl,$l,t),Xu(Zl,$l,"esm2017"),Xu("fire-js","")}od("");var ad="firebase",hd="11.8.0";
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
Xu(ad,hd,"app");const cd="@firebase/database",ld="1.0.18";
/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let ud="";function dd(t){ud=t}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class gd{constructor(t){this.domStorage_=t,this.prefix_="firebase:"}set(t,e){null==e?this.domStorage_.removeItem(this.prefixedName_(t)):this.domStorage_.setItem(this.prefixedName_(t),Zc(e))}get(t){const e=this.domStorage_.getItem(this.prefixedName_(t));return null==e?null:Jc(e)}remove(t){this.domStorage_.removeItem(this.prefixedName_(t))}prefixedName_(t){return this.prefix_+t}toString(){return this.domStorage_.toString()}}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class pd{constructor(){this.cache_={},this.isInMemoryStorage=!0}set(t,e){null==e?delete this.cache_[t]:this.cache_[t]=e}get(t){return nl(this.cache_,t)?this.cache_[t]:null}remove(t){delete this.cache_[t]}}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const fd=function(t){try{if("undefined"!==typeof window&&"undefined"!==typeof window[t]){const e=window[t];return e.setItem("firebase:sentinel","cache"),e.removeItem("firebase:sentinel"),new gd(e)}}catch(k){}return new pd},md=fd("localStorage"),_d=fd("sessionStorage"),vd=new El("@firebase/database"),yd=function(){let t=1;return function(){return t++}}(),Cd=function(t){const e=ul(t),n=new cl;n.update(e);const i=n.digest();return fc.encodeByteArray(i)},bd=function(...t){let e="";for(let n=0;n<t.length;n++){const i=t[n];Array.isArray(i)||i&&"object"===typeof i&&"number"===typeof i.length?e+=bd.apply(null,i):e+="object"===typeof i?Zc(i):i,e+=" "}return e};let wd=null,xd=!0;const Sd=function(t,e){uc(!e||!0===t||!1===t,"Can't turn on custom loggers persistently."),!0===t?(vd.logLevel=bl.VERBOSE,wd=vd.log.bind(vd),e&&_d.set("logging_enabled",!0)):"function"===typeof t?wd=t:(wd=null,_d.remove("logging_enabled"))},Td=function(...t){if(!0===xd&&(xd=!1,null===wd&&!0===_d.get("logging_enabled")&&Sd(!0)),wd){const e=bd.apply(null,t);wd(e)}},Ed=function(t){return function(...e){Td(t,...e)}},kd=function(...t){const e="FIREBASE INTERNAL ERROR: "+bd(...t);vd.error(e)},Ad=function(...t){const e=`FIREBASE FATAL ERROR: ${bd(...t)}`;throw vd.error(e),new Error(e)},Od=function(...t){const e="FIREBASE WARNING: "+bd(...t);vd.warn(e)},Dd=function(){"undefined"!==typeof window&&window.location&&window.location.protocol&&-1!==window.location.protocol.indexOf("https:")&&Od("Insecure Firebase access from a secure page. Please use https in calls to new Firebase().")},Id=function(t){return"number"===typeof t&&(t!==t||t===Number.POSITIVE_INFINITY||t===Number.NEGATIVE_INFINITY)},Pd=function(t){if(Xc()||"complete"===document.readyState)t();else{let e=!1;const n=function(){document.body?e||(e=!0,t()):setTimeout(n,Math.floor(10))};document.addEventListener?(document.addEventListener("DOMContentLoaded",n,!1),window.addEventListener("load",n,!1)):document.attachEvent&&(document.attachEvent("onreadystatechange",(()=>{"complete"===document.readyState&&n()})),window.attachEvent("onload",n))}},Md="[MIN_NAME]",Rd="[MAX_NAME]",Fd=function(t,e){if(t===e)return 0;if(t===Md||e===Rd)return-1;if(e===Md||t===Rd)return 1;{const n=qd(t),i=qd(e);return null!==n?null!==i?n-i===0?t.length-e.length:n-i:-1:null!==i?1:t<e?-1:1}},Ld=function(t,e){return t===e?0:t<e?-1:1},jd=function(t,e){if(e&&t in e)return e[t];throw new Error("Missing required key ("+t+") in object: "+Zc(e))},Nd=function(t){if("object"!==typeof t||null===t)return Zc(t);const e=[];for(const i in t)e.push(i);e.sort();let n="{";for(let i=0;i<e.length;i++)0!==i&&(n+=","),n+=Zc(e[i]),n+=":",n+=Nd(t[e[i]]);return n+="}",n},Bd=function(t,e){const n=t.length;if(n<=e)return[t];const i=[];for(let s=0;s<n;s+=e)s+e>n?i.push(t.substring(s,n)):i.push(t.substring(s,s+e));return i};function Wd(t,e){for(const n in t)t.hasOwnProperty(n)&&e(n,t[n])}const Yd=function(t){uc(!Id(t),"Invalid JSON number");const e=11,n=52,i=(1<<e-1)-1;let s,r,o,a,h;0===t?(r=0,o=0,s=1/t===-1/0?1:0):(s=t<0,t=Math.abs(t),t>=Math.pow(2,1-i)?(a=Math.min(Math.floor(Math.log(t)/Math.LN2),i),r=a+i,o=Math.round(t*Math.pow(2,n-a)-Math.pow(2,n))):(r=0,o=Math.round(t/Math.pow(2,1-i-n))));const c=[];for(h=n;h;h-=1)c.push(o%2?1:0),o=Math.floor(o/2);for(h=e;h;h-=1)c.push(r%2?1:0),r=Math.floor(r/2);c.push(s?1:0),c.reverse();const l=c.join("");let u="";for(h=0;h<64;h+=8){let t=parseInt(l.substr(h,8),2).toString(16);1===t.length&&(t="0"+t),u+=t}return u.toLowerCase()},Ud=function(){return!("object"!==typeof window||!window["chrome"]||!window["chrome"]["extension"]||/^chrome/.test(window.location.href))},Xd=function(){return"object"===typeof Windows&&"object"===typeof Windows.UI};function Gd(t,e){let n="Unknown Error";"too_big"===t?n="The data requested exceeds the maximum size that can be accessed with a single request.":"permission_denied"===t?n="Client doesn't have permission to access the desired data.":"unavailable"===t&&(n="The service is unavailable");const i=new Error(t+" at "+e._path.toString()+": "+n);return i.code=t.toUpperCase(),i}const Vd=new RegExp("^-?(0*)\\d{1,10}$"),Hd=-2147483648,zd=2147483647,qd=function(t){if(Vd.test(t)){const e=Number(t);if(e>=Hd&&e<=zd)return e}return null},Kd=function(t){try{t()}catch(k){setTimeout((()=>{const e=k.stack||"";throw Od("Exception was thrown by user callback.",e),k}),Math.floor(0))}},Qd=function(){const t="object"===typeof window&&window["navigator"]&&window["navigator"]["userAgent"]||"";return t.search(/googlebot|google webmaster tools|bingbot|yahoo! slurp|baiduspider|yandexbot|duckduckbot/i)>=0},Jd=function(t,e){const n=setTimeout(t,e);return"number"===typeof n&&"undefined"!==typeof Deno&&Deno["unrefTimer"]?Deno.unrefTimer(n):"object"===typeof n&&n["unref"]&&n["unref"](),n};
/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
class Zd{constructor(t,e){this.appCheckProvider=e,this.appName=t.name,Lu(t)&&t.settings.appCheckToken&&(this.serverAppAppCheckToken=t.settings.appCheckToken),this.appCheck=null===e||void 0===e?void 0:e.getImmediate({optional:!0}),this.appCheck||null===e||void 0===e||e.get().then((t=>this.appCheck=t))}getToken(t){if(this.serverAppAppCheckToken){if(t)throw new Error("Attempted reuse of `FirebaseServerApp.appCheckToken` after previous usage failed.");return Promise.resolve({token:this.serverAppAppCheckToken})}return this.appCheck?this.appCheck.getToken(t):new Promise(((e,n)=>{setTimeout((()=>{this.appCheck?this.getToken(t).then(e,n):e(null)}),0)}))}addTokenChangeListener(t){var e;null===(e=this.appCheckProvider)||void 0===e||e.get().then((e=>e.addTokenListener(t)))}notifyForInvalidToken(){Od(`Provided AppCheck credentials for the app named "${this.appName}" are invalid. This usually indicates your app was not initialized correctly.`)}}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class $d{constructor(t,e,n){this.appName_=t,this.firebaseOptions_=e,this.authProvider_=n,this.auth_=null,this.auth_=n.getImmediate({optional:!0}),this.auth_||n.onInit((t=>this.auth_=t))}getToken(t){return this.auth_?this.auth_.getToken(t).catch((t=>t&&"auth/token-not-initialized"===t.code?(Td("Got auth/token-not-initialized error.  Treating as null token."),null):Promise.reject(t))):new Promise(((e,n)=>{setTimeout((()=>{this.auth_?this.getToken(t).then(e,n):e(null)}),0)}))}addTokenChangeListener(t){this.auth_?this.auth_.addAuthTokenListener(t):this.authProvider_.get().then((e=>e.addAuthTokenListener(t)))}removeTokenChangeListener(t){this.authProvider_.get().then((e=>e.removeAuthTokenListener(t)))}notifyForInvalidToken(){let t='Provided authentication credentials for the app named "'+this.appName_+'" are invalid. This usually indicates your app was not initialized correctly. ';"credential"in this.firebaseOptions_?t+='Make sure the "credential" property provided to initializeApp() is authorized to access the specified "databaseURL" and is from the correct project.':"serviceAccount"in this.firebaseOptions_?t+='Make sure the "serviceAccount" property provided to initializeApp() is authorized to access the specified "databaseURL" and is from the correct project.':t+='Make sure the "apiKey" and "databaseURL" properties provided to initializeApp() match the values provided for your app at https://console.firebase.google.com/.',Od(t)}}class tg{constructor(t){this.accessToken=t}getToken(t){return Promise.resolve({accessToken:this.accessToken})}addTokenChangeListener(t){t(this.accessToken)}removeTokenChangeListener(t){}notifyForInvalidToken(){}}tg.OWNER="owner";
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
const eg="5",ng="v",ig="s",sg="r",rg="f",og=/(console\.firebase|firebase-console-\w+\.corp|firebase\.corp)\.google\.com/,ag="ls",hg="p",cg="ac",lg="websocket",ug="long_polling";
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
class dg{constructor(t,e,n,i,s=!1,r="",o=!1,a=!1,h=null){this.secure=e,this.namespace=n,this.webSocketOnly=i,this.nodeAdmin=s,this.persistenceKey=r,this.includeNamespaceInQueryParams=o,this.isUsingEmulator=a,this.emulatorOptions=h,this._host=t.toLowerCase(),this._domain=this._host.substr(this._host.indexOf(".")+1),this.internalHost=md.get("host:"+t)||this._host}isCacheableHost(){return"s-"===this.internalHost.substr(0,2)}isCustomHost(){return"firebaseio.com"!==this._domain&&"firebaseio-demo.com"!==this._domain}get host(){return this._host}set host(t){t!==this.internalHost&&(this.internalHost=t,this.isCacheableHost()&&md.set("host:"+this._host,this.internalHost))}toString(){let t=this.toURLString();return this.persistenceKey&&(t+="<"+this.persistenceKey+">"),t}toURLString(){const t=this.secure?"https://":"http://",e=this.includeNamespaceInQueryParams?`?ns=${this.namespace}`:"";return`${t}${this.host}/${e}`}}function gg(t){return t.host!==t.internalHost||t.isCustomHost()||t.includeNamespaceInQueryParams}function pg(t,e,n){let i;if(uc("string"===typeof e,"typeof type must == string"),uc("object"===typeof n,"typeof params must == object"),e===lg)i=(t.secure?"wss://":"ws://")+t.internalHost+"/.ws?";else{if(e!==ug)throw new Error("Unknown connection type: "+e);i=(t.secure?"https://":"http://")+t.internalHost+"/.lp?"}gg(t)&&(n["ns"]=t.namespace);const s=[];return Wd(n,((t,e)=>{s.push(t+"="+e)})),i+s.join("&")}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class fg{constructor(){this.counters_={}}incrementCounter(t,e=1){nl(this.counters_,t)||(this.counters_[t]=0),this.counters_[t]+=e}get(){return Cc(this.counters_)}}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const mg={},_g={};function vg(t){const e=t.toString();return mg[e]||(mg[e]=new fg),mg[e]}function yg(t,e){const n=t.toString();return _g[n]||(_g[n]=e()),_g[n]}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Cg{constructor(t){this.onMessage_=t,this.pendingResponses=[],this.currentResponseNum=0,this.closeAfterResponse=-1,this.onClose=null}closeAfter(t,e){this.closeAfterResponse=t,this.onClose=e,this.closeAfterResponse<this.currentResponseNum&&(this.onClose(),this.onClose=null)}handleResponse(t,e){this.pendingResponses[t]=e;while(this.pendingResponses[this.currentResponseNum]){const t=this.pendingResponses[this.currentResponseNum];delete this.pendingResponses[this.currentResponseNum];for(let e=0;e<t.length;++e)t[e]&&Kd((()=>{this.onMessage_(t[e])}));if(this.currentResponseNum===this.closeAfterResponse){this.onClose&&(this.onClose(),this.onClose=null);break}this.currentResponseNum++}}}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const bg="start",wg="close",xg="pLPCommand",Sg="pRTLPCB",Tg="id",Eg="pw",kg="ser",Ag="cb",Og="seg",Dg="ts",Ig="d",Pg="dframe",Mg=1870,Rg=30,Fg=Mg-Rg,Lg=25e3,jg=3e4;class Ng{constructor(t,e,n,i,s,r,o){this.connId=t,this.repoInfo=e,this.applicationId=n,this.appCheckToken=i,this.authToken=s,this.transportSessionId=r,this.lastSessionId=o,this.bytesSent=0,this.bytesReceived=0,this.everConnected_=!1,this.log_=Ed(t),this.stats_=vg(e),this.urlFn=t=>(this.appCheckToken&&(t[cg]=this.appCheckToken),pg(e,ug,t))}open(t,e){this.curSegmentNum=0,this.onDisconnect_=e,this.myPacketOrderer=new Cg(t),this.isClosed_=!1,this.connectTimeoutTimer_=setTimeout((()=>{this.log_("Timed out trying to connect."),this.onClosed_(),this.connectTimeoutTimer_=null}),Math.floor(jg)),Pd((()=>{if(this.isClosed_)return;this.scriptTagHolder=new Bg(((...t)=>{const[e,n,i,s,r]=t;if(this.incrementIncomingBytes_(t),this.scriptTagHolder)if(this.connectTimeoutTimer_&&(clearTimeout(this.connectTimeoutTimer_),this.connectTimeoutTimer_=null),this.everConnected_=!0,e===bg)this.id=n,this.password=i;else{if(e!==wg)throw new Error("Unrecognized command received: "+e);n?(this.scriptTagHolder.sendNewPolls=!1,this.myPacketOrderer.closeAfter(n,(()=>{this.onClosed_()}))):this.onClosed_()}}),((...t)=>{const[e,n]=t;this.incrementIncomingBytes_(t),this.myPacketOrderer.handleResponse(e,n)}),(()=>{this.onClosed_()}),this.urlFn);const t={};t[bg]="t",t[kg]=Math.floor(1e8*Math.random()),this.scriptTagHolder.uniqueCallbackIdentifier&&(t[Ag]=this.scriptTagHolder.uniqueCallbackIdentifier),t[ng]=eg,this.transportSessionId&&(t[ig]=this.transportSessionId),this.lastSessionId&&(t[ag]=this.lastSessionId),this.applicationId&&(t[hg]=this.applicationId),this.appCheckToken&&(t[cg]=this.appCheckToken),"undefined"!==typeof location&&location.hostname&&og.test(location.hostname)&&(t[sg]=rg);const e=this.urlFn(t);this.log_("Connecting via long-poll to "+e),this.scriptTagHolder.addTag(e,(()=>{}))}))}start(){this.scriptTagHolder.startLongPoll(this.id,this.password),this.addDisconnectPingFrame(this.id,this.password)}static forceAllow(){Ng.forceAllow_=!0}static forceDisallow(){Ng.forceDisallow_=!0}static isAvailable(){return!Xc()&&(!!Ng.forceAllow_||!Ng.forceDisallow_&&"undefined"!==typeof document&&null!=document.createElement&&!Ud()&&!Xd())}markConnectionHealthy(){}shutdown_(){this.isClosed_=!0,this.scriptTagHolder&&(this.scriptTagHolder.close(),this.scriptTagHolder=null),this.myDisconnFrame&&(document.body.removeChild(this.myDisconnFrame),this.myDisconnFrame=null),this.connectTimeoutTimer_&&(clearTimeout(this.connectTimeoutTimer_),this.connectTimeoutTimer_=null)}onClosed_(){this.isClosed_||(this.log_("Longpoll is closing itself"),this.shutdown_(),this.onDisconnect_&&(this.onDisconnect_(this.everConnected_),this.onDisconnect_=null))}close(){this.isClosed_||(this.log_("Longpoll is being closed."),this.shutdown_())}send(t){const e=Zc(t);this.bytesSent+=e.length,this.stats_.incrementCounter("bytes_sent",e.length);const n=_c(e),i=Bd(n,Fg);for(let s=0;s<i.length;s++)this.scriptTagHolder.enqueueSegment(this.curSegmentNum,i.length,i[s]),this.curSegmentNum++}addDisconnectPingFrame(t,e){if(Xc())return;this.myDisconnFrame=document.createElement("iframe");const n={};n[Pg]="t",n[Tg]=t,n[Eg]=e,this.myDisconnFrame.src=this.urlFn(n),this.myDisconnFrame.style.display="none",document.body.appendChild(this.myDisconnFrame)}incrementIncomingBytes_(t){const e=Zc(t).length;this.bytesReceived+=e,this.stats_.incrementCounter("bytes_received",e)}}class Bg{constructor(t,e,n,i){if(this.onDisconnect=n,this.urlFn=i,this.outstandingRequests=new Set,this.pendingSegs=[],this.currentSerial=Math.floor(1e8*Math.random()),this.sendNewPolls=!0,Xc())this.commandCB=t,this.onMessageCB=e;else{this.uniqueCallbackIdentifier=yd(),window[xg+this.uniqueCallbackIdentifier]=t,window[Sg+this.uniqueCallbackIdentifier]=e,this.myIFrame=Bg.createIFrame_();let n="";if(this.myIFrame.src&&"javascript:"===this.myIFrame.src.substr(0,11)){const t=document.domain;n='<script>document.domain="'+t+'";<\/script>'}const i="<html><body>"+n+"</body></html>";try{this.myIFrame.doc.open(),this.myIFrame.doc.write(i),this.myIFrame.doc.close()}catch(k){Td("frame writing exception"),k.stack&&Td(k.stack),Td(k)}}}static createIFrame_(){const t=document.createElement("iframe");if(t.style.display="none",!document.body)throw"Document body has not initialized. Wait to initialize Firebase until after the document is ready.";document.body.appendChild(t);try{const e=t.contentWindow.document;e||Td("No IE domain setting required")}catch(k){const n=document.domain;t.src="javascript:void((function(){document.open();document.domain='"+n+"';document.close();})())"}return t.contentDocument?t.doc=t.contentDocument:t.contentWindow?t.doc=t.contentWindow.document:t.document&&(t.doc=t.document),t}close(){this.alive=!1,this.myIFrame&&(this.myIFrame.doc.body.textContent="",setTimeout((()=>{null!==this.myIFrame&&(document.body.removeChild(this.myIFrame),this.myIFrame=null)}),Math.floor(0)));const t=this.onDisconnect;t&&(this.onDisconnect=null,t())}startLongPoll(t,e){this.myID=t,this.myPW=e,this.alive=!0;while(this.newRequest_());}newRequest_(){if(this.alive&&this.sendNewPolls&&this.outstandingRequests.size<(this.pendingSegs.length>0?2:1)){this.currentSerial++;const t={};t[Tg]=this.myID,t[Eg]=this.myPW,t[kg]=this.currentSerial;let e=this.urlFn(t),n="",i=0;while(this.pendingSegs.length>0){const t=this.pendingSegs[0];if(!(t.d.length+Rg+n.length<=Mg))break;{const t=this.pendingSegs.shift();n=n+"&"+Og+i+"="+t.seg+"&"+Dg+i+"="+t.ts+"&"+Ig+i+"="+t.d,i++}}return e+=n,this.addLongPollTag_(e,this.currentSerial),!0}return!1}enqueueSegment(t,e,n){this.pendingSegs.push({seg:t,ts:e,d:n}),this.alive&&this.newRequest_()}addLongPollTag_(t,e){this.outstandingRequests.add(e);const n=()=>{this.outstandingRequests.delete(e),this.newRequest_()},i=setTimeout(n,Math.floor(Lg)),s=()=>{clearTimeout(i),n()};this.addTag(t,s)}addTag(t,e){Xc()?this.doNodeLongPoll(t,e):setTimeout((()=>{try{if(!this.sendNewPolls)return;const n=this.myIFrame.doc.createElement("script");n.type="text/javascript",n.async=!0,n.src=t,n.onload=n.onreadystatechange=function(){const t=n.readyState;t&&"loaded"!==t&&"complete"!==t||(n.onload=n.onreadystatechange=null,n.parentNode&&n.parentNode.removeChild(n),e())},n.onerror=()=>{Td("Long-poll script failed to load: "+t),this.sendNewPolls=!1,this.close()},this.myIFrame.doc.body.appendChild(n)}catch(k){}}),Math.floor(1))}}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Wg=16384,Yg=45e3;let Ug=null;"undefined"!==typeof MozWebSocket?Ug=MozWebSocket:"undefined"!==typeof WebSocket&&(Ug=WebSocket);class Xg{constructor(t,e,n,i,s,r,o){this.connId=t,this.applicationId=n,this.appCheckToken=i,this.authToken=s,this.keepaliveTimer=null,this.frames=null,this.totalFrames=0,this.bytesSent=0,this.bytesReceived=0,this.log_=Ed(this.connId),this.stats_=vg(e),this.connURL=Xg.connectionURL_(e,r,o,i,n),this.nodeAdmin=e.nodeAdmin}static connectionURL_(t,e,n,i,s){const r={};return r[ng]=eg,!Xc()&&"undefined"!==typeof location&&location.hostname&&og.test(location.hostname)&&(r[sg]=rg),e&&(r[ig]=e),n&&(r[ag]=n),i&&(r[cg]=i),s&&(r[hg]=s),pg(t,lg,r)}open(t,e){this.onDisconnect=e,this.onMessage=t,this.log_("Websocket connecting to "+this.connURL),this.everConnected_=!1,md.set("previous_websocket_failure",!0);try{let t;if(Xc()){const e=this.nodeAdmin?"AdminNode":"Node";t={headers:{"User-Agent":`Firebase/${eg}/${ud}/${process.platform}/${e}`,"X-Firebase-GMPID":this.applicationId||""}},this.authToken&&(t.headers["Authorization"]=`Bearer ${this.authToken}`),this.appCheckToken&&(t.headers["X-Firebase-AppCheck"]=this.appCheckToken);const n={NODE_ENV:"production",BASE_URL:"/alien_mood/"},i=0===this.connURL.indexOf("wss://")?n["HTTPS_PROXY"]||n["https_proxy"]:n["HTTP_PROXY"]||n["http_proxy"];i&&(t["proxy"]={origin:i})}this.mySock=new Ug(this.connURL,[],t)}catch(k){this.log_("Error instantiating WebSocket.");const e=k.message||k.data;return e&&this.log_(e),void this.onClosed_()}this.mySock.onopen=()=>{this.log_("Websocket connected."),this.everConnected_=!0},this.mySock.onclose=()=>{this.log_("Websocket connection was disconnected."),this.mySock=null,this.onClosed_()},this.mySock.onmessage=t=>{this.handleIncomingFrame(t)},this.mySock.onerror=t=>{this.log_("WebSocket error.  Closing connection.");const e=t.message||t.data;e&&this.log_(e),this.onClosed_()}}start(){}static forceDisallow(){Xg.forceDisallow_=!0}static isAvailable(){let t=!1;if("undefined"!==typeof navigator&&navigator.userAgent){const e=/Android ([0-9]{0,}\.[0-9]{0,})/,n=navigator.userAgent.match(e);n&&n.length>1&&parseFloat(n[1])<4.4&&(t=!0)}return!t&&null!==Ug&&!Xg.forceDisallow_}static previouslyFailed(){return md.isInMemoryStorage||!0===md.get("previous_websocket_failure")}markConnectionHealthy(){md.remove("previous_websocket_failure")}appendFrame_(t){if(this.frames.push(t),this.frames.length===this.totalFrames){const t=this.frames.join("");this.frames=null;const e=Jc(t);this.onMessage(e)}}handleNewFrameCount_(t){this.totalFrames=t,this.frames=[]}extractFrameCount_(t){if(uc(null===this.frames,"We already have a frame buffer"),t.length<=6){const e=Number(t);if(!isNaN(e))return this.handleNewFrameCount_(e),null}return this.handleNewFrameCount_(1),t}handleIncomingFrame(t){if(null===this.mySock)return;const e=t["data"];if(this.bytesReceived+=e.length,this.stats_.incrementCounter("bytes_received",e.length),this.resetKeepAlive(),null!==this.frames)this.appendFrame_(e);else{const t=this.extractFrameCount_(e);null!==t&&this.appendFrame_(t)}}send(t){this.resetKeepAlive();const e=Zc(t);this.bytesSent+=e.length,this.stats_.incrementCounter("bytes_sent",e.length);const n=Bd(e,Wg);n.length>1&&this.sendString_(String(n.length));for(let i=0;i<n.length;i++)this.sendString_(n[i])}shutdown_(){this.isClosed_=!0,this.keepaliveTimer&&(clearInterval(this.keepaliveTimer),this.keepaliveTimer=null),this.mySock&&(this.mySock.close(),this.mySock=null)}onClosed_(){this.isClosed_||(this.log_("WebSocket is closing itself"),this.shutdown_(),this.onDisconnect&&(this.onDisconnect(this.everConnected_),this.onDisconnect=null))}close(){this.isClosed_||(this.log_("WebSocket is being closed"),this.shutdown_())}resetKeepAlive(){clearInterval(this.keepaliveTimer),this.keepaliveTimer=setInterval((()=>{this.mySock&&this.sendString_("0"),this.resetKeepAlive()}),Math.floor(Yg))}sendString_(t){try{this.mySock.send(t)}catch(k){this.log_("Exception thrown from WebSocket.send():",k.message||k.data,"Closing connection."),setTimeout(this.onClosed_.bind(this),0)}}}Xg.responsesRequiredToBeHealthy=2,Xg.healthyTimeout=3e4;
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
class Gg{static get ALL_TRANSPORTS(){return[Ng,Xg]}static get IS_TRANSPORT_INITIALIZED(){return this.globalTransportInitialized_}constructor(t){this.initTransports_(t)}initTransports_(t){const e=Xg&&Xg["isAvailable"]();let n=e&&!Xg.previouslyFailed();if(t.webSocketOnly&&(e||Od("wss:// URL used, but browser isn't known to support websockets.  Trying anyway."),n=!0),n)this.transports_=[Xg];else{const t=this.transports_=[];for(const e of Gg.ALL_TRANSPORTS)e&&e["isAvailable"]()&&t.push(e);Gg.globalTransportInitialized_=!0}}initialTransport(){if(this.transports_.length>0)return this.transports_[0];throw new Error("No transports available")}upgradeTransport(){return this.transports_.length>1?this.transports_[1]:null}}Gg.globalTransportInitialized_=!1;
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
const Vg=6e4,Hg=5e3,zg=10240,qg=102400,Kg="t",Qg="d",Jg="s",Zg="r",$g="e",tp="o",ep="a",np="n",ip="p",sp="h";class rp{constructor(t,e,n,i,s,r,o,a,h,c){this.id=t,this.repoInfo_=e,this.applicationId_=n,this.appCheckToken_=i,this.authToken_=s,this.onMessage_=r,this.onReady_=o,this.onDisconnect_=a,this.onKill_=h,this.lastSessionId=c,this.connectionCount=0,this.pendingDataMessages=[],this.state_=0,this.log_=Ed("c:"+this.id+":"),this.transportManager_=new Gg(e),this.log_("Connection created"),this.start_()}start_(){const t=this.transportManager_.initialTransport();this.conn_=new t(this.nextTransportId_(),this.repoInfo_,this.applicationId_,this.appCheckToken_,this.authToken_,null,this.lastSessionId),this.primaryResponsesRequired_=t["responsesRequiredToBeHealthy"]||0;const e=this.connReceiver_(this.conn_),n=this.disconnReceiver_(this.conn_);this.tx_=this.conn_,this.rx_=this.conn_,this.secondaryConn_=null,this.isHealthy_=!1,setTimeout((()=>{this.conn_&&this.conn_.open(e,n)}),Math.floor(0));const i=t["healthyTimeout"]||0;i>0&&(this.healthyTimeout_=Jd((()=>{this.healthyTimeout_=null,this.isHealthy_||(this.conn_&&this.conn_.bytesReceived>qg?(this.log_("Connection exceeded healthy timeout but has received "+this.conn_.bytesReceived+" bytes.  Marking connection healthy."),this.isHealthy_=!0,this.conn_.markConnectionHealthy()):this.conn_&&this.conn_.bytesSent>zg?this.log_("Connection exceeded healthy timeout but has sent "+this.conn_.bytesSent+" bytes.  Leaving connection alive."):(this.log_("Closing unhealthy connection after timeout."),this.close()))}),Math.floor(i)))}nextTransportId_(){return"c:"+this.id+":"+this.connectionCount++}disconnReceiver_(t){return e=>{t===this.conn_?this.onConnectionLost_(e):t===this.secondaryConn_?(this.log_("Secondary connection lost."),this.onSecondaryConnectionLost_()):this.log_("closing an old connection")}}connReceiver_(t){return e=>{2!==this.state_&&(t===this.rx_?this.onPrimaryMessageReceived_(e):t===this.secondaryConn_?this.onSecondaryMessageReceived_(e):this.log_("message on old connection"))}}sendRequest(t){const e={t:"d",d:t};this.sendData_(e)}tryCleanupConnection(){this.tx_===this.secondaryConn_&&this.rx_===this.secondaryConn_&&(this.log_("cleaning up and promoting a connection: "+this.secondaryConn_.connId),this.conn_=this.secondaryConn_,this.secondaryConn_=null)}onSecondaryControl_(t){if(Kg in t){const e=t[Kg];e===ep?this.upgradeIfSecondaryHealthy_():e===Zg?(this.log_("Got a reset on secondary, closing it"),this.secondaryConn_.close(),this.tx_!==this.secondaryConn_&&this.rx_!==this.secondaryConn_||this.close()):e===tp&&(this.log_("got pong on secondary."),this.secondaryResponsesRequired_--,this.upgradeIfSecondaryHealthy_())}}onSecondaryMessageReceived_(t){const e=jd("t",t),n=jd("d",t);if("c"===e)this.onSecondaryControl_(n);else{if("d"!==e)throw new Error("Unknown protocol layer: "+e);this.pendingDataMessages.push(n)}}upgradeIfSecondaryHealthy_(){this.secondaryResponsesRequired_<=0?(this.log_("Secondary connection is healthy."),this.isHealthy_=!0,this.secondaryConn_.markConnectionHealthy(),this.proceedWithUpgrade_()):(this.log_("sending ping on secondary."),this.secondaryConn_.send({t:"c",d:{t:ip,d:{}}}))}proceedWithUpgrade_(){this.secondaryConn_.start(),this.log_("sending client ack on secondary"),this.secondaryConn_.send({t:"c",d:{t:ep,d:{}}}),this.log_("Ending transmission on primary"),this.conn_.send({t:"c",d:{t:np,d:{}}}),this.tx_=this.secondaryConn_,this.tryCleanupConnection()}onPrimaryMessageReceived_(t){const e=jd("t",t),n=jd("d",t);"c"===e?this.onControl_(n):"d"===e&&this.onDataMessage_(n)}onDataMessage_(t){this.onPrimaryResponse_(),this.onMessage_(t)}onPrimaryResponse_(){this.isHealthy_||(this.primaryResponsesRequired_--,this.primaryResponsesRequired_<=0&&(this.log_("Primary connection is healthy."),this.isHealthy_=!0,this.conn_.markConnectionHealthy()))}onControl_(t){const e=jd(Kg,t);if(Qg in t){const n=t[Qg];if(e===sp){const t=Object.assign({},n);this.repoInfo_.isUsingEmulator&&(t.h=this.repoInfo_.host),this.onHandshake_(t)}else if(e===np){this.log_("recvd end transmission on primary"),this.rx_=this.secondaryConn_;for(let t=0;t<this.pendingDataMessages.length;++t)this.onDataMessage_(this.pendingDataMessages[t]);this.pendingDataMessages=[],this.tryCleanupConnection()}else e===Jg?this.onConnectionShutdown_(n):e===Zg?this.onReset_(n):e===$g?kd("Server Error: "+n):e===tp?(this.log_("got pong on primary."),this.onPrimaryResponse_(),this.sendPingOnPrimaryIfNecessary_()):kd("Unknown control packet command: "+e)}}onHandshake_(t){const e=t.ts,n=t.v,i=t.h;this.sessionId=t.s,this.repoInfo_.host=i,0===this.state_&&(this.conn_.start(),this.onConnectionEstablished_(this.conn_,e),eg!==n&&Od("Protocol version mismatch detected"),this.tryStartUpgrade_())}tryStartUpgrade_(){const t=this.transportManager_.upgradeTransport();t&&this.startUpgrade_(t)}startUpgrade_(t){this.secondaryConn_=new t(this.nextTransportId_(),this.repoInfo_,this.applicationId_,this.appCheckToken_,this.authToken_,this.sessionId),this.secondaryResponsesRequired_=t["responsesRequiredToBeHealthy"]||0;const e=this.connReceiver_(this.secondaryConn_),n=this.disconnReceiver_(this.secondaryConn_);this.secondaryConn_.open(e,n),Jd((()=>{this.secondaryConn_&&(this.log_("Timed out trying to upgrade."),this.secondaryConn_.close())}),Math.floor(Vg))}onReset_(t){this.log_("Reset packet received.  New host: "+t),this.repoInfo_.host=t,1===this.state_?this.close():(this.closeConnections_(),this.start_())}onConnectionEstablished_(t,e){this.log_("Realtime connection established."),this.conn_=t,this.state_=1,this.onReady_&&(this.onReady_(e,this.sessionId),this.onReady_=null),0===this.primaryResponsesRequired_?(this.log_("Primary connection is healthy."),this.isHealthy_=!0):Jd((()=>{this.sendPingOnPrimaryIfNecessary_()}),Math.floor(Hg))}sendPingOnPrimaryIfNecessary_(){this.isHealthy_||1!==this.state_||(this.log_("sending ping on primary."),this.sendData_({t:"c",d:{t:ip,d:{}}}))}onSecondaryConnectionLost_(){const t=this.secondaryConn_;this.secondaryConn_=null,this.tx_!==t&&this.rx_!==t||this.close()}onConnectionLost_(t){this.conn_=null,t||0!==this.state_?1===this.state_&&this.log_("Realtime connection lost."):(this.log_("Realtime connection failed."),this.repoInfo_.isCacheableHost()&&(md.remove("host:"+this.repoInfo_.host),this.repoInfo_.internalHost=this.repoInfo_.host)),this.close()}onConnectionShutdown_(t){this.log_("Connection shutdown command received. Shutting down..."),this.onKill_&&(this.onKill_(t),this.onKill_=null),this.onDisconnect_=null,this.close()}sendData_(t){if(1!==this.state_)throw"Connection is not connected";this.tx_.send(t)}close(){2!==this.state_&&(this.log_("Closing realtime connection."),this.state_=2,this.closeConnections_(),this.onDisconnect_&&(this.onDisconnect_(),this.onDisconnect_=null))}closeConnections_(){this.log_("Shutting down all connections"),this.conn_&&(this.conn_.close(),this.conn_=null),this.secondaryConn_&&(this.secondaryConn_.close(),this.secondaryConn_=null),this.healthyTimeout_&&(clearTimeout(this.healthyTimeout_),this.healthyTimeout_=null)}}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class op{put(t,e,n,i){}merge(t,e,n,i){}refreshAuthToken(t){}refreshAppCheckToken(t){}onDisconnectPut(t,e,n){}onDisconnectMerge(t,e,n){}onDisconnectCancel(t,e){}reportStats(t){}}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ap{constructor(t){this.allowedEvents_=t,this.listeners_={},uc(Array.isArray(t)&&t.length>0,"Requires a non-empty array")}trigger(t,...e){if(Array.isArray(this.listeners_[t])){const n=[...this.listeners_[t]];for(let t=0;t<n.length;t++)n[t].callback.apply(n[t].context,e)}}on(t,e,n){this.validateEventType_(t),this.listeners_[t]=this.listeners_[t]||[],this.listeners_[t].push({callback:e,context:n});const i=this.getInitialEvent(t);i&&e.apply(n,i)}off(t,e,n){this.validateEventType_(t);const i=this.listeners_[t]||[];for(let s=0;s<i.length;s++)if(i[s].callback===e&&(!n||n===i[s].context))return void i.splice(s,1)}validateEventType_(t){uc(this.allowedEvents_.find((e=>e===t)),"Unknown event: "+t)}}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class hp extends ap{static getInstance(){return new hp}constructor(){super(["online"]),this.online_=!0,"undefined"===typeof window||"undefined"===typeof window.addEventListener||Yc()||(window.addEventListener("online",(()=>{this.online_||(this.online_=!0,this.trigger("online",!0))}),!1),window.addEventListener("offline",(()=>{this.online_&&(this.online_=!1,this.trigger("online",!1))}),!1))}getInitialEvent(t){return uc("online"===t,"Unknown event type: "+t),[this.online_]}currentlyOnline(){return this.online_}}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const cp=32,lp=768;class up{constructor(t,e){if(void 0===e){this.pieces_=t.split("/");let e=0;for(let t=0;t<this.pieces_.length;t++)this.pieces_[t].length>0&&(this.pieces_[e]=this.pieces_[t],e++);this.pieces_.length=e,this.pieceNum_=0}else this.pieces_=t,this.pieceNum_=e}toString(){let t="";for(let e=this.pieceNum_;e<this.pieces_.length;e++)""!==this.pieces_[e]&&(t+="/"+this.pieces_[e]);return t||"/"}}function dp(){return new up("")}function gp(t){return t.pieceNum_>=t.pieces_.length?null:t.pieces_[t.pieceNum_]}function pp(t){return t.pieces_.length-t.pieceNum_}function fp(t){let e=t.pieceNum_;return e<t.pieces_.length&&e++,new up(t.pieces_,e)}function mp(t){return t.pieceNum_<t.pieces_.length?t.pieces_[t.pieces_.length-1]:null}function _p(t){let e="";for(let n=t.pieceNum_;n<t.pieces_.length;n++)""!==t.pieces_[n]&&(e+="/"+encodeURIComponent(String(t.pieces_[n])));return e||"/"}function vp(t,e=0){return t.pieces_.slice(t.pieceNum_+e)}function yp(t){if(t.pieceNum_>=t.pieces_.length)return null;const e=[];for(let n=t.pieceNum_;n<t.pieces_.length-1;n++)e.push(t.pieces_[n]);return new up(e,0)}function Cp(t,e){const n=[];for(let i=t.pieceNum_;i<t.pieces_.length;i++)n.push(t.pieces_[i]);if(e instanceof up)for(let i=e.pieceNum_;i<e.pieces_.length;i++)n.push(e.pieces_[i]);else{const t=e.split("/");for(let e=0;e<t.length;e++)t[e].length>0&&n.push(t[e])}return new up(n,0)}function bp(t){return t.pieceNum_>=t.pieces_.length}function wp(t,e){const n=gp(t),i=gp(e);if(null===n)return e;if(n===i)return wp(fp(t),fp(e));throw new Error("INTERNAL ERROR: innerPath ("+e+") is not within outerPath ("+t+")")}function xp(t,e){if(pp(t)!==pp(e))return!1;for(let n=t.pieceNum_,i=e.pieceNum_;n<=t.pieces_.length;n++,i++)if(t.pieces_[n]!==e.pieces_[i])return!1;return!0}function Sp(t,e){let n=t.pieceNum_,i=e.pieceNum_;if(pp(t)>pp(e))return!1;while(n<t.pieces_.length){if(t.pieces_[n]!==e.pieces_[i])return!1;++n,++i}return!0}class Tp{constructor(t,e){this.errorPrefix_=e,this.parts_=vp(t,0),this.byteLength_=Math.max(1,this.parts_.length);for(let n=0;n<this.parts_.length;n++)this.byteLength_+=dl(this.parts_[n]);Ap(this)}}function Ep(t,e){t.parts_.length>0&&(t.byteLength_+=1),t.parts_.push(e),t.byteLength_+=dl(e),Ap(t)}function kp(t){const e=t.parts_.pop();t.byteLength_-=dl(e),t.parts_.length>0&&(t.byteLength_-=1)}function Ap(t){if(t.byteLength_>lp)throw new Error(t.errorPrefix_+"has a key path longer than "+lp+" bytes ("+t.byteLength_+").");if(t.parts_.length>cp)throw new Error(t.errorPrefix_+"path specified exceeds the maximum depth that can be written ("+cp+") or object contains a cycle "+Op(t))}function Op(t){return 0===t.parts_.length?"":"in property '"+t.parts_.join(".")+"'"}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Dp extends ap{static getInstance(){return new Dp}constructor(){let t,e;super(["visible"]),"undefined"!==typeof document&&"undefined"!==typeof document.addEventListener&&("undefined"!==typeof document["hidden"]?(e="visibilitychange",t="hidden"):"undefined"!==typeof document["mozHidden"]?(e="mozvisibilitychange",t="mozHidden"):"undefined"!==typeof document["msHidden"]?(e="msvisibilitychange",t="msHidden"):"undefined"!==typeof document["webkitHidden"]&&(e="webkitvisibilitychange",t="webkitHidden")),this.visible_=!0,e&&document.addEventListener(e,(()=>{const e=!document[t];e!==this.visible_&&(this.visible_=e,this.trigger("visible",e))}),!1)}getInitialEvent(t){return uc("visible"===t,"Unknown event type: "+t),[this.visible_]}}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Ip=1e3,Pp=3e5,Mp=3e4,Rp=1.3,Fp=3e4,Lp="server_kill",jp=3;class Np extends op{constructor(t,e,n,i,s,r,o,a){if(super(),this.repoInfo_=t,this.applicationId_=e,this.onDataUpdate_=n,this.onConnectStatus_=i,this.onServerInfoUpdate_=s,this.authTokenProvider_=r,this.appCheckTokenProvider_=o,this.authOverride_=a,this.id=Np.nextPersistentConnectionId_++,this.log_=Ed("p:"+this.id+":"),this.interruptReasons_={},this.listens=new Map,this.outstandingPuts_=[],this.outstandingGets_=[],this.outstandingPutCount_=0,this.outstandingGetCount_=0,this.onDisconnectRequestQueue_=[],this.connected_=!1,this.reconnectDelay_=Ip,this.maxReconnectDelay_=Pp,this.securityDebugCallback_=null,this.lastSessionId=null,this.establishConnectionTimer_=null,this.visible_=!1,this.requestCBHash_={},this.requestNumber_=0,this.realtime_=null,this.authToken_=null,this.appCheckToken_=null,this.forceTokenRefresh_=!1,this.invalidAuthTokenCount_=0,this.invalidAppCheckTokenCount_=0,this.firstConnection_=!0,this.lastConnectionAttemptTime_=null,this.lastConnectionEstablishedTime_=null,a&&!Xc())throw new Error("Auth override specified in options, but not supported on non Node.js platforms");Dp.getInstance().on("visible",this.onVisible_,this),-1===t.host.indexOf("fblocal")&&hp.getInstance().on("online",this.onOnline_,this)}sendRequest(t,e,n){const i=++this.requestNumber_,s={r:i,a:t,b:e};this.log_(Zc(s)),uc(this.connected_,"sendRequest call when we're not connected not allowed."),this.realtime_.sendRequest(s),n&&(this.requestCBHash_[i]=n)}get(t){this.initConnection_();const e=new Ic,n={p:t._path.toString(),q:t._queryObject},i={action:"g",request:n,onComplete:t=>{const n=t["d"];"ok"===t["s"]?e.resolve(n):e.reject(n)}};this.outstandingGets_.push(i),this.outstandingGetCount_++;const s=this.outstandingGets_.length-1;return this.connected_&&this.sendGet_(s),e.promise}listen(t,e,n,i){this.initConnection_();const s=t._queryIdentifier,r=t._path.toString();this.log_("Listen called for "+r+" "+s),this.listens.has(r)||this.listens.set(r,new Map),uc(t._queryParams.isDefault()||!t._queryParams.loadsAllData(),"listen() called for non-default but complete query"),uc(!this.listens.get(r).has(s),"listen() called twice for same path/queryId.");const o={onComplete:i,hashFn:e,query:t,tag:n};this.listens.get(r).set(s,o),this.connected_&&this.sendListen_(o)}sendGet_(t){const e=this.outstandingGets_[t];this.sendRequest("g",e.request,(n=>{delete this.outstandingGets_[t],this.outstandingGetCount_--,0===this.outstandingGetCount_&&(this.outstandingGets_=[]),e.onComplete&&e.onComplete(n)}))}sendListen_(t){const e=t.query,n=e._path.toString(),i=e._queryIdentifier;this.log_("Listen on "+n+" for "+i);const s={p:n},r="q";t.tag&&(s["q"]=e._queryObject,s["t"]=t.tag),s["h"]=t.hashFn(),this.sendRequest(r,s,(s=>{const r=s["d"],o=s["s"];Np.warnOnListenWarnings_(r,e);const a=this.listens.get(n)&&this.listens.get(n).get(i);a===t&&(this.log_("listen response",s),"ok"!==o&&this.removeListen_(n,i),t.onComplete&&t.onComplete(o,r))}))}static warnOnListenWarnings_(t,e){if(t&&"object"===typeof t&&nl(t,"w")){const n=il(t,"w");if(Array.isArray(n)&&~n.indexOf("no_index")){const t='".indexOn": "'+e._queryParams.getIndex().toString()+'"',n=e._path.toString();Od(`Using an unspecified index. Your data will be downloaded and filtered on the client. Consider adding ${t} at ${n} to your security rules for better performance.`)}}}refreshAuthToken(t){this.authToken_=t,this.log_("Auth token refreshed"),this.authToken_?this.tryAuth():this.connected_&&this.sendRequest("unauth",{},(()=>{})),this.reduceReconnectDelayIfAdminCredential_(t)}reduceReconnectDelayIfAdminCredential_(t){const e=t&&40===t.length;(e||el(t))&&(this.log_("Admin auth credential detected.  Reducing max reconnect time."),this.maxReconnectDelay_=Mp)}refreshAppCheckToken(t){this.appCheckToken_=t,this.log_("App check token refreshed"),this.appCheckToken_?this.tryAppCheck():this.connected_&&this.sendRequest("unappeck",{},(()=>{}))}tryAuth(){if(this.connected_&&this.authToken_){const t=this.authToken_,e=tl(t)?"auth":"gauth",n={cred:t};null===this.authOverride_?n["noauth"]=!0:"object"===typeof this.authOverride_&&(n["authvar"]=this.authOverride_),this.sendRequest(e,n,(e=>{const n=e["s"],i=e["d"]||"error";this.authToken_===t&&("ok"===n?this.invalidAuthTokenCount_=0:this.onAuthRevoked_(n,i))}))}}tryAppCheck(){this.connected_&&this.appCheckToken_&&this.sendRequest("appcheck",{token:this.appCheckToken_},(t=>{const e=t["s"],n=t["d"]||"error";"ok"===e?this.invalidAppCheckTokenCount_=0:this.onAppCheckRevoked_(e,n)}))}unlisten(t,e){const n=t._path.toString(),i=t._queryIdentifier;this.log_("Unlisten called for "+n+" "+i),uc(t._queryParams.isDefault()||!t._queryParams.loadsAllData(),"unlisten() called for non-default but complete query");const s=this.removeListen_(n,i);s&&this.connected_&&this.sendUnlisten_(n,i,t._queryObject,e)}sendUnlisten_(t,e,n,i){this.log_("Unlisten on "+t+" for "+e);const s={p:t},r="n";i&&(s["q"]=n,s["t"]=i),this.sendRequest(r,s)}onDisconnectPut(t,e,n){this.initConnection_(),this.connected_?this.sendOnDisconnect_("o",t,e,n):this.onDisconnectRequestQueue_.push({pathString:t,action:"o",data:e,onComplete:n})}onDisconnectMerge(t,e,n){this.initConnection_(),this.connected_?this.sendOnDisconnect_("om",t,e,n):this.onDisconnectRequestQueue_.push({pathString:t,action:"om",data:e,onComplete:n})}onDisconnectCancel(t,e){this.initConnection_(),this.connected_?this.sendOnDisconnect_("oc",t,null,e):this.onDisconnectRequestQueue_.push({pathString:t,action:"oc",data:null,onComplete:e})}sendOnDisconnect_(t,e,n,i){const s={p:e,d:n};this.log_("onDisconnect "+t,s),this.sendRequest(t,s,(t=>{i&&setTimeout((()=>{i(t["s"],t["d"])}),Math.floor(0))}))}put(t,e,n,i){this.putInternal("p",t,e,n,i)}merge(t,e,n,i){this.putInternal("m",t,e,n,i)}putInternal(t,e,n,i,s){this.initConnection_();const r={p:e,d:n};void 0!==s&&(r["h"]=s),this.outstandingPuts_.push({action:t,request:r,onComplete:i}),this.outstandingPutCount_++;const o=this.outstandingPuts_.length-1;this.connected_?this.sendPut_(o):this.log_("Buffering put: "+e)}sendPut_(t){const e=this.outstandingPuts_[t].action,n=this.outstandingPuts_[t].request,i=this.outstandingPuts_[t].onComplete;this.outstandingPuts_[t].queued=this.connected_,this.sendRequest(e,n,(n=>{this.log_(e+" response",n),delete this.outstandingPuts_[t],this.outstandingPutCount_--,0===this.outstandingPutCount_&&(this.outstandingPuts_=[]),i&&i(n["s"],n["d"])}))}reportStats(t){if(this.connected_){const e={c:t};this.log_("reportStats",e),this.sendRequest("s",e,(t=>{const e=t["s"];if("ok"!==e){const e=t["d"];this.log_("reportStats","Error sending stats: "+e)}}))}}onDataMessage_(t){if("r"in t){this.log_("from server: "+Zc(t));const e=t["r"],n=this.requestCBHash_[e];n&&(delete this.requestCBHash_[e],n(t["b"]))}else{if("error"in t)throw"A server-side error has occurred: "+t["error"];"a"in t&&this.onDataPush_(t["a"],t["b"])}}onDataPush_(t,e){this.log_("handleServerMessage",t,e),"d"===t?this.onDataUpdate_(e["p"],e["d"],!1,e["t"]):"m"===t?this.onDataUpdate_(e["p"],e["d"],!0,e["t"]):"c"===t?this.onListenRevoked_(e["p"],e["q"]):"ac"===t?this.onAuthRevoked_(e["s"],e["d"]):"apc"===t?this.onAppCheckRevoked_(e["s"],e["d"]):"sd"===t?this.onSecurityDebugPacket_(e):kd("Unrecognized action received from server: "+Zc(t)+"\nAre you using the latest client?")}onReady_(t,e){this.log_("connection ready"),this.connected_=!0,this.lastConnectionEstablishedTime_=(new Date).getTime(),this.handleTimestamp_(t),this.lastSessionId=e,this.firstConnection_&&this.sendConnectStats_(),this.restoreState_(),this.firstConnection_=!1,this.onConnectStatus_(!0)}scheduleConnect_(t){uc(!this.realtime_,"Scheduling a connect when we're already connected/ing?"),this.establishConnectionTimer_&&clearTimeout(this.establishConnectionTimer_),this.establishConnectionTimer_=setTimeout((()=>{this.establishConnectionTimer_=null,this.establishConnection_()}),Math.floor(t))}initConnection_(){!this.realtime_&&this.firstConnection_&&this.scheduleConnect_(0)}onVisible_(t){t&&!this.visible_&&this.reconnectDelay_===this.maxReconnectDelay_&&(this.log_("Window became visible.  Reducing delay."),this.reconnectDelay_=Ip,this.realtime_||this.scheduleConnect_(0)),this.visible_=t}onOnline_(t){t?(this.log_("Browser went online."),this.reconnectDelay_=Ip,this.realtime_||this.scheduleConnect_(0)):(this.log_("Browser went offline.  Killing connection."),this.realtime_&&this.realtime_.close())}onRealtimeDisconnect_(){if(this.log_("data client disconnected"),this.connected_=!1,this.realtime_=null,this.cancelSentTransactions_(),this.requestCBHash_={},this.shouldReconnect_()){if(this.visible_){if(this.lastConnectionEstablishedTime_){const t=(new Date).getTime()-this.lastConnectionEstablishedTime_;t>Fp&&(this.reconnectDelay_=Ip),this.lastConnectionEstablishedTime_=null}}else this.log_("Window isn't visible.  Delaying reconnect."),this.reconnectDelay_=this.maxReconnectDelay_,this.lastConnectionAttemptTime_=(new Date).getTime();const t=Math.max(0,(new Date).getTime()-this.lastConnectionAttemptTime_);let e=Math.max(0,this.reconnectDelay_-t);e=Math.random()*e,this.log_("Trying to reconnect in "+e+"ms"),this.scheduleConnect_(e),this.reconnectDelay_=Math.min(this.maxReconnectDelay_,this.reconnectDelay_*Rp)}this.onConnectStatus_(!1)}async establishConnection_(){if(this.shouldReconnect_()){this.log_("Making a connection attempt"),this.lastConnectionAttemptTime_=(new Date).getTime(),this.lastConnectionEstablishedTime_=null;const t=this.onDataMessage_.bind(this),e=this.onReady_.bind(this),n=this.onRealtimeDisconnect_.bind(this),i=this.id+":"+Np.nextConnectionId_++,s=this.lastSessionId;let r=!1,o=null;const a=function(){o?o.close():(r=!0,n())},h=function(t){uc(o,"sendRequest call when we're not connected not allowed."),o.sendRequest(t)};this.realtime_={close:a,sendRequest:h};const c=this.forceTokenRefresh_;this.forceTokenRefresh_=!1;try{const[a,h]=await Promise.all([this.authTokenProvider_.getToken(c),this.appCheckTokenProvider_.getToken(c)]);r?Td("getToken() completed but was canceled"):(Td("getToken() completed. Creating connection."),this.authToken_=a&&a.accessToken,this.appCheckToken_=h&&h.token,o=new rp(i,this.repoInfo_,this.applicationId_,this.appCheckToken_,this.authToken_,t,e,n,(t=>{Od(t+" ("+this.repoInfo_.toString()+")"),this.interrupt(Lp)}),s))}catch(kd){this.log_("Failed to get token: "+kd),r||(this.repoInfo_.nodeAdmin&&Od(kd),a())}}}interrupt(t){Td("Interrupting connection for reason: "+t),this.interruptReasons_[t]=!0,this.realtime_?this.realtime_.close():(this.establishConnectionTimer_&&(clearTimeout(this.establishConnectionTimer_),this.establishConnectionTimer_=null),this.connected_&&this.onRealtimeDisconnect_())}resume(t){Td("Resuming connection for reason: "+t),delete this.interruptReasons_[t],sl(this.interruptReasons_)&&(this.reconnectDelay_=Ip,this.realtime_||this.scheduleConnect_(0))}handleTimestamp_(t){const e=t-(new Date).getTime();this.onServerInfoUpdate_({serverTimeOffset:e})}cancelSentTransactions_(){for(let t=0;t<this.outstandingPuts_.length;t++){const e=this.outstandingPuts_[t];e&&"h"in e.request&&e.queued&&(e.onComplete&&e.onComplete("disconnect"),delete this.outstandingPuts_[t],this.outstandingPutCount_--)}0===this.outstandingPutCount_&&(this.outstandingPuts_=[])}onListenRevoked_(t,e){let n;n=e?e.map((t=>Nd(t))).join("$"):"default";const i=this.removeListen_(t,n);i&&i.onComplete&&i.onComplete("permission_denied")}removeListen_(t,e){const n=new up(t).toString();let i;if(this.listens.has(n)){const t=this.listens.get(n);i=t.get(e),t.delete(e),0===t.size&&this.listens.delete(n)}else i=void 0;return i}onAuthRevoked_(t,e){Td("Auth token revoked: "+t+"/"+e),this.authToken_=null,this.forceTokenRefresh_=!0,this.realtime_.close(),"invalid_token"!==t&&"permission_denied"!==t||(this.invalidAuthTokenCount_++,this.invalidAuthTokenCount_>=jp&&(this.reconnectDelay_=Mp,this.authTokenProvider_.notifyForInvalidToken()))}onAppCheckRevoked_(t,e){Td("App check token revoked: "+t+"/"+e),this.appCheckToken_=null,this.forceTokenRefresh_=!0,"invalid_token"!==t&&"permission_denied"!==t||(this.invalidAppCheckTokenCount_++,this.invalidAppCheckTokenCount_>=jp&&this.appCheckTokenProvider_.notifyForInvalidToken())}onSecurityDebugPacket_(t){this.securityDebugCallback_?this.securityDebugCallback_(t):"msg"in t&&console.log("FIREBASE: "+t["msg"].replace("\n","\nFIREBASE: "))}restoreState_(){this.tryAuth(),this.tryAppCheck();for(const t of this.listens.values())for(const e of t.values())this.sendListen_(e);for(let t=0;t<this.outstandingPuts_.length;t++)this.outstandingPuts_[t]&&this.sendPut_(t);while(this.onDisconnectRequestQueue_.length){const t=this.onDisconnectRequestQueue_.shift();this.sendOnDisconnect_(t.action,t.pathString,t.data,t.onComplete)}for(let t=0;t<this.outstandingGets_.length;t++)this.outstandingGets_[t]&&this.sendGet_(t)}sendConnectStats_(){const t={};let e="js";Xc()&&(e=this.repoInfo_.nodeAdmin?"admin_node":"node"),t["sdk."+e+"."+ud.replace(/\./g,"-")]=1,Yc()?t["framework.cordova"]=1:Uc()&&(t["framework.reactnative"]=1),this.reportStats(t)}shouldReconnect_(){const t=hp.getInstance().currentlyOnline();return sl(this.interruptReasons_)&&t}}Np.nextPersistentConnectionId_=0,Np.nextConnectionId_=0;
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
class Bp{constructor(t,e){this.name=t,this.node=e}static Wrap(t,e){return new Bp(t,e)}}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Wp{getCompare(){return this.compare.bind(this)}indexedValueChanged(t,e){const n=new Bp(Md,t),i=new Bp(Md,e);return 0!==this.compare(n,i)}minPost(){return Bp.MIN}}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let Yp;class Up extends Wp{static get __EMPTY_NODE(){return Yp}static set __EMPTY_NODE(t){Yp=t}compare(t,e){return Fd(t.name,e.name)}isDefinedOn(t){throw dc("KeyIndex.isDefinedOn not expected to be called.")}indexedValueChanged(t,e){return!1}minPost(){return Bp.MIN}maxPost(){return new Bp(Rd,Yp)}makePost(t,e){return uc("string"===typeof t,"KeyIndex indexValue must always be a string."),new Bp(t,Yp)}toString(){return".key"}}const Xp=new Up;
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Gp{constructor(t,e,n,i,s=null){this.isReverse_=i,this.resultGenerator_=s,this.nodeStack_=[];let r=1;while(!t.isEmpty())if(r=e?n(t.key,e):1,i&&(r*=-1),r<0)t=this.isReverse_?t.left:t.right;else{if(0===r){this.nodeStack_.push(t);break}this.nodeStack_.push(t),t=this.isReverse_?t.right:t.left}}getNext(){if(0===this.nodeStack_.length)return null;let t,e=this.nodeStack_.pop();if(t=this.resultGenerator_?this.resultGenerator_(e.key,e.value):{key:e.key,value:e.value},this.isReverse_){e=e.left;while(!e.isEmpty())this.nodeStack_.push(e),e=e.right}else{e=e.right;while(!e.isEmpty())this.nodeStack_.push(e),e=e.left}return t}hasNext(){return this.nodeStack_.length>0}peek(){if(0===this.nodeStack_.length)return null;const t=this.nodeStack_[this.nodeStack_.length-1];return this.resultGenerator_?this.resultGenerator_(t.key,t.value):{key:t.key,value:t.value}}}class Vp{constructor(t,e,n,i,s){this.key=t,this.value=e,this.color=null!=n?n:Vp.RED,this.left=null!=i?i:zp.EMPTY_NODE,this.right=null!=s?s:zp.EMPTY_NODE}copy(t,e,n,i,s){return new Vp(null!=t?t:this.key,null!=e?e:this.value,null!=n?n:this.color,null!=i?i:this.left,null!=s?s:this.right)}count(){return this.left.count()+1+this.right.count()}isEmpty(){return!1}inorderTraversal(t){return this.left.inorderTraversal(t)||!!t(this.key,this.value)||this.right.inorderTraversal(t)}reverseTraversal(t){return this.right.reverseTraversal(t)||t(this.key,this.value)||this.left.reverseTraversal(t)}min_(){return this.left.isEmpty()?this:this.left.min_()}minKey(){return this.min_().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(t,e,n){let i=this;const s=n(t,i.key);return i=s<0?i.copy(null,null,null,i.left.insert(t,e,n),null):0===s?i.copy(null,e,null,null,null):i.copy(null,null,null,null,i.right.insert(t,e,n)),i.fixUp_()}removeMin_(){if(this.left.isEmpty())return zp.EMPTY_NODE;let t=this;return t.left.isRed_()||t.left.left.isRed_()||(t=t.moveRedLeft_()),t=t.copy(null,null,null,t.left.removeMin_(),null),t.fixUp_()}remove(t,e){let n,i;if(n=this,e(t,n.key)<0)n.left.isEmpty()||n.left.isRed_()||n.left.left.isRed_()||(n=n.moveRedLeft_()),n=n.copy(null,null,null,n.left.remove(t,e),null);else{if(n.left.isRed_()&&(n=n.rotateRight_()),n.right.isEmpty()||n.right.isRed_()||n.right.left.isRed_()||(n=n.moveRedRight_()),0===e(t,n.key)){if(n.right.isEmpty())return zp.EMPTY_NODE;i=n.right.min_(),n=n.copy(i.key,i.value,null,null,n.right.removeMin_())}n=n.copy(null,null,null,null,n.right.remove(t,e))}return n.fixUp_()}isRed_(){return this.color}fixUp_(){let t=this;return t.right.isRed_()&&!t.left.isRed_()&&(t=t.rotateLeft_()),t.left.isRed_()&&t.left.left.isRed_()&&(t=t.rotateRight_()),t.left.isRed_()&&t.right.isRed_()&&(t=t.colorFlip_()),t}moveRedLeft_(){let t=this.colorFlip_();return t.right.left.isRed_()&&(t=t.copy(null,null,null,null,t.right.rotateRight_()),t=t.rotateLeft_(),t=t.colorFlip_()),t}moveRedRight_(){let t=this.colorFlip_();return t.left.left.isRed_()&&(t=t.rotateRight_(),t=t.colorFlip_()),t}rotateLeft_(){const t=this.copy(null,null,Vp.RED,null,this.right.left);return this.right.copy(null,null,this.color,t,null)}rotateRight_(){const t=this.copy(null,null,Vp.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,t)}colorFlip_(){const t=this.left.copy(null,null,!this.left.color,null,null),e=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,t,e)}checkMaxDepth_(){const t=this.check_();return Math.pow(2,t)<=this.count()+1}check_(){if(this.isRed_()&&this.left.isRed_())throw new Error("Red node has red child("+this.key+","+this.value+")");if(this.right.isRed_())throw new Error("Right child of ("+this.key+","+this.value+") is red");const t=this.left.check_();if(t!==this.right.check_())throw new Error("Black depths differ");return t+(this.isRed_()?0:1)}}Vp.RED=!0,Vp.BLACK=!1;class Hp{copy(t,e,n,i,s){return this}insert(t,e,n){return new Vp(t,e,null)}remove(t,e){return this}count(){return 0}isEmpty(){return!0}inorderTraversal(t){return!1}reverseTraversal(t){return!1}minKey(){return null}maxKey(){return null}check_(){return 0}isRed_(){return!1}}class zp{constructor(t,e=zp.EMPTY_NODE){this.comparator_=t,this.root_=e}insert(t,e){return new zp(this.comparator_,this.root_.insert(t,e,this.comparator_).copy(null,null,Vp.BLACK,null,null))}remove(t){return new zp(this.comparator_,this.root_.remove(t,this.comparator_).copy(null,null,Vp.BLACK,null,null))}get(t){let e,n=this.root_;while(!n.isEmpty()){if(e=this.comparator_(t,n.key),0===e)return n.value;e<0?n=n.left:e>0&&(n=n.right)}return null}getPredecessorKey(t){let e,n=this.root_,i=null;while(!n.isEmpty()){if(e=this.comparator_(t,n.key),0===e){if(n.left.isEmpty())return i?i.key:null;n=n.left;while(!n.right.isEmpty())n=n.right;return n.key}e<0?n=n.left:e>0&&(i=n,n=n.right)}throw new Error("Attempted to find predecessor key for a nonexistent key.  What gives?")}isEmpty(){return this.root_.isEmpty()}count(){return this.root_.count()}minKey(){return this.root_.minKey()}maxKey(){return this.root_.maxKey()}inorderTraversal(t){return this.root_.inorderTraversal(t)}reverseTraversal(t){return this.root_.reverseTraversal(t)}getIterator(t){return new Gp(this.root_,null,this.comparator_,!1,t)}getIteratorFrom(t,e){return new Gp(this.root_,t,this.comparator_,!1,e)}getReverseIteratorFrom(t,e){return new Gp(this.root_,t,this.comparator_,!0,e)}getReverseIterator(t){return new Gp(this.root_,null,this.comparator_,!0,t)}}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
function qp(t,e){return Fd(t.name,e.name)}function Kp(t,e){return Fd(t,e)}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let Qp;function Jp(t){Qp=t}zp.EMPTY_NODE=new Hp;const Zp=function(t){return"number"===typeof t?"number:"+Yd(t):"string:"+t},$p=function(t){if(t.isLeafNode()){const e=t.val();uc("string"===typeof e||"number"===typeof e||"object"===typeof e&&nl(e,".sv"),"Priority must be a string or number.")}else uc(t===Qp||t.isEmpty(),"priority of unexpected type.");uc(t===Qp||t.getPriority().isEmpty(),"Priority nodes can't have a priority of their own.")};
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
let tf,ef,nf;class sf{static set __childrenNodeConstructor(t){tf=t}static get __childrenNodeConstructor(){return tf}constructor(t,e=sf.__childrenNodeConstructor.EMPTY_NODE){this.value_=t,this.priorityNode_=e,this.lazyHash_=null,uc(void 0!==this.value_&&null!==this.value_,"LeafNode shouldn't be created with null/undefined value."),$p(this.priorityNode_)}isLeafNode(){return!0}getPriority(){return this.priorityNode_}updatePriority(t){return new sf(this.value_,t)}getImmediateChild(t){return".priority"===t?this.priorityNode_:sf.__childrenNodeConstructor.EMPTY_NODE}getChild(t){return bp(t)?this:".priority"===gp(t)?this.priorityNode_:sf.__childrenNodeConstructor.EMPTY_NODE}hasChild(){return!1}getPredecessorChildName(t,e){return null}updateImmediateChild(t,e){return".priority"===t?this.updatePriority(e):e.isEmpty()&&".priority"!==t?this:sf.__childrenNodeConstructor.EMPTY_NODE.updateImmediateChild(t,e).updatePriority(this.priorityNode_)}updateChild(t,e){const n=gp(t);return null===n?e:e.isEmpty()&&".priority"!==n?this:(uc(".priority"!==n||1===pp(t),".priority must be the last token in a path"),this.updateImmediateChild(n,sf.__childrenNodeConstructor.EMPTY_NODE.updateChild(fp(t),e)))}isEmpty(){return!1}numChildren(){return 0}forEachChild(t,e){return!1}val(t){return t&&!this.getPriority().isEmpty()?{".value":this.getValue(),".priority":this.getPriority().val()}:this.getValue()}hash(){if(null===this.lazyHash_){let t="";this.priorityNode_.isEmpty()||(t+="priority:"+Zp(this.priorityNode_.val())+":");const e=typeof this.value_;t+=e+":",t+="number"===e?Yd(this.value_):this.value_,this.lazyHash_=Cd(t)}return this.lazyHash_}getValue(){return this.value_}compareTo(t){return t===sf.__childrenNodeConstructor.EMPTY_NODE?1:t instanceof sf.__childrenNodeConstructor?-1:(uc(t.isLeafNode(),"Unknown node type"),this.compareToLeafNode_(t))}compareToLeafNode_(t){const e=typeof t.value_,n=typeof this.value_,i=sf.VALUE_TYPE_ORDER.indexOf(e),s=sf.VALUE_TYPE_ORDER.indexOf(n);return uc(i>=0,"Unknown leaf type: "+e),uc(s>=0,"Unknown leaf type: "+n),i===s?"object"===n?0:this.value_<t.value_?-1:this.value_===t.value_?0:1:s-i}withIndex(){return this}isIndexed(){return!0}equals(t){if(t===this)return!0;if(t.isLeafNode()){const e=t;return this.value_===e.value_&&this.priorityNode_.equals(e.priorityNode_)}return!1}}function rf(t){ef=t}function of(t){nf=t}sf.VALUE_TYPE_ORDER=["object","boolean","number","string"];class af extends Wp{compare(t,e){const n=t.node.getPriority(),i=e.node.getPriority(),s=n.compareTo(i);return 0===s?Fd(t.name,e.name):s}isDefinedOn(t){return!t.getPriority().isEmpty()}indexedValueChanged(t,e){return!t.getPriority().equals(e.getPriority())}minPost(){return Bp.MIN}maxPost(){return new Bp(Rd,new sf("[PRIORITY-POST]",nf))}makePost(t,e){const n=ef(t);return new Bp(e,new sf("[PRIORITY-POST]",n))}toString(){return".priority"}}const hf=new af,cf=Math.log(2);
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class lf{constructor(t){const e=t=>parseInt(Math.log(t)/cf,10),n=t=>parseInt(Array(t+1).join("1"),2);this.count=e(t+1),this.current_=this.count-1;const i=n(this.count);this.bits_=t+1&i}nextBitIsOne(){const t=!(this.bits_&1<<this.current_);return this.current_--,t}}const uf=function(t,e,n,i){t.sort(e);const s=function(e,i){const r=i-e;let o,a;if(0===r)return null;if(1===r)return o=t[e],a=n?n(o):o,new Vp(a,o.node,Vp.BLACK,null,null);{const h=parseInt(r/2,10)+e,c=s(e,h),l=s(h+1,i);return o=t[h],a=n?n(o):o,new Vp(a,o.node,Vp.BLACK,c,l)}},r=function(e){let i=null,r=null,o=t.length;const a=function(e,i){const r=o-e,a=o;o-=e;const c=s(r+1,a),l=t[r],u=n?n(l):l;h(new Vp(u,l.node,i,null,c))},h=function(t){i?(i.left=t,i=t):(r=t,i=t)};for(let t=0;t<e.count;++t){const n=e.nextBitIsOne(),i=Math.pow(2,e.count-(t+1));n?a(i,Vp.BLACK):(a(i,Vp.BLACK),a(i,Vp.RED))}return r},o=new lf(t.length),a=r(o);return new zp(i||e,a)};
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let df;const gf={};class pf{static get Default(){return uc(gf&&hf,"ChildrenNode.ts has not been loaded"),df=df||new pf({".priority":gf},{".priority":hf}),df}constructor(t,e){this.indexes_=t,this.indexSet_=e}get(t){const e=il(this.indexes_,t);if(!e)throw new Error("No index defined for "+t);return e instanceof zp?e:null}hasIndex(t){return nl(this.indexSet_,t.toString())}addIndex(t,e){uc(t!==Xp,"KeyIndex always exists and isn't meant to be added to the IndexMap.");const n=[];let i=!1;const s=e.getIterator(Bp.Wrap);let r,o=s.getNext();while(o)i=i||t.isDefinedOn(o.node),n.push(o),o=s.getNext();r=i?uf(n,t.getCompare()):gf;const a=t.toString(),h=Object.assign({},this.indexSet_);h[a]=t;const c=Object.assign({},this.indexes_);return c[a]=r,new pf(c,h)}addToIndexes(t,e){const n=rl(this.indexes_,((n,i)=>{const s=il(this.indexSet_,i);if(uc(s,"Missing index implementation for "+i),n===gf){if(s.isDefinedOn(t.node)){const n=[],i=e.getIterator(Bp.Wrap);let r=i.getNext();while(r)r.name!==t.name&&n.push(r),r=i.getNext();return n.push(t),uf(n,s.getCompare())}return gf}{const i=e.get(t.name);let s=n;return i&&(s=s.remove(new Bp(t.name,i))),s.insert(t,t.node)}}));return new pf(n,this.indexSet_)}removeFromIndexes(t,e){const n=rl(this.indexes_,(n=>{if(n===gf)return n;{const i=e.get(t.name);return i?n.remove(new Bp(t.name,i)):n}}));return new pf(n,this.indexSet_)}}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let ff;class mf{static get EMPTY_NODE(){return ff||(ff=new mf(new zp(Kp),null,pf.Default))}constructor(t,e,n){this.children_=t,this.priorityNode_=e,this.indexMap_=n,this.lazyHash_=null,this.priorityNode_&&$p(this.priorityNode_),this.children_.isEmpty()&&uc(!this.priorityNode_||this.priorityNode_.isEmpty(),"An empty node cannot have a priority")}isLeafNode(){return!1}getPriority(){return this.priorityNode_||ff}updatePriority(t){return this.children_.isEmpty()?this:new mf(this.children_,t,this.indexMap_)}getImmediateChild(t){if(".priority"===t)return this.getPriority();{const e=this.children_.get(t);return null===e?ff:e}}getChild(t){const e=gp(t);return null===e?this:this.getImmediateChild(e).getChild(fp(t))}hasChild(t){return null!==this.children_.get(t)}updateImmediateChild(t,e){if(uc(e,"We should always be passing snapshot nodes"),".priority"===t)return this.updatePriority(e);{const n=new Bp(t,e);let i,s;e.isEmpty()?(i=this.children_.remove(t),s=this.indexMap_.removeFromIndexes(n,this.children_)):(i=this.children_.insert(t,e),s=this.indexMap_.addToIndexes(n,this.children_));const r=i.isEmpty()?ff:this.priorityNode_;return new mf(i,r,s)}}updateChild(t,e){const n=gp(t);if(null===n)return e;{uc(".priority"!==gp(t)||1===pp(t),".priority must be the last token in a path");const i=this.getImmediateChild(n).updateChild(fp(t),e);return this.updateImmediateChild(n,i)}}isEmpty(){return this.children_.isEmpty()}numChildren(){return this.children_.count()}val(t){if(this.isEmpty())return null;const e={};let n=0,i=0,s=!0;if(this.forEachChild(hf,((r,o)=>{e[r]=o.val(t),n++,s&&mf.INTEGER_REGEXP_.test(r)?i=Math.max(i,Number(r)):s=!1})),!t&&s&&i<2*n){const t=[];for(const n in e)t[n]=e[n];return t}return t&&!this.getPriority().isEmpty()&&(e[".priority"]=this.getPriority().val()),e}hash(){if(null===this.lazyHash_){let t="";this.getPriority().isEmpty()||(t+="priority:"+Zp(this.getPriority().val())+":"),this.forEachChild(hf,((e,n)=>{const i=n.hash();""!==i&&(t+=":"+e+":"+i)})),this.lazyHash_=""===t?"":Cd(t)}return this.lazyHash_}getPredecessorChildName(t,e,n){const i=this.resolveIndex_(n);if(i){const n=i.getPredecessorKey(new Bp(t,e));return n?n.name:null}return this.children_.getPredecessorKey(t)}getFirstChildName(t){const e=this.resolveIndex_(t);if(e){const t=e.minKey();return t&&t.name}return this.children_.minKey()}getFirstChild(t){const e=this.getFirstChildName(t);return e?new Bp(e,this.children_.get(e)):null}getLastChildName(t){const e=this.resolveIndex_(t);if(e){const t=e.maxKey();return t&&t.name}return this.children_.maxKey()}getLastChild(t){const e=this.getLastChildName(t);return e?new Bp(e,this.children_.get(e)):null}forEachChild(t,e){const n=this.resolveIndex_(t);return n?n.inorderTraversal((t=>e(t.name,t.node))):this.children_.inorderTraversal(e)}getIterator(t){return this.getIteratorFrom(t.minPost(),t)}getIteratorFrom(t,e){const n=this.resolveIndex_(e);if(n)return n.getIteratorFrom(t,(t=>t));{const n=this.children_.getIteratorFrom(t.name,Bp.Wrap);let i=n.peek();while(null!=i&&e.compare(i,t)<0)n.getNext(),i=n.peek();return n}}getReverseIterator(t){return this.getReverseIteratorFrom(t.maxPost(),t)}getReverseIteratorFrom(t,e){const n=this.resolveIndex_(e);if(n)return n.getReverseIteratorFrom(t,(t=>t));{const n=this.children_.getReverseIteratorFrom(t.name,Bp.Wrap);let i=n.peek();while(null!=i&&e.compare(i,t)>0)n.getNext(),i=n.peek();return n}}compareTo(t){return this.isEmpty()?t.isEmpty()?0:-1:t.isLeafNode()||t.isEmpty()?1:t===vf?-1:0}withIndex(t){if(t===Xp||this.indexMap_.hasIndex(t))return this;{const e=this.indexMap_.addIndex(t,this.children_);return new mf(this.children_,this.priorityNode_,e)}}isIndexed(t){return t===Xp||this.indexMap_.hasIndex(t)}equals(t){if(t===this)return!0;if(t.isLeafNode())return!1;{const e=t;if(this.getPriority().equals(e.getPriority())){if(this.children_.count()===e.children_.count()){const t=this.getIterator(hf),n=e.getIterator(hf);let i=t.getNext(),s=n.getNext();while(i&&s){if(i.name!==s.name||!i.node.equals(s.node))return!1;i=t.getNext(),s=n.getNext()}return null===i&&null===s}return!1}return!1}}resolveIndex_(t){return t===Xp?null:this.indexMap_.get(t.toString())}}mf.INTEGER_REGEXP_=/^(0|[1-9]\d*)$/;class _f extends mf{constructor(){super(new zp(Kp),mf.EMPTY_NODE,pf.Default)}compareTo(t){return t===this?0:1}equals(t){return t===this}getPriority(){return this}getImmediateChild(t){return mf.EMPTY_NODE}isEmpty(){return!1}}const vf=new _f;Object.defineProperties(Bp,{MIN:{value:new Bp(Md,mf.EMPTY_NODE)},MAX:{value:new Bp(Rd,vf)}}),Up.__EMPTY_NODE=mf.EMPTY_NODE,sf.__childrenNodeConstructor=mf,Jp(vf),of(vf);
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
const yf=!0;function Cf(t,e=null){if(null===t)return mf.EMPTY_NODE;if("object"===typeof t&&".priority"in t&&(e=t[".priority"]),uc(null===e||"string"===typeof e||"number"===typeof e||"object"===typeof e&&".sv"in e,"Invalid priority type found: "+typeof e),"object"===typeof t&&".value"in t&&null!==t[".value"]&&(t=t[".value"]),"object"!==typeof t||".sv"in t){const n=t;return new sf(n,Cf(e))}if(t instanceof Array||!yf){let n=mf.EMPTY_NODE;return Wd(t,((e,i)=>{if(nl(t,e)&&"."!==e.substring(0,1)){const t=Cf(i);!t.isLeafNode()&&t.isEmpty()||(n=n.updateImmediateChild(e,t))}})),n.updatePriority(Cf(e))}{const n=[];let i=!1;const s=t;if(Wd(s,((t,e)=>{if("."!==t.substring(0,1)){const s=Cf(e);s.isEmpty()||(i=i||!s.getPriority().isEmpty(),n.push(new Bp(t,s)))}})),0===n.length)return mf.EMPTY_NODE;const r=uf(n,qp,(t=>t.name),Kp);if(i){const t=uf(n,hf.getCompare());return new mf(r,Cf(e),new pf({".priority":t},{".priority":hf}))}return new mf(r,Cf(e),pf.Default)}}rf(Cf);
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
class bf extends Wp{constructor(t){super(),this.indexPath_=t,uc(!bp(t)&&".priority"!==gp(t),"Can't create PathIndex with empty path or .priority key")}extractChild(t){return t.getChild(this.indexPath_)}isDefinedOn(t){return!t.getChild(this.indexPath_).isEmpty()}compare(t,e){const n=this.extractChild(t.node),i=this.extractChild(e.node),s=n.compareTo(i);return 0===s?Fd(t.name,e.name):s}makePost(t,e){const n=Cf(t),i=mf.EMPTY_NODE.updateChild(this.indexPath_,n);return new Bp(e,i)}maxPost(){const t=mf.EMPTY_NODE.updateChild(this.indexPath_,vf);return new Bp(Rd,t)}toString(){return vp(this.indexPath_,0).join("/")}}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class wf extends Wp{compare(t,e){const n=t.node.compareTo(e.node);return 0===n?Fd(t.name,e.name):n}isDefinedOn(t){return!0}indexedValueChanged(t,e){return!t.equals(e)}minPost(){return Bp.MIN}maxPost(){return Bp.MAX}makePost(t,e){const n=Cf(t);return new Bp(e,n)}toString(){return".value"}}const xf=new wf;
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Sf(t){return{type:"value",snapshotNode:t}}function Tf(t,e){return{type:"child_added",snapshotNode:e,childName:t}}function Ef(t,e){return{type:"child_removed",snapshotNode:e,childName:t}}function kf(t,e,n){return{type:"child_changed",snapshotNode:e,childName:t,oldSnap:n}}function Af(t,e){return{type:"child_moved",snapshotNode:e,childName:t}}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Of{constructor(t){this.index_=t}updateChild(t,e,n,i,s,r){uc(t.isIndexed(this.index_),"A node must be indexed if only a child is updated");const o=t.getImmediateChild(e);return o.getChild(i).equals(n.getChild(i))&&o.isEmpty()===n.isEmpty()?t:(null!=r&&(n.isEmpty()?t.hasChild(e)?r.trackChildChange(Ef(e,o)):uc(t.isLeafNode(),"A child remove without an old child only makes sense on a leaf node"):o.isEmpty()?r.trackChildChange(Tf(e,n)):r.trackChildChange(kf(e,n,o))),t.isLeafNode()&&n.isEmpty()?t:t.updateImmediateChild(e,n).withIndex(this.index_))}updateFullNode(t,e,n){return null!=n&&(t.isLeafNode()||t.forEachChild(hf,((t,i)=>{e.hasChild(t)||n.trackChildChange(Ef(t,i))})),e.isLeafNode()||e.forEachChild(hf,((e,i)=>{if(t.hasChild(e)){const s=t.getImmediateChild(e);s.equals(i)||n.trackChildChange(kf(e,i,s))}else n.trackChildChange(Tf(e,i))}))),e.withIndex(this.index_)}updatePriority(t,e){return t.isEmpty()?mf.EMPTY_NODE:t.updatePriority(e)}filtersNodes(){return!1}getIndexedFilter(){return this}getIndex(){return this.index_}}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Df{constructor(t){this.indexedFilter_=new Of(t.getIndex()),this.index_=t.getIndex(),this.startPost_=Df.getStartPost_(t),this.endPost_=Df.getEndPost_(t),this.startIsInclusive_=!t.startAfterSet_,this.endIsInclusive_=!t.endBeforeSet_}getStartPost(){return this.startPost_}getEndPost(){return this.endPost_}matches(t){const e=this.startIsInclusive_?this.index_.compare(this.getStartPost(),t)<=0:this.index_.compare(this.getStartPost(),t)<0,n=this.endIsInclusive_?this.index_.compare(t,this.getEndPost())<=0:this.index_.compare(t,this.getEndPost())<0;return e&&n}updateChild(t,e,n,i,s,r){return this.matches(new Bp(e,n))||(n=mf.EMPTY_NODE),this.indexedFilter_.updateChild(t,e,n,i,s,r)}updateFullNode(t,e,n){e.isLeafNode()&&(e=mf.EMPTY_NODE);let i=e.withIndex(this.index_);i=i.updatePriority(mf.EMPTY_NODE);const s=this;return e.forEachChild(hf,((t,e)=>{s.matches(new Bp(t,e))||(i=i.updateImmediateChild(t,mf.EMPTY_NODE))})),this.indexedFilter_.updateFullNode(t,i,n)}updatePriority(t,e){return t}filtersNodes(){return!0}getIndexedFilter(){return this.indexedFilter_}getIndex(){return this.index_}static getStartPost_(t){if(t.hasStart()){const e=t.getIndexStartName();return t.getIndex().makePost(t.getIndexStartValue(),e)}return t.getIndex().minPost()}static getEndPost_(t){if(t.hasEnd()){const e=t.getIndexEndName();return t.getIndex().makePost(t.getIndexEndValue(),e)}return t.getIndex().maxPost()}}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class If{constructor(t){this.withinDirectionalStart=t=>this.reverse_?this.withinEndPost(t):this.withinStartPost(t),this.withinDirectionalEnd=t=>this.reverse_?this.withinStartPost(t):this.withinEndPost(t),this.withinStartPost=t=>{const e=this.index_.compare(this.rangedFilter_.getStartPost(),t);return this.startIsInclusive_?e<=0:e<0},this.withinEndPost=t=>{const e=this.index_.compare(t,this.rangedFilter_.getEndPost());return this.endIsInclusive_?e<=0:e<0},this.rangedFilter_=new Df(t),this.index_=t.getIndex(),this.limit_=t.getLimit(),this.reverse_=!t.isViewFromLeft(),this.startIsInclusive_=!t.startAfterSet_,this.endIsInclusive_=!t.endBeforeSet_}updateChild(t,e,n,i,s,r){return this.rangedFilter_.matches(new Bp(e,n))||(n=mf.EMPTY_NODE),t.getImmediateChild(e).equals(n)?t:t.numChildren()<this.limit_?this.rangedFilter_.getIndexedFilter().updateChild(t,e,n,i,s,r):this.fullLimitUpdateChild_(t,e,n,s,r)}updateFullNode(t,e,n){let i;if(e.isLeafNode()||e.isEmpty())i=mf.EMPTY_NODE.withIndex(this.index_);else if(2*this.limit_<e.numChildren()&&e.isIndexed(this.index_)){let t;i=mf.EMPTY_NODE.withIndex(this.index_),t=this.reverse_?e.getReverseIteratorFrom(this.rangedFilter_.getEndPost(),this.index_):e.getIteratorFrom(this.rangedFilter_.getStartPost(),this.index_);let n=0;while(t.hasNext()&&n<this.limit_){const e=t.getNext();if(this.withinDirectionalStart(e)){if(!this.withinDirectionalEnd(e))break;i=i.updateImmediateChild(e.name,e.node),n++}}}else{let t;i=e.withIndex(this.index_),i=i.updatePriority(mf.EMPTY_NODE),t=this.reverse_?i.getReverseIterator(this.index_):i.getIterator(this.index_);let n=0;while(t.hasNext()){const e=t.getNext(),s=n<this.limit_&&this.withinDirectionalStart(e)&&this.withinDirectionalEnd(e);s?n++:i=i.updateImmediateChild(e.name,mf.EMPTY_NODE)}}return this.rangedFilter_.getIndexedFilter().updateFullNode(t,i,n)}updatePriority(t,e){return t}filtersNodes(){return!0}getIndexedFilter(){return this.rangedFilter_.getIndexedFilter()}getIndex(){return this.index_}fullLimitUpdateChild_(t,e,n,i,s){let r;if(this.reverse_){const t=this.index_.getCompare();r=(e,n)=>t(n,e)}else r=this.index_.getCompare();const o=t;uc(o.numChildren()===this.limit_,"");const a=new Bp(e,n),h=this.reverse_?o.getFirstChild(this.index_):o.getLastChild(this.index_),c=this.rangedFilter_.matches(a);if(o.hasChild(e)){const t=o.getImmediateChild(e);let l=i.getChildAfterChild(this.index_,h,this.reverse_);while(null!=l&&(l.name===e||o.hasChild(l.name)))l=i.getChildAfterChild(this.index_,l,this.reverse_);const u=null==l?1:r(l,a),d=c&&!n.isEmpty()&&u>=0;if(d)return null!=s&&s.trackChildChange(kf(e,n,t)),o.updateImmediateChild(e,n);{null!=s&&s.trackChildChange(Ef(e,t));const n=o.updateImmediateChild(e,mf.EMPTY_NODE),i=null!=l&&this.rangedFilter_.matches(l);return i?(null!=s&&s.trackChildChange(Tf(l.name,l.node)),n.updateImmediateChild(l.name,l.node)):n}}return n.isEmpty()?t:c&&r(h,a)>=0?(null!=s&&(s.trackChildChange(Ef(h.name,h.node)),s.trackChildChange(Tf(e,n))),o.updateImmediateChild(e,n).updateImmediateChild(h.name,mf.EMPTY_NODE)):t}}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Pf{constructor(){this.limitSet_=!1,this.startSet_=!1,this.startNameSet_=!1,this.startAfterSet_=!1,this.endSet_=!1,this.endNameSet_=!1,this.endBeforeSet_=!1,this.limit_=0,this.viewFrom_="",this.indexStartValue_=null,this.indexStartName_="",this.indexEndValue_=null,this.indexEndName_="",this.index_=hf}hasStart(){return this.startSet_}isViewFromLeft(){return""===this.viewFrom_?this.startSet_:"l"===this.viewFrom_}getIndexStartValue(){return uc(this.startSet_,"Only valid if start has been set"),this.indexStartValue_}getIndexStartName(){return uc(this.startSet_,"Only valid if start has been set"),this.startNameSet_?this.indexStartName_:Md}hasEnd(){return this.endSet_}getIndexEndValue(){return uc(this.endSet_,"Only valid if end has been set"),this.indexEndValue_}getIndexEndName(){return uc(this.endSet_,"Only valid if end has been set"),this.endNameSet_?this.indexEndName_:Rd}hasLimit(){return this.limitSet_}hasAnchoredLimit(){return this.limitSet_&&""!==this.viewFrom_}getLimit(){return uc(this.limitSet_,"Only valid if limit has been set"),this.limit_}getIndex(){return this.index_}loadsAllData(){return!(this.startSet_||this.endSet_||this.limitSet_)}isDefault(){return this.loadsAllData()&&this.index_===hf}copy(){const t=new Pf;return t.limitSet_=this.limitSet_,t.limit_=this.limit_,t.startSet_=this.startSet_,t.startAfterSet_=this.startAfterSet_,t.indexStartValue_=this.indexStartValue_,t.startNameSet_=this.startNameSet_,t.indexStartName_=this.indexStartName_,t.endSet_=this.endSet_,t.endBeforeSet_=this.endBeforeSet_,t.indexEndValue_=this.indexEndValue_,t.endNameSet_=this.endNameSet_,t.indexEndName_=this.indexEndName_,t.index_=this.index_,t.viewFrom_=this.viewFrom_,t}}function Mf(t){return t.loadsAllData()?new Of(t.getIndex()):t.hasLimit()?new If(t):new Df(t)}function Rf(t){const e={};if(t.isDefault())return e;let n;if(t.index_===hf?n="$priority":t.index_===xf?n="$value":t.index_===Xp?n="$key":(uc(t.index_ instanceof bf,"Unrecognized index type!"),n=t.index_.toString()),e["orderBy"]=Zc(n),t.startSet_){const n=t.startAfterSet_?"startAfter":"startAt";e[n]=Zc(t.indexStartValue_),t.startNameSet_&&(e[n]+=","+Zc(t.indexStartName_))}if(t.endSet_){const n=t.endBeforeSet_?"endBefore":"endAt";e[n]=Zc(t.indexEndValue_),t.endNameSet_&&(e[n]+=","+Zc(t.indexEndName_))}return t.limitSet_&&(t.isViewFromLeft()?e["limitToFirst"]=t.limit_:e["limitToLast"]=t.limit_),e}function Ff(t){const e={};if(t.startSet_&&(e["sp"]=t.indexStartValue_,t.startNameSet_&&(e["sn"]=t.indexStartName_),e["sin"]=!t.startAfterSet_),t.endSet_&&(e["ep"]=t.indexEndValue_,t.endNameSet_&&(e["en"]=t.indexEndName_),e["ein"]=!t.endBeforeSet_),t.limitSet_){e["l"]=t.limit_;let n=t.viewFrom_;""===n&&(n=t.isViewFromLeft()?"l":"r"),e["vf"]=n}return t.index_!==hf&&(e["i"]=t.index_.toString()),e}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Lf extends op{reportStats(t){throw new Error("Method not implemented.")}static getListenId_(t,e){return void 0!==e?"tag$"+e:(uc(t._queryParams.isDefault(),"should have a tag if it's not a default query."),t._path.toString())}constructor(t,e,n,i){super(),this.repoInfo_=t,this.onDataUpdate_=e,this.authTokenProvider_=n,this.appCheckTokenProvider_=i,this.log_=Ed("p:rest:"),this.listens_={}}listen(t,e,n,i){const s=t._path.toString();this.log_("Listen called for "+s+" "+t._queryIdentifier);const r=Lf.getListenId_(t,n),o={};this.listens_[r]=o;const a=Rf(t._queryParams);this.restRequest_(s+".json",a,((t,e)=>{let a=e;if(404===t&&(a=null,t=null),null===t&&this.onDataUpdate_(s,a,!1,n),il(this.listens_,r)===o){let e;e=t?401===t?"permission_denied":"rest_error:"+t:"ok",i(e,null)}}))}unlisten(t,e){const n=Lf.getListenId_(t,e);delete this.listens_[n]}get(t){const e=Rf(t._queryParams),n=t._path.toString(),i=new Ic;return this.restRequest_(n+".json",e,((t,e)=>{let s=e;404===t&&(s=null,t=null),null===t?(this.onDataUpdate_(n,s,!1,null),i.resolve(s)):i.reject(new Error(s))})),i.promise}refreshAuthToken(t){}restRequest_(t,e={},n){return e["format"]="export",Promise.all([this.authTokenProvider_.getToken(!1),this.appCheckTokenProvider_.getToken(!1)]).then((([i,s])=>{i&&i.accessToken&&(e["auth"]=i.accessToken),s&&s.token&&(e["ac"]=s.token);const r=(this.repoInfo_.secure?"https://":"http://")+this.repoInfo_.host+t+"?ns="+this.repoInfo_.namespace+hl(e);this.log_("Sending REST request for "+r);const o=new XMLHttpRequest;o.onreadystatechange=()=>{if(n&&4===o.readyState){this.log_("REST Response for "+r+" received. status:",o.status,"response:",o.responseText);let t=null;if(o.status>=200&&o.status<300){try{t=Jc(o.responseText)}catch(k){Od("Failed to parse JSON response for "+r+": "+o.responseText)}n(null,t)}else 401!==o.status&&404!==o.status&&Od("Got unsuccessful REST response for "+r+" Status: "+o.status),n(o.status);n=null}},o.open("GET",r,!0),o.send()}))}}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class jf{constructor(){this.rootNode_=mf.EMPTY_NODE}getNode(t){return this.rootNode_.getChild(t)}updateSnapshot(t,e){this.rootNode_=this.rootNode_.updateChild(t,e)}}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Nf(){return{value:null,children:new Map}}function Bf(t,e,n){if(bp(e))t.value=n,t.children.clear();else if(null!==t.value)t.value=t.value.updateChild(e,n);else{const i=gp(e);t.children.has(i)||t.children.set(i,Nf());const s=t.children.get(i);e=fp(e),Bf(s,e,n)}}function Wf(t,e,n){null!==t.value?n(e,t.value):Yf(t,((t,i)=>{const s=new up(e.toString()+"/"+t);Wf(i,s,n)}))}function Yf(t,e){t.children.forEach(((t,n)=>{e(n,t)}))}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Uf{constructor(t){this.collection_=t,this.last_=null}get(){const t=this.collection_.get(),e=Object.assign({},t);return this.last_&&Wd(this.last_,((t,n)=>{e[t]=e[t]-n})),this.last_=t,e}}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Xf=1e4,Gf=3e4,Vf=3e5;class Hf{constructor(t,e){this.server_=e,this.statsToReport_={},this.statsListener_=new Uf(t);const n=Xf+(Gf-Xf)*Math.random();Jd(this.reportStats_.bind(this),Math.floor(n))}reportStats_(){const t=this.statsListener_.get(),e={};let n=!1;Wd(t,((t,i)=>{i>0&&nl(this.statsToReport_,t)&&(e[t]=i,n=!0)})),n&&this.server_.reportStats(e),Jd(this.reportStats_.bind(this),Math.floor(2*Math.random()*Vf))}}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var zf;function qf(){return{fromUser:!0,fromServer:!1,queryId:null,tagged:!1}}function Kf(){return{fromUser:!1,fromServer:!0,queryId:null,tagged:!1}}function Qf(t){return{fromUser:!1,fromServer:!0,queryId:t,tagged:!0}}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */(function(t){t[t["OVERWRITE"]=0]="OVERWRITE",t[t["MERGE"]=1]="MERGE",t[t["ACK_USER_WRITE"]=2]="ACK_USER_WRITE",t[t["LISTEN_COMPLETE"]=3]="LISTEN_COMPLETE"})(zf||(zf={}));class Jf{constructor(t,e,n){this.path=t,this.affectedTree=e,this.revert=n,this.type=zf.ACK_USER_WRITE,this.source=qf()}operationForChild(t){if(bp(this.path)){if(null!=this.affectedTree.value)return uc(this.affectedTree.children.isEmpty(),"affectedTree should not have overlapping affected paths."),this;{const e=this.affectedTree.subtree(new up(t));return new Jf(dp(),e,this.revert)}}return uc(gp(this.path)===t,"operationForChild called for unrelated child."),new Jf(fp(this.path),this.affectedTree,this.revert)}}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Zf{constructor(t,e){this.source=t,this.path=e,this.type=zf.LISTEN_COMPLETE}operationForChild(t){return bp(this.path)?new Zf(this.source,dp()):new Zf(this.source,fp(this.path))}}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class $f{constructor(t,e,n){this.source=t,this.path=e,this.snap=n,this.type=zf.OVERWRITE}operationForChild(t){return bp(this.path)?new $f(this.source,dp(),this.snap.getImmediateChild(t)):new $f(this.source,fp(this.path),this.snap)}}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class tm{constructor(t,e,n){this.source=t,this.path=e,this.children=n,this.type=zf.MERGE}operationForChild(t){if(bp(this.path)){const e=this.children.subtree(new up(t));return e.isEmpty()?null:e.value?new $f(this.source,dp(),e.value):new tm(this.source,dp(),e)}return uc(gp(this.path)===t,"Can't get a merge for a child not on the path of the operation"),new tm(this.source,fp(this.path),this.children)}toString(){return"Operation("+this.path+": "+this.source.toString()+" merge: "+this.children.toString()+")"}}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class em{constructor(t,e,n){this.node_=t,this.fullyInitialized_=e,this.filtered_=n}isFullyInitialized(){return this.fullyInitialized_}isFiltered(){return this.filtered_}isCompleteForPath(t){if(bp(t))return this.isFullyInitialized()&&!this.filtered_;const e=gp(t);return this.isCompleteForChild(e)}isCompleteForChild(t){return this.isFullyInitialized()&&!this.filtered_||this.node_.hasChild(t)}getNode(){return this.node_}}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class nm{constructor(t){this.query_=t,this.index_=this.query_._queryParams.getIndex()}}function im(t,e,n,i){const s=[],r=[];return e.forEach((e=>{"child_changed"===e.type&&t.index_.indexedValueChanged(e.oldSnap,e.snapshotNode)&&r.push(Af(e.childName,e.snapshotNode))})),sm(t,s,"child_removed",e,i,n),sm(t,s,"child_added",e,i,n),sm(t,s,"child_moved",r,i,n),sm(t,s,"child_changed",e,i,n),sm(t,s,"value",e,i,n),s}function sm(t,e,n,i,s,r){const o=i.filter((t=>t.type===n));o.sort(((e,n)=>om(t,e,n))),o.forEach((n=>{const i=rm(t,n,r);s.forEach((s=>{s.respondsTo(n.type)&&e.push(s.createEvent(i,t.query_))}))}))}function rm(t,e,n){return"value"===e.type||"child_removed"===e.type||(e.prevName=n.getPredecessorChildName(e.childName,e.snapshotNode,t.index_)),e}function om(t,e,n){if(null==e.childName||null==n.childName)throw dc("Should only compare child_ events.");const i=new Bp(e.childName,e.snapshotNode),s=new Bp(n.childName,n.snapshotNode);return t.index_.compare(i,s)}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function am(t,e){return{eventCache:t,serverCache:e}}function hm(t,e,n,i){return am(new em(e,n,i),t.serverCache)}function cm(t,e,n,i){return am(t.eventCache,new em(e,n,i))}function lm(t){return t.eventCache.isFullyInitialized()?t.eventCache.getNode():null}function um(t){return t.serverCache.isFullyInitialized()?t.serverCache.getNode():null}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let dm;const gm=()=>(dm||(dm=new zp(Ld)),dm);class pm{static fromObject(t){let e=new pm(null);return Wd(t,((t,n)=>{e=e.set(new up(t),n)})),e}constructor(t,e=gm()){this.value=t,this.children=e}isEmpty(){return null===this.value&&this.children.isEmpty()}findRootMostMatchingPathAndValue(t,e){if(null!=this.value&&e(this.value))return{path:dp(),value:this.value};if(bp(t))return null;{const n=gp(t),i=this.children.get(n);if(null!==i){const s=i.findRootMostMatchingPathAndValue(fp(t),e);if(null!=s){const t=Cp(new up(n),s.path);return{path:t,value:s.value}}return null}return null}}findRootMostValueAndPath(t){return this.findRootMostMatchingPathAndValue(t,(()=>!0))}subtree(t){if(bp(t))return this;{const e=gp(t),n=this.children.get(e);return null!==n?n.subtree(fp(t)):new pm(null)}}set(t,e){if(bp(t))return new pm(e,this.children);{const n=gp(t),i=this.children.get(n)||new pm(null),s=i.set(fp(t),e),r=this.children.insert(n,s);return new pm(this.value,r)}}remove(t){if(bp(t))return this.children.isEmpty()?new pm(null):new pm(null,this.children);{const e=gp(t),n=this.children.get(e);if(n){const i=n.remove(fp(t));let s;return s=i.isEmpty()?this.children.remove(e):this.children.insert(e,i),null===this.value&&s.isEmpty()?new pm(null):new pm(this.value,s)}return this}}get(t){if(bp(t))return this.value;{const e=gp(t),n=this.children.get(e);return n?n.get(fp(t)):null}}setTree(t,e){if(bp(t))return e;{const n=gp(t),i=this.children.get(n)||new pm(null),s=i.setTree(fp(t),e);let r;return r=s.isEmpty()?this.children.remove(n):this.children.insert(n,s),new pm(this.value,r)}}fold(t){return this.fold_(dp(),t)}fold_(t,e){const n={};return this.children.inorderTraversal(((i,s)=>{n[i]=s.fold_(Cp(t,i),e)})),e(t,this.value,n)}findOnPath(t,e){return this.findOnPath_(t,dp(),e)}findOnPath_(t,e,n){const i=!!this.value&&n(e,this.value);if(i)return i;if(bp(t))return null;{const i=gp(t),s=this.children.get(i);return s?s.findOnPath_(fp(t),Cp(e,i),n):null}}foreachOnPath(t,e){return this.foreachOnPath_(t,dp(),e)}foreachOnPath_(t,e,n){if(bp(t))return this;{this.value&&n(e,this.value);const i=gp(t),s=this.children.get(i);return s?s.foreachOnPath_(fp(t),Cp(e,i),n):new pm(null)}}foreach(t){this.foreach_(dp(),t)}foreach_(t,e){this.children.inorderTraversal(((n,i)=>{i.foreach_(Cp(t,n),e)})),this.value&&e(t,this.value)}foreachChild(t){this.children.inorderTraversal(((e,n)=>{n.value&&t(e,n.value)}))}}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class fm{constructor(t){this.writeTree_=t}static empty(){return new fm(new pm(null))}}function mm(t,e,n){if(bp(e))return new fm(new pm(n));{const i=t.writeTree_.findRootMostValueAndPath(e);if(null!=i){const s=i.path;let r=i.value;const o=wp(s,e);return r=r.updateChild(o,n),new fm(t.writeTree_.set(s,r))}{const i=new pm(n),s=t.writeTree_.setTree(e,i);return new fm(s)}}}function _m(t,e,n){let i=t;return Wd(n,((t,n)=>{i=mm(i,Cp(e,t),n)})),i}function vm(t,e){if(bp(e))return fm.empty();{const n=t.writeTree_.setTree(e,new pm(null));return new fm(n)}}function ym(t,e){return null!=Cm(t,e)}function Cm(t,e){const n=t.writeTree_.findRootMostValueAndPath(e);return null!=n?t.writeTree_.get(n.path).getChild(wp(n.path,e)):null}function bm(t){const e=[],n=t.writeTree_.value;return null!=n?n.isLeafNode()||n.forEachChild(hf,((t,n)=>{e.push(new Bp(t,n))})):t.writeTree_.children.inorderTraversal(((t,n)=>{null!=n.value&&e.push(new Bp(t,n.value))})),e}function wm(t,e){if(bp(e))return t;{const n=Cm(t,e);return new fm(null!=n?new pm(n):t.writeTree_.subtree(e))}}function xm(t){return t.writeTree_.isEmpty()}function Sm(t,e){return Tm(dp(),t.writeTree_,e)}function Tm(t,e,n){if(null!=e.value)return n.updateChild(t,e.value);{let i=null;return e.children.inorderTraversal(((e,s)=>{".priority"===e?(uc(null!==s.value,"Priority writes must always be leaf nodes"),i=s.value):n=Tm(Cp(t,e),s,n)})),n.getChild(t).isEmpty()||null===i||(n=n.updateChild(Cp(t,".priority"),i)),n}}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Em(t,e){return qm(e,t)}function km(t,e,n,i,s){uc(i>t.lastWriteId,"Stacking an older write on top of newer ones"),void 0===s&&(s=!0),t.allWrites.push({path:e,snap:n,writeId:i,visible:s}),s&&(t.visibleWrites=mm(t.visibleWrites,e,n)),t.lastWriteId=i}function Am(t,e){for(let n=0;n<t.allWrites.length;n++){const i=t.allWrites[n];if(i.writeId===e)return i}return null}function Om(t,e){const n=t.allWrites.findIndex((t=>t.writeId===e));uc(n>=0,"removeWrite called with nonexistent writeId.");const i=t.allWrites[n];t.allWrites.splice(n,1);let s=i.visible,r=!1,o=t.allWrites.length-1;while(s&&o>=0){const e=t.allWrites[o];e.visible&&(o>=n&&Dm(e,i.path)?s=!1:Sp(i.path,e.path)&&(r=!0)),o--}if(s){if(r)return Im(t),!0;if(i.snap)t.visibleWrites=vm(t.visibleWrites,i.path);else{const e=i.children;Wd(e,(e=>{t.visibleWrites=vm(t.visibleWrites,Cp(i.path,e))}))}return!0}return!1}function Dm(t,e){if(t.snap)return Sp(t.path,e);for(const n in t.children)if(t.children.hasOwnProperty(n)&&Sp(Cp(t.path,n),e))return!0;return!1}function Im(t){t.visibleWrites=Mm(t.allWrites,Pm,dp()),t.allWrites.length>0?t.lastWriteId=t.allWrites[t.allWrites.length-1].writeId:t.lastWriteId=-1}function Pm(t){return t.visible}function Mm(t,e,n){let i=fm.empty();for(let s=0;s<t.length;++s){const r=t[s];if(e(r)){const t=r.path;let e;if(r.snap)Sp(n,t)?(e=wp(n,t),i=mm(i,e,r.snap)):Sp(t,n)&&(e=wp(t,n),i=mm(i,dp(),r.snap.getChild(e)));else{if(!r.children)throw dc("WriteRecord should have .snap or .children");if(Sp(n,t))e=wp(n,t),i=_m(i,e,r.children);else if(Sp(t,n))if(e=wp(t,n),bp(e))i=_m(i,dp(),r.children);else{const t=il(r.children,gp(e));if(t){const n=t.getChild(fp(e));i=mm(i,dp(),n)}}}}}return i}function Rm(t,e,n,i,s){if(i||s){const r=wm(t.visibleWrites,e);if(!s&&xm(r))return n;if(s||null!=n||ym(r,dp())){const r=function(t){return(t.visible||s)&&(!i||!~i.indexOf(t.writeId))&&(Sp(t.path,e)||Sp(e,t.path))},o=Mm(t.allWrites,r,e),a=n||mf.EMPTY_NODE;return Sm(o,a)}return null}{const i=Cm(t.visibleWrites,e);if(null!=i)return i;{const i=wm(t.visibleWrites,e);if(xm(i))return n;if(null!=n||ym(i,dp())){const t=n||mf.EMPTY_NODE;return Sm(i,t)}return null}}}function Fm(t,e,n){let i=mf.EMPTY_NODE;const s=Cm(t.visibleWrites,e);if(s)return s.isLeafNode()||s.forEachChild(hf,((t,e)=>{i=i.updateImmediateChild(t,e)})),i;if(n){const s=wm(t.visibleWrites,e);return n.forEachChild(hf,((t,e)=>{const n=Sm(wm(s,new up(t)),e);i=i.updateImmediateChild(t,n)})),bm(s).forEach((t=>{i=i.updateImmediateChild(t.name,t.node)})),i}{const n=wm(t.visibleWrites,e);return bm(n).forEach((t=>{i=i.updateImmediateChild(t.name,t.node)})),i}}function Lm(t,e,n,i,s){uc(i||s,"Either existingEventSnap or existingServerSnap must exist");const r=Cp(e,n);if(ym(t.visibleWrites,r))return null;{const e=wm(t.visibleWrites,r);return xm(e)?s.getChild(n):Sm(e,s.getChild(n))}}function jm(t,e,n,i){const s=Cp(e,n),r=Cm(t.visibleWrites,s);if(null!=r)return r;if(i.isCompleteForChild(n)){const e=wm(t.visibleWrites,s);return Sm(e,i.getNode().getImmediateChild(n))}return null}function Nm(t,e){return Cm(t.visibleWrites,e)}function Bm(t,e,n,i,s,r,o){let a;const h=wm(t.visibleWrites,e),c=Cm(h,dp());if(null!=c)a=c;else{if(null==n)return[];a=Sm(h,n)}if(a=a.withIndex(o),a.isEmpty()||a.isLeafNode())return[];{const t=[],e=o.getCompare(),n=r?a.getReverseIteratorFrom(i,o):a.getIteratorFrom(i,o);let h=n.getNext();while(h&&t.length<s)0!==e(h,i)&&t.push(h),h=n.getNext();return t}}function Wm(){return{visibleWrites:fm.empty(),allWrites:[],lastWriteId:-1}}function Ym(t,e,n,i){return Rm(t.writeTree,t.treePath,e,n,i)}function Um(t,e){return Fm(t.writeTree,t.treePath,e)}function Xm(t,e,n,i){return Lm(t.writeTree,t.treePath,e,n,i)}function Gm(t,e){return Nm(t.writeTree,Cp(t.treePath,e))}function Vm(t,e,n,i,s,r){return Bm(t.writeTree,t.treePath,e,n,i,s,r)}function Hm(t,e,n){return jm(t.writeTree,t.treePath,e,n)}function zm(t,e){return qm(Cp(t.treePath,e),t.writeTree)}function qm(t,e){return{treePath:t,writeTree:e}}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Km{constructor(){this.changeMap=new Map}trackChildChange(t){const e=t.type,n=t.childName;uc("child_added"===e||"child_changed"===e||"child_removed"===e,"Only child changes supported for tracking"),uc(".priority"!==n,"Only non-priority child changes can be tracked.");const i=this.changeMap.get(n);if(i){const s=i.type;if("child_added"===e&&"child_removed"===s)this.changeMap.set(n,kf(n,t.snapshotNode,i.snapshotNode));else if("child_removed"===e&&"child_added"===s)this.changeMap.delete(n);else if("child_removed"===e&&"child_changed"===s)this.changeMap.set(n,Ef(n,i.oldSnap));else if("child_changed"===e&&"child_added"===s)this.changeMap.set(n,Tf(n,t.snapshotNode));else{if("child_changed"!==e||"child_changed"!==s)throw dc("Illegal combination of changes: "+t+" occurred after "+i);this.changeMap.set(n,kf(n,t.snapshotNode,i.oldSnap))}}else this.changeMap.set(n,t)}getChanges(){return Array.from(this.changeMap.values())}}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Qm{getCompleteChild(t){return null}getChildAfterChild(t,e,n){return null}}const Jm=new Qm;class Zm{constructor(t,e,n=null){this.writes_=t,this.viewCache_=e,this.optCompleteServerCache_=n}getCompleteChild(t){const e=this.viewCache_.eventCache;if(e.isCompleteForChild(t))return e.getNode().getImmediateChild(t);{const e=null!=this.optCompleteServerCache_?new em(this.optCompleteServerCache_,!0,!1):this.viewCache_.serverCache;return Hm(this.writes_,t,e)}}getChildAfterChild(t,e,n){const i=null!=this.optCompleteServerCache_?this.optCompleteServerCache_:um(this.viewCache_),s=Vm(this.writes_,i,e,1,n,t);return 0===s.length?null:s[0]}}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function $m(t){return{filter:t}}function t_(t,e){uc(e.eventCache.getNode().isIndexed(t.filter.getIndex()),"Event snap not indexed"),uc(e.serverCache.getNode().isIndexed(t.filter.getIndex()),"Server snap not indexed")}function e_(t,e,n,i,s){const r=new Km;let o,a;if(n.type===zf.OVERWRITE){const h=n;h.source.fromUser?o=r_(t,e,h.path,h.snap,i,s,r):(uc(h.source.fromServer,"Unknown source."),a=h.source.tagged||e.serverCache.isFiltered()&&!bp(h.path),o=s_(t,e,h.path,h.snap,i,s,a,r))}else if(n.type===zf.MERGE){const h=n;h.source.fromUser?o=a_(t,e,h.path,h.children,i,s,r):(uc(h.source.fromServer,"Unknown source."),a=h.source.tagged||e.serverCache.isFiltered(),o=c_(t,e,h.path,h.children,i,s,a,r))}else if(n.type===zf.ACK_USER_WRITE){const a=n;o=a.revert?d_(t,e,a.path,i,s,r):l_(t,e,a.path,a.affectedTree,i,s,r)}else{if(n.type!==zf.LISTEN_COMPLETE)throw dc("Unknown operation type: "+n.type);o=u_(t,e,n.path,i,r)}const h=r.getChanges();return n_(e,o,h),{viewCache:o,changes:h}}function n_(t,e,n){const i=e.eventCache;if(i.isFullyInitialized()){const s=i.getNode().isLeafNode()||i.getNode().isEmpty(),r=lm(t);(n.length>0||!t.eventCache.isFullyInitialized()||s&&!i.getNode().equals(r)||!i.getNode().getPriority().equals(r.getPriority()))&&n.push(Sf(lm(e)))}}function i_(t,e,n,i,s,r){const o=e.eventCache;if(null!=Gm(i,n))return e;{let a,h;if(bp(n))if(uc(e.serverCache.isFullyInitialized(),"If change path is empty, we must have complete server data"),e.serverCache.isFiltered()){const n=um(e),s=n instanceof mf?n:mf.EMPTY_NODE,o=Um(i,s);a=t.filter.updateFullNode(e.eventCache.getNode(),o,r)}else{const n=Ym(i,um(e));a=t.filter.updateFullNode(e.eventCache.getNode(),n,r)}else{const c=gp(n);if(".priority"===c){uc(1===pp(n),"Can't have a priority with additional path components");const s=o.getNode();h=e.serverCache.getNode();const r=Xm(i,n,s,h);a=null!=r?t.filter.updatePriority(s,r):o.getNode()}else{const l=fp(n);let u;if(o.isCompleteForChild(c)){h=e.serverCache.getNode();const t=Xm(i,n,o.getNode(),h);u=null!=t?o.getNode().getImmediateChild(c).updateChild(l,t):o.getNode().getImmediateChild(c)}else u=Hm(i,c,e.serverCache);a=null!=u?t.filter.updateChild(o.getNode(),c,u,l,s,r):o.getNode()}}return hm(e,a,o.isFullyInitialized()||bp(n),t.filter.filtersNodes())}}function s_(t,e,n,i,s,r,o,a){const h=e.serverCache;let c;const l=o?t.filter:t.filter.getIndexedFilter();if(bp(n))c=l.updateFullNode(h.getNode(),i,null);else if(l.filtersNodes()&&!h.isFiltered()){const t=h.getNode().updateChild(n,i);c=l.updateFullNode(h.getNode(),t,null)}else{const t=gp(n);if(!h.isCompleteForPath(n)&&pp(n)>1)return e;const s=fp(n),r=h.getNode().getImmediateChild(t),o=r.updateChild(s,i);c=".priority"===t?l.updatePriority(h.getNode(),o):l.updateChild(h.getNode(),t,o,s,Jm,null)}const u=cm(e,c,h.isFullyInitialized()||bp(n),l.filtersNodes()),d=new Zm(s,u,r);return i_(t,u,n,s,d,a)}function r_(t,e,n,i,s,r,o){const a=e.eventCache;let h,c;const l=new Zm(s,e,r);if(bp(n))c=t.filter.updateFullNode(e.eventCache.getNode(),i,o),h=hm(e,c,!0,t.filter.filtersNodes());else{const s=gp(n);if(".priority"===s)c=t.filter.updatePriority(e.eventCache.getNode(),i),h=hm(e,c,a.isFullyInitialized(),a.isFiltered());else{const r=fp(n),c=a.getNode().getImmediateChild(s);let u;if(bp(r))u=i;else{const t=l.getCompleteChild(s);u=null!=t?".priority"===mp(r)&&t.getChild(yp(r)).isEmpty()?t:t.updateChild(r,i):mf.EMPTY_NODE}if(c.equals(u))h=e;else{const n=t.filter.updateChild(a.getNode(),s,u,r,l,o);h=hm(e,n,a.isFullyInitialized(),t.filter.filtersNodes())}}}return h}function o_(t,e){return t.eventCache.isCompleteForChild(e)}function a_(t,e,n,i,s,r,o){let a=e;return i.foreach(((i,h)=>{const c=Cp(n,i);o_(e,gp(c))&&(a=r_(t,a,c,h,s,r,o))})),i.foreach(((i,h)=>{const c=Cp(n,i);o_(e,gp(c))||(a=r_(t,a,c,h,s,r,o))})),a}function h_(t,e,n){return n.foreach(((t,n)=>{e=e.updateChild(t,n)})),e}function c_(t,e,n,i,s,r,o,a){if(e.serverCache.getNode().isEmpty()&&!e.serverCache.isFullyInitialized())return e;let h,c=e;h=bp(n)?i:new pm(null).setTree(n,i);const l=e.serverCache.getNode();return h.children.inorderTraversal(((n,i)=>{if(l.hasChild(n)){const h=e.serverCache.getNode().getImmediateChild(n),l=h_(t,h,i);c=s_(t,c,new up(n),l,s,r,o,a)}})),h.children.inorderTraversal(((n,i)=>{const h=!e.serverCache.isCompleteForChild(n)&&null===i.value;if(!l.hasChild(n)&&!h){const h=e.serverCache.getNode().getImmediateChild(n),l=h_(t,h,i);c=s_(t,c,new up(n),l,s,r,o,a)}})),c}function l_(t,e,n,i,s,r,o){if(null!=Gm(s,n))return e;const a=e.serverCache.isFiltered(),h=e.serverCache;if(null!=i.value){if(bp(n)&&h.isFullyInitialized()||h.isCompleteForPath(n))return s_(t,e,n,h.getNode().getChild(n),s,r,a,o);if(bp(n)){let i=new pm(null);return h.getNode().forEachChild(Xp,((t,e)=>{i=i.set(new up(t),e)})),c_(t,e,n,i,s,r,a,o)}return e}{let c=new pm(null);return i.foreach(((t,e)=>{const i=Cp(n,t);h.isCompleteForPath(i)&&(c=c.set(t,h.getNode().getChild(i)))})),c_(t,e,n,c,s,r,a,o)}}function u_(t,e,n,i,s){const r=e.serverCache,o=cm(e,r.getNode(),r.isFullyInitialized()||bp(n),r.isFiltered());return i_(t,o,n,i,Jm,s)}function d_(t,e,n,i,s,r){let o;if(null!=Gm(i,n))return e;{const a=new Zm(i,e,s),h=e.eventCache.getNode();let c;if(bp(n)||".priority"===gp(n)){let n;if(e.serverCache.isFullyInitialized())n=Ym(i,um(e));else{const t=e.serverCache.getNode();uc(t instanceof mf,"serverChildren would be complete if leaf node"),n=Um(i,t)}c=t.filter.updateFullNode(h,n,r)}else{const s=gp(n);let l=Hm(i,s,e.serverCache);null==l&&e.serverCache.isCompleteForChild(s)&&(l=h.getImmediateChild(s)),c=null!=l?t.filter.updateChild(h,s,l,fp(n),a,r):e.eventCache.getNode().hasChild(s)?t.filter.updateChild(h,s,mf.EMPTY_NODE,fp(n),a,r):h,c.isEmpty()&&e.serverCache.isFullyInitialized()&&(o=Ym(i,um(e)),o.isLeafNode()&&(c=t.filter.updateFullNode(c,o,r)))}return o=e.serverCache.isFullyInitialized()||null!=Gm(i,dp()),hm(e,c,o,t.filter.filtersNodes())}}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class g_{constructor(t,e){this.query_=t,this.eventRegistrations_=[];const n=this.query_._queryParams,i=new Of(n.getIndex()),s=Mf(n);this.processor_=$m(s);const r=e.serverCache,o=e.eventCache,a=i.updateFullNode(mf.EMPTY_NODE,r.getNode(),null),h=s.updateFullNode(mf.EMPTY_NODE,o.getNode(),null),c=new em(a,r.isFullyInitialized(),i.filtersNodes()),l=new em(h,o.isFullyInitialized(),s.filtersNodes());this.viewCache_=am(l,c),this.eventGenerator_=new nm(this.query_)}get query(){return this.query_}}function p_(t){return t.viewCache_.serverCache.getNode()}function f_(t,e){const n=um(t.viewCache_);return n&&(t.query._queryParams.loadsAllData()||!bp(e)&&!n.getImmediateChild(gp(e)).isEmpty())?n.getChild(e):null}function m_(t){return 0===t.eventRegistrations_.length}function __(t,e){t.eventRegistrations_.push(e)}function v_(t,e,n){const i=[];if(n){uc(null==e,"A cancel should cancel all event registrations.");const s=t.query._path;t.eventRegistrations_.forEach((t=>{const e=t.createCancelEvent(n,s);e&&i.push(e)}))}if(e){let n=[];for(let i=0;i<t.eventRegistrations_.length;++i){const s=t.eventRegistrations_[i];if(s.matches(e)){if(e.hasAnyCallback()){n=n.concat(t.eventRegistrations_.slice(i+1));break}}else n.push(s)}t.eventRegistrations_=n}else t.eventRegistrations_=[];return i}function y_(t,e,n,i){e.type===zf.MERGE&&null!==e.source.queryId&&(uc(um(t.viewCache_),"We should always have a full cache before handling merges"),uc(lm(t.viewCache_),"Missing event cache, even though we have a server cache"));const s=t.viewCache_,r=e_(t.processor_,s,e,n,i);return t_(t.processor_,r.viewCache),uc(r.viewCache.serverCache.isFullyInitialized()||!s.serverCache.isFullyInitialized(),"Once a server snap is complete, it should never go back"),t.viewCache_=r.viewCache,b_(t,r.changes,r.viewCache.eventCache.getNode(),null)}function C_(t,e){const n=t.viewCache_.eventCache,i=[];if(!n.getNode().isLeafNode()){const t=n.getNode();t.forEachChild(hf,((t,e)=>{i.push(Tf(t,e))}))}return n.isFullyInitialized()&&i.push(Sf(n.getNode())),b_(t,i,n.getNode(),e)}function b_(t,e,n,i){const s=i?[i]:t.eventRegistrations_;return im(t.eventGenerator_,e,n,s)}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let w_,x_;class S_{constructor(){this.views=new Map}}function T_(t){uc(!w_,"__referenceConstructor has already been defined"),w_=t}function E_(){return uc(w_,"Reference.ts has not been loaded"),w_}function k_(t){return 0===t.views.size}function A_(t,e,n,i){const s=e.source.queryId;if(null!==s){const r=t.views.get(s);return uc(null!=r,"SyncTree gave us an op for an invalid query."),y_(r,e,n,i)}{let s=[];for(const r of t.views.values())s=s.concat(y_(r,e,n,i));return s}}function O_(t,e,n,i,s){const r=e._queryIdentifier,o=t.views.get(r);if(!o){let t=Ym(n,s?i:null),r=!1;t?r=!0:i instanceof mf?(t=Um(n,i),r=!1):(t=mf.EMPTY_NODE,r=!1);const o=am(new em(t,r,!1),new em(i,s,!1));return new g_(e,o)}return o}function D_(t,e,n,i,s,r){const o=O_(t,e,i,s,r);return t.views.has(e._queryIdentifier)||t.views.set(e._queryIdentifier,o),__(o,n),C_(o,n)}function I_(t,e,n,i){const s=e._queryIdentifier,r=[];let o=[];const a=L_(t);if("default"===s)for(const[h,c]of t.views.entries())o=o.concat(v_(c,n,i)),m_(c)&&(t.views.delete(h),c.query._queryParams.loadsAllData()||r.push(c.query));else{const e=t.views.get(s);e&&(o=o.concat(v_(e,n,i)),m_(e)&&(t.views.delete(s),e.query._queryParams.loadsAllData()||r.push(e.query)))}return a&&!L_(t)&&r.push(new(E_())(e._repo,e._path)),{removed:r,events:o}}function P_(t){const e=[];for(const n of t.views.values())n.query._queryParams.loadsAllData()||e.push(n);return e}function M_(t,e){let n=null;for(const i of t.views.values())n=n||f_(i,e);return n}function R_(t,e){const n=e._queryParams;if(n.loadsAllData())return j_(t);{const n=e._queryIdentifier;return t.views.get(n)}}function F_(t,e){return null!=R_(t,e)}function L_(t){return null!=j_(t)}function j_(t){for(const e of t.views.values())if(e.query._queryParams.loadsAllData())return e;return null}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function N_(t){uc(!x_,"__referenceConstructor has already been defined"),x_=t}function B_(){return uc(x_,"Reference.ts has not been loaded"),x_}let W_=1;class Y_{constructor(t){this.listenProvider_=t,this.syncPointTree_=new pm(null),this.pendingWriteTree_=Wm(),this.tagToQueryMap=new Map,this.queryToTagMap=new Map}}function U_(t,e,n,i,s){return km(t.pendingWriteTree_,e,n,i,s),s?$_(t,new $f(qf(),e,n)):[]}function X_(t,e,n=!1){const i=Am(t.pendingWriteTree_,e),s=Om(t.pendingWriteTree_,e);if(s){let e=new pm(null);return null!=i.snap?e=e.set(dp(),!0):Wd(i.children,(t=>{e=e.set(new up(t),!0)})),$_(t,new Jf(i.path,e,n))}return[]}function G_(t,e,n){return $_(t,new $f(Kf(),e,n))}function V_(t,e,n){const i=pm.fromObject(n);return $_(t,new tm(Kf(),e,i))}function H_(t,e){return $_(t,new Zf(Kf(),e))}function z_(t,e,n){const i=rv(t,n);if(i){const n=ov(i),s=n.path,r=n.queryId,o=wp(s,e),a=new Zf(Qf(r),o);return av(t,s,a)}return[]}function q_(t,e,n,i,s=!1){const r=e._path,o=t.syncPointTree_.get(r);let a=[];if(o&&("default"===e._queryIdentifier||F_(o,e))){const h=I_(o,e,n,i);k_(o)&&(t.syncPointTree_=t.syncPointTree_.remove(r));const c=h.removed;if(a=h.events,!s){const n=-1!==c.findIndex((t=>t._queryParams.loadsAllData())),s=t.syncPointTree_.findOnPath(r,((t,e)=>L_(e)));if(n&&!s){const e=t.syncPointTree_.subtree(r);if(!e.isEmpty()){const n=hv(e);for(let e=0;e<n.length;++e){const i=n[e],s=i.query,r=nv(t,i);t.listenProvider_.startListening(cv(s),iv(t,s),r.hashFn,r.onComplete)}}}if(!s&&c.length>0&&!i)if(n){const n=null;t.listenProvider_.stopListening(cv(e),n)}else c.forEach((e=>{const n=t.queryToTagMap.get(sv(e));t.listenProvider_.stopListening(cv(e),n)}))}lv(t,c)}return a}function K_(t,e,n,i){const s=rv(t,i);if(null!=s){const i=ov(s),r=i.path,o=i.queryId,a=wp(r,e),h=new $f(Qf(o),a,n);return av(t,r,h)}return[]}function Q_(t,e,n,i){const s=rv(t,i);if(s){const i=ov(s),r=i.path,o=i.queryId,a=wp(r,e),h=pm.fromObject(n),c=new tm(Qf(o),a,h);return av(t,r,c)}return[]}function J_(t,e,n,i=!1){const s=e._path;let r=null,o=!1;t.syncPointTree_.foreachOnPath(s,((t,e)=>{const n=wp(t,s);r=r||M_(e,n),o=o||L_(e)}));let a,h=t.syncPointTree_.get(s);if(h?(o=o||L_(h),r=r||M_(h,dp())):(h=new S_,t.syncPointTree_=t.syncPointTree_.set(s,h)),null!=r)a=!0;else{a=!1,r=mf.EMPTY_NODE;const e=t.syncPointTree_.subtree(s);e.foreachChild(((t,e)=>{const n=M_(e,dp());n&&(r=r.updateImmediateChild(t,n))}))}const c=F_(h,e);if(!c&&!e._queryParams.loadsAllData()){const n=sv(e);uc(!t.queryToTagMap.has(n),"View does not exist, but we have a tag");const i=uv();t.queryToTagMap.set(n,i),t.tagToQueryMap.set(i,n)}const l=Em(t.pendingWriteTree_,s);let u=D_(h,e,n,l,r,a);if(!c&&!o&&!i){const n=R_(h,e);u=u.concat(dv(t,e,n))}return u}function Z_(t,e,n){const i=!0,s=t.pendingWriteTree_,r=t.syncPointTree_.findOnPath(e,((t,n)=>{const i=wp(t,e),s=M_(n,i);if(s)return s}));return Rm(s,e,r,n,i)}function $_(t,e){return tv(e,t.syncPointTree_,null,Em(t.pendingWriteTree_,dp()))}function tv(t,e,n,i){if(bp(t.path))return ev(t,e,n,i);{const s=e.get(dp());null==n&&null!=s&&(n=M_(s,dp()));let r=[];const o=gp(t.path),a=t.operationForChild(o),h=e.children.get(o);if(h&&a){const t=n?n.getImmediateChild(o):null,e=zm(i,o);r=r.concat(tv(a,h,t,e))}return s&&(r=r.concat(A_(s,t,i,n))),r}}function ev(t,e,n,i){const s=e.get(dp());null==n&&null!=s&&(n=M_(s,dp()));let r=[];return e.children.inorderTraversal(((e,s)=>{const o=n?n.getImmediateChild(e):null,a=zm(i,e),h=t.operationForChild(e);h&&(r=r.concat(ev(h,s,o,a)))})),s&&(r=r.concat(A_(s,t,i,n))),r}function nv(t,e){const n=e.query,i=iv(t,n);return{hashFn:()=>{const t=p_(e)||mf.EMPTY_NODE;return t.hash()},onComplete:e=>{if("ok"===e)return i?z_(t,n._path,i):H_(t,n._path);{const i=Gd(e,n);return q_(t,n,null,i)}}}}function iv(t,e){const n=sv(e);return t.queryToTagMap.get(n)}function sv(t){return t._path.toString()+"$"+t._queryIdentifier}function rv(t,e){return t.tagToQueryMap.get(e)}function ov(t){const e=t.indexOf("$");return uc(-1!==e&&e<t.length-1,"Bad queryKey."),{queryId:t.substr(e+1),path:new up(t.substr(0,e))}}function av(t,e,n){const i=t.syncPointTree_.get(e);uc(i,"Missing sync point for query tag that we're tracking");const s=Em(t.pendingWriteTree_,e);return A_(i,n,s,null)}function hv(t){return t.fold(((t,e,n)=>{if(e&&L_(e)){const t=j_(e);return[t]}{let t=[];return e&&(t=P_(e)),Wd(n,((e,n)=>{t=t.concat(n)})),t}}))}function cv(t){return t._queryParams.loadsAllData()&&!t._queryParams.isDefault()?new(B_())(t._repo,t._path):t}function lv(t,e){for(let n=0;n<e.length;++n){const i=e[n];if(!i._queryParams.loadsAllData()){const e=sv(i),n=t.queryToTagMap.get(e);t.queryToTagMap.delete(e),t.tagToQueryMap.delete(n)}}}function uv(){return W_++}function dv(t,e,n){const i=e._path,s=iv(t,e),r=nv(t,n),o=t.listenProvider_.startListening(cv(e),s,r.hashFn,r.onComplete),a=t.syncPointTree_.subtree(i);if(s)uc(!L_(a.value),"If we're adding a query, it shouldn't be shadowed");else{const e=a.fold(((t,e,n)=>{if(!bp(t)&&e&&L_(e))return[j_(e).query];{let t=[];return e&&(t=t.concat(P_(e).map((t=>t.query)))),Wd(n,((e,n)=>{t=t.concat(n)})),t}}));for(let n=0;n<e.length;++n){const i=e[n];t.listenProvider_.stopListening(cv(i),iv(t,i))}}return o}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class gv{constructor(t){this.node_=t}getImmediateChild(t){const e=this.node_.getImmediateChild(t);return new gv(e)}node(){return this.node_}}class pv{constructor(t,e){this.syncTree_=t,this.path_=e}getImmediateChild(t){const e=Cp(this.path_,t);return new pv(this.syncTree_,e)}node(){return Z_(this.syncTree_,this.path_)}}const fv=function(t){return t=t||{},t["timestamp"]=t["timestamp"]||(new Date).getTime(),t},mv=function(t,e,n){return t&&"object"===typeof t?(uc(".sv"in t,"Unexpected leaf node or priority contents"),"string"===typeof t[".sv"]?_v(t[".sv"],e,n):"object"===typeof t[".sv"]?vv(t[".sv"],e):void uc(!1,"Unexpected server value: "+JSON.stringify(t,null,2))):t},_v=function(t,e,n){switch(t){case"timestamp":return n["timestamp"];default:uc(!1,"Unexpected server value: "+t)}},vv=function(t,e,n){t.hasOwnProperty("increment")||uc(!1,"Unexpected server value: "+JSON.stringify(t,null,2));const i=t["increment"];"number"!==typeof i&&uc(!1,"Unexpected increment value: "+i);const s=e.node();if(uc(null!==s&&"undefined"!==typeof s,"Expected ChildrenNode.EMPTY_NODE for nulls"),!s.isLeafNode())return i;const r=s,o=r.getValue();return"number"!==typeof o?i:o+i},yv=function(t,e,n,i){return bv(e,new pv(n,t),i)},Cv=function(t,e,n){return bv(t,new gv(e),n)};function bv(t,e,n){const i=t.getPriority().val(),s=mv(i,e.getImmediateChild(".priority"),n);let r;if(t.isLeafNode()){const i=t,r=mv(i.getValue(),e,n);return r!==i.getValue()||s!==i.getPriority().val()?new sf(r,Cf(s)):t}{const i=t;return r=i,s!==i.getPriority().val()&&(r=r.updatePriority(new sf(s))),i.forEachChild(hf,((t,i)=>{const s=bv(i,e.getImmediateChild(t),n);s!==i&&(r=r.updateImmediateChild(t,s))})),r}}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class wv{constructor(t="",e=null,n={children:{},childCount:0}){this.name=t,this.parent=e,this.node=n}}function xv(t,e){let n=e instanceof up?e:new up(e),i=t,s=gp(n);while(null!==s){const t=il(i.node.children,s)||{children:{},childCount:0};i=new wv(s,i,t),n=fp(n),s=gp(n)}return i}function Sv(t){return t.node.value}function Tv(t,e){t.node.value=e,Pv(t)}function Ev(t){return t.node.childCount>0}function kv(t){return void 0===Sv(t)&&!Ev(t)}function Av(t,e){Wd(t.node.children,((n,i)=>{e(new wv(n,t,i))}))}function Ov(t,e,n,i){n&&!i&&e(t),Av(t,(t=>{Ov(t,e,!0,i)})),n&&i&&e(t)}function Dv(t,e,n){let i=n?t:t.parent;while(null!==i){if(e(i))return!0;i=i.parent}return!1}function Iv(t){return new up(null===t.parent?t.name:Iv(t.parent)+"/"+t.name)}function Pv(t){null!==t.parent&&Mv(t.parent,t.name,t)}function Mv(t,e,n){const i=kv(n),s=nl(t.node.children,e);i&&s?(delete t.node.children[e],t.node.childCount--,Pv(t)):i||s||(t.node.children[e]=n.node,t.node.childCount++,Pv(t))}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Rv=/[\[\].#$\/\u0000-\u001F\u007F]/,Fv=/[\[\].#$\u0000-\u001F\u007F]/,Lv=10485760,jv=function(t){return"string"===typeof t&&0!==t.length&&!Rv.test(t)},Nv=function(t){return"string"===typeof t&&0!==t.length&&!Fv.test(t)},Bv=function(t){return t&&(t=t.replace(/^\/*\.info(\/|$)/,"/")),Nv(t)},Wv=function(t){return null===t||"string"===typeof t||"number"===typeof t&&!Id(t)||t&&"object"===typeof t&&nl(t,".sv")},Yv=function(t,e,n){const i=n instanceof up?new Tp(n,t):n;if(void 0===e)throw new Error(t+"contains undefined "+Op(i));if("function"===typeof e)throw new Error(t+"contains a function "+Op(i)+" with contents = "+e.toString());if(Id(e))throw new Error(t+"contains "+e.toString()+" "+Op(i));if("string"===typeof e&&e.length>Lv/3&&dl(e)>Lv)throw new Error(t+"contains a string greater than "+Lv+" utf8 bytes "+Op(i)+" ('"+e.substring(0,50)+"...')");if(e&&"object"===typeof e){let n=!1,s=!1;if(Wd(e,((e,r)=>{if(".value"===e)n=!0;else if(".priority"!==e&&".sv"!==e&&(s=!0,!jv(e)))throw new Error(t+" contains an invalid key ("+e+") "+Op(i)+'.  Keys must be non-empty strings and can\'t contain ".", "#", "$", "/", "[", or "]"');Ep(i,e),Yv(t,r,i),kp(i)})),n&&s)throw new Error(t+' contains ".value" child '+Op(i)+" in addition to actual children.")}},Uv=function(t,e,n,i){if((!i||void 0!==n)&&!Nv(n))throw new Error(ll(t,e)+'was an invalid path = "'+n+'". Paths must be non-empty strings and can\'t contain ".", "#", "$", "[", or "]"')},Xv=function(t,e,n,i){n&&(n=n.replace(/^\/*\.info(\/|$)/,"/")),Uv(t,e,n,i)},Gv=function(t,e){if(".info"===gp(e))throw new Error(t+" failed = Can't modify data under /.info/")},Vv=function(t,e){const n=e.path.toString();if("string"!==typeof e.repoInfo.host||0===e.repoInfo.host.length||!jv(e.repoInfo.namespace)&&"localhost"!==e.repoInfo.host.split(":")[0]||0!==n.length&&!Bv(n))throw new Error(ll(t,"url")+'must be a valid firebase URL and the path can\'t contain ".", "#", "$", "[", or "]".')};
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
class Hv{constructor(){this.eventLists_=[],this.recursionDepth_=0}}function zv(t,e){let n=null;for(let i=0;i<e.length;i++){const s=e[i],r=s.getPath();null===n||xp(r,n.path)||(t.eventLists_.push(n),n=null),null===n&&(n={events:[],path:r}),n.events.push(s)}n&&t.eventLists_.push(n)}function qv(t,e,n){zv(t,n),Qv(t,(t=>xp(t,e)))}function Kv(t,e,n){zv(t,n),Qv(t,(t=>Sp(t,e)||Sp(e,t)))}function Qv(t,e){t.recursionDepth_++;let n=!0;for(let i=0;i<t.eventLists_.length;i++){const s=t.eventLists_[i];if(s){const r=s.path;e(r)?(Jv(t.eventLists_[i]),t.eventLists_[i]=null):n=!1}}n&&(t.eventLists_=[]),t.recursionDepth_--}function Jv(t){for(let e=0;e<t.events.length;e++){const n=t.events[e];if(null!==n){t.events[e]=null;const i=n.getEventRunner();wd&&Td("event: "+n.toString()),Kd(i)}}}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Zv="repo_interrupt",$v=25;class ty{constructor(t,e,n,i){this.repoInfo_=t,this.forceRestClient_=e,this.authTokenProvider_=n,this.appCheckProvider_=i,this.dataUpdateCount=0,this.statsListener_=null,this.eventQueue_=new Hv,this.nextWriteId_=1,this.interceptServerDataCallback_=null,this.onDisconnect_=Nf(),this.transactionQueueTree_=new wv,this.persistentConnection_=null,this.key=this.repoInfo_.toURLString()}toString(){return(this.repoInfo_.secure?"https://":"http://")+this.repoInfo_.host}}function ey(t,e,n){if(t.stats_=vg(t.repoInfo_),t.forceRestClient_||Qd())t.server_=new Lf(t.repoInfo_,((e,n,i,s)=>{sy(t,e,n,i,s)}),t.authTokenProvider_,t.appCheckProvider_),setTimeout((()=>ry(t,!0)),0);else{if("undefined"!==typeof n&&null!==n){if("object"!==typeof n)throw new Error("Only objects are supported for option databaseAuthVariableOverride");try{Zc(n)}catch(k){throw new Error("Invalid authOverride provided: "+k)}}t.persistentConnection_=new Np(t.repoInfo_,e,((e,n,i,s)=>{sy(t,e,n,i,s)}),(e=>{ry(t,e)}),(e=>{oy(t,e)}),t.authTokenProvider_,t.appCheckProvider_,n),t.server_=t.persistentConnection_}t.authTokenProvider_.addTokenChangeListener((e=>{t.server_.refreshAuthToken(e)})),t.appCheckProvider_.addTokenChangeListener((e=>{t.server_.refreshAppCheckToken(e.token)})),t.statsReporter_=yg(t.repoInfo_,(()=>new Hf(t.stats_,t.server_))),t.infoData_=new jf,t.infoSyncTree_=new Y_({startListening:(e,n,i,s)=>{let r=[];const o=t.infoData_.getNode(e._path);return o.isEmpty()||(r=G_(t.infoSyncTree_,e._path,o),setTimeout((()=>{s("ok")}),0)),r},stopListening:()=>{}}),ay(t,"connected",!1),t.serverSyncTree_=new Y_({startListening:(e,n,i,s)=>(t.server_.listen(e,i,n,((n,i)=>{const r=s(n,i);Kv(t.eventQueue_,e._path,r)})),[]),stopListening:(e,n)=>{t.server_.unlisten(e,n)}})}function ny(t){const e=t.infoData_.getNode(new up(".info/serverTimeOffset")),n=e.val()||0;return(new Date).getTime()+n}function iy(t){return fv({timestamp:ny(t)})}function sy(t,e,n,i,s){t.dataUpdateCount++;const r=new up(e);n=t.interceptServerDataCallback_?t.interceptServerDataCallback_(e,n):n;let o=[];if(s)if(i){const e=rl(n,(t=>Cf(t)));o=Q_(t.serverSyncTree_,r,e,s)}else{const e=Cf(n);o=K_(t.serverSyncTree_,r,e,s)}else if(i){const e=rl(n,(t=>Cf(t)));o=V_(t.serverSyncTree_,r,e)}else{const e=Cf(n);o=G_(t.serverSyncTree_,r,e)}let a=r;o.length>0&&(a=vy(t,r)),Kv(t.eventQueue_,a,o)}function ry(t,e){ay(t,"connected",e),!1===e&&cy(t)}function oy(t,e){Wd(e,((e,n)=>{ay(t,e,n)}))}function ay(t,e,n){const i=new up("/.info/"+e),s=Cf(n);t.infoData_.updateSnapshot(i,s);const r=G_(t.infoSyncTree_,i,s);Kv(t.eventQueue_,i,r)}function hy(t){return t.nextWriteId_++}function cy(t){gy(t,"onDisconnectEvents");const e=iy(t),n=Nf();Wf(t.onDisconnect_,dp(),((i,s)=>{const r=yv(i,s,t.serverSyncTree_,e);Bf(n,i,r)}));let i=[];Wf(n,dp(),((e,n)=>{i=i.concat(G_(t.serverSyncTree_,e,n));const s=Sy(t,e);vy(t,s)})),t.onDisconnect_=Nf(),Kv(t.eventQueue_,dp(),i)}function ly(t,e,n){let i;i=".info"===gp(e._path)?J_(t.infoSyncTree_,e,n):J_(t.serverSyncTree_,e,n),qv(t.eventQueue_,e._path,i)}function uy(t,e,n){let i;i=".info"===gp(e._path)?q_(t.infoSyncTree_,e,n):q_(t.serverSyncTree_,e,n),qv(t.eventQueue_,e._path,i)}function dy(t){t.persistentConnection_&&t.persistentConnection_.interrupt(Zv)}function gy(t,...e){let n="";t.persistentConnection_&&(n=t.persistentConnection_.id+":"),Td(n,...e)}function py(t,e,n,i,s,r){gy(t,"transaction on "+e);const o={path:e,update:n,onComplete:i,status:null,order:yd(),applyLocally:r,retryCount:0,unwatcher:s,abortReason:null,currentWriteId:null,currentInputSnapshot:null,currentOutputSnapshotRaw:null,currentOutputSnapshotResolved:null},a=fy(t,e,void 0);o.currentInputSnapshot=a;const h=o.update(a.val());if(void 0===h)o.unwatcher(),o.currentOutputSnapshotRaw=null,o.currentOutputSnapshotResolved=null,o.onComplete&&o.onComplete(null,!1,o.currentInputSnapshot);else{Yv("transaction failed: Data returned ",h,o.path),o.status=0;const n=xv(t.transactionQueueTree_,e),i=Sv(n)||[];let s;if(i.push(o),Tv(n,i),"object"===typeof h&&null!==h&&nl(h,".priority"))s=il(h,".priority"),uc(Wv(s),"Invalid priority returned by transaction. Priority must be a valid string, finite number, server value, or null.");else{const n=Z_(t.serverSyncTree_,e)||mf.EMPTY_NODE;s=n.getPriority().val()}const r=iy(t),c=Cf(h,s),l=Cv(c,a,r);o.currentOutputSnapshotRaw=c,o.currentOutputSnapshotResolved=l,o.currentWriteId=hy(t);const u=U_(t.serverSyncTree_,e,l,o.currentWriteId,o.applyLocally);Kv(t.eventQueue_,e,u),my(t,t.transactionQueueTree_)}}function fy(t,e,n){return Z_(t.serverSyncTree_,e,n)||mf.EMPTY_NODE}function my(t,e=t.transactionQueueTree_){if(e||xy(t,e),Sv(e)){const n=by(t,e);uc(n.length>0,"Sending zero length transaction queue");const i=n.every((t=>0===t.status));i&&_y(t,Iv(e),n)}else Ev(e)&&Av(e,(e=>{my(t,e)}))}function _y(t,e,n){const i=n.map((t=>t.currentWriteId)),s=fy(t,e,i);let r=s;const o=s.hash();for(let c=0;c<n.length;c++){const t=n[c];uc(0===t.status,"tryToSendTransactionQueue_: items in queue should all be run."),t.status=1,t.retryCount++;const i=wp(e,t.path);r=r.updateChild(i,t.currentOutputSnapshotRaw)}const a=r.val(!0),h=e;t.server_.put(h.toString(),a,(i=>{gy(t,"transaction put response",{path:h.toString(),status:i});let s=[];if("ok"===i){const i=[];for(let e=0;e<n.length;e++)n[e].status=2,s=s.concat(X_(t.serverSyncTree_,n[e].currentWriteId)),n[e].onComplete&&i.push((()=>n[e].onComplete(null,!0,n[e].currentOutputSnapshotResolved))),n[e].unwatcher();xy(t,xv(t.transactionQueueTree_,e)),my(t,t.transactionQueueTree_),Kv(t.eventQueue_,e,s);for(let t=0;t<i.length;t++)Kd(i[t])}else{if("datastale"===i)for(let t=0;t<n.length;t++)3===n[t].status?n[t].status=4:n[t].status=0;else{Od("transaction at "+h.toString()+" failed: "+i);for(let t=0;t<n.length;t++)n[t].status=4,n[t].abortReason=i}vy(t,e)}}),o)}function vy(t,e){const n=Cy(t,e),i=Iv(n),s=by(t,n);return yy(t,s,i),i}function yy(t,e,n){if(0===e.length)return;const i=[];let s=[];const r=e.filter((t=>0===t.status)),o=r.map((t=>t.currentWriteId));for(let a=0;a<e.length;a++){const r=e[a],h=wp(n,r.path);let c,l=!1;if(uc(null!==h,"rerunTransactionsUnderNode_: relativePath should not be null."),4===r.status)l=!0,c=r.abortReason,s=s.concat(X_(t.serverSyncTree_,r.currentWriteId,!0));else if(0===r.status)if(r.retryCount>=$v)l=!0,c="maxretry",s=s.concat(X_(t.serverSyncTree_,r.currentWriteId,!0));else{const n=fy(t,r.path,o);r.currentInputSnapshot=n;const i=e[a].update(n.val());if(void 0!==i){Yv("transaction failed: Data returned ",i,r.path);let e=Cf(i);const a="object"===typeof i&&null!=i&&nl(i,".priority");a||(e=e.updatePriority(n.getPriority()));const h=r.currentWriteId,c=iy(t),l=Cv(e,n,c);r.currentOutputSnapshotRaw=e,r.currentOutputSnapshotResolved=l,r.currentWriteId=hy(t),o.splice(o.indexOf(h),1),s=s.concat(U_(t.serverSyncTree_,r.path,l,r.currentWriteId,r.applyLocally)),s=s.concat(X_(t.serverSyncTree_,h,!0))}else l=!0,c="nodata",s=s.concat(X_(t.serverSyncTree_,r.currentWriteId,!0))}Kv(t.eventQueue_,n,s),s=[],l&&(e[a].status=2,function(t){setTimeout(t,Math.floor(0))}(e[a].unwatcher),e[a].onComplete&&("nodata"===c?i.push((()=>e[a].onComplete(null,!1,e[a].currentInputSnapshot))):i.push((()=>e[a].onComplete(new Error(c),!1,null)))))}xy(t,t.transactionQueueTree_);for(let a=0;a<i.length;a++)Kd(i[a]);my(t,t.transactionQueueTree_)}function Cy(t,e){let n,i=t.transactionQueueTree_;n=gp(e);while(null!==n&&void 0===Sv(i))i=xv(i,n),e=fp(e),n=gp(e);return i}function by(t,e){const n=[];return wy(t,e,n),n.sort(((t,e)=>t.order-e.order)),n}function wy(t,e,n){const i=Sv(e);if(i)for(let s=0;s<i.length;s++)n.push(i[s]);Av(e,(e=>{wy(t,e,n)}))}function xy(t,e){const n=Sv(e);if(n){let t=0;for(let e=0;e<n.length;e++)2!==n[e].status&&(n[t]=n[e],t++);n.length=t,Tv(e,n.length>0?n:void 0)}Av(e,(e=>{xy(t,e)}))}function Sy(t,e){const n=Iv(Cy(t,e)),i=xv(t.transactionQueueTree_,e);return Dv(i,(e=>{Ty(t,e)})),Ty(t,i),Ov(i,(e=>{Ty(t,e)})),n}function Ty(t,e){const n=Sv(e);if(n){const i=[];let s=[],r=-1;for(let e=0;e<n.length;e++)3===n[e].status||(1===n[e].status?(uc(r===e-1,"All SENT items should be at beginning of queue."),r=e,n[e].status=3,n[e].abortReason="set"):(uc(0===n[e].status,"Unexpected transaction status in abort"),n[e].unwatcher(),s=s.concat(X_(t.serverSyncTree_,n[e].currentWriteId,!0)),n[e].onComplete&&i.push(n[e].onComplete.bind(null,new Error("set"),!1,null))));-1===r?Tv(e,void 0):n.length=r+1,Kv(t.eventQueue_,Iv(e),s);for(let t=0;t<i.length;t++)Kd(i[t])}}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Ey(t){let e="";const n=t.split("/");for(let i=0;i<n.length;i++)if(n[i].length>0){let t=n[i];try{t=decodeURIComponent(t.replace(/\+/g," "))}catch(k){}e+="/"+t}return e}function ky(t){const e={};"?"===t.charAt(0)&&(t=t.substring(1));for(const n of t.split("&")){if(0===n.length)continue;const i=n.split("=");2===i.length?e[decodeURIComponent(i[0])]=decodeURIComponent(i[1]):Od(`Invalid query segment '${n}' in query '${t}'`)}return e}const Ay=function(t,e){const n=Oy(t),i=n.namespace;"firebase.com"===n.domain&&Ad(n.host+" is no longer supported. Please use <YOUR FIREBASE>.firebaseio.com instead"),i&&"undefined"!==i||"localhost"===n.domain||Ad("Cannot parse Firebase url. Please use https://<YOUR FIREBASE>.firebaseio.com"),n.secure||Dd();const s="ws"===n.scheme||"wss"===n.scheme;return{repoInfo:new dg(n.host,n.secure,i,s,e,"",i!==n.subdomain),path:new up(n.pathString)}},Oy=function(t){let e="",n="",i="",s="",r="",o=!0,a="https",h=443;if("string"===typeof t){let c=t.indexOf("//");c>=0&&(a=t.substring(0,c-1),t=t.substring(c+2));let l=t.indexOf("/");-1===l&&(l=t.length);let u=t.indexOf("?");-1===u&&(u=t.length),e=t.substring(0,Math.min(l,u)),l<u&&(s=Ey(t.substring(l,u)));const d=ky(t.substring(Math.min(t.length,u)));c=e.indexOf(":"),c>=0?(o="https"===a||"wss"===a,h=parseInt(e.substring(c+1),10)):c=e.length;const g=e.slice(0,c);if("localhost"===g.toLowerCase())n="localhost";else if(g.split(".").length<=2)n=g;else{const t=e.indexOf(".");i=e.substring(0,t).toLowerCase(),n=e.substring(t+1),r=i}"ns"in d&&(r=d["ns"])}return{host:e,port:h,domain:n,subdomain:i,secure:o,scheme:a,pathString:s,namespace:r}},Dy="-0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ_abcdefghijklmnopqrstuvwxyz";(function(){let t=0;const e=[]})();
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
class Iy{constructor(t,e,n,i){this.eventType=t,this.eventRegistration=e,this.snapshot=n,this.prevName=i}getPath(){const t=this.snapshot.ref;return"value"===this.eventType?t._path:t.parent._path}getEventType(){return this.eventType}getEventRunner(){return this.eventRegistration.getEventRunner(this)}toString(){return this.getPath().toString()+":"+this.eventType+":"+Zc(this.snapshot.exportVal())}}class Py{constructor(t,e,n){this.eventRegistration=t,this.error=e,this.path=n}getPath(){return this.path}getEventType(){return"cancel"}getEventRunner(){return this.eventRegistration.getEventRunner(this)}toString(){return this.path.toString()+":cancel"}}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class My{constructor(t,e){this.snapshotCallback=t,this.cancelCallback=e}onValue(t,e){this.snapshotCallback.call(null,t,e)}onCancel(t){return uc(this.hasCancelCallback,"Raising a cancel event on a listener with no cancel callback"),this.cancelCallback.call(null,t)}get hasCancelCallback(){return!!this.cancelCallback}matches(t){return this.snapshotCallback===t.snapshotCallback||void 0!==this.snapshotCallback.userCallback&&this.snapshotCallback.userCallback===t.snapshotCallback.userCallback&&this.snapshotCallback.context===t.snapshotCallback.context}}
/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
class Ry{constructor(t,e,n,i){this._repo=t,this._path=e,this._queryParams=n,this._orderByCalled=i}get key(){return bp(this._path)?null:mp(this._path)}get ref(){return new Fy(this._repo,this._path)}get _queryIdentifier(){const t=Ff(this._queryParams),e=Nd(t);return"{}"===e?"default":e}get _queryObject(){return Ff(this._queryParams)}isEqual(t){if(t=gl(t),!(t instanceof Ry))return!1;const e=this._repo===t._repo,n=xp(this._path,t._path),i=this._queryIdentifier===t._queryIdentifier;return e&&n&&i}toJSON(){return this.toString()}toString(){return this._repo.toString()+_p(this._path)}}class Fy extends Ry{constructor(t,e){super(t,e,new Pf,!1)}get parent(){const t=yp(this._path);return null===t?null:new Fy(this._repo,t)}get root(){let t=this;while(null!==t.parent)t=t.parent;return t}}class Ly{constructor(t,e,n){this._node=t,this.ref=e,this._index=n}get priority(){return this._node.getPriority().val()}get key(){return this.ref.key}get size(){return this._node.numChildren()}child(t){const e=new up(t),n=Ny(this.ref,t);return new Ly(this._node.getChild(e),n,hf)}exists(){return!this._node.isEmpty()}exportVal(){return this._node.val(!0)}forEach(t){if(this._node.isLeafNode())return!1;const e=this._node;return!!e.forEachChild(this._index,((e,n)=>t(new Ly(n,Ny(this.ref,e),hf))))}hasChild(t){const e=new up(t);return!this._node.getChild(e).isEmpty()}hasChildren(){return!this._node.isLeafNode()&&!this._node.isEmpty()}toJSON(){return this.exportVal()}val(){return this._node.val()}}function jy(t,e){return t=gl(t),t._checkNotDeleted("ref"),void 0!==e?Ny(t._root,e):t._root}function Ny(t,e){return t=gl(t),null===gp(t._path)?Xv("child","path",e,!1):Uv("child","path",e,!1),new Fy(t._repo,Cp(t._path,e))}class By{constructor(t){this.callbackContext=t}respondsTo(t){return"value"===t}createEvent(t,e){const n=e._queryParams.getIndex();return new Iy("value",this,new Ly(t.snapshotNode,new Fy(e._repo,e._path),n))}getEventRunner(t){return"cancel"===t.getEventType()?()=>this.callbackContext.onCancel(t.error):()=>this.callbackContext.onValue(t.snapshot,null)}createCancelEvent(t,e){return this.callbackContext.hasCancelCallback?new Py(this,t,e):null}matches(t){return t instanceof By&&(!t.callbackContext||!this.callbackContext||t.callbackContext.matches(this.callbackContext))}hasAnyCallback(){return null!==this.callbackContext}}class Wy{constructor(t,e){this.eventType=t,this.callbackContext=e}respondsTo(t){let e="children_added"===t?"child_added":t;return e="children_removed"===e?"child_removed":e,this.eventType===e}createCancelEvent(t,e){return this.callbackContext.hasCancelCallback?new Py(this,t,e):null}createEvent(t,e){uc(null!=t.childName,"Child events should have a childName.");const n=Ny(new Fy(e._repo,e._path),t.childName),i=e._queryParams.getIndex();return new Iy(t.type,this,new Ly(t.snapshotNode,n,i),t.prevName)}getEventRunner(t){return"cancel"===t.getEventType()?()=>this.callbackContext.onCancel(t.error):()=>this.callbackContext.onValue(t.snapshot,t.prevName)}matches(t){return t instanceof Wy&&(this.eventType===t.eventType&&(!this.callbackContext||!t.callbackContext||this.callbackContext.matches(t.callbackContext)))}hasAnyCallback(){return!!this.callbackContext}}function Yy(t,e,n,i,s){let r;if("object"===typeof i&&(r=void 0,s=i),"function"===typeof i&&(r=i),s&&s.onlyOnce){const e=n,i=(n,i)=>{uy(t._repo,t,a),e(n,i)};i.userCallback=n.userCallback,i.context=n.context,n=i}const o=new My(n,r||void 0),a="value"===e?new By(o):new Wy(e,o);return ly(t._repo,t,a),()=>uy(t._repo,t,a)}function Uy(t,e,n,i){return Yy(t,"value",e,n,i)}T_(Fy),N_(Fy);
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
const Xy="FIREBASE_DATABASE_EMULATOR_HOST",Gy={};let Vy=!1;function Hy(t,e,n,i){const s=e.lastIndexOf(":"),r=e.substring(0,s),o=Pc(r);t.repoInfo_=new dg(e,o,t.repoInfo_.namespace,t.repoInfo_.webSocketOnly,t.repoInfo_.nodeAdmin,t.repoInfo_.persistenceKey,t.repoInfo_.includeNamespaceInQueryParams,!0,n),i&&(t.authTokenProvider_=i)}function zy(t,e,n,i,s){let r=i||t.options.databaseURL;void 0===r&&(t.options.projectId||Ad("Can't determine Firebase Database URL. Be sure to include  a Project ID when calling firebase.initializeApp()."),Td("Using default host for project ",t.options.projectId),r=`${t.options.projectId}-default-rtdb.firebaseio.com`);let o,a,h=Ay(r,s),c=h.repoInfo;"undefined"!==typeof process&&(a={NODE_ENV:"production",BASE_URL:"/alien_mood/"}[Xy]),a?(o=!0,r=`http://${a}?ns=${c.namespace}`,h=Ay(r,s),c=h.repoInfo):o=!h.repoInfo.secure;const l=s&&o?new tg(tg.OWNER):new $d(t.name,t.options,e);Vv("Invalid Firebase Database URL",h),bp(h.path)||Ad("Database URL must point to the root of a Firebase Database (not including a child path).");const u=Ky(c,t,l,new Zd(t,n));return new Qy(u,t)}function qy(t,e){const n=Gy[e];n&&n[t.key]===t||Ad(`Database ${e}(${t.repoInfo_}) has already been deleted.`),dy(t),delete n[t.key]}function Ky(t,e,n,i){let s=Gy[e.name];s||(s={},Gy[e.name]=s);let r=s[t.toURLString()];return r&&Ad("Database initialized multiple times. Please make sure the format of the database URL matches with each database() call."),r=new ty(t,Vy,n,i),s[t.toURLString()]=r,r}class Qy{constructor(t,e){this._repoInternal=t,this.app=e,this["type"]="database",this._instanceStarted=!1}get _repo(){return this._instanceStarted||(ey(this._repoInternal,this.app.options.appId,this.app.options["databaseAuthVariableOverride"]),this._instanceStarted=!0,Bc("Database",null!==this._repo.repoInfo_.emulatorOptions)),this._repoInternal}get _root(){return this._rootInternal||(this._rootInternal=new Fy(this._repo,dp())),this._rootInternal}_delete(){return null!==this._rootInternal&&(qy(this._repo,this.app.name),this._repoInternal=null,this._rootInternal=null),Promise.resolve()}_checkNotDeleted(t){null===this._rootInternal&&Ad("Cannot call "+t+" on a deleted database.")}}function Jy(t=Uu(),e){const n=Fu(t,"database").getImmediate({identifier:e});if(!n._instanceStarted){const t=Oc("database");t&&Zy(n,...t)}return n}function Zy(t,e,n,i={}){t=gl(t),t._checkNotDeleted("useEmulator");const s=`${e}:${n}`,r=t._repoInternal;if(t._instanceStarted){if(s===t._repoInternal.repoInfo_.host&&ol(i,r.repoInfo_.emulatorOptions))return;Ad("connectDatabaseEmulator() cannot initialize or alter the emulator configuration after the database instance has started.")}let o;if(r.repoInfo_.nodeAdmin)i.mockUserToken&&Ad('mockUserToken is not supported by the Admin SDK. For client access with mock users, please use the "firebase" package instead of "firebase-admin".'),o=new tg(tg.OWNER);else if(i.mockUserToken){const e="string"===typeof i.mockUserToken?i.mockUserToken:Rc(i.mockUserToken,t.app.options.projectId);o=new tg(e)}Pc(e)&&(Mc(e),Bc("Database",!0)),Hy(r,s,i,o)}
/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
function $y(t){dd(Wu),Ru(new pl("database",((t,{instanceIdentifier:e})=>{const n=t.getProvider("app").getImmediate(),i=t.getProvider("auth-internal"),s=t.getProvider("app-check-internal");return zy(n,i,s,e)}),"PUBLIC").setMultipleInstances(!0)),Xu(cd,ld,t),Xu(cd,ld,"esm2017")}
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
class tC{constructor(t,e){this.committed=t,this.snapshot=e}toJSON(){return{committed:this.committed,snapshot:this.snapshot.toJSON()}}}function eC(t,e,n){var i;if(t=gl(t),Gv("Reference.transaction",t._path),".length"===t.key||".keys"===t.key)throw"Reference.transaction failed: "+t.key+" is a read-only object.";const s=null===(i=null===n||void 0===n?void 0:n.applyLocally)||void 0===i||i,r=new Ic,o=(e,n,i)=>{let s=null;e?r.reject(e):(s=new Ly(i,new Fy(t._repo,t._path),hf),r.resolve(new tC(n,s)))},a=Uy(t,(()=>{}));return py(t._repo,t._path,e,o,a,s),r.promise}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */Np.prototype.simpleListen=function(t,e){this.sendRequest("q",{p:t},e)},Np.prototype.echo=function(t,e){this.sendRequest("echo",{d:t},e)};$y();const nC={apiKey:"AIzaSyDdvQbWbBmkDWSJeivHI01mJTVSnnYctTs",authDomain:"alien-mood.firebaseapp.com",databaseURL:"https://alien-mood-default-rtdb.firebaseio.com",projectId:"alien-mood",storageBucket:"alien-mood.firebasestorage.app",messagingSenderId:"450783398597",appId:"1:450783398597:web:70b656cd69807231633eac",measurementId:"G-F6ZE81HPV7"},iC=Yu(nC),sC=Jy(iC);var rC={name:"VisitorCounter",data(){return{visitorCount:0,dailyCounts:{}}},mounted(){const t=jy(sC,"visitorCount");eC(t,(t=>(t||0)+1)),Uy(t,(t=>{this.visitorCount=t.val()||0}));const e=(new Date).toISOString().slice(0,10),n=jy(sC,`dailyCounts/${e}`);eC(n,(t=>(t||0)+1));const i=jy(sC,"dailyCounts");Uy(i,(t=>{t.exists()&&(this.dailyCounts=t.val())}))}};const oC=(0,ec.A)(rC,[["render",hc]]);var aC=oC,hC={components:{TestFinal:ic,MainCanvas:ac,VisitorCounter:aC},data(){return{activeTab:0,tabs:[{name:"최종 테스트"},{name:"메인"}]}}};const cC=(0,ec.A)(hC,[["render",c]]);var lC=cC}}]);
//# sourceMappingURL=934.f89735b0.js.map